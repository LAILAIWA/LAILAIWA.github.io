<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="java," />





  <link rel="alternate" href="/atom.xml" title="沂水博客" type="application/atom+xml" />






<meta name="description" content="简单介绍Java集合框架中映射相关内容：映射，Map，映射视图，HashMap，SortedMap，NavigableMap，TreeMap，WeakHashMap，LinkedHashMap，EnumMap，IdentityHashMap，HashTable，属性映射。">
<meta name="keywords" content="java">
<meta property="og:type" content="article">
<meta property="og:title" content="Java集合(五) Map">
<meta property="og:url" content="http://linyishui.top/2019041501.html">
<meta property="og:site_name" content="沂水博客">
<meta property="og:description" content="简单介绍Java集合框架中映射相关内容：映射，Map，映射视图，HashMap，SortedMap，NavigableMap，TreeMap，WeakHashMap，LinkedHashMap，EnumMap，IdentityHashMap，HashTable，属性映射。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/game/sekiro11.jpg">
<meta property="og:updated_time" content="2019-12-16T10:06:41.108Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java集合(五) Map">
<meta name="twitter:description" content="简单介绍Java集合框架中映射相关内容：映射，Map，映射视图，HashMap，SortedMap，NavigableMap，TreeMap，WeakHashMap，LinkedHashMap，EnumMap，IdentityHashMap，HashTable，属性映射。">
<meta name="twitter:image" content="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/game/sekiro11.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://linyishui.top/2019041501.html"/>





  <title>Java集合(五) Map | 沂水博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">沂水博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">编程和心历记录</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linyishui.top/2019041501.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="沂水">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/riho_yoshioka1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沂水博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java集合(五) Map</h1>
        

        <div class="post-meta">
          
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-15T11:41:45+08:00">
                2019-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术文档/" itemprop="url" rel="index">
                    <span itemprop="name">技术文档</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6,951
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  34
                </span>
              
            </div>
          

          
              <div class="post-description">
                  简单介绍Java集合框架中映射相关内容：映射，Map，映射视图，HashMap，SortedMap，NavigableMap，TreeMap，WeakHashMap，LinkedHashMap，EnumMap，IdentityHashMap，HashTable，属性映射。
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/game/sekiro11.jpg" rel="gallery_ck4ceavjs00ib8st7xjdpwg8a"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/game/sekiro11.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        <h1 id="Java集合-五-Map"><a href="#Java集合-五-Map" class="headerlink" title="Java集合(五) Map"></a><strong>Java集合(五) Map</strong></h1><h2 id="第一节-映射"><a href="#第一节-映射" class="headerlink" title="第一节 映射"></a><strong>第一节 映射</strong></h2><p>&emsp;&emsp;映射，即Map，存放键值对的数据结构，键唯一，值不唯一。</p>
<p>&emsp;&emsp;散列映射(HashMap)对键进行散列，树映射(TreeMap)用键的整体顺序对元素排序，并将其组织为搜索树。映射的处理都是基于键，关联的值一般不做处理。</p>
<p>&emsp;&emsp;和Set一样，树映射因为实现有序而比散列映射要慢一些。</p>
<hr>
<h2 id="第二节-Map"><a href="#第二节-Map" class="headerlink" title="第二节 Map"></a><strong>第二节 Map</strong></h2><h3 id="Map接口源码"><a href="#Map接口源码" class="headerlink" title="Map接口源码"></a><strong>Map接口源码</strong></h3><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> interface Map&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="comment">// Query Operations</span></span><br><span class="line">    <span class="built_in">int</span> <span class="built_in">size</span>();<span class="comment">//元素数目</span></span><br><span class="line">    <span class="built_in">boolean</span> isEmpty();<span class="comment">//集合是否为空</span></span><br><span class="line">    <span class="built_in">boolean</span> containsKey(<span class="keyword">Object</span> <span class="built_in">key</span>);<span class="comment">//集合是否包含给定key</span></span><br><span class="line">    <span class="built_in">boolean</span> containsValue(<span class="keyword">Object</span> value);<span class="comment">//集合是否包含给定value</span></span><br><span class="line">    V <span class="built_in">get</span>(<span class="keyword">Object</span> <span class="built_in">key</span>);<span class="comment">//给定key获取对应的value，没有返回null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Modification Operations</span></span><br><span class="line">    V put(K <span class="built_in">key</span>, V value);<span class="comment">//存放Key-value，若映射中已有此key，则覆盖原value，返回旧VALUE，若之前不存在此key则返回null</span></span><br><span class="line">    V remove(<span class="keyword">Object</span> <span class="built_in">key</span>);<span class="comment">//从映射中删除给定KV</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Bulk Operations</span></span><br><span class="line">    <span class="keyword">void</span> putAll(Map&lt;? extends K, ? extends V&gt; m);<span class="comment">//将map所含键值对加入此映射</span></span><br><span class="line">    <span class="keyword">void</span> <span class="built_in">clear</span>();<span class="comment">//清空映射所有键值对</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Views 映射视图</span></span><br><span class="line">    Set&lt;K&gt; keySet();<span class="comment">//键集</span></span><br><span class="line">    Collection&lt;V&gt; values();<span class="comment">//值数组</span></span><br><span class="line">    Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet();<span class="comment">//entry集</span></span><br><span class="line">    interface Entry&lt;K, V&gt; &#123;</span><br><span class="line">        K getKey();</span><br><span class="line">        V getValue();</span><br><span class="line">        V setValue(V value);</span><br><span class="line">        <span class="built_in">boolean</span> equals(<span class="keyword">Object</span> o);</span><br><span class="line">        <span class="built_in">int</span> hashCode();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;K extends Comparable&lt;? <span class="keyword">super</span> K&gt;, V&gt; Comparator&lt;Map.Entry&lt;K, V&gt;&gt; comparingByKey() &#123;</span><br><span class="line">            <span class="keyword">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class="line">                (c1, c2) -&gt; c1.getKey().compareTo(c2.getKey());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V extends Comparable&lt;? <span class="keyword">super</span> V&gt;&gt; Comparator&lt;Map.Entry&lt;K, V&gt;&gt; comparingByValue() &#123;</span><br><span class="line">            <span class="keyword">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class="line">                (c1, c2) -&gt; c1.getValue().compareTo(c2.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; Comparator&lt;Map.Entry&lt;K, V&gt;&gt; comparingByKey(Comparator&lt;? <span class="keyword">super</span> K&gt; cmp) &#123;</span><br><span class="line">            Objects.requireNonNull(cmp);</span><br><span class="line">            <span class="keyword">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class="line">                (c1, c2) -&gt; cmp.compare(c1.getKey(), c2.getKey());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; Comparator&lt;Map.Entry&lt;K, V&gt;&gt; comparingByValue(Comparator&lt;? <span class="keyword">super</span> V&gt; cmp) &#123;</span><br><span class="line">            Objects.requireNonNull(cmp);</span><br><span class="line">            <span class="keyword">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class="line">                (c1, c2) -&gt; cmp.compare(c1.getValue(), c2.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Comparison and hashing</span></span><br><span class="line">    <span class="built_in">boolean</span> equals(<span class="keyword">Object</span> o);</span><br><span class="line">    <span class="built_in">int</span> hashCode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defaultable methods</span></span><br><span class="line">    <span class="keyword">default</span> V getOrDefault(<span class="keyword">Object</span> <span class="built_in">key</span>, V defaultValue) &#123;<span class="comment">//给定key获取对应的value，没有返回给定defaultValue</span></span><br><span class="line">        V v;</span><br><span class="line">        <span class="keyword">return</span> (((v = <span class="built_in">get</span>(<span class="built_in">key</span>)) != <span class="keyword">null</span>) || containsKey(<span class="built_in">key</span>))</span><br><span class="line">            ? v</span><br><span class="line">            : defaultValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> forEach(BiConsumer&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V&gt; action) &#123;<span class="comment">//迭代处理映射中的键值对</span></span><br><span class="line">        Objects.requireNonNull(action);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;K, V&gt; entry : entrySet()) &#123;</span><br><span class="line">            K k;</span><br><span class="line">            V v;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                k = entry.getKey();</span><br><span class="line">                v = entry.getValue();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalStateException ise) &#123;</span><br><span class="line">                <span class="comment">// this usually means the entry is no longer in the map.</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException(ise);</span><br><span class="line">            &#125;</span><br><span class="line">            action.accept(k, v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> replaceAll(BiFunction&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V, ? extends V&gt; function) &#123;<span class="comment">//在所有映射项上应用函数，替换值为处理的非空结果，若结果为null，删除对应键</span></span><br><span class="line">        Objects.requireNonNull(function);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;K, V&gt; entry : entrySet()) &#123;</span><br><span class="line">            K k;</span><br><span class="line">            V v;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                k = entry.getKey();</span><br><span class="line">                v = entry.getValue();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalStateException ise) &#123;</span><br><span class="line">                <span class="comment">// this usually means the entry is no longer in the map.</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException(ise);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ise thrown from function is not a cme.</span></span><br><span class="line">            v = function.apply(k, v);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                entry.setValue(v);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalStateException ise) &#123;</span><br><span class="line">                <span class="comment">// this usually means the entry is no longer in the map.</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException(ise);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> V putIfAbsent(K <span class="built_in">key</span>, V value) &#123;<span class="comment">//只有当key已存在时才替换value</span></span><br><span class="line">        V v = <span class="built_in">get</span>(<span class="built_in">key</span>);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="keyword">null</span>) &#123;</span><br><span class="line">            v = put(<span class="built_in">key</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="built_in">boolean</span> remove(<span class="keyword">Object</span> <span class="built_in">key</span>, <span class="keyword">Object</span> value) &#123;<span class="comment">//移除键值对</span></span><br><span class="line">        <span class="keyword">Object</span> curValue = <span class="built_in">get</span>(<span class="built_in">key</span>);</span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(curValue, value) ||</span><br><span class="line">            (curValue == <span class="keyword">null</span> &amp;&amp; !containsKey(<span class="built_in">key</span>))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        remove(<span class="built_in">key</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="built_in">boolean</span> replace(K <span class="built_in">key</span>, V oldValue, V newValue) &#123;<span class="comment">//当和给定参数等值的键值对存在时，替换新的value</span></span><br><span class="line">        <span class="keyword">Object</span> curValue = <span class="built_in">get</span>(<span class="built_in">key</span>);</span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(curValue, oldValue) ||</span><br><span class="line">            (curValue == <span class="keyword">null</span> &amp;&amp; !containsKey(<span class="built_in">key</span>))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        put(<span class="built_in">key</span>, newValue);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> V replace(K <span class="built_in">key</span>, V value) &#123;<span class="comment">//当键存在并映射到某个值时，替换为新的映射项，替换成功返回原值，替换失败返回NULL</span></span><br><span class="line">        <span class="comment">//等价于 if (map.containsKey(key)) &#123; return map.put(key, value); &#125; else return null;</span></span><br><span class="line">        V curValue;</span><br><span class="line">        <span class="keyword">if</span> (((curValue = <span class="built_in">get</span>(<span class="built_in">key</span>)) != <span class="keyword">null</span>) || containsKey(<span class="built_in">key</span>)) &#123;<span class="comment">//相比注释的写法，这种写法强行多出一个局部变量，我还以为这样写有什么深意，转为字节码看了一下，性能上会差一丢丢局部变量的存读，没有明白这样写的好处是什么，只能猜测是历史原因或编程习惯，如果有知道可以联系告知我，万分感谢。</span></span><br><span class="line">            curValue = put(<span class="built_in">key</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> curValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> V computeIfAbsent(K <span class="built_in">key</span>,</span><br><span class="line">            Function&lt;? <span class="keyword">super</span> K, ? extends V&gt; mappingFunction) &#123;<span class="comment">//若key不与非空v关联，将函数应用到key，将key和结果关联，返回结果，若结果为null，则删除此key，返回null</span></span><br><span class="line">        Objects.requireNonNull(mappingFunction);</span><br><span class="line">        V v;</span><br><span class="line">        <span class="keyword">if</span> ((v = <span class="built_in">get</span>(<span class="built_in">key</span>)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            V newValue;</span><br><span class="line">            <span class="keyword">if</span> ((newValue = mappingFunction.apply(<span class="built_in">key</span>)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                put(<span class="built_in">key</span>, newValue);</span><br><span class="line">                <span class="keyword">return</span> newValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> V computeIfPresent(K <span class="built_in">key</span>,</span><br><span class="line">            BiFunction&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V, ? extends V&gt; remappingFunction) &#123;<span class="comment">//若key与非空v关联，将函数应用到key和v，将key和结果关联，返回结果，若结果为null，则删除此key，返回null</span></span><br><span class="line">        Objects.requireNonNull(remappingFunction);</span><br><span class="line">        V oldValue;</span><br><span class="line">        <span class="keyword">if</span> ((oldValue = <span class="built_in">get</span>(<span class="built_in">key</span>)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            V newValue = remappingFunction.apply(<span class="built_in">key</span>, oldValue);</span><br><span class="line">            <span class="keyword">if</span> (newValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">                put(<span class="built_in">key</span>, newValue);</span><br><span class="line">                <span class="keyword">return</span> newValue;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                remove(<span class="built_in">key</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> V compute(K <span class="built_in">key</span>,</span><br><span class="line">            BiFunction&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V, ? extends V&gt; remappingFunction) &#123;<span class="comment">//将函数应用到key和get(key)，将key和结果关联，返回结果，若结果为null，则删除此key，返回null</span></span><br><span class="line">        Objects.requireNonNull(remappingFunction);</span><br><span class="line">        V oldValue = <span class="built_in">get</span>(<span class="built_in">key</span>);</span><br><span class="line"></span><br><span class="line">        V newValue = remappingFunction.apply(<span class="built_in">key</span>, oldValue);</span><br><span class="line">        <span class="keyword">if</span> (newValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// delete mapping</span></span><br><span class="line">            <span class="keyword">if</span> (oldValue != <span class="keyword">null</span> || containsKey(<span class="built_in">key</span>)) &#123;</span><br><span class="line">                <span class="comment">// something to remove</span></span><br><span class="line">                remove(<span class="built_in">key</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// nothing to do. Leave things as they were.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// add or replace old mapping</span></span><br><span class="line">            put(<span class="built_in">key</span>, newValue);</span><br><span class="line">            <span class="keyword">return</span> newValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> V merge(K <span class="built_in">key</span>, V value,</span><br><span class="line">            BiFunction&lt;? <span class="keyword">super</span> V, ? <span class="keyword">super</span> V, ? extends V&gt; remappingFunction) &#123;<span class="comment">//若key与非空v关联，则将函数应用到value和v上，将结果和key关联，若结果为null，则删除此key。若没有关联的v，则关联key和value</span></span><br><span class="line">        Objects.requireNonNull(remappingFunction);</span><br><span class="line">        Objects.requireNonNull(value);</span><br><span class="line">        V oldValue = <span class="built_in">get</span>(<span class="built_in">key</span>);</span><br><span class="line">        V newValue = (oldValue == <span class="keyword">null</span>) ? value :</span><br><span class="line">                   remappingFunction.apply(oldValue, value);</span><br><span class="line">        <span class="keyword">if</span> (newValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">            remove(<span class="built_in">key</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            put(<span class="built_in">key</span>, newValue);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="映射视图"><a href="#映射视图" class="headerlink" title="映射视图"></a><strong>映射视图</strong></h3><p>&emsp;&emsp;在集合框架中映射并不能算作是集合，其它数据结构框架认为映射是一个键值对集合。但映射可以获取其视图view，就是实现了Collection接口的对象。</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Views</span></span><br><span class="line"><span class="keyword">Set</span>&lt;K&gt; keySet(); <span class="comment">//键集视图，非HashSet或TreeSet，可以删除但不能新增元素</span></span><br><span class="line">Collection&lt;V&gt; values(); <span class="comment">//值集合视图，可以删除但不能新增元素</span></span><br><span class="line"><span class="keyword">Set</span>&lt;Map.Entry&lt;K, V&gt;&gt; entrySet(); <span class="comment">//键值对集视图，可以删除但不能新增元素</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这三个视图就是映射中的集合部分。</p>
<hr>
<h2 id="第三节-HashMap"><a href="#第三节-HashMap" class="headerlink" title="第三节 HashMap"></a><strong>第三节 HashMap</strong></h2><p>&emsp;&emsp;散列映射HashMap，通过一个Node数组来存储元素，Node是一个单向链表结构。</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class <span class="keyword">HashMap</span>&lt;K,V&gt; extends AbstractMap&lt;K,V&gt;</span><br><span class="line">    implements Map&lt;K,V&gt;, Cloneable, Serializable &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">transient</span> Node&lt;K,V&gt;[] table;<span class="comment">//哈希表</span></span><br><span class="line">    <span class="keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class="line">    <span class="keyword">transient</span> <span class="built_in">int</span> <span class="built_in">size</span>;</span><br><span class="line">    <span class="keyword">transient</span> <span class="built_in">int</span> modCount;</span><br><span class="line">    <span class="built_in">int</span> threshold;<span class="comment">//再散列阈值 = 容量 * 装填因子</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">float</span> loadFactor;<span class="comment">//装填因子，决定再再散列</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="built_in">int</span> hash;<span class="comment">//当前链表对应哈希码</span></span><br><span class="line">        <span class="keyword">final</span> K <span class="built_in">key</span>;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> hash(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">        <span class="built_in">int</span> h;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">key</span> == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = <span class="built_in">key</span>.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> class EntrySet extends AbstractSet&lt;Map.Entry&lt;K,V&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="built_in">int</span> <span class="built_in">size</span>()                 &#123; <span class="keyword">return</span> <span class="built_in">size</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="built_in">clear</span>()               &#123; <span class="keyword">HashMap</span>.<span class="keyword">this</span>.<span class="built_in">clear</span>(); &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> EntryIterator();</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="built_in">get</span>(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">        Node&lt;K,V&gt; e;</span><br><span class="line">        <span class="keyword">return</span> (e = getNode(hash(<span class="built_in">key</span>), <span class="built_in">key</span>)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">boolean</span> containsKey(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> getNode(hash(<span class="built_in">key</span>), <span class="built_in">key</span>) != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a><strong>使用</strong></h3><p>&emsp;&emsp;示例通过<a href="../2019031802.html" title="Title">Lambda表达式</a>迭代处理键值对，以及合理的进行更新。</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Person&gt; personMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">personMap.put(<span class="string">"001"</span>,<span class="keyword">new</span> Person(<span class="string">"Mary"</span>,<span class="number">17</span>));</span><br><span class="line">personMap.put(<span class="string">"002"</span>,<span class="keyword">new</span> Person(<span class="string">"Lee"</span>,<span class="number">20</span>));</span><br><span class="line">personMap.put(<span class="string">"003"</span>,<span class="keyword">new</span> Person(<span class="string">"Ada"</span>,<span class="number">17</span>));</span><br><span class="line"></span><br><span class="line">personMap.forEach<span class="function"><span class="params">((k,v) -&gt; System.out.println(<span class="string">"key["</span> + k + <span class="string">"] value["</span> + v + <span class="string">"]"</span>))</span>;</span></span><br><span class="line"><span class="function"><span class="title">personMap</span>.<span class="title">replaceAll</span><span class="params">((k,vo) -&gt; <span class="keyword">new</span> Person(<span class="string">"Mary"</span>,<span class="number">18</span>))</span>;</span></span><br><span class="line"><span class="function"><span class="title">personMap</span>.<span class="title">forEach</span><span class="params">((k,v) -&gt; System.out.println(<span class="string">"key["</span> + k + <span class="string">"] value["</span> + v + <span class="string">"]"</span>))</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//实现姓名计数器</span></span><br><span class="line"><span class="function"><span class="title">Map</span>&lt;<span class="title">String</span>,<span class="title">Integer</span>&gt; <span class="title">nameMap</span> = <span class="title">new</span> <span class="title">HashMap</span>&lt;&gt;<span class="params">()</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Michael"</span>,<span class="number">0</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Lay"</span>,<span class="number">0</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Amanda"</span>,<span class="number">0</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">forEach</span><span class="params">((k,v) -&gt; System.out.println(<span class="string">"key["</span> + k + <span class="string">"] value["</span> + v + <span class="string">"]"</span>))</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//<span class="title">put</span>更新</span></span><br><span class="line"><span class="function">//<span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">"put更新"</span>)</span>;</span></span><br><span class="line"><span class="function">//<span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Michael"</span>,nameMap.get(<span class="string">"Michael"</span>)+<span class="number">1</span>)</span>;</span></span><br><span class="line"><span class="function">//<span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Jack"</span>,nameMap.get(<span class="string">"Jack"</span>)+<span class="number">1</span>)</span>;//当<span class="title">key</span>不存在时<span class="title">get</span>返回<span class="title">null</span>，所以抛出异常<span class="title">java</span>.<span class="title">lang</span>.<span class="title">NullPointerException</span></span></span><br><span class="line"><span class="function">//<span class="title">nameMap</span>.<span class="title">forEach</span><span class="params">((k,v) -&gt; System.out.println(<span class="string">"key["</span> + k + <span class="string">"] value["</span> + v + <span class="string">"]"</span>))</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//<span class="title">put</span>+<span class="title">getOrDefault</span>更新</span></span><br><span class="line"><span class="function"><span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">"put+getOrDefault更新"</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Michael"</span>,nameMap.getOrDefault(<span class="string">"Michael"</span>,<span class="number">0</span>)+<span class="number">1</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Jack"</span>,nameMap.getOrDefault(<span class="string">"Jack"</span>,<span class="number">0</span>)+<span class="number">1</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">forEach</span><span class="params">((k,v) -&gt; System.out.println(<span class="string">"key["</span> + k + <span class="string">"] value["</span> + v + <span class="string">"]"</span>))</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//<span class="title">putIfAbsent</span>+<span class="title">put</span>更新</span></span><br><span class="line"><span class="function"><span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">"putIfAbsent+put更新"</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">putIfAbsent</span><span class="params">(<span class="string">"Michael"</span>,<span class="number">0</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Michael"</span>,nameMap.get(<span class="string">"Michael"</span>)+<span class="number">1</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">putIfAbsent</span><span class="params">(<span class="string">"Jack"</span>,<span class="number">0</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">put</span><span class="params">(<span class="string">"Jack"</span>,nameMap.get(<span class="string">"Jack"</span>)+<span class="number">1</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">forEach</span><span class="params">((k,v) -&gt; System.out.println(<span class="string">"key["</span> + k + <span class="string">"] value["</span> + v + <span class="string">"]"</span>))</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">//<span class="title">merge</span>更新</span></span><br><span class="line"><span class="function"><span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(<span class="string">"merge更新"</span>)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">merge</span><span class="params">(<span class="string">"Michael"</span>,<span class="number">1</span>,Integer::sum)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">merge</span><span class="params">(<span class="string">"Jack"</span>,<span class="number">1</span>,Integer::sum)</span>;</span></span><br><span class="line"><span class="function"><span class="title">nameMap</span>.<span class="title">forEach</span><span class="params">((k,v) -&gt; System.out.println(<span class="string">"key["</span> + k + <span class="string">"] value["</span> + v + <span class="string">"]"</span>))</span>;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;执行结果如下：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">key<span class="string">[001]</span> value<span class="string">[name: Mary age: 17]</span></span><br><span class="line">key<span class="string">[002]</span> value<span class="string">[name: Lee age: 20]</span></span><br><span class="line">key<span class="string">[003]</span> value<span class="string">[name: Ada age: 17]</span></span><br><span class="line">key<span class="string">[001]</span> value<span class="string">[name: Mary age: 18]</span></span><br><span class="line">key<span class="string">[002]</span> value<span class="string">[name: Mary age: 18]</span></span><br><span class="line">key<span class="string">[003]</span> value<span class="string">[name: Mary age: 18]</span></span><br><span class="line"></span><br><span class="line">key<span class="string">[Lay]</span> value<span class="string">[0]</span></span><br><span class="line">key<span class="string">[Michael]</span> value<span class="string">[0]</span></span><br><span class="line">key<span class="string">[Amanda]</span> value<span class="string">[0]</span></span><br><span class="line"></span><br><span class="line">put+getOrDefault更新</span><br><span class="line">key<span class="string">[Lay]</span> value<span class="string">[0]</span></span><br><span class="line">key<span class="string">[Michael]</span> value<span class="string">[1]</span></span><br><span class="line">key<span class="string">[Jack]</span> value<span class="string">[1]</span></span><br><span class="line">key<span class="string">[Amanda]</span> value<span class="string">[0]</span></span><br><span class="line"></span><br><span class="line">putIfAbsent+put更新</span><br><span class="line">key<span class="string">[Lay]</span> value<span class="string">[0]</span></span><br><span class="line">key<span class="string">[Michael]</span> value<span class="string">[2]</span></span><br><span class="line">key<span class="string">[Jack]</span> value<span class="string">[2]</span></span><br><span class="line">key<span class="string">[Amanda]</span> value<span class="string">[0]</span></span><br><span class="line"></span><br><span class="line">merge更新</span><br><span class="line">key<span class="string">[Lay]</span> value<span class="string">[0]</span></span><br><span class="line">key<span class="string">[Michael]</span> value<span class="string">[3]</span></span><br><span class="line">key<span class="string">[Jack]</span> value<span class="string">[3]</span></span><br><span class="line">key<span class="string">[Amanda]</span> value<span class="string">[0]</span></span><br></pre></td></tr></table></figure>
<h3 id="怎么get"><a href="#怎么get" class="headerlink" title="怎么get"></a><strong>怎么get</strong></h3><p>&emsp;&emsp;获取键值时，会先计算键对应的哈希码，然后通过哈希码直接根据数组索引找到对应桶（链表），然后遍历链表查询键对应值。</p>
<p>&emsp;&emsp;所以我们可以算一下get方法的时间复杂度，已知数组的随机访问时间复杂度是O(1)，这是硬件保证的，然后理想状况下，也就是散列均匀的情况下，首节点就应该是所找元素，而链表的存在是为了解决哈希冲突，如果不考虑哈希冲突时最终复杂度仍是O(1)。</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="built_in">get</span>(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(<span class="built_in">key</span>), <span class="built_in">key</span>)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt; getNode(<span class="built_in">int</span> hash, <span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="built_in">int</span> n; K k;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.<span class="built_in">key</span>) == <span class="built_in">key</span> || (<span class="built_in">key</span> != <span class="keyword">null</span> &amp;&amp; <span class="built_in">key</span>.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)<span class="comment">//红黑树优化</span></span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, <span class="built_in">key</span>);</span><br><span class="line">            do &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.<span class="built_in">key</span>) == <span class="built_in">key</span> || (<span class="built_in">key</span> != <span class="keyword">null</span> &amp;&amp; <span class="built_in">key</span>.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="怎么计算哈希码"><a href="#怎么计算哈希码" class="headerlink" title="怎么计算哈希码"></a><strong>怎么计算哈希码</strong></h3><p>&emsp;&emsp;调用key的hashcode()得到原始的哈希码，然后把32位的整型h右移了16位，再和h做一次异或运算，这样操作的结果是高区16位保持不变，低区16位混合了原高区和低区16位。</p>
<p>&emsp;&emsp;为什么要这样做？在取数组索引时会进行此运算：(n - 1) &amp; hash，因为n不够大（无法达到2^16），高区16位基本会被屏蔽，所以失去了高区特征的哈希码发生碰撞的几率会变大。</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> hash(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">    <span class="built_in">int</span> h;</span><br><span class="line">    <span class="comment">//&gt;&gt;&gt;表示无符号右移，也叫逻辑右移，即若该数为正，则高位补0，而若该数为负数，则右移后高位同样补0</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">key</span> == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = <span class="built_in">key</span>.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">first = tab[(n - <span class="number">1</span>) &amp; hash]</span><br></pre></td></tr></table></figure>
<h3 id="怎么put"><a href="#怎么put" class="headerlink" title="怎么put"></a><strong>怎么put</strong></h3><p>&emsp;&emsp;新增键值对时，会先根据哈希码找到数组对应下标，然后遍历链表查询指定键，并判断此时是否需要扩容。当哈希碰撞过多，链表达到指定长度上限时，会将链表转换为红黑树来优化。</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V put(K <span class="built_in">key</span>, V value) &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(<span class="built_in">key</span>), <span class="built_in">key</span>, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> V putVal(<span class="built_in">int</span> hash, K <span class="built_in">key</span>, V value, <span class="built_in">boolean</span> onlyIfAbsent,</span><br><span class="line">               <span class="built_in">boolean</span> evict) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="built_in">int</span> n, i;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)<span class="comment">//哈希表未初始化，则先初始化，并返回哈希表长度</span></span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)<span class="comment">//对应哈希码未存链表，直接以value新增Node链</span></span><br><span class="line">        tab[i] = newNode(hash, <span class="built_in">key</span>, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">//对应哈希码已有链表</span></span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.<span class="built_in">key</span>) == <span class="built_in">key</span> || (<span class="built_in">key</span> != <span class="keyword">null</span> &amp;&amp; <span class="built_in">key</span>.equals(k))))<span class="comment">//首个节点即哈希码相同，且键相等(==或equals)，则对应键的节点已存在，获取节点引用</span></span><br><span class="line">            e = p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)<span class="comment">//红黑树优化</span></span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, <span class="built_in">key</span>, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;<span class="comment">//都不符合</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;<span class="comment">//遍历节点链表</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;<span class="comment">//取得的下个节点为空，则表示未找到对应键，直接创建新的映射，获取节点引用</span></span><br><span class="line">                    p.next = newNode(hash, <span class="built_in">key</span>, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st 若已执行到阈值，替换指定下标处所有链接节点，把链表升级为红黑树</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.<span class="built_in">key</span>) == <span class="built_in">key</span> || (<span class="built_in">key</span> != <span class="keyword">null</span> &amp;&amp; <span class="built_in">key</span>.equals(k))))<span class="comment">//如果当前节点即要找的映射，跳出循环，获取节点引用</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;<span class="comment">//移动链表指针</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key </span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="keyword">if</span> (++<span class="built_in">size</span> &gt; threshold) <span class="comment">//若此时元素数超过阈值，则扩容resize并rehash再散列</span></span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="怎么扩容"><a href="#怎么扩容" class="headerlink" title="怎么扩容"></a><strong>怎么扩容</strong></h3><p>&emsp;&emsp;当HashMap中所存元素达到阈值时，就会进行扩容并进行<strong>再散列</strong>。旧的哈希表中有含多个元素的链表时，因为哈希表容量变了，所以一部分元素需要进行再散列，所以源码中通过两组首尾指针将链表切割为两部分，分别映射到原下标和新下标。</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">final Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">     Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">     int oldCap = (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : <span class="type">oldTab</span>.length;</span><br><span class="line">     int oldThr = threshold;</span><br><span class="line">     int <span class="keyword">new</span><span class="type">Cap</span>, <span class="keyword">new</span><span class="type">Thr</span> = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;<span class="comment">//当旧容量大于0</span></span><br><span class="line">         <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;<span class="comment">//且大于等于最大容量时，阈值取最大整型，直接返回哈希表</span></span><br><span class="line">             threshold = Integer.MAX_VALUE;</span><br><span class="line">             <span class="keyword">return</span> oldTab;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">new</span><span class="type">Cap</span> = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                  oldCap &gt;= DEFAULT_INITIAL_CAPACITY)<span class="comment">//且旧容量未到最大容量，新容量和新阈值都为旧值2倍，</span></span><br><span class="line">             <span class="keyword">new</span><span class="type">Thr</span> = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold 旧容量小于等于0，且旧阈值大于0，则新容量即为旧阈值</span></span><br><span class="line">         <span class="keyword">new</span><span class="type">Cap</span> = oldThr;</span><br><span class="line">     <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults 否则都设置为初始值</span></span><br><span class="line">         <span class="keyword">new</span><span class="type">Cap</span> = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">         <span class="keyword">new</span><span class="type">Thr</span> = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">new</span><span class="type">Thr</span> == <span class="number">0</span>) &#123;</span><br><span class="line">         float ft = (float)<span class="keyword">new</span><span class="type">Cap</span> * loadFactor;</span><br><span class="line">         <span class="keyword">new</span><span class="type">Thr</span> = (<span class="keyword">new</span><span class="type">Cap</span> &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?</span><br><span class="line">                   (int)ft : <span class="type">Integer</span>.MAX_VALUE);</span><br><span class="line">     &#125;</span><br><span class="line">     threshold = <span class="keyword">new</span><span class="type">Thr</span>;</span><br><span class="line">     @SuppressWarnings(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">         Node&lt;K,V&gt;[] <span class="keyword">new</span><span class="type">Tab</span> = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="type">Node</span>[<span class="keyword">new</span><span class="type">Cap</span>];</span><br><span class="line">     table = <span class="keyword">new</span><span class="type">Tab</span>;</span><br><span class="line">     <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) &#123;<span class="comment">//遍历旧哈希表并重新散列元素到新哈希表</span></span><br><span class="line">         <span class="keyword">for</span> (int j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">             Node&lt;K,V&gt; e;</span><br><span class="line">             <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                 oldTab[j] = <span class="literal">null</span>;<span class="comment">//断开与旧哈希表的链接</span></span><br><span class="line">                 <span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">                     <span class="keyword">new</span><span class="type">Tab</span>[e.hash &amp; (<span class="keyword">new</span><span class="type">Cap</span> - <span class="number">1</span>)] = e;<span class="comment">//如果e是链表尾节点，将e再散列后链接到新哈希表</span></span><br><span class="line">                 <span class="keyword">else</span> <span class="keyword">if</span> (e instanceof TreeNode)<span class="comment">//红黑树优化</span></span><br><span class="line">                     ((TreeNode&lt;K,V&gt;)e).split(<span class="built_in">this</span>, <span class="keyword">new</span><span class="type">Tab</span>, j, oldCap);</span><br><span class="line">                 <span class="keyword">else</span> &#123; <span class="comment">// preserve order 如果e非链表尾节点</span></span><br><span class="line">                     Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;<span class="comment">//lo和hi分别对应不需要再散列和需要再散列的节点</span></span><br><span class="line">                     Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                     Node&lt;K,V&gt; next;</span><br><span class="line">                     <span class="keyword">do</span> &#123;<span class="comment">//循环遍历链表，并把head和tail分别指向首尾节点</span></span><br><span class="line">                         next = e.next;</span><br><span class="line">                         <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                             <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                                 loHead = e;</span><br><span class="line">                             <span class="keyword">else</span></span><br><span class="line">                                 loTail.next = e;</span><br><span class="line">                             loTail = e;</span><br><span class="line">                         &#125;</span><br><span class="line">                         <span class="keyword">else</span> &#123;</span><br><span class="line">                             <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                                 hiHead = e;</span><br><span class="line">                             <span class="keyword">else</span></span><br><span class="line">                                 hiTail.next = e;</span><br><span class="line">                             hiTail = e;</span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line">                     <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;<span class="comment">//lo组合，将loHead首节点节点链接到新哈希表</span></span><br><span class="line">                         loTail.next = <span class="literal">null</span>;</span><br><span class="line">                         <span class="keyword">new</span><span class="type">Tab</span>[j] = loHead;</span><br><span class="line">                     &#125;</span><br><span class="line">                     <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;<span class="comment">//hi组合，将hiHead首节点节点链接到新哈希表，需要映射到新的下标</span></span><br><span class="line">                         hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                         <span class="keyword">new</span><span class="type">Tab</span>[j + oldCap] = hiHead;</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span><span class="type">Tab</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="旧版本的问题"><a href="#旧版本的问题" class="headerlink" title="旧版本的问题"></a><strong>旧版本的问题</strong></h3><p>&emsp;&emsp;以上内容基于JDK 1.8版本，相比旧版本的HashMap优化了一些问题。</p>
<p>&emsp;&emsp;第一，优化了高位运算的hash算法，通过移位异或：h^(h&gt;&gt;&gt;16)，融合了高位的特征。</p>
<p>&emsp;&emsp;第二，有数组+链表的结构优化为数组+链表+红黑树。当拉链过长时链表就会转换为红黑树，优化拉链过长时的查询效率。</p>
<p>&emsp;&emsp;第三，新版本中的扩容通过上述源码可以得知，元素要么保持下标j不变，要么就是j + oldCap，链表的顺序也不会改变，不需要重新计算hash，只需要根据原来hash值新增的bit是1还是0分别放进两个链表lo和hi（非红黑树的情况）里，0的话索引没变，1的话索引变为原索引加原来的数组长度。</p>
<p>&emsp;&emsp;旧版本扩容时需要重新计算哈希码，新增元素时是头插法（新元素next指向老元素），第二个线程会覆盖掉第一个线程的值，使第一个线程的值丢失，也可能会因为第一个线程刚读到e和next就挂起，此时e指向a1，next指向a2，第二个线程执行，并使链表变为a2.next = a1，此时第一个线程恢复运行，e和next分别指向a1和a2，再继续执行就又生成了反向的链路，导致了单向循环链表。而新版因为用的尾插法所以新数组链表不会倒置，多线程下不会出现死循环。</p>
<hr>
<h2 id="第四节-SortedMap"><a href="#第四节-SortedMap" class="headerlink" title="第四节 SortedMap"></a><strong>第四节 SortedMap</strong></h2><p>&emsp;&emsp;有序映射，和SortedXX系列一样，相较xx具有有序性。映射比较的是Key，前面有提到不会对value进行处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SortedMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    Comparator&lt;? <span class="keyword">super</span> K&gt; comparator();</span><br><span class="line">    <span class="function">SortedMap&lt;K,V&gt; <span class="title">subMap</span><span class="params">(K fromKey, K toKey)</span></span>;</span><br><span class="line">    <span class="function">SortedMap&lt;K,V&gt; <span class="title">headMap</span><span class="params">(K toKey)</span></span>;</span><br><span class="line">    <span class="function">SortedMap&lt;K,V&gt; <span class="title">tailMap</span><span class="params">(K fromKey)</span></span>;</span><br><span class="line">    <span class="function">K <span class="title">firstKey</span><span class="params">()</span></span>;<span class="comment">//最小元素</span></span><br><span class="line">    <span class="function">K <span class="title">lastKey</span><span class="params">()</span></span>;<span class="comment">//最大元素</span></span><br><span class="line">    <span class="function">Set&lt;K&gt; <span class="title">keySet</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Collection&lt;V&gt; <span class="title">values</span><span class="params">()</span></span>;</span><br><span class="line">    Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第五节-NavigableMap"><a href="#第五节-NavigableMap" class="headerlink" title="第五节 NavigableMap"></a><strong>第五节 NavigableMap</strong></h2><p>&emsp;&emsp;和NavigableXX系列一样，继承SortedMap并声明了便于搜索和遍历的迭代器等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NavigableMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">SortedMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    Map.<span class="function">Entry&lt;K,V&gt; <span class="title">lowerEntry</span><span class="params">(K key)</span></span>;</span><br><span class="line">    <span class="function">K <span class="title">lowerKey</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    Map.<span class="function">Entry&lt;K,V&gt; <span class="title">floorEntry</span><span class="params">(K key)</span></span>;</span><br><span class="line">    <span class="function">K <span class="title">floorKey</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    Map.<span class="function">Entry&lt;K,V&gt; <span class="title">ceilingEntry</span><span class="params">(K key)</span></span>;</span><br><span class="line">    <span class="function">K <span class="title">ceilingKey</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    Map.<span class="function">Entry&lt;K,V&gt; <span class="title">higherEntry</span><span class="params">(K key)</span></span>;</span><br><span class="line">    <span class="function">K <span class="title">higherKey</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    Map.<span class="function">Entry&lt;K,V&gt; <span class="title">firstEntry</span><span class="params">()</span></span>;</span><br><span class="line">    Map.<span class="function">Entry&lt;K,V&gt; <span class="title">lastEntry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    Map.<span class="function">Entry&lt;K,V&gt; <span class="title">pollFirstEntry</span><span class="params">()</span></span>;</span><br><span class="line">    Map.<span class="function">Entry&lt;K,V&gt; <span class="title">pollLastEntry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">NavigableMap&lt;K,V&gt; <span class="title">descendingMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">NavigableSet&lt;K&gt; <span class="title">navigableKeySet</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">NavigableSet&lt;K&gt; <span class="title">descendingKeySet</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">NavigableMap&lt;K,V&gt; <span class="title">subMap</span><span class="params">(K fromKey, <span class="keyword">boolean</span> fromInclusive,</span></span></span><br><span class="line"><span class="function"><span class="params">                             K toKey,   <span class="keyword">boolean</span> toInclusive)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">NavigableMap&lt;K,V&gt; <span class="title">headMap</span><span class="params">(K toKey, <span class="keyword">boolean</span> inclusive)</span></span>;</span><br><span class="line">    <span class="function">NavigableMap&lt;K,V&gt; <span class="title">tailMap</span><span class="params">(K fromKey, <span class="keyword">boolean</span> inclusive)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">SortedMap&lt;K,V&gt; <span class="title">subMap</span><span class="params">(K fromKey, K toKey)</span></span>;</span><br><span class="line">    <span class="function">SortedMap&lt;K,V&gt; <span class="title">headMap</span><span class="params">(K toKey)</span></span>;</span><br><span class="line">    <span class="function">SortedMap&lt;K,V&gt; <span class="title">tailMap</span><span class="params">(K fromKey)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第六节-TreeMap"><a href="#第六节-TreeMap" class="headerlink" title="第六节 TreeMap"></a><strong>第六节 TreeMap</strong></h2><p>&emsp;&emsp;树映射，当需要顺序读取键值对时可以考虑使用。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">NavigableMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;? <span class="keyword">super</span> K&gt; comparator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Entry&lt;K,V&gt; root;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TreeMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        comparator = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TreeMap</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> K&gt; comparator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.comparator = comparator;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TreeMap</span><span class="params">(Map&lt;? <span class="keyword">extends</span> K, ? <span class="keyword">extends</span> V&gt; m)</span> </span>&#123;</span><br><span class="line">        comparator = <span class="keyword">null</span>;</span><br><span class="line">        putAll(m);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TreeMap</span><span class="params">(SortedMap&lt;K, ? <span class="keyword">extends</span> V&gt; m)</span> </span>&#123;</span><br><span class="line">        comparator = m.comparator();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            buildFromSorted(m.size(), m.entrySet().iterator(), <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (java.io.IOException | ClassNotFoundException cannotHappen) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第七节-WeakHashMap"><a href="#第七节-WeakHashMap" class="headerlink" title="第七节 WeakHashMap"></a><strong>第七节 WeakHashMap</strong></h2><p>&emsp;&emsp;若映射中存储的值，其键已经过了最后一次调用，若其是对象则GC会回收，但映射中的键值对并不会被回收。垃圾回收器跟踪活动的对象，只要映射对象是活动的，其中所有的桶也是活动的，它们不能被回收，如果想要回收映射中的无用对象需要有程序负责从长期存活的映射表中删除那些没用的值。</p>
<p>&emsp;&emsp;弱散列映射，WeakHashMap，当对键的唯一引用来自于散列条目时，映射会和垃圾回收器协同删除键值对。</p>
<blockquote>
<p>WeakHashMap怎么实现对无用对象的回收？</p>
<p>WeakHashMap通过弱引用(weak references)来保存键，WeakReference对象将引用保存到另外一个对象中，对于WeakHashMap就是散列键。</p>
<p>对于此类对象，GC有一种特殊的方式来处理，普通的对象如果引用已没有调用，GC会回收此对象，若对象由WeakReference引用，GC仍会回收它，但会将引用此对象的弱引用放入队列中，WeakHashMap会周期性的检查此队列，去找出新添加的弱引用，若找到弱引用则表示此键已不再被使用，WeakHashMap就会删除此条目。</p>
</blockquote>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> WeakHashMap&lt;K,V&gt; <span class="keyword">extends</span> AbstractMap&lt;K,V&gt;</span><br><span class="line">    <span class="keyword">implements</span> Map&lt;K,V&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Entry&lt;K,V&gt;[] table;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="keyword">size</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> threshold;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReferenceQueue&lt;Object&gt; queue = <span class="keyword">new</span> ReferenceQueue&lt;&gt;();<span class="comment">//引用队列</span></span><br><span class="line">    <span class="keyword">int</span> modCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Entry&lt;K,V&gt;[] newTable(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        <span class="keyword">return</span> (Entry&lt;K,V&gt;[]) <span class="keyword">new</span> Entry&lt;?,?&gt;[n];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> Entry&lt;K,V&gt; <span class="keyword">extends</span> WeakReference&lt;Object&gt; <span class="keyword">implements</span> Map.Entry&lt;K,V&gt; &#123;<span class="comment">//相比HashMap的Node，WeakHashMap的Entry继承了弱引用类</span></span><br><span class="line">        V value;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">        Entry&lt;K,V&gt; <span class="keyword">next</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Creates new entry.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Entry(Object key, V value,</span><br><span class="line">              ReferenceQueue&lt;Object&gt; queue,</span><br><span class="line">              <span class="keyword">int</span> hash, Entry&lt;K,V&gt; <span class="keyword">next</span>) &#123;</span><br><span class="line">            <span class="keyword">super</span>(key, queue);</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.hash  = hash;</span><br><span class="line">            <span class="keyword">this</span>.<span class="keyword">next</span>  = <span class="keyword">next</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> expungeStaleEntries() &#123;<span class="comment">//帮助GC消除无用的条目</span></span><br><span class="line">        <span class="keyword">for</span> (Object x; (x = queue.poll()) != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (queue) &#123;<span class="comment">//锁同步迭代queue</span></span><br><span class="line">                @SuppressWarnings(<span class="string">"unchecked"</span>)</span><br><span class="line">                    Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;) x;<span class="comment">//要清理的垃圾对象e</span></span><br><span class="line">                <span class="keyword">int</span> i = indexFor(e.hash, table.length);<span class="comment">//获取hash值对应的坐标index</span></span><br><span class="line"></span><br><span class="line">                Entry&lt;K,V&gt; prev = table[i];<span class="comment">//根据坐标获取条目prev</span></span><br><span class="line">                Entry&lt;K,V&gt; p = prev;</span><br><span class="line">                <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123;<span class="comment">//循环遍历坐标对应的entry链表</span></span><br><span class="line">                    Entry&lt;K,V&gt; <span class="keyword">next</span> = p.<span class="keyword">next</span>;</span><br><span class="line">                    <span class="keyword">if</span> (p == e) &#123;<span class="comment">//找到链表中的此对象，修正链表</span></span><br><span class="line">                        <span class="keyword">if</span> (prev == e)</span><br><span class="line">                            table[i] = <span class="keyword">next</span>;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            prev.<span class="keyword">next</span> = <span class="keyword">next</span>;</span><br><span class="line">                        <span class="comment">// Must not null out e.next;</span></span><br><span class="line">                        <span class="comment">// stale entries may be in use by a HashIterator</span></span><br><span class="line">                        e.value = <span class="keyword">null</span>; <span class="comment">// Help GC 回收强引用的value</span></span><br><span class="line">                        <span class="keyword">size</span>--;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    prev = p;</span><br><span class="line">                    p = <span class="keyword">next</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V put(K key, V value) &#123;</span><br><span class="line">        Object k = maskNull(key);</span><br><span class="line">        <span class="keyword">int</span> h = hash(k);</span><br><span class="line">        Entry&lt;K,V&gt;[] tab = getTable();</span><br><span class="line">        <span class="keyword">int</span> i = indexFor(h, tab.length);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = tab[i]; e != <span class="keyword">null</span>; e = e.<span class="keyword">next</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (h == e.hash &amp;&amp; eq(k, e.get())) &#123;</span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (value != oldValue)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        modCount++;</span><br><span class="line">        Entry&lt;K,V&gt; e = tab[i];</span><br><span class="line">        tab[i] = <span class="keyword">new</span> Entry&lt;&gt;(k, value, queue, h, e);</span><br><span class="line">        <span class="keyword">if</span> (++<span class="keyword">size</span> &gt;= threshold)</span><br><span class="line">            resize(tab.length * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> WeakReference&lt;T&gt; <span class="keyword">extends</span> Reference&lt;T&gt; &#123;<span class="comment">//弱引用接口</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> WeakReference(T referent) &#123;</span><br><span class="line">        <span class="keyword">super</span>(referent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> WeakReference(T referent, ReferenceQueue&lt;? <span class="keyword">super</span> T&gt; q) &#123;</span><br><span class="line">        <span class="keyword">super</span>(referent, q);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第八节-LinkedHashMap"><a href="#第八节-LinkedHashMap" class="headerlink" title="第八节 LinkedHashMap"></a><strong>第八节 LinkedHashMap</strong></h2><p>&emsp;&emsp;链接散列映射，采用访问顺序，而不是插入顺序，对映射条目进行迭代。每次调用get或put，受到影响的条目会从当前位置删除，放到条目链表的尾部，注意只是链表的位置而非散列表的桶。</p>
<p>&emsp;&emsp;为什么访问顺序会在某些场景下很重要？访问顺序对于实现高速缓存的应用场景下遵守的最近最少使用很重要，如频繁访问的元素放在内存，很少访问的元素放到数据库。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashMap&lt;K</span>,<span class="title">V&gt;</span> <span class="keyword">extends</span> <span class="title">HashMap&lt;K</span>,<span class="title">V&gt;</span></span></span><br><span class="line"><span class="class">    <span class="title">implements</span> <span class="title">Map&lt;K</span>,<span class="title">V&gt;</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    static <span class="class"><span class="keyword">class</span> <span class="title">Entry&lt;K</span>,<span class="title">V&gt;</span> <span class="keyword">extends</span> <span class="title">HashMap</span>.<span class="title">Node&lt;K</span>,<span class="title">V&gt;</span> </span>&#123;</span><br><span class="line">        <span class="type">Entry</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; before, after;</span><br><span class="line">        <span class="type">Entry</span>(int hash, <span class="type">K</span> key, <span class="type">V</span> value, <span class="type">Node</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; next) &#123;</span><br><span class="line">            <span class="keyword">super</span>(hash, key, value, next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    transient <span class="type">LinkedHashMap</span>.<span class="type">Entry</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; head;</span><br><span class="line">    transient <span class="type">LinkedHashMap</span>.<span class="type">Entry</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; tail;</span><br><span class="line">    <span class="keyword">final</span> boolean accessOrder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> boolean removeEldestEntry(<span class="type">Map</span>.<span class="type">Entry</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; eldest) &#123;<span class="comment">//当返回true时，删除eldest条目，添加一个新条目，</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//return size() &gt; x; 覆盖此方法实现自动定义大小，当条目数达到时自动删除元素。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第九节-EnumMap"><a href="#第九节-EnumMap" class="headerlink" title="第九节 EnumMap"></a><strong>第九节 EnumMap</strong></h2><p>&emsp;&emsp;枚举映射即一个键类型为枚举类型的映射，其由一个值数组来实现。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">EnumMap&lt;K</span> <span class="keyword">extends</span> <span class="title">Enum&lt;K&gt;</span>, <span class="title">V&gt;</span> <span class="keyword">extends</span> <span class="title">AbstractMap&lt;K</span>, <span class="title">V&gt;</span></span></span><br><span class="line"><span class="class">    <span class="title">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Cloneable</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Class</span>&lt;<span class="type">K</span>&gt; keyType;<span class="comment">//键对应枚举类型</span></span><br><span class="line">    <span class="keyword">private</span> transient <span class="type">K</span>[] keyUniverse;<span class="comment">//键集合</span></span><br><span class="line">    <span class="keyword">private</span> transient <span class="type">Object</span>[] vals;<span class="comment">//值集合</span></span><br><span class="line">    <span class="keyword">private</span> transient int size = <span class="number">0</span>;<span class="comment">//条目数目</span></span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> <span class="type">Object</span> <span class="type">NULL</span> = <span class="keyword">new</span> <span class="type">Object</span>() &#123;</span><br><span class="line">        public int hashCode() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public <span class="type">String</span> toString() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"java.util.EnumMap.NULL"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    public <span class="type">EnumMap</span>(<span class="type">Class</span>&lt;<span class="type">K</span>&gt; keyType) &#123;</span><br><span class="line">        <span class="keyword">this</span>.keyType = keyType;</span><br><span class="line">        keyUniverse = getKeyUniverse(keyType);</span><br><span class="line">        vals = <span class="keyword">new</span> <span class="type">Object</span>[keyUniverse.length];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第十节-IdentityHashMap"><a href="#第十节-IdentityHashMap" class="headerlink" title="第十节 IdentityHashMap"></a><strong>第十节 IdentityHashMap</strong></h2><p>&emsp;&emsp;表示散列映射，键的散列值并不是用hashcode函数来计算的，而是System.identityHashCode()。且比较两个对象时，IdentityHashMap通过==比较而不是equals。</p>
<p>&emsp;&emsp;扩展：<a href="../2018123101.html" title="Title">equals和hashCode异同</a></p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class IdentityHashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt;</span><br><span class="line">    implements Map&lt;K,V&gt;, java.io.Serializable, Cloneable&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">Object</span>[] table; <span class="comment">// non-private to simplify nested class access</span></span><br><span class="line">    <span class="built_in">int</span> <span class="built_in">size</span>;</span><br><span class="line">    <span class="keyword">transient</span> <span class="built_in">int</span> modCount;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">Object</span> NULL_KEY = <span class="keyword">new</span> <span class="keyword">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> hash(<span class="keyword">Object</span> x, <span class="built_in">int</span> length) &#123;<span class="comment">//Object.hashCode方法根据对象的内存地址来计算散列码</span></span><br><span class="line">        <span class="built_in">int</span> h = System.identityHashCode(x);</span><br><span class="line">        <span class="comment">// Multiply by -127, and left-shift to use least bit as part of hash</span></span><br><span class="line">        <span class="keyword">return</span> ((h &lt;&lt; <span class="number">1</span>) - (h &lt;&lt; <span class="number">8</span>)) &amp; (length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> hash(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;<span class="comment">//HashMap的hash函数</span></span><br><span class="line">        <span class="built_in">int</span> h;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">key</span> == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = <span class="built_in">key</span>.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第十一节-Hashtable"><a href="#第十一节-Hashtable" class="headerlink" title="第十一节 Hashtable"></a><strong>第十一节 Hashtable</strong></h2><p>&emsp;&emsp;Hashtable和HashMap类作用一致，实现相同的接口，类似Vector，Hashtable的方法也都通过synchronized锁同步。</p>
<p>&emsp;&emsp;Hashtable对部分方法加了synchronized，来保证线程安全。根据源码可知Hashtable的键值都不允许为空</p>
<p>&emsp;&emsp;对同步没有要求就使用HashMap，单线程环境下效率很高，若需要并发特性则使用ConcurrentHashMap，而不要使用Hashtable，虽然其保证了一定的线程安全，但效率并不高。</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> Hashtable&lt;K,V&gt;</span><br><span class="line">    <span class="keyword">extends</span> Dictionary&lt;K,V&gt;</span><br><span class="line">    implements Map&lt;K,V&gt;, Cloneable, java.io.Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> transient <span class="built_in">Entry</span>&lt;?,?&gt;[] table;</span><br><span class="line">    <span class="keyword">private</span> transient <span class="built_in">int</span> <span class="built_in">count</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> threshold;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> loadFactor;</span><br><span class="line">    <span class="keyword">private</span> transient <span class="built_in">int</span> modCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> synchronized V put(K key, V <span class="keyword">value</span>) &#123;</span><br><span class="line">        // Make sure the <span class="keyword">value</span> is not null</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">value</span> == null) &#123;</span><br><span class="line">            throw new NullPointerException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Makes sure the key is not already <span class="keyword">in</span> the hashtable.</span><br><span class="line">        <span class="built_in">Entry</span>&lt;?,?&gt; tab[] = table;</span><br><span class="line">        <span class="built_in">int</span> hash = key.hashCode();</span><br><span class="line">        <span class="built_in">int</span> <span class="built_in">index</span> = (hash &amp; x7FFFFFFF) % tab.length;</span><br><span class="line">        @SuppressWarnings(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="built_in">Entry</span>&lt;K,V&gt; <span class="built_in">entry</span> = (<span class="built_in">Entry</span>&lt;K,V&gt;)tab[<span class="built_in">index</span>];</span><br><span class="line">        for(; <span class="built_in">entry</span> <span class="comment">!= null ; entry = entry.next) &#123;</span></span><br><span class="line">            <span class="keyword">if</span> ((<span class="built_in">entry</span>.hash == hash) &amp;&amp; <span class="built_in">entry</span>.key.equals(key)) &#123;</span><br><span class="line">                V old = <span class="built_in">entry</span>.<span class="keyword">value</span>;</span><br><span class="line">                <span class="built_in">entry</span>.<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">                <span class="keyword">return</span> old;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        addEntry(hash, key, <span class="keyword">value</span>, <span class="built_in">index</span>);</span><br><span class="line">        <span class="keyword">return</span> null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="属性映射"><a href="#属性映射" class="headerlink" title="属性映射"></a><strong>属性映射</strong></h3><p>&emsp;&emsp;Properties，其特性：键值都是字符串，表可以保存在文件中也可以从文件加载，使用一个默认辅助表</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span></span><br><span class="line">class Properties extends Hashtable&lt;<span class="keyword">Object</span>,<span class="keyword">Object</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">protected</span> Properties defaults;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> ConcurrentHashMap&lt;<span class="keyword">Object</span>, <span class="keyword">Object</span>&gt; <span class="built_in">map</span>;</span><br><span class="line">    <span class="keyword">public</span> Properties() &#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Properties(<span class="built_in">int</span> initialCapacity) &#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>, initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Properties(Properties defaults, <span class="built_in">int</span> initialCapacity) &#123;</span><br><span class="line">        <span class="comment">// use package-private constructor to</span></span><br><span class="line">        <span class="comment">// initialize unused fields with dummy values</span></span><br><span class="line">        <span class="keyword">super</span>((Void) <span class="keyword">null</span>);</span><br><span class="line">        <span class="built_in">map</span> = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(initialCapacity);</span><br><span class="line">        <span class="keyword">this</span>.defaults = defaults;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getProperty(<span class="keyword">String</span> <span class="built_in">key</span>) &#123;<span class="comment">//获得键对应值，若映射不存在，则获取默认表中键对应值</span></span><br><span class="line">        <span class="keyword">Object</span> oval = <span class="built_in">map</span>.<span class="built_in">get</span>(<span class="built_in">key</span>);</span><br><span class="line">        <span class="keyword">String</span> sval = (oval <span class="keyword">instanceof</span> <span class="keyword">String</span>) ? (<span class="keyword">String</span>)oval : <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> ((sval == <span class="keyword">null</span>) &amp;&amp; (defaults != <span class="keyword">null</span>)) ? defaults.getProperty(<span class="built_in">key</span>) : sval;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> getProperty(<span class="keyword">String</span> <span class="built_in">key</span>, <span class="keyword">String</span> defaultValue) &#123;<span class="comment">//获得键对应值，若没找到则返回默认字符串</span></span><br><span class="line">        <span class="keyword">String</span> val = getProperty(<span class="built_in">key</span>);</span><br><span class="line">        <span class="keyword">return</span> (val == <span class="keyword">null</span>) ? defaultValue : val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> load(Reader reader) <span class="keyword">throws</span> IOException &#123;<span class="comment">//从Reader加载属性映射</span></span><br><span class="line">        Objects.requireNonNull(reader, <span class="string">"reader parameter is null"</span>);</span><br><span class="line">        load0(<span class="keyword">new</span> LineReader(reader));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> load(InputStream inStream) <span class="keyword">throws</span> IOException &#123;从流inStream加载属性映射</span><br><span class="line">        Objects.requireNonNull(inStream, <span class="string">"inStream parameter is null"</span>);</span><br><span class="line">        load0(<span class="keyword">new</span> LineReader(inStream));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> store(OutputStream out, <span class="keyword">String</span> comments) <span class="keyword">throws</span> IOException &#123;<span class="comment">//将属性映射存入流out</span></span><br><span class="line">        store0(<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(out, <span class="string">"8859_1"</span>)),</span><br><span class="line">               comments,</span><br><span class="line">               <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第十二节-ConcurrentHashMap"><a href="#第十二节-ConcurrentHashMap" class="headerlink" title="第十二节 ConcurrentHashMap"></a><strong>第十二节 ConcurrentHashMap</strong></h2><p>&emsp;&emsp;参考<a href="../2019082301.html" title="Title">ConcurrentHashMap的实现原理与使用</a>。</p>
<hr>
<p><em>参考博客和文章书籍等：</em></p>
<blockquote>
<p>《Java核心技术 卷Ⅰ》</p>
</blockquote>
<p><em>因博客主等未标明不可引用，若部分内容涉及侵权请及时告知，我会尽快修改和删除相关内容</em></p>

      
    </div>
    
    
    

    

    

    

    
      <div>
         ﻿<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      </div>
    


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/java/" rel="tag"># java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019041201.html" rel="next" title="Java集合(四) Set">
                <i class="fa fa-chevron-left"></i> Java集合(四) Set
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019041601.html" rel="prev" title="Java集合(六) Stack">
                Java集合(六) Stack <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/riho_yoshioka1.jpg"
                alt="沂水" />
            
              <p class="site-author-name" itemprop="name">沂水</p>
              <p class="site-description motion-element" itemprop="description">记录编程点滴，写点生活中的酸甜</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">161</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">73</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/LAILAIWA" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:linyishui168@outlook.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/linyishui618" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/5340162234" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo.com"></i>Weibo</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Java集合-五-Map"><span class="nav-number">1.</span> <span class="nav-text">Java集合(五) Map</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第一节-映射"><span class="nav-number">1.1.</span> <span class="nav-text">第一节 映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二节-Map"><span class="nav-number">1.2.</span> <span class="nav-text">第二节 Map</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Map接口源码"><span class="nav-number">1.2.1.</span> <span class="nav-text">Map接口源码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#映射视图"><span class="nav-number">1.2.2.</span> <span class="nav-text">映射视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三节-HashMap"><span class="nav-number">1.3.</span> <span class="nav-text">第三节 HashMap</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用"><span class="nav-number">1.3.1.</span> <span class="nav-text">使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#怎么get"><span class="nav-number">1.3.2.</span> <span class="nav-text">怎么get</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#怎么计算哈希码"><span class="nav-number">1.3.3.</span> <span class="nav-text">怎么计算哈希码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#怎么put"><span class="nav-number">1.3.4.</span> <span class="nav-text">怎么put</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#怎么扩容"><span class="nav-number">1.3.5.</span> <span class="nav-text">怎么扩容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#旧版本的问题"><span class="nav-number">1.3.6.</span> <span class="nav-text">旧版本的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第四节-SortedMap"><span class="nav-number">1.4.</span> <span class="nav-text">第四节 SortedMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第五节-NavigableMap"><span class="nav-number">1.5.</span> <span class="nav-text">第五节 NavigableMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第六节-TreeMap"><span class="nav-number">1.6.</span> <span class="nav-text">第六节 TreeMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第七节-WeakHashMap"><span class="nav-number">1.7.</span> <span class="nav-text">第七节 WeakHashMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第八节-LinkedHashMap"><span class="nav-number">1.8.</span> <span class="nav-text">第八节 LinkedHashMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第九节-EnumMap"><span class="nav-number">1.9.</span> <span class="nav-text">第九节 EnumMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第十节-IdentityHashMap"><span class="nav-number">1.10.</span> <span class="nav-text">第十节 IdentityHashMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第十一节-Hashtable"><span class="nav-number">1.11.</span> <span class="nav-text">第十一节 Hashtable</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#属性映射"><span class="nav-number">1.11.1.</span> <span class="nav-text">属性映射</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第十二节-ConcurrentHashMap"><span class="nav-number">1.12.</span> <span class="nav-text">第十二节 ConcurrentHashMap</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        ﻿<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沂水</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

<!-- 
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>

-->



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
   <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":true,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":125,"height":250},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script>

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

  
</body>
</html>
