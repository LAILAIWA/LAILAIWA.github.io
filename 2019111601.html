<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/gamepad%20playstation.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Dig%20Dug.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/gamepad%20playstation.png">
  <link rel="mask-icon" href="/images/gamepad%20playstation.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic%7CMa+Shan+Zheng:300,300italic,400,400italic,700,700italic%7CNoto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css" integrity="sha256-no0c5ccDODBwp+9hSmV5VvPpKwHCpbVzXHexIkupM6U=" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js" integrity="sha256-a5YRB27CcBwBFcT5EF/f3E4vzIqyHrSR878nseNYw64=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"linyishui.top","root":"/","images":"/images","scheme":"Pisces","version":"8.6.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="The OAuth 2.0 Protocol Framework文档翻译，内容包括：引文（符号规范、技术术语、概述、访问许可），Client Profiles（Web Server、User-Agent、原生程序、自治态），客户端私有证书（客户端密码证书、客户端断言证书），获得终端用户授权（授权请求、授权响应、错误响应），获取访问令牌（访问许可类型、访问令牌响应、错误响应），访问受保护资源（访问令">
<meta property="og:type" content="article">
<meta property="og:title" content="OAuth2协议框架">
<meta property="og:url" content="http://linyishui.top/2019111601.html">
<meta property="og:site_name" content="俺的部落格">
<meta property="og:description" content="The OAuth 2.0 Protocol Framework文档翻译，内容包括：引文（符号规范、技术术语、概述、访问许可），Client Profiles（Web Server、User-Agent、原生程序、自治态），客户端私有证书（客户端密码证书、客户端断言证书），获得终端用户授权（授权请求、授权响应、错误响应），获取访问令牌（访问许可类型、访问令牌响应、错误响应），访问受保护资源（访问令">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-11-16T10:30:59.000Z">
<meta property="article:modified_time" content="2019-12-25T06:31:00.000Z">
<meta property="article:author" content="Lys">
<meta property="article:tag" content="oauth2">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://linyishui.top/2019111601.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://linyishui.top/2019111601.html","path":"2019111601.html","title":"OAuth2协议框架"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>OAuth2协议框架 | 俺的部落格</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="俺的部落格" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">俺的部落格</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">俺寻思俺需要记点东西</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
        <li class="menu-item menu-item-tools"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>工具</a></li>
        <li class="menu-item menu-item-books"><a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i>书架</a></li>
        <li class="menu-item menu-item-movies"><a href="/movies/" rel="section"><i class="fa fa-video fa-fw"></i>剧院</a></li>
        <li class="menu-item menu-item-games"><a href="/games/" rel="section"><i class="fa fa-gamepad fa-fw"></i>游戏</a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#OAuth2"><span class="nav-text">OAuth2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E8%8A%82-%E5%BC%95%E6%96%87"><span class="nav-text">第一节 引文</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E7%AC%A6%E5%8F%B7%E8%A7%84%E8%8C%83"><span class="nav-text">1.1 符号规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E6%8A%80%E6%9C%AF%E6%9C%AF%E8%AF%AD"><span class="nav-text">1.2 技术术语</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E6%A6%82%E8%BF%B0"><span class="nav-text">1.3 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E8%AE%BF%E9%97%AE%E8%AE%B8%E5%8F%AF-Access-Grants"><span class="nav-text">1.4 访问许可 Access Grants</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-1-%E6%8E%88%E6%9D%83%E7%A0%81-Authorization-Code"><span class="nav-text">1.4.1 授权码 Authorization Code</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-2-%E8%B5%84%E6%BA%90%E6%8B%A5%E6%9C%89%E8%80%85%E5%AF%86%E7%A0%81%E8%AF%81%E4%B9%A6-Resource-Owner-Password-Credentials"><span class="nav-text">1.4.2 资源拥有者密码证书 Resource Owner Password Credentials</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-3-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%A7%81%E6%9C%89%E8%AF%81%E4%B9%A6-Client-Credentials"><span class="nav-text">1.4.3 客户端私有证书 Client Credentials</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-4-%E5%88%B7%E6%96%B0%E4%BB%A4%E7%89%8C-Refresh-Token"><span class="nav-text">1.4.4 刷新令牌 Refresh Token</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-5-%E6%96%AD%E8%A8%80-Assertion"><span class="nav-text">1.4.5 断言 Assertion</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-Client-Profiles"><span class="nav-text">第二节 Client Profiles</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%9C%8D%E5%8A%A1%E7%AB%AF-Web-Server"><span class="nav-text">2.1 服务端 Web Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E7%94%A8%E6%88%B7%E4%BB%A3%E7%90%86-User-Agent"><span class="nav-text">2.2 用户代理 User-Agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%8E%9F%E7%94%9F%E7%A8%8B%E5%BA%8F-Native-Application"><span class="nav-text">2.3 原生程序 Native Application</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%87%AA%E6%B2%BB%E6%80%81-Autonomous"><span class="nav-text">2.4 自治态 Autonomous</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E8%8A%82-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%A7%81%E6%9C%89%E8%AF%81%E4%B9%A6-Client-Credentials"><span class="nav-text">第三节 客户端私有证书 Client Credentials</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AF%86%E7%A0%81%E8%AF%81%E4%B9%A6-Client-Password-Credentials"><span class="nav-text">3.1 客户端密码证书 Client Password Credentials</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%96%AD%E8%A8%80%E8%AF%81%E4%B9%A6-Client-Assertion-Credentials"><span class="nav-text">3.2 客户端断言证书 Client Assertion Credentials</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E8%8A%82-%E8%8E%B7%E5%BE%97%E7%BB%88%E7%AB%AF%E7%94%A8%E6%88%B7%E6%8E%88%E6%9D%83-Obtaining-End-User-Authorization"><span class="nav-text">第四节 获得终端用户授权 Obtaining End-User Authorization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E6%8E%88%E6%9D%83%E8%AF%B7%E6%B1%82-Authorization-Request"><span class="nav-text">4.1 授权请求 Authorization Request</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%8E%88%E6%9D%83%E5%93%8D%E5%BA%94-Authorization-Response"><span class="nav-text">4.2 授权响应 Authorization Response</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94-Error-Response"><span class="nav-text">4.3 错误响应 Error Response</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-%E9%94%99%E8%AF%AF%E7%A0%81-Error-Codes"><span class="nav-text">4.3.1 错误码 Error Codes</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E8%8A%82-%E8%8E%B7%E5%8F%96%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C"><span class="nav-text">第五节 获取访问令牌</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E8%AE%BF%E9%97%AE%E8%AE%B8%E5%8F%AF%E7%B1%BB%E5%9E%8B-Access-Grant-Types"><span class="nav-text">5.1 访问许可类型 Access Grant Types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-%E6%8E%88%E6%9D%83%E7%A0%81-Authorization-Code"><span class="nav-text">5.1.1 授权码 Authorization Code</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-%E8%B5%84%E6%BA%90%E6%8B%A5%E6%9C%89%E8%80%85%E5%AF%86%E7%A0%81%E8%AF%81%E4%B9%A6-Resource-Owner-Password-Credentials"><span class="nav-text">5.1.2 资源拥有者密码证书 Resource Owner Password Credentials</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-3-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%A7%81%E6%9C%89%E8%AF%81%E4%B9%A6-Client-Credentials"><span class="nav-text">5.1.3 客户端私有证书 Client Credentials</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-4-%E5%88%B7%E6%96%B0%E4%BB%A4%E7%89%8C-Refresh-Token"><span class="nav-text">5.1.4 刷新令牌 Refresh Token</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-5-%E6%96%AD%E8%A8%80-Assertion"><span class="nav-text">5.1.5 断言 Assertion</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C%E5%93%8D%E5%BA%94-Access-Token-Response"><span class="nav-text">5.2 访问令牌响应 Access Token Response</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94-Error-Response"><span class="nav-text">5.3 错误响应 Error Response</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-1-%E9%94%99%E8%AF%AF%E7%A0%81-Error-Codes"><span class="nav-text">5.3.1 错误码 Error Codes</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E8%8A%82-%E8%AE%BF%E9%97%AE%E5%8F%97%E4%BF%9D%E6%8A%A4%E8%B5%84%E6%BA%90-Accessing-a-Protected-Resource"><span class="nav-text">第六节 访问受保护资源 Accessing a Protected Resource</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C%E7%B1%BB%E5%9E%8B-Access-Token-Types"><span class="nav-text">6.1 访问令牌类型 Access Token Types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-WWW-Authenticate%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8%E5%AD%97%E6%AE%B5-The-WWW-Authenticate-Response-Header-Field"><span class="nav-text">6.2 WWW-Authenticate响应头部字段 The WWW-Authenticate Response Header Field</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-%E9%94%99%E8%AF%AF%E7%A0%81-Error-Codes"><span class="nav-text">6.2.1 错误码 Error Codes</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E8%8A%82-%E6%89%A9%E5%B1%95-Extensibility"><span class="nav-text">第七节 扩展 Extensibility</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%AE%9A%E4%B9%89%E6%96%B0%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%81%E4%B9%A6%E7%B1%BB%E5%9E%8B-Defining-New-Client-Credentials-Types"><span class="nav-text">7.1 定义新的客户端证书类型 Defining New Client Credentials Types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E5%AE%9A%E4%B9%89%E6%96%B0%E7%9A%84Endpoint%E5%8F%82%E6%95%B0-Defining-New-Endpoint-Parameters"><span class="nav-text">7.2 定义新的Endpoint参数 Defining New Endpoint Parameters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E5%AE%9A%E4%B9%89%E6%96%B0%E7%9A%84%E5%A4%B4%E9%83%A8%E5%AD%97%E6%AE%B5%E5%8F%82%E6%95%B0-Defining-New-Header-Field-Parameters"><span class="nav-text">7.3 定义新的头部字段参数 Defining New Header Field Parameters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-%E5%AE%9A%E4%B9%89%E6%96%B0%E7%9A%84%E8%AE%BF%E9%97%AE%E8%AE%B8%E5%8F%AF%E7%B1%BB%E5%9E%8B-Defining-New-Access-Grant-Types"><span class="nav-text">7.4 定义新的访问许可类型 Defining New Access Grant Types</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AB%E8%8A%82-%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91-Security-Considerations"><span class="nav-text">第八节 安全考虑 Security Considerations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B9%9D%E8%8A%82-IANA%E4%BA%8B%E9%A1%B9-IANA-Considerations"><span class="nav-text">第九节 IANA事项 IANA Considerations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-OAuth%E5%8F%82%E6%95%B0%E6%B3%A8%E5%86%8C%E8%A1%A8-The-OAuth-Parameters-Registry"><span class="nav-text">9.1 OAuth参数注册表 The OAuth Parameters Registry</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-1-1-%E6%B3%A8%E5%86%8C%E6%A8%A1%E6%9D%BF-Registration-Template"><span class="nav-text">9.1.1 注册模板 Registration Template</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lys"
      src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/IMG_0759.JPG">
  <p class="site-author-name" itemprop="name">Lys</p>
  <div class="site-description" itemprop="description">记录编程点滴，写点生活中的酸甜</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">312</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">104</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/LAILAIWA" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LAILAIWA" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:linyishui168@outlook.com" title="E-Mail → mailto:linyishui168@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5340162234" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5340162234" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/linyishui618" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;linyishui618" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/13018339/lin-yishui" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;13018339&#x2F;lin-yishui" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/linyishui618" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;linyishui618" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="far fa-smile-wink fa-fw"></i>
      个人
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://music.163.com/#/user/home?id=68425607" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;68425607" rel="noopener" target="_blank">网易云音乐</a>
        </li>
    </ul>
  </div>

          </div>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/LAILAIWA" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linyishui.top/2019111601.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/IMG_0759.JPG">
      <meta itemprop="name" content="Lys">
      <meta itemprop="description" content="记录编程点滴，写点生活中的酸甜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="俺的部落格">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OAuth2协议框架
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-11-16 18:30:59" itemprop="dateCreated datePublished" datetime="2019-11-16T18:30:59+08:00">2019-11-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-12-25 14:31:00" itemprop="dateModified" datetime="2019-12-25T14:31:00+08:00">2019-12-25</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/" itemprop="url" rel="index"><span itemprop="name">技术文档</span></a>
        </span>
    </span>

  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>27k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>25 分钟</span>
    </span>
</div>

            <div class="post-description">The OAuth 2.0 Protocol Framework文档翻译，内容包括：引文（符号规范、技术术语、概述、访问许可），Client Profiles（Web Server、User-Agent、原生程序、自治态），客户端私有证书（客户端密码证书、客户端断言证书），获得终端用户授权（授权请求、授权响应、错误响应），获取访问令牌（访问许可类型、访问令牌响应、错误响应），访问受保护资源（访问令牌类型、WWW-Authenticate响应头部字段），扩展（定义新的客户端证书类型、定义新的Endpoint参数、定义新的头部字段参数、定义新的访问许可类型），安全考虑，IANA事项等。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="OAuth2"><a href="#OAuth2" class="headerlink" title="OAuth2"></a><strong>OAuth2</strong></h1><h2 id="第一节-引文"><a href="#第一节-引文" class="headerlink" title="第一节 引文"></a><strong>第一节 引文</strong></h2><p>&emsp;&emsp;随着分布式Web服务和云计算的流行，一些第三方应用常常要访问一些服务器托管资源。这些资源通常都是受保护的，需要请求者携带资源拥有者允许的私有证书进行身份验证。</p>
<p>&emsp;&emsp;在传统的基于客户端-服务器的身份验证模型中，客户端为了访问服务器的受保护资源，通过私有证书来做身份验证。而现在这个私有证书往往要同时提供给第三方，这就带来了很多的问题，也存在着很多的局限性。</p>
<blockquote>
<p><strong>传统身份验证模型的问题：</strong></p>
<ul>
<li>第三方应用需要用明文保存私有证书，以便持续的使用，这种对称的密码验证方式会带来安全隐患。</li>
<li>第三方应用对受保护资源获得了过多的使用权限，但资源拥有者却没办法来限制到具体的资源子集，比如限制权限的时间，或是限制支持的访问方式等。</li>
<li>资源拥有者无法在不影响第三方应用的前提下撤销某个第三方的访问权限，只能通过修改密码的方法来回收权限。</li>
</ul>
</blockquote>
<p>&emsp;&emsp;OAuth通过将客户端和资源拥有者的<strong>角色分离</strong>来解决这些问题，在OAuth中，客户端提出请求访问由资源拥有者控制，并由资源服务器托管的资源，然后会得到与资源拥有者不同的一套私有证书。客户端不会像以前那样直接使用资源拥有者的证书来访问，而是得到了一个<strong>访问令牌</strong>（access token）：一个代表着某一特定作用域、持续时间和其它属性的字符串。</p>
<p>&emsp;&emsp;访问令牌由<strong>授权服务器</strong>在资源拥有者的授意下分发给第三方客户端，客户端携带访问令牌访问由<strong>资源服务器</strong>托管的受保护资源。</p>
<h3 id="1-1-符号规范"><a href="#1-1-符号规范" class="headerlink" title="1.1 符号规范"></a><strong>1.1 符号规范</strong></h3><p>&emsp;&emsp;这篇文档中的关键词“必须”、“一定不能”、“要求”、“会”、“不会”、“应该”、“不应该”、“建议”、“可以”、“可选的”，遵从<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#RFC2119" title="Title">[RFC2119]</a>中的解释。</p>
<p>&emsp;&emsp;这篇文档使用出自<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#I-D.ietf-httpbis-p1-messaging" title="Title">[I-D.ietf-httpbis-p1-messaging]</a>的增强型巴科斯范式（ABNF）标记法。另外，介绍一些规则定义的出处：URI-Reference出自<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#RFC3986" title="Title">[RFC3986]</a>；OWS、RWS和quoted-string出自<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#I-D.ietf-httpbis-p1-messaging" title="Title">[I-D.ietf-httpbis-p1-messaging]</a>。</p>
<p>&emsp;&emsp;除非特别提到，否则所有协议参数的名字和值都是大小写敏感的。</p>
<h3 id="1-2-技术术语"><a href="#1-2-技术术语" class="headerlink" title="1.2 技术术语"></a><strong>1.2 技术术语</strong></h3><blockquote>
<ul>
<li>受保护资源（protected resource）：能够使用OAuth请求获取的访问限制性资源。</li>
<li>资源服务器（resource server）：能够接受和响应受保护资源请求的服务器。</li>
<li>客户端（client）：获取授权和发送受保护资源请求的应用。</li>
<li>资源拥有者（resource owner）：能够对受保护资源进行访问许可控制的实体。</li>
<li>终端用户（end-user）：起到资源拥有者角色的用户。</li>
<li>令牌（token）：分发给客户端的代表访问授权的字符串。通常这个字符串对客户端来说是不透明的。令牌代表资源拥有者许可的访问作用域和持续时间，并由资源服务器和授权服务器强制保证。这个令牌可以代表一个标识符，用于检索授权信息，或以一种可验证的方式自包含授权信息（即一个包含数据和签名的令牌字符串）。令牌可能只代表纯粹的访问能力。而为了让客户端使用令牌，也可能需要一些多余的特定验证证书。</li>
<li>访问令牌（access token）：被客户端用来代表资源拥有者发送验证请求的令牌。</li>
<li>刷新令牌（refresh token）：被客户端用来获取新的访问令牌的令牌，而不用资源拥有者的参与。</li>
<li>授权码（authorization code）：一个短期令牌，代表终端用户的授权。授权码用于获取一个访问令牌和一个刷新令牌。</li>
<li>访问许可（access grant）：用于描述中间形式的私有证书（如终端用户的密码或授权码）的一个通用词汇，代表资源拥有者的授权。客户端使用访问许可来获取访问令牌。通过将各种形式的访问许可都交换成访问令牌，资源服务器只需要支持一种验证机制。</li>
<li>授权服务器（authorization server）：能够成功验证资源拥有者和获取授权，并在此之后分发令牌的服务器。授权服务器可以和资源服务器是同一个服务器，也可以是不同的实体。单独一个授权服务器可以为多个资源服务器分发令牌。</li>
<li>终端用户授权端点（end-user authorization endpoint）：授权服务器上能够验证终端用户并获取授权的HTTP endpoint。终端用户授权endpoint在第4节详细描述。</li>
<li>令牌端点（token endpoint）：授权服务器上能够分发令牌和刷新过期令牌的HTTP endpoint。令牌endpoint在第5节详细描述。</li>
<li>客户端标识符（client identifier）：分发给客户端的唯一标识，用于客户端向授权服务器标识自己。客户端标识符可以有一个对应的密钥。客户端标识符在第3节详细描述。</li>
</ul>
</blockquote>
<h3 id="1-3-概述"><a href="#1-3-概述" class="headerlink" title="1.3 概述"></a><strong>1.3 概述</strong></h3><p>&emsp;&emsp;OAuth为客户端提供了一种代表资源拥有者访问受保护资源的方法。在客户端访问受保护资源之前，它必须先从资源拥有者获取授权 （访问许可，access grant），然后用访问许可交换访问令牌（access token，代表许可的作用域、持续时间和其它属性）。客户端通过向资源服务器出示访问令牌来访问受保护资源。</p>
<p>&emsp;&emsp;访问令牌提供了一个抽象层，将不同的授权结构（如用户名密码、断言）替换成资源服务器可以理解的单一令牌。这种抽象使得分发短期有效的访问令牌成为可能，也使得资源服务器不必理解多种多样的授权机制。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+--------+                               +---------------+</span><br><span class="line">|<span class="string">        </span>|<span class="string">--(A)- Authorization Request -&gt;</span>|<span class="string">   Resource    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Owner     </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(B)----- Access Grant -------</span>|<span class="string">               </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">           Access Grant &amp;      +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|<span class="string">--(C)--- Client Credentials --&gt;</span>|<span class="string"> Authorization </span>|</span><br><span class="line">|<span class="string"> Client </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(D)----- Access Token -------</span>|<span class="string">               </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|<span class="string">--(E)----- Access Token ------&gt;</span>|<span class="string">    Resource   </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(F)--- Protected Resource ---</span>|<span class="string">               </span>|</span><br><span class="line">+--------+                               +---------------+</span><br><span class="line">图1: 抽象的协议流程</span><br></pre></td></tr></table></figure>

<blockquote>
<p>图1所示的抽象流程协议的总体架构，它包含下列步骤：</p>
<p>&emsp;(A) 客户端从资源拥有者那里请求授权。授权请求能够直接发送给资源拥有者，或者间接地通过授权服务器这样的中介，而后者更为可取。</p>
<p>&emsp;(B) 客户端收到一个访问许可，它代表由资源服务器提供的授权。</p>
<p>&emsp;(C) 客户端使用它自己的私有证书到授权服务器上验证，并出示访问许可，来请求一个访问令牌。</p>
<p>&emsp;(D) 授权服务器验证客户端私有证书和访问许可的有效性，如果验证通过则分发一个访问令牌。</p>
<p>&emsp;(E) 客户端通过出示访问令牌向资源服务器请求受保护资源。</p>
<p>&emsp;(F) 资源服务器验证访问令牌的有效性，如果验证通过则响应这个资源请求。</p>
</blockquote>
<h3 id="1-4-访问许可-Access-Grants"><a href="#1-4-访问许可-Access-Grants" class="headerlink" title="1.4 访问许可 Access Grants"></a><strong>1.4 访问许可 Access Grants</strong></h3><p>&emsp;&emsp;访问许可代表资源拥有者提供的授权。访问许可的类型取决于客户端使用的获取方式和授权服务器所支持的方式。</p>
<h4 id="1-4-1-授权码-Authorization-Code"><a href="#1-4-1-授权码-Authorization-Code" class="headerlink" title="1.4.1 授权码 Authorization Code"></a><strong>1.4.1 授权码 Authorization Code</strong></h4><p>&emsp;&emsp;授权码是通过将终端用户引导到授权服务器而获得的一种访问许可。授权服务器验证终端用户，获得授权，然后向客户端分发一个授权码。因为终端用户只在授权服务器上进行验证，所以终端用户的密码从来不用分享给客户端。</p>
<p>&emsp;&emsp;当客户端通过一个user-agent同终端用户进行交互的时候，授权码这种访问许可是很合适的。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+----------+</span><br><span class="line">|<span class="string">          </span>|</span><br><span class="line">|<span class="string"> End-User </span>|</span><br><span class="line">|<span class="string">          </span>|</span><br><span class="line">+----------+</span><br><span class="line">     ^</span><br><span class="line">     |<span class="string"></span></span><br><span class="line"><span class="string">    (B)</span></span><br><span class="line"><span class="string">+----</span>|<span class="string">-----+        Client Identifier     +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">         -+--(A)--- &amp; Redirect URI -----&gt;</span>|<span class="string">               </span>|</span><br><span class="line">|<span class="string">  User-   </span>|<span class="string">                              </span>|<span class="string"> Authorization </span>|</span><br><span class="line">|<span class="string">  Agent  -</span>|<span class="string">--(B)-- User authenticates --&gt;</span>|<span class="string">     Server    </span>|</span><br><span class="line">|<span class="string">          </span>|<span class="string">                              </span>|<span class="string">               </span>|</span><br><span class="line">|<span class="string">         -+--(C)-- Authorization Code --&lt;</span>|<span class="string">               </span>|</span><br><span class="line">+-|<span class="string">----</span>|<span class="string">---+                              +---------------+</span></span><br><span class="line"><span class="string"> (A)  (C)</span></span><br><span class="line"><span class="string">  </span>|<span class="string">    </span>|</span><br><span class="line">  ^    v</span><br><span class="line">+---------+</span><br><span class="line">|<span class="string">         </span>|</span><br><span class="line">|<span class="string">  Client </span>|</span><br><span class="line">|<span class="string">         </span>|</span><br><span class="line">+---------+</span><br><span class="line">图2: 获取授权码</span><br></pre></td></tr></table></figure>

<blockquote>
<p>图2所示的授权码获取流程包含下列步骤：</p>
<p>&emsp;(A) 客户端通过将终端用户的user-agent引导到授权服务器的终端用户授权端点来发起这个流程。客户端传入标识符、请求作用域、本地状态，和一个重定向URI（在访问被许可或被拒绝后授权服务器会重新将user-agent引导回这个URI）。</p>
<p>&emsp;(B) 授权服务器验证终端用户的身份（通过user-agent），并且确定终端用户是许可还是拒绝了客户端的访问请求。</p>
<p>&emsp;(C) 如果访问被许可，授权服务器会使用重定向URI将user-agent引导回客户端。授权服务器传回一个授权码给客户端，用于进一步获取访问令牌。</p>
</blockquote>
<p>&emsp;&emsp;一旦客户端获得了授权码，它会到授权服务器上去做验证（使用客户端私有证书）并出示授权码（访问许可），以借此请求一个访问令牌。</p>
<p>&emsp;&emsp;在客户端无法维护它自己的私有证书的情况下（如原生程序或用某种user-agent脚本实现的程序），授权服务器在(C)步直接给客户端分发一个访问令牌，而不再分发一个授权码。</p>
<p>&emsp;&emsp;获得授权码的过程在第4节详述。</p>
<h4 id="1-4-2-资源拥有者密码证书-Resource-Owner-Password-Credentials"><a href="#1-4-2-资源拥有者密码证书-Resource-Owner-Password-Credentials" class="headerlink" title="1.4.2 资源拥有者密码证书 Resource Owner Password Credentials"></a><strong>1.4.2 资源拥有者密码证书 Resource Owner Password Credentials</strong></h4><p>&emsp;&emsp;资源拥有者密码证书（例如用户名和密码）可以直接用作访问许可来获取访问令牌。这种私有证书只应该在以下两种情况下使用：当在资源拥有者和客户端之间有很强的信任关系的时候（例如，资源拥有者的计算机操作系统，或具有很高特权的程序），以及当其它访问许可类型（如授权码）不可用的时候。</p>
<p>&emsp;&emsp;即使这种许可类型需要客户端直接访问资源拥有者的私有证书，资源拥有者的私有证书也只是在一个请求中使用，并交换成访问令牌。与<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#RFC2617" title="Title">[RFC2617]</a>定义的HTTP Basic验证机制不同，这种许可类型不再需要客户端存储资源拥有者的私有证书以备日后使用。</p>
<p>&emsp;&emsp;在图3中，客户端直接从资源拥有者请求授权。当资源拥有者是一个终端用户时，客户端通常的做法是提示终端用户输入用户名和密码。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+--------+                               +----------+</span><br><span class="line">|<span class="string">        </span>|<span class="string">--(A)- Authorization Request -&gt;</span>|<span class="string"> Resource </span>|</span><br><span class="line">|<span class="string"> Client </span>|<span class="string">                               </span>|<span class="string">   Owner  </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(B)-- Username &amp; Password ---</span>|<span class="string">          </span>|</span><br><span class="line">+--------+                               +----------+</span><br><span class="line">图3: 获取资源拥有者密码证书</span><br></pre></td></tr></table></figure>

<h4 id="1-4-3-客户端私有证书-Client-Credentials"><a href="#1-4-3-客户端私有证书-Client-Credentials" class="headerlink" title="1.4.3 客户端私有证书 Client Credentials"></a><strong>1.4.3 客户端私有证书 Client Credentials</strong></h4><p>&emsp;&emsp;当授权作用域限制在客户端所控制的受保护资源或之前与授权服务器约定好的受保护资源时，客户端本身的私有证书可被用作访问许可。客户端私有证书用作访问许可的典型例子是，当客户端代表它自己执行操作时（客户端同时也是资源拥有者）。</p>
<h4 id="1-4-4-刷新令牌-Refresh-Token"><a href="#1-4-4-刷新令牌-Refresh-Token" class="headerlink" title="1.4.4 刷新令牌 Refresh Token"></a><strong>1.4.4 刷新令牌 Refresh Token</strong></h4><p>&emsp;&emsp;访问令牌的生命周期通常比资源拥有者授予的要短一些。当分发一个访问令牌时，授权服务器可以同时传回一个刷新令牌，在当前访问令牌超时后，客户端可以用这个刷新令牌重新获取一个访问令牌。当请求新的访问令牌时，刷新令牌担当起访问许可的角色。使用刷新令牌，不再需要再次与资源拥有者交互，也不需要存储原始的访问许可来获得访问令牌和刷新令牌。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  +--------+          Access Grant &amp;      +---------------+</span><br><span class="line">  |<span class="string">        </span>|<span class="string">--(A)-- Client Credentials --&gt;</span>|<span class="string"> Authorization </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">                              </span>|<span class="string">     Server    </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">&lt;-(B)---- Access Token -------</span>|<span class="string">               </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">         &amp; Refresh Token      +---------------+</span></span><br><span class="line"><span class="string">  </span>|<span class="string">        </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">                              +---------------+</span></span><br><span class="line"><span class="string">  </span>|<span class="string">        </span>|<span class="string">--(C)----- Access Token -----&gt;</span>|<span class="string">               </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">                              </span>|<span class="string">               </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">&lt;-(D)-- Protected Resource ---</span>|<span class="string">    Resource   </span>|</span><br><span class="line">  |<span class="string"> Client </span>|<span class="string">                              </span>|<span class="string">     Server    </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">--(E)----- Access Token -----&gt;</span>|<span class="string">               </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">                              </span>|<span class="string">               </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">&lt;-(F)-- Invalid Token Error --</span>|<span class="string">               </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">                              +---------------+</span></span><br><span class="line"><span class="string">  </span>|<span class="string">        </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">          Refresh Token &amp;     +---------------+</span></span><br><span class="line"><span class="string">  </span>|<span class="string">        </span>|<span class="string">--(G)-- Client Credentials --&gt;</span>|<span class="string"> Authorization </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">                              </span>|<span class="string">     Server    </span>|</span><br><span class="line">  |<span class="string">        </span>|<span class="string">&lt;-(H)----- Access Token ------</span>|<span class="string">               </span>|</span><br><span class="line">  +--------+     &amp; Optional Refresh Token +---------------+</span><br><span class="line"></span><br><span class="line">图4: 刷新访问令牌</span><br></pre></td></tr></table></figure>

<blockquote>
<p>图4所示的刷新令牌流程包含下列步骤：</p>
<p>&emsp;(A) 客户端通过使用它自己的私有证书在授权服务器上验证，并出示一个访问许可。</p>
<p>&emsp;(B) 授权服务器验证客户端私有证书和访问许可的有效性，如果通过则分发一个访问令牌和刷新令牌。</p>
<p>&emsp;(C) 客户端通过出示访问令牌向资源服务器请求受保护资源。</p>
<p>&emsp;(D) 资源服务器验证访问令牌的有效性，如果通过，则相应这个请求。</p>
<p>&emsp;(E) 步骤(C)(D)不停重复，直到访问令牌过期。如果客户端不知道访问令牌过期，它会再请求一次受保护资源。否则，跳到步骤(G)。</p>
<p>&emsp;(F) 因为访问令牌是无效的（过期了），资源服务器返回一个无效令牌错误。</p>
<p>&emsp;(G) 客户端通过使用它的私有证书在授权服务器上验证并出示刷新令牌（用作访问许可），来请求一个新的访问令牌。</p>
<p>&emsp;(H) 授权服务器验证客户端私有证书的有效性，如果通过则分发一个新的访问令牌（也可能还有一个刷新令牌）。</p>
</blockquote>
<h4 id="1-4-5-断言-Assertion"><a href="#1-4-5-断言-Assertion" class="headerlink" title="1.4.5 断言 Assertion"></a><strong>1.4.5 断言 Assertion</strong></h4><p>&emsp;&emsp;断言在OAuth和其它信任框架之间架起一座桥梁。它们允许客户端利用现成的信任关系来获取访问令牌。一个断言所代表的访问许可取决于断言类型、断言内容，以及断言被分发的方式，而这些内容不在本规范的规定范围之内。</p>
<p>&emsp;&emsp;断言可以用在协议扩展模型的部分，它为授权服务器提供了一种支持其它访问许可类型的方式。</p>
<hr>
<h2 id="第二节-Client-Profiles"><a href="#第二节-Client-Profiles" class="headerlink" title="第二节 Client Profiles"></a><strong>第二节 Client Profiles</strong></h2><h3 id="2-1-服务端-Web-Server"><a href="#2-1-服务端-Web-Server" class="headerlink" title="2.1 服务端 Web Server"></a><strong>2.1 服务端 Web Server</strong></h3><p>&emsp;&emsp;服务端概要(Web Server profile) 适用于有能力与终端用户的user-agent（通常是浏览器）交互并能够从授权服务器接收（通过重定向）请求（即有能力担当HTTP服务器的角色）的客户端。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  +----------+          Client Identifier      +---------------+</span><br><span class="line">  |<span class="string">         -+----(A)--- &amp; Redirect URI ------&gt;</span>|<span class="string">               </span>|</span><br><span class="line">  |<span class="string"> End-user </span>|<span class="string">                                 </span>|<span class="string"> Authorization </span>|</span><br><span class="line">  |<span class="string">    at    </span>|<span class="string">&lt;---(B)-- User authenticates ---&gt;</span>|<span class="string">     Server    </span>|</span><br><span class="line">  |<span class="string"> Browser  </span>|<span class="string">                                 </span>|<span class="string">               </span>|</span><br><span class="line">  |<span class="string">         -+----(C)-- Authorization Code ---&lt;</span>|<span class="string">               </span>|</span><br><span class="line">  +-|<span class="string">----</span>|<span class="string">---+                                 +---------------+</span></span><br><span class="line"><span class="string">    </span>|<span class="string">    </span>|<span class="string">                                         ^      v</span></span><br><span class="line"><span class="string">   (A)  (C)                                        </span>|<span class="string">      </span>|</span><br><span class="line">    |<span class="string">    </span>|<span class="string">                                         </span>|<span class="string">      </span>|</span><br><span class="line">    ^    v                                         |<span class="string">      </span>|</span><br><span class="line">  +---------+                                      |<span class="string">      </span>|</span><br><span class="line">  |<span class="string">         </span>|<span class="string">&gt;---(D)-- Client Credentials, --------&#x27;      </span>|</span><br><span class="line">  |<span class="string">  Server </span>|<span class="string">          Authorization Code,                </span>|</span><br><span class="line">  |<span class="string">  -Based </span>|<span class="string">            &amp; Redirect URI                   </span>|</span><br><span class="line">  |<span class="string">  Client </span>|<span class="string">                                             </span>|</span><br><span class="line">  |<span class="string">         </span>|<span class="string">&lt;---(E)----- Access Token -------------------&#x27;</span></span><br><span class="line"><span class="string">  +---------+       (w/ Optional Refresh Token)</span></span><br><span class="line"><span class="string">图5: Web Server流程</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>图5所示的web server流程包含下列步骤：</p>
<p>&emsp;(A) 如第4节所述，web客户端通过将终端用户的user-agent重定向到授权服务器来发起这个流程。客户端传入它的客户端标识符、请求作用域、本地状态和一个重定向URI，在访问被许可（或被拒绝）后授权服务器会重新将终端用户引导回这个URI。</p>
<p>&emsp;(B) 授权服务器验证终端用户（借助于user-agent），并确定终端用户是否许可客户端的访问请求。</p>
<p>&emsp;(C) 假定终端用户许可了这次访问，授权服务器会将user-agent重定向到之前提供的重定向URI上去。授权服务器为客户端传回一个授权码做获取访问令牌之用。</p>
<p>&emsp;(D) 如第5节所述，客户端通过验证并传入上一步取得的授权码从授权服务器请求一个访问令牌。</p>
<p>&emsp;(E) 授权服务器验证客户端私有证书和授权码的有效性并返回访问令牌。</p>
</blockquote>
<h3 id="2-2-用户代理-User-Agent"><a href="#2-2-用户代理-User-Agent" class="headerlink" title="2.2 用户代理 User-Agent"></a><strong>2.2 用户代理 User-Agent</strong></h3><p>&emsp;&emsp;User-Agent子态适用于常驻user-agent的客户端应用，典型的例子是用诸如JavaScript语言编写并运行在浏览器的程序。这些客户端不能保存客户端私有证书，并且客户端的验证基于user-agent的同源策略。</p>
<p>&emsp;&emsp;在其它子态中，客户端对于终端用户的授权和访问令牌使用分开的不同请求来完成，而与之不同的是，在user-agent子态中，客户端以HTTP重定向的方式在终端用户授权请求的结果中获取到访问令牌。客户端请求授权服务器将user-agent重定向到另一个web服务器或user-agent能访问到的本地资源，而且user-agent有能力从响应信息中提取出访问令牌并传给客户端。</p>
<p>&emsp;&emsp;这种user-agent子态并不使用客户端密钥，因为客户端执行程序常驻于终端用户的计算机或设备上，这使得客户端密钥可以被访问或收集到。因为访问令牌被编码到重定向URI中，所以它可能会暴露给终端用户和常驻计算机或设备上的其它应用。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">         +----------+          Client Identifier     +----------------+</span><br><span class="line">         |<span class="string">          </span>|<span class="string">&gt;---(A)-- &amp; Redirection URI ---&gt;</span>|<span class="string">                </span>|</span><br><span class="line">         |<span class="string">          </span>|<span class="string">                                </span>|<span class="string">                </span>|</span><br><span class="line">  End <span class="variable">&lt;--+  -  -  - +----(B)-- User authenticates --&gt;</span>|<span class="string">  Authorization </span>|</span><br><span class="line">  User   |<span class="string">          </span>|<span class="string">                                </span>|<span class="string">     Server     </span>|</span><br><span class="line">         |<span class="string">          </span>|<span class="string">&lt;---(C)--- Redirect URI -------&lt;</span>|<span class="string">                </span>|</span><br><span class="line">         |<span class="string">  Client  </span>|<span class="string">         with Access Token      </span>|<span class="string">                </span>|</span><br><span class="line">         |<span class="string">    in    </span>|<span class="string">            in Fragment         +----------------+</span></span><br><span class="line"><span class="string">         </span>|<span class="string">  Browser </span>|</span><br><span class="line">         |<span class="string">          </span>|<span class="string">                                +----------------+</span></span><br><span class="line"><span class="string">         </span>|<span class="string">          </span>|<span class="string">&gt;---(D)--- Redirect URI -------&gt;</span>|<span class="string">                </span>|</span><br><span class="line">         |<span class="string">          </span>|<span class="string">         without Fragment       </span>|<span class="string">   Web Server   </span>|</span><br><span class="line">         |<span class="string">          </span>|<span class="string">                                </span>|<span class="string">   with Client  </span>|</span><br><span class="line">         |<span class="string">    (F)   </span>|<span class="string">&lt;---(E)--- Web Page with ------&lt;</span>|<span class="string">    Resource    </span>|</span><br><span class="line">         |<span class="string">  Access  </span>|<span class="string">              Script            </span>|<span class="string">                </span>|</span><br><span class="line">         |<span class="string">   Token  </span>|<span class="string">                                +----------------+</span></span><br><span class="line"><span class="string">         +----------+</span></span><br><span class="line"><span class="string">图6: User-Agent流程</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>图6所示的user-agent流程包含下列步骤：</p>
<p>&emsp;(A) 如第5节所述，客户端将user-agent引导到终端用户授权endpoint。客户端传入它的客户端标识符、请求作用域、本地状态和一个重定向URI，在访问被许可（或被拒绝）后授权服务器会重新将终端用户引导回这个URI。</p>
<p>&emsp;(B) 授权服务器验证终端用户（通过user-agent）并确认终端用户是许可还是拒绝了客户端的访问请求。</p>
<p>&emsp;(C) 如果终端用户许可了这次访问，那么授权服务器会将user-agent引导到之前提供的重定向URI。重定向URI会在URI片断{译者注：URI片断是指URI中#号之后的内容}中包含访问令牌。</p>
<p>&emsp;(D) user-agent响应重定向指令，向web服务器发送不包含URI片断的请求。user-agent在本地保存URI片断。</p>
<p>&emsp;(E) web服务器返回一个web页面（通常是嵌入了脚本的HTML网页），这个页面能够访问完整的重定向URI，它包含了由user-agent保存的URI片断，同时这个页面能够将包含在URI片断中的访问令牌（和其它参数）提取出来。</p>
<p>&emsp;(F) user-agent在本地执行由web服务器提供的脚本，该脚本提取出访问令牌并将它传递给客户端。</p>
</blockquote>
<h3 id="2-3-原生程序-Native-Application"><a href="#2-3-原生程序-Native-Application" class="headerlink" title="2.3 原生程序 Native Application"></a><strong>2.3 原生程序 Native Application</strong></h3><p>&emsp;&emsp;原生程序是作为原生代码运行在终端用户计算机或设备上的客户端（即，在user-agent之外运行或作为一个桌面程序）。这些客户端通常有能力与终端用户的user-agent交互（或嵌入user-agent），但是在这些交互如何影响终端用户体验的方式上受到限制。在很多情况下，原生程序无法直接从服务器接收回调请求（例如，防火墙、操作系统限制）。</p>
<p>&emsp;&emsp;基于不同的需求和期望的终端用户体验，原生程序客户端可以用不同的方式实现。原生程序客户端可以：</p>
<blockquote>
<ul>
<li>如第4节所述，通过启动一个外部user-agent来访问终端用户授权endpoint。客户端可以通过下面的方式捕获响应文本：提供一个具有自定义URI scheme{译者注：URI scheme就是一个URI里面的第一部分，即冒号前面的部分}的重定向URI（在操作系统上注册过以便调用客户端应用），或者提供一个指向在客户端控制下的服务器资源的重定向URI，这使得响应文本对客户端可见（例如，使用窗口标题或在user-agent外面可以访问到的其它位置）。</li>
<li>如第4节所述，通过嵌入一个user-agent来访问终端用户授权endpoint。客户端通过与嵌入的user-agent直接通信获取到响应文本。</li>
<li>提示终端用户输入密码，使用密码直接获得一个访问令牌。通常来讲，这是一种不推荐的方式，因为它将终端用户的密码直接交给了第三方客户端，而客户端不得不用明文存储密码。它还要求服务器支持基于密码的身份验证。</li>
</ul>
</blockquote>
<p>&emsp;&emsp;当在启动外部浏览器和嵌入的user-agent之间进行选择时，开发者应该考虑下列因素：</p>
<blockquote>
<ul>
<li>外部浏览器可能会提高完成比率，因为终端用户可能已经登录过了而不需要重新进行身份验证。</li>
<li>嵌入的user-agent通常能提供更好的用户流程，因为它不必切换上下文并打开新窗口。</li>
<li>嵌入的user-agent对安全提出了挑战，因为用户在一个无法辨别的窗口之中进行身份验证，而不像很多user-agent那样能提供可视化的保护。</li>
</ul>
</blockquote>
<h3 id="2-4-自治态-Autonomous"><a href="#2-4-自治态-Autonomous" class="headerlink" title="2.4 自治态 Autonomous"></a><strong>2.4 自治态 Autonomous</strong></h3><p>&emsp;&emsp;自治客户端使用现成的信任关系或框架来建立授权。基于自治客户端的需求和他们所依赖的现存信任框架，自治客户端可以用不同的方式实现。自治客户端可以：</p>
<blockquote>
<ul>
<li>通过使用客户端私有证书与授权服务器进行验证，从而获得访问令牌。访问令牌的作用域局限于受客户端控制的受保护资源，或者其它资源拥有者与授权服务器预先约定的资源。</li>
<li>使用现存的某种访问许可，它被表达成授权服务器所支持的某种断言格式。使用断言需要客户端从一个断言发行方获得一个断言（如SAML[OASIS.saml-core-2.0-os]断言）或自己分发一个断言。断言的格式、获得断言的过程，以及验证断言的方法，由断言发行方和授权服务器定义，不在本规范的规定范围之内。</li>
</ul>
</blockquote>
<hr>
<h2 id="第三节-客户端私有证书-Client-Credentials"><a href="#第三节-客户端私有证书-Client-Credentials" class="headerlink" title="第三节 客户端私有证书 Client Credentials"></a><strong>第三节 客户端私有证书 Client Credentials</strong></h2><p>&emsp;&emsp;当与授权服务器进行交互时，客户端使用一个私有证书集合来标识自己，这个证书集合包含一个客户端标识符和用于客户端身份验证的其它一些属性。客户端获得私有证书的方式不在本规范的规定范围之内，不过这通常都包含一个在授权服务器上注册的过程。</p>
<p>&emsp;&emsp;考虑到一些客户端的本质特性，在与客户端没有确立信任关系的前提下，授权服务器不应该对客户端密钥的私密性做出任何假设。授权服务器不应该向没有能力对密钥进行秘密保存的客户端分发密钥。</p>
<p>&emsp;&emsp;授权服务器可以使用任一合适的私有证书集合和验证机制来对客户端进行身份验证。客户端一定不能在一个请求中使用多个私有证书集合和验证机制。</p>
<h3 id="3-1-客户端密码证书-Client-Password-Credentials"><a href="#3-1-客户端密码证书-Client-Password-Credentials" class="headerlink" title="3.1 客户端密码证书 Client Password Credentials"></a><strong>3.1 客户端密码证书 Client Password Credentials</strong></h3><p>&emsp;&emsp;客户端密码证书使用一个共享的对称密钥来验证客户端。客户端标识符和密码被包含在请求当中，使用<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#RFC2617" title="Title">[RFC2617]</a>定义的HTTP Basic验证机制，将客户端标识符作为用户名（username）并将客户端密码作为密码（password）来传送。</p>
<p>&emsp;&emsp;例如（换行符只用于显示目的）：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="apache"><span class="attribute">grant_type</span>=authorization_code&amp;code=i<span class="number">1</span>WsRn<span class="number">1</span>uB<span class="number">1</span>&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">redirect_uri</span>=https%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Fclient%<span class="number">2</span>Eexample%<span class="number">2</span>Ecom%<span class="number">2</span>Fcb</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;作为可选方式，客户端可以使用下列参数将密码包含在请求体（request body）中：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client<span class="emphasis">_id</span></span><br><span class="line"><span class="emphasis">    必需参数。客户端标识符。</span></span><br><span class="line"><span class="emphasis">client_</span>secret</span><br><span class="line"><span class="code">    必需参数。客户端密钥。</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;例如（换行符只用于显示目的）：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="apache"><span class="attribute">grant_type</span>=authorization_code&amp;client_id=s<span class="number">6</span>BhdRkqt<span class="number">3</span>&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">client_secret</span>=gX<span class="number">1</span>fBat<span class="number">3</span>bV&amp;code=i<span class="number">1</span>WsRn<span class="number">1</span>uB<span class="number">1</span>&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">redirect_uri</span>=https%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Fclient%<span class="number">2</span>Eexample%<span class="number">2</span>Ecom%<span class="number">2</span>Fcb</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;授权服务器必须能够使用请求参数和HTTP Basic验证协议两种方式接受客户端私有证书。授权服务器可以支持更多适合于密码证书传输的验证机制。</p>
<h3 id="3-2-客户端断言证书-Client-Assertion-Credentials"><a href="#3-2-客户端断言证书-Client-Assertion-Credentials" class="headerlink" title="3.2 客户端断言证书 Client Assertion Credentials"></a><strong>3.2 客户端断言证书 Client Assertion Credentials</strong></h3><p>&emsp;&emsp;客户端断言证书用于不宜使用密码（明文共享对称密钥）或密码无法为客户端验证提供足够安全性的情况。在这样的情况下，常见的做法是使用诸如HMAC或数字签名之类不需要发送明文密钥的其它机制。客户端断言证书提供了一种扩展机制，能够使用被授权服务器所支持的某种断言格式进行客户端身份验证。</p>
<p>&emsp;&emsp;使用断言需要客户端从一个断言发行方获得一个断言（如SAML[OASIS.saml-core-2.0-os]断言）或自己分发一个断言。断言的格式、获得断言的过程，以及验证断言的方法，由断言发行方和授权服务器定义，不在本规范的规定范围之内。</p>
<p>&emsp;&emsp;当使用客户端断言时，客户端传送下列参数：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client<span class="emphasis">_assertion_type</span></span><br><span class="line"><span class="emphasis">    必需参数。由授权服务器定义的断言格式。这个值必须是一个绝对URI。</span></span><br><span class="line"><span class="emphasis">client_</span>assertion</span><br><span class="line"><span class="code">    必需参数。客户端断言。</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;例如，客户端使用一个SAML 2.0断言发送如下访问令牌请求来验证自己（换行符只用于显示目的）：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="apache"><span class="attribute">grant_type</span>=authorization_code&amp;code=i<span class="number">1</span>WsRn<span class="number">1</span>uB<span class="number">1</span>&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">client_assertion</span>=PHNhbWxwOl[...omitted for brevity...]ZT<span class="number">4</span>%<span class="number">3</span>D&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">client_assertion_type</span>=</span></span><br><span class="line"><span class="apache"><span class="attribute">urn</span>%<span class="number">3</span>Aoasis%<span class="number">3</span>Anames%sAtc%<span class="number">3</span>ASAML%<span class="number">3</span>A<span class="number">2</span>.<span class="number">0</span>%<span class="number">3</span>Aassertion&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">redirect_uri</span>=https%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Fclient%<span class="number">2</span>Eexample%<span class="number">2</span>Ecom%<span class="number">2</span>Fcb</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;当使用一个客户端断言和一个授权码获得一个访问令牌的时候，需要一个机制在用于获取授权码的“client_id”参数值和客户端断言之间完成映射。这个机制不在本规范的规定范围之内，但对于与授权码结合使用的任何客户端断言类型都必须明确指明。</p>
<p>&emsp;&emsp;对于那些使用客户端断言证书但不包含能够提供下列信息的HMAC或签名值的访问令牌请求，授权服务器必须拒绝响应：</p>
<blockquote>
<ul>
<li>指明这个断言是专门分发给当前接收endpoint来处理的（一般是通过一个包含接收endpoint标识符的audience或recipient值）。</li>
<li>标识出分发断言的实体（一般是通过一个issuer值）。</li>
<li>用一个绝对时间标识出断言在何时过期（一般是通过一个包含UTC日期/时间值的过期值）。授权服务器必须拒绝过期的断言。</li>
</ul>
</blockquote>
<hr>
<h2 id="第四节-获得终端用户授权-Obtaining-End-User-Authorization"><a href="#第四节-获得终端用户授权-Obtaining-End-User-Authorization" class="headerlink" title="第四节 获得终端用户授权 Obtaining End-User Authorization"></a><strong>第四节 获得终端用户授权 Obtaining End-User Authorization</strong></h2><p>&emsp;&emsp;在客户端能够访问一个受保护资源之前，它必须首先从终端用户那里获取授权。为了获得终端用户授权，客户端需要将终端用户引导到终端用户授权endpoint。一旦获得授权，终端用户的访问许可会被表示成一个授权码，客户端能够使用它去获取一个访问令牌。</p>
<p>&emsp;&emsp;在终端用户授权endpoint上，终端用户首先在授权服务器上完成身份验证，然后允许或者拒绝当前访问请求。授权服务器验证用户的方式（例如，用户名和密码登录，OpenID，会话cookie）和授权服务器获取终端用户授权的方式，以及是否使用诸如TSL之类的安全通道，不在本规范的规定范围之内。然而，授权服务器必须要首先验证终端用户的身份。</p>
<p>&emsp;&emsp;终端用户授权endpoint的位置能够在服务器文档中找到。终端用户授权endpoint的URI可以按照[RFC3986]第3节的定义包含一个查询参数部分，它们在添加其它参数时必须被保留。</p>
<p>&emsp;&emsp;既然对于终端用户授权endpoint的请求会导致用户身份验证和敏感信息的传输，授权服务器应该要求在向终端用户授权endpoint发送请求的时候使用诸如TLS之类的传输层安全机制。</p>
<h3 id="4-1-授权请求-Authorization-Request"><a href="#4-1-授权请求-Authorization-Request" class="headerlink" title="4.1 授权请求 Authorization Request"></a><strong>4.1 授权请求 Authorization Request</strong></h3><p>&emsp;&emsp;为了将终端用户的user-agent引导到授权服务器，客户端将下列参数添加到终端用户授权endpoint URI的查询参数部分，并使用如<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#W3C.REC-html401-19991224" title="Title">[W3C.REC-html401-19991224]</a>所定义的“application/x-www-form-urlencoded”格式构建起一个请求URI，如下定义：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">response_type</span><br><span class="line">    必需参数。请求的响应中：一个访问令牌、一个授权码，或两者都有。请求访问令牌参数值必须设为“token”，请求授权码参数值必须设为“code”，或者使用参数值为“code_and_token”同时请求两者。授权服务器可能拒绝提供这些响应类型中的一种或多种。</span><br><span class="line">client_id</span><br><span class="line">    必需参数。如第<span class="number">3</span>节所述的客户端标识符。</span><br><span class="line">redirect_uri</span><br><span class="line">    必需参数，除非通过其它方式在客户端和授权服务器之间已经确定了一个重定向URI。这是当终端用户的授权步骤完成时授权服务器将要把user-agent重定向到的一个绝对URI。授权服务器应该要求客户端预先注册它们的重定向URI。</span><br><span class="line">scope</span><br><span class="line">    可选参数。访问请求的作用域，以空格隔开的字符串列表来表示。“scope”参数的值由授权服务器定义。如果这个值包含多个空格隔开的字符串，那么它们的顺序不分先后，而且每个字符串都为请求的作用域增加一个新的访问范围。</span><br><span class="line"><span class="keyword">state</span></span><br><span class="line">    可选参数。被客户端用来在请求和回调之间维护状态的值，对授权服务器来说是不透明的。授权服务器在将user-agent重定向回客户端时传回这个值。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;客户端通过user-agent使用HTTP重定向响应，或者其它可用的方式，将终端用户引导到构建好的URI上。对于终端用户授权endpoint，授权服务器必须支持HTTP的“GET”方法，也可以支持使用“POST”方法。</p>
<p>&emsp;&emsp;例如，客户端引导终端用户的user-agent使用传输层安全机制发送下列HTTP请求（换行符只用于显示目的）:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">GET</span> /authorize?response_type=code&amp;client_id=s<span class="number">6</span>BhdRkqt<span class="number">3</span>&amp;</span><br><span class="line">    <span class="attribute">redirect_uri</span>=https%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Fclient%<span class="number">2</span>Eexample%<span class="number">2</span>Ecom%<span class="number">2</span>Fcb HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">Host</span>: server.example.com</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;如果客户端已经在授权服务器上预先注册了一个重定向URI，授权服务器必须保证收到的重定向URI与当前客户端标识符所对应的注册URI相匹配。授权服务器不应该将user-agent重定向到没有注册过的或不信任的URI，以避免endpoint被用作一个公开的转向器。如果没有可用的有效重定向URI，授权服务器应该将发生的错误报告给用户[[提供如何执行匹配操作的建议]]。</p>
<p>&emsp;&emsp;没有值的参数必须被当做它们在请求中不存在一样。授权服务器应该忽略识别不了的请求参数。</p>
<p>&emsp;&emsp;授权服务器对请求进行验证以保证所有必需参数都存在并有效。如果请求是无效的，授权服务器将使用重定向URI把user-agent重定向回客户端，并且URI后面加上适当的错误码，如4.3节所述。</p>
<p>&emsp;&emsp;授权服务器验证终端用户的身份并获得一个授权决定（通过询问用户或通过其它方式认可）。当一个决定被做出后，授权服务器将终端用户的user-agent引导到客户端提供的重定向URI，这个重定向或者使用HTTP重定向响应，或者通过终端用户user-agent的其它可用的方式。</p>
<h3 id="4-2-授权响应-Authorization-Response"><a href="#4-2-授权响应-Authorization-Response" class="headerlink" title="4.2 授权响应 Authorization Response"></a><strong>4.2 授权响应 Authorization Response</strong></h3><p>&emsp;&emsp;如果终端用户许可了访问请求，授权服务器会分发一个访问令牌，或一个授权码，或者两者都有，并且通过将下列参数添加到重定向URI将这些分发结果传递给客户端（如下所述）。</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">code</span><br><span class="line">    如果响应类型是“code”或“code_and_token”则是必需的，否则一定不能包含这个参数。表示由授权服务器产生的授权码。授权码应该在分发后迅速过期，以降低泄露风险。客户端一定不能重用同一个授权码。如果一个授权码被多次使用，授权服务器可能撤销之前基于这个授权码分发的所有令牌。授权码与客户端标识符和重定向URI相绑定。</span><br><span class="line">access_token</span><br><span class="line">    如果响应类型是“token”或“code_and_token”则是必需的，否则一定不能包含这个参数。表示由授权服务器分发的访问令牌。</span><br><span class="line">token_type</span><br><span class="line">    如果响应中包含一个访问令牌则是必需的。表示分发的令牌类型。令牌类型告诉客户端一个信息，即当访问一个受保护资源时访问令牌应该如何被使用，如<span class="number">6.1</span>节所述。</span><br><span class="line">expires_in</span><br><span class="line">    可选参数。如果包含访问令牌参数，则表示访问令牌生命周期的秒数。例如，“<span class="number">3600</span>”表示自响应被授权服务器产生的时刻起，访问令牌将在一小时后过期。</span><br><span class="line">scope</span><br><span class="line">    可选参数。如果包含访问令牌参数，则表示访问令牌的作用域，表示为一个空格隔开的字符串列表。“scope”参数的值由授权服务器定义。如果这个值包含多个空格隔开的字符串，那么它们的顺序不分先后，而且每个字符串都为请求的作用域增加一个新的访问范围。如果请求到的作用域不同于客户端申请的作用域，授权服务器应该传回这个参数。</span><br><span class="line"><span class="keyword">state</span></span><br><span class="line">    如果“<span class="keyword">state</span>”参数在客户端授权请求中存在，则这个参数是必需的。需要精确地设置成从客户端接收到的值。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;授权服务器在重定向URI上添加参数的方式取决于客户端在授权请求中请求的响应类型，由“response_type”参数指定。</p>
<p>&emsp;&emsp;如果响应类型是“code”，授权服务器使用如<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#W3C.REC-html401-19991224" title="Title">[W3C.REC-html401-19991224]</a>所定义的“application/x-www-form-urlencoded”格式添加参数到重定向URI的查询参数部分。</p>
<p>&emsp;&emsp;例如，授权服务器通过发送下列HTTP响应将终端用户的user-agent进行重定向：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Location</span>: https://client.example.com/cb?code=i<span class="number">1</span>WsRn<span class="number">1</span>uB<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;如果响应类型是“code”或“code_and_token”，授权服务器使用如<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#W3C.REC-html401-19991224" title="Title">[W3C.REC-html401-19991224]</a>所定义的“application/x-www-form-urlencoded”格式添加参数到重定向URI的分段参数部分。</p>
<p>&emsp;&emsp;例如，授权服务器通过发送下列HTTP响应将终端用户的user-agent进行重定向（URI换行符只用于显示目的）：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">302</span> Found</span><br><span class="line">  <span class="attribute">Location</span>: http://example.com/rd#access_token=FJQbwq<span class="number">9</span>&amp;</span><br><span class="line">            <span class="attribute">token_type</span>=example&amp;expires_in=<span class="number">3600</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;客户端应该忽略无法识别的响应参数。从授权服务器接收到的令牌和其它参数值的大小，本规范未作定义。客户端应该避免对参数值大小做任何假设。服务器应该对它们所分发的任何参数值的期望大小做出文档说明。</p>
<h3 id="4-3-错误响应-Error-Response"><a href="#4-3-错误响应-Error-Response" class="headerlink" title="4.3 错误响应 Error Response"></a><strong>4.3 错误响应 Error Response</strong></h3><p>&emsp;&emsp;如果终端用户拒绝了访问请求，或者由于除了缺少或无效重定向URI之外的其它原因而导致请求失败，授权服务器使用如<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#W3C.REC-html401-19991224" title="Title">[W3C.REC-html401-19991224]</a>所定义的“application/x-www-form-urlencoded”格式添加下列参数到重定向URI的查询参数部分以通知客户端：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">error</span><br><span class="line">    必需参数。如<span class="number">4.3</span>.<span class="number">1</span>节所述的一个错误码。</span><br><span class="line">error_description</span><br><span class="line">    可选参数。提供额外信息的一段人类可读的文字，用来帮助理解和解决发生的错误。</span><br><span class="line">error_uri</span><br><span class="line">    可选参数。指明了一个人类可读的网页URI，带有关于错误的信息，用来为终端用户提供与错误有关的额外信息。</span><br><span class="line"><span class="keyword">state</span></span><br><span class="line">    如果“<span class="keyword">state</span>”参数在客户端授权请求中存在，则这个参数是必需的。需要精确地设置成从客户端接收到的值。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;例如，授权服务器通过发送下列HTTP响应将终端用户的user-agent进行重定向：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Location</span><span class="punctuation">: </span>https://client.example.com/cb?error=access_denied</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;如果由于缺少或无效重定向URI而导致请求失败，授权服务器应该通知终端用户这个错误，而一定不能将终端用户的user-agent重定向到这个无效的重定向URI。</p>
<h4 id="4-3-1-错误码-Error-Codes"><a href="#4-3-1-错误码-Error-Codes" class="headerlink" title="4.3.1 错误码 Error Codes"></a><strong>4.3.1 错误码 Error Codes</strong></h4><p>&emsp;&emsp;授权服务器在错误响应中包含下列错误码之一：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">invalid<span class="emphasis">_request</span></span><br><span class="line"><span class="emphasis">    请求缺少某个必需参数，包含一个不支持的参数或参数值，或者格式不正确。</span></span><br><span class="line"><span class="emphasis">invalid_client</span></span><br><span class="line"><span class="emphasis">    提供的客户端标识符是无效的。</span></span><br><span class="line"><span class="emphasis">unauthorized_client</span></span><br><span class="line"><span class="emphasis">    客户端没有权限使用该请求的响应类型。</span></span><br><span class="line"><span class="emphasis">redirect_uri_mismatch</span></span><br><span class="line"><span class="emphasis">    提供的重定向URI与预先注册的值不匹配。</span></span><br><span class="line"><span class="emphasis">access_denied</span></span><br><span class="line"><span class="emphasis">    终端用户或授权服务器拒绝了请求。</span></span><br><span class="line"><span class="emphasis">unsupported_response_type</span></span><br><span class="line"><span class="emphasis">    请求的响应类型不为授权服务器所支持。</span></span><br><span class="line"><span class="emphasis">invalid_</span>scope</span><br><span class="line"><span class="code">    请求的作用域是无效的、未知的，或格式不正确的。</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;[[增加扩展错误码的机制]]</p>
<hr>
<h2 id="第五节-获取访问令牌"><a href="#第五节-获取访问令牌" class="headerlink" title="第五节 获取访问令牌"></a><strong>第五节 获取访问令牌</strong></h2><p>&emsp;&emsp;客户端通过在授权服务器上验证并出示它的访问许可（表示成授权码、资源拥有者私有证书、断言或刷新令牌的形式）来获取一个访问令牌。</p>
<p>&emsp;&emsp;既然对于令牌endpoint的请求会导致在HTTP请求和响应中传输明文证书，授权服务器必需要求在向令牌endpoint发送请求的时候使用传输层安全机制。服务器必需支持<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#RFC5246" title="Title">[RFC5246]</a>所定义的TLS 1.2，并且可能支持额外的传输层安全机制。</p>
<p>&emsp;&emsp;客户端通过向令牌endpoint发送一个HTTP POST请求来获取一个访问令牌。令牌endpoint的位置能够在服务器文档中找到。令牌endpoint URI可能包含一个查询参数部分。</p>
<p>&emsp;&emsp;客户端通过在请求中添加客户端私有证书与授权服务器进行验证，如第3节所述。当客户端标识符不重要的时候（例如匿名客户端），或当客户端标识符通过其它方式确定的时候（例如使用一个断言访问许可），授权服务器可能允许不经验证的访问令牌请求。</p>
<p>&emsp;&emsp;客户端通过在HTTP请求的entity-body中使用“application/x-www-form-urlencoded”格式包含下列参数，来构建请求：</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant_type</span><br><span class="line">    必需参数。在请求中所包含的访问许可类型。它的值必须是“authorization_code”、“password”、“refresh_token”、“client_credentials”或一个用来标识被授权服务器所支持的断言类型的绝对URI。</span><br><span class="line"><span class="keyword">scope</span></span><br><span class="line">    可选参数。访问请求的作用域，表达为一个由空格隔开的字符串列表。“<span class="keyword">scope</span>”参数的值由授权服务器定义。如果这个值包含多个空格隔开的字符串，那么它们的顺序不分先后，而且每个字符串都为请求的作用域增加一个新的访问范围。如果使用的访问许可已经代表了一个许可作用域（例如，授权码、断言），那么请求的作用域必须等于或少于之前许可的作用域，如果缺少这个参数就认为是等于之前的许可作用域。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;另外，对于5.1节列出的某个访问许可类型，客户端必须包含合适的参数。</p>
<p>&emsp;&emsp;没有值的参数必须被当做它们在请求中不存在一样。授权服务器应该忽略识别不了的请求参数。</p>
<h3 id="5-1-访问许可类型-Access-Grant-Types"><a href="#5-1-访问许可类型-Access-Grant-Types" class="headerlink" title="5.1 访问许可类型 Access Grant Types"></a><strong>5.1 访问许可类型 Access Grant Types</strong></h3><p>&emsp;&emsp;客户端使用一个授权码、资源拥有者密码证书、客户端私有证书、刷新令牌或断言来请求一个访问许可。</p>
<h4 id="5-1-1-授权码-Authorization-Code"><a href="#5-1-1-授权码-Authorization-Code" class="headerlink" title="5.1.1 授权码 Authorization Code"></a><strong>5.1.1 授权码 Authorization Code</strong></h4><p>&emsp;&emsp;客户端使用“authorization_code”访问许可类型和下列参数传入授权码：</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">code</span></span><br><span class="line">    必需参数。从授权服务器接收到的授权码。</span><br><span class="line">redirect_uri</span><br><span class="line">    必需参数。在最初请求中使用的重定向URI。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;例如，客户端通过如第3节所述的“client_secret”参数包含客户端私有证书，并使用传输层安全机制，来发送下列HTTP请求（换行符只用于显示目的）：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="apache"><span class="attribute">grant_type</span>=authorization_code&amp;client_id=s<span class="number">6</span>BhdRkqt<span class="number">3</span>&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">client_secret</span>=gX<span class="number">1</span>fBat<span class="number">3</span>bV&amp;code=i<span class="number">1</span>WsRn<span class="number">1</span>uB<span class="number">1</span>&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">redirect_uri</span>=https%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Fclient%<span class="number">2</span>Eexample%<span class="number">2</span>Ecom%<span class="number">2</span>Fcb</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;授权服务器必须：</p>
<blockquote>
<ul>
<li>验证客户端私有证书（如果存在）并保证它们与授权码匹配。</li>
<li>验证授权码和重定向URI都是有效的，并且与存储的关联关系相匹配。</li>
</ul>
</blockquote>
<p>&emsp;&emsp;如果请求有效，授权服务器分发一个成功响应，如5.2节所述。</p>
<h4 id="5-1-2-资源拥有者密码证书-Resource-Owner-Password-Credentials"><a href="#5-1-2-资源拥有者密码证书-Resource-Owner-Password-Credentials" class="headerlink" title="5.1.2 资源拥有者密码证书 Resource Owner Password Credentials"></a><strong>5.1.2 资源拥有者密码证书 Resource Owner Password Credentials</strong></h4><p>&emsp;&emsp;客户端使用“password”访问许可类型和下列参数传入资源拥有者密码证书：[[增加对于用户名和密码的国际化考虑]]</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">username</span></span><br><span class="line">    必需参数。资源拥有者的用户名。</span><br><span class="line">password</span><br><span class="line">    必需参数。资源拥有者的密码。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;例如，客户端通过如第3节所述的“client_secret”参数包含客户端私有证书，并使用传输层安全机制，来发送下列HTTP请求（换行符只用于显示目的）：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="apache"><span class="attribute">grant_type</span>=password&amp;client_id=s<span class="number">6</span>BhdRkqt<span class="number">3</span>&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">client_secret</span>=<span class="number">47</span>HDu<span class="number">8</span>s&amp;username=johndoe&amp;password=A<span class="number">3</span>ddj<span class="number">3</span>w</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;授权服务器必须验证客户端私有证书（如果存在）和终端用户私有证书，而且如果发现有效则必须发布一个访问令牌响应，如5.2节所述。</p>
<h4 id="5-1-3-客户端私有证书-Client-Credentials"><a href="#5-1-3-客户端私有证书-Client-Credentials" class="headerlink" title="5.1.3 客户端私有证书 Client Credentials"></a><strong>5.1.3 客户端私有证书 Client Credentials</strong></h4><p>&emsp;&emsp;客户端可以仅仅使用它的客户端私有证书来请求一个访问令牌，即使用“client_credentials”访问许可类型。当省略一个显式的访问许可时，客户端是在请求访问它所控制的受保护资源，或另一个资源拥有者之前与授权服务器约定好的受保护资源（约定方式不在本规范的规定范围之内）。</p>
<h4 id="5-1-4-刷新令牌-Refresh-Token"><a href="#5-1-4-刷新令牌-Refresh-Token" class="headerlink" title="5.1.4 刷新令牌 Refresh Token"></a><strong>5.1.4 刷新令牌 Refresh Token</strong></h4><p>&emsp;&emsp;客户端使用“refresh_token”访问许可类型和下列参数传入刷新令牌：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ref</span>resh_token</span><br><span class="line">    必需参数。与待刷新的访问令牌相关联的刷新令牌。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;例如，客户端通过如第3节所述的“client_secret”参数包含客户端私有证书，并使用传输层安全机制，来发送下列HTTP请求（换行符只用于显示目的）：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="apache"><span class="attribute">grant_type</span>=refresh_token&amp;client_id=s<span class="number">6</span>BhdRkqt<span class="number">3</span>&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">client_secret</span>=<span class="number">8</span>eSEIpnqmM&amp;refresh_token=n<span class="number">4</span>E<span class="number">9</span>O<span class="number">119</span>d</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;授权服务器必须验证客户端私有证书（如果存在），验证刷新令牌是否有效，以及验证资源拥有者的授权是否仍然有效。如果请求有效，授权服务器则发布一个访问令牌响应，如5.2节所述。授权服务器可以发布一个新的刷新令牌，在这种情况下，客户端必须丢弃旧的刷新令牌并且用新的访问令牌替换。</p>
<h4 id="5-1-5-断言-Assertion"><a href="#5-1-5-断言-Assertion" class="headerlink" title="5.1.5 断言 Assertion"></a><strong>5.1.5 断言 Assertion</strong></h4><p>&emsp;&emsp;客户端使用一个绝对URI（由授权服务器定义）作为“grant_type”参数的值指定断言格式，并添加下列参数，来传入一个断言：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">assertion</span></span><br><span class="line">    必需参数。断言。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;例如，客户端使用传输层安全机制来发送下列HTTP请求，且客户端验证通过断言来完成（换行符只用于显示目的）：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="apache"><span class="attribute">grant_type</span>=urn%<span class="number">3</span>Aoasis%<span class="number">3</span>Anames%<span class="number">3</span>Atc%<span class="number">3</span>ASAML%<span class="number">3</span>A<span class="number">2</span>.<span class="number">0</span>%<span class="number">3</span>Aassertion&amp;</span></span><br><span class="line"><span class="apache"><span class="attribute">assertion</span>=PHNhbWxwOl[...omitted for brevity...]ZT<span class="number">4</span>%<span class="number">3</span>D</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;授权服务器必须验证客户端私有证书（如果存在）和断言，而且如果发现有效则必须发布一个访问令牌响应，如5.2节所述。授权服务器不应该分发一个刷新令牌（而是应该要求客户端使用相同的或新的断言）。</p>
<p>&emsp;&emsp;授权服务器应该分发具有有限生命周期的访问令牌，并且要求客户端使用仍然有效的同一个断言来请求新的访问令牌，从而完成对令牌的刷新。</p>
<h3 id="5-2-访问令牌响应-Access-Token-Response"><a href="#5-2-访问令牌响应-Access-Token-Response" class="headerlink" title="5.2 访问令牌响应 Access Token Response"></a><strong>5.2 访问令牌响应 Access Token Response</strong></h3><p>&emsp;&emsp;在接收到并验证过来自客户端的一个有效且经授权的访问令牌请求之后，授权服务器分发访问令牌和可选的刷新令牌，并且通过一个200（OK）状态码在HTTP响应的entity body中添加下列参数来构造响应：</p>
<p>&emsp;&emsp;令牌响应包含下列参数：</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">access_token</span><br><span class="line">    必需参数。由授权服务器分发的访问令牌。</span><br><span class="line">token_type</span><br><span class="line">    必需参数。分发的令牌类型。令牌类型告诉客户端一个信息，即当访问一个受保护资源时访问令牌应该如何被使用，如<span class="number">6.1</span>节所述。</span><br><span class="line">expires_in</span><br><span class="line">    可选参数。访问令牌生命周期的秒数。例如，“<span class="number">3600</span>”表示自响应被授权服务器产生的时刻起，访问令牌将在一小时后过期。</span><br><span class="line">refresh_token</span><br><span class="line">    可选参数。用来获取新的访问令牌的刷新令牌，如<span class="number">5.1</span><span class="number">.4</span>节所述使用相同的终端用户访问许可。当访问许可类型是一个断言或一个客户端私有证书集合时，授权服务器不应该分发一个刷新令牌。</span><br><span class="line"><span class="keyword">scope</span></span><br><span class="line">    可选参数。访问令牌的作用域，表示为一个空格隔开的字符串列表。“<span class="keyword">scope</span>”参数的值由授权服务器定义。如果这个值包含多个空格隔开的字符串，那么它们的顺序不分先后，而且每个字符串都为请求的作用域增加一个新的访问范围。如果请求到的作用域不同于客户端申请的作用域，授权服务器应该传回这个参数。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;参数包含在HTTP响应的entity body中，使用<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#RFC4627" title="Title">[RFC4627]</a>定义的“application/json”媒体类型。通过在最高结构层次上添加每个参数，将它们序列化成一个JSON结构。参数名和字符串值都表示成JSON字符串。数字值表示成JSON数字。</p>
<p>&emsp;&emsp;在任何包含令牌、密钥或其它敏感信息的响应中，授权服务器必须在“Cache-Control”响应头部字段中传入一个“no-store”的值。</p>
<p>&emsp;&emsp;例如：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-store</span><br><span class="line"></span><br><span class="line"><span class="json">&#123;</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;access_token&quot;</span>:<span class="string">&quot;SlAV32hkKG&quot;</span>,</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;token_type&quot;</span>:<span class="string">&quot;example&quot;</span>,</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;expires_in&quot;</span>:<span class="number">3600</span>,</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;refresh_token&quot;</span>:<span class="string">&quot;8xLOxBtZp8&quot;</span></span></span><br><span class="line"><span class="json">&#125;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;客户端应该忽略无法识别的响应参数。从授权服务器接收到的令牌和其它参数值的大小，本规范未作定义。客户端应该避免对参数值大小做任何假设。服务器应该对它们所分发的任何参数值的期望大小做出文档说明。</p>
<h3 id="5-3-错误响应-Error-Response"><a href="#5-3-错误响应-Error-Response" class="headerlink" title="5.3 错误响应 Error Response"></a><strong>5.3 错误响应 Error Response</strong></h3><p>&emsp;&emsp;如果令牌请求是无效的或未经授权的，授权服务器通过在HTTP响应的entity body中添加下列参数并使用“application/json”媒体类型来构造响应：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">error</span></span><br><span class="line"><span class="keyword">    </span>必需参数。如4.3.1节所述的一个错误码。</span><br><span class="line">error_description</span><br><span class="line">    可选参数。提供额外信息的一段人类可读的文字，用来帮助理解和解决发生的错误。</span><br><span class="line">error_uri</span><br><span class="line">    可选参数。指明了一个人类可读的网页URI，带有关于错误的信息，用来为终端用户提供与错误有关的额外信息。</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;例如：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">400</span> Bad Request</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-store</span><br><span class="line"></span><br><span class="line"><span class="json">&#123;</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;error&quot;</span>:<span class="string">&quot;invalid_request&quot;</span></span></span><br><span class="line"><span class="json">&#125;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;如果客户端通过“Authorization”请求头部字段使用HTTP验证机制这种方式提供了无效的私有证书，那么授权服务器必须用HTTP 401（Unauthorized）状态码进行响应。否则，授权服务器应该用HTTP 400（Bad Request）状态码进行响应。</p>
<h4 id="5-3-1-错误码-Error-Codes"><a href="#5-3-1-错误码-Error-Codes" class="headerlink" title="5.3.1 错误码 Error Codes"></a><strong>5.3.1 错误码 Error Codes</strong></h4><p>&emsp;&emsp;授权服务器在错误响应中传回下列错误码之一：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">invalid<span class="emphasis">_request</span></span><br><span class="line"><span class="emphasis">    请求缺少某个必需参数，包含一个不支持的参数或参数值，参数重复，包含多个私有证书，使用了多种验证客户端的机制，或者请求格式不正确。</span></span><br><span class="line"><span class="emphasis">invalid_client</span></span><br><span class="line"><span class="emphasis">    提供的客户端标识符是无效的，客户端验证失败，客户端不包含私有证书，提供了多个客户端私有证书，或使用了不支持的证书类型。</span></span><br><span class="line"><span class="emphasis">unauthorized_client</span></span><br><span class="line"><span class="emphasis">    经过验证的客户端没有权限使用提供的访问许可类型。</span></span><br><span class="line"><span class="emphasis">invalid_grant</span></span><br><span class="line"><span class="emphasis">    提供的访问许可是无效的、过期的或已撤销的（例如，无效的断言，过期的授权令牌，错误的终端用户密码证书，或者不匹配的授权码和重定向URI）。</span></span><br><span class="line"><span class="emphasis">unsupported_grant_type</span></span><br><span class="line"><span class="emphasis">    包含的访问许可——它的类型或其它属性——不被授权服务器所支持。</span></span><br><span class="line"><span class="emphasis">invalid_</span>scope</span><br><span class="line"><span class="code">    请求的作用域是无效的、未知的、格式不正确的，或超出了之前许可的作用域。</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;[[增加扩展错误码的机制]]</p>
<hr>
<h2 id="第六节-访问受保护资源-Accessing-a-Protected-Resource"><a href="#第六节-访问受保护资源-Accessing-a-Protected-Resource" class="headerlink" title="第六节 访问受保护资源 Accessing a Protected Resource"></a><strong>第六节 访问受保护资源 Accessing a Protected Resource</strong></h2><p>&emsp;&emsp;客户端通过向资源服务器出示一个访问令牌来访问受保护资源。资源服务器必须验证访问令牌，保证它没有过期并且它的作用域覆盖了请求的资源。被资源服务器用来验证访问令牌的方式不在本规范的规定范围之内，但是它通常需要在资源服务器和授权服务器之间进行交互或配合。</p>
<p>&emsp;&emsp;客户端利用访问令牌来验证资源服务器的方式取决于由授权服务器分发的访问令牌类型。</p>
<h3 id="6-1-访问令牌类型-Access-Token-Types"><a href="#6-1-访问令牌类型-Access-Token-Types" class="headerlink" title="6.1 访问令牌类型 Access Token Types"></a><strong>6.1 访问令牌类型 Access Token Types</strong></h3><p>&emsp;&emsp;[[增加令牌类型的解释，可能包含指定其它规范的链接]]</p>
<h3 id="6-2-WWW-Authenticate响应头部字段-The-WWW-Authenticate-Response-Header-Field"><a href="#6-2-WWW-Authenticate响应头部字段-The-WWW-Authenticate-Response-Header-Field" class="headerlink" title="6.2 WWW-Authenticate响应头部字段 The WWW-Authenticate Response Header Field"></a><strong>6.2 WWW-Authenticate响应头部字段 The WWW-Authenticate Response Header Field</strong></h3><p>&emsp;&emsp;如果对于受保护资源的请求不包含验证证书，包含一个无效的访问令牌，或格式不正确，那么资源服务器必须包含一个HTTP “WWW-Authenticate”响应头部字段。这个“WWW-Authenticate”头部字段使用<a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html#RFC2617" title="Title">[RFC2617]</a>定义的框架，如下所示：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">challenge       = <span class="string">&quot;OAuth2&quot;</span> [ RWS 1#param ]</span><br><span class="line"></span><br><span class="line">param           = scope /</span><br><span class="line">                  <span class="keyword">error</span> / <span class="keyword">error</span>-<span class="keyword">desc</span> / <span class="keyword">error</span>-uri /</span><br><span class="line">                  ( <span class="keyword">token</span> <span class="string">&quot;=&quot;</span> ( <span class="keyword">token</span> / quoted-string ) )</span><br><span class="line"></span><br><span class="line">scope           = <span class="string">&quot;scope&quot;</span> <span class="string">&quot;=&quot;</span> &lt;<span class="string">&quot;&gt; scope-v *( SP scope-v ) &lt;&quot;</span>&gt;</span><br><span class="line">scope-v         = 1*quoted-<span class="keyword">char</span></span><br><span class="line"></span><br><span class="line">quoted-<span class="keyword">char</span>     = <span class="keyword">ALPHA</span> / DIGIT /</span><br><span class="line">                  <span class="string">&quot;!&quot;</span> / <span class="string">&quot;#&quot;</span> / <span class="string">&quot;$&quot;</span> / <span class="string">&quot;%&quot;</span> / <span class="string">&quot;&amp;&quot;</span> / <span class="string">&quot;&#x27;&quot;</span> / <span class="string">&quot;(&quot;</span> / <span class="string">&quot;)&quot;</span> /</span><br><span class="line">                  <span class="string">&quot;*&quot;</span> / <span class="string">&quot;+&quot;</span> / <span class="string">&quot;-&quot;</span> / <span class="string">&quot;.&quot;</span> / <span class="string">&quot;/&quot;</span> / <span class="string">&quot;:&quot;</span> / <span class="string">&quot;&lt;&quot;</span> / <span class="string">&quot;=&quot;</span> /</span><br><span class="line">                  <span class="string">&quot;&gt;&quot;</span> / <span class="string">&quot;?&quot;</span> / <span class="string">&quot;@&quot;</span> / <span class="string">&quot;[&quot;</span> / <span class="string">&quot;]&quot;</span> / <span class="string">&quot;^&quot;</span> / <span class="string">&quot;_&quot;</span> / <span class="string">&quot;`&quot;</span> /</span><br><span class="line">                  <span class="string">&quot;&#123;&quot;</span> / <span class="string">&quot;|&quot;</span> / <span class="string">&quot;&#125;&quot;</span> / <span class="string">&quot;~&quot;</span> / <span class="string">&quot;\&quot;</span> / <span class="string">&quot;,&quot;</span> / <span class="string">&quot;;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">error</span>           = <span class="string">&quot;error&quot;</span> <span class="string">&quot;=&quot;</span> quoted-string</span><br><span class="line"><span class="keyword">error</span>-<span class="keyword">desc</span>      = <span class="string">&quot;error_description&quot;</span> <span class="string">&quot;=&quot;</span> quoted-string</span><br><span class="line"><span class="keyword">error</span>-uri       = <span class="string">&quot;error_uri&quot;</span> = &lt;<span class="string">&quot;&gt; URI-reference &lt;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;“scope”属性是一个空格隔开的作用域值的列表，表明了为了访问受保护资源所需要访问令牌作用域。“scope”属性一定不能出现多次。</p>
<p>&emsp;&emsp;如果对于受保护资源的请求包含一个访问令牌并且验证失败了，那么资源服务器应该包含“error”属性来向客户端提供为何访问请求被拒绝的原因。参数值在6.2.1中描述。另外，资源服务器可能包含“error_description”属性来提供一个人类可读的解释，或者包含“error-uri”属性用一个绝对URI来指定一个用于解释错误的人类可读的网页。“error”、“error_description”和“error-uri”属性一定不能出现多次。</p>
<p>&emsp;&emsp;例如，对于一个缺少验证的受保护资源请求的响应：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">401</span> Unauthorized</span><br><span class="line"><span class="attribute">WWW-Authenticate</span><span class="punctuation">: </span>OAuth2</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;对于一个使用过期访问令牌尝试验证的受保护资源请求的响应：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">401</span> Unauthorized</span><br><span class="line"><span class="attribute">WWW</span>-Authenticate: OAuth<span class="number">2</span></span><br><span class="line">                  <span class="attribute">error</span>=<span class="string">&quot;invalid_token&quot;</span>,</span><br><span class="line">                  <span class="attribute">error_description</span>=<span class="string">&quot;The access token expired&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="6-2-1-错误码-Error-Codes"><a href="#6-2-1-错误码-Error-Codes" class="headerlink" title="6.2.1 错误码 Error Codes"></a><strong>6.2.1 错误码 Error Codes</strong></h4><p>&emsp;&emsp;当一个请求失败时，资源服务器使用恰当的HTTP状态码（典型的如400、401或403）进行响应，并且在响应中包含下列错误码之一：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">invalid_request</span><br><span class="line">    请求缺少某个必需参数，包含一个不支持的参数或参数值，参数重复，使用多种方式包含访问令牌，或者请求格式不正确。资源服务器应该使用HTTP <span class="number">400</span>（<span class="keyword">Bad </span>Request）状态码进行响应。</span><br><span class="line">invalid_token</span><br><span class="line">    提供的访问令牌是过期的、已撤销的、格式不正确的，或由于其它原因是无效的。资源服务器应该使用HTTP <span class="number">401</span>（Unauthorized）状态码进行响应。客户端可能请求一个新的访问令牌并重试受保护资源请求。</span><br><span class="line"><span class="keyword">insufficient_scope</span></span><br><span class="line"><span class="keyword"></span>    请求需要比访问令牌所提供的权限更高的权限。资源服务器应该使用HTTP <span class="number">403</span>（Forbidden）状态码进行响应并且包含“<span class="keyword">scope”属性，带上访问该受保护资源必需的作用域。</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;[[增加扩展错误码的机制]]</p>
<p>&emsp;&emsp;如果请求中缺少任何验证信息（即客户端没有意识到验证是必需的或尝试使用一个不支持的验证方法），那么资源服务器不应该包含一个错误码和其它错误信息。</p>
<p>&emsp;&emsp;例如：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">401</span> Unauthorized</span><br><span class="line"><span class="attribute">WWW-Authenticate</span><span class="punctuation">: </span>OAuth2</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="第七节-扩展-Extensibility"><a href="#第七节-扩展-Extensibility" class="headerlink" title="第七节 扩展 Extensibility"></a><strong>第七节 扩展 Extensibility</strong></h2><h3 id="7-1-定义新的客户端证书类型-Defining-New-Client-Credentials-Types"><a href="#7-1-定义新的客户端证书类型-Defining-New-Client-Credentials-Types" class="headerlink" title="7.1 定义新的客户端证书类型 Defining New Client Credentials Types"></a><strong>7.1 定义新的客户端证书类型 Defining New Client Credentials Types</strong></h3><p>&emsp;&emsp;[[待定]]</p>
<h3 id="7-2-定义新的Endpoint参数-Defining-New-Endpoint-Parameters"><a href="#7-2-定义新的Endpoint参数-Defining-New-Endpoint-Parameters" class="headerlink" title="7.2 定义新的Endpoint参数 Defining New Endpoint Parameters"></a><strong>7.2 定义新的Endpoint参数 Defining New Endpoint Parameters</strong></h3><p>&emsp;&emsp;希望在终端用户授权endpoint和令牌endpoint上定义新的请求和响应参数的应用，应该使用下列两种方式之一：在参数注册表中注册（遵从9.1节描述的流程），或使用“x_”参数名前缀。</p>
<p>&emsp;&emsp;使用“x_”参数名前缀的参数必须局限于那些不会被广泛应用的针对厂商特性的扩展，并且特定于授权服务器使用场景的实现细节。所有其它参数必须被注册，并且一定不能使用“x_”参数名前缀。</p>
<p>&emsp;&emsp;参数名必须遵从param-name的ABNF，并且参数值语法必须被规范地定义（例如，使用ABNF，或者引用到现存参数的语法）。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">param-name  = <span class="number">1</span>*name-<span class="keyword">char</span></span><br><span class="line">name-<span class="keyword">char</span>   = <span class="string">&quot;-&quot;</span> <span class="regexp">/ &quot;.&quot; /</span> <span class="string">&quot;_&quot;</span> <span class="regexp">/ DIGIT /</span> ALPHA</span><br></pre></td></tr></table></figure>

<h3 id="7-3-定义新的头部字段参数-Defining-New-Header-Field-Parameters"><a href="#7-3-定义新的头部字段参数-Defining-New-Header-Field-Parameters" class="headerlink" title="7.3 定义新的头部字段参数 Defining New Header Field Parameters"></a><strong>7.3 定义新的头部字段参数 Defining New Header Field Parameters</strong></h3><p>&emsp;&emsp;希望在OAuth “WWW-Authenticate”头部字段中定义新参数的应用必须在参数注册表中进行注册，遵从9.1节描述的流程。</p>
<p>&emsp;&emsp;参数名必须遵从param-name的ABNF并且不能以“x_”开头。参数值必须遵从param-value的ABNF并且语法必须被规范地定义（例如，使用ABNF，或者引用到现存参数的语法）。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">param-value</span> = quoted-value | quoted-string</span><br></pre></td></tr></table></figure>

<h3 id="7-4-定义新的访问许可类型-Defining-New-Access-Grant-Types"><a href="#7-4-定义新的访问许可类型-Defining-New-Access-Grant-Types" class="headerlink" title="7.4 定义新的访问许可类型 Defining New Access Grant Types"></a><strong>7.4 定义新的访问许可类型 Defining New Access Grant Types</strong></h3><p>&emsp;&emsp;断言访问许可类型允许授权服务器接受其它未规定的访问许可。希望定义其它访问许可类型的应用能够通过利用新的或现存的断言类型和格式进行实现。</p>
<hr>
<h2 id="第八节-安全考虑-Security-Considerations"><a href="#第八节-安全考虑-Security-Considerations" class="headerlink" title="第八节 安全考虑 Security Considerations"></a><strong>第八节 安全考虑 Security Considerations</strong></h2><p>&emsp;&emsp;[[待定]]</p>
<hr>
<h2 id="第九节-IANA事项-IANA-Considerations"><a href="#第九节-IANA事项-IANA-Considerations" class="headerlink" title="第九节 IANA事项 IANA Considerations"></a><strong>第九节 IANA事项 IANA Considerations</strong></h2><h3 id="9-1-OAuth参数注册表-The-OAuth-Parameters-Registry"><a href="#9-1-OAuth参数注册表-The-OAuth-Parameters-Registry" class="headerlink" title="9.1 OAuth参数注册表 The OAuth Parameters Registry"></a><strong>9.1 OAuth参数注册表 The OAuth Parameters Registry</strong></h3><p>&emsp;&emsp;本文档设立参数注册表。</p>
<p>&emsp;&emsp;用于终端用户授权endpoint的请求、终端用户授权endpoint的响应、令牌endpoint的请求、令牌endpoint的响应或“WWW-Authenticate”头部字段的多余参数，在一个或多个“指派专家”（由IESG或他们的代理机构指定）的指导下进行注册，遵从所需的规范（使用[RFC5226]的术语）。然而，为了允许在发布之前对值进行分配，“指派专家”们一旦认同这样的一个规范能够发布，可能就立即批准注册。</p>
<p>&emsp;&emsp;注册请求应该发送给[待定]@ietf.org邮件组进行评审和讨论，使用恰当的标题（如“Request for parameter: example”）。[[RFC-EDITOR注解：邮件组名称应该在与IESG和IANA磋商后确定。建议名称：oauth-ext-review。]]</p>
<p>&emsp;&emsp;在14天之内，“指派专家”们会批准或拒绝注册请求，并将结果告知邮件组和IANA。拒绝的决定应该包含一个解释，并且，如果可行的话，应该包含如何进行修改的建议。在21天以上未确定的注册请求会交由IESG处理（使用<a href="mailto:&#x69;&#x65;&#115;&#103;&#64;&#105;&#x65;&#x73;&#x67;&#46;&#111;&#114;&#103;">&#x69;&#x65;&#115;&#103;&#64;&#105;&#x65;&#x73;&#x67;&#46;&#111;&#114;&#103;</a>邮件组）。</p>
<h4 id="9-1-1-注册模板-Registration-Template"><a href="#9-1-1-注册模板-Registration-Template" class="headerlink" title="9.1.1 注册模板 Registration Template"></a><strong>9.1.1 注册模板 Registration Template</strong></h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Parameter</span> name: 请求的名称（例如“example”）。</span><br><span class="line"><span class="keyword">Parameter</span> <span class="comment">usage location:</span> 参数能够被使用的位置。可能的位置包括：终端用户授权<span class="comment">endpoint</span>的请求、终端用户授权<span class="comment">endpoint</span>的响应、令牌<span class="comment">endpoint</span>的请求、令牌<span class="comment">endpoint</span>的响应或“<span class="comment">WWW-Authenticate</span>”头部字段。</span><br><span class="line">Change <span class="comment">controller:</span> 对于标准轨道的<span class="comment">RFC</span>，写明“<span class="comment">IETF</span>”。对于其它规范，使用负责机构的名称。其它细节（例如，邮编地址，电子邮件地址，主页<span class="comment">URI</span>）也可以包含。</span><br><span class="line">Specification <span class="comment">document(s):</span> 对规定参数的文档引用，可取的方式是包含一个能够获取到文档拷贝的<span class="comment">URI</span>。对于相关章节的标示也可以包含</span><br><span class="line">Related <span class="comment">information:</span></span><br><span class="line">Optionally, citations <span class="comment">to additional documents containing further relevant information.</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;未完待续。</p>
<hr>
<p><em>参考博客和文章书籍等：</em></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-11.html" title="Title">The OAuth 2.0 Protocol Framework</a></p>
</blockquote>
<p><em>因博客主等未标明不可引用，若部分内容涉及侵权请及时告知，我会尽快修改和删除相关内容</em></p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Lys
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://linyishui.top/2019111601.html" title="OAuth2协议框架">http://linyishui.top/2019111601.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/oauth2/" rel="tag"><i class="fa fa-tag"></i> oauth2</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019111401.html" rel="prev" title="Spring Cloud-Zuul API网关">
                  <i class="fa fa-chevron-left"></i> Spring Cloud-Zuul API网关
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019111701.html" rel="next" title="Spring Security OAuth2">
                  Spring Security OAuth2 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lys</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">3.1m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">46:36</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>



  <script class="next-config" data-name="nprogress" type="application/json">{"enable":true,"spinner":true}</script>
  <script src="/js/third-party/nprogress.js"></script>

  




<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"LAILAIWA/LAILAIWA.github.io","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>



</body>
</html>
