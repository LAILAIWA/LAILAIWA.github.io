---
title: SqlServer更新几个属性列为随机数据
date: 2018-08-10 20:42:57
tags: [trouble shooting]
categories: 技术文档
description: SQL更新操作时，取限定范围内随机数据为属性赋值。
photos: 
    - "https://pic-1258215793.cos.ap-shanghai.myqcloud.com/cover/sooyaaa___3____utm_source=ig_share_sheet&igshid=1hifa0lijzfax___.jpg"
---

{% aplayer "Falling" "Kate Rusby" 
"http://pcvwwmd5n.bkt.clouddn.com/Kate%20Rusby%20-%20Falling.mp3" "http://p1.music.126.net/LsJKlY6iXY9fnv5L8KAVAA==/595935302264293.jpg" "autoplay" %}

&nbsp;&nbsp;&nbsp;&nbsp;今天写好服务后想测试一下，需要导入一些数据后为其随机取日期以及随机取字段'是','否'。想当然的就用rand()来赋值，发现结果每条数据都是同一数据，一条update语句所以也就只取了一个随机数。

&nbsp;&nbsp;&nbsp;&nbsp;想到了newid()取全局不重复的唯一随机值，变相的生成限定范围内的随机数。

&nbsp;&nbsp;&nbsp;&nbsp;取限制范围内的随机时间，可以先取时间差，然后用newid()获取随机ID，对时间差求余获取随机时间。

&nbsp;&nbsp;&nbsp;&nbsp;随机取字段'是','否'，同理，取随机数加一个case when判断赋值即可。

```
update DATASHOW_YXSH set BDSJ = DATEADD(second,ABS(CHECKSUM(NEWID()))%DATEDIFF(second,'2017-9-1','2017-9-1 23:59:59'),'2017-9-1') where SFBLWC = '已完成';

UPDATE DATASHOW_YXSH SET SFYBD = T.randValue
FROM
(
SELECT KSH,CASE WHEN RIGHT(ABS(CHECKSUM(newid())),1) > 5 THEN '是' ELSE '否' END AS randValue
FROM DATASHOW_YXSH
)T
WHERE DATASHOW_YXSH.KSH = T.KSH
```
