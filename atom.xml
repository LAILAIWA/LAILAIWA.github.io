<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¿ºçš„éƒ¨è½æ ¼</title>
  
  <subtitle>ä¿ºå¯»æ€ä¿ºéœ€è¦è®°ç‚¹ä¸œè¥¿</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://linyishui.top/"/>
  <updated>2020-10-02T08:14:03.967Z</updated>
  <id>http://linyishui.top/</id>
  
  <author>
    <name>æ—æ²‚æ°´</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RabbitMQï¼ˆå››ï¼‰ç®¡ç†</title>
    <link href="http://linyishui.top/2020100201.html"/>
    <id>http://linyishui.top/2020100201.html</id>
    <published>2020-10-02T07:08:31.000Z</published>
    <updated>2020-10-02T08:14:03.967Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹</p>]]></content>
    
    <summary type="html">
    
      å­¦ä¹ RabbitMQï¼Œç¬¬ä¸‰ç« ã€Šç®¡ç†ã€‹ï¼Œå†…å®¹æ¥è‡ªäºã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="mom" scheme="http://linyishui.top/tags/mom/"/>
    
      <category term="rabbitmq" scheme="http://linyishui.top/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQï¼ˆä¸‰ï¼‰è¿›é˜¶</title>
    <link href="http://linyishui.top/2020092801.html"/>
    <id>http://linyishui.top/2020092801.html</id>
    <published>2020-09-28T05:34:23.000Z</published>
    <updated>2020-10-02T07:58:24.443Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h1><h2 id="ç¬¬ä¸€èŠ‚-æ¶ˆæ¯ä½•å»ä½•ä»"><a href="#ç¬¬ä¸€èŠ‚-æ¶ˆæ¯ä½•å»ä½•ä»" class="headerlink" title="ç¬¬ä¸€èŠ‚ æ¶ˆæ¯ä½•å»ä½•ä»"></a>ç¬¬ä¸€èŠ‚ æ¶ˆæ¯ä½•å»ä½•ä»</h2><h3 id="1-1-æ¶ˆæ¯ä¸å¯è¾¾æ—¶è¿”å›ç»™ç”Ÿäº§è€…"><a href="#1-1-æ¶ˆæ¯ä¸å¯è¾¾æ—¶è¿”å›ç»™ç”Ÿäº§è€…" class="headerlink" title="1.1 æ¶ˆæ¯ä¸å¯è¾¾æ—¶è¿”å›ç»™ç”Ÿäº§è€…"></a>1.1 æ¶ˆæ¯ä¸å¯è¾¾æ—¶è¿”å›ç»™ç”Ÿäº§è€…</h3><p> <code>channel.basicPublish</code> ä¸¤ä¸ªå®¹æ˜“æ··æ·†çš„å‚æ•°ï¼šéƒ½å¯ä»¥åœ¨æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸å¯è¾¾ç›®çš„åœ°æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚</p><ul><li><p>mandatoryï¼šä¸º true æ—¶ï¼Œä¸”äº¤æ¢å™¨æ— æ³•æ ¹æ®è‡ªèº«çš„ç±»å‹å’Œè·¯ç”±é”®æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—ï¼Œè°ƒç”¨ <code>Basic.Return</code> å‘½ä»¤å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚ä¸º false æ—¶ï¼Œæ¶ˆæ¯ç›´æ¥è¢«ä¸¢å¼ƒã€‚</p><p>å¦‚ä¸‹ä»£ç ï¼Œè¾“å‡º <code>&quot;Basic.Return è¿”å›çš„ç»“æœæ˜¯ï¼šmandatory test&quot;</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">channel.basicPublish(EXCHANGE_NAME, <span class="string">""</span>, <span class="keyword">true</span>,</span><br><span class="line">        MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class="line">        <span class="string">"mandatory test"</span>.getBytes());</span><br><span class="line">  </span><br><span class="line"><span class="comment">// è°ƒç”¨channel.addReturnListeneræ·»åŠ ReturnListenerç›‘å¬å™¨æ¥ä½¿ç”Ÿäº§è€…è·å–æ˜¯å¦è¢«æ­£ç¡®è·¯ç”±åˆ°åˆé€‚é˜Ÿåˆ—</span></span><br><span class="line">channel.addReturnListener(<span class="keyword">new</span> ReturnListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturn</span><span class="params">(<span class="keyword">int</span> replyCode,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 String replyText,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 String exchange,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 String routingKey,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 AMQP.BasicProperties basicProperties,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String message = <span class="keyword">new</span> String(body);</span><br><span class="line">                System.out.println(<span class="string">"Basic.Return è¿”å›çš„ç»“æœæ˜¯ï¼š"</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>AMQPåè®®ä¸­å¯¹åº”çš„æµè½¬è¿‡ç¨‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010165.png" alt></p></li><li><p>immediateï¼šä¸ºtrueæ—¶ï¼Œè‹¥äº¤æ¢å™¨åœ¨å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—æ—¶å‘ç°é˜Ÿåˆ—ä¸Šå¹¶ä¸å­˜åœ¨ä»»ä½•æ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å°†ä¸ä¼šå­˜å…¥é˜Ÿåˆ—ä¸­ã€‚å½“ä¸è·¯ç”±é”®åŒ¹é…çš„æ‰€æœ‰é˜Ÿåˆ—éƒ½æ²¡æœ‰æ¶ˆè´¹è€…æ—¶ï¼Œ è¯¥æ¶ˆæ¯ä¼šé€šè¿‡ <code>Basic.Return</code> è¿”å›è‡³ç”Ÿäº§è€…ã€‚</p><ul><li>RabbitMQ 3.0 æ—¶å»é™¤äº†å¯¹æ­¤å‚æ•°çš„æ”¯æŒï¼Œä¼šå½±å“é•œåƒé˜Ÿåˆ—çš„æ€§èƒ½ï¼Œå»ºè®®ç”¨TTLå’ŒDLXæ–¹æ³•æ›¿ä»£ã€‚</li></ul></li></ul><p>æ¦‚æ‹¬æ¥è¯´ï¼Œ mandatory å‚æ•°å‘Šè¯‰æœåŠ¡å™¨è‡³å°‘å°†è¯¥æ¶ˆæ¯è·¯ç”±åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¦åˆ™å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚ immediate å‚æ•°å‘Šè¯‰æœåŠ¡å™¨ï¼Œå¦‚æœè¯¥æ¶ˆæ¯å…³è”çš„é˜Ÿåˆ—ä¸Šæœ‰æ¶ˆè´¹è€…ï¼Œåˆ™ç«‹åˆ»æŠ•é€’ï¼›å¦‚æœæ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¸Šéƒ½æ²¡æœ‰æ¶ˆè´¹è€…ï¼Œåˆ™ç›´æ¥å°†æ¶ˆæ¯è¿”è¿˜ç»™ç”Ÿäº§è€…ï¼Œä¸ç”¨å°†æ¶ˆæ¯å­˜å…¥é˜Ÿåˆ—è€Œç­‰å¾…æ¶ˆè´¹è€…äº†ã€‚</p><h3 id="1-2-å¤‡ä»½äº¤æ¢å™¨"><a href="#1-2-å¤‡ä»½äº¤æ¢å™¨" class="headerlink" title="1.2 å¤‡ä»½äº¤æ¢å™¨"></a>1.2 å¤‡ä»½äº¤æ¢å™¨</h3><p><strong>å¤‡ä»½äº¤æ¢å™¨</strong>ï¼Œè‹±æ–‡åç§°ä¸º <strong>Alternate Exchange</strong> ï¼Œç®€ç§°<strong>AE</strong>ï¼Œæˆ–è€…æ›´ç›´ç™½åœ°ç§°ä¹‹ä¸ºâ€œå¤‡èƒäº¤æ¢å™¨â€ã€‚</p><p>ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™å¦‚æœä¸è®¾ç½® mandatory å‚æ•°ï¼Œé‚£ä¹ˆæ¶ˆæ¯åœ¨æœªè¢«è·¯ç”±çš„æƒ…å†µä¸‹å°†ä¼šä¸¢å¤±ï¼›å¦‚æœè®¾ç½®äº† mandatory å‚æ•°ï¼Œé‚£ä¹ˆéœ€è¦æ·»åŠ  ReturnListener çš„ç¼–ç¨‹é€»è¾‘ï¼Œç”Ÿäº§è€…çš„ä»£ç å°†å˜å¾—å¤æ‚ã€‚</p><p><strong>æ—¢ä¸æƒ³å¤æ‚åŒ–ç”Ÿäº§è€…çš„ç¼–ç¨‹é€»è¾‘ï¼Œåˆä¸æƒ³æ¶ˆæ¯ä¸¢å¤±ï¼Œå¯ä»¥ä½¿ç”¨å¤‡ä»½äº¤æ¢å™¨</strong>ï¼Œè¿™æ ·å¯ä»¥å°†æœªè¢«è·¯ç”±çš„æ¶ˆæ¯å­˜å‚¨åœ¨ RabbitMQ ä¸­ï¼Œå†åœ¨éœ€è¦çš„æ—¶å€™å»å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚</p><p><strong>æ¶ˆæ¯è¢«é‡æ–°å‘é€åˆ°å¤‡ä»½äº¤æ¢å™¨æ—¶çš„è·¯ç”±é”®å’Œä»ç”Ÿäº§è€…å‘å‡ºçš„è·¯ç”±é”®æ˜¯ä¸€æ ·çš„ã€‚</strong></p><h4 id="1-2-1-å®ç°æ–¹å¼"><a href="#1-2-1-å®ç°æ–¹å¼" class="headerlink" title="1.2.1 å®ç°æ–¹å¼"></a>1.2.1 å®ç°æ–¹å¼</h4><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><ul><li>è°ƒç”¨ <code>channel.exchangeDeclare()</code> æ—¶æ·»åŠ  <code>alternate-exchange</code> å‚æ•°å®ç°ï¼›</li><li>é€šè¿‡ç­–ç•¥ï¼ˆPolicyï¼‰æ–¹å¼å®ç°ã€‚é»˜è®¤ç¬¬ä¸€ç§ä¼˜å…ˆçº§é«˜ã€‚</li></ul><p>æ·»åŠ  <code>alternate-exchange</code> å‚æ•°å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">args.put(<span class="string">"alternate-exchange"</span>, <span class="string">"myAe"</span>);</span><br><span class="line"><span class="comment">// å£°æ˜ä¸¤ä¸ªäº¤æ¢å™¨ï¼Œåˆ†åˆ«ç»‘å®šç›¸åº”é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">// å¹¶ä¸”è®¾ç½®myAeä¸ºnormalExchangeçš„å¤‡ä»½äº¤æ¢å™¨</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">"normalExchange"</span>, <span class="string">"direct"</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, args);</span><br><span class="line">channel.exchangeDeclare(<span class="string">"myAe"</span>, <span class="string">"fanout"</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">"normalQueue"</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">channel.queueBind(<span class="string">"normalQueue"</span>, <span class="string">"normalExchange"</span>, <span class="string">"normalKey"</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">"unroutedQueue"</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">channel.queueBind(<span class="string">"unroutedQueue"</span>, <span class="string">"myAe"</span>, <span class="string">""</span>);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°äº¤æ¢å™¨normalExchangeï¼Œå½“è·¯ç”±é”®ç­‰äºnormalKeyæ—¶ï¼Œæ¶ˆæ¯å¯ä»¥æ­£ç¡®è·¯ç”±åˆ°é˜Ÿåˆ—normalQueueï¼›å¦åˆ™æ¶ˆæ¯ä¼šå‘é€ç»™å¤‡ä»½äº¤æ¢å™¨myAeï¼Œå¹¶å‘é€åˆ°é˜Ÿåˆ—unroutedQueueã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010166.png" alt></p><p>ç­–ç•¥å®ç°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rabbitmqctl set_policy AE <span class="string">"^normalExchange$"</span> <span class="string">'&#123;"alternate-exchange": "myAE"&#125;'</span></span></span><br></pre></td></tr></table></figure><p><strong>å»ºè®®è®¾ç½®å¤‡ä»½äº¤æ¢å™¨ä¸º fanout ç±»å‹</strong>ï¼šå¦‚æœå¤‡ä»½äº¤æ¢å™¨çš„ç±»å‹æ˜¯ direct å¹¶ä¸”æœ‰ä¸€ä¸ªä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå‡è®¾ç»‘å®šçš„è·¯ç”±é”®æ˜¯ key1 å½“æŸæ¡æºå¸¦è·¯ç”±é”®ä¸º key2 çš„æ¶ˆæ¯è¢«è½¬å‘åˆ°è¿™ä¸ªå¤‡ä»½äº¤æ¢å™¨çš„æ—¶å€™ï¼Œå¤‡ä»½äº¤æ¢å™¨æ²¡æœ‰åŒ¹é…åˆ°åˆé€‚çš„é˜Ÿåˆ—ï¼Œåˆ™æ¶ˆæ¯ä¸¢å¤±ã€‚å¦‚æœæ¶ˆæ¯æºå¸¦çš„è·¯ç”±é”®ä¸º key1 ï¼Œåˆ™å¯ä»¥å­˜å‚¨åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><h4 id="1-2-2-ç‰¹æ®Šæƒ…å†µ"><a href="#1-2-2-ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="1.2.2 ç‰¹æ®Šæƒ…å†µ"></a>1.2.2 ç‰¹æ®Šæƒ…å†µ</h4><ul><li>å¦‚æœè®¾ç½®çš„å¤‡ä»½äº¤æ¢å™¨ä¸å­˜åœ¨ï¼Œå®¢æˆ·ç«¯å’Œ RabbitMQ æœåŠ¡ç«¯éƒ½ä¸ä¼šæœ‰å¼‚å¸¸å‡ºç°ï¼Œæ­¤æ—¶æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚</li><li>å¦‚æœå¤‡ä»½äº¤æ¢å™¨æ²¡æœ‰ç»‘å®šä»»ä½•é˜Ÿåˆ—ï¼Œå®¢æˆ·ç«¯å’Œ RabbitMQ æœåŠ¡ç«¯éƒ½ä¸ä¼šæœ‰å¼‚å¸¸å‡ºç°ï¼Œæ­¤æ—¶æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚</li><li>å¦‚æœå¤‡ä»½äº¤æ¢å™¨æ²¡æœ‰ä»»ä½•åŒ¹é…çš„é˜Ÿåˆ—ï¼Œå®¢æˆ·ç«¯å’Œ RabbitMQ æœåŠ¡ç«¯éƒ½ä¸ä¼šæœ‰å¼‚å¸¸å‡ºç°ï¼Œ æ­¤æ—¶æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚</li><li>å¦‚æœå¤‡ä»½äº¤æ¢å™¨å’Œ mandatory å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œé‚£ä¹ˆ mandatory å‚æ•°æ— æ•ˆã€‚</li></ul><h2 id="ç¬¬äºŒèŠ‚-è¿‡æœŸæ—¶é—´-TTL"><a href="#ç¬¬äºŒèŠ‚-è¿‡æœŸæ—¶é—´-TTL" class="headerlink" title="ç¬¬äºŒèŠ‚ è¿‡æœŸæ—¶é—´(TTL)"></a>ç¬¬äºŒèŠ‚ è¿‡æœŸæ—¶é—´(TTL)</h2><p>è¿‡æœŸæ—¶é—´ï¼ˆTime to Liveï¼ŒTTLï¼‰ï¼Œå¯ä»¥å¯¹æ¶ˆæ¯å’Œé˜Ÿåˆ—è®¾ç½®TTLã€‚</p><h3 id="2-1-è®¾ç½®æ¶ˆæ¯çš„TTL"><a href="#2-1-è®¾ç½®æ¶ˆæ¯çš„TTL" class="headerlink" title="2.1 è®¾ç½®æ¶ˆæ¯çš„TTL"></a>2.1 è®¾ç½®æ¶ˆæ¯çš„TTL</h3><p>è®¾ç½®æ–¹å¼ï¼š</p><ul><li><p><strong>é€šè¿‡é˜Ÿåˆ—å±æ€§è®¾ç½®</strong>ï¼Œé˜Ÿåˆ—å†…æ‰€æœ‰æ¶ˆæ¯éƒ½æœ‰ç›¸åŒçš„TTLï¼›</p><ul><li><p>åœ¨ <code>channel.queueDeclare()</code> ä¸­åŠ å…¥ <code>x-message-ttl</code> å‚æ•°ï¼Œå•ä½æ¯«ç§’ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">args.put(<span class="string">"x-message-ttl"</span>, <span class="number">6000</span>);</span><br><span class="line">channel.queueDeclare(queueName, durable, exclusive, autoDelete, args);</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡ç­–ç•¥-Policyæ¥è®¾ç½®TTLï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rabbitmqctl set_policy TTL <span class="string">".*"</span> <span class="string">'&#123;"message-ttl":60000&#125;'</span> --apply-to queues</span></span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡è°ƒç”¨HTTP APIæ¥å£è®¾ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -i -u root:root -H <span class="string">"content-type:application/json"</span>-X PUT -d<span class="string">'&#123;"auto_delete":false,"durable":true,"arguments":&#123;"x-message-ttl": 60000&#125;&#125;'</span> http://localhost:15672/api/queues/&#123;vhost&#125;/&#123;queuename&#125;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å¯¹æ¶ˆæ¯æœ¬èº«è¿›è¡Œå•ç‹¬è®¾ç½®</strong>ï¼Œä¸¤ç§ä¸€èµ·ä½¿ç”¨ä»¥è¾ƒå°çš„å€¼ä¸ºå‡†ã€‚</p><ul><li><p>åœ¨ <code>channel.basicPublish()</code> ä¸­åŠ å…¥ expiration å±æ€§å‚æ•°ï¼Œå•ä½æ¯«ç§’ï¼š(æ¶ˆæ¯è¿‡æœŸåé©¬ä¸Šä»é˜Ÿåˆ—æŠ¹å»ï¼Œå› ä¸ºè¿‡æœŸæ¶ˆæ¯éƒ½åœ¨é˜Ÿåˆ—å¤´éƒ¨ï¼Œåªè¦å®šæœŸæ‰«æå¤´éƒ¨å¹¶åˆ é™¤å³å¯)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AMQP.BasicProperties.Builder builder = <span class="keyword">new</span> AMQP.BasicProperties.Builder();</span><br><span class="line"><span class="comment">// æŒä¹…åŒ–æ¶ˆæ¯</span></span><br><span class="line">builder.deliveryMode(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®TTL=60000ms</span></span><br><span class="line">builder.expiration(<span class="string">"60000"</span>);</span><br><span class="line">AMQP.BasicProperties properties = builder.build();</span><br><span class="line">channel.basicPublish(exchangeName, routingKey, mandatory, properties. <span class="string">"ttlTestMessage"</span>.getBytes());</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AMQP.BasicProperties properties = <span class="keyword">new</span> AMQP.BasicProperties;</span><br><span class="line"><span class="comment">// æŒä¹…åŒ–æ¶ˆæ¯</span></span><br><span class="line">properties.setDeliveryMode(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®TTL=60000ms</span></span><br><span class="line">properties.setExpiration(<span class="string">"60000"</span>);</span><br><span class="line">channel.basicPublish(exchangeName, routingKey, mandatory, properties. <span class="string">"ttlTestMessage"</span>.getBytes());</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡è°ƒç”¨HTTP APIæ¥å£è®¾ç½®ï¼šï¼ˆæ¶ˆæ¯è¿‡æœŸä¸ä¼šé©¬ä¸ŠæŠ¹å»ï¼Œå› ä¸ºæ¯æ¡æ¶ˆæ¯è¿‡æœŸæ—¶é—´ä¸åŒï¼Œéœ€è¦æ‰«ææ•´ä¸ªé˜Ÿåˆ—ï¼Œä¸å¦‚ç­‰è¢«æ¶ˆè´¹æ—¶å†åšåˆ¤æ–­ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -i -u root:root -H <span class="string">"content-type:application/json"</span>-X POST -d<span class="string">'&#123;"properties":&#123;"expiration":"60000"&#125;,"routing_key":"routingKey","payload":"my body","payload_encoding":"string"&#125;'</span> http://localhost:15672/api/queues/&#123;vhost&#125;/&#123;exchange</span></span><br><span class="line">name&#125;/publish</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­ç”Ÿå­˜æ—¶é—´è¶…è¿‡TTLæ—¶ï¼Œä¼šå˜æˆâ€œæ­»ä¿¡â€ï¼ˆDead Messageï¼‰ã€‚ä¸è®¾ç½®TTLï¼Œé»˜è®¤ä¸ä¼šè¿‡æœŸï¼›è‹¥è®¾ç½®ä¸º0ï¼Œåˆ™è¡¨ç¤ºç›´æ¥æŠ•é€’åˆ°æ¶ˆè´¹è€…ï¼Œå¦åˆ™ç›´æ¥ä¸¢å¼ƒï¼Œå¯ä»¥éƒ¨åˆ†æ›¿ä»£ä¸Šæ–‡æ‰€æ immediate å‚æ•°ï¼Œä½†æ²¡æœ‰ <code>Basic.Return</code> è¿”å›æ¶ˆæ¯ï¼ˆå¯ä»¥é€šè¿‡æ­»ä¿¡é˜Ÿåˆ—æ¥å®ç°ï¼‰ã€‚</p><h3 id="2-2-è®¾ç½®é˜Ÿåˆ—çš„TTL"><a href="#2-2-è®¾ç½®é˜Ÿåˆ—çš„TTL" class="headerlink" title="2.2 è®¾ç½®é˜Ÿåˆ—çš„TTL"></a>2.2 è®¾ç½®é˜Ÿåˆ—çš„TTL</h3><p>é€šè¿‡ <code>channel.queueDeclare()</code> æ–¹æ³•ä¸­çš„ <code>x-expires</code> å‚æ•°å¯ä»¥æ§åˆ¶é˜Ÿåˆ—è¢«è‡ªåŠ¨åˆ é™¤å‰å¤„äºæœªä½¿ç”¨çŠ¶æ€çš„æ—¶é—´ã€‚æœªä½¿ç”¨çš„æ„æ€æ˜¯é˜Ÿåˆ—ä¸Šæ²¡æœ‰ä»»ä½•çš„æ¶ˆè´¹è€…ï¼Œé˜Ÿåˆ—ä¹Ÿæ²¡æœ‰è¢«é‡æ–°å£°æ˜ï¼Œå¹¶ä¸”åœ¨è¿‡æœŸæ—¶é—´æ®µå†…ä¹Ÿæœªè°ƒç”¨è¿‡ <code>Basic.Get</code> å‘½ä»¤ã€‚</p><p>è®¾ç½®é˜Ÿåˆ—é‡Œçš„ TTL å¯ä»¥åº”ç”¨äºç±»ä¼¼ <strong>RPC æ–¹å¼çš„å›å¤é˜Ÿåˆ—</strong>ï¼Œåœ¨ RPC ä¸­ï¼Œè®¸å¤šé˜Ÿåˆ—ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œä½†æ˜¯å´æ˜¯æœªè¢«ä½¿ç”¨çš„ã€‚RabbitMQ ä¼šç¡®ä¿åœ¨è¿‡æœŸæ—¶é—´åˆ°è¾¾åå°†é˜Ÿåˆ—åˆ é™¤ï¼Œä½†æ˜¯ä¸ä¿éšœåˆ é™¤çš„åŠ¨ä½œæœ‰å¤šåŠæ—¶ ã€‚</p><p>åˆ›å»ºä¸€ä¸ªè¿‡æœŸæ—¶é—´ä¸º30åˆ†é’Ÿçš„é˜Ÿåˆ—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">args.put(<span class="string">"x-expires"</span>, <span class="number">1800000</span>);</span><br><span class="line">channel.queueDeclare(queueName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, args);</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰èŠ‚-æ­»ä¿¡é˜Ÿåˆ—"><a href="#ç¬¬ä¸‰èŠ‚-æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="ç¬¬ä¸‰èŠ‚ æ­»ä¿¡é˜Ÿåˆ—"></a>ç¬¬ä¸‰èŠ‚ æ­»ä¿¡é˜Ÿåˆ—</h2><h3 id="3-1-æ­»ä¿¡äº¤æ¢å™¨å’Œæ­»ä¿¡é˜Ÿåˆ—"><a href="#3-1-æ­»ä¿¡äº¤æ¢å™¨å’Œæ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="3.1 æ­»ä¿¡äº¤æ¢å™¨å’Œæ­»ä¿¡é˜Ÿåˆ—"></a>3.1 æ­»ä¿¡äº¤æ¢å™¨å’Œæ­»ä¿¡é˜Ÿåˆ—</h3><p>æ­»ä¿¡äº¤æ¢å™¨ï¼ˆDead-Letter-Exchangeï¼ŒDLXï¼‰ä¹Ÿå¯ç§°ä¸ºæ­»ä¿¡é‚®ç®±ã€‚å½“æ¶ˆæ¯åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ï¼ˆdead messageï¼‰ï¼Œèƒ½è¢«é‡æ–°è¢«å‘é€åˆ°å¦ä¸€äº¤æ¢å™¨ï¼Œè¿™ä¸ªäº¤æ¢å™¨å°±æ˜¯DLXï¼Œç»‘å®šDLXçš„é˜Ÿåˆ—å°±æ˜¯æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>DLXå’Œæ™®é€šäº¤æ¢å™¨æ²¡åŒºåˆ«ï¼Œå½“è®¾ç½®çš„é˜Ÿåˆ—å­˜åœ¨æ­»ä¿¡æ—¶ï¼Œä¼šè‡ªåŠ¨çš„è¢«å‘å¸ƒåˆ°è®¾ç½®çš„DLXä¸Šï¼Œè¿›è€Œè·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥å’ŒTTLä¸º0é…åˆæ›¿ä»£ immediate å‚æ•°ã€‚</p><h3 id="3-2-æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡çš„åŸå› "><a href="#3-2-æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡çš„åŸå› " class="headerlink" title="3.2 æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡çš„åŸå› "></a>3.2 æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡çš„åŸå› </h3><ul><li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆ <code>Basic.Reject</code> / <code>Basic.Nack</code> ï¼‰ï¼Œäº•ä¸”è®¾ç½® requeue å‚æ•°ä¸º false;</li><li>æ¶ˆæ¯è¿‡æœŸï¼›</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ã€‚</li></ul><h3 id="3-3-å®ç°æ–¹å¼"><a href="#3-3-å®ç°æ–¹å¼" class="headerlink" title="3.3 å®ç°æ–¹å¼"></a>3.3 å®ç°æ–¹å¼</h3><ul><li><p>é€šè¿‡ <code>channel.queueDeclare()</code> æ–¹æ³•ä¸­è®¾ç½® <code>x-dead-letter-exchange</code> å‚æ•°æ¥ä¸ºé˜Ÿåˆ—æ·»åŠ DLXï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºDLX</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">"dlx_exchange"</span>, <span class="string">"direct"</span>);</span><br><span class="line"><span class="comment">//é€šè¿‡</span></span><br><span class="line">Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;String, Object&gt;;</span><br><span class="line">args.put(<span class="string">"x-dead-letter-exchange"</span>, <span class="string">" dlx_exchange "</span>);</span><br><span class="line"><span class="comment">//ä¹Ÿå¯ä»¥ä¸ºDLXæŒ‡å®šè·¯ç”±é”®ï¼Œé»˜è®¤ä¸ºåŸé˜Ÿåˆ—çš„è·¯ç”±é”®</span></span><br><span class="line">args.put(<span class="string">"x-dead-letter-routing-key"</span>, <span class="string">"dlx-routing-key"</span>);</span><br><span class="line"><span class="comment">//ä¸ºé˜Ÿåˆ—myqueueæ·»åŠ DLX</span></span><br><span class="line">channel.queueDeclare(<span class="string">"myqueue"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, args);</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>é€šè¿‡ç­–ç•¥-Policyæ¥è®¾ç½®TTLï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rabbitmqctl set_policy DLX <span class="string">".*"</span> <span class="string">'&#123;"dead-letter-exchange":" dlx_exchange "&#125;'</span> --apply-to queues</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="3-4-è¿‡ç¨‹"><a href="#3-4-è¿‡ç¨‹" class="headerlink" title="3.4 è¿‡ç¨‹"></a>3.4 è¿‡ç¨‹</h3><p>ç”Ÿäº§è€…é¦–å…ˆå‘é€ä¸€æ¡æºå¸¦è·¯ç”±é”®ä¸º <code>rk</code> çš„æ¶ˆæ¯ï¼Œç„¶åç»è¿‡äº¤æ¢å™¨ <code>exchange.normal</code> é¡ºåˆ©åœ°å­˜å‚¨åˆ°é˜Ÿåˆ— <code>queue.normal</code> ã€‚ç”±äºé˜Ÿåˆ— <code>queue.normal</code> è®¾ç½®äº†è¿‡æœŸæ—¶é—´ä¸º 10s ï¼Œåœ¨è¿™ 10s å†…æ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆåˆ¤å®šè¿™æ¡æ¶ˆæ¯ä¸ºè¿‡æœŸã€‚ç”±äºè®¾ç½®äº† DLX ï¼Œè¿‡æœŸä¹‹æ—¶ï¼Œæ¶ˆæ¯è¢«ä¸¢ç»™äº¤æ¢å™¨ <code>exchange.dlx</code> ä¸­ï¼Œè¿™æ—¶æ‰¾åˆ°ä¸ <code>exchange.dlx</code> åŒ¹é…çš„é˜Ÿåˆ— <code>queue.dlx</code> åæ¶ˆæ¯è¢«å­˜å‚¨åœ¨ <code>queue.dlx</code> è¿™ä¸ªæ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010167.png" alt></p><h3 id="3-5-ä½œç”¨"><a href="#3-5-ä½œç”¨" class="headerlink" title="3.5 ä½œç”¨"></a>3.5 ä½œç”¨</h3><p>DLX æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥å¤„ç†å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯ä¸èƒ½å¤Ÿè¢«æ¶ˆè´¹è€…æ­£ç¡®æ¶ˆè´¹ï¼ˆæ¶ˆè´¹è€…è°ƒç”¨äº† <code>Basic.Nack</code> æˆ–è€… <code>Basic.Reject</code> ï¼‰è€Œè¢«ç½®å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æƒ…å†µï¼Œåç»­åˆ†æç¨‹åºå¯ä»¥<strong>é€šè¿‡æ¶ˆè´¹è¿™ä¸ªæ­»ä¿¡é˜Ÿåˆ—ä¸­çš„å†…å®¹æ¥åˆ†æå½“æ—¶æ‰€é‡åˆ°çš„å¼‚å¸¸æƒ…å†µï¼Œè¿›è€Œå¯ä»¥æ”¹å–„å’Œä¼˜åŒ–ç³»ç»Ÿ</strong>ã€‚</p><p><strong>DLX é…åˆ TTL ä½¿ç”¨è¿˜å¯ä»¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½</strong>ã€‚</p><h2 id="ç¬¬å››èŠ‚-å»¶è¿Ÿé˜Ÿåˆ—"><a href="#ç¬¬å››èŠ‚-å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="ç¬¬å››èŠ‚ å»¶è¿Ÿé˜Ÿåˆ—"></a>ç¬¬å››èŠ‚ å»¶è¿Ÿé˜Ÿåˆ—</h2><h3 id="4-1-å»¶è¿Ÿæ¶ˆæ¯"><a href="#4-1-å»¶è¿Ÿæ¶ˆæ¯" class="headerlink" title="4.1 å»¶è¿Ÿæ¶ˆæ¯"></a>4.1 å»¶è¿Ÿæ¶ˆæ¯</h3><p>å»¶è¿Ÿé˜Ÿåˆ—å­˜å‚¨çš„å¯¹è±¡æ˜¯å¯¹åº”çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œæ‰€è°“<strong>â€œå»¶è¿Ÿæ¶ˆæ¯â€æ˜¯æŒ‡å½“æ¶ˆæ¯è¢«å‘é€ä»¥åï¼Œå¹¶ä¸æƒ³è®©æ¶ˆè´¹è€…ç«‹åˆ»æ‹¿åˆ°æ¶ˆæ¯ï¼Œè€Œæ˜¯ç­‰å¾…ç‰¹å®šæ—¶é—´åï¼Œæ¶ˆè´¹è€…æ‰èƒ½æ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹</strong>ã€‚</p><h3 id="4-2-ä½¿ç”¨åœºæ™¯"><a href="#4-2-ä½¿ç”¨åœºæ™¯" class="headerlink" title="4.2 ä½¿ç”¨åœºæ™¯"></a>4.2 ä½¿ç”¨åœºæ™¯</h3><ul><li><strong>æ”¯ä»˜è¶…æ—¶</strong>ï¼šåœ¨è®¢å•ç³»ç»Ÿä¸­ï¼Œ ä¸€ä¸ªç”¨æˆ·ä¸‹å•ä¹‹åé€šå¸¸æœ‰30åˆ†é’Ÿçš„æ—¶é—´è¿›è¡Œæ”¯ä»˜ï¼Œå¦‚æœ30åˆ†é’Ÿä¹‹å†…æ²¡æœ‰æ”¯ä»˜æˆåŠŸï¼Œé‚£ä¹ˆè¿™ä¸ªè®¢å•å°†è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ¥å¤„ç†è¿™äº›è®¢å•äº†ã€‚</li><li><strong>å®šæ—¶åŠŸèƒ½</strong>ï¼šç”¨æˆ·å¸Œæœ›é€šè¿‡æ‰‹æœºè¿œç¨‹é¥æ§å®¶é‡Œçš„æ™ºèƒ½è®¾å¤‡åœ¨æŒ‡å®šçš„æ—¶é—´è¿›è¡Œå·¥ä½œã€‚è¿™æ—¶å€™å°±å¯ä»¥å°†ç”¨æˆ·æŒ‡ä»¤å‘é€åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå½“æŒ‡ä»¤è®¾å®šçš„æ—¶é—´åˆ°äº†å†å°†æŒ‡ä»¤æ¨é€åˆ°æ™ºèƒ½è®¾å¤‡ã€‚</li></ul><h3 id="4-3-å®ç°æ–¹å¼"><a href="#4-3-å®ç°æ–¹å¼" class="headerlink" title="4.3 å®ç°æ–¹å¼"></a>4.3 å®ç°æ–¹å¼</h3><p>åœ¨ AMQP åè®®ä¸­ï¼Œæˆ–è€… RabbitMQ æœ¬èº«æ²¡æœ‰ç›´æ¥æ”¯æŒå»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å‰é¢æ‰€ä»‹ç»çš„ <strong>DLX + TTL æ¨¡æ‹Ÿå‡ºå»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½</strong>ã€‚</p><p>å›¾4-4ä¸ä»…å±•ç¤ºçš„æ˜¯æ­»ä¿¡é˜Ÿåˆ—çš„ç”¨æ³•ï¼Œä¹Ÿæ˜¯å»¶è¿Ÿé˜Ÿåˆ—çš„ç”¨æ³•ï¼Œ <code>queue.dlx</code> è¿™ä¸ªæ­»ä¿¡é˜Ÿåˆ—å¯ä»¥çœ‹ä½œå»¶è¿Ÿé˜Ÿåˆ—ã€‚å‡è®¾ä¸€ä¸ªåº”ç”¨ä¸­éœ€è¦å°†æ¯æ¡æ¶ˆæ¯éƒ½è®¾ç½®ä¸º 10 ç§’çš„å»¶è¿Ÿï¼Œ ç”Ÿäº§è€…é€šè¿‡ <code>exchange.normal</code> è¿™ä¸ªäº¤æ¢å™¨å°†å‘é€çš„æ¶ˆæ¯å­˜å‚¨åœ¨ <code>queue.normal</code> è¿™ä¸ªé˜Ÿåˆ—ä¸­ã€‚æ¶ˆè´¹è€…è®¢é˜…çš„å¹¶éæ˜¯ <code>queue.normal</code> è¿™ä¸ªé˜Ÿåˆ—ï¼Œè€Œæ˜¯ <code>queue.dlx</code> è¿™ä¸ªé˜Ÿåˆ— ã€‚å½“æ¶ˆæ¯ä» <code>queue.normal</code> è¿™ä¸ªé˜Ÿåˆ—ä¸­è¿‡æœŸä¹‹åè¢«å­˜å…¥ <code>queue.dlx</code> è¿™ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…å°±æ°å·§æ¶ˆè´¹åˆ°äº†å»¶è¿Ÿ 10 ç§’çš„è¿™æ¡æ¶ˆæ¯ã€‚</p><p>åœ¨çœŸå®åº”ç”¨ä¸­ï¼Œå¯¹äºå»¶è¿Ÿé˜Ÿåˆ—å¯ä»¥æ ¹æ®å»¶è¿Ÿæ—¶é—´çš„é•¿çŸ­åˆ†ä¸ºå¤šä¸ªç­‰çº§ï¼Œä¸€èˆ¬åˆ†ä¸º 5ç§’ã€10 ç§’ã€30 ç§’ã€ 1åˆ†é’Ÿã€5åˆ†é’Ÿã€10 åˆ†é’Ÿã€30 åˆ†é’Ÿã€ 1å°æ—¶è¿™å‡ ä¸ªç»´åº¦ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å†ç»†åŒ–ä¸€ä¸‹ã€‚</p><p>å›¾4-5ä¸ºäº†ç®€åŒ–è¯´æ˜ï¼Œè¿™é‡Œåªè®¾ç½®äº†5ç§’ã€10 ç§’ã€30 ç§’ã€1åˆ†é’Ÿè¿™å››ä¸ªç­‰çº§ã€‚æ ¹æ®åº”ç”¨éœ€æ±‚çš„ä¸åŒï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™é€šè¿‡è®¾ç½®ä¸åŒçš„è·¯ç”±é”®ï¼Œä»¥æ­¤å°†æ¶ˆæ¯å‘é€åˆ°ä¸äº¤æ¢å™¨ç»‘å®šçš„ä¸åŒçš„é˜Ÿåˆ—ä¸­ã€‚è¿™é‡Œé˜Ÿåˆ—åˆ†åˆ«è®¾ç½®äº†è¿‡æœŸæ—¶é—´ä¸º5ç§’ã€10 ç§’ã€30 ç§’ã€1åˆ†é’Ÿï¼ŒåŒæ—¶ä¹Ÿåˆ†åˆ«é…ç½®äº† DLX å’Œç›¸åº”çš„æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>å½“ç›¸åº”çš„æ¶ˆæ¯è¿‡æœŸæ—¶ï¼Œå°±ä¼šè½¬å­˜åˆ°ç›¸åº”çš„æ­»ä¿¡é˜Ÿåˆ—ï¼ˆå³å»¶è¿Ÿé˜Ÿåˆ—ã€‰ä¸­ï¼Œè¿™æ ·æ¶ˆè´¹è€…æ ¹æ®ä¸šåŠ¡è‡ªèº«çš„æƒ…å†µï¼Œåˆ†åˆ«é€‰æ‹©ä¸åŒå»¶è¿Ÿç­‰çº§çš„å»¶è¿Ÿé˜Ÿåˆ—è¿›è¡Œæ¶ˆè´¹ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010168.png" alt></p><h2 id="ç¬¬äº”èŠ‚-ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#ç¬¬äº”èŠ‚-ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="ç¬¬äº”èŠ‚ ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>ç¬¬äº”èŠ‚ ä¼˜å…ˆçº§é˜Ÿåˆ—</h2><p>ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œé¡¾åæ€ä¹‰ï¼Œå…·æœ‰é«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—å…·æœ‰é«˜çš„ä¼˜å…ˆæƒï¼Œä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯å…·å¤‡ä¼˜å…ˆè¢«æ¶ˆè´¹çš„ç‰¹æƒã€‚</p><p>å¯ä»¥é€šè¿‡è®¾ç½®é˜Ÿåˆ—çš„ <code>x-max-priority</code> å‚æ•°æ¥å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½®ä¸€ä¸ªé˜Ÿåˆ—çš„æœ€å¤§ä¼˜å…ˆçº§</span></span><br><span class="line">Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">args.put(<span class="string">"x-rnax-priority"</span>, <span class="number">10</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">"queue.priority"</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, args); </span><br><span class="line"><span class="comment">// éœ€è¦åœ¨å‘é€æ—¶åœ¨æ¶ˆæ¯ä¸­è®¾ç½®æ¶ˆæ¯å½“å‰çš„ä¼˜å…ˆçº§</span></span><br><span class="line">AMQP.BasicProperties.Builder builder = <span class="keyword">new</span> AMQP.BasicProperties.Builder();</span><br><span class="line">builder.priority(<span class="number">5</span>);</span><br><span class="line">AMQP.BasicProperties properties = bulder.build();</span><br><span class="line">channel.basicPublish(<span class="string">"exchange_priority"</span>, <span class="string">"rk_priority"</span>, properties, (<span class="string">"messages"</span>).getBytes());</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­è®¾ç½®æ¶ˆæ¯çš„ä¼˜å…ˆçº§ä¸º5ã€‚é»˜è®¤æœ€ä½ä¸º0ï¼Œæœ€é«˜ä¸ºé˜Ÿåˆ—è®¾ç½®çš„æœ€å¤§ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯å¯ä»¥è¢«ä¼˜å…ˆæ¶ˆè´¹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æœ‰å‰æçš„ï¼›å¦‚æœåœ¨æ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦å¤§äºç”Ÿäº§è€…çš„é€Ÿåº¦ä¸” Broker ä¸­æ²¡æœ‰æ¶ˆæ¯å †ç§¯çš„æƒ…å†µä¸‹ï¼Œå¯¹å‘é€çš„æ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§ä¹Ÿå°±æ²¡æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ã€‚å› ä¸ºç”Ÿäº§è€…åˆšå‘é€å®Œä¸€æ¡æ¶ˆæ¯å°±è¢«æ¶ˆè´¹è€…æ¶ˆè´¹äº†ï¼Œé‚£ä¹ˆå°±ç›¸å½“äº Broker ä¸­è‡³å¤šåªæœ‰ä¸€æ¡æ¶ˆæ¯ï¼Œå¯¹äºå•æ¡æ¶ˆæ¯æ¥è¯´ä¼˜å…ˆçº§æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ã€‚</p><h2 id="ç¬¬å…­èŠ‚-RPCå®ç°"><a href="#ç¬¬å…­èŠ‚-RPCå®ç°" class="headerlink" title="ç¬¬å…­èŠ‚ RPCå®ç°"></a>ç¬¬å…­èŠ‚ RPCå®ç°</h2><h3 id="6-1-ä»€ä¹ˆæ˜¯RPCï¼Ÿ"><a href="#6-1-ä»€ä¹ˆæ˜¯RPCï¼Ÿ" class="headerlink" title="6.1 ä»€ä¹ˆæ˜¯RPCï¼Ÿ"></a>6.1 ä»€ä¹ˆæ˜¯RPCï¼Ÿ</h3><p>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼ŒRPCï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œçš„æŠ€æœ¯ã€‚ RPCçš„ä¸»è¦åŠŸç”¨æ˜¯è®©æ„å»ºåˆ†å¸ƒå¼è®¡ç®—æ›´å®¹æ˜“ï¼Œåœ¨æä¾›å¼ºå¤§çš„è¿œç¨‹è°ƒç”¨èƒ½åŠ›æ—¶ä¸æŸå¤±æœ¬åœ°è°ƒç”¨çš„è¯­ä¹‰ç®€æ´æ€§ã€‚</p><p>é€šä¿—ç‚¹æ¥è¯´ï¼Œå‡è®¾æœ‰ä¸¤å°æœåŠ¡å™¨Aå’ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„å‡½æ•°æˆ–è€…æ–¹æ³•ï¼Œç”±äºä¸åœ¨åŒä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚</p><p>RPCçš„åè®®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æœ€æ—©çš„ CORBAã€Java RMIã€WebServiceçš„RPCé£æ ¼ã€ Hessianã€Thriftã€Dubboç­‰ï¼Œç”šè‡³è¿˜æœ‰ Restful APIã€‚</p><h3 id="6-2-RabbitMQå¦‚ä½•è¿›è¡ŒRPC"><a href="#6-2-RabbitMQå¦‚ä½•è¿›è¡ŒRPC" class="headerlink" title="6.2 RabbitMQå¦‚ä½•è¿›è¡ŒRPC"></a>6.2 RabbitMQå¦‚ä½•è¿›è¡ŒRPC</h3><p>ä¸€èˆ¬åœ¨ RabbitMQ ä¸­è¿›è¡Œ RPC æ˜¯å¾ˆç®€å•ã€‚å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯å›å¤å“åº”çš„æ¶ˆæ¯ã€‚ä¸ºäº†æ¥æ”¶å“åº”çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€<strong>è¦åœ¨è¯·æ±‚æ¶ˆæ¯ä¸­å‘é€ä¸€ä¸ªå›è°ƒé˜Ÿåˆ—</strong>ï¼ˆå‚è€ƒä¸‹é¢ä»£ç ä¸­çš„ replyTo å¯ä»¥ä½¿ç”¨é»˜è®¤çš„é˜Ÿåˆ—ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String callbackQueueName = channel.queueDeclare().getQueue();</span><br><span class="line">BasicProperties props = <span class="keyword">new</span> BasicProperties.Bulder().replyTo(callbackQueueName).build();</span><br><span class="line">channel.basicPublish (<span class="string">""</span>,<span class="string">"rpc_queue"</span>, props, message.getBytes());</span><br><span class="line"><span class="comment">// then code to read a response message from the callback_queue ...</span></span><br></pre></td></tr></table></figure><p>BasicPropertiesåŒ…å«14ä¸ªå±æ€§ï¼Œè¿™é‡Œä¸»è¦ç”¨åˆ°ä¸¤ä¸ªï¼š</p><ul><li>replyToï¼šé€šå¸¸ç”¨æ¥è®¾ç½®ä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ï¼›</li><li>correlationIdï¼šç”¨æ¥å…³è”è¯·æ±‚ï¼ˆrequestï¼‰å’Œå…¶è°ƒç”¨ RPC ä¹‹åçš„å›å¤ï¼ˆresponseï¼‰ã€‚</li></ul><p>ä¸Šè¿°ä»£ç ä¸­ä¸ºæ¯ä¸ª RPC è¯·æ±‚åˆ›å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—æ˜¯éå¸¸ä½æ•ˆçš„ã€‚é€šç”¨çš„è§£å†³æ–¹æ¡ˆä¸€ä¸€<strong>å¯ä»¥ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªå•ä¸€çš„å›è°ƒé˜Ÿåˆ—</strong>ã€‚</p><p>è¿™æ ·å°±äº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå¯¹äºå›è°ƒé˜Ÿåˆ—è€Œè¨€ï¼Œåœ¨å…¶æ¥æ”¶åˆ°ä¸€æ¡å›å¤çš„æ¶ˆæ¯ä¹‹åï¼Œå®ƒå¹¶ä¸çŸ¥é“è¿™æ¡æ¶ˆæ¯åº”è¯¥å’Œå“ªä¸€ä¸ªè¯·æ±‚åŒ¹é…ã€‚è¿™é‡Œå°±ç”¨åˆ° correlationId è¿™ä¸ªå±æ€§äº†ï¼Œæˆ‘ä»¬åº”è¯¥<strong>ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚è®¾ç½®ä¸€ä¸ªå”¯ä¸€çš„ correlationId</strong> ã€‚ä¹‹å<strong>åœ¨å›è°ƒé˜Ÿåˆ—æ¥æ”¶åˆ°å›å¤çš„æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ªå±æ€§åŒ¹é…åˆ°ç›¸åº”çš„è¯·æ±‚</strong>ã€‚å¦‚æœå›è°ƒé˜Ÿåˆ—æ¥æ”¶åˆ°ä¸€æ¡æœªçŸ¥ correlationId çš„å›å¤æ¶ˆæ¯ï¼Œå¯ä»¥ç®€å•åœ°å°†å…¶ä¸¢å¼ƒã€‚</p><p>ç–‘é—®ï¼š</p><ul><li>ä¸ºä»€ä¹ˆè¦å°†å›è°ƒé˜Ÿåˆ—ä¸­çš„ä½ç½®æ¶ˆæ¯ä¸¢å¼ƒè€Œä¸æ˜¯ä»…ä»…å°†å…¶çœ‹ä½œå¤±è´¥ï¼Ÿ</li><li><strong>è¿™æ ·å¯ä»¥é’ˆå¯¹è¿™ä¸ªå¤±è´¥åšä¸€äº›å¼¥è¡¥æªæ–½</strong>ã€‚</li></ul><p>å‚è€ƒå›¾ 4-7 è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼šRPC æœåŠ¡å™¨å¯èƒ½åœ¨å‘é€ç»™å›è°ƒé˜Ÿåˆ—ï¼ˆ <code>amq.gen-LhQzlgv3GhDOv8PIDabOXA</code> ï¼‰å¹¶ä¸”åœ¨ç¡®è®¤æ¥æ”¶åˆ°è¯·æ±‚æ¶ˆæ¯ï¼ˆrpc_queueä¸­çš„æ¶ˆæ¯ï¼‰ä¹‹åæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆåªéœ€é‡å¯ä¸‹ RPC æœåŠ¡å™¨å³å¯ï¼ŒRPC æœåŠ¡ä¼šé‡æ–°æ¶ˆè´¹ rpc_queue é˜Ÿåˆ—ä¸­çš„è¯·æ±‚ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç° RPC æœåŠ¡ç«¯æœªå¤„ç†è¯·æ±‚çš„æƒ…å†µã€‚è¿™é‡Œçš„å›è°ƒé˜Ÿåˆ—å¯èƒ½ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯çš„æƒ…å†µï¼Œè¿™éœ€è¦å®¢æˆ·ç«¯èƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†è¿™ç§æƒ…å†µï¼Œå¹¶ä¸” RPC è¯·æ±‚éœ€è¦ä¿è¯å…¶æœ¬èº«æ˜¯å¹‚ç­‰çš„ï¼ˆè¡¥å……ï¼š<strong>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ä¸€èˆ¬æ˜¯å…ˆå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå†ä½¿ç”¨ <code>Basic.Ack</code> ç¡®è®¤å·±æ¥æ”¶åˆ°æ¶ˆæ¯ä»¥é˜²æ­¢æ¶ˆæ¯ä¸å¿…è¦åœ°ä¸¢å¤±</strong>ï¼‰ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010169.png" alt></p><h3 id="6-3-RPCå¤„ç†æµç¨‹"><a href="#6-3-RPCå¤„ç†æµç¨‹" class="headerlink" title="6.3 RPCå¤„ç†æµç¨‹"></a>6.3 RPCå¤„ç†æµç¨‹</h3><p>RPCçš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å½“å®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªåŒ¿åçš„å›è°ƒé˜Ÿåˆ—ï¼ˆåç§°ç”± RabbitMQ è‡ªåŠ¨åˆ›å»ºï¼Œå¦‚å›¾4-7çš„å›è°ƒé˜Ÿåˆ—ä¸º <code>amq.gen-LhQzlgv3GhDOv8PIDabOXA</code> ï¼‰ã€‚</li><li>å®¢æˆ·ç«¯ä¸º RPC è¯·æ±‚è®¾ç½®2ä¸ªå±æ€§ï¼šreplyTo-ç”¨æ¥å‘ŠçŸ¥ RPC æœåŠ¡ç«¯å›å¤è¯·æ±‚æ—¶çš„ç›®çš„é˜Ÿåˆ—ï¼Œå³å›è°ƒé˜Ÿåˆ—ï¼› correlationId-ç”¨æ¥æ ‡è®°ä¸€ä¸ªè¯·æ±‚ã€‚</li><li>è¯·æ±‚è¢«å‘é€åˆ° rpc_queue é˜Ÿåˆ—ä¸­ã€‚</li><li>RPC æœåŠ¡ç«¯ç›‘å¬ rpc_queue é˜Ÿåˆ—ä¸­çš„è¯·æ±‚ï¼Œå½“è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå¤„ç†å¹¶ä¸”æŠŠå¸¦æœ‰ç»“æœçš„æ¶ˆæ¯å‘é€ç»™å®¢æˆ·ç«¯ï¼Œæ¥æ”¶çš„é˜Ÿåˆ—å°±æ˜¯ replyTo è®¾å®šçš„å›è°ƒé˜Ÿåˆ—ã€‚</li><li>å®¢æˆ·ç«¯ç›‘å¬å›è°ƒé˜Ÿåˆ—ï¼Œå½“æœ‰æ¶ˆæ¯æ—¶ï¼Œæ£€æŸ¥ correlationId å±æ€§ï¼Œå¦‚æœä¸è¯·æ±‚åŒ¹é…ï¼Œ é‚£å°±æ˜¯ç»“æœäº†ã€‚</li></ol><h3 id="6-4-ç¤ºä¾‹"><a href="#6-4-ç¤ºä¾‹" class="headerlink" title="6.4 ç¤ºä¾‹"></a>6.4 ç¤ºä¾‹</h3><p>ç¤ºä¾‹ï¼šRPCå®¢æˆ·ç«¯é€šè¿‡ RPC æ¥è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•ä»¥ä¾¿å¾—åˆ°ç›¸åº”æ–æ³¢é‚£å¥‘å€¼ã€‚</p><p>æœåŠ¡ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RPCServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String RPC_QUEUE_NQME = <span class="string">"rpc_queue"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IP_ADDRESS = <span class="string">"101.200.124.26"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PORT = <span class="number">5672</span>;<span class="comment">//RabbitMQ æœåŠ¡ç«¯é»˜è®¤ç«¯å£å·ä¸º 5672</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setHost(IP_ADDRESS);</span><br><span class="line">        factory.setPort(PORT);</span><br><span class="line">        factory.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"root"</span>);</span><br><span class="line">        Connection connection = factory.newConnection(); <span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">        Channel channel = connection.createChannel(); <span class="comment">//åˆ›å»ºä¿¡é“</span></span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(RPC_QUEUE_NQME, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">"RPCServer "</span> + LocalTime.now() + <span class="string">" [x] Awaiting RPC requests"</span>);</span><br><span class="line"></span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       Envelope envelope,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       AMQP.BasicProperties properties,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                AMQP.BasicProperties replyProps = <span class="keyword">new</span> AMQP.BasicProperties()</span><br><span class="line">                        .builder()</span><br><span class="line">                        .correlationId(properties.getCorrelationId())</span><br><span class="line">                        .build();</span><br><span class="line">                String response = <span class="string">""</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    String message = <span class="keyword">new</span> String(body, <span class="string">"UTF-8"</span>);</span><br><span class="line">                    <span class="keyword">int</span> n = Integer.parseInt(message);</span><br><span class="line">                    System.out.println(<span class="string">"RPCServer "</span> + LocalTime.now() + <span class="string">" [.] fib("</span> + message + <span class="string">")"</span>);</span><br><span class="line">                    response += fib(n);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"RPCServer "</span> + LocalTime.now() + <span class="string">" [.] "</span> + e.toString());</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    channel.basicPublish(<span class="string">""</span>, properties.getReplyTo(),</span><br><span class="line">                            replyProps, response.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">                    channel.basicAck(envelope.getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(RPC_QUEUE_NQME, <span class="keyword">false</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> fib(n - <span class="number">1</span>) + fib(n - <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RPCClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Connection connection;</span><br><span class="line">    <span class="keyword">private</span> Channel channel;</span><br><span class="line">    <span class="keyword">private</span> String requestQueueName = <span class="string">"rpc_queue"</span>;</span><br><span class="line">    <span class="keyword">private</span> String replyQueueName;</span><br><span class="line">    <span class="keyword">private</span> MyConsumer consumer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IP_ADDRESS = <span class="string">"101.200.124.26"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PORT = <span class="number">5672</span>;<span class="comment">//RabbitMQ æœåŠ¡ç«¯é»˜è®¤ç«¯å£å·ä¸º 5672</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RPCClient</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Address[] addresses = <span class="keyword">new</span> Address[]&#123;</span><br><span class="line">                <span class="keyword">new</span> Address(IP_ADDRESS, PORT)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line">        connection = factory.newConnection(addresses); <span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">        channel = connection.createChannel(); <span class="comment">//åˆ›å»ºä¿¡é“</span></span><br><span class="line"></span><br><span class="line">        replyQueueName = channel.queueDeclare().getQueue();</span><br><span class="line">        consumer = <span class="keyword">new</span> MyConsumer(channel);</span><br><span class="line">        channel.basicConsume(replyQueueName, <span class="keyword">true</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(String message)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">            ShutdownSignalException, ConsumerCancelledException,</span></span><br><span class="line"><span class="function">            InterruptedException </span>&#123;</span><br><span class="line">        String response = <span class="keyword">null</span>;</span><br><span class="line">        String corrId = UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">        AMQP.BasicProperties properties = <span class="keyword">new</span> AMQP.BasicProperties()</span><br><span class="line">                .builder()</span><br><span class="line">                .correlationId(corrId)</span><br><span class="line">                .replyTo(replyQueueName)</span><br><span class="line">                .build();</span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, requestQueueName, properties, message.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            MyConsumer.Delivery delivery = consumer.nextDelivery();</span><br><span class="line">            <span class="keyword">if</span>(delivery.getProperties().getCorrelationId().equals(corrId))&#123;</span><br><span class="line">                response = <span class="keyword">new</span> String(delivery.getBody());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        RPCClient fibRpc = <span class="keyword">new</span> RPCClient();</span><br><span class="line">        System.out.println(<span class="string">"RPCClient "</span> + LocalTime.now() + <span class="string">" [x] Requesting fib(30)"</span>);</span><br><span class="line">        String response = fibRpc.call(<span class="string">"30"</span>);</span><br><span class="line">        System.out.println(<span class="string">"RPCClient "</span> + LocalTime.now() + <span class="string">" [.] Got '"</span> + response + <span class="string">"'"</span>);</span><br><span class="line">        fibRpc.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‰ç‰ˆæœ¬MQå·²åºŸå¼ƒQueueingConsumerï¼Œè‡ªå®šä¹‰ä¸€ä¸ªï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConsumer</span> <span class="keyword">extends</span> <span class="title">DefaultConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> LinkedBlockingQueue&lt;Delivery&gt; queue;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyConsumer</span><span class="params">(Channel channel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(channel);</span><br><span class="line">        queue = <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//TODO someting</span></span><br><span class="line">        Delivery delivery = <span class="keyword">new</span> Delivery();</span><br><span class="line">        delivery.setBody(body);</span><br><span class="line">        delivery.setProperties(properties);</span><br><span class="line">        delivery.setEnvelope(envelope);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            queue.put(delivery);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Delivery <span class="title">nextDelivery</span><span class="params">()</span><span class="keyword">throws</span> InterruptedException, ShutdownSignalException, ConsumerCancelledException</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> queue.take();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Delivery <span class="title">nextDelivery</span><span class="params">(<span class="keyword">long</span> timeout)</span><span class="keyword">throws</span> InterruptedException, ShutdownSignalException, ConsumerCancelledException</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> queue.poll(timeout, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Delivery</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> BasicProperties properties;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">byte</span>[] body;</span><br><span class="line">        <span class="keyword">private</span> Envelope envelope;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> BasicProperties <span class="title">getProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> properties;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(BasicProperties properties)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.properties = properties;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">byte</span>[] getBody() &#123;</span><br><span class="line">            <span class="keyword">return</span> body;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBody</span><span class="params">(<span class="keyword">byte</span>[] body)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.body = body;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Envelope <span class="title">getEnvelope</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> envelope;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnvelope</span><span class="params">(Envelope envelope)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.envelope = envelope;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">RPCServer</span> <span class="number">14</span>:<span class="number">20</span>:<span class="number">01.198</span> [x] <span class="symbol">Awaiting</span> <span class="symbol">RPC</span> requests</span><br><span class="line"><span class="symbol">RPCClient</span> <span class="number">14</span>:<span class="number">20</span>:<span class="number">06.135</span> [x] <span class="symbol">Requesting</span> fib(<span class="number">30</span>)</span><br><span class="line"><span class="symbol">RPCServer</span> <span class="number">14</span>:<span class="number">20</span>:<span class="number">07.315</span> [.] fib(<span class="number">30</span>)</span><br><span class="line"><span class="symbol">RPCClient</span> <span class="number">14</span>:<span class="number">20</span>:<span class="number">07.364</span> [.] <span class="symbol">Got</span> <span class="string">'832040'</span></span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸ƒèŠ‚-æŒä¹…åŒ–"><a href="#ç¬¬ä¸ƒèŠ‚-æŒä¹…åŒ–" class="headerlink" title="ç¬¬ä¸ƒèŠ‚ æŒä¹…åŒ–"></a>ç¬¬ä¸ƒèŠ‚ æŒä¹…åŒ–</h2><h3 id="7-1-RabbitMQçš„æŒä¹…åŒ–"><a href="#7-1-RabbitMQçš„æŒä¹…åŒ–" class="headerlink" title="7.1 RabbitMQçš„æŒä¹…åŒ–"></a>7.1 RabbitMQçš„æŒä¹…åŒ–</h3><p>æŒä¹…åŒ–å¯ä»¥æé«˜ RabbitMQ çš„å¯é æ€§ï¼Œä»¥é˜²åœ¨å¼‚å¸¸æƒ…å†µï¼ˆé‡å¯ã€å…³é—­ã€å®¿æœºç­‰ï¼‰ä¸‹çš„æ•°æ®ä¸¢å¤±ã€‚</p><p> RabbitMQ çš„æŒä¹…åŒ–åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>äº¤æ¢å™¨çš„æŒä¹…åŒ–ï¼›</li><li>é˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼›</li><li>æ¶ˆæ¯çš„æŒä¹…åŒ–ã€‚</li></ul><h3 id="7-2-å®ç°æ–¹å¼"><a href="#7-2-å®ç°æ–¹å¼" class="headerlink" title="7.2 å®ç°æ–¹å¼"></a>7.2 å®ç°æ–¹å¼</h3><h4 id="7-2-1-äº¤æ¢å™¨çš„æŒä¹…åŒ–"><a href="#7-2-1-äº¤æ¢å™¨çš„æŒä¹…åŒ–" class="headerlink" title="7.2.1 äº¤æ¢å™¨çš„æŒä¹…åŒ–"></a>7.2.1 äº¤æ¢å™¨çš„æŒä¹…åŒ–</h4><p>äº¤æ¢å™¨çš„æŒä¹…åŒ–æ˜¯<strong>é€šè¿‡åœ¨å£°æ˜é˜Ÿåˆ—æ—¶å°† durable å‚æ•°ç½®ä¸º true å®ç°çš„</strong>ã€‚å¦‚æœäº¤æ¢å™¨ä¸è®¾ç½®æŒä¹…åŒ–ï¼Œé‚£ä¹ˆåœ¨ RabbitMQ æœåŠ¡é‡å¯ä¹‹åï¼Œç›¸å…³çš„äº¤æ¢å™¨å…ƒæ•°æ®ä¼šä¸¢å¤±ï¼Œ ä¸è¿‡æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œåªæ˜¯ä¸èƒ½å°†æ¶ˆæ¯å‘é€åˆ°è¿™ä¸ªäº¤æ¢å™¨ä¸­äº†ã€‚å¯¹äºä¸€ä¸ªé•¿æœŸä½¿ç”¨çš„äº¤æ¢å™¨æ¥è¯´ï¼Œ å»ºè®®å°†å…¶ç½®ä¸ºæŒä¹…åŒ–çš„ã€‚</p><h4 id="7-2-2-é˜Ÿåˆ—çš„æŒä¹…åŒ–"><a href="#7-2-2-é˜Ÿåˆ—çš„æŒä¹…åŒ–" class="headerlink" title="7.2.2 é˜Ÿåˆ—çš„æŒä¹…åŒ–"></a>7.2.2 é˜Ÿåˆ—çš„æŒä¹…åŒ–</h4><p>é˜Ÿåˆ—çš„æŒä¹…åŒ–æ˜¯<strong>é€šè¿‡åœ¨å£°æ˜é˜Ÿåˆ—æ—¶å°† durable å‚æ•°ç½®ä¸º true å®ç°çš„</strong>ã€‚å¦‚æœé˜Ÿåˆ—ä¸è®¾ç½®æŒä¹…åŒ–ï¼Œé‚£ä¹ˆåœ¨ RabbitMQ æœåŠ¡é‡å¯ä¹‹åï¼Œç›¸å…³é˜Ÿåˆ—çš„å…ƒæ•°æ®ä¼šä¸¢å¤±ï¼Œ æ­¤æ—¶æ•°æ®ä¹Ÿä¼šä¸¢å¤± ã€‚æ­£æ‰€è°“ â€œçš®ä¹‹ä¸å­˜ï¼Œæ¯›å°†ç„‰é™„â€ï¼Œé˜Ÿåˆ—éƒ½æ²¡æœ‰äº†ï¼Œæ¶ˆæ¯åˆèƒ½å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><h4 id="7-2-3-æ¶ˆæ¯çš„æŒä¹…åŒ–"><a href="#7-2-3-æ¶ˆæ¯çš„æŒä¹…åŒ–" class="headerlink" title="7.2.3 æ¶ˆæ¯çš„æŒä¹…åŒ–"></a>7.2.3 æ¶ˆæ¯çš„æŒä¹…åŒ–</h4><p>é˜Ÿåˆ—çš„æŒä¹…åŒ–èƒ½ä¿è¯å…¶æœ¬èº«çš„å…ƒæ•°æ®ä¸ä¼šå› å¼‚å¸¸æƒ…å†µè€Œä¸¢å¤±ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å†…éƒ¨æ‰€å­˜å‚¨çš„æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚è¦ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œéœ€è¦å°†å…¶è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚</p><p><strong>é€šè¿‡å°†æ¶ˆæ¯çš„æŠ•é€’æ¨¡å¼ (BasicProperties ä¸­çš„ deliveryMode å±æ€§ï¼‰è®¾ç½®ä¸º2,å³å¯å®ç°æ¶ˆæ¯çš„æŒä¹…åŒ–</strong>ã€‚å‰é¢ç¤ºä¾‹ä¸­å¤šæ¬¡æåŠçš„ <code>MessageProperties.PERSISTENT_TEXT_PLAIN</code> å®é™…ä¸Šæ˜¯å°è£…äº†è¿™ä¸ªå±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BasicProperties PERSISTENT_TEXT_PLAIN = <span class="keyword">new</span> BasicProperties(<span class="string">"text/plain"</span>, (String)<span class="keyword">null</span>, (Map)<span class="keyword">null</span>, <span class="number">2</span>, <span class="number">0</span>, (String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, (Date)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><p>è®¾ç½®äº†é˜Ÿåˆ—å’Œæ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œå½“ RabbitMQ æœåŠ¡é‡å¯ä¹‹åï¼Œæ¶ˆæ¯ä¾æ—§å­˜åœ¨ã€‚å•å•åªè®¾ç½®é˜Ÿåˆ—æŒä¹…åŒ–ï¼Œé‡å¯ä¹‹åæ¶ˆæ¯ä¼šä¸¢å¤±ï¼›å•å•åªè®¾ç½®æ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œé‡å¯ä¹‹åé˜Ÿåˆ—æ¶ˆå¤±ï¼Œç»§è€Œæ¶ˆæ¯ä¹Ÿä¸¢å¤±ã€‚å•å•è®¾ç½®æ¶ˆæ¯æŒä¹…åŒ–è€Œä¸è®¾ç½®é˜Ÿåˆ—çš„æŒä¹…åŒ–æ˜¾å¾—æ¯«æ— æ„ä¹‰ã€‚</p><p>æ³¨æ„è¦ç‚¹ï¼šå¯ä»¥å°†æ‰€æœ‰çš„æ¶ˆæ¯éƒ½è®¾ç›´ä¸ºæŒä¹…åŒ–ï¼Œä½†æ˜¯è¿™æ ·ä¼šä¸¥é‡å½±å“ RabbitMQ çš„æ€§èƒ½ï¼ˆéšæœºï¼‰ã€‚å†™å…¥ç£ç›˜çš„é€Ÿåº¦æ¯”å†™å…¥å†…å­˜çš„é€Ÿåº¦æ…¢å¾—ä¸åªä¸€ç‚¹ç‚¹ã€‚å¯¹äºå¯é æ€§ä¸æ˜¯é‚£ä¹ˆé«˜çš„æ¶ˆæ¯å¯ä»¥ä¸é‡‡ç”¨æŒä¹…åŒ–å¤„ç†ä»¥æé«˜æ•´ä½“çš„ååé‡ã€‚åœ¨é€‰æ‹©æ˜¯å¦è¦å°†æ¶ˆæ¯æŒä¹…åŒ–æ—¶ï¼Œéœ€è¦åœ¨å¯é æ€§å’Œååé‡ä¹‹é—´åšä¸€ ä¸ªæƒè¡¡ã€‚</p><h3 id="7-3-ä¸ºä½•æŒä¹…åŒ–ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Ÿ"><a href="#7-3-ä¸ºä½•æŒä¹…åŒ–ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Ÿ" class="headerlink" title="7.3 ä¸ºä½•æŒä¹…åŒ–ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Ÿ"></a>7.3 ä¸ºä½•æŒä¹…åŒ–ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Ÿ</h3><p>å°†äº¤æ¢å™¨ã€é˜Ÿåˆ—ã€æ¶ˆæ¯éƒ½è®¾ç½®äº†æŒä¹…åŒ–ä¹‹åå°±èƒ½ç™¾åˆ†ä¹‹ç™¾ä¿è¯æ•°æ®ä¸ä¸¢å¤±äº†å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p><p>é¦–å…ˆä»æ¶ˆè´¹è€…æ¥è¯´ï¼Œå¦‚æœåœ¨è®¢é˜…æ¶ˆè´¹é˜Ÿåˆ—æ—¶å°† autoAck å‚æ•°è®¾ç½®ä¸º true ï¼Œé‚£ä¹ˆå½“æ¶ˆè´¹è€…æ¥æ”¶åˆ°ç›¸å…³æ¶ˆæ¯ä¹‹åï¼Œè¿˜æ²¡æ¥å¾—åŠå¤„ç†å°±çœ‹å®•æœºäº†ï¼Œè¿™æ ·ä¹Ÿç®—æ•°æ®ä¸¢å¤±ã€‚è¿™ç§æƒ…å†µå¾ˆå¥½è§£å†³ï¼Œå°† autoAck å‚æ•°è®¾ç½®ä¸º false ï¼Œå¹¶è¿›è¡Œæ‰‹åŠ¨ç¡®è®¤ã€‚</p><p>å…¶æ¬¡ï¼Œåœ¨æŒä¹…åŒ–çš„æ¶ˆæ¯æ­£ç¡®å­˜å…¥ RabbitMQ ä¹‹åï¼Œè¿˜éœ€è¦æœ‰ä¸€æ®µæ—¶é—´ï¼ˆè™½ç„¶å¾ˆçŸ­ï¼Œä½†æ˜¯ä¸å¯å¿½è§†ã€‰æ‰èƒ½å­˜å…¥ç£ç›˜ä¹‹ä¸­ã€‚ RabbitMQ å¹¶ä¸ä¼šä¸ºæ¯æ¡æ¶ˆæ¯éƒ½è¿›è¡ŒåŒæ­¥å­˜ç›˜ï¼ˆè°ƒç”¨å†…æ ¸çš„ <code>fsync</code> æ–¹æ³•ï¼‰çš„å¤„ç†ï¼Œå¯èƒ½ä»…ä»…ä¿å­˜åˆ°æ“ä½œç³»ç»Ÿç¼“å­˜ä¹‹ä¸­è€Œä¸æ˜¯ç‰©ç†ç£ç›˜ä¹‹ä¸­ã€‚å¦‚æœåœ¨è¿™æ®µæ—¶é—´å†… RabbitMQ æœåŠ¡èŠ‚ç‚¹å‘ç”Ÿäº†å²©æœºã€é‡å¯ç­‰å¼‚å¸¸æƒ…å†µï¼Œæ¶ˆæ¯ä¿å­˜è¿˜æ²¡æ¥å¾—åŠè½ç›˜ï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆæ¯å°†ä¼šä¸¢å¤±ã€‚</p><p>è¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¿™é‡Œå¯ä»¥<strong>å¼•å…¥ RabbitMQ é•œåƒé˜Ÿåˆ—æœºåˆ¶</strong>ï¼Œç›¸å½“äºé…ç½®äº†å‰¯æœ¬ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ï¼ˆ master ï¼‰åœ¨æ­¤ç‰¹æ®Šæ—¶é—´å†…æŒ‚æ‰ï¼Œå¯ä»¥è‡ªåŠ¨åˆ‡æ¢åˆ°ä»èŠ‚ç‚¹ï¼ˆslave), è¿™æ ·æœ‰æ•ˆåœ°ä¿è¯äº†é«˜å¯ç”¨æ€§ï¼Œé™¤éæ•´ä¸ªé›†ç¾¤éƒ½æŒ‚æ‰ã€‚è™½ç„¶è¿™æ ·ä¹Ÿä¸èƒ½å®Œå…¨ä¿è¯ RabbitMQ æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä½†æ˜¯é…ç½®äº†é•œåƒé˜Ÿåˆ—è¦æ¯”æ²¡æœ‰é…ç½®é•œåƒé˜Ÿåˆ—çš„å¯é æ€§è¦é«˜å¾ˆå¤šï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„å…³é”®ä¸šåŠ¡é˜Ÿåˆ—ä¸€èˆ¬éƒ½ä¼šè®¾ç½®é•œåƒé˜Ÿåˆ—ã€‚</p><p>è¿˜å¯ä»¥<strong>åœ¨å‘é€ç«¯å¼•å…¥äº‹åŠ¡æœºåˆ¶</strong>æˆ–è€…<strong>å‘é€æ–¹ç¡®è®¤æœºåˆ¶</strong>æ¥ä¿è¯æ¶ˆæ¯å·±ç»æ­£ç¡®åœ°å‘é€å¹¶å­˜å‚¨è‡³ RabbitMQ ä¸­ï¼Œå‰æè¿˜è¦ä¿è¯åœ¨è°ƒç”¨ <code>channel.basicPublish</code> æ–¹æ³•çš„æ—¶å€™äº¤æ¢å™¨èƒ½å¤Ÿå°†æ¶ˆæ¯æ­£ç¡®è·¯ç”±åˆ°ç›¸åº”çš„é˜Ÿåˆ—ä¹‹ä¸­ã€‚</p><h2 id="ç¬¬å…«èŠ‚-ç”Ÿäº§è€…ç¡®è®¤"><a href="#ç¬¬å…«èŠ‚-ç”Ÿäº§è€…ç¡®è®¤" class="headerlink" title="ç¬¬å…«èŠ‚ ç”Ÿäº§è€…ç¡®è®¤"></a>ç¬¬å…«èŠ‚ ç”Ÿäº§è€…ç¡®è®¤</h2><p>åœ¨ä½¿ç”¨ RabbitMQ çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æ¶ˆæ¯æŒä¹…åŒ–æ“ä½œæ¥è§£å†³å› ä¸ºæœåŠ¡å™¨çš„å¼‚å¸¸å´©æºƒè€Œå¯¼è‡´çš„æ¶ˆæ¯ä¸¢å¤±ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>å½“æ¶ˆæ¯çš„ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€å‡ºå»ä¹‹åï¼Œæ¶ˆæ¯åˆ°åº•æœ‰æ²¡æœ‰æ­£ç¡®åœ°åˆ°è¾¾æœåŠ¡å™¨å‘¢ï¼Ÿ</strong></p><p>å¦‚æœä¸è¿›è¡Œç‰¹æ®Šé…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹å‘é€æ¶ˆæ¯çš„æ“ä½œæ˜¯ä¸ä¼šè¿”å›ä»»ä½•ä¿¡æ¯ç»™ç”Ÿäº§è€…çš„ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ç”Ÿäº§è€…æ˜¯ä¸çŸ¥é“æ¶ˆæ¯æœ‰æ²¡æœ‰æ­£ç¡®åœ°åˆ°è¾¾æœåŠ¡å™¨ã€‚å¦‚æœåœ¨æ¶ˆæ¯åˆ°è¾¾æœåŠ¡å™¨ä¹‹å‰å·±ç»ä¸¢å¤±ï¼ŒæŒä¹…åŒ–æ“ä½œä¹Ÿè§£å†³ä¸äº†è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ¶ˆæ¯æ ¹æœ¬æ²¡æœ‰åˆ°è¾¾æœåŠ¡å™¨ï¼Œä½•è°ˆæŒä¹…åŒ–ï¼Ÿ</p><p>RabbitMQ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†ä¸¤ç§è§£å†³æ–¹å¼ï¼š</p><ul><li>é€šè¿‡äº‹åŠ¡æœºåˆ¶å®ç°ï¼›</li><li>é€šè¿‡å‘é€æ–¹ç¡®è®¤ï¼ˆpublisher confirmï¼‰æœºåˆ¶å®ç°ã€‚</li></ul><h3 id="8-1-äº‹åŠ¡æœºåˆ¶"><a href="#8-1-äº‹åŠ¡æœºåˆ¶" class="headerlink" title="8.1 äº‹åŠ¡æœºåˆ¶"></a>8.1 äº‹åŠ¡æœºåˆ¶</h3><p>RabbitMQ å®¢æˆ·ç«¯ä¸­ä¸äº‹åŠ¡æœºåˆ¶ç›¸å…³çš„æ–¹æ³•æœ‰ ä¸ªï¼š</p><ul><li><code>channel.txSelect</code> ï¼šç”¨äºå°†å½“å‰çš„ä¿¡é“è®¾ç½®æˆäº‹åŠ¡æ¨¡å¼ï¼›</li><li><code>channel.txCommit</code> ï¼šç”¨äºæäº¤äº‹åŠ¡ï¼›</li><li><code>channel.txRollback</code> ï¼šç”¨äºäº‹åŠ¡å›æ»šã€‚</li></ul><p>åœ¨é€šè¿‡ channel.txSelect æ–¹æ³•å¼€å¯äº‹åŠ¡ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å‘å¸ƒæ¶ˆæ¯ç»™ RabbitMQ äº†ï¼Œ å¦‚æœäº‹åŠ¡æäº¤æˆåŠŸï¼Œåˆ™æ¶ˆæ¯ä¸€å®šåˆ°è¾¾äº† RabbitMQ ä¸­ï¼Œå¦‚æœåœ¨äº‹åŠ¡æäº¤æ‰§è¡Œä¹‹å‰ç”±äº RabbitMQ å¼‚å¸¸å´©æºƒæˆ–è€…å…¶ä»–åŸå› æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¾¿å¯ä»¥å°†å…¶æ•è·ï¼Œè¿›è€Œé€šè¿‡æ‰§è¡Œ channel.txRollback æ–¹æ³•æ¥å®ç°äº‹åŠ¡å›æ»šã€‚æ³¨æ„è¿™é‡Œçš„ RabbitMQ ä¸­çš„äº‹åŠ¡æœºåˆ¶ä¸å¤§å¤šæ•°æ•°æ®åº“ä¸­çš„äº‹åŠ¡æ¦‚å¿µäº•ä¸ç›¸åŒï¼Œéœ€è¦æ³¨æ„åŒºåˆ†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">channel.txSelect();</span><br><span class="line">channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, MessageProperties.PERSISTENT_TEXT_PLAIN, <span class="string">"transaction messages"</span>.getBytes());</span><br><span class="line">channel.txCommit();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å¯¹åº”çš„ AMQP åè®®æµè½¬è¿‡ç¨‹å¦‚å›¾ 4-8 ç¤ºï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010170.png" alt></p><p>å¯ä»¥å‘ç°å¼€å¯äº‹åŠ¡æœºåˆ¶ä¸ä¸å¼€å¯ï¼ˆå‚è€ƒå›¾2-10ï¼‰ç›¸æ¯”å¤šäº†å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>å®¢æˆ·ç«¯å‘é€ <code>Tx.Select</code> ï¼Œå°†ä¿¡é“ç½®ä¸ºäº‹åŠ¡æ¨¡å¼ï¼›</li><li>Broker å›å¤ <code>Tx Select-Ok</code> ï¼Œç¡®è®¤å·±å°†ä¿¡é“ç½®ä¸ºäº‹åŠ¡æ¨¡å¼ï¼š</li><li>åœ¨å‘é€å®Œæ¶ˆæ¯ä¹‹åï¼Œå®¢æˆ·ç«¯å‘é€ <code>Tx.Commit</code> æäº¤äº‹åŠ¡</li><li>Brokerå›å¤ <code>Tx.Commit-Ok</code> ï¼Œç¡®è®¤äº‹åŠ¡æäº¤ã€‚</li></ul><p>ä¸Šé¢æ‰€é™ˆè¿°çš„æ˜¯æ­£å¸¸çš„æƒ…å†µä¸‹çš„äº‹åŠ¡æœºåˆ¶è¿è½¬è¿‡ç¨‹ï¼Œè€Œäº‹åŠ¡å›æ»šæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥ å‚è€ƒä¸‹é¢ä¸€æ®µç¤ºä¾‹ä»£ç ï¼ˆä»£ç æ¸…å• 4-15 ï¼‰ï¼Œæ¥çœ‹çœ‹æ€ä¹ˆä½¿ç”¨äº‹åŠ¡å›æ»š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">       channel.txSelect();</span><br><span class="line">       channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, MessageProperties.PERSISTENT_TEXT_PLAIN, msg.getBytes());</span><br><span class="line">       <span class="keyword">int</span> result = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">       channel.txCommit();</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">       e.printStackTrace();</span><br><span class="line">       channel.txRollback();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­å¾ˆæ˜æ˜¾æœ‰ä¸€ä¸ª <code>java.lang.ArithmeticException</code> ï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹å‰æ•è·åˆ°å¼‚å¸¸ï¼Œä¹‹åæ˜¾å¼åœ°æäº¤äº‹åŠ¡å›æ»šï¼Œå…¶ AMQP è®®æµè½¬è¿‡ç¨‹å¦‚å›¾ 4-9 æ‰€ç¤ºï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010171.png" alt></p><p>å¦‚æœè¦å‘é€å¤šæ¡æ¶ˆæ¯ï¼Œåˆ™å°† <code>channel.basicPublish</code> å’Œ <code>channel.txCommit</code> ç­‰æ–¹æ³•åŒ…è£¹è¿›å¾ªç¯å†…å³å¯ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">channel.txSelect();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; LOOP_TIMES;i++)&#123;</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, <span class="keyword">null</span>, (<span class="string">"messages"</span> + i).getBytes());</span><br><span class="line">           channel.txCommit();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           channel.txRollback();</span><br><span class="line">       &#125;    </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡ç¡®å®èƒ½å¤Ÿè§£å†³æ¶ˆæ¯å‘é€æ–¹å’Œ RabbitMQ ä¹‹é—´æ¶ˆæ¯ç¡®è®¤çš„é—®é¢˜ï¼Œåªæœ‰æ¶ˆæ¯æˆåŠŸè¢« RabbitMQ æ¥æ”¶ï¼Œäº‹åŠ¡æ‰èƒ½æäº¤æˆåŠŸï¼Œå¦åˆ™ä¾¿å¯åœ¨æ•è·å¼‚å¸¸ä¹‹åè¿›è¡Œäº‹åŠ¡å›æ»šï¼Œä¸æ­¤åŒæ—¶å¯ä»¥è¿›è¡Œæ¶ˆæ¯é‡å‘ã€‚</p><p>ä½†æ˜¯ä½¿ç”¨äº‹åŠ¡æœºåˆ¶ä¼šâ€œå¸å¹²â€ RabbitMQ çš„æ€§èƒ½ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•æ—¢èƒ½ä¿è¯æ¶ˆæ¯å‘é€æ–¹ç¡®è®¤æ¶ˆæ¯å·²ç»æ­£ç¡®é€è¾¾ï¼Œåˆèƒ½åŸºæœ¬ä¸Šä¸å¸¦æ¥æ€§èƒ½ä¸Šçš„æŸå¤±å‘¢ï¼Ÿä» AMQP åè®®å±‚é¢æ¥çœ‹å¹¶æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Œä½†æ˜¯ RabbitMQ æä¾›äº†ä¸€ä¸ªæ”¹è¿›æ–¹æ¡ˆï¼Œå³å‘é€æ–¹ç¡®è®¤æœºåˆ¶ã€‚</p><h3 id="8-2-å‘é€æ–¹ç¡®è®¤æœºåˆ¶"><a href="#8-2-å‘é€æ–¹ç¡®è®¤æœºåˆ¶" class="headerlink" title="8.2 å‘é€æ–¹ç¡®è®¤æœºåˆ¶"></a>8.2 å‘é€æ–¹ç¡®è®¤æœºåˆ¶</h3><p>å‰é¢ä»‹ç»äº† RabbitMQ å¯èƒ½ä¼šé‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå³æ¶ˆæ¯å‘é€æ–¹ï¼ˆç”Ÿäº§è€…ï¼‰å¹¶ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦çœŸæ­£åœ°åˆ°è¾¾äº† RabbitMQ ã€‚éšåäº†è§£åˆ°åœ¨ AMQP åè®®å±‚é¢æä¾›äº†äº‹åŠ¡æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ ä½†æ˜¯é‡‡ç”¨äº‹åŠ¡æœºåˆ¶å®ç°ä¼šä¸¥é‡é™ä½ RabbitMQ çš„æ¶ˆæ¯ååé‡ï¼Œè¿™é‡Œå°±å¼•å…¥äº†ä¸€ç§<strong>è½»é‡çº§çš„æ–¹å¼</strong>ä¸€<strong>å‘é€æ–¹ç¡®è®¤</strong>ï¼ˆpublisher confirmï¼‰æœºåˆ¶ã€‚</p><p>ç”Ÿäº§è€…å°†ä¿¡é“è®¾ç½®æˆ confirm ï¼ˆç¡®è®¤ï¼‰æ¨¡å¼ï¼Œä¸€æ—¦ä¿¡é“è¿›å…¥ confirm æ¨¡å¼ï¼Œæ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„æ¶ˆæ¯éƒ½ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„ID ï¼ˆä»1å¼€å§‹ï¼‰ï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œ RabbitMQ ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ï¼ˆ <code>Basic.Ack</code> ï¼‰ç»™ç”Ÿäº§è€…ï¼ˆåŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ID ï¼‰ï¼Œè¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥æ™“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾äº†ç›®çš„åœ°äº†ã€‚</p><p>å¦‚æœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯ä¼šåœ¨æ¶ˆæ¯å†™å…¥ç£ç›˜ä¹‹åå‘å‡ºã€‚ RabbitMQ å›ä¼ ç»™ç”Ÿäº§è€…çš„ç¡®è®¤æ¶ˆæ¯ä¸­çš„ deliveryTag åŒ…å«äº†ç¡®è®¤æ¶ˆæ¯çš„åºå·ï¼Œæ­¤å¤– RabbitMQ å¯ä»¥è®¾ç½® <code>channel.basicAck</code> æ–¹æ³•ä¸­çš„ multiple å‚æ•°ï¼Œè¡¨ç¤ºåˆ°è¿™ä¸ªåºå·ä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·±ç»å¾—åˆ°äº†å¤„ç†ï¼Œå¯ä»¥å‚è€ƒå›¾ 4-10 ã€‚æ³¨æ„è¾¨åˆ«è¿™é‡Œçš„ç¡®è®¤å’Œæ¶ˆè´¹æ—¶å€™çš„ç¡®è®¤ä¹‹é—´çš„å¼‚åŒã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010172.png" alt></p><p>äº‹åŠ¡æœºåˆ¶åœ¨ä¸€æ¡æ¶ˆæ¯å‘é€ä¹‹åä¼šä½¿å‘é€ç«¯é˜»å¡ï¼Œä»¥ç­‰å¾… RabbitMQ çš„å›åº”ï¼Œä¹‹åæ‰èƒ½ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<strong>å‘é€æ–¹ç¡®è®¤æœºåˆ¶æœ€å¤§çš„å¥½å¤„åœ¨äºå®ƒæ˜¯å¼‚æ­¥çš„</strong>ï¼Œä¸€æ—¦å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œ ç”Ÿäº§è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨ç­‰ä¿¡é“è¿”å›ç¡®è®¤çš„åŒæ—¶ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºä¾¿å¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœ RabbitMQ å› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡ nack ( <code>Basic.Nack</code> ï¼‰å‘½ä»¤ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥ nack å‘½ä»¤ã€‚</p><p>ç”Ÿäº§è€…é€šè¿‡è°ƒç”¨ <code>channel.confirmSelect</code> æ–¹æ³•ï¼ˆå³ <code>Confirm.Select</code> å‘½ä»¤ï¼‰å°†ä¿¡é“ è®¾ç½®ä¸º confirm æ¨¡å¼ï¼Œä¹‹å RabbitMQ ä¼šè¿”å› <code>Confirm.Select-Ok</code> å‘½ä»¤è¡¨ç¤ºåŒæ„ç”Ÿäº§è€…å°†å½“å‰ä¿¡é“è®¾ç½®ä¸º confirm æ¨¡å¼ã€‚æ‰€æœ‰è¢«å‘é€çš„åç»­æ¶ˆæ¯éƒ½è¢« ack æˆ–è€… nack ä¸€æ¬¡ï¼Œä¸ä¼šå‡ºç°ä¸€æ¡æ¶ˆæ¯æ—¢è¢« ack åˆè¢« nack æƒ…å†µï¼Œå¹¶ä¸” RabbitMQ å¹¶æ²¡æœ‰å¯¹æ¶ˆæ¯è¢« confirm çš„å¿«æ…¢åšä»»ä½•ä¿è¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">       <span class="comment">// å°†ä¿¡é“ç½®ä¸º publisher confirm æ¨¡å¼</span></span><br><span class="line">       channel.confirmSelect();</span><br><span class="line">       <span class="comment">// ä¹‹åæ­£å¸¸å‘é€æ¶ˆæ¯</span></span><br><span class="line">       channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, <span class="keyword">null</span>, <span class="string">"publisher confirm test"</span>.getBytes());</span><br><span class="line">       <span class="keyword">if</span>(!channel.waitFormConfirms()) &#123;</span><br><span class="line">           System.out.println(<span class="string">"send message failed"</span>);</span><br><span class="line">           <span class="comment">// do something else</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">       e.printStackTrace();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå‘é€å¤šæ¡æ¶ˆæ¯ï¼Œåªéœ€è¦å°† <code>channel.basicPubish</code> å’Œ <code>channel. waitForConfirms</code> æ–¹æ³•åŒ…è£¹åœ¨å¾ªç¯é‡Œé¢å³å¯ï¼Œå‚è€ƒäº‹åŠ¡æœºåˆ¶ï¼Œä¸è¿‡ä¸éœ€è¦ <code>channel.confirmSelect</code> æ–¹æ³•åŒ…è£¹åœ¨å¾ªç¯å†…éƒ¨ã€‚</p><p>åœ¨ <code>publisher confirm</code> æ¨¡å¼ä¸‹å‘é€å¤šæ¡æ¶ˆæ¯çš„ AMQP åè®®æµè½¬è¿‡ç¨‹å¯å‚è€ƒå›¾ 4-11ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010173.png" alt></p><p>å¯¹äº <code>channel.waitForConfirms</code> è€Œè¨€ï¼Œåœ¨ RabbitMQ å®¢æˆ·ç«¯ä¸­å®ƒæœ‰4ä¸ªåŒç±» æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">waitForConfirms</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">waitForConfirms</span><span class="params">(<span class="keyword">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException, TimeoutException</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">waitForConfirmsOrDie</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">waitForConfirmsOrDie</span><span class="params">(<span class="keyword">long</span> timeout)</span> <span class="keyword">throws</span> IOException, InterruptedException, TimeoutException</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¿¡é“æ²¡æœ‰å¼€å¯ <code>publisher confirm</code> æ¨¡å¼ï¼Œåˆ™è°ƒç”¨ä»»ä½• <code>waitForConfirms</code> æ–¹æ³•éƒ½ä¼šæŠ¥å‡º <code>java.lang.IllegalStateException</code> ã€‚å¯¹äºæ²¡æœ‰å‚æ•°çš„ <code>waitForConfirms</code> æ–¹æ³•æ¥è¯´ï¼Œ å…¶è¿”å›çš„æ¡ä»¶æ˜¯å®¢æˆ·ç«¯æ”¶åˆ°äº†ç›¸åº”çš„ <code>Basic.Ack / .Nack</code> æˆ–è€…è¢«ä¸­æ–­ã€‚</p><p>å‚æ•° timeout è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œ ä¸€æ—¦ç­‰å¾… RabbitMQ å›åº”è¶…æ—¶å°±ä¼šæŠ›å‡º <code>java.util.concurrent.TimeoutException</code> çš„å¼‚å¸¸ã€‚</p><p>ä¸¤ä¸ª <code>waitForConfirmsOrDie</code> æ–¹æ³•åœ¨æ¥æ”¶åˆ° RabbitMQ è¿”å› <code>Basic.Nack</code> ä¹‹åä¼šæŠ›å‡º <code>java.io.IOException</code> ä¸šåŠ¡ä»£ç å¯ä»¥æ ¹æ®è‡ªèº«çš„ç‰¹æ€§çµæ´»åœ°è¿ç”¨è¿™å››ç§æ–¹æ³•æ¥ä¿éšœæ¶ˆæ¯çš„å¯é å‘é€ã€‚</p><p>å‰é¢æåˆ°è¿‡ RabbitMQ å¼•å…¥äº† <code>publisher confirm</code> æœºåˆ¶æ¥å¼¥è¡¥äº‹åŠ¡æœºåˆ¶çš„ç¼ºé™·ï¼Œæé«˜äº†æ•´ä½“çš„ååé‡ï¼Œé‚£ä¹ˆæ¥å¯¹æ¯”ä¸‹ä¸¤è€…ä¹‹é—´çš„QPS ï¼Œæµ‹è¯•ä»£ç å¯ä»¥å‚è€ƒä¸Šé¢çš„ç¤ºä¾‹ä»£ç ã€‚</p><p>æµ‹è¯•ç¯å¢ƒï¼šå®¢æˆ·ç«¯å’Œ Broker æœºå™¨é…ç½®ä¸€CPU 24 æ ¸ã€ä¸»é¢‘ä¸º 2600Hz ã€å†…å­˜ä¸º 64GBã€ç¡¬ç›˜ä¸º 1TB ã€‚å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ä½“å¤§å°ä¸º 10B ï¼Œå•çº¿ç¨‹å‘é€ï¼Œå¹¶ä¸”æ¶ˆæ¯éƒ½è¿›è¡ŒæŒä¹…åŒ–å¤„ç†ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010174.png" alt></p><p>å›¾ä¸­çš„æ¨ªåæ ‡è¡¨ç¤ºæµ‹è¯•çš„æ¬¡æ•°ï¼Œçºµåæ ‡è¡¨ç¤º QPSï¼Œå¯ä»¥å‘ç° publisher confirm ä¸äº‹åŠ¡æœºåˆ¶ç›¸æ¯”ï¼Œ QPS å¹¶æ²¡æœ‰æé«˜å¤šå°‘ï¼Œéš¾é“æ˜¯ RabbitMQ æ¬ºéª—äº†æˆ‘ä»¬ï¼Ÿ</p><p>æˆ‘ä»¬å†æ¥å›é¡¾ä¸‹å‰é¢çš„ç¤ºä¾‹ä»£ç ï¼Œå¯ä»¥å‘ç° publisher confirm æ¨¡å¼æ˜¯æ¯å‘é€ä¸€æ¡æ¶ˆæ¯åå°±è°ƒç”¨ <code>channe.waitForConfirms</code> æ–¹æ³•ï¼Œä¹‹åç­‰å¾…æœåŠ¡ç«¯çš„ç¡®è®¤ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ç§ä¸²è¡ŒåŒæ­¥ç­‰å¾…çš„æ–¹å¼ã€‚äº‹åŠ¡æœºåˆ¶å’Œå®ƒä¸€æ ·ï¼Œå‘é€æ¶ˆæ¯ä¹‹åç­‰å¾…æœåŠ¡ç«¯ç¡®è®¤ï¼Œä¹‹åå†å‘é€æ¶ˆæ¯ã€‚ä¸¤è€…çš„å­˜å‚¨ç¡®è®¤åŸç†ç›¸åŒï¼Œå°¤å…¶å¯¹äºæŒä¹…åŒ–çš„æ¶ˆæ¯æ¥è¯´ï¼Œä¸¤è€…éƒ½éœ€è¦ç­‰å¾…æ¶ˆæ¯ç¡®è®¤è½ç›˜ä¹‹åæ‰ä¼šè¿”å›ï¼ˆè°ƒ Linux å†…æ ¸çš„ <code>fsync</code> æ–¹æ³•ï¼‰ ã€‚åœ¨åŒæ­¥ç­‰å¾…çš„æ–¹å¼ä¸‹ï¼Œ publisher confirm æœºåˆ¶å‘é€ä¸€æ¡æ¶ˆæ¯éœ€è¦é€šä¿¡äº¤äº’çš„å‘½ä»¤æ˜¯ <code>Basic.Publish</code> ã€<code>Basic.Ack</code> ï¼›äº‹åŠ¡æœºåˆ¶æ˜¯3æ¡ï¼š <code>Basic.Publish</code> ã€<code>Tx.Commmit/.Commit-Ok</code> ï¼ˆæˆ–è€… <code>Tx Rollback/. Rollback-Ok</code> ï¼‰ï¼Œäº‹åŠ¡æœºåˆ¶å¤šäº†ä¸€ä¸ªå‘½ä»¤å¸§æŠ¥æ–‡çš„äº¤äº’ï¼Œæ‰€ä»¥ QPS ä¼šç•¥å¾®ä¸‹é™ã€‚</p><p>æ³¨æ„è¦ç‚¹ï¼š</p><ol><li>äº‹åŠ¡æœºåˆ¶å’Œ <code>publisher confirm</code> æœºåˆ¶ä¸¤è€…æ˜¯äº’æ–¥çš„ï¼Œä¸èƒ½å…±å­˜ã€‚å¦‚æœä¼å›¾å°†å·²å¼€å¯äº‹åŠ¡æ¨¡å¼çš„ä¿¡é“å†è®¾ç½®ä¸º <code>publisher confirm</code> æ¨¡å¼ï¼ŒRabbitMQ ä¼šæŠ¥é”™ï¼š<code>{amqp_error, precondition_failed, &quot;cannot switch from tx to confirm mode&quot;, &#39;confirm.select&#39;};</code> æˆ–è€…å¦‚æœä¼å›¾å°†å·²å¼€å¯ <code>publisher confirm</code> æ¨¡å¼çš„ä¿¡é“å†è®¾ç½®ä¸ºäº‹åŠ¡æ¨¡å¼ï¼ŒRabbitMQ ä¹Ÿä¼šæŠ¥é”™ï¼š <code>{amqp_error, precondition_failed, &quot;cannot switch from tx to confirm mode&quot;, &#39;tx.select&#39; }</code> ã€‚ </li><li>äº‹åŠ¡æœºåˆ¶å’Œ <code>publisher confirm</code> æœºåˆ¶ç¡®ä¿çš„æ˜¯æ¶ˆæ¯èƒ½å¤Ÿæ­£ç¡®åœ°å‘é€è‡³ RabbitMQ ï¼Œè¿™é‡Œçš„â€œå‘é€è‡³ RabbitMQâ€çš„å«ä¹‰æ˜¯æŒ‡æ¶ˆæ¯è¢«æ­£ç¡®åœ°å‘å¾€è‡³ RabbitMQ çš„äº¤æ¢å™¨ï¼Œå¦‚æœæ­¤äº¤æ¢å™¨æ²¡æœ‰åŒ¹é…çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¹Ÿä¼šä¸¢å¤±ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨è¿™ä¸¤ç§æœºåˆ¶çš„æ—¶å€™è¦ç¡®ä¿æ‰€æ¶‰åŠçš„äº¤æ¢å™¨èƒ½å¤Ÿæœ‰åŒ¹é…çš„é˜Ÿåˆ—ï¼Œæ›´è¿›ä¸€æ­¥åœ°è®²ï¼Œå‘é€æ–¹è¦é…åˆ mandatory å‚æ•°æˆ–è€…å¤‡ä»½äº¤æ¢å™¨ä¸€èµ·ä½¿ç”¨æ¥æé«˜ æ¶ˆæ¯ä¼ è¾“çš„å¯é æ€§ã€‚</li></ol><p><code>publisher confirm</code> çš„ä¼˜åŠ¿åœ¨äºå¹¶ä¸ä¸€å®šéœ€è¦åŒæ­¥ç¡®è®¤ã€‚è¿™é‡Œæˆ‘ä»¬æ”¹è¿›äº†ä¸€ä¸‹ä½¿ç”¨æ–¹å¼ï¼Œæ€»ç»“æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p><ul><li>æ‰¹é‡confirmæ–¹æ³•ï¼šæ¯å‘é€ä¸€æ‰¹æ¶ˆæ¯åï¼Œè°ƒç”¨ <code>channel.waitForConfirms</code> æ–¹æ³•ï¼Œç­‰å¾…æœåŠ¡å™¨çš„ç¡®è®¤è¿”å›ï¼›</li><li>å¼‚æ­¥confirmæ–¹æ³•ï¼šæä¾›ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼ŒæœåŠ¡ç«¯ç¡®è®¤äº†ä¸€æ¡æˆ–è€…å¤šæ¡æ¶ˆæ¯åå®¢æˆ·ç«¯ä¼šå› è°ƒè¿™ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</li></ul><p>åœ¨æ‰¹é‡ confirm æ–¹æ³•ä¸­ï¼Œå®¢æˆ·ç«¯ç¨‹åºéœ€è¦å®šæœŸæˆ–è€…å®šé‡ï¼ˆè¾¾åˆ°å¤šå°‘æ¡ï¼‰ï¼Œäº¦æˆ–è€…ä¸¤è€…ç»“åˆèµ·æ¥è°ƒç”¨ <code>channel.waitForConfirms</code> æ¥ç­‰å¾… RabbitMQ ç¡®è®¤è¿”å›ã€‚ç›¸æ¯”äºå‰é¢ç¤ºä¾‹ä¸­çš„æ™®é€š confirm æ–¹æ³•ï¼Œæ‰¹é‡æå¤§åœ°æå‡äº† confirm æ•ˆç‡ï¼Œä½†æ˜¯é—®é¢˜åœ¨äºå‡ºç°è¿”å› <code>Basic.Nack</code> æˆ–è€…è¶…æ—¶æƒ…å†µæ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦å°†è¿™ä¸€æ‰¹æ¬¡çš„æ¶ˆæ¯å…¨éƒ¨é‡å‘ï¼Œè¿™ä¼šå¸¦æ¥æ˜æ˜¾çš„é‡å¤æ¶ˆæ¯æ•°é‡ï¼Œå¹¶ä¸”å½“æ¶ˆæ¯ç»å¸¸ä¸¢å¤±æ—¶ï¼Œæ‰¹é‡ confirm æ€§èƒ½åº”è¯¥æ˜¯ä¸å‡åé™çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">       <span class="comment">// å°†ä¿¡é“ç½®ä¸º publisher confirm æ¨¡å¼</span></span><br><span class="line">       channel.confirmSelect();</span><br><span class="line">       <span class="keyword">int</span> MsgCount = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">       channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, <span class="keyword">null</span>, <span class="string">"batch confirm test"</span>.getBytes());</span><br><span class="line">           <span class="comment">// å°†å‘é€å‡ºå»çš„æ¶ˆæ¯å­˜å…¥ç¼“å­˜ï¼Œç¼“å­˜å¯ä»¥æ˜¯ArrayListæˆ–BlockingQueueç­‰</span></span><br><span class="line">           <span class="keyword">if</span>(++MsgCount &gt;= BATCH_COUNT) &#123;</span><br><span class="line">               MsgCount = <span class="number">0</span>;</span><br><span class="line">               <span class="keyword">try</span>&#123;</span><br><span class="line">                   <span class="keyword">if</span>(channel.waitForConfirms()) &#123;</span><br><span class="line">                       <span class="comment">// å°†ç¼“å­˜ä¸­çš„æ¶ˆæ¯æ¸…ç©º</span></span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="comment">// å°†ç¼“å­˜ä¸­çš„æ¶ˆæ¯é‡æ–°å‘é€</span></span><br><span class="line">               &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">                   <span class="comment">// å°†ç¼“å­˜ä¸­çš„æ¶ˆæ¯é‡æ–°å‘é€</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">          </span><br><span class="line">       &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">       e.printStackTrace();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å¼‚æ­¥ confirm æ–¹æ³•çš„ç¼–ç¨‹å®ç°æœ€ä¸ºå¤æ‚ï¼Œåœ¨å®¢æˆ·ç«¯ Channel æ¥å£ä¸­æä¾›çš„ <code>addConfirmListener</code> æ–¹æ³•å¯ä»¥æ·»åŠ  <code>ConfirmListener</code> è¿™ä¸ªå›è°ƒæ¥å£ï¼Œè¿™ä¸ª <code>ConfirmListener</code> æ¥å£åŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼š <code>handleAck</code> ã€<code>handleNack</code> ï¼Œåˆ†åˆ«ç”¨æ¥å¤„ç† RabbitMQ å›ä¼ çš„ <code>Basic.Ack</code> å’Œ <code>Basic.Nack</code> ã€‚åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­éƒ½åŒ…å«æœ‰ ä¸ªå‚æ•° <code>deliveryTag</code> ï¼ˆåœ¨ <code>publisher confirm</code> æ¨¡å¼ä¸‹ç”¨æ¥æ ‡è®°æ¶ˆæ¯çš„å”¯ä¸€æœ‰åºåºå·ï¼‰ã€‚æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªä¿¡é“ç»´æŠ¤ä¸€ä¸ªâ€œunconfirm â€çš„æ¶ˆæ¯åºå·é›†åˆï¼Œæ¯å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œé›†åˆä¸­çš„å…ƒç´ åŠ 1ã€‚æ¯å½“è°ƒ <code>ConfirmListener</code> ä¸­çš„ <code>handleAck</code> æ–¹æ³•æ—¶ï¼Œâ€œ unconfirm â€é›†åˆä¸­åˆ æ‰ç›¸åº”çš„ä¸€æ¡ ( multiple è®¾ç½®ä¸º false ï¼‰æˆ–è€…å¤šæ¡ï¼ˆ multiple è®¾ç½®ä¸º true ï¼‰è®°å½•ã€‚ä»ç¨‹åºè¿è¡Œæ•ˆç‡ä¸Šæ¥çœ‹ï¼Œ è¿™ä¸ªâ€œunconfrrm â€é›†åˆæœ€å¥½é‡‡ç”¨æœ‰åºé›†åˆ <code>SortedSet</code> çš„å­˜å‚¨ç»“æ„ã€‚äº‹å®ä¸Šï¼Œ Java å®¢æˆ·ç«¯ SDK ä¸­çš„ <code>waitForConfirms</code> æ–¹æ³•ä¹Ÿæ˜¯é€šè¿‡ SortedSet ç»´æŠ¤æ¶ˆæ¯åºå·çš„ã€‚</p><p>æ¼”ç¤ºå¼‚æ­¥ confirm çš„ç¼–ç å®ç°ï¼Œå…¶ä¸­çš„ confirmSet å°±æ˜¯ä¸€ä¸ª SortedSet ç±»å‹çš„é›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">channel.confirmSelect();</span><br><span class="line">channel.addConfirmListener(<span class="keyword">new</span> ConfirmListener()&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleAck</span><span class="params">(<span class="keyword">long</span> deliveryTag, <span class="keyword">boolean</span> multiple)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">           System.out.println(<span class="string">"Nack, SeqNo: "</span> + deliveryTag +</span><br><span class="line">                             <span class="string">", multiple: "</span> + multiple);</span><br><span class="line">           <span class="keyword">if</span>(multiple)&#123;</span><br><span class="line">               confirmSet.headSet(deliveryTag - <span class="number">1</span>).clear();</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               confirmSet.remove(deliveryTag);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleNack</span><span class="params">(<span class="keyword">long</span> deliveryTag, <span class="keyword">boolean</span> multiple)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">           <span class="keyword">if</span>(multiple)&#123;</span><br><span class="line">               confirmSet.headSet(deliveryTag - <span class="number">1</span>).clear();</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               confirmSet.remove(deliveryTag);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// æ³¨æ„è¿™é‡Œéœ€è¦æ·»åŠ å¤„ç†æ¶ˆæ¯é‡å‘çš„åœºæ™¯</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"><span class="comment">// ä¸‹é¢æ˜¯æ¼”ç¤ºä¸€ç›´å‘é€æ¶ˆæ¯çš„åœºæ™¯</span></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">       <span class="keyword">long</span> nextSeqNo = channel.getNextPublishSeqNo();</span><br><span class="line">       channel.basicPublish(ConfirmConfig.exchangeName, ConfirmConfig.routingKey, MessageProperties.PERSISTENT_TEXT_PLAIN, ConfirmConfig.msg_10B.getBytes());</span><br><span class="line">       confirmSet.add(nextSeqNo);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å°†äº‹åŠ¡ã€æ™®é€š confirmã€æ‰¹é‡ confirm å’Œå¼‚æ­¥ confirm è¿™4ç§æ–¹å¼æ”¾åˆ°ä¸€èµ·æ¥æ¯”è¾ƒä¸‹å½¼æ­¤çš„ QPSã€‚æµ‹è¯•ç¯å¢ƒå’Œæ•°æ®å’Œå›¾ 4-12 ä¸­çš„æµ‹è¯•ç›¸åŒï¼Œå…·ä½“æµ‹è¯•å¯¹æ¯”å¦‚å›¾ 4-13 æ‰€ç¤ºï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010175.png" alt></p><p>å¯ä»¥çœ‹åˆ°æ‰¹é‡ confirm å’Œå¼‚æ­¥ confirm è¿™ä¸¤ç§æ–¹å¼æ‰€å‘ˆç°çš„æ€§èƒ½è¦æ¯”å…¶ä½™ä¸¤ç§å¥½å¾—å¤šã€‚</p><ul><li>äº‹åŠ¡æœºåˆ¶å’Œæ™®é€š confirm çš„æ–¹å¼ååé‡å¾ˆä½ï¼Œä½†æ˜¯ç¼–ç¨‹æ–¹å¼ç®€å•ï¼Œä¸éœ€è¦åœ¨å®¢æˆ·ç«¯ç»´æŠ¤çŠ¶æ€ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ç»´æŠ¤ deliveryTag åŠç¼“å­˜æœªç¡®è®¤çš„æ¶ˆæ¯ï¼‰ã€‚</li><li>æ‰¹é‡ confirm æ–¹å¼çš„é—®é¢˜åœ¨äºé‡åˆ° RabbitMQ æœåŠ¡ç«¯è¿”å› <code>Basic.Nack</code> éœ€è¦é‡å‘æ‰¹é‡æ¶ˆæ¯è€Œå¯¼è‡´çš„æ€§èƒ½é™ä½ã€‚</li><li>å¼‚æ­¥ confirm æ–¹å¼ç¼–ç¨‹æ¨¡å‹æœ€ä¸ºå¤æ‚ï¼Œè€Œä¸”å’Œæ‰¹é‡ confirm æ–¹å¼ä¸€æ ·éœ€è¦åœ¨å®¢æˆ·ç«¯ç»´æŠ¤çŠ¶æ€ã€‚</li></ul><p>åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­é‡‡ç”¨ä½•ç§æ–¹å¼ï¼Œè¿™é‡Œå°±ä»è€…è§ä»æ™ºè€…è§æ™ºäº†ï¼Œä¸è¿‡<strong>å¼ºçƒˆå»ºè®®ä½¿ç”¨å¼‚æ­¥ confirm çš„æ–¹å¼</strong>ã€‚</p><h2 id="ç¬¬ä¹èŠ‚-æ¶ˆè´¹ç«¯è¦ç‚¹ä»‹ç»"><a href="#ç¬¬ä¹èŠ‚-æ¶ˆè´¹ç«¯è¦ç‚¹ä»‹ç»" class="headerlink" title="ç¬¬ä¹èŠ‚ æ¶ˆè´¹ç«¯è¦ç‚¹ä»‹ç»"></a>ç¬¬ä¹èŠ‚ æ¶ˆè´¹ç«¯è¦ç‚¹ä»‹ç»</h2><p>æ¶ˆè´¹è€…å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡æ¨æ¨¡å¼æˆ–è€…æ‹‰æ¨¡å¼çš„æ–¹å¼æ¥è·å–äº•æ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“æ¶ˆè´¹è€…å¤„ç†å®Œä¸šåŠ¡é€»è¾‘éœ€è¦æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯å·±è¢«æ¥æ”¶ï¼Œè¿™æ · RabbitMQ æ‰èƒ½æŠŠå½“å‰æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­æ ‡è®°æ¸…é™¤ã€‚å½“ç„¶å¦‚æœæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› æ— æ³•å¤„ç†å½“å‰æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œ å¯ä»¥é€šè¿‡ <code>channel.basicNack</code> æˆ–è€… <code>channel.basicReject</code> æ¥æ‹’ç»æ‰ã€‚</p><p>è¿™é‡Œå¯¹äº RabbitMQ æ¶ˆè´¹ç«¯æ¥è¯´ï¼Œè¿˜æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ul><li>æ¶ˆæ¯åˆ†å‘ï¼›</li><li>æ¶ˆæ¯é¡ºåºæ€§ï¼›</li><li>å¼ƒç”¨ <code>QueueingConsumer</code> ã€‚</li></ul><h3 id="9-1-æ¶ˆæ¯åˆ†å‘"><a href="#9-1-æ¶ˆæ¯åˆ†å‘" class="headerlink" title="9.1 æ¶ˆæ¯åˆ†å‘"></a>9.1 æ¶ˆæ¯åˆ†å‘</h3><p>å½“ RabbitMQ é˜Ÿåˆ—æ‹¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…æ—¶ï¼Œé˜Ÿåˆ—æ”¶åˆ°çš„æ¶ˆæ¯å°†ä»¥è½®è¯¢ï¼ˆ <code>round-robin</code> ï¼‰çš„åˆ†å‘æ–¹å¼å‘é€ç»™æ¶ˆè´¹è€…ã€‚æ¯æ¡æ¶ˆæ¯åªä¼šå‘é€ç»™è®¢é˜…åˆ—è¡¨é‡Œçš„ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è¿™ç§æ–¹å¼éå¸¸é€‚åˆæ‰©å±•ï¼Œè€Œä¸”å®ƒæ˜¯ä¸“é—¨ä¸ºå¹¶å‘ç¨‹åºè®¾è®¡çš„ã€‚å¦‚æœç°åœ¨è´Ÿè½½åŠ é‡ï¼Œé‚£ä¹ˆåªéœ€è¦åˆ›å»ºæ›´å¤šçš„æ¶ˆè´¹è€…æ¥æ¶ˆè´¹å¤„ç†æ¶ˆæ¯å³å¯ã€‚</p><p>å¾ˆå¤šæ—¶å€™è½®è¯¢çš„åˆ†å‘æœºåˆ¶ä¹Ÿä¸æ˜¯é‚£ä¹ˆä¼˜é›…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰nä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆ RabbitMQ ä¼šå°†ç¬¬mæ¡æ¶ˆæ¯åˆ†å‘ç»™ç¬¬ <code>m%n</code>ï¼ˆå–ä½™çš„æ–¹å¼ï¼‰ä¸ªæ¶ˆè´¹è€…ï¼ŒRabbitMQ ä¸ç®¡æ¶ˆè´¹è€…æ˜¯å¦æ¶ˆè´¹å¹¶å·±ç»ç¡®è®¤ï¼ˆ <code>Basic.Ack</code> ï¼‰äº†æ¶ˆæ¯ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæŸäº›æ¶ˆè´¹è€…ä»»åŠ¡ç¹é‡ï¼Œæ¥ä¸åŠæ¶ˆè´¹é‚£ä¹ˆå¤šçš„æ¶ˆæ¯ï¼Œè€ŒæŸäº›å…¶ä»–æ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚ä¸šåŠ¡é€»è¾‘ç®€å•ã€æœºå™¨æ€§èƒ½å“è¶Šç­‰ï¼‰å¾ˆå¿«åœ°å¤„ç†å®Œäº†æ‰€åˆ†é…åˆ°çš„æ¶ˆæ¯ï¼Œè¿›è€Œè¿›ç¨‹ç©ºé—²ï¼Œè¿™æ ·å°±ä¼šé€ æˆæ•´ä½“åº”ç”¨ååé‡çš„ä¸‹é™ã€‚</p><p>é‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼Ÿè¿™é‡Œå°±è¦ç”¨åˆ° <code>channel.basicQos(int prefetchCount)</code> è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚å‰é¢ç« èŠ‚æ‰€è¿°ï¼Œ <code>channel.basicQos</code> æ–¹æ³•å…è®¸é™åˆ¶ä¿¡é“ä¸Šçš„æ¶ˆè´¹è€…æ‰€èƒ½ä¿æŒçš„æœ€å¤§æœªç¡®è®¤æ¶ˆæ¯çš„æ•°é‡ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼Œåœ¨è®¢é˜…æ¶ˆè´¹é˜Ÿåˆ—ä¹‹å‰ï¼Œæ¶ˆè´¹ç«¯ç¨‹åºè°ƒç”¨äº† <code>channel.basicQos(5)</code> ï¼Œä¹‹åè®¢é˜…äº†æŸä¸ªé˜Ÿåˆ—è¿›è¡Œæ¶ˆè´¹ã€‚ RabbitMQ ä¼šä¿å­˜ä¸€ä¸ªæ¶ˆè´¹è€…çš„åˆ—è¡¨ï¼Œæ¯å‘é€ä¸€æ¡æ¶ˆæ¯éƒ½ä¼šä¸ºå¯¹åº”çš„æ¶ˆè´¹è€…è®¡æ•°ï¼Œå¦‚æœè¾¾åˆ°äº†æ‰€è®¾å®šçš„ä¸Šé™ï¼Œé‚£ä¹ˆ RabbitMQ å°±ä¸ä¼šå‘è¿™ä¸ªæ¶ˆè´¹è€…å†å‘é€ä»»ä½•æ¶ˆæ¯ã€‚ ç›´åˆ°æ¶ˆè´¹è€…ç¡®è®¤äº†æŸæ¡æ¶ˆæ¯ä¹‹å RabbitMQ å°†ç›¸åº”çš„è®¡æ•°å‡1 ï¼Œä¹‹åæ¶ˆè´¹è€…å¯ä»¥ç»§ç»­æ¥æ”¶æ¶ˆæ¯ï¼Œ ç›´åˆ°å†æ¬¡åˆ°è¾¾è®¡æ•°ä¸Šé™ã€‚è¿™ç§æœºåˆ¶å¯ä»¥ç±»æ¯”äº TCP/IP ä¸­çš„â€œæ»‘åŠ¨çª—å£â€ã€‚</p><p>æ³¨æ„è¦ç‚¹ï¼š<code>Basic.Qos</code> çš„ä½¿ç”¨å¯¹äºæ‹‰æ¨¡å¼çš„æ¶ˆè´¹æ–¹å¼æ— æ•ˆã€‚</p><p>channel.basicQos æœ‰ä¸‰ç§ç±»å‹çš„é‡è½½æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">basicQos</span><span class="params">(<span class="keyword">int</span> prefetchCount)</span> <span class="keyword">throws</span> IOException</span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">basicQos</span><span class="params">(<span class="keyword">int</span> prefetchCount, <span class="keyword">boolean</span> global)</span> <span class="keyword">throws</span> IOException</span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">basicQos</span><span class="params">(<span class="keyword">int</span> prefetchSize, <span class="keyword">int</span> prefetchCount, <span class="keyword">boolean</span> gl bal)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure><p>å‰é¢ä»‹ç»çš„éƒ½åªç”¨åˆ°äº† prefetchCount è¿™ä¸ªå‚æ•°ï¼Œå½“ prefetchCount è®¾ç½®ä¸º0åˆ™è¡¨ç¤ºæ²¡æœ‰ä¸Šé™ã€‚è¿˜æœ‰ prefetchSize è¿™ä¸ªå‚æ•°è¡¨ç¤ºæ¶ˆè´¹è€…æ‰€èƒ½æ¥æ”¶æœªç¡®è®¤æ¶ˆæ¯çš„æ€»ä½“å¤§å°çš„ä¸Šé™ï¼Œ å•ä½ä¸ºBï¼Œè®¾ç½®ä¸º0åˆ™è¡¨ç¤ºæ²¡æœ‰ä¸Šé™ã€‚</p><p>å¯¹äºä¸€ä¸ªä¿¡é“æ¥è¯´ï¼Œå®ƒå¯ä»¥åŒæ—¶æ¶ˆè´¹å¤šä¸ªé˜Ÿåˆ—ï¼Œå½“è®¾ç½®äº† prefetchCount å¤§äº0æ—¶ï¼Œè¿™ä¸ªä¿¡é“éœ€è¦å’Œå„ä¸ªé˜Ÿåˆ—åè°ƒä»¥ç¡®ä¿å‘é€çš„æ¶ˆæ¯éƒ½æ²¡æœ‰è¶…è¿‡æ‰€é™å®šçš„ prefetchCount çš„å€¼ï¼Œè¿™æ ·ä¼š RabbitMQ çš„æ€§èƒ½é™ä½ï¼Œå°¤å…¶æ˜¯è¿™äº›é˜Ÿåˆ—åˆ†æ•£åœ¨é›†ç¾¤ä¸­çš„å¤šä¸ª Broker èŠ‚ç‚¹ä¹‹ä¸­ã€‚ RabbitMQ ä¸ºäº†æå‡ç›¸å…³çš„æ€§èƒ½ï¼Œåœ¨ AMQP 0-9-1 åè®®ä¹‹ä¸Šé‡æ–°å®šä¹‰äº† global è¿™ä¸ªå‚æ•°ï¼Œå¯¹æ¯”å¦‚è¡¨ 4-1 æ‰€ç¤ºã€‚</p><table><thead><tr><th>global å‚æ•°</th><th>AMQP 0-9-1</th><th>RabbitMQ</th></tr></thead><tbody><tr><td>false</td><td>ä¿¡é“ä¸Šæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éœ€è¦éµä» prefetch Count çš„é™å®šå€¼</td><td>ä¿¡é“ä¸Šæ–°çš„æ¶ˆè´¹è€…éœ€è¦éµä» prefetchCount çš„é™å®šå€¼</td></tr><tr><td>true</td><td>å½“å‰é€šä¿¡é“¾è·¯ï¼ˆ Connection ï¼‰ä¸Šæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éœ€è¦éµä» prefetchCount çš„é™å®šå€¼</td><td>ä¿¡é“ä¸Šæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éœ€è¦éµä» prefetchCount çš„é™å®šå€¼</td></tr></tbody></table><p>å‰é¢ç« èŠ‚ä¸­çš„ <code>channel.basicQos</code> æ–¹æ³•çš„ç¤ºä¾‹éƒ½æ˜¯é’ˆå¯¹å•ä¸ªæ¶ˆè´¹è€…çš„ï¼Œè€Œå¯¹äºåŒä¸€ä¸ªä¿¡é“ä¸Šçš„å¤šä¸ªæ¶ˆè´¹è€…è€Œè¨€ï¼Œå¦‚æœè®¾ç½®äº† prefetchCount çš„å€¼ï¼Œé‚£ä¹ˆéƒ½ä¼šç”Ÿæ•ˆã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç ç¤ºä¾‹ä¸­æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå„è‡ªçš„èƒ½æ¥æ”¶åˆ°çš„æœªç¡®è®¤æ¶ˆæ¯çš„ä¸Šé™éƒ½ä¸º10</span></span><br><span class="line">Channel channel = ...;</span><br><span class="line">Consumer consumer1 = ...;</span><br><span class="line">Consumer consumer2 = ...;</span><br><span class="line"><span class="comment">// Per consumer limit</span></span><br><span class="line">channel.basicQos(<span class="number">10</span>);</span><br><span class="line">channel.basicConsume(<span class="string">"my-queue1"</span>, <span class="keyword">false</span>, consumer1);</span><br><span class="line">channel.basicConsume(<span class="string">"my-queue2"</span>, <span class="keyword">false</span>, consumer2);</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨è®¢é˜…æ¶ˆæ¯ä¹‹å‰ï¼Œæ—¢è®¾ç½®äº† global ä¸º true çš„é™åˆ¶ï¼Œåˆè®¾ç½®äº† global ä¸º false çš„é™åˆ¶ï¼Œé‚£ä¹ˆå“ªä¸ªä¼šç”Ÿæ•ˆå‘¢ï¼Ÿ RabbitMQ ä¼šç¡®ä¿ä¸¤è€…éƒ½ä¼šç”Ÿæ•ˆã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œå½“å‰æœ‰ä¸¤ä¸ªé˜Ÿåˆ— queue1 å’Œ queue2ï¼šqueue1 æœ‰ 10 æ¡æ¶ˆæ¯ï¼Œåˆ†åˆ«ä¸º1åˆ°10; queue2 ä¹Ÿæœ‰10æ¡æ¶ˆæ¯ï¼Œåˆ†åˆ«ä¸º11åˆ°20 ã€‚æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åˆ†åˆ«æ¶ˆè´¹è¿™ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œå¦‚ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Channel channel = ...;</span><br><span class="line">Consumer consumer1 = ...;</span><br><span class="line">Consumer consumer2 = ...;</span><br><span class="line"><span class="comment">// Per consumer limit</span></span><br><span class="line">channel.basicQos(<span class="number">3</span>, <span class="keyword">false</span>);</span><br><span class="line"><span class="comment">// Per Channel limit</span></span><br><span class="line">channel.basicQos(<span class="number">5</span>, <span class="keyword">true</span>);</span><br><span class="line">channel.basicConsume(<span class="string">"my-queue1"</span>, <span class="keyword">false</span>, consumer1);</span><br><span class="line">channel.basicConsume(<span class="string">"my-queue2"</span>, <span class="keyword">false</span>, consumer2);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™é‡Œæ¯ä¸ªæ¶ˆè´¹è€…æœ€å¤šåªèƒ½æ”¶åˆ°3ä¸ªæœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…èƒ½æ”¶åˆ°çš„æœªç¡®è®¤çš„æ¶ˆæ¯ä¸ªæ•°ä¹‹å’Œçš„ä¸Šé™ä¸º5ã€‚åœ¨æœªç¡®è®¤æ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œå¦‚æœ consumer1 æ¥æ”¶åˆ°äº†æ¶ˆæ¯ ï¼Œé‚£ä¹ˆ consumer2 è‡³å¤šåªèƒ½æ”¶åˆ° 11 åˆ° 12 ã€‚å¦‚æœåƒè¿™æ ·åŒæ—¶ä½¿ç”¨ä¸¤ç§ global çš„æ¨¡å¼ï¼Œåˆ™ä¼šå¢åŠ  RabbitMQ çš„è´Ÿè½½ï¼Œå› ä¸º RabbitMQ éœ€è¦æ›´å¤šçš„èµ„æºæ¥åè°ƒå®Œæˆè¿™äº›é™åˆ¶ã€‚å¦‚æ— ç‰¹æ®Šéœ€è¦ï¼Œæœ€å¥½åªä½¿ç”¨ global ä¸º false è®¾ç½®ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤çš„è®¾ç½®ã€‚</p><h3 id="9-2-æ¶ˆæ¯é¡ºåºæ€§"><a href="#9-2-æ¶ˆæ¯é¡ºåºæ€§" class="headerlink" title="9.2 æ¶ˆæ¯é¡ºåºæ€§"></a>9.2 æ¶ˆæ¯é¡ºåºæ€§</h3><p>æ¶ˆæ¯çš„é¡ºåºæ€§æ˜¯æŒ‡æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯å’Œå‘é€è€…å‘å¸ƒçš„æ¶ˆæ¯çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸è€ƒè™‘æ¶ˆæ¯é‡å¤çš„æƒ…å†µï¼Œå¦‚æœç”Ÿäº§è€…å‘å¸ƒçš„æ¶ˆæ¯åˆ†åˆ«ä¸º msg1ã€msg2ã€msg3 ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…å¿…ç„¶ä¹Ÿæ˜¯æŒ‰ç…§æ­¤é¡ºåºè¿›è¡Œæ¶ˆè´¹çš„ã€‚</p><p>ç›®å‰å¾ˆå¤šèµ„æ–™æ˜¾ç¤º RabbitMQ çš„æ¶ˆæ¯èƒ½å¤Ÿä¿éšœé¡ºåºæ€§ï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ï¼Œæˆ–è€…è¯´è¿™ä¸ªè§‚ç‚¹æœ‰å¾ˆå¤§çš„å±€é™æ€§ã€‚åœ¨ä¸ä½¿ç”¨ä»»ä½• RabbitMQ é«˜çº§ç‰¹æ€§ï¼Œä¹Ÿæ²¡æœ‰æ¶ˆæ¯ä¸¢å¤±ã€ç½‘ç»œæ•…éšœä¹‹ç±»å¼‚å¸¸çš„æƒ…å†µå‘ç”Ÿï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½ä¹Ÿåªæœ‰ä¸€ä¸ªç”Ÿäº§è€…çš„æƒ…å†µä¸‹å¯ä»¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚å¦‚æœæœ‰å¤šä¸ªç”Ÿäº§è€…åŒæ—¶å‘é€æ¶ˆæ¯ï¼Œæ— æ³•ç¡®å®šæ¶ˆæ¯åˆ°è¾¾ Broker çš„å‰åé¡ºåºï¼Œä¹Ÿå°±æ— æ³•éªŒè¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚</p><p>é‚£ä¹ˆå“ªäº›æƒ…å†µä¸‹ RabbitMQ çš„æ¶ˆæ¯é¡ºåºæ€§ä¼šè¢«æ‰“ç ´å‘¢ï¼Ÿ</p><p>å¸¸è§æƒ…å½¢ï¼š</p><ul><li>å¦‚æœç”Ÿäº§è€…ä½¿ç”¨äº†äº‹åŠ¡æœºåˆ¶ï¼Œåœ¨å‘é€æ¶ˆæ¯ä¹‹åé‡åˆ°å¼‚å¸¸è¿›è¡Œäº†äº‹åŠ¡å›æ»šï¼Œé‚£ä¹ˆéœ€è¦é‡æ–°è¡¥å¿å‘é€è¿™æ¡æ¶ˆæ¯ï¼Œå¦‚æœè¡¥å¿å‘é€æ˜¯åœ¨å¦ä¸€ä¸ªçº¿ç¨‹å®ç°çš„ï¼Œé‚£ä¹ˆæ¶ˆæ¯åœ¨ç”Ÿäº§è€…è¿™ä¸ªæºå¤´å°±å‡ºç°äº†é”™åºã€‚åŒæ ·ï¼Œå¦‚æœå¯ç”¨ publisher confirm æ—¶ï¼Œåœ¨å‘ç”Ÿè¶…æ—¶ã€ä¸­æ–­ï¼Œåˆæˆ–è€…æ˜¯æ”¶åˆ° RabbitMQ çš„ <code>Basic.Nack</code> å‘½ä»¤æ—¶ï¼Œé‚£ä¹ˆåŒæ ·éœ€è¦è¡¥å¿å‘é€ï¼Œç»“æœä¸äº‹åŠ¡æœºåˆ¶ä¸€æ ·ä¼šé”™åºã€‚æˆ–è€…è¿™ç§è¯´æ³•æœ‰ äº›ç‰µå¼ºï¼Œæˆ‘ä»¬å¯ä»¥å›ºæ‰§åœ°è®¤ä¸ºæ¶ˆæ¯çš„é¡ºåºæ€§ä¿éšœæ˜¯ä»å­˜å…¥é˜Ÿåˆ—ä¹‹åå¼€å§‹çš„ï¼Œè€Œä¸æ˜¯åœ¨å‘è¿­çš„æ—¶å€™å¼€å§‹çš„ã€‚</li><li>è€ƒè™‘å¦ä¸€ç§æƒ…å½¢ï¼Œå¦‚æœç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯è®¾ç½®äº†ä¸åŒçš„è¶…æ—¶æ—¶é—´ï¼Œäº•ä¸”ä¹Ÿè®¾ç½®äº†æ­»ä¿¡é˜Ÿåˆ—ï¼Œ æ•´ä½“ä¸Šæ¥è¯´ç›¸å½“äºä¸€ä¸ªå»¶è¿Ÿé˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹è¿™ä¸ªå»¶è¿Ÿé˜Ÿåˆ—çš„æ—¶å€™ï¼Œæ¶ˆæ¯çš„é¡ºåºå¿…ç„¶ä¸ä¼šå’Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é¡ºåºä¸€è‡´ã€‚</li><li>å†è€ƒè™‘ä¸€ç§æƒ…å½¢ï¼Œå¦‚æœæ¶ˆæ¯è®¾ç½®äº†ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯ä¹Ÿå¿…ç„¶ä¸æ˜¯é¡ºåºæ€§çš„ã€‚</li><li>å¦‚æœä¸€ä¸ªé˜Ÿåˆ—æŒ‰ç…§å‰åé¡ºåºåˆ†æœ‰ msg1ã€msg2ã€msg3ã€msg4 è¿™4ä¸ªæ¶ˆæ¯ï¼ŒåŒæ—¶æœ‰ ConsumerA å’Œ ConsumerB è¿™ä¸¤ä¸ªæ¶ˆè´¹è€…åŒæ—¶è®¢é˜…äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è½®è¯¢åˆ†å‘åˆ°å„ä¸ªæ¶ˆè´¹è€…ä¹‹ä¸­ï¼Œ ConsumerA ä¸­çš„æ¶ˆæ¯ä¸º msg1 å’Œ msg3, ConsumerB ä¸­çš„æ¶ˆæ¯ä¸º msg2 å’Œ msg4ã€‚ConsumerA æ”¶åˆ°æ¶ˆæ¯ msg1 ä¹‹åå¹¶ä¸æƒ³å¤„ç†è€Œè°ƒç”¨äº† <code>Basic Nack/.Reject</code> å°†æ¶ˆæ¯æ‹’ç»ï¼Œä¸æ­¤åŒæ—¶å°† requeue è®¾ç½®ä¸º true ï¼Œè¿™æ ·è¿™æ¡æ¶ˆæ¯å°±å¯ä»¥é‡æ–°å­˜å…¥é˜Ÿåˆ—ä¸­ã€‚æ¶ˆæ¯ msg1 ä¹‹åè¢«å‘é€åˆ°äº† ConsumerB ä¸­ï¼Œæ­¤æ—¶ ConsumerB å·±ç»æ¶ˆè´¹äº† msg2 å’Œ msg4 ï¼Œä¹‹åå†æ¶ˆè´¹ msg1 ï¼Œè¿™æ ·æ¶ˆæ¯é¡ºåºæ€§ä¹Ÿå°±é”™ä¹±äº†ã€‚æˆ–è€…æ¶ˆæ¯ msg1 åˆé‡æ–°å‘å¾€ ConsumerA ä¸­ï¼Œæ­¤æ—¶ ConsumerA æ¶ˆè´¹äº† msg3, é‚£ä¹ˆå†æ¶ˆè´¹ msg1 ï¼Œæ¶ˆæ¯é¡ºåºæ€§ä¹Ÿæ— æ³•å¾—åˆ°ä¿éšœã€‚åŒæ ·å¯ä»¥ç”¨åœ¨ <code>Basic.Recover</code> è¿™ä¸ª AMQP å‘½ä»¤ä¸­ã€‚</li></ul><p>åŒ…æ‹¬ä½†ä¸ä»…é™äºä»¥ä¸Šå‡ ç§æƒ…å½¢ä¼šä½¿ RabbitMQ æ¶ˆæ¯é”™åºã€‚å¦‚æœè¦ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œéœ€è¦ä¸šåŠ¡æ–¹ä½¿ç”¨ RabbitMQ ä¹‹ååšè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œæ¯”å¦‚åœ¨æ¶ˆæ¯ä½“å†…æ·»åŠ å…¨å±€æœ‰åºæ ‡è¯†ï¼ˆç±»ä¼¼ Sequence ID ï¼‰æ¥å®ç°ã€‚</p><h3 id="9-3-å¼ƒç”¨QueueingConsumer"><a href="#9-3-å¼ƒç”¨QueueingConsumer" class="headerlink" title="9.3 å¼ƒç”¨QueueingConsumer"></a>9.3 å¼ƒç”¨QueueingConsumer</h3><p>åœ¨å‰é¢çš„ç« èŠ‚ä¸­æ‰€ä»‹ç»çš„è®¢é˜…æ¶ˆè´¹çš„æ–¹å¼éƒ½æ˜¯é€šè¿‡ç»§æ‰¿ <code>DefaultConsumer</code> ç±»æ¥å®ç°çš„ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨ <code>QueueingConsumer</code> è¿™ä¸ªç±»æ¥å®ç°è®¢é˜…æ¶ˆè´¹ï¼Œåœ¨ 4.x ç‰ˆæœ¬å¼€å§‹è¢«æ ‡è®°ä¸º <code>ï¼ Deprecated</code> ï¼Œæƒ³å¿…è¿™ä¸ªç±»ä¸­æœ‰äº›æ— æ³•å¼¥è¡¥çš„ç¼ºé™·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">QueueingConsumer consumer = <span class="keyword">new</span> QueueingConsumer(channel);</span><br><span class="line"><span class="comment">//channel.basicQos(64); //ä½¿ç”¨QueueingConsumerä¸€å®šè¦æ·»åŠ </span></span><br><span class="line">channel.basicConsume(QUEUE_NAME, <span class="keyword">false</span>, <span class="string">"consumer_zzh"</span>, consumer);</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">       QueueingConsumer.Delivery delivery = consumer.nextDelivery();</span><br><span class="line">       String message = <span class="keyword">new</span> String(delivery.getBody());</span><br><span class="line">       System.out.println(<span class="string">" [X] Received '"</span> + message + <span class="string">"'"</span>);</span><br><span class="line">       channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œè€Œä¸”å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¦‚æœä¸æ˜¯å¤ªâ€œå‚²å¨‡â€åœ°ä½¿ç”¨ä¹Ÿä¸ä¼šé€ æˆä»€ä¹ˆå¤§é—®é¢˜ã€‚QueueingConsumer æœ¬èº«æœ‰å‡ ä¸ªå¤§ç¼ºé™·ï¼Œéœ€è¦åœ¨ä½¿ç”¨æ—¶ç‰¹åˆ«æ³¨æ„ ï¼š</p><ul><li>é¦–å½“å…¶å†²çš„å°±æ˜¯å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼Œå¦‚æœç”±äºæŸäº›åŸå› ï¼Œé˜Ÿåˆ—ä¹‹ä¸­å †ç§¯äº†æ¯”è¾ƒå¤šçš„æ¶ˆæ¯ï¼Œå°±å¯èƒ½å¯¼è‡´æ¶ˆè´¹è€…å®¢æˆ·ç«¯å†…å­˜æº¢å‡ºå‡æ­»ï¼Œäºæ˜¯å‘ç”Ÿæ¶æ€§å¾ªç¯ï¼Œé˜Ÿåˆ—æ¶ˆæ¯ä¸æ–­å †ç§¯è€Œå¾—ä¸åˆ°æ¶ˆåŒ–ã€‚</li><li>QueueingConsumer ä¼šæ‹–ç´¯åŒä¸€ä¸ª Connection ä¸‹çš„æ‰€æœ‰ä¿¡é“ï¼Œä½¿å…¶æ€§èƒ½é™ä½ï¼›</li><li>åŒæ­¥é€’å½’è°ƒç”¨ QueueingConsumer ä¼šäº§ç”Ÿæ­»é”ï¼š</li><li>RabbitMQ çš„è‡ªåŠ¨è¿æ¥æ¢å¤æœºåˆ¶ï¼ˆ automatic connection recoveå¯ï¼‰ä¸æ”¯æŒ Queueing Consumer çš„è¿™ç§å½¢å¼ï¼š</li><li>QueueingConsumer ä¸æ˜¯äº‹ä»¶é©±åŠ¨çš„ã€‚</li></ul><p>é‡‡ç”¨ä»£ç æ¸…å• 4-22 ä¸­çš„ä»£ç è¿›è¡Œæ¼”ç¤º é¦–å…ˆå‘ä¸€ä¸ªé˜Ÿåˆ—å‘é€ 200å¤šMB çš„æ¶ˆæ¯ï¼Œç„¶åè¿›è¡Œæ¶ˆè´¹ã€‚åœ¨å®¢æˆ·ç«¯è°ƒç”¨ channel.basicConsume æ–¹æ³•è®¢é˜…é˜Ÿåˆ—çš„æ—¶å€™ï¼Œ RabbitMQ ä¼šæŒç»­åœ°å°†æ¶ˆæ¯å‘å¾€ QueueingConsumer ä¸­ï¼Œ QueueingConsumer å†…éƒ¨ä½¿ç”¨ LinkedBlockingQueue æ¥ç¼“å­˜è¿™äº›æ¶ˆæ¯ã€‚é€šè¿‡ JVisualVM å¯ä»¥çœ‹åˆ°å †å†…å­˜çš„å˜åŒ–ï¼Œå¦‚å›¾ 4-14 ç¤ºï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010176.png" alt></p><p>å¯ä»¥çœ‹åˆ°å †å†…å­˜ä¸€ç›´åœ¨å¢åŠ ï¼Œè¿™é‡Œåªæµ‹è¯•äº†å‘é€ 200MB å·¦å³çš„æ¶ˆæ¯ï¼Œå¦‚æœå‘é€æ›´å¤šçš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå †å†…å­˜ä¼šå˜å¾—æ›´å¤§ï¼Œç›´åˆ°å‡ºç° <code>java.lang.OutOfMemoryError</code> çš„æŠ¥é”™ã€‚</p><p>è¿™ä¸ªå†…å­˜æº¢å‡ºçš„é—®é¢˜å¯ä»¥ä½¿ç”¨ <code>Basic.Qos</code> æ¥å¾—åˆ°æœ‰æ•ˆçš„è§£å†³ï¼Œ<code>Basic.Qos</code> å¯ä»¥é™åˆ¶æŸä¸ªæ¶ˆè´¹è€…æ‰€ä¿æŒæœªç¡®è®¤æ¶ˆæ¯çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯é—´æ¥åœ°é™åˆ¶äº† QueueingConsumer ä¸­çš„ LinkedBlockingQueue çš„å¤§å°ã€‚æ³¨æ„ä¸€å®šè¦åœ¨è°ƒç”¨ <code>Basic.Consume</code> ä¹‹å‰è°ƒç”¨ <code>Basic.Qos</code> æ‰èƒ½ç”Ÿæ•ˆã€‚</p><p>ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå»ºè®®åœ¨æ¶ˆè´¹çš„æ—¶å€™å°½é‡ä½¿ç”¨ç»§æ‰¿ DefaultConsumer çš„æ–¹å¼ã€‚</p><h2 id="ç¬¬åèŠ‚-æ¶ˆæ¯ä¼ è¾“ä¿éšœ"><a href="#ç¬¬åèŠ‚-æ¶ˆæ¯ä¼ è¾“ä¿éšœ" class="headerlink" title="ç¬¬åèŠ‚ æ¶ˆæ¯ä¼ è¾“ä¿éšœ"></a>ç¬¬åèŠ‚ æ¶ˆæ¯ä¼ è¾“ä¿éšœ</h2><p>æ¶ˆæ¯å¯é ä¼ è¾“ä¸€èˆ¬æ˜¯ä¸šåŠ¡ç³»ç»Ÿæ¥å…¥æ¶ˆæ¯ä¸­é—´ä»¶æ—¶é¦–è¦è€ƒè™‘çš„é—®é¢˜ï¼Œ ä¸€èˆ¬æ¶ˆæ¯ä¸­é—´ä»¶çš„æ¶ˆæ¯ä¼ è¾“ä¿éšœåˆ†ä¸ºä¸‰ä¸ªå±‚çº§ï¼š</p><ul><li>At most onceï¼šæœ€å¤šä¸€æ¬¡ã€‚æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½†ç»ä¸ä¼šé‡å¤ä¼ è¾“ã€‚</li><li>At least onceï¼šæœ€å°‘ä¸€æ¬¡ã€‚æ¶ˆæ¯ç»ä¸ä¼šä¸¢å¤±ï¼Œä½†å¯èƒ½ä¼šé‡å¤ä¼ è¾“ã€‚</li><li>Exactly onceï¼šæ°å¥½ä¸€æ¬¡ã€‚æ¯æ¡æ¶ˆæ¯è‚¯å®šä¼šè¢«ä¼ è¾“ä¸€æ¬¡ä¸”ä»…ä¼ è¾“ä¸€æ¬¡ã€‚</li></ul><p>RabbitMQ æ”¯æŒå…¶ä¸­çš„â€œæœ€å¤šä¸€æ¬¡â€å’Œâ€œæœ€å°‘ä¸€æ¬¡â€ã€‚å…¶ä¸­â€œæœ€å°‘ä¸€æ¬¡â€æŠ•é€’å®ç°éœ€è¦è€ƒè™‘ä»¥ä¸‹è¿™ä¸ªå‡ ä¸ªæ–¹é¢çš„å†…å®¹ï¼š</p><ol><li>æ¶ˆæ¯ç”Ÿäº§è€…éœ€è¦å¼€å¯äº‹åŠ¡æœºåˆ¶æˆ–è€… publisher confirm æœºåˆ¶ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯å¯ä»¥å¯é åœ°ä¼ è¾“åˆ° RabbitMQ ä¸­ã€‚</li><li>æ¶ˆæ¯ç”Ÿäº§è€…éœ€è¦é…åˆä½¿ç”¨ mandatory å‚æ•°æˆ–è€…å¤‡ä»½äº¤æ¢å™¨æ¥ç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿä»äº¤æ¢å™¨è·¯ç”±åˆ°é˜Ÿåˆ—ä¸­ï¼Œè¿›è€Œèƒ½å¤Ÿä¿å­˜ä¸‹æ¥è€Œä¸ä¼šè¢«ä¸¢å¼ƒã€‚</li><li>æ¶ˆæ¯å’Œé˜Ÿåˆ—éƒ½éœ€è¦è¿›è¡ŒæŒä¹…åŒ–å¤„ç†ï¼Œä»¥ç¡®ä¿ RabbitMQ åŠ¡å™¨åœ¨é‡åˆ°å¼‚å¸¸æƒ…å†µæ—¶ä¸ä¼šé€ æˆæ¶ˆæ¯ä¸¢å¤±ã€‚</li><li>æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ¶ˆæ¯çš„åŒæ—¶éœ€è¦å°† autoAck è®¾ç½®ä¸º false ï¼Œç„¶åé€šè¿‡æ‰‹åŠ¨ç¡®è®¤çš„æ–¹å¼å»ç¡®è®¤å·±ç»æ­£ç¡®æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œä»¥é¿å…åœ¨æ¶ˆè´¹ç«¯å¼•èµ·ä¸å¿…è¦çš„æ¶ˆæ¯ä¸¢å¤±ã€‚</li></ol><p>â€œæœ€å¤šä¸€æ¬¡â€çš„æ–¹å¼å°±æ— é¡»è€ƒè™‘ä»¥ä¸Šé‚£äº›æ–¹é¢ï¼Œç”Ÿäº§è€…éšæ„å‘é€ï¼Œæ¶ˆè´¹è€…éšæ„æ¶ˆè´¹ï¼Œä¸è¿‡è¿™æ ·å¾ˆéš¾ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚</p><p>â€œæ°å¥½ä¸€æ¬¡â€æ˜¯ RabbitMQ ç›®å‰æ— æ³•ä¿éšœçš„ã€‚è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹å®Œä¸€æ¡æ¶ˆæ¯ä¹‹åå‘ RabbitMQ å‘é€ç¡®è®¤ <code>Basic.Ack</code> å‘½ä»¤ï¼Œæ­¤æ—¶ç”±äºç½‘ç»œæ–­å¼€æˆ–è€…å…¶ä»–åŸå› é€ æˆ RabbitMQ å¹¶æ²¡æœ‰æ”¶åˆ°è¿™ä¸ªç¡®è®¤å‘½ä»¤ï¼Œé‚£ä¹ˆ RabbitMQ ä¸ä¼šå°†æ­¤æ¡æ¶ˆæ¯æ ‡è®°åˆ é™¤ã€‚åœ¨é‡æ–°å»ºç«‹è¿æ¥ä¹‹åï¼Œ æ¶ˆè´¹è€…è¿˜æ˜¯ä¼šæ¶ˆè´¹åˆ°è¿™ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™å°±é€ æˆäº†é‡å¤æ¶ˆè´¹ã€‚å†è€ƒè™‘ä¸€ç§æƒ…å†µï¼Œç”Ÿäº§è€…åœ¨ä½¿ç”¨ publisher confirm æœºåˆ¶çš„æ—¶å€™ï¼Œå‘é€å®Œä¸€æ¡æ¶ˆæ¯ç­‰å¾… RabbitMQ è¿”å›ç¡®è®¤é€šçŸ¥ï¼Œæ­¤æ—¶ç½‘ç»œæ–­å¼€ï¼Œç”Ÿäº§è€…æ•è·åˆ°å¼‚å¸¸æƒ…å†µï¼Œä¸ºäº†ç¡®ä¿æ¶ˆæ¯å¯é æ€§é€‰æ‹©é‡æ–°å‘é€ï¼Œè¿™æ · RabbitMQ ä¸­å°±æœ‰ä¸¤æ¡åŒæ ·çš„æ¶ˆæ¯ï¼Œåœ¨æ¶ˆè´¹çš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…å°±ä¼šé‡å¤æ¶ˆè´¹ã€‚</p><p>é‚£ä¹ˆ RabbitMQ æœ‰æ²¡æœ‰å»é‡çš„æœºåˆ¶æ¥ä¿è¯â€œæ°å¥½ä¸€æ¬¡â€å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¹¶æ²¡æœ‰ï¼Œä¸ä»…æ˜¯ RabbitMQ, ç›®å‰å¤§å¤šæ•°ä¸»æµçš„æ¶ˆæ¯ä¸­é—´ä»¶éƒ½æ²¡æœ‰æ¶ˆæ¯å»é‡æœºåˆ¶ï¼Œä¹Ÿä¸ä¿éšœâ€œæ°å¥½ä¸€æ¬¡â€ã€‚å»é‡å¤„ç†ä¸€èˆ¬æ˜¯åœ¨ä¸šåŠ¡å®¢æˆ·ç«¯å®ç°ï¼Œæ¯”å¦‚å¼•å…¥ GUID (Globally Unique Identifierï¼‰çš„æ¦‚å¿µã€‚é’ˆå¯¹ GUID ï¼Œå¦‚æœä»å®¢æˆ·ç«¯çš„è§’åº¦å» ï¼Œé‚£ä¹ˆéœ€è¦å¼•å…¥é›†ä¸­å¼ç¼“å­˜ï¼Œå¿…ç„¶ä¼šå¢åŠ ä¾èµ–å¤æ‚åº¦ï¼Œå¦å¤–ç¼“å­˜çš„å¤§å°ä¹Ÿéš¾ä»¥ç•Œå®šã€‚å»ºè®®åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸šåŠ¡æ–¹æ ¹æ®è‡ªèº«çš„ä¸šåŠ¡ç‰¹æ€§è¿›è¡Œå»é‡ï¼Œæ¯”å¦‚ä¸šåŠ¡æ¶ˆæ¯æœ¬èº«å…·å¤‡å¹‚ç­‰æ€§ï¼Œæˆ–è€…å€ŸåŠ© Redis ç­‰å…¶ä»–äº§å“è¿›è¡Œå»é‡å¤„ç†ã€‚</p><hr><p>å‚è€ƒï¼š<br>ğŸ”— ã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹</p>]]></content>
    
    <summary type="html">
    
      å­¦ä¹ RabbitMQï¼Œç¬¬ä¸‰ç« ã€Šè¿›é˜¶ã€‹ï¼Œå†…å®¹æ¥è‡ªäºã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šæ¶ˆæ¯ä½•å»ä½•ä»ï¼Œè¿‡æœŸæ—¶é—´ï¼Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œå»¶è¿Ÿé˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŒRPCå®ç°ï¼ŒæŒä¹…åŒ–ï¼Œç”Ÿäº§è€…ç¡®è®¤ï¼Œæ¶ˆè´¹ç«¯è¦ç‚¹ï¼Œæ¶ˆæ¯ä¼ è¾“ä¿éšœç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="mom" scheme="http://linyishui.top/tags/mom/"/>
    
      <category term="rabbitmq" scheme="http://linyishui.top/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®å¤‡ä»½mysqldump</title>
    <link href="http://linyishui.top/2020092601.html"/>
    <id>http://linyishui.top/2020092601.html</id>
    <published>2020-09-27T06:46:17.000Z</published>
    <updated>2020-10-02T08:15:15.627Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æ•°æ®å¤‡ä»½mysqldump"><a href="#æ•°æ®å¤‡ä»½mysqldump" class="headerlink" title="æ•°æ®å¤‡ä»½mysqldump"></a>æ•°æ®å¤‡ä»½mysqldump</h1><h2 id="ç¬¬ä¸€èŠ‚-æ¦‚è¿°"><a href="#ç¬¬ä¸€èŠ‚-æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€èŠ‚ æ¦‚è¿°"></a>ç¬¬ä¸€èŠ‚ æ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯mysqldumpï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯mysqldumpï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯mysqldumpï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯mysqldumpï¼Ÿ</h3><p> <code>mysqldump</code> æ˜¯ç”¨äºè½¬å­˜å‚¨ <code>mysql</code> æ•°æ®åº“çš„å®ç”¨ç¨‹åºã€‚ç”Ÿæˆä¸€ä¸ª <code>SQL</code> è„šæœ¬ï¼Œå…¶ä¸­åŒ…å«ä»å¤´é‡æ–°åˆ›å»ºæ•°æ®åº“çš„æ‰€æœ‰å‘½ä»¤ã€‚</p><p>å¯¼å‡ºè„šæœ¬çš„å¤§æ¦‚è¿‡ç¨‹ï¼šåˆ›å»ºæ•°æ®åº“åˆ¤æ–­è¯­å¥ã€åˆ é™¤è¡¨ã€åˆ›å»ºè¡¨ã€é”è¡¨ã€ç¦ç”¨ç´¢å¼•ã€æ’å…¥æ•°æ®ã€å¯ç”¨ç´¢å¼•ã€è§£é”è¡¨ã€‚</p><h3 id="1-2-ç®€å•ä½¿ç”¨"><a href="#1-2-ç®€å•ä½¿ç”¨" class="headerlink" title="1.2 ç®€å•ä½¿ç”¨"></a>1.2 ç®€å•ä½¿ç”¨</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># game æ˜¯åº“å</span><br><span class="line"></span><br><span class="line"># å®Œæ•´å¯¼å‡ºä¸€ä¸ªåº“</span><br><span class="line"># åŒ…æ‹¬å»ºåº“è¯­å¥ã€è¡¨ç»“æ„ã€æ•°æ®</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 --port=3306 --databases game &gt; test.sql</span></span><br><span class="line"></span><br><span class="line"># åªå¯¼å‡ºè¡¨ç»“æ„</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 --port=3306 -d game &gt; test.sql</span></span><br><span class="line"></span><br><span class="line"># åªå¯¼å‡ºæ•°æ®</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 --port=3306 -t game &gt; test.sql</span></span><br><span class="line"></span><br><span class="line"># å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­å¤šä¸ªè¡¨çš„æ•°æ®å’Œç»“æ„</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 game --tables articles users &gt; test.sql</span></span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 game articles users &gt; test.sql</span></span><br><span class="line"></span><br><span class="line"># æ¢å¤å¯¼å‡ºæ•°æ®</span><br><span class="line">mysql -u username -proot databse &lt; backup.sql</span><br></pre></td></tr></table></figure><p>å‚æ•°ï¼š</p><ul><li><code>--user=user_name, -u user_name</code> ï¼šè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åã€‚</li><li><code>--password=password, -p[password]</code> ï¼šè¿æ¥æ•°æ®åº“çš„å¯†ç ï¼Œå¦‚æœä½¿ç”¨ <code>-p</code> ç¼©å†™ï¼Œå’Œå¯†ç ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</li><li><code>--opt or --compact</code> ï¼š<ul><li>ä½¿ç”¨ <code>--opt</code> ç­‰äºä½¿ç”¨è¿™äº›å‚æ•° <code>--add-drop-table, --add-locks, --create-options, --disable-keys, --extended-insert, --lock-tables, --quick, and --set-charset</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹å³ä½¿ä¸åŠ  <code>--opt</code> å‚æ•°ä¹Ÿæ˜¯å¼€å¯çš„ã€‚</li><li>ä½¿ç”¨ <code>--compact</code> ç­‰äºä½¿ç”¨è¿™äº›å‚æ•° <code>--skip-add-drop-table, --skip-add-locks, --skip-comments, --skip-disable-keys, and --skip-set-charset</code>ï¼Œé»˜è®¤ä¸å¼€å¯ã€‚</li></ul></li><li><code>--databases, -B</code> ï¼šæŒ‡å®šå¯¼å‡ºçš„åº“åã€‚</li><li><code>--all-databases</code> ï¼šè¡¨ç¤ºå¯¼å‡ºæ‰€æœ‰çš„åº“ã€‚</li><li><code>--tables</code> ï¼šä¼šè¦†ç›– â€“databases or -B é€‰é¡¹ï¼ŒæŒ‡å®šå¯¼å‡ºæŸä¸ªè¡¨å°±ä¼šå¿½ç•¥åº“é€‰é¡¹ã€‚</li><li><code>--no-data, -d</code> ï¼šä¸å¯¼å‡ºæ•°æ®ï¼Œåªå¯¼å‡ºè¡¨ç»“æ„ã€‚</li><li><code>--no-create-info, -t</code> ï¼šåªå¯¼å‡ºæ•°æ®ï¼Œä¸å¯¼å‡ºè¡¨ç»“æ„ï¼Œä¸æ·»åŠ  <code>CREATE TABLE</code> è¯­å¥ã€‚</li><li><code>--no-create-db, -n</code> ï¼šä¸æ·»åŠ  <code>CREATE DATABASE</code> å»ºåº“è¯­å¥ã€‚</li><li><code>--routines, -R</code> ï¼šå¯¼å‡ºå­˜å‚¨è¿‡ç¨‹ä»¥åŠè‡ªå®šä¹‰å‡½æ•°ã€‚</li></ul><h2 id="ç¬¬äºŒèŠ‚"><a href="#ç¬¬äºŒèŠ‚" class="headerlink" title="ç¬¬äºŒèŠ‚"></a>ç¬¬äºŒèŠ‚</h2><p>å®ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“</span><br><span class="line">// åŒ…æ‹¬å»ºåº“è¯­å¥ã€åˆ è¡¨è¯­å¥ã€å»ºè¡¨è¯­å¥ã€æ’å…¥æ•°æ®</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 --port=3306 --databases game &gt; test.sql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="comment">/*!32312 IF NOT EXISTS*/</span> <span class="string">`game`</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET latin1 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> <span class="string">`game`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `address`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`address`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`address`</span> (</span><br><span class="line">        ...</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">LOCK</span> <span class="keyword">TABLES</span> <span class="string">`address`</span> WRITE;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `address` DISABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ...</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `address` ENABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">UNLOCK</span> <span class="keyword">TABLES</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">// -d ä¸å¯¼å‡ºæ•°æ®ï¼Œå¯¼å‡ºæ‰€æœ‰çš„å»ºè¡¨åˆ è¡¨è¯­å¥ï¼Œä¸åŒ…æ‹¬å»ºåº“è¯­å¥ï¼Œ</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 --port=3306 -d game &gt; test.sql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`address`</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = utf8 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`address`</span> (</span><br><span class="line">        ...</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// -t ä¸å¯¼å‡ºç»“æ„ï¼Œå¯¼å‡ºæ‰€æœ‰è¡¨ä¸­çš„æ•°æ®ï¼Œä¸åŒ…æ‹¬å»ºåº“è¯­å¥ï¼Œéƒ½æ˜¯æ’å…¥è¯­å¥</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 --port=3306 -t game &gt; test.sql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">LOCK</span> <span class="keyword">TABLES</span> <span class="string">`address`</span> WRITE;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `address` DISABLE KEYS */</span>;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `address` ENABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">UNLOCK</span> <span class="keyword">TABLES</span>;</span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“çš„è¡¨ç»“æ„ä»¥åŠæ•°æ®ï¼Œä¸åŒ…æ‹¬å»ºåº“è¯­å¥</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 --port=3306 game &gt; test.sql</span></span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºå¤šä¸ªæ•°æ®åº“çš„è¡¨ç»“æ„ä»¥åŠæ•°æ®ï¼ŒåŒ…æ‹¬å»ºåº“è¯­å¥</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 -B game game2 &gt; test.sql</span></span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºå¤šä¸ªæ•°æ®åº“çš„ç»“æ„ï¼ŒåŒ…æ‹¬å»ºåº“è¯­å¥</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 -d -B game game2 &gt; test.sql</span></span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºå¤šä¸ªæ•°æ®åº“çš„æ•°æ®ï¼ŒåŒ…æ‹¬å»ºåº“è¯­å¥</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 -t -B game game2 &gt; test.sql</span></span><br></pre></td></tr></table></figure><p>å¯¼å‡ºæŸå¼ è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­ä¸€ä¸ªè¡¨çš„ç»“æ„ï¼Œå¯¼å‡º articles è¡¨çš„ç»“æ„å’Œæ•°æ®</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 game articles &gt; test.sql</span></span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­å¤šä¸ªè¡¨çš„æ•°æ®å’Œç»“æ„</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 game --tables articles users &gt; test.sql</span></span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 game articles users &gt; test.sql</span></span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­å¤šä¸ªè¡¨çš„ç»“æ„</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 -d game articles users &gt; test.sql</span></span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­å¤šä¸ªè¡¨çš„æ•°æ®</span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 -t game articles users &gt; test.sql</span></span><br></pre></td></tr></table></figure><p>æ•°æ®è¡¨æ¡ä»¶å¯¼å‡ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å‡º articles è¡¨ id = 1 çš„æ•°æ®</span></span><br><span class="line">mysqldump -u root -p root <span class="comment">--host=127.0.0.1 --where='id=1' game articles &gt; test.sql</span></span><br></pre></td></tr></table></figure><p>å¿½ç•¥æŸå¼ è¡¨ï¼šå¤šæ¬¡æ·»åŠ å¿½ç•¥å¤šå¼ è¡¨ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ignore-table database.tableName</span></span><br></pre></td></tr></table></figure><p>å¯¼å…¥æŸä¸ªè¡¨æ•°æ®è„šæœ¬ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># æ•°æ®æ¥æº</span><br><span class="line">src_user="root" # ç”¨æˆ·å</span><br><span class="line">src_password="root" # å¯†ç </span><br><span class="line">src_host="localhost" # Host</span><br><span class="line">src_port="3306" # ç«¯å£</span><br><span class="line">src_database="test" # æ•°æ®åº“å</span><br><span class="line">src_table="edu" # è¡¨å</span><br><span class="line"></span><br><span class="line"># æ•°æ®å¯¼å…¥çš„æ•°æ®åº“é…ç½®</span><br><span class="line">dst_user="root" # ç”¨æˆ·å</span><br><span class="line">dst_password="root" # å¯†ç </span><br><span class="line">dst_host="localhost" # Host</span><br><span class="line">dst_port="3306" # ç«¯å£</span><br><span class="line">dst_database="test" # æ•°æ®åº“å</span><br><span class="line"></span><br><span class="line">mysqldump <span class="comment">--host=$src_host --port=$src_port -u$src_user -p$src_password $src_database --tables $src_table | mysql --host=$dst_host --port=$dst_port -u$dst_user -p$dst_password $dst_database</span></span><br></pre></td></tr></table></figure><p>å¤‡ä»½è„šæœ¬ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># ä»¥ä¸‹é…ç½®ä¿¡æ¯è¯·è‡ªå·±ä¿®æ”¹</span><br><span class="line">mysql_user="root" #MySQLå¤‡ä»½ç”¨æˆ·</span><br><span class="line">mysql_password="root" #MySQLå¤‡ä»½ç”¨æˆ·çš„å¯†ç </span><br><span class="line">mysql_host="localhost"</span><br><span class="line">mysql_port="3306"</span><br><span class="line">mysql_charset="utf8mb4" #MySQLç¼–ç </span><br><span class="line">backup_db_arr=("db1" "db2") #è¦å¤‡ä»½çš„æ•°æ®åº“åç§°ï¼Œå¤šä¸ªç”¨ç©ºæ ¼åˆ†å¼€éš”å¼€ å¦‚("db1" "db2" "db3")</span><br><span class="line">backup_location=/var/www/mysql  #å¤‡ä»½æ•°æ®å­˜æ”¾ä½ç½®ï¼Œæœ«å°¾è¯·ä¸è¦å¸¦"/",æ­¤é¡¹å¯ä»¥ä¿æŒé»˜è®¤ï¼Œç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="line">expire_backup_delete="OFF" #æ˜¯å¦å¼€å¯è¿‡æœŸå¤‡ä»½åˆ é™¤ ONä¸ºå¼€å¯ OFFä¸ºå…³é—­</span><br><span class="line">expire_days=3 #è¿‡æœŸæ—¶é—´å¤©æ•° é»˜è®¤ä¸ºä¸‰å¤©ï¼Œæ­¤é¡¹åªæœ‰åœ¨expire_backup_deleteå¼€å¯æ—¶æœ‰æ•ˆ</span><br><span class="line"></span><br><span class="line"># æœ¬è¡Œå¼€å§‹ä»¥ä¸‹ä¸éœ€è¦ä¿®æ”¹</span><br><span class="line">backup_time=`date +%Y%m%d%H%M`  #å®šä¹‰å¤‡ä»½è¯¦ç»†æ—¶é—´</span><br><span class="line">backup_Ymd=`date +%Y-%m-%d` #å®šä¹‰å¤‡ä»½ç›®å½•ä¸­çš„å¹´æœˆæ—¥æ—¶é—´</span><br><span class="line">backup_3ago=`date -d '3 days ago' +%Y-%m-%d` #3å¤©ä¹‹å‰çš„æ—¥æœŸ</span><br><span class="line">backup_dir=$backup_location/$backup_Ymd  #å¤‡ä»½æ–‡ä»¶å¤¹å…¨è·¯å¾„</span><br><span class="line">welcome_msg="Welcome to <span class="keyword">use</span> MySQL <span class="keyword">backup</span> tools!<span class="string">" #æ¬¢è¿è¯­</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># åˆ¤æ–­MYSQLæ˜¯å¦å¯åŠ¨,mysqlæ²¡æœ‰å¯åŠ¨åˆ™å¤‡ä»½é€€å‡º</span></span><br><span class="line"><span class="string">mysql_ps=`ps -ef |grep mysql |wc -l`</span></span><br><span class="line"><span class="string">mysql_listen=`netstat -an |grep LISTEN |grep $mysql_port|wc -l`</span></span><br><span class="line"><span class="string">if [ [$mysql_ps == 0] -o [$mysql_listen == 0] ]; then</span></span><br><span class="line"><span class="string">        echo "</span><span class="keyword">ERROR</span>:MySQL <span class="keyword">is</span> <span class="keyword">not</span> running! <span class="keyword">backup</span> <span class="keyword">stop</span>!<span class="string">"</span></span><br><span class="line"><span class="string">        exit</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">        echo $welcome_msg</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># è¿æ¥åˆ°mysqlæ•°æ®åº“ï¼Œæ— æ³•è¿æ¥åˆ™å¤‡ä»½é€€å‡º</span></span><br><span class="line"><span class="string">mysql -h$mysql_host -P$mysql_port -u$mysql_user -p$mysql_password &lt;&lt;end</span></span><br><span class="line"><span class="string">use mysql;</span></span><br><span class="line"><span class="string">select host,user from user where user='root' and host='localhost';</span></span><br><span class="line"><span class="string">exit</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flag=`echo $?`</span></span><br><span class="line"><span class="string">if [ $flag != "</span><span class="number">0</span><span class="string">" ]; then</span></span><br><span class="line"><span class="string">        echo "</span><span class="keyword">ERROR</span>:Can<span class="string">'t connect mysql server! backup stop!"</span></span><br><span class="line"><span class="string">        exit</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">        echo "MySQL connect ok! Please wait......"</span></span><br><span class="line"><span class="string">        # åˆ¤æ–­æœ‰æ²¡æœ‰å®šä¹‰å¤‡ä»½çš„æ•°æ®åº“ï¼Œå¦‚æœå®šä¹‰åˆ™å¼€å§‹å¤‡ä»½ï¼Œå¦åˆ™é€€å‡ºå¤‡ä»½</span></span><br><span class="line"><span class="string">        if [ "$backup_db_arr" != "" ];then</span></span><br><span class="line"><span class="string">                #dbnames=$(cut -d '</span>,<span class="string">' -f1-5 $backup_database)</span></span><br><span class="line"><span class="string">                #echo "arr is ($&#123;backup_db_arr[@]&#125;)"</span></span><br><span class="line"><span class="string">                for dbname in $&#123;backup_db_arr[@]&#125;</span></span><br><span class="line"><span class="string">                do</span></span><br><span class="line"><span class="string">                        echo "database $dbname backup start..."</span></span><br><span class="line"><span class="string">                        `mkdir -p $backup_dir`</span></span><br><span class="line"><span class="string">                        `mysqldump -h$mysql_host -P$mysql_port -u$mysql_user -p$mysql_password $dbname --default-character-set=$mysql_charset | gzip &gt; $backup_dir/$dbname-$backup_time.sql.gz`</span></span><br><span class="line"><span class="string">                        flag=`echo $?`</span></span><br><span class="line"><span class="string">                        if [ $flag == "0" ];then</span></span><br><span class="line"><span class="string">                                echo "database $dbname success backup to $backup_dir/$dbname-$backup_time.sql.gz"</span></span><br><span class="line"><span class="string">                        else</span></span><br><span class="line"><span class="string">                                echo "database $dbname backup fail!"</span></span><br><span class="line"><span class="string">                        fi</span></span><br><span class="line"><span class="string">                        </span></span><br><span class="line"><span class="string">                done</span></span><br><span class="line"><span class="string">        else</span></span><br><span class="line"><span class="string">                echo "ERROR:No database to backup! backup stop"</span></span><br><span class="line"><span class="string">                exit</span></span><br><span class="line"><span class="string">        fi</span></span><br><span class="line"><span class="string">        # å¦‚æœå¼€å¯äº†åˆ é™¤è¿‡æœŸå¤‡ä»½ï¼Œåˆ™è¿›è¡Œåˆ é™¤æ“ä½œ</span></span><br><span class="line"><span class="string">        if [ "$expire_backup_delete" == "ON" -a  "$backup_location" != "" ];then</span></span><br><span class="line"><span class="string">                 #`find $backup_location/ -type d -o -type f -ctime +$expire_days -exec rm -rf &#123;&#125; \;`</span></span><br><span class="line"><span class="string">                 `find $backup_location/ -type d -mtime +$expire_days | xargs rm -rf`</span></span><br><span class="line"><span class="string">                 echo "Expired backup data delete complete!"</span></span><br><span class="line"><span class="string">        fi</span></span><br><span class="line"><span class="string">        echo "All database backup success! Thank you!"</span></span><br><span class="line"><span class="string">        exit</span></span><br><span class="line"><span class="string">fi</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹shellè„šæœ¬çš„å±æ€§ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod <span class="number">600</span> <span class="regexp">/root/my</span>sql_backup.sh</span><br><span class="line">chmod +x <span class="regexp">/root/my</span>sql_backup.sh</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¥½å±æ€§ä¹‹åï¼ŒæŠŠå‘½ä»¤åŠ å…¥ <code>crontab</code>ï¼Œè®¾ç½®æ¯å¤© <code>00:00</code> å®šæ—¶è‡ªåŠ¨å¤‡ä»½ã€‚</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">00 </span><span class="number">00</span> * * * /path/<span class="keyword">to</span>/mysql_backup.sh</span><br></pre></td></tr></table></figure><p>æ¢å¤å¤‡ä»½ï¼š</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql -u username -proot databse &lt; backup.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">// å’Œå»ºåº“è¯­å¥ä¸€èµ·å¯¼å…¥</span></span><br><span class="line">mysql -u root -p root --host=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> --port=<span class="number">33006</span>  &lt; global.sql</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">use dbname;</span><br><span class="line"></span><br><span class="line">source dbname.sql</span><br></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— <a href="https://juejin.im/post/6844903653183062030" target="_blank" rel="noopener">mysqldump æ·±å…¥æµ…å‡º</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ•°æ®è¿ç§»</title>
    <link href="http://linyishui.top/2020092701.html"/>
    <id>http://linyishui.top/2020092701.html</id>
    <published>2020-09-27T06:06:40.000Z</published>
    <updated>2020-10-02T08:14:17.496Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æ•°æ®è¿ç§»"><a href="#æ•°æ®è¿ç§»" class="headerlink" title="æ•°æ®è¿ç§»"></a>æ•°æ®è¿ç§»</h1><h2 id="ç¬¬ä¸€èŠ‚-æ¦‚è¿°"><a href="#ç¬¬ä¸€èŠ‚-æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€èŠ‚ æ¦‚è¿°"></a>ç¬¬ä¸€èŠ‚ æ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯æ•°æ®è¿ç§»ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯æ•°æ®è¿ç§»ï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯æ•°æ®è¿ç§»ï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯æ•°æ®è¿ç§»ï¼Ÿ</h3><p><strong>æ•°æ®è¿ç§»</strong>ï¼ˆè‹±è¯­ï¼šdata migrationï¼‰æ˜¯æŒ‡<strong>é€‰æ‹©ã€å‡†å¤‡ã€æå–å’Œè½¬æ¢æ•°æ®</strong>ï¼Œå¹¶<strong>å°†æ•°æ®ä»ä¸€ä¸ªè®¡ç®—æœºå­˜å‚¨ç³»ç»Ÿæ°¸ä¹…åœ°ä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºå­˜å‚¨ç³»ç»Ÿ</strong>çš„è¿‡ç¨‹ã€‚æ­¤å¤–ï¼Œ<strong>éªŒè¯è¿ç§»æ•°æ®çš„å®Œæ•´æ€§</strong>å’Œ<strong>é€€å½¹åŸæ¥æ—§çš„æ•°æ®å­˜å‚¨</strong>ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯æ•´ä¸ªæ•°æ®è¿ç§»è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚æ•°æ®è¿ç§»æ˜¯ä»»ä½•ç³»ç»Ÿå®ç°ã€å‡çº§æˆ–é›†æˆçš„å…³é”®è€ƒè™‘å› ç´ ï¼Œé€šå¸¸ä»¥å°½å¯èƒ½è‡ªåŠ¨åŒ–çš„æ–¹å¼æ‰§è¡Œï¼Œä»è€Œå°†äººåŠ›èµ„æºä»ç¹ççš„ä»»åŠ¡ä¸­è§£æ”¾å‡ºæ¥ã€‚æ•°æ®è¿ç§»æœ‰å¤šç§åŸå› ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨æˆ–å­˜å‚¨è®¾å¤‡æ›´æ¢ã€ç»´æŠ¤æˆ–å‡çº§ã€åº”ç”¨ç¨‹åºè¿ç§»ã€ç½‘ç«™é›†æˆã€ç¾éš¾æ¢å¤å’Œæ•°æ®ä¸­å¿ƒè¿ç§»ã€‚</p><h3 id="1-2-ä¸ºä»€ä¹ˆéœ€è¦è¿ç§»æ•°æ®ï¼Ÿ"><a href="#1-2-ä¸ºä»€ä¹ˆéœ€è¦è¿ç§»æ•°æ®ï¼Ÿ" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆéœ€è¦è¿ç§»æ•°æ®ï¼Ÿ"></a>1.2 ä¸ºä»€ä¹ˆéœ€è¦è¿ç§»æ•°æ®ï¼Ÿ</h3><ul><li>æ•°æ®å¤‡ä»½</li><li>æ•°æ®è½¬æ¢</li><li>ä¸šåŠ¡éœ€æ±‚</li><li>â€¦â€¦</li></ul><h3 id="1-3-å¸¸è§æ–¹æ¡ˆ"><a href="#1-3-å¸¸è§æ–¹æ¡ˆ" class="headerlink" title="1.3 å¸¸è§æ–¹æ¡ˆ"></a>1.3 å¸¸è§æ–¹æ¡ˆ</h3><ul><li>mysqldumpï¼šå¯¼å‡ºä¸€ä¸ªSQLæ–‡ä»¶ï¼Œå†åœ¨æ–°æ•°æ®åº“ä¸­æ‰§è¡Œã€‚æ•ˆç‡ä½è€—æ—¶é«˜ï¼Œå¤±è´¥ç‡é«˜ã€‚<ul><li>å‚è€ƒï¼šã€Š<a href="../2020092601.html" title="Title">æ•°æ®å¤‡ä»½mysqldump</a>ã€‹</li></ul></li><li>è„šæœ¬è¿ç§»ï¼š<ul><li><strong>å®ç°ä¸€ä¸ªè¿ç§»è„šæœ¬</strong>ï¼Œè¿œç¨‹è¿æ¥æºæ•°æ®åº“ï¼Œåˆ†å—è¯»å–åå†å†™å…¥ç›®æ ‡æ•°æ®åº“ã€‚å¯ä»¥é€šè¿‡åˆ‡åˆ†ç„¶åå¤šçº¿ç¨‹æ‰§è¡Œçš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼Œä½†<strong>åªèƒ½å…ˆè¯»åå†™</strong>ã€‚</li><li><strong>é€šè¿‡ Redis æ­å»ºä¸€ä¸ªç”Ÿäº§è€…+ æ¶ˆè´¹è€…çš„è¿ç§»æ–¹æ¡ˆ</strong>ï¼Œåœ¨æºæ•°æ®æœåŠ¡å™¨è¿è¡Œä¸€ä¸ªå¤šçº¿ç¨‹è„šæœ¬ï¼Œå¹¶è¡Œè¯»å–æ•°æ®ï¼Œå¹¶ç”Ÿäº§åˆ°Redisé˜Ÿåˆ—ï¼›åœ¨ç›®æ ‡æœåŠ¡å™¨ä¹Ÿè¿è¡Œä¸€ä¸ªå¤šçº¿ç¨‹è„šæœ¬ï¼Œè¿œç¨‹è¿æ¥Redisï¼Œå¹¶è¡Œè¯»å–é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œå¹¶æŠŠæ•°æ®å†™å…¥ç›®æ ‡æ•°æ®åº“ã€‚ç›¸æ¯”å‰ä¸€ä¸ªæ–¹æ¡ˆï¼Œè¿™ç§æ–¹å¼æ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼Œ<strong>è¯»å’Œå†™å¯ä»¥åŒæ—¶è¿›è¡Œ</strong>ã€‚</li></ul></li><li>æ–‡ä»¶è¿ç§»ï¼šSqlLoaderï¼ˆOracleï¼‰æˆ– <code>load data infile</code>ï¼ˆMySqlï¼‰å¦‚ï¼š <code>select data into outfile file.txt</code>ã€<code>load data infile file.txt into table</code> çš„å‘½ä»¤ã€‚<ul><li>å‚è€ƒï¼šã€Š<a href="../2020092401.html" title="Title">SqlLoader</a>ã€‹</li></ul></li></ul><h2 id="ç¬¬äºŒèŠ‚-æ–¹æ¡ˆå®æˆ˜"><a href="#ç¬¬äºŒèŠ‚-æ–¹æ¡ˆå®æˆ˜" class="headerlink" title="ç¬¬äºŒèŠ‚ æ–¹æ¡ˆå®æˆ˜"></a>ç¬¬äºŒèŠ‚ æ–¹æ¡ˆå®æˆ˜</h2><p>æ•°æ®å‡†å¤‡ï¼Œä¸€å¼ æ—¥å¿—è¡¨ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010163.png" alt></p><p>æ•°æ®é‡ä¸ºä¸€åƒä¸‡ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010164.png" alt></p><p>å°†å…¶ä» test åº“è¿ç§»åˆ° test_b åº“ã€‚</p><h3 id="2-1-mysqldump"><a href="#2-1-mysqldump" class="headerlink" title="2.1 mysqldump"></a>2.1 mysqldump</h3><h3 id="2-MySql-SqlLoader"><a href="#2-MySql-SqlLoader" class="headerlink" title="2. MySql SqlLoader"></a>2. MySql SqlLoader</h3><p>1.åœ¨æºæ•°æ®åº“å¯¼å‡ºæ•°æ®æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> logs1 <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'logs1.txt'</span>;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè€—æ—¶ï¼šï¼ˆåªéœ€åŠåˆ†é’Ÿï¼‰</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010160.png" alt></p><p>æ–‡ä»¶å¤§å°ï¼š676MB</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010161.png" alt></p><p>ç”Ÿæˆæ–‡ä»¶æ ¼å¼ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">1811</span><span class="selector-tag">1</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span>é¦–é¡µ</span><br><span class="line"><span class="selector-tag">1812</span><span class="selector-tag">2</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:01</span>é¦–é¡µ</span><br><span class="line"><span class="selector-tag">1813</span><span class="selector-tag">1</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:02</span>é¦–é¡µ</span><br><span class="line"><span class="selector-tag">1814</span><span class="selector-tag">1</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:03</span>é¦–é¡µ</span><br><span class="line"><span class="selector-tag">1815</span><span class="selector-tag">1</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:04</span>é¦–é¡µ</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>2.å¤åˆ¶æ•°æ®æ–‡ä»¶åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼šï¼ˆå¦‚æœæ˜¯åœ¨æœåŠ¡å™¨ç«¯æ“ä½œï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zip fans.zip /data/fans.txt</span><br><span class="line">scp fans.zip root@ip:/data/ </span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨ç›®æ ‡æ•°æ®åº“å¯¼å…¥æ–‡ä»¶</span></span><br><span class="line">unzip /data/fans.zip</span><br></pre></td></tr></table></figure><p>3.ç›®æ ‡æ•°æ®åº“æ‰§è¡Œå‘½ä»¤ï¼šï¼ˆéœ€è¦å…ˆå¯¼å…¥è¡¨ç»“æ„ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'logs1.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> logs1(<span class="keyword">id</span>, logtype, logurl, logip, logdz, ladduser, lfadduser, laddtime, htmlname);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè€—æ—¶ï¼šï¼ˆåªéœ€5åˆ†é’Ÿå·¦å³ï¼‰</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010162.png" alt></p><p>å¯¹æ¯”å¯¼å‡ºSQLæ–‡ä»¶ï¼Œè€—æ—¶ä»å°†è¿‘1å°æ—¶ç¼©çŸ­åˆ°5åˆ†é’Ÿã€‚</p><p>åœ¨mysqlæ‰§è¡Œ <code>load data infile</code> å’Œ <code>into outfile</code> å‘½ä»¤éƒ½éœ€è¦åœ¨mysqlå¼€å¯äº† <code>secure_file_priv</code> é€‰é¡¹ï¼Œ å¯ä»¥é€šè¿‡ <code>show global variables like &#39;%secure%&#39;;</code> æŸ¥çœ‹mysqlæ˜¯å¦å¼€å¯äº†æ­¤é€‰é¡¹ï¼Œé»˜è®¤å€¼Nullæ ‡è¯†ä¸å…è®¸æ‰§è¡Œå¯¼å…¥å¯¼å‡ºå‘½ä»¤ã€‚é€šè¿‡ <code>vim /etc/my.cnf</code> ï¼ˆWindowsä¿®æ”¹ <code>my.ini</code> ï¼‰ä¿®æ”¹mysqlé…ç½®é¡¹ï¼Œå°† <code>secure_file_priv</code> çš„å€¼è®¾ç½®ä¸ºç©ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">  secure_file_priv=&apos;&apos;</span><br></pre></td></tr></table></figure><p>åœ¨å¯¼å…¥æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å­—æ®µåæ¥åŒ¹é…ç›®æ ‡å­—æ®µçš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡<code>@dummy</code>ä¸¢å¼ƒæ‰ä¸éœ€è¦çš„ç›®æ ‡å­—æ®µæ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'/data/fans.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> wxa_fans(<span class="keyword">id</span>,appid,openid,unionid,@dummy,created_at,@dummy,nickname,gender,avatar_url,@dummy,@dummy,@dummy,@dummy,<span class="keyword">language</span>,country,province,city,@dummy,@dummy,@dummy,@dummy,@dummy,@dummy,@dummy,@dummy,@dummy);</span><br></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— <a href="https://juejin.im/post/6844903630227636237" target="_blank" rel="noopener">Mysqlç™¾ä¸‡çº§æ•°æ®è¿ç§»å®æˆ˜ç¬”è®°</a></p><p>ğŸ”— <a href="https://cloud.google.com/solutions/database-migration-concepts-principles-part-1?hl=zh-cn" target="_blank" rel="noopener">æ•°æ®åº“è¿ç§»ï¼šæ¦‚å¿µå’ŒåŸåˆ™ï¼ˆç¬¬ 1 éƒ¨åˆ†ï¼‰</a></p>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†ä¸€ä¸‹æ•°æ®åº“ä¸­æ•°æ®è¿ç§»ç›¸å…³å†…å®¹ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="sql" scheme="http://linyishui.top/tags/sql/"/>
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>SqlLoader</title>
    <link href="http://linyishui.top/2020092401.html"/>
    <id>http://linyishui.top/2020092401.html</id>
    <published>2020-09-24T07:26:04.000Z</published>
    <updated>2020-10-02T08:17:02.191Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SqlLoader"><a href="#SqlLoader" class="headerlink" title="SqlLoader"></a>SqlLoader</h1><h2 id="ç¬¬ä¸€èŠ‚-æ¦‚è¿°"><a href="#ç¬¬ä¸€èŠ‚-æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€èŠ‚ æ¦‚è¿°"></a>ç¬¬ä¸€èŠ‚ æ¦‚è¿°</h2><h3 id="1-1-å¸¸è§çš„å‡ ç§æ•°æ®è¿ç§»æ–¹å¼"><a href="#1-1-å¸¸è§çš„å‡ ç§æ•°æ®è¿ç§»æ–¹å¼" class="headerlink" title="1.1 å¸¸è§çš„å‡ ç§æ•°æ®è¿ç§»æ–¹å¼"></a>1.1 å¸¸è§çš„å‡ ç§æ•°æ®è¿ç§»æ–¹å¼</h3><p>æ—¥å¸¸å¼€å‘ä¸­ä¼šç»å¸¸é‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼Œå¤§æ‰¹é‡çš„æ•°æ®éœ€è¦åœ¨ä¸åŒçš„æ•°æ®åº“é—´è¿ç§»ï¼Œä¸€èˆ¬ä¼šæœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼ˆä¸ä¸€å®šæ¶µç›–æ‰€æœ‰ï¼‰ï¼š</p><ul><li>æºæ•°æ®åº“ç›´æ¥å¯¼å‡ºSQLæ–‡ä»¶ï¼Œç›®æ ‡æ•°æ®åº“æ‰§è¡Œï¼›<ul><li>æ•°æ®é‡å¤§æ—¶æ•ˆç‡å¾ˆä½ï¼Œç”šè‡³å¯èƒ½ä¼šå¡æ­»å®¢æˆ·ç«¯ã€‚</li></ul></li><li>åˆ›å»ºæ•°æ®åº“é—´çš„DBLinkï¼Œç”¨ <code>create table B as select * from A@dblink where ...</code> ï¼Œæˆ– <code>insert into B select * from A@dblink where ...</code> ï¼›</li><li>exp A è¡¨ï¼Œå† imp åˆ° B è¡¨ï¼Œexp æ—¶å¯åŠ æŸ¥è¯¢æ¡ä»¶ï¼›</li><li>ç¨‹åºå®ç° <code>select from A ..</code> ï¼Œç„¶å <code>insert into B ...</code> ï¼Œä¹Ÿè¦åˆ†æ‰¹æäº¤ï¼›</li><li>SqlLoaderå¯¼å…¥æ•°æ®ã€‚</li></ul><h3 id="1-2-ä»€ä¹ˆæ˜¯SqlLoader"><a href="#1-2-ä»€ä¹ˆæ˜¯SqlLoader" class="headerlink" title="1.2 ä»€ä¹ˆæ˜¯SqlLoader"></a>1.2 ä»€ä¹ˆæ˜¯SqlLoader</h3><p>Oracleæä¾›äº† <code>sqlldr</code> å‘½ä»¤ï¼Œå‚æ•°ï¼š</p><ul><li>useridï¼šusername/password[@servicename]ï¼›</li><li>controlï¼šæ§åˆ¶æ–‡ä»¶ï¼Œå¯èƒ½åŒ…å«è¡¨çš„æ•°æ®ï¼›</li><li>logï¼šè®°å½•å¯¼å…¥æ—¶çš„æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä¸º æ§åˆ¶æ–‡ä»¶(å»é™¤æ‰©å±•å).logï¼›</li><li>badï¼šåæ•°æ®æ–‡ä»¶ï¼Œé»˜è®¤ä¸º æ§åˆ¶æ–‡ä»¶(å»é™¤æ‰©å±•å).badï¼›</li><li>dataï¼šæ•°æ®æ–‡ä»¶ï¼Œä¸€èˆ¬åœ¨æ§åˆ¶æ–‡ä»¶ä¸­æŒ‡å®šã€‚ç”¨å‚æ•°æ§åˆ¶æ–‡ä»¶ä¸­ä¸æŒ‡å®šæ•°æ®æ–‡ä»¶æ›´é€‚äºè‡ªåŠ¨æ“ä½œï¼›</li><li>errorsï¼šå…è®¸çš„é”™è¯¯è®°å½•æ•°ï¼Œå¯ä»¥ç”¨ä»–æ¥æ§åˆ¶ä¸€æ¡è®°å½•éƒ½ä¸èƒ½é”™ï¼›</li><li>rowsï¼šå¤šå°‘æ¡è®°å½•æäº¤ä¸€æ¬¡ï¼Œé»˜è®¤ä¸º 64ï¼›</li><li>skipï¼šè·³è¿‡çš„è¡Œæ•°ï¼Œæ¯”å¦‚å¯¼å‡ºçš„æ•°æ®æ–‡ä»¶å‰é¢å‡ è¡Œæ˜¯è¡¨å¤´æˆ–å…¶ä»–æè¿°ã€‚</li></ul><p>sqlldræ˜¯åœ¨å¤„ç†å¤§æ•°æ®é‡çš„æ“ä½œä¸­å»ºè®®é‡‡ç”¨çš„æ–¹å¼ï¼Œå®ƒæœ‰è®¸å¤šæ€§èƒ½ç›¸å…³çš„å¼€å…³ï¼Œèƒ½æœ€å¤§ç¨‹åº¦çš„å‡å°‘ redoï¼Œundo çš„ç”Ÿæˆã€‚</p><p>MySqlä¸­å¯¹åº”çš„è¯­å¥ï¼š<code>load data infile</code> ã€‚</p><h3 id="1-3-SqlLoaderç”¨æ³•"><a href="#1-3-SqlLoaderç”¨æ³•" class="headerlink" title="1.3 SqlLoaderç”¨æ³•"></a>1.3 SqlLoaderç”¨æ³•</h3><p>æ§åˆ¶æ–‡ä»¶ <code>.ctl</code> æ ¼å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. æ§åˆ¶æ–‡ä»¶æ ‡è¯†</span></span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. è¦å¯¼å…¥çš„æ•°æ®æ–‡ä»¶å</span></span><br><span class="line"><span class="keyword">INFILE</span> <span class="string">'xxx.txt'</span>      </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. å°†æ–‡ä»¶æ’å…¥åˆ°æ•°æ®åº“çš„ test è¡¨ä¸­</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">test</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. ç”¨äºåˆ†å‰²ä¸€è¡Œä¸­å„ä¸ªå±æ€§å€¼çš„ç¬¦å·ï¼ˆä¾‹å¦‚æ¯ä¸ªå±æ€§å€¼ç”¨é€—å·åˆ†å‰²ï¼Œ é‚£ä¹ˆå°±æŠŠ X'09' æ”¹ä¸º','ï¼‰</span></span><br><span class="line"><span class="keyword">Fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> X<span class="string">'09'</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. testè¡¨ä¸­å¯¹åº”çš„å±æ€§å</span></span><br><span class="line">(<span class="keyword">id</span>, username, passwprd, ......)</span><br></pre></td></tr></table></figure><p>æ“ä½œç±»å‹æœ‰ï¼š</p><ol><li>insertï¼šä¸ºç¼ºçœæ–¹å¼ï¼Œåœ¨æ•°æ®è£…è½½å¼€å§‹æ—¶è¦æ±‚è¡¨ä¸ºç©ºï¼›</li><li>appendï¼šåœ¨è¡¨ä¸­è¿½åŠ æ–°è®°å½•ï¼›</li><li>replaceï¼šåˆ é™¤æ—§è®°å½•(ç”¨ delete from table è¯­å¥)ï¼Œæ›¿æ¢æˆæ–°è£…è½½çš„è®°å½•ï¼›</li><li>truncateï¼šåˆ é™¤æ—§è®°å½•(ç”¨ truncate table è¯­å¥)ï¼Œæ›¿æ¢æˆæ–°è£…è½½çš„è®°å½•ã€‚</li></ol><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ­¤æ–‡ä»¶æ ¼å¼æ˜¯.logï¼Œç”¨æ–‡æœ¬æ–‡ä»¶çš„æ–¹æ³•å¯ä»¥å¯¼å…¥è¿›å»</span></span><br><span class="line"><span class="keyword">infile</span> <span class="string">'D:/xxx/xxx.log'</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">-- insertä¸ºç¼ºçœæ–¹å¼ï¼Œæ’å…¥æ—¶è¦æ±‚è¡¨ä¸ºç©º</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> database_name</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®æ–‡ä»¶æ¯ä¸ªå­—æ®µä¹Ÿå°±æ˜¯å±æ€§æ˜¯æŒ‰ç…§|æ¥åˆ†å‰²çš„</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'|'</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®ä¸­æŸäº›å±æ€§å¯èƒ½æ˜¯nullå€¼ ï¼Œ å¦‚æœä¸åŠ å…¥è¿™è¡Œå¯¼å…¥åˆ°æ•°æ®åº“çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨è·³è¿‡nullå€¼çš„åˆ—, è¿™æ ·æ•°æ®æ’å…¥åå°±ä¼šå±æ€§å’Œå€¼å¯¹åº”ä¸ä¸Š</span></span><br><span class="line">trailing nullcols </span><br><span class="line"></span><br><span class="line"><span class="comment">-- contentè¿ç”¨çš„ç±»å‹æ˜¯clobï¼Œå½“ä½¿ç”¨sqlldråŠ è½½å¾ˆé•¿çš„å­—ç¬¦ä¸²(è¶…è¿‡4000)åˆ°è¡¨ä¸­çš„clobç±»å‹ä¸­æ—¶ä¼šæŠ¥é”™ï¼šæ•°æ®æ–‡ä»¶çš„å­—æ®µè¶…å‡ºæœ€å¤§é•¿åº¦ï¼›sqlldræ¯æ¬¡è¯»å…¥æ–‡ä»¶ä¸­æ•°æ®æµçš„æ•°æ®ç±»å‹é»˜è®¤ä¸ºCHAR ,é•¿åº¦ä¸º 255 .æ‰€ä»¥åªè¦è¶…è¿‡255å­—ç¬¦çš„æ®µéƒ½ä¼šæŠ¥è¿™ä¸ªé”™ï¼Œæ‰€ä»¥char(10000)ç”¨æ¥æ§åˆ¶ä¸Šé™</span></span><br><span class="line">(<span class="keyword">time</span>, user_id, <span class="keyword">type</span>, longitude, latitude, height, <span class="keyword">content</span> <span class="built_in">char</span>(<span class="number">10000</span>))</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¯ä»¥ç›´æ¥é€šè¿‡ <code>sqlldr</code> è¯­å¥å¯¼å…¥ï¼Œä¸€èˆ¬é¡¹ç›®ä¼šé€šè¿‡ä¸€ä¸ªæ•°æ®æ–‡ä»¶å’Œä¸€ä¸ªæ§åˆ¶æ–‡ä»¶æ¥å®ç°æ­¤åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥å°†æ¨¡æ¿å’Œæ•°æ®åˆ†ç¦»ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ï¼š</p><ul><li>æ•°æ®æ–‡ä»¶ï¼šå¯ä»¥æ˜¯PL/SQLæˆ–Toadå¯¼å‡ºã€SqlPlusçš„Spoolæ ¼å¼åŒ–äº§å‡ºã€UTL_FILEåŒ…ç”Ÿæˆã€‚</li></ul><h3 id="1-4-LOAD-DATA-INFILEç”¨æ³•"><a href="#1-4-LOAD-DATA-INFILEç”¨æ³•" class="headerlink" title="1.4 LOAD DATA INFILEç”¨æ³•"></a>1.4 LOAD DATA INFILEç”¨æ³•</h3><p><code>LOAD DATA INFILE</code> æ˜¯  <code>SELECT ... INTO OUTFILE</code> çš„ç›¸å¯¹è¯­å¥ã€‚æŠŠè¡¨çš„æ•°æ®å¤‡ä»½åˆ°æ–‡ä»¶ä½¿ç”¨ <code>SELECT ... INTO OUTFILE</code> ï¼Œä»å¤‡ä»½æ–‡ä»¶æ¢å¤è¡¨æ•°æ®ï¼Œä½¿ç”¨  <code>LOAD DATA INFILE</code> ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> [<span class="keyword">LOW_PRIORITY</span> | <span class="keyword">CONCURRENT</span>] [<span class="keyword">LOCAL</span>] <span class="keyword">INFILE</span> <span class="string">'file_name.txt'</span></span><br><span class="line">    [<span class="keyword">REPLACE</span> | <span class="keyword">IGNORE</span>]</span><br><span class="line">    <span class="keyword">INTO</span> <span class="keyword">TABLE</span> tbl_name</span><br><span class="line">    [<span class="keyword">FIELDS</span></span><br><span class="line">        [<span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'string'</span>]</span><br><span class="line">        [[<span class="keyword">OPTIONALLY</span>] <span class="keyword">ENCLOSED</span> <span class="keyword">BY</span> <span class="string">'char'</span>]</span><br><span class="line">        [<span class="keyword">ESCAPED</span> <span class="keyword">BY</span> <span class="string">'char'</span> ]</span><br><span class="line">    ]</span><br><span class="line">    [<span class="keyword">LINES</span></span><br><span class="line">        [<span class="keyword">STARTING</span> <span class="keyword">BY</span> <span class="string">'string'</span>]</span><br><span class="line">        [<span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'string'</span>]</span><br><span class="line">    ]</span><br><span class="line">    [<span class="keyword">IGNORE</span> <span class="built_in">number</span> <span class="keyword">LINES</span>]</span><br><span class="line">    [(col_name_or_user_var,...)]</span><br><span class="line">    [<span class="keyword">SET</span> col_name = expr,...)]</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> <span class="keyword">INFILE</span> <span class="string">'data.txt'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> tbl_name </span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span> </span><br><span class="line"><span class="keyword">OPTIONALLY</span> <span class="keyword">ENCLOSED</span> <span class="keyword">BY</span> <span class="string">'"'</span> </span><br><span class="line"><span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\n'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åªè½½å…¥éƒ¨åˆ†åˆ—</span></span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> <span class="keyword">INFILE</span> <span class="string">'persondata.txt'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> persondata (col1,col2)</span><br></pre></td></tr></table></figure><p>å‚æ•°ï¼š</p><ul><li><p>LOW_PRIORITYï¼šé€‚ç”¨äºè¡¨é”å­˜å‚¨å¼•æ“ï¼Œæ¯”å¦‚MyISAM, MEMORY, å’Œ MERGEï¼Œåœ¨å†™å…¥è¿‡ç¨‹ä¸­å¦‚æœæœ‰å®¢æˆ·ç«¯ç¨‹åºè¯»è¡¨ï¼Œå†™å…¥å°†ä¼šå»¶åï¼Œç›´è‡³æ²¡æœ‰ä»»ä½•å®¢æˆ·ç«¯ç¨‹åºè¯»è¡¨å†ç»§ç»­å†™å…¥ã€‚</p></li><li><p>CONCURRENTï¼šä½¿ç”¨è¯¥å‚æ•°ï¼Œå…è®¸åœ¨å†™å…¥è¿‡ç¨‹ä¸­å…¶å®ƒå®¢æˆ·ç«¯ç¨‹åºè¯»å–è¡¨å†…å®¹ã€‚</p></li><li><p>LOCALï¼šå…³é”®å­—å½±å“æ•°æ®æ–‡ä»¶å®šä½å’Œé”™è¯¯å¤„ç†ï¼Œå½±å“åœ¨å“ªé‡Œæ‰¾åˆ°æ•°æ®æ–‡ä»¶ã€‚åªæœ‰å½“ mysql-server å’Œ mysql-client åŒæ—¶åœ¨é…ç½®ä¸­æŒ‡å®šå…è®¸ä½¿ç”¨ï¼ŒLOCALå…³é”®å­—æ‰ä¼šç”Ÿæ•ˆã€‚</p><ul><li><p>LOCAL load operationsï¼šå¦‚æœæŒ‡å®šäº†LOCALï¼Œæ•°æ®æ–‡å°†è¢«å®¢æˆ·ç«¯ç¨‹åºä»å®¢æˆ·ç«¯ä¸»æœºè¯»å–ï¼Œç„¶åå‘é€ç»™æœåŠ¡å™¨ä¸»æœºã€‚å°†åœ¨æœåŠ¡å™¨ä¸»æœºçš„ä¸´æ—¶ç›®å½•åˆ›å»ºä¸€ä¸ªæ•°æ®æ–‡ä»¶çš„å‰¯æœ¬ï¼Œå¦‚æœä¸´æ—¶ç›®å½•å‰©ä½™ç©ºé—´ä¸è¶³ï¼Œå°†å¯¼è‡´è¯­å¥æ‰§è¡Œå¤±è´¥ã€‚</p></li><li><p>Non-LOCAL load operationsï¼šå¦‚æœæ²¡æœ‰æŒ‡å®šLOCALï¼Œæ•°æ®æ–‡ä»¶å¿…é¡»ä½äºæœåŠ¡å™¨å€¼æœºä¸Šï¼Œç›´æ¥ç”± mysql-server è¯»å–ã€‚mysql-serve ä½¿ç”¨å¦‚ä¸‹è§„åˆ™æ¥å®šä½æ–‡ä»¶ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1. </span>æ•°æ®æ–‡ä»¶ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œç›´æ¥ä½¿ç”¨</span><br><span class="line"></span><br><span class="line"><span class="bullet">2. </span>æ•°æ®æ–‡ä»¶ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¹¶ä¸”æœ‰å‰å¯¼çš„éƒ¨åˆ†ï¼Œå°†ç›¸å¯¹äº mysql-server çš„æ•°æ®ç›®å½•æŸ¥æ‰¾ï¼Œä¾‹å¦‚ ./myfile.txt</span><br><span class="line"></span><br><span class="line"><span class="bullet">3. </span>æ•°æ®æ–‡ä»¶ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¹¶ä¸”æ²¡æœ‰å‰å¯¼çš„éƒ¨åˆ†ï¼Œå°†ç›¸å¯¹äºé»˜è®¤æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶ç›®å½•æŸ¥æ‰¾,ä¾‹å¦‚ myfile.txt</span><br></pre></td></tr></table></figure></li></ul></li></ul><pre><code>æ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œ./myfile.txt  å°†è¢«å®šä½åˆ° mysql-server çš„ data directory,è€Œ myfile.txt å°†è¢«å®šä½åˆ° default database çš„  database directoryã€‚å¦‚æœ db1 æ—¶é»˜è®¤æ•°æ®åº“ï¼Œåˆ™ä¸‹é¢çš„è¯­å¥å°†ä» db1 çš„æ•°æ®åº“ç›®å½•è¯»å– data.txt,å³ä½¿æ˜ç¡®æŒ‡å®šæŠŠæ•°æ®è£…è½½åˆ° db2ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">INFILE</span> <span class="string">'data.txt'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> db2.my_table;</span><br></pre></td></tr></table></figure>Non-LOCAL load operations ä»æœåŠ¡å™¨ä¸»æœºä¸Šè¯»å–æ•°æ®æ–‡å°†ã€‚å‡ºäºå®‰å…¨åŸå› ï¼Œè¿™ä¸ªæ“ä½œéœ€è¦æ–‡ä»¶æƒé™ã€‚ å¦‚æœsecure_file_priv ç³»ç»Ÿå˜é‡çš„value ä¸ä¸ºç©ºï¼Œæ•°æ®æ–‡ä»¶å¿…é¡»æ”¾åœ¨è¯¥å˜é‡æŒ‡å®šçš„ç›®å½•ã€‚å¦‚æœè¯¥å˜é‡ä¸ºç©ºï¼Œæ•°æ®æ–‡ä»¶å¿…é¡»å¯è¯»ã€‚ä½¿ç”¨LOCALå°†æ¯”è®©æœåŠ¡å™¨ç›´æ¥å­˜å–æ–‡ä»¶æ…¢äº›ï¼Œå› ä¸ºæ–‡ä»¶çš„å†…å®¹å¿…é¡»ä»å®¢æˆ·ä¸»æœºä¼ é€åˆ°æœåŠ¡å™¨ä¸»æœºã€‚åœ¨å¦ä¸€æ–¹é¢ï¼Œä½ ä¸éœ€è¦fileæƒé™è£…è½½æœ¬åœ°æ–‡ä»¶ã€‚</code></pre><ul><li><p>LOCALå…³é”®å­—å¯¹é”™è¯¯å¤„ç†çš„å½±å“ï¼š</p><ol><li>ä½¿ç”¨ LOAD DATA INFILE,data-interpretation å’Œ duplicate-key é”™è¯¯ä¼šç»ˆæ­¢æ“ä½œï¼›</li><li>ä½¿ç”¨ LOAD DATA LOCAL INFILEï¼Œdata-interpretation å’Œ duplicate-key é”™è¯¯ä¼šå‘å‡ºè­¦å‘Šï¼Œæ“ä½œå°†ç»§ç»­æ‰§è¡Œã€‚å¯¹äºduplicate-keyé”™è¯¯ï¼Œæ•ˆæœå’ŒæŒ‡å®šäº† IGNORE å…³é”®å­—ä¸€æ ·ã€‚</li></ol></li></ul><ul><li><p>REPLACE | IGNOREï¼šæ§åˆ¶å¯¹ç°æœ‰çš„å”¯ä¸€é”®è®°å½•çš„é‡å¤çš„å¤„ç†ã€‚</p><ul><li>æŒ‡å®šREPLACEï¼Œæ–°è¡Œå°†ä»£æ›¿æœ‰ç›¸åŒçš„å”¯ä¸€é”®å€¼çš„ç°æœ‰è¡Œã€‚</li><li>æŒ‡å®šIGNOREï¼Œè·³è¿‡æœ‰å”¯ä¸€é”®çš„ç°æœ‰è¡Œçš„é‡å¤è¡Œçš„è¾“å…¥ã€‚</li><li>ä¸æŒ‡å®šä»»ä½•ä¸€ä¸ªé€‰é¡¹ï¼Œå½“æ‰¾åˆ°é‡å¤é”®é”®æ—¶ï¼Œå‡ºç°ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä¸”æ–‡æœ¬æ–‡ä»¶çš„ä½™ä¸‹éƒ¨åˆ†è¢«å¿½ç•¥æ—¶ã€‚</li></ul></li><li><p>FIELDSï¼š</p><ul><li><p>åŸºæœ¬ç”¨æ³•ï¼šå¦‚æœæŒ‡å®šä¸€ä¸ªFIELDSå­å¥ï¼Œå®ƒçš„æ¯ä¸€ä¸ªå­å¥(TERMINATED BY, [OPTIONALLY] ENCLOSED BYå’ŒESCAPED BY)ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯å¿…é¡»è‡³å°‘æŒ‡å®šä¸€ä¸ªã€‚</p><p>å¦‚æœä½ æŒ‡å®š FIELDS æˆ– LINES ï¼Œç¼ºçœå€¼ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FIELDS TERMINATED BY '\t' ENCLOSED BY '' ESCAPED BY '\\'</span><br><span class="line">LINES TERMINATED BY '\n' STARTING BY ''</span><br></pre></td></tr></table></figure></li></ul></li></ul><pre><code>ç¼ºçœå€¼å¯¼è‡´è¯»å–è¾“å…¥æ—¶ï¼ŒLOAD DATA INFILEè¡¨ç°å¦‚ä¸‹ï¼š1. åœ¨ \n å¤„å¯»æ‰¾è¡Œè¾¹ç•Œ2. åœ¨ \t å¤„å°†è¡Œåˆ†è¿›å­—æ®µ3. ä¸è¦æœŸæœ›å­—æ®µç”±ä»»ä½•å¼•å·å­—ç¬¦å°è£…4. å°†ç”±â€œ\â€å¼€å¤´çš„å®šä½ç¬¦ã€æ¢è¡Œç¬¦æˆ–â€œ\â€è§£é‡Šæˆè½¬ä¹‰åºåˆ—ã€‚ä¾‹å¦‚ \t, \n, and \ åˆ†åˆ«è§£é‡Šæˆ å®šä½ç¬¦ï¼Œæ¢è¡Œï¼Œåæ–œæ ã€‚ç›¸åï¼Œç¼ºçœå€¼å¯¼è‡´åœ¨å†™å…¥è¾“å‡ºæ—¶ï¼ŒSELECT ... INTO OUTFILEè¡¨ç°å¦‚ä¸‹ï¼š1. åœ¨å­—æ®µä¹‹é—´å†™ \t2. ä¸ç”¨ä»»ä½•å¼•å·å­—ç¬¦å°è£…å­—æ®µ3. ä½¿ç”¨â€œ\â€è½¬ä¹‰å‡ºç°åœ¨å­—æ®µä¸­çš„ å®šä½ç¬¦ã€æ¢è¡Œç¬¦æˆ–â€œ\â€å­—ç¬¦4. åœ¨è¡Œå°¾å¤„å†™æ¢è¡Œç¬¦</code></pre><ul><li><p>FIELDS [OPTIONALLY] ENCLOSED BYï¼šæ§åˆ¶å“ªäº›å­—æ®µåº”è¯¥åŒ…è£¹åœ¨å¼•å·é‡Œé¢ã€‚</p><p>å¯¹äºSELECT â€¦ INTO OUTFILE è¾“å‡ºï¼Œå¦‚æœä¸åŒ…å«OPTIONALLYé€‰é¡¹ï¼Œæ‰€æœ‰çš„å­—æ®µå°†ä¼šè¢«ENCLOSED BYæŒ‡å®šçš„å­—ç¬¦åŒ…è£¹ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"1"</span>,<span class="string">"a string"</span>,<span class="string">"100.20"</span>  </span><br><span class="line"><span class="string">"2"</span>,<span class="string">"a string containing a , comma"</span>,<span class="string">"102.20"</span>  </span><br><span class="line"><span class="string">"3"</span>,<span class="string">"a string containing a \" quote"</span>,<span class="string">"102.20"</span>  </span><br><span class="line"><span class="string">"4"</span>,<span class="string">"a string containing a \", quote and comma"</span>,<span class="string">"102.20"</span></span><br></pre></td></tr></table></figure></li></ul><pre><code>å¦‚æœæˆ‘ä»¬æŒ‡å®šOPTIONALLYï¼Œåªæœ‰stringæ•°æ®ç±»å‹ï¼ˆå¦‚ CHAR, BINARY, TEXT, æˆ– ENUMï¼‰çš„å­—æ®µæ‰ä¼šè¢«ENCLOSED BYæŒ‡å®šçš„å­—ç¬¦åŒ…è£¹ï¼Œä¾‹å¦‚ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1,<span class="string">"a string"</span>,100.20  </span><br><span class="line">2,<span class="string">"a string containing a , comma"</span>,102.20  </span><br><span class="line">3,<span class="string">"a string containing a \" quote"</span>,102.20  </span><br><span class="line">4,<span class="string">"a string containing a \", quote and comma"</span>,102.20</span><br></pre></td></tr></table></figure>æ³¨æ„ï¼Œå¦‚æœåœ¨å­—æ®µå€¼å†…å‡ºç°ENCLOSED BYå­—ç¬¦ï¼Œåˆ™é€šè¿‡ä½¿ç”¨ESCAPED BYå­—ç¬¦ä½œä¸ºå‰ç¼€ï¼Œå¯¹ENCLOSED BYå­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚å¦å¤–ï¼Œè¦æ³¨æ„ï¼Œå¦‚æœæŒ‡å®šäº†ä¸€ä¸ªç©ºESCAPED BYå€¼ï¼Œåˆ™å¯èƒ½ä¼šç”Ÿæˆä¸èƒ½è¢«LOAD DATAINFILE æ­£ç¡®è¯»å–çš„è¾“å‡ºå€¼ã€‚ä¾‹å¦‚ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1,<span class="string">"a string"</span>,100.20  </span><br><span class="line">2,<span class="string">"a string containing a , comma"</span>,102.20  </span><br><span class="line">3,<span class="string">"a string containing a "</span> quote<span class="string">",102.20  </span></span><br><span class="line"><span class="string">4,"</span>a string containing a <span class="string">", quote and comma"</span>,102.20</span><br></pre></td></tr></table></figure></code></pre><ul><li><p>FIELDS ESCAPED BYï¼šç”¨æ¥æ§åˆ¶å¦‚ä½•å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¯»å†™ã€‚</p><p>å¦‚ä¸Šé¢ä¸€ä¸ªä¾‹å­ï¼Œå¯¼å‡ºå’Œå¯¼å…¥æ—¶æŒ‡å®šFIELDS ESCAPED BYä¸ºåŒå¼•å·[â€œ]æ‰èƒ½è¢«æ­£ç¡®çš„å¯¼å…¥ï¼Œå¯¼å‡ºçš„æ ¼å¼å¦‚ä¸‹ï¼Œå¯¹å­—æ®µå†…çš„åŒå¼•å·[â€œ]è¿›è¡Œäº†è½¬ä¹‰ã€‚</p></li></ul><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1,<span class="string">"a string"</span>,100.20  </span><br><span class="line">2,<span class="string">"a string containing a , comma"</span>,102.20  </span><br><span class="line">3,<span class="string">"a string containing a #"</span> quote<span class="string">",102.20  </span></span><br><span class="line"><span class="string">4,"</span>a string containing a <span class="comment">#", quote and comma",102.20</span></span><br></pre></td></tr></table></figure>å¯¹äºè¾“å…¥ï¼š å‡å¦‚FIELDS ESCAPED BYæŒ‡å®šå­—ç¬¦éç©ºï¼Œåˆ™è¾“å…¥æ—¶è¯¥å­—ç¬¦è¢«ç§»é™¤ï¼Œåç»­çš„å†…å®¹è¢«æ·»åŠ åˆ°å­—æ®µé‡Œã€‚ä¸€äº›ä¸¤ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²åºåˆ—ä¸”ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯è½¬ä¹‰å­—ç¬¦çš„ä¾‹å¤– ã€‚è¿™äº›å­—ç¬¦åºåˆ—è§ä¸‹è¡¨ï¼š| Character | Escape Sequence                || :-------: | ------------------------------ ||    \0     | An ASCII NUL (X&apos;00&apos;) character ||    \b     | A backspace character          ||    \n     | A newline (linefeed) character ||    \r     | A carriage return character    ||    \t     | A tab character.               ||    \Z     | ASCII 26 (Control+Z)           ||    \N     | NULL                           |å‡å¦‚FIELDS ESCAPED BYæŒ‡å®šå­—ç¬¦ä¸ºç©ºï¼Œå°†ä¸ä¼šå‘ç”Ÿè½¬ä¹‰åºåˆ—çš„è§£é‡Šã€‚å¯¹äºè¾“å‡ºï¼Œå¦‚æœFIELDS ESCAPED BYæŒ‡å®šå­—ç¬¦éç©ºï¼Œå­—ç¬¦ä½œä¸ºä»¥ä¸‹è¾“å‡ºçš„å‰ç¼€ï¼š1. FIELDS ESCAPED BY å­—ç¬¦ï¼Œä¾‹å¦‚ \2. FIELDS [OPTIONALLY] ENCLOSED BY å­—ç¬¦ï¼Œä¾‹å¦‚ &quot;3. FIELDS TERMINATED BY and LINES TERMINATED BY çš„ value çš„ç¬¬ä¸€ä¸ªå­—ç¬¦,ä¾‹å¦‚\n4. ASCII 0å¦‚æœLINES TERMINATED BYæ˜¯ç©ºå­—ç¬¦ä¸²ï¼ŒFIELDS TERMINATED BYéç©º,å­—ç¬¦å°†ä¸ä¼šè¢«è½¬ä¹‰ï¼ŒNULL å°†è¾“å‡ºä¸º NULLè€Œä¸æ˜¯ \Nã€‚æŒ‡å®šLINES TERMINATED BYä¸ºç©ºå­—ç¬¦ä¸²å¹¶ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œç‰¹åˆ«å½“å†…å®¹ä¸­åŒ…å«ä¸Šè¡¨åˆ—å‡ºçš„ç‰¹æ®Šå­—ç¬¦æ—¶ã€‚</code></pre><ul><li><p>LINES STARTING BYï¼šå¦‚æœæ‰€æœ‰å¸Œæœ›è¯»å…¥çš„è¡Œéƒ½å«æœ‰ä¸€ä¸ªæˆ‘ä»¬å¸Œæœ›å¿½ç•¥çš„å…±ç”¨å‰ç¼€ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ LINES STARTING BY â€˜prefix_stringâ€™  æ¥è·³è¿‡å‰ç¼€ï¼ˆä»¥åŠè¯¥å‰ç¼€å‰çš„æ‰€æœ‰å­—ç¬¦ï¼‰ã€‚å¦‚æœæŸè¡Œä¸åŒ…æ‹¬å‰ç¼€ï¼Œåˆ™æ•´ä¸ªè¡Œè¢«è·³è¿‡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">INFILE</span> <span class="string">'/tmp/test.txt'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">test</span> </span><br><span class="line">   <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>  <span class="keyword">LINES</span> <span class="keyword">STARTING</span> <span class="keyword">BY</span> <span class="string">'xxx'</span>;</span><br></pre></td></tr></table></figure></li></ul><pre><code>å‡å¦‚/tmp/test.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx"abc",1  </span><br><span class="line">something xxx"def",2  </span><br><span class="line">"ghi",3</span><br></pre></td></tr></table></figure>åˆ™æˆ‘ä»¬è¯»å…¥çš„å†…å®¹åŒ…æ‹¬(&quot;abc&quot;,1) å’Œ (&quot;def&quot;,2)ï¼Œç¬¬ä¸‰è¡Œç›´æ¥è¢«è·³è¿‡ã€‚</code></pre><ul><li><p>IGNORE number LINESï¼šè¯¥é€‰é¡¹å¯ä»¥è¢«ç”¨äºåœ¨æ–‡ä»¶çš„å¼€å§‹å¤„å¿½ç•¥è¡Œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨IGNORE 1 LINESæ¥è·³è¿‡ä¸€ä¸ªåŒ…å«åˆ—åç§°çš„èµ·å§‹æ ‡é¢˜è¡Œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">INFILE</span> <span class="string">'/tmp/test.txt'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">test</span> <span class="keyword">IGNORE</span> <span class="number">1</span> <span class="keyword">LINES</span>;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œfield-å’Œline-handlingé€‰é¡¹ç›¸äº’å½±å“ï¼š</p><ol><li>å¦‚æœLINES TERMINATED BYæ˜¯ç©ºå­—ç¬¦ä¸²ï¼ŒFIELDS TERMINATED BYéç©º,è¡Œä»¥FIELDS TERMINATED BYæŒ‡å®šçš„å­—ç¬¦ä¸²ä½œä¸ºç»“å°¾ã€‚</li><li>å¦‚æœFIELDS TERMINATED BY ä¸ FIELDS ENCLOSED BYå€¼å‡ä¸ºç©º(â€˜â€™)ï¼Œå°†ä½¿ç”¨å›ºå®šè¡Œï¼ˆæ— åˆ†å‰²ï¼‰æ ¼å¼ã€‚ä½¿ç”¨å›ºå®šè¡Œæ ¼å¼ï¼Œå­—æ®µä¹‹é—´å°†æ²¡æœ‰åˆ†éš”ç¬¦ï¼ˆè¡Œç»ˆæ­¢ç¬¦ä¾ç„¶å¯ä½¿ç”¨ï¼‰ï¼Œåˆ—å­—æ®µæ•°æ®çš„è¯»å–å’Œå†™å…¥å‡æŒ‰ç…§å­—æ®µå®šä¹‰çš„å®½åº¦å»æ“ä½œï¼Œå¦‚ TINYINT, SMALLINT, MEDIUMINT, INT, å’Œ BIGINT, å­—æ®µå®½åº¦åˆ†åˆ«ä¸º4, 6, 8, 11, å’Œ 20ã€‚</li></ol></li><li><p>ä¸é€‚åˆä½¿ç”¨ LOAD DATA INFILE çš„æƒ…å†µï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. ä½¿ç”¨å›ºå®šè¡Œæ ¼å¼ï¼ˆå³FIELDS TERMINATED BY å’Œ FIELDS ENCLOSED BY å‡ä¸ºç©ºï¼‰,åˆ—å­—æ®µç±»å‹ä¸ºBLOBæˆ–TEXTã€‚</span><br><span class="line">2. æŒ‡å®šåˆ†éš”ç¬¦ä¸å…¶å®ƒé€‰é¡¹å‰ç¼€ä¸€æ ·ï¼Œ<span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">INFILE</span>ä¸èƒ½å¯¹è¾“å…¥åšæ­£ç¡®çš„è§£é‡Šã€‚ä¾‹å¦‚ï¼š</span><br><span class="line">   <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'"'</span> <span class="keyword">ENCLOSED</span> <span class="keyword">BY</span> <span class="string">'"'</span>  </span><br><span class="line"><span class="number">3.</span> å¦‚æœ <span class="keyword">FIELDS</span> <span class="keyword">ESCAPED</span> <span class="keyword">BY</span> ä¸ºç©ºï¼Œå­—æ®µå€¼åŒ…å« <span class="keyword">FIELDS</span> <span class="keyword">ENCLOSED</span> <span class="keyword">BY</span> æŒ‡å®šå­—ç¬¦ï¼Œæˆ–è€… <span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> çš„å­—ç¬¦åœ¨ <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> ä¹‹å‰ï¼Œéƒ½ä¼šå¯¼è‡´è¿‡æ—©çš„åœæ­¢ <span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">INFILE</span>æ“ä½œã€‚å› ä¸º<span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">INFILE</span>ä¸èƒ½å‡†ç¡®çš„ç¡®å®šè¡Œæˆ–åˆ—çš„ç»“æŸã€‚</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>IGNORE number LINES é€‰é¡¹ï¼šIGNORE number LINESé€‰é¡¹å¯ä»¥è¢«ç”¨äºåœ¨æ–‡ä»¶çš„å¼€å§‹å¤„å¿½ç•¥è¡Œã€‚<br>æ‚¨å¯ä»¥ä½¿ç”¨IGNORE 1 LINESæ¥è·³è¿‡ä¸€ä¸ªåŒ…å«åˆ—åç§°çš„èµ·å§‹æ ‡é¢˜è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">INFILE</span> <span class="string">'/tmp/test.txt'</span>  <span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">test</span> <span class="keyword">IGNORE</span> <span class="number">1</span> <span class="keyword">LINES</span>;</span><br></pre></td></tr></table></figure></li><li><p>é€‰æ‹©å¯¼å…¥çš„åˆ—ï¼š</p><p>ä¸‹é¢çš„è¯­å¥ä¼šå¯¼å…¥æ–‡ä»¶çš„æ‰€æœ‰åˆ—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">'persondata.txt'</span> INTO TABLE persondata;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³å¯¼å…¥è¡¨çš„æŸäº›åˆ—ï¼Œéœ€è¦æŒ‡å®šåˆ—çš„åˆ—è¡¨</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">'persondata.txt'</span> <span class="function">INTO TABLE <span class="title">persondata</span> (<span class="params">col1,col2,...</span>)</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¾“å…¥æ–‡ä»¶ä¸è¡¨çš„åˆ—é¡ºåºä¸åŒï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šä¸€ä¸ªåˆ—æ¸…å•ï¼Œå¦åˆ™mysqlä¸èƒ½æŠŠè¾“å…¥æ–‡ä»¶çš„å­—æ®µä¸è¡¨çš„åˆ—åŒ¹é…èµ·æ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; LOAD DATA INFILE <span class="string">'/tmp/loadtest.txt'</span> INTO TABLE loadtest </span><br><span class="line">   FIELDS TERMINATED BY <span class="string">','</span> </span><br><span class="line">   OPTIONALLY ENCLOSED BY <span class="string">'"'</span> </span><br><span class="line">   ESCAPED BY <span class="string">'#'</span> </span><br><span class="line">   LINES TERMINATED BY <span class="string">'\n'</span> </span><br><span class="line">   (c1, c2, c4, c3);</span><br></pre></td></tr></table></figure><p>åˆ—çš„æ¸…å•å¯ä»¥åŒ…å«åˆ—åæˆ–è€…ç”¨æˆ·å˜é‡ï¼Œåœ¨å†™å…¥åˆ—å‰æˆ‘ä»¬éœ€è¦ä½¿ç”¨SETè¯­å¥å¯¹ç”¨æˆ·å˜é‡è¿›è¡Œè½¬æ¢ã€‚å¯¹setè¯­å¥åŠç”¨æˆ·å˜é‡æœ‰å¦‚ä¸‹ä½¿ç”¨æ–¹æ³•ï¼š</p><p>æ–¹æ³•1ï¼šåœ¨ç”¨æˆ·å˜é‡ç”¨äºç¬¬ä¸€åˆ—ä¹‹å‰ï¼Œå…ˆæŠŠç¬¬ä¸€åˆ—çš„å€¼èµ‹äºˆç”¨æˆ·å˜é‡ï¼Œè¿›è¡Œé™¤æ³•æ“ä½œåè¾“å…¥åˆ°c1ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">'file.txt'</span></span><br><span class="line">  INTO TABLE t1</span><br><span class="line">  (column1, <span class="meta">@var</span>1)</span><br><span class="line">  SET column2 = <span class="meta">@var</span>1/<span class="number">100</span>;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•2The SET clause can be used to supply values not derived from the input file. ã€‚ä½¿ç”¨ä¸‹é¢ä¾‹å­æŠŠc3åˆ—è®¾ä¸ºå½“å‰æ—¶é—´</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">'file.txt'</span></span><br><span class="line">  INTO TABLE t1</span><br><span class="line">  (column1, column2)</span><br><span class="line">  SET column3 = CURRENT_TIMESTAMP;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•3ï¼šæŠŠè¾“å…¥èµ‹äºˆç”¨æˆ·å˜é‡ï¼Œè€Œä¸æŠŠç”¨æˆ·å˜é‡èµ‹äºˆè¡¨ä¸­çš„åˆ—ï¼Œæ¥ä¸¢å¼ƒæ­¤è¾“å…¥å€¼ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">'file.txt'</span></span><br><span class="line">  INTO TABLE t1</span><br><span class="line">  (column1, <span class="meta">@dummy</span>, column2, <span class="meta">@dummy</span>, column3);</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡ç®¡é“å¯¼å…¥æ•°æ®ï¼š</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœ¨unixç³»ç»Ÿä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä»ç®¡é“ï¼ˆpipeï¼‰ä¸­load dataï¼Œéœ€è¦ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</span><br><span class="line">[root<span class="symbol">@localhost</span> tmp]<span class="meta"># mkfifo /tmp/ls.dat  </span></span><br><span class="line">[root<span class="symbol">@localhost</span> tmp]<span class="meta"># chmod 666 /tmp/ls.dat  </span></span><br><span class="line">[root<span class="symbol">@localhost</span> tmp]<span class="meta"># find / -ls &gt; /tmp/ls.dat &amp;  </span></span><br><span class="line">[root<span class="symbol">@localhost</span> tmp]<span class="meta"># mysql -e <span class="string">"LOAD DATA INFILE '/tmp/ls.dat' INTO TABLE test.tb1 FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '\"</span><span class="string">' ESCAPED BY '</span>#<span class="string">' LINES TERMINATED BY '</span>\n<span class="string">'"</span></span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šsql-modeä½¿ç”¨ä¸¥æ ¼äº‹ç‰©æ¨¡å¼STRICT_TRANS_TABLESä¼šæŠ¥é”™</p><p>åœ¨å¦ä¸€çª—å£å°†æ•°æ®å†™å…¥ç®¡é“</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@localhost</span> <span class="regexp">/]# cat /</span>tmp<span class="regexp">/loadtest.txt &gt; /</span>tmp/ls.dat</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå¯ä»¥å…ˆè¯»æˆ–è€…å…ˆå†™ç®¡é“ï¼Œè°å…ˆè°åéƒ½å¯ä»¥ï¼Œåœ¨å†™å…¥ç®¡é“çš„æ•°æ®è¢«å…¨éƒ¨è¯»å‡ºå‰ï¼Œå¤„äºé˜»å¡çŠ¶æ€ã€‚</p></li></ul><h2 id="ç¬¬äºŒèŠ‚-å®æˆ˜"><a href="#ç¬¬äºŒèŠ‚-å®æˆ˜" class="headerlink" title="ç¬¬äºŒèŠ‚ å®æˆ˜"></a>ç¬¬äºŒèŠ‚ å®æˆ˜</h2><h3 id="2-1-å¯¼å‡ºSQL"><a href="#2-1-å¯¼å‡ºSQL" class="headerlink" title="2.1 å¯¼å‡ºSQL"></a>2.1 å¯¼å‡ºSQL</h3><p>å¯¼å‡ºä¸€åƒä¸‡æ¡æ•°æ®ï¼Œè€—æ—¶-5åˆ†é’Ÿï¼Œsqlæ–‡ä»¶å¤§å°-1.17 GB</p><p>ç›´æ¥æ‰§è¡ŒSQLæ–‡ä»¶ï¼Œè€—æ—¶54åˆ†41ç§’</p><h3 id="2-2-load-data-infile"><a href="#2-2-load-data-infile" class="headerlink" title="2.2 load data infile"></a>2.2 load data infile</h3><p>1.åœ¨æºæ•°æ®åº“å¯¼å‡ºæ•°æ®æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> logs1 <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'logs1.txt'</span>;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè€—æ—¶ï¼šï¼ˆåªéœ€åŠåˆ†é’Ÿï¼‰</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010160.png" alt></p><p>æ–‡ä»¶å¤§å°ï¼š676MB</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010161.png" alt></p><p>ç”Ÿæˆæ–‡ä»¶æ ¼å¼ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">1811</span><span class="selector-tag">1</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span>é¦–é¡µ</span><br><span class="line"><span class="selector-tag">1812</span><span class="selector-tag">2</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:01</span>é¦–é¡µ</span><br><span class="line"><span class="selector-tag">1813</span><span class="selector-tag">1</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:02</span>é¦–é¡µ</span><br><span class="line"><span class="selector-tag">1814</span><span class="selector-tag">1</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:03</span>é¦–é¡µ</span><br><span class="line"><span class="selector-tag">1815</span><span class="selector-tag">1</span>/<span class="selector-tag">index</span><span class="selector-tag">0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span>\<span class="selector-tag">N</span>\<span class="selector-tag">N</span><span class="selector-tag">null</span><span class="selector-tag">2020-01-01</span> <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:04</span>é¦–é¡µ</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>3.ç›®æ ‡æ•°æ®åº“æ‰§è¡Œå‘½ä»¤ï¼šï¼ˆéœ€è¦å…ˆå¯¼å…¥è¡¨ç»“æ„ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'logs1.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> logs1(<span class="keyword">id</span>, logtype, logurl, logip, logdz, ladduser, lfadduser, laddtime, htmlname);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè€—æ—¶ï¼šï¼ˆåªéœ€5åˆ†é’Ÿå·¦å³ï¼‰</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010162.png" alt></p><p>å¯¹æ¯”å¯¼å‡ºSQLæ–‡ä»¶ï¼Œè€—æ—¶ä»å°†è¿‘1å°æ—¶ç¼©çŸ­åˆ°5åˆ†é’Ÿã€‚</p><h3 id="2-3-SqlLoader"><a href="#2-3-SqlLoader" class="headerlink" title="2.3 SqlLoader"></a>2.3 SqlLoader</h3><p>1.å¯¼å‡ºæ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯ä»»æ„æ”¯æŒæ ¼å¼ï¼Œå¦‚ <code>.txt</code>ï¼Œ<code>.csv</code> ç­‰ã€‚</p><p>2.åˆ›å»ºæ§åˆ¶æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS (skip=1,rows=128) <span class="comment">-- sqlldr å‘½ä»¤æ˜¾ç¤ºçš„ é€‰é¡¹å¯ä»¥å†™åˆ°è¿™é‡Œè¾¹æ¥,skip=1 ç”¨æ¥è·³è¿‡æ•°æ®ä¸­çš„ç¬¬ä¸€è¡Œ  </span></span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span>  </span><br><span class="line"><span class="keyword">INFILE</span> <span class="string">"users_data.csv"</span> <span class="comment">--æŒ‡å®šå¤–éƒ¨æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å†™å¤š ä¸ª INFILE "another_data_file.csv" æŒ‡å®šå¤šä¸ªæ•°æ®æ–‡ä»¶  </span></span><br><span class="line"><span class="comment">--è¿™é‡Œè¿˜å¯ä»¥ä½¿ ç”¨ BADFILEã€DISCARDFILE æ¥æŒ‡å®šåæ•°æ®å’Œä¸¢å¼ƒæ•°æ®çš„æ–‡ä»¶ï¼Œ  </span></span><br><span class="line"><span class="keyword">truncate</span> <span class="comment">--æ“ä½œç±»å‹ï¼Œç”¨ truncate table æ¥æ¸…é™¤è¡¨ä¸­åŸæœ‰ è®°å½•  </span></span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">users</span> <span class="comment">-- è¦æ’å…¥è®°å½•çš„è¡¨  </span></span><br><span class="line"><span class="keyword">Fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">","</span> <span class="comment">-- æ•°æ®ä¸­æ¯è¡Œè®°å½•ç”¨ "," åˆ†éš”  </span></span><br><span class="line"><span class="keyword">Optionally</span> <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">'"'</span> <span class="comment">-- æ•°æ®ä¸­æ¯ä¸ªå­—æ®µç”¨ '"' æ¡†èµ·ï¼Œæ¯”å¦‚å­—æ®µä¸­æœ‰ "," åˆ†éš”ç¬¦æ—¶  </span></span><br><span class="line">trailing nullcols <span class="comment">--è¡¨çš„å­—æ®µæ²¡æœ‰å¯¹åº”çš„å€¼æ—¶å… è®¸ä¸ºç©º  </span></span><br><span class="line">(  </span><br><span class="line">  virtual_column FILLER, <span class="comment">--è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿå­—æ®µï¼Œç”¨æ¥è·³ è¿‡ç”± PL/SQL Developer ç”Ÿæˆçš„ç¬¬ä¸€åˆ—åºå·  </span></span><br><span class="line">  user_id <span class="built_in">number</span>, <span class="comment">--å­—æ®µå¯ä»¥æŒ‡å®šç±»å‹ï¼Œå¦åˆ™è®¤ ä¸ºæ˜¯ CHARACTER ç±»å‹, log æ–‡ä»¶ä¸­æœ‰æ˜¾ç¤º  </span></span><br><span class="line">  user_name,  </span><br><span class="line">  login_times,  </span><br><span class="line">  last_login <span class="built_in">DATE</span> <span class="string">"YYYY-MM-DD HH24:MI:SS"</span> <span class="comment">-- æŒ‡å®šæ¥å—æ—¥æœŸçš„æ ¼å¼ï¼Œç›¸å½“ç”¨ to_date() å‡½æ•°è½¬æ¢  </span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œ sqlldr åå¯ä»¥ç•™æ„ä¸€ä¸‹ç”Ÿæˆçš„å‡ ä¸ªæ–‡ä»¶ï¼Œå¦‚ users.log æ—¥å¿—æ–‡ä»¶ã€users.bad åæ•°æ®æ–‡ä»¶ç­‰ã€‚ç‰¹åˆ«æ˜¯è¦çœ‹çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œä»ä¸­å¯è®©ä½ æ›´å¥½çš„ç†è§£ Sql Loaderï¼Œé‡Œé¢æœ‰å¯¹æ§åˆ¶æ–‡ä»¶çš„è§£æã€åˆ—å‡ºæ¯ä¸ªå­—æ®µçš„ç±»å‹ã€åŠ è½½è®°å½•çš„ç»Ÿè®¡ã€å‡ºé”™åŸå› ç­‰ä¿¡æ¯ã€‚</p><h2 id="ç¬¬ä¸‰èŠ‚-SqlLoaderç»†èŠ‚"><a href="#ç¬¬ä¸‰èŠ‚-SqlLoaderç»†èŠ‚" class="headerlink" title="ç¬¬ä¸‰èŠ‚ SqlLoaderç»†èŠ‚"></a>ç¬¬ä¸‰èŠ‚ SqlLoaderç»†èŠ‚</h2><p>SqlLoader çš„æ€§èƒ½ä¸å¹¶å‘æ“ä½œï¼š</p><ol><li><p>ROWS çš„é»˜è®¤å€¼ä¸º 64ï¼Œå¯ä»¥æ ¹æ®å®é™…æŒ‡å®šæ›´åˆé€‚çš„ ROWS å‚æ•°æ¥æŒ‡å®šæ¯æ¬¡æäº¤è®°å½•æ•°ã€‚</p></li><li><p>å¸¸è§„å¯¼å…¥å¯ä»¥é€šè¿‡ä½¿ç”¨ INSERTè¯­å¥æ¥å¯¼å…¥æ•°æ®ã€‚Direct å¯¼å…¥å¯ä»¥è·³è¿‡æ•°æ®åº“çš„ç›¸å…³é€»è¾‘(DIRECT=TRUE)ï¼Œè€Œç›´æ¥å°†æ•°æ®å¯¼å…¥åˆ°æ•°æ®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æé«˜å¯¼å…¥æ•°æ®çš„æ€§èƒ½ã€‚å½“ç„¶ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸èƒ½ä½¿ç”¨æ­¤å‚æ•°(å¦‚æœä¸»é”®é‡å¤çš„è¯ä¼šä½¿ç´¢å¼•çš„çŠ¶æ€å˜æˆUNUSABLE!)ã€‚</p></li><li><p>é€šè¿‡æŒ‡å®š UNRECOVERABLEé€‰é¡¹ï¼Œå¯ä»¥å…³é—­æ•°æ®åº“çš„æ—¥å¿—(æ˜¯å¦è¦ alter table table1 nologging å‘¢?)ã€‚è¿™ä¸ªé€‰é¡¹åªèƒ½å’Œ direct ä¸€èµ·ä½¿ç”¨ã€‚</p></li><li><p>å¯¹äºè¶…å¤§æ•°æ®æ–‡ä»¶çš„å¯¼å…¥å°±è¦ç”¨å¹¶å‘æ“ä½œäº†ï¼Œå³åŒæ—¶è¿è¡Œå¤šä¸ªå¯¼å…¥ä»»åŠ¡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqlldr userid=/ control=result1.ctl direct=true parallel=true   </span><br><span class="line">sqlldr userid=/ control=result2.ctl direct=true parallel=true   </span><br><span class="line">sqlldr userid=/ control=result2.ctl direct=true parallel=true</span><br></pre></td></tr></table></figure></li><li><p>å½“åŠ è½½å¤§é‡æ•°æ®æ—¶ï¼ˆå¤§çº¦è¶…è¿‡10GBï¼‰ï¼Œæœ€å¥½æŠ‘åˆ¶æ—¥å¿—çš„äº§ç”Ÿï¼š  <code>SQL&gt;ALTER  TABLE  RESULTXT  nologging;</code> è¿™æ ·ä¸äº§ç”ŸREDO LOGï¼Œå¯ä»¥æé«˜æ•ˆç‡ã€‚ç„¶ååœ¨ CONTROL æ–‡ä»¶ä¸­ load data ä¸Šé¢åŠ ä¸€è¡Œï¼šunrecoverableï¼Œ æ­¤é€‰é¡¹å¿…é¡»è¦ä¸DIRECTå…±åŒåº”ç”¨ã€‚</p></li><li><p>åœ¨å¹¶å‘æ“ä½œæ—¶ï¼ŒORACLEå£°ç§°å¯ä»¥è¾¾åˆ°æ¯å°æ—¶å¤„ç†100GBæ•°æ®çš„èƒ½åŠ›ï¼å…¶å®ï¼Œä¼°è®¡èƒ½åˆ° 1ï¼10G å°±ç®—ä¸é”™äº†ï¼Œå¼€å§‹å¯ç”¨ç»“æ„ç›¸åŒçš„æ–‡ä»¶ï¼Œä½†åªæœ‰å°‘é‡æ•°æ®ï¼ŒæˆåŠŸåå¼€å§‹åŠ è½½å¤§é‡æ•°æ®ï¼Œè¿™æ ·å¯ä»¥é¿å…æ—¶é—´çš„æµªè´¹ã€‚ï¼ˆæ³¨æ„ï¼šä¸€èˆ¬åªèƒ½ç”¨ASCIIç å½¢å¼ï¼Œåˆ‡è®°è¦è½¬æ¢ç¼–ç ï¼Œä¸ç„¶å¯¼å…¥æ•°æ®ä¸ºç©ºï¼‰</p></li></ol><p><a href="https://cloud.tencent.com/developer/article/1059843" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1059843</a></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— <a href="https://blog.csdn.net/shadow_zed/article/details/82661118" target="_blank" rel="noopener">oracle sqlldr ç”¨æ³•è¯¦è§£</a></p><p>ğŸ”— <a href="https://dev.mysql.com/doc/refman/8.0/en/load-data.html" target="_blank" rel="noopener">MySqlå®˜æ–¹æ–‡æ¡£-LOAD DATA Statement</a></p><p>ğŸ”— <a href="https://www.jianshu.com/p/bcafd8f3ad8e" target="_blank" rel="noopener">LOAD DATA INFILE å¯¼å…¥æ•°æ®</a></p>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†ä¸€ä¸‹SqlLoaderç›¸å…³å†…å®¹ï¼Œç®€å•ä½¿ç”¨ï¼Œå®æˆ˜æ¡ˆä¾‹ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="sql" scheme="http://linyishui.top/tags/sql/"/>
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
      <category term="oracle" scheme="http://linyishui.top/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQï¼ˆäºŒï¼‰å®¢æˆ·ç«¯å¼€å‘</title>
    <link href="http://linyishui.top/2020092001.html"/>
    <id>http://linyishui.top/2020092001.html</id>
    <published>2020-09-20T04:34:35.000Z</published>
    <updated>2020-10-02T08:15:29.131Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å®¢æˆ·ç«¯å¼€å‘"><a href="#å®¢æˆ·ç«¯å¼€å‘" class="headerlink" title="å®¢æˆ·ç«¯å¼€å‘"></a><strong>å®¢æˆ·ç«¯å¼€å‘</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-è¿æ¥RabbitMQ"><a href="#ç¬¬ä¸€èŠ‚-è¿æ¥RabbitMQ" class="headerlink" title="ç¬¬ä¸€èŠ‚ è¿æ¥RabbitMQ"></a><strong>ç¬¬ä¸€èŠ‚ è¿æ¥RabbitMQ</strong></h2><p>å®¢æˆ·ç«¯ç»™å®šå‚æ•°ï¼ˆIPåœ°å€ã€ç«¯å£å·ã€ç”¨æˆ·åã€å¯†ç ç­‰ï¼‰è¿æ¥RabbitMQï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">factory.setUsername(USERNAME);</span><br><span class="line">factory.setPassword(PASSWORD);</span><br><span class="line">factory.setVirtualHost(virtualHost);</span><br><span class="line">factory.setHost(IP_ADDRESS);</span><br><span class="line">factory.setPort(PORT);</span><br><span class="line">Connection conn = factory.newConnection();</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨URLçš„æ–¹å¼å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">factory.setUri(<span class="string">"amqp://userName:password@ipAddress:portNumber/virtualHost"</span>);</span><br><span class="line">Connection conn = factory.newConnection();</span><br><span class="line"><span class="comment">//Connection æ¥å£è¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ª Channel:</span></span><br><span class="line">Channel channel= conn.createChannel();</span><br><span class="line"><span class="comment">//åœ¨åˆ›å»ºä¹‹åï¼ŒChannelå¯ä»¥ç”¨æ¥å‘é€æˆ–è€…æ¥æ”¶æ¶ˆæ¯äº†</span></span><br></pre></td></tr></table></figure><p>Connection å¯ä»¥ç”¨æ¥åˆ›å»ºå¤šä¸ª Channel å®ä¾‹ï¼Œä½†æ˜¯ Channel å®ä¾‹ä¸èƒ½åœ¨çº¿ç¨‹é—®å…±äº«ï¼Œ åº”ç”¨ç¨‹åºåº”è¯¥ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹å¼€è¾Ÿä¸€ä¸ª Channel ã€‚å¤šçº¿ç¨‹é—®å…±äº« Channel å®ä¾‹æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>Channel æˆ–è€… Connection ä¸­æœ‰ä¸ª <code>isOpen</code> æ–¹æ³•å¯ä»¥ç”¨æ¥æ£€æµ‹å…¶æ˜¯å¦å·±å¤„äºå¼€å¯çŠ¶æ€ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¾èµ–äº <code>shutdownCause</code> ï¼Œä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¯èƒ½ä¼šäº§ç”Ÿç«äº‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOpen</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">synchronized</span>(<span class="keyword">this</span>.monitor) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.shutdownCause == <span class="keyword">null</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é”™è¯¯åœ°ä½¿ç”¨ <code>isOpen</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">brokenMethod</span><span class="params">(Channel channel)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (channel.isOpen())&#123;</span><br><span class="line">        <span class="comment">//The following code depends on the channel being in opeÎ·state.</span></span><br><span class="line">        <span class="comment">//However there is a possibility of the change in the channel state</span></span><br><span class="line">        <span class="comment">//between isOpen() and basicQos(l) call</span></span><br><span class="line">        ...</span><br><span class="line">        channel.basicQos(l);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨è°ƒç”¨ <code>createXXX</code> æˆ–è€… <code>newXXX</code> æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è®¤ä¸º Connection æˆ–è€… Channel å·²ç»æˆåŠŸåœ°å¤„äºå¼€å¯çŠ¶æ€ï¼Œè€Œå¹¶ä¸ä¼šåœ¨ä»£ç ä¸­ä½¿ç”¨ <code>isOpen</code> è¿™ä¸ªæ£€æµ‹æ–¹æ³•ã€‚å¦‚æœåœ¨ä½¿ç”¨ Channel çš„æ—¶å€™å…¶å·±ç»å¤„äºå…³é—­çŠ¶æ€ï¼Œé‚£ä¹ˆç¨‹åºä¼šæŠ›å‡ºä¸€ä¸ª <code>com.rabbitmq.client.ShutdownSignalException</code> ï¼Œæˆ‘ä»¬åªéœ€æ•è·è¿™ä¸ªå¼‚å¸¸å³å¯ã€‚å½“ç„¶åŒæ—¶ä¹Ÿè¦è¯•ç€æ•è· <code>IOException</code> æˆ–è€… <code>SocketException</code> ï¼Œä»¥é˜² Connection æ„å¤–å…³é—­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validMethod</span><span class="params">(Channel channel)</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">channel.basicQos(l);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ShutdownSignalException sse) &#123;</span><br><span class="line">        <span class="comment">//possibly check if channel was closed</span></span><br><span class="line">        <span class="comment">//by the time we started action and reasons for</span></span><br><span class="line">        <span class="comment">//closing it</span></span><br><span class="line">        ...</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException ioe) &#123;</span><br><span class="line">        <span class="comment">//check why connection was closed </span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ç¬¬äºŒèŠ‚-ä½¿ç”¨äº¤æ¢å™¨å’Œé˜Ÿåˆ—"><a href="#ç¬¬äºŒèŠ‚-ä½¿ç”¨äº¤æ¢å™¨å’Œé˜Ÿåˆ—" class="headerlink" title="ç¬¬äºŒèŠ‚ ä½¿ç”¨äº¤æ¢å™¨å’Œé˜Ÿåˆ—"></a><strong>ç¬¬äºŒèŠ‚ ä½¿ç”¨äº¤æ¢å™¨å’Œé˜Ÿåˆ—</strong></h2><p>äº¤æ¢å™¨å’Œé˜Ÿåˆ—æ˜¯ AMQP high-level å±‚é¢çš„æ„å»ºæ¨¡å—ï¼Œåº”ç”¨ç¨‹åºéœ€ç¡®ä¿åœ¨ä½¿ç”¨å®ƒä»¬çš„æ—¶å€™å°±å·²ç»å­˜åœ¨äº†ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆå£°æ˜ï¼ˆdeclareï¼‰å®ƒä»¬ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„ã€éè‡ªåŠ¨åˆ é™¤çš„ã€ç»‘å®šç±»å‹ä¸º direct äº¤æ¢å™¨</span></span><br><span class="line">channel.exchangeDeclare(exchangeName, <span class="string">"direct"</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">//åŒæ—¶ä¹Ÿåˆ›å»ºä¸€ä¸ªéæŒä¹…åŒ–çš„ã€æ’ä»–çš„ã€è‡ªåŠ¨åˆ é™¤çš„é˜Ÿåˆ—ï¼ˆæ­¤é˜Ÿåˆ—çš„åç§°ç”± RabbitMQ è‡ªåŠ¨ç”Ÿæˆï¼‰</span></span><br><span class="line">String queueName = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//ä½¿ç”¨è·¯ç”±é”®å°†é˜Ÿåˆ—å’Œäº¤æ¢å™¨ç»‘å®šèµ·æ¥</span></span><br><span class="line">channel.queueBind(queueName, exchangeName, routingKey);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å£°æ˜çš„é˜Ÿåˆ—å…·å¤‡å¦‚ä¸‹ç‰¹æ€§ï¼šåªå¯¹å½“å‰åº”ç”¨ä¸­åŒä¸€ä¸ª Connection å±‚é¢å¯ç”¨ï¼ŒåŒä¸€ä¸ª Connection çš„ä¸åŒ Channel å¯å…±ç”¨ï¼Œå¹¶ä¸”ä¹Ÿä¼šåœ¨åº”ç”¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ã€‚</p><p>å¦‚æœè¦åœ¨åº”ç”¨ä¸­å…±äº«ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¯ä»¥åšå¦‚ä¸‹å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒä¸Š</span></span><br><span class="line">channel.exchangeDeclare(exchangeName , <span class="string">"direct"</span>, <span class="keyword">true</span>) ;</span><br><span class="line"><span class="comment">//é˜Ÿåˆ—è¢«å£°æ˜ä¸ºæŒä¹…åŒ–çš„ éæ’ä»–çš„ã€éè‡ªåŠ¨åˆ é™¤çš„ï¼Œè€Œä¸”ä¹Ÿè¢«åˆ†é…å¦ä¸€ä¸ªç¡®å®šçš„å·±çŸ¥çš„åç§°ï¼ˆç”±å®¢æˆ·ç«¯åˆ†é…è€Œé RabbitMQ è‡ªåŠ¨ç”Ÿæˆï¼‰</span></span><br><span class="line">channel.queueDeclare(queueName, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">channel.queueBind(queueName , exchangeName , routingKey) ;</span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½å¯ä»¥å£°æ˜ä¸€ä¸ªäº¤æ¢å™¨æˆ–è€…é˜Ÿåˆ—ã€‚</p><h3 id="2-1-exchangeDeclare"><a href="#2-1-exchangeDeclare" class="headerlink" title="2.1 exchangeDeclare()"></a><strong>2.1 exchangeDeclare()</strong></h3><p><code>exchangeDeclare()</code> ç”¨æ¥å£°æ˜äº¤æ¢å™¨ï¼Œæœ‰å¤šç§é‡è½½æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Exchange.<span class="function">DeclareOk <span class="title">exchangeDeclare</span><span class="params">(String exchange, String type, <span class="keyword">boolean</span> durable,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">boolean</span> autoDelete, <span class="keyword">boolean</span> internal,</span></span></span><br><span class="line"><span class="function"><span class="params">Map&lt;String , Object&gt; arguments)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure><ul><li><code>Exchange.DeclareOk</code> ï¼šç”¨æ¥æ ‡è¯†æˆåŠŸå£°æ˜äº†ä¸€ä¸ªäº¤æ¢å™¨ã€‚</li><li>exchangeï¼šäº¤æ¢å™¨çš„<strong>åç§°</strong>ã€‚</li><li>typeï¼šäº¤æ¢å™¨çš„<strong>ç±»å‹</strong>ã€‚<ul><li>å¸¸è§çš„å¦‚fanoutï¼Œdirectï¼Œtopicã€‚</li></ul></li><li>durableï¼šè®¾ç½®<strong>æ˜¯å¦æŒä¹…åŒ–</strong>ã€‚<ul><li>æŒä¹…åŒ–å¯ä»¥å°†äº¤æ¢å™¨å­˜ç›˜ï¼Œåœ¨æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¸ä¼šä¸¢å¤±ç›¸å…³ä¿¡æ¯ã€‚</li></ul></li><li>autoDeleteï¼šè®¾ç½®<strong>æ˜¯å¦è‡ªåŠ¨åˆ é™¤</strong>ã€‚<ul><li>è‡ªåŠ¨åˆ é™¤çš„å‰ææ˜¯è‡³å°‘æœ‰ä¸€ä¸ªé˜Ÿåˆ—æˆ–è€…äº¤æ¢å™¨ä¸è¿™ä¸ªäº¤æ¢å™¨ç»‘å®šï¼Œä¹‹åæ‰€æœ‰ä¸è¿™ä¸ªäº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—æˆ–è€…äº¤æ¢å™¨éƒ½ä¸æ­¤è§£ç»‘ã€‚</li><li>æ³¨æ„ä¸èƒ½é”™è¯¯åœ°æŠŠè¿™ä¸ªå‚æ•°ç†è§£ä¸ºï¼šå½“ä¸æ­¤äº¤æ¢å™¨è¿æ¥çš„å®¢æˆ·ç«¯éƒ½æ–­å¼€æ—¶ï¼Œ RabbitMQ ä¼šè‡ªåŠ¨åˆ é™¤æœ¬äº¤æ¢å™¨ã€‚</li></ul></li><li>internalï¼šè®¾ç½®<strong>æ˜¯å¦æ˜¯å†…ç½®çš„çš„äº¤æ¢å™¨</strong>ã€‚<ul><li>å®¢æˆ·ç«¯ç¨‹åºæ— æ³•ç›´æ¥å‘é€æ¶ˆæ¯åˆ°è¿™ä¸ªäº¤æ¢å™¨ä¸­ï¼Œåªèƒ½é€šè¿‡äº¤æ¢å™¨è·¯ç”±åˆ°äº¤æ¢å™¨è¿™ç§æ–¹å¼ã€‚</li></ul></li><li>argumentï¼šå…¶ä»–ä¸€äº›<strong>ç»“æ„åŒ–å‚æ•°</strong>ï¼Œæ¯”å¦‚ <code>alternate-exchange</code> </li></ul><p>ç±»ä¼¼çš„æ–¹æ³•ï¼š</p><ul><li>exchangeDeclareNoWaitï¼šæ— è¿”å›å€¼ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œåˆšå£°æ˜å®Œäº¤æ¢å™¨ç´§æ¥ç€å°±ä½¿ç”¨ï¼Œå¯èƒ½å¯¼è‡´å› äº¤æ¢å™¨æœªåˆ›å»ºè€Œå‘ç”Ÿå¼‚å¸¸ã€‚</li><li>exchangeDeclarePassiveï¼šç”¨æ¥æ£€æµ‹ç›¸åº”çš„äº¤æ¢å™¨æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨æŠ›å‡ºå¼‚å¸¸ <code>404 channel exception</code> åŒæ—¶å…³é—­ Channel ã€‚</li><li>exchangeDeleteï¼šåˆ é™¤äº¤æ¢å™¨ã€‚</li><li>exchangeDeleteNoWaitï¼šæ— è¿”å›åˆ é™¤ã€‚</li></ul><h3 id="2-2-queueDeclare"><a href="#2-2-queueDeclare" class="headerlink" title="2.2 queueDeclare()"></a><strong>2.2 queueDeclare()</strong></h3><p><code>queueDeclare()</code> åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Queue.<span class="function">DeclareOk <span class="title">queueDeclare</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>; </span><br><span class="line">Queue.<span class="function">DeclareOk <span class="title">queueDeclare</span><span class="params">(String queue, <span class="keyword">boolean</span> durable, <span class="keyword">boolean</span> exclusive, <span class="keyword">boolean</span> autoDelete, Map&lt;String, Object&gt; arguments)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure><ul><li>æ— å‚æ–¹æ³•é»˜è®¤æ„å»ºä¸€ä¸ª RabbitMQå‘½åçš„ã€æ’ä»–çš„ã€è‡ªåŠ¨åˆ é™¤çš„ã€éæŒä¹…åŒ–çš„é˜Ÿåˆ—ã€‚</li><li>queueï¼šé˜Ÿåˆ—<strong>åç§°</strong></li><li>durableï¼šè®¾ç½®<strong>æ˜¯å¦æŒä¹…åŒ–</strong>ã€‚<ul><li>æŒä¹…åŒ–çš„é˜Ÿåˆ—ä¼šå­˜ç›˜ï¼Œåœ¨æœåŠ¡å™¨é‡å¯çš„æ—¶å€™å¯ä»¥ä¿è¯ä¸ä¸¢å¤±ç›¸å…³ä¿¡æ¯ã€‚</li></ul></li><li>exclusiveï¼šè®¾ç½®<strong>æ˜¯å¦æ’ä»–</strong>ã€‚<ul><li>å¦‚æœä¸€ä¸ªé˜Ÿåˆ—è¢«å£°æ˜ä¸ºæ’ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ã€‚</li><li>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‰ç‚¹ï¼š<ul><li>æ’ä»–é˜Ÿåˆ—æ˜¯åŸºäºè¿æ¥ï¼ˆ Connection ï¼‰å¯è§çš„ï¼ŒåŒä¸€ä¸ªè¿æ¥çš„ä¸åŒä¿¡é“ï¼ˆChannel) æ˜¯å¯ä»¥åŒæ—¶è®¿é—®åŒä¸€è¿æ¥åˆ›å»ºçš„æ’ä»–é˜Ÿåˆ—ï¼›</li><li>â€œé¦–æ¬¡â€æ˜¯æŒ‡å¦‚æœä¸€ä¸ªè¿æ¥å·±ç»å£°æ˜äº†ä¸€ä¸ªæ’ä»–é˜Ÿåˆ—ï¼Œå…¶ä»–è¿æ¥æ˜¯ä¸å…è®¸å»ºç«‹åŒåçš„æ’ä»–é˜Ÿåˆ—çš„ï¼Œè¿™ä¸ªä¸æ™®é€šé˜Ÿåˆ—ä¸åŒï¼›</li><li>å³ä½¿è¯¥é˜Ÿåˆ—æ˜¯æŒä¹…åŒ–çš„ï¼Œä¸€æ—¦è¿æ¥å…³é—­æˆ–è€…å®¢æˆ·ç«¯é€€å‡ºï¼Œè¯¥æ’ä»–é˜Ÿåˆ—éƒ½ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œè¿™ç§é˜Ÿåˆ—é€‚ç”¨äºä¸€ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘é€å’Œè¯»å–æ¶ˆæ¯çš„åº”ç”¨åœºæ™¯ã€‚</li></ul></li></ul></li><li>autoDeleteï¼šè®¾ç½®æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚<ul><li>è‡ªåŠ¨åˆ é™¤çš„å‰ææ˜¯ï¼šè‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¹‹åæ‰€æœ‰ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥çš„æ¶ˆè´¹è€…éƒ½æ–­å¼€æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ä¸èƒ½æŠŠè¿™ä¸ªå‚æ•°é”™è¯¯åœ°ç†è§£ä¸ºï¼šâ€œå½“è¿æ¥åˆ°æ­¤é˜Ÿåˆ—çš„æ‰€æœ‰å®¢æˆ·ç«¯æ–­å¼€æ—¶ï¼Œè¿™ä¸ªé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤â€ï¼Œå› ä¸ºç”Ÿäº§è€…å®¢æˆ·ç«¯åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—ï¼Œæˆ–è€…æ²¡æœ‰æ¶ˆè´¹è€…å®¢æˆ·ç«¯ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥æ—¶ï¼Œéƒ½ä¸ä¼šè‡ªåŠ¨åˆ é™¤è¿™ä¸ªé˜Ÿåˆ—ã€‚</li></ul></li><li>argumentsï¼šè®¾ç½®é˜Ÿåˆ—çš„å…¶ä»–ä¸€äº›å‚æ•°ã€‚<ul><li>å¦‚ <code>x-message-ttl</code> <code>x-expires</code> <code>x-max-length</code> <code>x-max-length-bytes</code> <code>x-dead-letter-exchange</code> <code>x-dead-letter-routing-key</code> , <code>x-max-priority</code> ç­‰ã€‚</li></ul></li></ul><p>æ³¨æ„ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½èƒ½å¤Ÿä½¿ç”¨ queueDeclare æ¥å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä½†æ˜¯å¦‚æœæ¶ˆè´¹è€…åœ¨åŒä¸€ä¸ªä¿¡é“ä¸Šè®¢é˜…äº†å¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå°±æ— æ³•å†å£°æ˜é˜Ÿåˆ—äº†ã€‚å¿…é¡»å…ˆå–æ¶ˆè®¢é˜…ï¼Œç„¶åå°†ä¿¡é“ç½®ä¸ºâ€œä¼ è¾“â€æ¨¡å¼ï¼Œä¹‹åæ‰èƒ½å£°æ˜é˜Ÿåˆ—ã€‚</p><p>ç±»ä¼¼çš„æ–¹æ³•è¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h3 id="2-3-queueBind"><a href="#2-3-queueBind" class="headerlink" title="2.3 queueBind()"></a><strong>2.3 queueBind()</strong></h3><p><code>queueBind()</code> å°†é˜Ÿåˆ—ä¸äº¤æ¢å™¨ç»‘å®š/è§£ç»‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Queue.<span class="function">BindOk <span class="title">queueBind</span><span class="params">(String queue, String exchange, String routingKey, Map&lt;String, Object&gt; arguments)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">Queue.<span class="function">UnbindOk <span class="title">queueUnbind</span><span class="params">(String queue, String exchange, String routingKey, Map&lt;String, Object&gt; arguments)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure><ul><li>queueï¼šé˜Ÿåˆ—åç§°ï¼›</li><li>exchangeï¼šäº¤æ¢å™¨çš„åç§°ï¼›</li><li>routingKeyï¼šç”¨æ¥ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢å™¨çš„è·¯ç”±é”®ï¼›</li><li>argumentsï¼šå®šä¹‰ç»‘å®šçš„ä¸€äº›å‚æ•°ã€‚</li></ul><h3 id="2-4-exchangeBind"><a href="#2-4-exchangeBind" class="headerlink" title="2.4 exchangeBind()"></a><strong>2.4 exchangeBind()</strong></h3><p><code>exchangeBind()</code> å°†äº¤æ¢å™¨ä¸äº¤æ¢å™¨ç»‘å®šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exchange.<span class="function">BindOk <span class="title">exchangeBind</span><span class="params">(String destination, String source , String routingKey, Map&lt;String, Object&gt; arguments)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure><p>ç»‘å®šä¹‹åï¼Œæ¶ˆæ¯ä» source äº¤æ¢å™¨è½¬å‘åˆ° destination äº¤æ¢å™¨ï¼Œåè€…å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ†åˆ«å£°æ˜sourceå’Œdestinationäº¤æ¢å™¨</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">"source"</span>, <span class="string">"direct"</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">null</span>) ;</span><br><span class="line">channel.exchangeDeclare(<span class="string">"destination"</span>, <span class="string">"fanout"</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//ç»‘å®šä¸¤è€…</span></span><br><span class="line">channel.exchangeBind(<span class="string">"destination"</span>, <span class="string">"source"</span>, <span class="string">"exKey"</span>);</span><br><span class="line"><span class="comment">//å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">channel.queueDeclare(<span class="string">"queue"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//ç»‘å®šdestinationäº¤æ¢å™¨å’Œé˜Ÿåˆ—</span></span><br><span class="line">channel.queueBind(<span class="string">"queue"</span>, <span class="string">"destination"</span>ï¼Œ<span class="string">""</span>);</span><br><span class="line"><span class="comment">//sourceæ¨é€æ¶ˆæ¯</span></span><br><span class="line">channel.basicPublish(<span class="string">"source"</span>, <span class="string">"exKey"</span>, <span class="keyword">null</span>, <span class="string">"exToExDemo"</span>. getBytes());</span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯è‡³äº¤æ¢å™¨ source ä¸­ï¼Œäº¤æ¢å™¨ source æ ¹æ®è·¯ç”±é”®æ‰¾åˆ°ä¸å…¶åŒ¹é… çš„å¦ä¸€ä¸ªäº¤æ¢å™¨ destination äº•æŠŠæ¶ˆæ¯è½¬å‘åˆ° destination ä¸­ï¼Œè¿›è€Œå­˜å‚¨åœ¨ destination ç»‘å®šçš„é˜Ÿåˆ— queue ä¸­ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010156.png" alt></p><h3 id="2-5-ä½•æ—¶åˆ›å»º"><a href="#2-5-ä½•æ—¶åˆ›å»º" class="headerlink" title="2.5 ä½•æ—¶åˆ›å»º"></a><strong>2.5 ä½•æ—¶åˆ›å»º</strong></h3><p>RabbitMQ çš„<strong>æ¶ˆæ¯å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­</strong>ï¼Œäº¤æ¢å™¨çš„ä½¿ç”¨å¹¶ä¸çœŸæ­£è€—è´¹æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œè€Œé˜Ÿåˆ—ä¼šã€‚ å¦‚æœè¦è¡¡é‡ RabbitMQ å½“å‰çš„ QPS ï¼Œåªéœ€çœ‹é˜Ÿåˆ—çš„å³å¯ã€‚<strong>åœ¨å®é™…ä¸šåŠ¡åº”ç”¨ä¸­ï¼Œéœ€è¦å¯¹æ‰€åˆ›å»ºçš„é˜Ÿåˆ—çš„æµé‡ã€å†…å­˜å ç”¨åŠç½‘å¡å ç”¨æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤çŸ¥ï¼Œé¢„ä¼°å…¶å¹³å‡å€¼å’Œå³°å€¼</strong>ï¼Œä»¥ä¾¿åœ¨å›ºå®šç¡¬ä»¶èµ„æºçš„æƒ…å†µä¸‹èƒ½å¤Ÿè¿›è¡Œåˆç†æœ‰æ•ˆçš„åˆ†é…ã€‚ </p><p>æŒ‰ç…§ RabbitMQ å®˜æ–¹å»ºè®®ï¼Œ<strong>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½åº”è¯¥å°è¯•åˆ›å»ºï¼ˆè¿™é‡ŒæŒ‡å£°æ˜æ“ä½œï¼‰é˜Ÿåˆ—</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å»ºè®®ï¼Œä½†ä¸é€‚ç”¨äºæ‰€æœ‰çš„æƒ…å†µã€‚å¦‚æœä¸šåŠ¡æœ¬èº«åœ¨æ¶æ„è®¾è®¡ä¹‹åˆå·±ç»å……åˆ†åœ°é¢„ä¼°äº†é˜Ÿåˆ—çš„ä½¿ç”¨æƒ…å†µï¼Œå®Œå…¨å¯ä»¥åœ¨ä¸šåŠ¡ç¨‹åºä¸Šçº¿ä¹‹å‰åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå¥½ï¼ˆ<strong>æ¯”å¦‚é€šè¿‡é¡µé¢ç®¡ç†ã€ RabbitMQ å‘½ä»¤æˆ–è€…æ›´å¥½çš„æ˜¯ä»é…ç½®ä¸­å¿ƒä¸‹å‘</strong>ï¼‰ï¼Œè¿™æ ·ä¸šåŠ¡ç¨‹åºä¹Ÿå¯ä»¥å…å»å£°æ˜çš„è¿‡ç¨‹ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚ </p><p>é¢„å…ˆåˆ›å»ºå¥½èµ„æºè¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œ<strong>å¯ä»¥ç¡®ä¿äº¤æ¢å™¨å’Œé˜Ÿåˆ—ä¹‹é—´æ­£ç¡®åœ°ç»‘å®šåŒ¹é…</strong>ã€‚å¾ˆå¤šæ—¶å€™ï¼Œ ç”±äºäººä¸ºå› ç´ ã€ä»£ç ç¼ºé™·ç­‰ï¼Œå‘é€æ¶ˆæ¯çš„äº¤æ¢å™¨å¹¶æ²¡æœ‰ç»‘å®šä»»ä½•é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šä¸¢å¤±ï¼›æˆ–è€…äº¤æ¢å™¨ç»‘å®šäº†æŸä¸ªé˜Ÿåˆ—ï¼Œä½†æ˜¯å‘é€æ¶ˆæ¯æ—¶çš„è·¯ç”±é”®æ— æ³•ä¸ç°å­˜çš„é˜Ÿåˆ—åŒ¹é…ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¹Ÿä¼šä¸¢å¤±ã€‚ å½“ç„¶<strong>å¯ä»¥é…åˆ mandatory å‚æ•°æˆ–è€…å¤‡ä»½äº¤æ¢å™¨æ¥æé«˜ç¨‹åºçš„å¥å£®æ€§</strong>ã€‚ </p><p>ä¸æ­¤åŒæ—¶ï¼Œé¢„ä¼°å¥½é˜Ÿåˆ—çš„ä½¿ç”¨æƒ…å†µéå¸¸é‡è¦ï¼Œå¦‚æœåœ¨åæœŸè¿è¡Œè¿‡ç¨‹ä¸­è¶…è¿‡é¢„å®šçš„é˜ˆå€¼ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µå¯¹å½“å‰é›†ç¾¤è¿›è¡Œæ‰©å®¹æˆ–è€…å°†ç›¸åº”çš„é˜Ÿåˆ—è¿ç§»åˆ°å…¶ä»–é›†ç¾¤ã€‚è¿ç§»çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥å¯¹ä¸šåŠ¡ç¨‹åºå®Œå…¨é€æ˜ã€‚æ­¤ç§æ–¹æ³•ä¹Ÿæ›´æœ‰åˆ©äºå¼€å‘å’Œè¿ç»´åˆ†å·¥ï¼Œä¾¿äºç›¸åº”èµ„æºçš„ç®¡ç†ã€‚ </p><p>å¦‚æœé›†ç¾¤èµ„æºå……è¶³ï¼Œè€Œå³å°†ä½¿ç”¨çš„é˜Ÿåˆ—æ‰€å ç”¨çš„èµ„æºåˆåœ¨å¯æ§çš„èŒƒå›´ä¹‹å†…ï¼Œä¸ºäº†å¢åŠ ä¸šåŠ¡ç¨‹åºçš„çµæ´»æ€§ï¼Œ<strong>ä¹Ÿå®Œå…¨å¯ä»¥åœ¨ä¸šåŠ¡ç¨‹åºä¸­å£°æ˜é˜Ÿåˆ—</strong>ã€‚ è‡³äºæ˜¯ä½¿ç”¨é¢„å…ˆåˆ†é…åˆ›å»ºèµ„æºçš„é™æ€æ–¹å¼è¿˜æ˜¯åŠ¨æ€çš„åˆ›å»ºæ–¹å¼ï¼Œéœ€è¦ä»ä¸šåŠ¡é€»è¾‘æœ¬èº«ã€å…¬å¸è¿ç»´ä½“ç³»å’Œå…¬å¸ç¡¬ä»¶èµ„æºç­‰æ–¹é¢è€ƒè™‘ã€‚</p><hr><h2 id="ç¬¬ä¸‰èŠ‚-å‘é€æ¶ˆæ¯"><a href="#ç¬¬ä¸‰èŠ‚-å‘é€æ¶ˆæ¯" class="headerlink" title="ç¬¬ä¸‰èŠ‚ å‘é€æ¶ˆæ¯"></a><strong>ç¬¬ä¸‰èŠ‚ å‘é€æ¶ˆæ¯</strong></h2><p><code>channel.basicPublish()</code> å¯ä»¥ç”¨æ¥å‘é€æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‘é€ä¸€æ¡æŒä¹…åŒ–çš„æ¶ˆæ¯ hello world!</span></span><br><span class="line">String message = <span class="string">"Hello World!"</span>;</span><br><span class="line">channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());</span><br><span class="line"></span><br><span class="line"><span class="comment">//mandatoryå‚æ•°å¯ä»¥æ›´å¥½çš„æ§åˆ¶å‘é€</span></span><br><span class="line">channel.basicPublish(exchangeName, routingKey, mandatory, MessageProperties.PERSISTENT_TEXT_PLAIN, messageBodyBytes) ; </span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™æ¡æ¶ˆæ¯çš„æŠ•é€’æ¨¡å¼ï¼ˆdelivery modeï¼‰ä¸º2ï¼Œæ¶ˆæ¯ä¼šè¢«æŒä¹…åŒ–åˆ°æœåŠ¡å™¨ä¸­</span></span><br><span class="line"><span class="comment">//æ¶ˆæ¯çš„ä¼˜å…ˆçº§è®¾ç½®ä¸º1ï¼ŒcontentTypeä¸ºtext/plain</span></span><br><span class="line">channel.basicPublish(exchangeName, routingKey, </span><br><span class="line">                           <span class="keyword">new</span> AMQPBasicProperties.Builder()</span><br><span class="line">                           .contentType(<span class="string">"text/plain"</span>)</span><br><span class="line">                           .deliveryMode(<span class="number">2</span>)</span><br><span class="line">                           .priority(<span class="number">1</span>)</span><br><span class="line">                           .userld(<span class="string">"hidden"</span>)</span><br><span class="line">                           .build()), messageBodyBytes); </span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¹Ÿå¯ä»¥è®¾ç½®æ¶ˆæ¯çš„headers</span></span><br><span class="line">Map&lt;String, Object&gt; headers = <span class="keyword">new</span> HashMap&lt;String Object&gt;();</span><br><span class="line">headers.put(<span class="string">"localtion"</span>ï¼Œ<span class="string">"here"</span>);</span><br><span class="line">headers.put(<span class="string">"time"</span>, <span class="string">"today"</span>);</span><br><span class="line">channel.basicPublish(exchangeName, routingKey, </span><br><span class="line">                           <span class="keyword">new</span> AMQP.BasicProperties.Builder()</span><br><span class="line">                           .headers(headers)</span><br><span class="line">                           .build()), messageBodyBytes); </span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿˜å¯ä»¥å¸¦è¿‡æœŸæ—¶é—´</span></span><br><span class="line">channel.basicPublish(exchangeName, routingKey, </span><br><span class="line">                           <span class="keyword">new</span> AMQP.BasicProperties.Builder()</span><br><span class="line">                           .expiration(<span class="string">"60000"</span>) </span><br><span class="line">                           .build()), messageBodyBytes);</span><br></pre></td></tr></table></figure><p>åŒ…æ‹¬å„ç§é‡è½½æ–¹æ³•ï¼Œæœ‰ä»¥ä¸‹å…·ä½“å‚æ•°ï¼š</p><ul><li>exchangeï¼šäº¤æ¢å™¨çš„åç§°ï¼ŒæŒ‡æ˜æ¶ˆæ¯éœ€è¦å‘é€åˆ°å“ªä¸ªäº¤æ¢å™¨ä¸­ï¼Œå¦‚æœè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œ åˆ™æ¶ˆæ¯ä¼šè¢«å‘é€åˆ° RabbitMQ é»˜è®¤çš„äº¤æ¢å™¨ä¸­ã€‚ </li><li>routingKeyï¼šè·¯ç”±é”®ï¼Œäº¤æ¢å™¨æ ¹æ®è·¯ç”±é”®å°†æ¶ˆæ¯å­˜å‚¨åˆ°ç›¸åº”çš„é˜Ÿåˆ—ä¹‹ä¸­ </li><li>propsï¼šæ¶ˆæ¯çš„åŸºæœ¬å±æ€§é›†ï¼Œå…¶åŒ…å« 14 ä¸ªå±æ€§æˆå‘˜ï¼Œåˆ†åˆ«æœ‰ <code>contentType</code> ã€<code>contentEncoding</code> ã€ <code>headers(Map&lt;String, Object&gt;)</code> ã€<code>deliveryMode</code> ã€<code>priority</code> ã€<code>correlationId</code> ã€<code>replyTo</code> ã€<code>expiration</code> ã€<code>messageId</code> ã€<code>timestamp</code> ã€<code>type</code> ã€<code>userId</code> ã€<code>appId</code> ã€<code>clusterId</code> </li><li>byte[] bodyï¼šæ¶ˆæ¯ä½“ï¼ŒçœŸæ­£è¦å‘é€çš„æ¶ˆæ¯ã€‚</li><li>mandatoryï¼šä¸º true æ—¶ï¼Œä¸”äº¤æ¢å™¨æ— æ³•æ ¹æ®è‡ªèº«çš„ç±»å‹å’Œè·¯ç”±é”®æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—ï¼Œè°ƒç”¨ <code>Basic.Return</code> å‘½ä»¤å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚ä¸º false æ—¶ï¼Œæ¶ˆæ¯ç›´æ¥è¢«ä¸¢å¼ƒã€‚</li><li>immediateï¼šä¸ºtrueæ—¶ï¼Œè‹¥äº¤æ¢å™¨åœ¨å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—æ—¶å‘ç°é˜Ÿåˆ—ä¸Šå¹¶ä¸å­˜åœ¨ä»»ä½•æ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å°†ä¸ä¼šå­˜å…¥é˜Ÿåˆ—ä¸­ã€‚å½“ä¸è·¯ç”±é”®åŒ¹é…çš„æ‰€æœ‰é˜Ÿåˆ—éƒ½æ²¡æœ‰æ¶ˆè´¹è€…æ—¶ï¼Œ è¯¥æ¶ˆæ¯ä¼šé€šè¿‡ <code>Basic.Return</code> è¿”å›è‡³ç”Ÿäº§è€…ã€‚</li></ul><hr><h2 id="ç¬¬å››èŠ‚-æ¶ˆè´¹æ¶ˆæ¯"><a href="#ç¬¬å››èŠ‚-æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="ç¬¬å››èŠ‚ æ¶ˆè´¹æ¶ˆæ¯"></a><strong>ç¬¬å››èŠ‚ æ¶ˆè´¹æ¶ˆæ¯</strong></h2><p>ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li>æ¨æ¨¡å¼ï¼šé‡‡ç”¨ <code>Basic.Consume</code> è¿›è¡Œæ¶ˆè´¹ï¼›</li><li>æ‹‰æ¨¡å¼ï¼šé‡‡ç”¨ <code>Basic.Get</code> è¿›è¡Œæ¶ˆè´¹ã€‚</li></ul><h3 id="4-1-æ¨æ¨¡å¼"><a href="#4-1-æ¨æ¨¡å¼" class="headerlink" title="4.1 æ¨æ¨¡å¼"></a>4.1 æ¨æ¨¡å¼</h3><p>é€šè¿‡æŒç»­è®¢é˜…çš„æ–¹å¼æ¶ˆè´¹æ¶ˆæ¯ï¼Œæ¥æ”¶æ¶ˆæ¯ä¸€èˆ¬é€šè¿‡å®ç° <code>Consumer</code> æ¥å£æˆ–è€…ç»§æ‰¿ <code>DefaultConsumer</code> ç±»æ¥å®ç°ã€‚ä¸åŒçš„è®¢é˜…é‡‡ç”¨ä¸åŒçš„æ¶ˆè´¹è€…æ ‡ç­¾ï¼ˆConsumerTagï¼‰æ¥åŒºåˆ†å½¼æ­¤ã€‚</p><p>ä¸»è¦é€šè¿‡æ–¹æ³• <code>channel.basicConsume()</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">      </span><br><span class="line">      <span class="comment">//æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åè¿›è¡Œæ˜¾å¼ ack æ“ä½œ channel.basicAck å¯¹äºæ¶ˆè´¹è€…å¾ˆå¿…è¦ï¼Œé˜²æ­¢æ¶ˆæ¯ä¸å¿…è¦çš„æ¶ˆå¤±</span></span><br><span class="line"><span class="keyword">boolean</span> autoAck = <span class="keyword">false</span>;</span><br><span class="line">      channel.basicQos(<span class="number">64</span>); <span class="comment">//è®¾ç½®å®¢æˆ·ç«¯æœ€å¤šæ¥æ”¶æœªè¢« ack çš„æ¶ˆæ¯çš„ä¸ªæ•°</span></span><br><span class="line">      channel.basicConsume(QUEUE_NAME, autoAck, <span class="string">"myConsumerTag"</span>,</span><br><span class="line">              <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">                  <span class="meta">@Override</span></span><br><span class="line">                  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             Envelope envelope,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             AMQP.BasicProperties properties,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                      String routingKey = envelope.getRoutingKey();</span><br><span class="line">                      String contentType = properties.getContentType();</span><br><span class="line">                      <span class="keyword">long</span> deliveryTag = envelope.getDeliveryTag();</span><br><span class="line">                      <span class="comment">// process the message components here ...</span></span><br><span class="line">                      channel.basicAck(envelope.getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;);</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li>queueï¼šé˜Ÿåˆ—çš„åç§°ï¼›</li><li>autoAckï¼šè®¾ç½®æ˜¯å¦è‡ªåŠ¨ç¡®è®¤ã€‚å»ºè®®è®¾æˆ false ï¼Œå³ä¸è‡ªåŠ¨ç¡®è®¤ï¼›</li><li>consumerTagï¼šæ¶ˆè´¹è€…æ ‡ç­¾ï¼Œç”¨æ¥åŒºåˆ†å¤šä¸ªæ¶ˆè´¹è€…ï¼›</li><li>noLocal è®¾ç½®ä¸º true åˆ™è¡¨ç¤ºä¸èƒ½å°†åŒä¸€ä¸ª Connection ä¸­ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ä¼ é€ç»™è¿™ä¸ª Connection ä¸­çš„æ¶ˆè´¹è€…ï¼›</li><li>exclusiveï¼šè®¾ç½®æ˜¯å¦æ’ä»– ï¼›</li><li>argumentsï¼šè®¾ç½®æ¶ˆè´¹è€…çš„å…¶ä»–å‚æ•°ï¼›</li><li>callbackï¼šè®¾ç½®æ¶ˆè´¹è€…çš„å›è°ƒå‡½æ•°ã€‚ç”¨æ¥å¤„ç† RabbitMQ æ¨é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ DefaultConsumer ä½¿ç”¨æ—¶éœ€è¦å®¢æˆ·ç«¯é‡å†™å…¶ä¸­çš„æ–¹æ³•ã€‚</li></ul><p>æ¶ˆè´¹è€…å®¢æˆ·ç«¯å¯ä»¥é‡å†™å¤šç§æ–¹æ³•ï¼š</p><ul><li><code>handleDelivery()</code></li><li><code>handleConsumerOk()</code> ï¼šä¼šåœ¨å…¶ä»–æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œè¿”å›æ¶ˆè´¹è€…æ ‡ç­¾ã€‚</li><li><code>handleCancelOk()</code> ï¼šæ¶ˆè´¹ç«¯å¯ä»¥åœ¨æ˜¾å¼åœ°å–æ¶ˆè®¢é˜…çš„æ—¶å€™è°ƒç”¨ã€‚</li><li><code>handleCancel()</code> ï¼šæ¶ˆè´¹ç«¯å¯ä»¥åœ¨éšå¼åœ°å–æ¶ˆè®¢é˜…çš„æ—¶å€™è°ƒç”¨</li><li><code>handleShutdownSignal()</code> ï¼šå½“ Channel æˆ–è€… Connection å…³é—­çš„æ—¶å€™ä¼šè°ƒç”¨ã€‚</li><li><code>handleRecoverOk()</code></li></ul><p>é€šè¿‡ <code>channel.basicCancel()</code> æ˜¾å¼åœ°å–æ¶ˆä¸€ä¸ªæ¶ˆè´¹è€…çš„è®¢é˜…ï¼Œå…ˆè§¦å‘ <code>handleConsumerOk()</code> ï¼Œç„¶åæ˜¯ <code>handleDelivery()</code> ï¼Œæœ€åæ˜¯ <code>handleCancelOk()</code> ã€‚</p><p>å’Œç”Ÿäº§è€…ä¸€æ ·ï¼Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯åŒæ ·éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚æ¶ˆè´¹è€…å®¢æˆ·ç«¯çš„è¿™äº› callback ä¼šè¢«åˆ†é…åˆ°ä¸ Channel ä¸åŒçš„çº¿ç¨‹æ± ä¸Šï¼Œè¿™æ„å‘³ç€æ¶ˆè´¹è€…å®¢æˆ·ç«¯å¯ä»¥å®‰å…¨åœ°è°ƒç”¨è¿™äº›é˜»å¡æ–¹æ³•ï¼Œæ¯”å¦‚ <code>channel.queueDeclare</code> ï¼Œ <code>channel.basicCancel</code> ç­‰ã€‚ </p><p>æ¯ä¸ª Channel éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„çº¿ç¨‹ã€‚æœ€å¸¸ç”¨çš„åšæ³•æ˜¯ä¸€ä¸ª Channel å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œ ä¹Ÿå°±æ˜¯æ„å‘³ç€æ¶ˆè´¹è€…å½¼æ­¤ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³è”ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ª Channel ä¸­ç»´æŒå¤šä¸ªæ¶ˆè´¹è€…ï¼Œ ä½†æ˜¯è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ Channel ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€ç›´åœ¨è¿è¡Œï¼Œé‚£ä¹ˆå…¶ä»–æ¶ˆè´¹è€…çš„ callback ä¼šè¢«â€œè€½æâ€ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010153.png" alt></p><h3 id="4-2-æ‹‰æ¨¡å¼"><a href="#4-2-æ‹‰æ¨¡å¼" class="headerlink" title="4.2 æ‹‰æ¨¡å¼"></a>4.2 æ‹‰æ¨¡å¼</h3><p>é€šè¿‡ <code>channel.basicGet()</code> å¯ä»¥å•æ¡çš„è·å–æ¶ˆæ¯ï¼Œå½“ autoAck è®¾ç½®ä¸ºfalseï¼Œéœ€è¦ç”¨ <code>channel.basicAck()</code> æ¥ç¡®è®¤æ¶ˆæ¯å·²è¢«æˆåŠŸæ¥æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GetResponse response = channel.basicGet(QUEUE_NAME, <span class="keyword">false</span>);</span><br><span class="line">System.out,println(<span class="keyword">new</span> String(response.getBody()));</span><br><span class="line">channel.basicAck(response.getEnvelope().getDeliveryTag(), <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010158.png" alt></p><p><code>Basic.Consume</code> å°†ä¿¡é“ï¼ˆChannelï¼‰ç½®ä¸ºæ¥æ”¶æ¨¡å¼ï¼Œç›´åˆ°å–æ¶ˆé˜Ÿåˆ—çš„è®¢é˜…ä¸ºæ­¢ã€‚åœ¨æ¥æ”¶æ¨¡å¼æœŸé—´ï¼Œ RabbitMQ ä¼šä¸æ–­åœ°æ¨é€æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œå½“ç„¶æ¨é€æ¶ˆæ¯çš„ä¸ªæ•°è¿˜æ˜¯ä¼šå—åˆ° <code>Basic.Qos</code> çš„é™åˆ¶ï¼å¦‚æœåªæƒ³ä»é˜Ÿåˆ—è·å¾—å•æ¡æ¶ˆæ¯è€Œä¸æ˜¯æŒç»­è®¢é˜…ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨ <code>Basic.Get</code> è¿›è¡Œæ¶ˆè´¹ï¼ä½†æ˜¯ä¸èƒ½å°† <code>Basic.Get</code> æ”¾åœ¨ä¸€ä¸ªå¾ªç¯é‡Œæ¥ä»£æ›¿ <code>Basic.Consume</code> ï¼Œè¿™æ ·åšä¼šä¸¥é‡å½±å“ RabbitMQ çš„æ€§èƒ½ï¼å¦‚æœè¦å®ç°é«˜ååé‡ï¼Œæ¶ˆè´¹è€…ç†åº”ä½¿ç”¨ <code>Basic.Consume</code> æ–¹æ³•ã€‚</p><hr><h2 id="ç¬¬äº”èŠ‚-æ¶ˆè´¹ç«¯çš„ç¡®è®¤ä¸æ‹’ç»"><a href="#ç¬¬äº”èŠ‚-æ¶ˆè´¹ç«¯çš„ç¡®è®¤ä¸æ‹’ç»" class="headerlink" title="ç¬¬äº”èŠ‚ æ¶ˆè´¹ç«¯çš„ç¡®è®¤ä¸æ‹’ç»"></a><strong>ç¬¬äº”èŠ‚ æ¶ˆè´¹ç«¯çš„ç¡®è®¤ä¸æ‹’ç»</strong></h2><p>ä¸ºäº†ä¿è¯æ¶ˆæ¯ä»é˜Ÿåˆ—å¯é åœ°è¾¾åˆ°æ¶ˆè´¹è€…ï¼Œ RabbitMQ æä¾›äº†æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ ï¼ˆmessage acknowledgementï¼‰ã€‚æ¶ˆè´¹è€…åœ¨è®¢é˜…é˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥æŒ‡å®š autoAck å‚æ•°ï¼Œå½“ autoAck ç­‰äº false æ—¶ï¼Œ RabbitMQ ä¼šç­‰å¾…æ¶ˆè´¹è€…æ˜¾å¼åœ°å›å¤ç¡®è®¤ä¿¡å·åæ‰ä»å†…å­˜ï¼ˆæˆ–è€…ç£ç›˜ï¼‰ä¸­ç§»å»æ¶ˆæ¯ï¼ˆå®è´¨ä¸Šæ˜¯å…ˆæ‰“ä¸Šåˆ é™¤æ ‡è®°ï¼Œä¹‹åå†åˆ é™¤ï¼‰ã€‚å½“ autoAck ç­‰äº true æ—¶ï¼Œ RabbitMQ ä¼šè‡ªåŠ¨æŠŠå‘é€å‡ºå»çš„æ¶ˆæ¯ç½®ä¸ºç¡®è®¤ï¼Œç„¶åä»å†…å­˜ï¼ˆæˆ–è€…ç£ç›˜ï¼‰ä¸­åˆ é™¤ï¼Œè€Œä¸ç®¡æ¶ˆè´¹è€…æ˜¯å¦çœŸæ­£åœ°æ¶ˆè´¹åˆ°äº†è¿™äº›æ¶ˆæ¯ã€‚</p><p>é‡‡ç”¨æ¶ˆæ¯ç¡®è®¤æœºåˆ¶åï¼Œåªè¦è®¾ç½® autoAck å‚æ•°ä¸º false ï¼Œæ¶ˆè´¹è€…å°±æœ‰è¶³å¤Ÿçš„æ—¶é—´å¤„ç†æ¶ˆæ¯ï¼ˆä»»åŠ¡ï¼‰ï¼Œä¸ç”¨æ‹…å¿ƒå¤„ç†æ¶ˆæ¯è¿‡ç¨‹ä¸­æ¶ˆè´¹è€…è¿›ç¨‹æŒ‚æ‰åæ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜ å› ä¸º RabbitMQ ä¼šä¸€ç›´ç­‰å¾…æŒæœ‰æ¶ˆæ¯ç›´åˆ°æ¶ˆè´¹è€…æ˜¾å¼è°ƒ <code>Basic.Ack</code> å‘½ä»¤ä¸ºæ­¢ã€‚</p><p>å½“ autoAck å‚æ•°ç½®ä¸º false ï¼Œå¯¹äº RabbitMQ æœåŠ¡ç«¯è€Œè¨€ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€éƒ¨åˆ†æ˜¯ç­‰å¾…æŠ•é€’ç»™æ¶ˆè´¹è€…çš„æ¶ˆæ¯ï¼›ä¸€éƒ¨åˆ†æ˜¯å·±ç»æŠ•é€’ç»™æ¶ˆè´¹è€…ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…ç¡®è®¤ä¿¡å·çš„æ¶ˆæ¯ã€‚å¦‚æœ RabbitMQ ä¸€ç›´æ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„ç¡®è®¤ä¿¡å·ï¼Œå¹¶ä¸”æ¶ˆè´¹æ­¤æ¶ˆæ¯çš„æ¶ˆè´¹è€…å·±ç»æ–­å¼€è¿æ¥ï¼Œåˆ™ RabbitMQ ä¼šå®‰æ’è¯¥æ¶ˆæ¯é‡æ–°è¿›å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…æŠ•é€’ç»™ä¸‹ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½è¿˜æ˜¯åŸæ¥çš„é‚£ä¸ªæ¶ˆè´¹è€…ã€‚</p><p>RabbitMQ ä¸ä¼šä¸ºæœªç¡®è®¤çš„æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå®ƒåˆ¤æ–­æ­¤æ¶ˆæ¯æ˜¯å¦éœ€è¦é‡æ–°æŠ•é€’ç»™æ¶ˆè´¹è€…çš„å”¯ä¸€ä¾æ®æ˜¯æ¶ˆè´¹è¯¥æ¶ˆæ¯çš„æ¶ˆè´¹è€…è¿æ¥æ˜¯å¦å·±ç»æ–­å¼€ï¼Œè¿™ä¹ˆè®¾è®¡çš„åŸå› æ˜¯ RabbitMQ å…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯çš„æ—¶é—´å¯ä»¥å¾ˆä¹…å¾ˆä¹…ã€‚ </p><p>RabbtiMQ çš„ Web ç®¡ç†å¹³å°ä¸Šå¯ä»¥çœ‹åˆ°å½“å‰é˜Ÿåˆ—ä¸­çš„â€œReady â€çŠ¶æ€ å’Œâ€œUnacknowledged ï¼‚çŠ¶æ€çš„æ¶ˆæ¯æ•°ï¼Œåˆ†åˆ«å¯¹åº”ä¸Šæ–‡ä¸­çš„ç­‰å¾…æŠ•é€’ç»™æ¶ˆè´¹è€…çš„æ¶ˆæ¯æ•°å’Œå·±ç»æŠ•é€’ç»™æ¶ˆè´¹è€…ä½†æ˜¯æœªæ”¶åˆ°ç¡®è®¤ä¿¡å·çš„æ¶ˆæ¯æ•°ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010159.png" alt></p><p>ä¹Ÿå¯ä»¥é€šè¿‡ç›¸åº”çš„å‘½ä»¤æ¥æŸ¥çœ‹ä¸Šè¿°ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rabbitmqctl list_queues name message_ready messages_unacknowledged</span></span><br><span class="line">Listing queues ...</span><br><span class="line">queue         1   0</span><br><span class="line">queue_demo    0</span><br></pre></td></tr></table></figure><p>åœ¨æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå¦‚æœæƒ³æ˜ç¡®æ‹’ç»å½“å‰çš„æ¶ˆæ¯è€Œä¸æ˜¯ç¡®è®¤ï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé€šè¿‡ <code>Basic.Reject</code> è¿™ä¸ªå‘½ä»¤ï¼Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨ä¸å…¶å¯¹åº”çš„ <code>channel.basicReject</code> æ–¹æ³•æ¥å‘Šè¯‰ RabbitMQ æ‹’ç»è¿™ä¸ªæ¶ˆæ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">basicReject</span><span class="params">(<span class="keyword">long</span> deliveryTag, <span class="keyword">boolean</span> requeue)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure><ul><li>deliveryTagï¼šæ¶ˆæ¯ç¼–å·ï¼Œ64ä½çš„é•¿æ•´å‹å€¼ã€‚</li><li>requeueï¼šå½“ä¸ºtrueæ—¶ï¼ŒRabbitMQä¼šé‡æ–°å°†æ­¤æ¡æ¶ˆæ¯å­˜å…¥é˜Ÿåˆ—ï¼Œä»¥ä¾¿å¯ä»¥å‘é€ç»™ä¸‹ä¸€ä¸ªè®¢é˜…çš„æ¶ˆè´¹è€…ï¼›å½“ä¸ºfalseæ—¶ï¼Œç«‹å³å°†æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚</li></ul><p>æ‰¹é‡æ‹’ç»æ¶ˆæ¯éœ€è¦ <code>Basic.Nack</code> ï¼Œå®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">basicNack</span><span class="params">(<span class="keyword">long</span> deliveryTag, <span class="keyword">boolean</span> multiple, <span class="keyword">boolean</span> requeue)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure><ul><li>multipleï¼šä¸ºfalseæ—¶ï¼Œè¡¨ç¤ºæ‹’ç»å•æ¡æ¶ˆæ¯ï¼›ä¸ºtrueæ—¶ï¼Œæ‹’ç»ç¼–å·å‰æ‰€æœ‰æœªè¢«æ¶ˆè´¹è€…ç¡®è®¤çš„æ¶ˆæ¯ã€‚</li></ul><p><code>channel.basicRecover()</code> è¯·æ±‚RabbitMQé‡æ–°å‘é€è¿˜æœªè¢«ç¡®è®¤çš„æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Basic.<span class="function">RecoverOk <span class="title">basicRecover</span><span class="params">(<span class="keyword">boolean</span> requeue)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure><ul><li>requeueï¼šä¸ºtrueï¼Œæœªè¢«ç¡®è®¤çš„æ¶ˆæ¯ä¼šè¢«é‡æ–°åŠ å…¥åˆ°é˜Ÿåˆ—ï¼Œå¯èƒ½ä¼šè¢«åˆ†é…ç»™å¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€…ï¼›ä¸ºfalseï¼ŒåŒä¸€æ¡æ¶ˆæ¯ä¼šè¢«åˆ†é…ç»™ä¹‹å‰ç›¸åŒçš„æ¶ˆè´¹è€…ã€‚</li></ul><hr><h2 id="ç¬¬å…­èŠ‚-å…³é—­è¿æ¥"><a href="#ç¬¬å…­èŠ‚-å…³é—­è¿æ¥" class="headerlink" title="ç¬¬å…­èŠ‚ å…³é—­è¿æ¥"></a><strong>ç¬¬å…­èŠ‚ å…³é—­è¿æ¥</strong></h2><p>åœ¨åº”ç”¨ç¨‹åºä½¿ç”¨å®Œä¹‹åï¼Œéœ€è¦å…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">channel.close();</span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure><p>åœ¨ Connection å…³é—­çš„æ—¶å€™ï¼Œ Channel ä¹Ÿä¼šè‡ªåŠ¨å…³é—­ã€‚</p><p>Connection Channel æ‰€å…·å¤‡çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹æ‰€è¿°ï¼š</p><ul><li>Openï¼šå¼€å¯çŠ¶æ€ï¼Œä»£è¡¨å½“å‰å¯¹è±¡å¯ä»¥ä½¿ç”¨ã€‚ </li><li>Closingï¼šæ­£åœ¨å…³é—­çŠ¶æ€ã€‚å½“å‰å¯¹è±¡è¢«æ˜¾å¼åœ°é€šçŸ¥è°ƒç”¨å…³é—­æ–¹æ³•ï¼ˆshutdownï¼‰ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†ä¸€ä¸ªå…³é—­è¯·æ±‚è®©å…¶å†…éƒ¨å¯¹è±¡è¿›è¡Œæ“ä½œå¹¶ç­‰å¾…è¿™äº›å…³é—­æ“ä½œçš„å®Œæˆã€‚ </li><li>Closedï¼šå·²ç»å…³é—­çŠ¶æ€ã€‚å½“å‰å¯¹è±¡å·±ç»æ¥æ”¶åˆ°æ‰€æœ‰çš„å†…éƒ¨å¯¹è±¡å·±å®Œæˆå…³é—­åŠ¨ä½œçš„é€šçŸ¥ï¼Œå¹¶ä¸”å…¶ä¹Ÿå…³é—­äº†è‡ªèº«ã€‚</li></ul><p>å½“ Connection æˆ–è€… Channel çš„çŠ¶æ€è½¬å˜ä¸º Closed çš„æ—¶å€™ä¼šè°ƒç”¨  <code>ShutdownListener</code> ã€‚è€Œä¸”å¦‚æœå°†ä¸€ä¸ª <code>ShutdownListener</code> æ³¨å†Œåˆ°ä¸€ä¸ªå·±ç»å¤„äº Closed çŠ¶æ€çš„å¯¹è±¡ï¼ˆè¿™é‡Œç‰¹æŒ‡ Connection å’Œ Channel å¯¹è±¡ï¼‰ï¼Œä¼šç«‹åˆ»è°ƒç”¨  <code>ShutdownListener</code> ã€‚</p><p><code>getCloseReason</code> æ–¹æ³•å¯ä»¥è®©ä½ çŸ¥é“å¯¹è±¡å…³é—­çš„åŸå›  <code>isOpen</code> æ–¹æ³•æ£€æµ‹å¯¹è±¡å½“å‰æ˜¯å¦å¤„äºå¼€å¯çŠ¶æ€ï¼š <code>close(int closeCode , String closeMessage)</code> æ–¹æ³•æ˜¾å¼åœ°é€šçŸ¥å½“å‰å¯¹è±¡æ‰§è¡Œå…³é—­æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">connection.addShutdownListener(<span class="keyword">new</span> ShutdownListener()&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdownCompleted</span><span class="params">(ShutdownSignalException cause)</span></span>&#123;</span><br><span class="line">           ......</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure><p>å½“è§¦å‘ ShutdownListener çš„æ—¶å€™ï¼Œå°±å¯ä»¥è·å–åˆ° ShutdownSignalException ï¼Œè¿™ä¸ª ShutdownSignalException åŒ…å«äº†å…³é—­çš„åŸå› ï¼Œå¯ä»¥é€šè¿‡<code>getCloseReason</code> æ–¹æ³•è·å–ã€‚ <code>isHardError</code> æ–¹æ³• å¯ä»¥çŸ¥é“æ˜¯ <code>Connection</code> çš„è¿˜æ˜¯ <code>Channel</code> çš„é”™è¯¯ï¼› <code>getReason</code> æ–¹æ³•å¯ä»¥è·å– cause ç›¸å…³çš„ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdownCompleted</span><span class="params">(ShutdownSignal cause)</span></span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(cause.isHardError())&#123;</span><br><span class="line">           Connection conn = (Connection) cause.getReference();</span><br><span class="line">           <span class="keyword">if</span>(!cause.isInitiatedByApplication())&#123;</span><br><span class="line">               Method reason = cause.getReason();</span><br><span class="line">               ...</span><br><span class="line">           &#125;</span><br><span class="line">           ...</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           Channel ch = (Channel) cause.getReference();</span><br><span class="line">           ...</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹</p>]]></content>
    
    <summary type="html">
    
      å­¦ä¹ RabbitMQï¼Œç¬¬äºŒç« ã€Šå®¢æˆ·ç«¯å¼€å‘ã€‹ï¼Œå†…å®¹æ¥è‡ªäºã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šè¿æ¥RabbitMQï¼Œä½¿ç”¨äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯çš„ç¡®è®¤ä¸æ‹’ç»ï¼Œå…³é—­è¿æ¥ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="mom" scheme="http://linyishui.top/tags/mom/"/>
    
      <category term="rabbitmq" scheme="http://linyishui.top/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQï¼ˆä¸€ï¼‰ç®€ä»‹å’Œå…¥é—¨</title>
    <link href="http://linyishui.top/2020091901.html"/>
    <id>http://linyishui.top/2020091901.html</id>
    <published>2020-09-19T04:30:19.000Z</published>
    <updated>2020-10-02T08:16:37.945Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="RabbitMQï¼ˆä¸€ï¼‰ç®€ä»‹å’Œå…¥é—¨"><a href="#RabbitMQï¼ˆä¸€ï¼‰ç®€ä»‹å’Œå…¥é—¨" class="headerlink" title="RabbitMQï¼ˆä¸€ï¼‰ç®€ä»‹å’Œå…¥é—¨"></a><strong>RabbitMQï¼ˆä¸€ï¼‰ç®€ä»‹å’Œå…¥é—¨</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-æ¦‚è¿°"><a href="#ç¬¬ä¸€èŠ‚-æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€èŠ‚ æ¦‚è¿°"></a><strong>ç¬¬ä¸€èŠ‚ æ¦‚è¿°</strong></h2><h3 id="1-1-ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#1-1-ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶"></a><strong>1.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶</strong></h3><p><strong>æ¶ˆæ¯</strong>æŒ‡åœ¨åº”ç”¨é—´ä¼ é€çš„æ•°æ®ã€‚å¯ä»¥åªåŒ…å«å­—ç¬¦ä¸²ã€JSONç­‰ï¼Œä¹Ÿå¯ä»¥åŒ…æ‹¬å†…åµŒå¯¹è±¡ã€‚</p><p><strong>æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶</strong>ï¼ˆMessage Queue Middlewareï¼Œå³MQï¼‰æŒ‡åˆ©ç”¨é«˜æ•ˆå¯é çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶è¿›è¡Œä¸å¹³å°æ— å…³çš„æ•°æ®äº¤æµï¼Œå¹¶åŸºäºæ•°æ®é€šä¿¡æ¥è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„é›†æˆã€‚<strong>é€šè¿‡æ¶ˆæ¯ä¼ é€’å’Œæ¶ˆæ¯æ’é˜Ÿæ¨¡å‹ï¼Œå¯ä»¥åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ‰©å±•è¿›ç¨‹é—´é€šä¿¡</strong>ã€‚</p><p>ä¸¤ç§ä¼ é€’æ¨¡å¼ï¼š</p><ul><li><strong>ç‚¹å¯¹ç‚¹æ¨¡å¼</strong>ï¼ˆP2Pï¼‰ï¼šåŸºäºé˜Ÿåˆ—ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆæ¯æ¶ˆè´¹è€…ä»é˜Ÿåˆ—æ¥å—æ¶ˆæ¯ã€‚é˜Ÿåˆ—ä½¿æ¶ˆæ¯çš„<strong>å¼‚æ­¥ä¼ è¾“</strong>æˆä¸ºå¯èƒ½ã€‚</li><li><strong>å‘å¸ƒ/è®¢é˜…æ¨¡å¼</strong>ï¼ˆPub/Subï¼‰ï¼šè®¢é˜…äº†å¦‚ä½•å‘ä¸€ä¸ªå†…å®¹èŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼Œå†…å®¹èŠ‚ç‚¹è¢«ç§°ä¸º<strong>ä¸»é¢˜</strong>ï¼ˆtopicï¼‰ï¼Œå¯ä»¥çœ‹ä½œæ˜¯æ¶ˆæ¯ä¼ é€’çš„ä¸­ä»‹ï¼Œæ¶ˆæ¯å‘å¸ƒè€…å°†æ¶ˆæ¯å‘å¸ƒåˆ°æŸä¸ªä¸»é¢˜ï¼Œè®¢é˜…è€…ä»ä¸»é¢˜è®¢é˜…æ¶ˆæ¯ã€‚ä¸»é¢˜ä½¿å‘å¸ƒè€…å’Œè®¢é˜…è€…ç›¸äº’ç‹¬ç«‹ï¼Œå¯ä»¥åœ¨æ¶ˆæ¯çš„<strong>ä¸€å¯¹å¤šå¹¿æ’­</strong>æ—¶é‡‡ç”¨ã€‚</li></ul><p>æ¶ˆæ¯ä¸­é—´ä»¶æä¾›äº†åŸºäºå­˜å‚¨å’Œè½¬å‘çš„åº”ç”¨ç¨‹åºä¹‹é—´çš„å¼‚æ­¥æ•°æ®å‘ç”Ÿï¼Œå³åº”ç”¨ç¨‹åºé—´ä¸ç›´æ¥é€šä¿¡ï¼Œè€Œæ˜¯ä½œä¸ºä¸­ä»‹çš„æ¶ˆæ¯ä¸­é—´ä»¶é€šä¿¡ã€‚æ¶ˆæ¯ä¸­é—´ä»¶å°è£…äº†è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰å’Œç½‘ç»œé€šä¿¡åè®®çš„ç»†èŠ‚ã€‚</p><h3 id="1-2-å¸¸è§çš„æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#1-2-å¸¸è§çš„æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="1.2 å¸¸è§çš„æ¶ˆæ¯ä¸­é—´ä»¶"></a><strong>1.2 å¸¸è§çš„æ¶ˆæ¯ä¸­é—´ä»¶</strong></h3><p>å¸¸è§çš„å‡ æ¬¾å¼€æºæ¶ˆæ¯ä¸­é—´ä»¶ï¼š</p><ul><li>RabbitMQï¼šåŸºäºAMQPåè®®ï¼Œä¸»æµæ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ä¸€ï¼Œé€‚åˆæ•°æ®é‡æ²¡é‚£ä¹ˆå¤§çš„é¡¹ç›®ï¼›</li><li>Kafkaï¼šè¯ç”ŸäºLinkedInå…¬å¸ï¼Œååé‡å¤§ï¼Œå¯ç”¨æ€§é«˜ï¼Œå¸¸ç”¨äºå¤§æ•°æ®é¢†åŸŸã€‚</li><li>ActiveMQï¼šApacheè€ç‰Œæ¶ˆæ¯å¼•æ“ï¼›</li><li>RocketMQï¼šé˜¿é‡Œå·´å·´å¼€æºäº§å“ï¼ŒJavaå®ç°ï¼Œå‚è€ƒäº†Kafkaçš„è®¾è®¡ï¼Œå¯ç”¨æ€§å’Œååé‡å¾ˆé«˜ï¼Œé€‚åˆäºç”µå•†å’Œé‡‘èäº’è”ç½‘åœºæ™¯ã€‚</li><li>Apolloï¼šApacheçš„ActiveMQå­é¡¹ç›®ã€‚</li></ul><h3 id="1-3-æ¶ˆæ¯ä¸­é—´ä»¶çš„ä½œç”¨"><a href="#1-3-æ¶ˆæ¯ä¸­é—´ä»¶çš„ä½œç”¨" class="headerlink" title="1.3 æ¶ˆæ¯ä¸­é—´ä»¶çš„ä½œç”¨"></a><strong>1.3 æ¶ˆæ¯ä¸­é—´ä»¶çš„ä½œç”¨</strong></h3><ul><li><strong>è§£è€¦</strong>ï¼šåªè¦éµå®ˆåŒæ ·çš„æ¥å£çº¦æŸï¼Œæˆ‘ä»¬å¯ä»¥ç‹¬ç«‹çš„æ‰©å±•å’Œä¿®æ”¹é€šä¿¡ä¸¤ç«¯çš„å¤„ç†è¿‡ç¨‹ã€‚</li><li><strong>å†—ä½™ï¼ˆå­˜å‚¨ï¼‰</strong>ï¼šæ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥æŠŠæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç›´åˆ°è¢«å®Œå…¨å¤„ç†ï¼Œå¯ä»¥è§„é¿æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚å³æ¶ˆæ¯åœ¨è¢«ä»ä¸­é—´ä»¶åˆ é™¤å‰ï¼Œéœ€è¦å¤„ç†ç³»ç»Ÿæ˜ç¡®çš„æŒ‡å‡ºæ­¤æ¶ˆæ¯å·²è¢«å¤„ç†å®Œæˆã€‚</li><li><strong>æ‰©å±•æ€§</strong>ï¼šå› ä¸ºè§£è€¦äº†åº”ç”¨çš„å¤„ç†è¿‡ç¨‹ï¼Œæ‰€ä»¥æé«˜æ¶ˆæ¯çš„å…¥é˜Ÿå’Œå¤„ç†æ•ˆç‡å¾ˆå®¹æ˜“ï¼Œåªé¡»å¢åŠ å¤„ç†è¿‡ç¨‹ï¼Œä¸éœ€æ”¹åŠ¨ä»£ç ä¹Ÿä¸éœ€è°ƒèŠ‚å‚æ•°ã€‚</li><li><strong>å‰Šå³°</strong>ï¼šè®¿é—®é‡å‰§å¢æ—¶ï¼Œè¿™ç§æƒ…å†µä¸ä¸€å®šæ˜¯å¸¸æ€ï¼Œå¦‚æœä»¥æ­¤ä¸ºæ ‡å‡†æŠ•å…¥èµ„æºæ— ç–‘æ˜¯å·¨å¤§çš„æµªè´¹ã€‚æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥ä½¿å…³é”®ç»„ä»¶æ”¯æ’‘çªå‘è®¿é—®å‹åŠ›ï¼Œä¸ä¼šå› ä¸ºçªå‘çš„è¶…è´Ÿè·è¯·æ±‚è€Œå´©æºƒã€‚</li><li><strong>å¯æ¢å¤æ€§</strong>ï¼šæ¶ˆæ¯ä¸­é—´ä»¶é™ä½äº†è¿›ç¨‹é—´çš„è€¦åˆåº¦ï¼Œå³ä½¿ä¸€ä¸ªå¤„ç†æ¶ˆæ¯çš„è¿›ç¨‹æŒ‚æ‰ï¼Œæ¶ˆæ¯ä»å¯ä»¥ç­‰åˆ°ç³»ç»Ÿæ¢å¤åè¿›è¡Œå¤„ç†ã€‚</li><li><strong>é¡ºåºä¿è¯</strong>ï¼šå¤§éƒ¨åˆ†æ¶ˆæ¯ä¸­é—´ä»¶æ”¯æŒä¸€å®šç¨‹åº¦ä¸Šçš„æ•°æ®å¤„ç†çš„é¡ºåºæ€§ã€‚</li><li><strong>ç¼“å†²</strong>ï¼šæ¶ˆæ¯ä¸­é—´ä»¶é€šè¿‡ä¸€ä¸ªç¼“å†²å±‚å¸®åŠ©ä»»åŠ¡ä»¥æœ€é«˜æ•ˆç‡æ‰§è¡Œï¼Œæœ‰åŠ©äºæ§åˆ¶å’Œä¼˜åŒ–æ•°æ®æµç»è¿‡ç³»ç»Ÿçš„é€Ÿåº¦ã€‚</li><li><strong>å¼‚æ­¥é€šä¿¡</strong>ï¼šæœ‰æ—¶åº”ç”¨ä¸æƒ³ä¹Ÿä¸éœ€è¦ç«‹å³å¤„ç†æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶æä¾›äº†å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œåº”ç”¨å¯ä»¥æ”¾å…¥ä¸€äº›æ¶ˆæ¯ä½†ä¸ç«‹å³å¤„ç†ã€‚</li></ul><h3 id="1-4-RabbitMQçš„å‘å±•å†ç¨‹"><a href="#1-4-RabbitMQçš„å‘å±•å†ç¨‹" class="headerlink" title="1.4 RabbitMQçš„å‘å±•å†ç¨‹"></a><strong>1.4 RabbitMQçš„å‘å±•å†ç¨‹</strong></h3><p>RabbitMQåŸºäº Erlang è¯­è¨€å®ç° <strong>AMQP</strong>ï¼ˆAdvanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œèµ·æºäºé‡‘èç³»ç»Ÿï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ã€‚</p><p>ä¹‹å‰ï¼Œå•†ä¸šçš„æ¶ˆæ¯ä¸­é—´ä»¶å¦‚å¾®è½¯çš„MSMQã€IBMçš„WebSphereç­‰æ²¡æœ‰åˆ›å»ºæ ‡å‡†æ¥å®ç°MQäº§å“çš„äº’é€šæˆ–å…è®¸åº”ç”¨è‡ªå®šä¹‰MQå¹³å°ã€‚<strong>JMS</strong>ï¼ˆJava Message Serviceï¼‰åº”è¿è€Œç”Ÿï¼Œ<strong>è¯•å›¾é€šè¿‡æä¾›å…¬å…±Java APIçš„æ–¹å¼éšè—å•ç‹¬MQäº§å“çš„å®é™…æ¥å£ï¼Œæ¥è§£å†³äº’é€šé—®é¢˜</strong>ã€‚<strong>ActiveMQ</strong>å°±æ˜¯åŸºäºJMSçš„ä¸€ç§å®ç°ï¼Œä½†è¿™ç§ä½¿ç”¨å•ç‹¬æ ‡å‡†åŒ–æ¥å£æ¥èƒ¶åˆä¸åŒçš„æ¥å£æœ€ç»ˆè¿˜æ˜¯ä¼šæš´éœ²é—®é¢˜ï¼Œæ‰€ä»¥ä¸šå†…éœ€è¦ä¸€ç§æ–°çš„æ¶ˆæ¯é€šä¿¡æ ‡å‡†åŒ–æ–¹æ¡ˆã€‚</p><p>2006å¹´6æœˆï¼ŒCiscoã€Redhatã€iMatixç­‰è”åˆåˆ¶å®šäº†AMQPæ ‡å‡†ï¼Œå®ƒæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œæ¥è§£å†³ä¼—å¤šæ¶ˆæ¯ä¸­é—´ä»¶çš„éœ€æ±‚å’Œæ‹“æ‰‘ç»“æ„é—®é¢˜ã€‚<strong>é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ï¼ŒåŸºäºæ­¤åè®®çš„å®¢æˆ·ç«¯å’Œæ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥ä¼ é€’æ¶ˆæ¯ï¼Œä¸å—äº§å“ã€å¼€å‘è¯­è¨€çš„é™åˆ¶ã€‚</strong></p><p>RabbitMQæ—©æœŸå³å®ç°äº†AMQPçš„ä¸€ä¸ªç‰¹æ€§ï¼šä½¿ç”¨åè®®æœ¬èº«å°±å¯ä»¥å¯¹é˜Ÿåˆ—å’Œäº¤æ¢å™¨è¿™æ ·çš„èµ„æºè¿›è¡Œé…ç½®ã€‚è€Œå•†ä¸šMQè¿›è¡Œèµ„æºé…ç½®éœ€è¦ç®¡ç†ç»ˆç«¯çš„ç‰¹å®šå·¥å…·ã€‚</p><h3 id="1-5-RabbitMQçš„ç‰¹ç‚¹"><a href="#1-5-RabbitMQçš„ç‰¹ç‚¹" class="headerlink" title="1.5 RabbitMQçš„ç‰¹ç‚¹"></a><strong>1.5 RabbitMQçš„ç‰¹ç‚¹</strong></h3><ul><li><strong>å¯é æ€§</strong>ï¼šé€šè¿‡å¦‚æŒä¹…åŒ–ã€ä¼ è¾“ç¡®è®¤åŠå‘å¸ƒç¡®è®¤ç­‰ä¿éšœå¯é æ€§ã€‚</li><li><strong>çµæ´»è·¯ç”±</strong>ï¼šæ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—å‰ï¼Œé€šè¿‡äº¤æ¢å™¨æ¥è·¯ç”±æ¶ˆæ¯ã€‚åŸºæœ¬çš„è·¯ç”±åŠŸèƒ½ç”±å†…ç½®çš„äº¤æ¢å™¨æ¥å®ç°ï¼Œå¤æ‚çš„è·¯ç”±åŠŸèƒ½å¯ä»¥ç»‘å®šå¤šä¸ªè·¯ç”±å™¨å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰çš„äº¤æ¢å™¨ã€‚</li><li><strong>æ‰©å±•æ€§</strong>ï¼šå¤šä¸ªRabbitMQèŠ‚ç‚¹å¯ä»¥ç»„æˆé›†ç¾¤ï¼Œå¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µåŠ¨æ€æ‰©å±•èŠ‚ç‚¹ã€‚</li><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šé˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤çš„æœºå™¨ä¸Šè®¾ç½®é•œåƒï¼Œåœ¨éƒ¨åˆ†èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ä»èƒ½ä½¿ç”¨é˜Ÿåˆ—ã€‚</li><li><strong>å¤šç§åè®®</strong>ï¼šé™¤äº†åŸç”ŸAMQPåè®®ï¼Œè¿˜æ”¯æŒSTOMPã€MQTTç­‰å¤šç§æ¶ˆæ¯ä¸­é—´ä»¶åè®®ã€‚</li><li><strong>å¤šè¯­è¨€å®¢æˆ·ç«¯</strong>ï¼šæ”¯æŒå‡ ä¹æ‰€æœ‰å¸¸ç”¨è¯­è¨€ï¼Œå¦‚Javaã€Pythonã€Rubyã€PHPã€C#ã€JavaScriptç­‰ã€‚</li><li><strong>ç®¡ç†ç•Œé¢</strong>ï¼šæä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„ç”¨æˆ·ç•Œé¢ï¼Œå¯ä»¥ç›‘æ§å’Œç®¡ç†æ¶ˆæ¯ã€é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç­‰ã€‚</li><li><strong>æ’ä»¶æœºåˆ¶</strong>ï¼šæä¾›äº†è®¸å¤šæ’ä»¶ï¼Œå¯ä»¥è¿›è¡Œæ‰©å±•ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ’ä»¶ã€‚</li></ul><hr><h2 id="ç¬¬äºŒèŠ‚-RabbitMQçš„å®‰è£…å’Œç®€å•ä½¿ç”¨"><a href="#ç¬¬äºŒèŠ‚-RabbitMQçš„å®‰è£…å’Œç®€å•ä½¿ç”¨" class="headerlink" title="ç¬¬äºŒèŠ‚ RabbitMQçš„å®‰è£…å’Œç®€å•ä½¿ç”¨"></a><strong>ç¬¬äºŒèŠ‚ RabbitMQçš„å®‰è£…å’Œç®€å•ä½¿ç”¨</strong></h2><h3 id="2-1-å®‰è£…"><a href="#2-1-å®‰è£…" class="headerlink" title="2.1 å®‰è£…"></a><strong>2.1 å®‰è£…</strong></h3><p>é¦–å…ˆè¦å®‰è£…Erlangï¼Œå®˜ç½‘åœ°å€ï¼š<a href="http://www.erlang.org/downloads" target="_blank" rel="noopener">Erlang-Download</a> ã€‚ä»¥ä¸‹åŸºäºLinuxæ“ä½œç³»ç»Ÿå®‰è£…ã€‚</p><h4 id="ï¼ˆ1ï¼‰å®‰è£…Erlang"><a href="#ï¼ˆ1ï¼‰å®‰è£…Erlang" class="headerlink" title="ï¼ˆ1ï¼‰å®‰è£…Erlang"></a><strong>ï¼ˆ1ï¼‰å®‰è£…Erlang</strong></h4><p>åˆ›å»ºå®‰è£…ç›®å½• <code>/opt/erlang</code> ï¼Œå¹¶ä¸‹è½½å®‰è£…åŒ…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ ~]# cd /opt</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ opt]# ls</span><br><span class="line">containerd  gitlab</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ opt]# mkdir /erlang</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ opt]# cd /erlang</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# wget http://erlang.org/download/otp_src_23.0.tar.gz</span><br><span class="line">--2020-09-21 16:20:16--  http://erlang.org/download/otp_src_23.0.tar.gz</span><br><span class="line">Resolving erlang.org (erlang.org)... 192.121.151.106</span><br><span class="line">Connecting to erlang.org (erlang.org)|192.121.151.106|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 88865562 (85M) [application/gzip]</span><br><span class="line">Saving to: â€˜otp_src_23.0.tar.gzâ€™</span><br><span class="line"></span><br><span class="line"><span class="meta"> 2%</span><span class="bash"> [=&gt;                                                                                                                   ] 1,907,973   6.64KB/s  eta 2h 40m</span></span><br></pre></td></tr></table></figure><p>å®˜ç½‘ä¸‹è½½é€Ÿåº¦å¤ªæ…¢ï¼Œè®¿é—® <a href="https://www.erlang-solutions.com/resources/download.html" target="_blank" rel="noopener">RabbitMQ - Erlang</a> é€‰æ‹©å¯¹åº”æœåŠ¡å™¨ï¼Œå¤åˆ¶ä¸‹è½½åœ°å€ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010154.png" alt></p><p>å…ˆåˆ é™¤æœªä¸‹è½½å®Œæˆçš„æ–‡ä»¶ï¼Œé‡æ–°ä¸‹è½½ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# ls</span><br><span class="line">otp_src_23.0.tar.gz</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# rm -f otp_src_23.0.tar.gz</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# ls</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# wget https://packages.erlang-solutions.com/erlang/rpm/centos/7/x86_64/esl-erlang_23.0.3-1~centos~7_amd64.rpm</span><br><span class="line">--2020-09-21 16:37:11--  https://packages.erlang-solutions.com/erlang/rpm/centos/7/x86_64/esl-erlang_23.0.3-1~centos~7_amd64.rpm</span><br><span class="line">Resolving packages.erlang-solutions.com (packages.erlang-solutions.com)... 13.227.21.48, 13.227.21.118, 13.227.21.90, ...</span><br><span class="line">Connecting to packages.erlang-solutions.com (packages.erlang-solutions.com)|13.227.21.48|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 43642720 (42M) [application/x-rpm]</span><br><span class="line">Saving to: â€˜esl-erlang_23.0.3-1~centos~7_amd64.rpmâ€™</span><br><span class="line"></span><br><span class="line"><span class="meta">100%</span><span class="bash">[====================================================================================================================&gt;] 43,642,720  23.1KB/s   <span class="keyword">in</span> 24m 34s</span></span><br><span class="line"></span><br><span class="line">2020-09-21 17:01:49 (28.9 KB/s) - â€˜esl-erlang_23.0.3-1~centos~7_amd64.rpmâ€™ saved [43642720/43642720]</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>yum install</code> å®‰è£…ç¨‹åºï¼šï¼ˆä¼šå®‰è£…åˆ°é»˜è®¤ç›®å½•ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# ls</span><br><span class="line">esl-erlang_23.0.3-1~centos~7_amd64.rpm</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# yum install esl-erlang_23.0.3-1~centos~7_amd64.rpm</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Examining esl-erlang_23.0.3-1~centos~7_amd64.rpm: esl-erlang-23.0.3-1.x86_64</span><br><span class="line">Marking esl-erlang_23.0.3-1~centos~7_amd64.rpm to be installed</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package esl-erlang.x86_64 0:23.0.3-1 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libodbc.so.2()(64bit) <span class="keyword">for</span> package: esl-erlang-23.0.3-1.x86_64</span></span><br><span class="line">Determining fastest mirrors</span><br><span class="line">base                                                                                                                                   | 3.6 kB  00:00:00     </span><br><span class="line">docker-ce-stable                                                                                                                       | 3.5 kB  00:00:00     </span><br><span class="line">epel                                                                                                                                   | 4.7 kB  00:00:00</span><br><span class="line">......</span><br><span class="line">gitlab_gitlab-ee/x86_64/primary                                                                                                        | 2.6 MB  00:00:06     </span><br><span class="line">gitlab_gitlab-ee                                                                                                                                      623/623</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">Total size: 107 M</span><br><span class="line">Total download size: 462 k</span><br><span class="line">Installed size: 107 M</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡rpmæŸ¥çœ‹è½¯ä»¶æ˜¯å¦å®‰è£…</span></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# rpm -qa | grep erlang</span><br><span class="line">esl-erlang-23.0.3-1.x86_64</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è½¯ä»¶å®‰è£…ç›®å½•</span></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# rpm -ql esl-erlang-23.0.3-1.x86_64</span><br><span class="line">/usr/bin/cpu_sup</span><br><span class="line">/usr/bin/ct_run</span><br><span class="line">/usr/bin/dialyzer</span><br><span class="line">/usr/bin/epmd</span><br><span class="line">/usr/bin/erl</span><br><span class="line">/usr/bin/erl_call</span><br><span class="line">/usr/bin/erlc</span><br><span class="line">/usr/bin/escript</span><br><span class="line">/usr/bin/etop</span><br><span class="line">/usr/bin/getop</span><br><span class="line">/usr/bin/heart</span><br><span class="line">/usr/bin/memsup</span><br><span class="line">/usr/bin/run_erl</span><br><span class="line">/usr/bin/run_test</span><br><span class="line">/usr/bin/start_erl</span><br><span class="line">/usr/bin/start_webtool</span><br><span class="line">/usr/bin/to_erl</span><br><span class="line">/usr/bin/typer</span><br><span class="line">/usr/lib/erlang/COPYRIGHT</span><br><span class="line">/usr/lib/erlang/Install</span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…ç›´æ¥æŸ¥çœ‹ç›®å½•</span></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# rpm -qal | grep erlang</span><br></pre></td></tr></table></figure><p>è‹¥å‡ºç°æŠ¥é”™ï¼šNo curses library functions found ã€‚éœ€è¦å®‰è£… ncursesï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ncurses-devel</span><br></pre></td></tr></table></figure><p>è‹¥ç»§ç»­å‡ºç°å¦‚ No XXXXX found çš„æç¤ºï¼Œå¯ä»¥è‡ªè¡Œå®‰è£…å¯¹åº”åŒ…ï¼Œä¹‹åå†æ¬¡å°è¯•å®‰è£…Erlangç›´åˆ°æç¤ºå®‰è£…å®Œæ¯•ã€‚</p><p>ä¿®æ”¹ <code>/etc/profile</code> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# cd /</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# vi /etc/profile</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:/usr/bin</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# source /etc/profile</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>erl</code> å‘½ä»¤éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ erlang]# erl -version</span><br><span class="line">Erlang (SMP,ASYNC_THREADS,HIPE) (BEAM) emulator version 11.0.3</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰å®‰è£…RabbitMQ"><a href="#ï¼ˆ2ï¼‰å®‰è£…RabbitMQ" class="headerlink" title="ï¼ˆ2ï¼‰å®‰è£…RabbitMQ"></a><strong>ï¼ˆ2ï¼‰å®‰è£…RabbitMQ</strong></h4><p>é¦–å…ˆä¸‹è½½å®‰è£…åŒ…ï¼Œå®˜ç½‘åœ°å€ï¼š<a href="http://www.rabbitmq.com/releases/rabbitmq-server/" target="_blank" rel="noopener">RabbitMQ</a> ã€‚</p><p>ç„¶åå¯ä»¥å°†RabbitMQå’ŒErlangå®‰è£…åœ¨åŒä¸€ç›®å½•ï¼ˆ/optï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# wget https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.15/rabbitmq-server-3.6.15-1.el7.noarch.rpm</span><br><span class="line">--2020-09-21 17:39:13--  https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.15/rabbitmq-server-3.6.15-1.el7.noarch.rpm</span><br><span class="line">Resolving www.rabbitmq.com (www.rabbitmq.com)... 104.20.11.224, 172.67.16.25, 104.20.10.224, ...</span><br><span class="line">Connecting to www.rabbitmq.com (www.rabbitmq.com)|104.20.11.224|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 5075721 (4.8M) [application/x-redhat-package-manager]</span><br><span class="line">Saving to: â€˜rabbitmq-server-3.6.15-1.el7.noarch.rpmâ€™</span><br><span class="line"></span><br><span class="line"><span class="meta">100%</span><span class="bash">[====================================================================================================================&gt;] 5,075,721   1.73MB/s   <span class="keyword">in</span> 2.8s   </span></span><br><span class="line"></span><br><span class="line">2020-09-21 17:39:18 (1.73 MB/s) - â€˜rabbitmq-server-3.6.15-1.el7.noarch.rpmâ€™ saved [5075721/5075721]</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# ls</span><br><span class="line">rabbitmq-server-3.6.15-1.el7.noarch.rpm</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# yum install rabbitmq-server-3.6.15-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡rpmæŸ¥çœ‹è½¯ä»¶æ˜¯å¦å®‰è£…</span></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# rpm -qa | grep rabbitmq</span><br><span class="line">rabbitmq-server-3.6.15-1.el7.noarch</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è½¯ä»¶å®‰è£…ç›®å½•</span></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# rpm -ql rabbitmq-server-3.6.15-1.el7.noarch</span><br><span class="line">/etc/logrotate.d/rabbitmq-server</span><br><span class="line">/etc/rabbitmq</span><br><span class="line">/usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server</span><br><span class="line">/usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server-ha</span><br><span class="line">......</span><br><span class="line">/usr/lib/rabbitmq/lib/rabbitmq_server-3.6.15/sbin/rabbitmq-plugins</span><br><span class="line">/usr/lib/rabbitmq/lib/rabbitmq_server-3.6.15/sbin/rabbitmq-server</span><br><span class="line">/usr/lib/rabbitmq/lib/rabbitmq_server-3.6.15/sbin/rabbitmqctl</span><br><span class="line">/usr/lib/systemd/system/rabbitmq-server.service</span><br><span class="line">/usr/lib/tmpfiles.d/rabbitmq-server.conf</span><br><span class="line">/usr/sbin/rabbitmq-plugins</span><br><span class="line">/usr/sbin/rabbitmq-server</span><br><span class="line">/usr/sbin/rabbitmqctl</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>åŒæ ·ä¿®æ”¹ <code>/etc/profile</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# vi /etc/profile</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:/usr/sbin</span><br></pre></td></tr></table></figure><p>åŒæ ·ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# source /etc/profile</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ3ï¼‰å¸è½½"><a href="#ï¼ˆ3ï¼‰å¸è½½" class="headerlink" title="ï¼ˆ3ï¼‰å¸è½½"></a><strong>ï¼ˆ3ï¼‰å¸è½½</strong></h4><p>å¸è½½å‰å…ˆåœæ‰rabbitmqæœåŠ¡ï¼Œæ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> service rabbitmq-server stop</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹rabbitmqå®‰è£…çš„ç›¸å…³åˆ—è¡¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum list | grep rabbitmq</span></span><br></pre></td></tr></table></figure><p>å¸è½½rabbitmqå·²å®‰è£…çš„ç›¸å…³å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum -y remove rabbitmq-server.noarch</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹erlangå®‰è£…çš„ç›¸å…³åˆ—è¡¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum list | grep erlang</span></span><br></pre></td></tr></table></figure><p>å¸è½½erlangå·²å®‰è£…çš„ç›¸å…³å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum -y remove erlang-*</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum -y remove erlang.x86_64</span></span><br></pre></td></tr></table></figure><h3 id="2-2-è¿è¡Œ"><a href="#2-2-è¿è¡Œ" class="headerlink" title="2.2 è¿è¡Œ"></a><strong>2.2 è¿è¡Œ</strong></h3><p>ä»»æ„å¼€å¯Shellï¼Œè¿è¡ŒRabbitMQï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> detachedå‚æ•°ä½¿RabbitMQä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼åœ¨åå°è¿è¡Œï¼Œä¸ä¼šå› ä¸ºShellçš„å…³é—­è€Œå½±å“æœåŠ¡</span></span><br><span class="line">rabbitmq-server -detached</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹RabbitMQæ˜¯å¦æ­£å¸¸å¯åŠ¨</span></span><br><span class="line">rabbitmqctl status</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼Œå½“å‰åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">rabbitmqctl cluster_status</span><br></pre></td></tr></table></figure><p>è¿è¡Œå¤±è´¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# rabbitmq-server -detached</span><br><span class="line">Warning: PID file not written; -detached was passed.</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# rabbitmqctl status</span><br><span class="line">Status of node rabbit@iZ2zeet6kto8eqx1w7sluzZ</span><br><span class="line">Error: unable to connect to node rabbit@iZ2zeet6kto8eqx1w7sluzZ: nodedown</span><br><span class="line"></span><br><span class="line">DIAGNOSTICS</span><br><span class="line">===========</span><br><span class="line"></span><br><span class="line">attempted to contact: [rabbit@iZ2zeet6kto8eqx1w7sluzZ]</span><br><span class="line"></span><br><span class="line">rabbit@iZ2zeet6kto8eqx1w7sluzZ:</span><br><span class="line">  * connected to epmd (port 4369) on iZ2zeet6kto8eqx1w7sluzZ</span><br><span class="line">  * epmd reports: node 'rabbit' not running at all</span><br><span class="line">                  no other nodes on iZ2zeet6kto8eqx1w7sluzZ</span><br><span class="line">  * suggestion: start the node</span><br><span class="line"></span><br><span class="line">current node details:</span><br><span class="line">- node name: 'rabbitmq-cli-57@iZ2zeet6kto8eqx1w7sluzZ'</span><br><span class="line">- home dir: /var/lib/rabbitmq</span><br><span class="line">- cookie hash: 63rISb5yZX97fhoF8LdjSg==</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ’é™¤æ˜¯å¦æ˜¯é˜²ç«å¢™çš„é—®é¢˜ï¼šï¼ˆä¸æ˜¯è¿™ä¸ªåŸå› ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹é˜²ç«å¢™å¼€æ”¾ç«¯å£</span></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# firewall-cmd --zone=public --list-ports</span><br><span class="line">8025/tcp 6725/tcp</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# systemctl stop firewalld.service</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# service rabbitmq-server start</span><br><span class="line">Redirecting to /bin/systemctl start rabbitmq-server.service</span><br><span class="line">Job for rabbitmq-server.service failed because the control process exited with error code. See "systemctl status rabbitmq-server.service" and "journalctl -xe" for details.</span><br></pre></td></tr></table></figure><p>åˆ é™¤ <code>/var/lib/rabbitmq/mnesia</code> ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå†é‡å¯ï¼šï¼ˆä¸æ˜¯è¿™ä¸ªåŸå› ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# cd /var/lib/rabbitmq/mnesia</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ mnesia]# ls -AF</span><br><span class="line">rabbit@iZ2zeet6kto8eqx1w7sluzZ.pid</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ mnesia]# rm -rf rabbit@iZ2zeet6kto8eqx1w7sluzZ.pid</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ mnesia]# service rabbitmq-server start</span><br><span class="line">Redirecting to /bin/systemctl start rabbitmq-server.service</span><br><span class="line">Job for rabbitmq-server.service failed because the control process exited with error code. See "systemctl status rabbitmq-server.service" and "journalctl -xe" for details.</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ /]# systemctl status rabbitmq-server.service</span><br><span class="line">â— rabbitmq-server.service - RabbitMQ broker</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: activating (auto-restart) (Result: exit-code) since Tue 2020-09-22 10:19:51 CST; 3s ago</span><br><span class="line">  Process: 27630 ExecStop=/bin/sh -c while ps -p $MAINPID &gt;/dev/null 2&gt;&amp;1; do sleep 1; done (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 27488 ExecStop=/usr/sbin/rabbitmqctl stop (code=exited, status=0/SUCCESS)</span><br><span class="line"><span class="meta">  #</span><span class="bash"> rabbitmq-serverå¯åŠ¨å¤±è´¥</span></span><br><span class="line">  Process: 27187 ExecStart=/usr/sbin/rabbitmq-server (code=exited, status=1/FAILURE)</span><br><span class="line"> Main PID: 27187 (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Sep 22 10:19:51 iZ2zeet6kto8eqx1w7sluzZ systemd[1]: Failed to start RabbitMQ broker.</span><br><span class="line">Sep 22 10:19:51 iZ2zeet6kto8eqx1w7sluzZ systemd[1]: Unit rabbitmq-server.service entered failed state.</span><br><span class="line">Sep 22 10:19:51 iZ2zeet6kto8eqx1w7sluzZ systemd[1]: rabbitmq-server.service failed.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ mnesia]# journalctl -xe</span><br><span class="line">Sep 22 10:26:04 iZ2zeet6kto8eqx1w7sluzZ rabbitmq-server[8731]: /var/log/rabbitmq/rabbit@iZ2zeet6kto8eqx1w7sluzZ-sasl.log</span><br><span class="line">Sep 22 10:26:04 iZ2zeet6kto8eqx1w7sluzZ rabbitmq-server[8731]: Stack trace:</span><br><span class="line">Sep 22 10:26:04 iZ2zeet6kto8eqx1w7sluzZ rabbitmq-server[8731]: []</span><br><span class="line">Sep 22 10:26:05 iZ2zeet6kto8eqx1w7sluzZ rabbitmq-server[8731]: &#123;"init terminating in do_boot",noproc&#125;</span><br><span class="line">Sep 22 10:26:05 iZ2zeet6kto8eqx1w7sluzZ rabbitmq-server[8731]: init terminating in do_boot (noproc)</span><br><span class="line">Sep 22 10:26:05 iZ2zeet6kto8eqx1w7sluzZ rabbitmq-server[8731]: Crash dump is being written to: erl_crash.dump...done</span><br><span class="line">Sep 22 10:26:05 iZ2zeet6kto8eqx1w7sluzZ systemd[1]: rabbitmq-server.service: main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: Stopping and halting node rabbit@iZ2zeet6kto8eqx1w7sluzZ</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: Error: unable to connect to node rabbit@iZ2zeet6kto8eqx1w7sluzZ: nodedown</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: DIAGNOSTICS</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: ===========</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: attempted to contact: [rabbit@iZ2zeet6kto8eqx1w7sluzZ]</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: rabbit@iZ2zeet6kto8eqx1w7sluzZ:</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: * connected to epmd (port 4369) on iZ2zeet6kto8eqx1w7sluzZ</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: * epmd reports: node 'rabbit' not running at all</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: no other nodes on iZ2zeet6kto8eqx1w7sluzZ</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: * suggestion: start the node</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: current node details:</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: - node name: 'rabbitmq-cli-55@iZ2zeet6kto8eqx1w7sluzZ'</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: - home dir: .</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ rabbitmqctl[9029]: - cookie hash: 63rISb5yZX97fhoF8LdjSg==</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ systemd[1]: Failed to start RabbitMQ broker.</span><br><span class="line">-- Subject: Unit rabbitmq-server.service has failed</span><br><span class="line">-- Defined-By: systemd</span><br><span class="line">-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel</span><br><span class="line">-- </span><br><span class="line">-- Unit rabbitmq-server.service has failed.</span><br><span class="line">-- </span><br><span class="line">-- The result is failed.</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ systemd[1]: Unit rabbitmq-server.service entered failed state.</span><br><span class="line">Sep 22 10:26:06 iZ2zeet6kto8eqx1w7sluzZ systemd[1]: rabbitmq-server.service failed.</span><br><span class="line">lines 1389-1419/1419 (END)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°è¯•é‡å¯</span></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ sbin]# rabbitmq-server restart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BOOT FAILED</span><br><span class="line">===========</span><br><span class="line"></span><br><span class="line">Error description:</span><br><span class="line">   noproc</span><br><span class="line"></span><br><span class="line">Log files (may contain more information):</span><br><span class="line">   /var/log/rabbitmq/rabbit@iZ2zeet6kto8eqx1w7sluzZ.log</span><br><span class="line">   /var/log/rabbitmq/rabbit@iZ2zeet6kto8eqx1w7sluzZ-sasl.log</span><br><span class="line"></span><br><span class="line">Stack trace:</span><br><span class="line">   []</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 22-Sep-2020::20:41:05.655469 ===</span><br><span class="line">Error description:</span><br><span class="line">   noproc</span><br><span class="line"></span><br><span class="line">Log files (may contain more information):</span><br><span class="line">   /var/log/rabbitmq/rabbit@iZ2zeet6kto8eqx1w7sluzZ.log</span><br><span class="line">   /var/log/rabbitmq/rabbit@iZ2zeet6kto8eqx1w7sluzZ-sasl.log</span><br><span class="line"></span><br><span class="line">Stack trace:</span><br><span class="line">   []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;"init terminating in do_boot",noproc&#125;</span><br><span class="line">init terminating in do_boot (noproc)</span><br><span class="line"></span><br><span class="line">Crash dump is being written to: erl_crash.dump...done</span><br></pre></td></tr></table></figure><p>æ ¹æ®æç¤º <code>noproc</code> è€ƒè™‘æ˜¯å¦æ˜¯ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œ<a href="https://www.rabbitmq.com/which-erlang.html" target="_blank" rel="noopener">rabbitmq - erlang</a> å®˜ç½‘æŸ¥è¯¢ç¡®è®¤æ˜¯å¦åŒ¹é…ï¼š</p><ul><li>Erlangï¼š23.0.3</li><li>RabbitMQï¼š3.6.15</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010155.png" alt></p><p>å¸è½½å½“å‰RabbitMQï¼Œå†é‡æ–°ä¸‹è½½ä¸€ä¸ª3.8.8ç‰ˆæœ¬çš„RabbitMQï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.8/rabbitmq-server-3.8.8-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure><p>é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸‹è½½GitHubå®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œé€‰æ‹©ç”¨Dockeræ‹‰å–é•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ ~]# service docker restart</span><br><span class="line">Redirecting to /bin/systemctl restart docker.service</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ ~]# docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management</span><br><span class="line">Unable to find image 'rabbitmq:3-management' locally</span><br><span class="line">3-management: Pulling from library/rabbitmq</span><br><span class="line">5d9821c94847: Downloading [=======================&gt;                           ]  12.53MB/26.7MB</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>ä»ç„¶å¾ˆæ…¢ï¼Œè¿˜æ˜¯ç›´æ¥ä¸‹è½½RPMæ–‡ä»¶ï¼ŒåŠ ä¸Šæ–­ç‚¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.8/rabbitmq-server-3.8.8-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure><p>ä¸‹è½½æˆåŠŸåï¼Œé‡æ–°å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# ls -AF</span><br><span class="line">rabbitmq-server-3.8.8-1.el7.noarch.rpm</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ rabbitmq]# yum install rabbitmq-server-3.8.8-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨ï¼š(ç»ˆäºæˆåŠŸ)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ ~]# rabbitmq-server -detached</span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ ~]# rabbitmqctl status</span><br><span class="line">Status of node rabbit@iZ2zeet6kto8eqx1w7sluzZ ...</span><br><span class="line">Runtime</span><br><span class="line"></span><br><span class="line">OS PID: 4074</span><br><span class="line">OS: Linux</span><br><span class="line">Uptime (seconds): 89</span><br><span class="line">Is under maintenance?: false</span><br><span class="line">RabbitMQ version: 3.8.8</span><br><span class="line">Node name: rabbit@iZ2zeet6kto8eqx1w7sluzZ</span><br><span class="line">Erlang configuration: Erlang/OTP 23 [erts-11.0.3] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:64] [hipe]</span><br><span class="line">Erlang processes: 275 used, 1048576 limit</span><br><span class="line">Scheduler run queue: 1</span><br><span class="line">Cluster heartbeat timeout (net_ticktime): 60</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span></span><br><span class="line">[root@iZ2zeet6kto8eqx1w7sluzZ ~]# rabbitmqctl cluster_status</span><br><span class="line">Cluster status of node rabbit@iZ2zeet6kto8eqx1w7sluzZ ...</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h3 id="2-3-ç”Ÿäº§å’Œæ¶ˆè´¹æ¶ˆæ¯"><a href="#2-3-ç”Ÿäº§å’Œæ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="2.3 ç”Ÿäº§å’Œæ¶ˆè´¹æ¶ˆæ¯"></a><strong>2.3 ç”Ÿäº§å’Œæ¶ˆè´¹æ¶ˆæ¯</strong></h3><p>RabbitMQçš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ <code>guest</code>ï¼Œæ­¤è´¦æˆ·åªèƒ½æœ¬åœ°è®¿é—®ï¼Œè¿œç¨‹ç½‘ç»œè®¿é—®ä¼šå—é™ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é¦–å…ˆ<strong>æ·»åŠ ä¸€ä¸ªç”¨æˆ·</strong>ï¼Œå¹¶<strong>è®¾ç½®è®¿é—®æƒé™</strong>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ–°å¢ç”¨æˆ·</span></span><br><span class="line">rabbitmqctl add_user root root</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ‰€æœ‰æƒé™</span></span><br><span class="line">rabbitmqctl set_permissions -p / root ".*" ".*" ".*"</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®ç®¡ç†å‘˜è§’è‰²</span></span><br><span class="line">rabbitmqctl set_user_tags root administrator</span><br></pre></td></tr></table></figure><p>è‹¥åœ¨ä½¿ç”¨RabbitMQçš„è¿‡ç¨‹ä¸­æœ‰ <code>com.rabbitmq.client.AuthenticationFailureException: ACCESS_REFUSED - Login was refused using authentication mechanism PLAIN</code> ç±»ä¼¼æŠ¥é”™ï¼Œå¾ˆå¯èƒ½å°±æ˜¯è´¦æˆ·çš„é—®é¢˜ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> com.rabbitmq.client.AuthenticationFailureException: ACCESS_REFUSED - Login was refused using authentication mechanism PLAIN. <span class="keyword">For</span> details see the broker logfile.</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">ERROR</span> com.rabbitmq.client.impl.ForgivingExceptionHandler - An unexpected<span class="built_in"> connection </span>driver <span class="builtin-name">error</span> occured</span><br><span class="line">java.net.SocketException: Socket Closed</span><br></pre></td></tr></table></figure><p>åœ¨Javaé¡¹ç›®ä¸­å¼•å…¥RabbitMQå®¢æˆ·ç«¯çš„Mavenä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€ä¸€æ¡æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitProducer</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">"exchange_demo"</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ROUTING_KEY = <span class="string">"routingkey_demo"</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"queue_demo"</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IP_ADDRESS = <span class="string">"xxx.xxx.xxx.xxx"</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PORT = <span class="number">5672</span>;<span class="comment">//RabbitMQ æœåŠ¡ç«¯é»˜è®¤ç«¯å£å·ä¸º 5672</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">                TimeoutException, InterruptedException </span>&#123;</span><br><span class="line">                ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">                factory.setHost(IP_ADDRESS);</span><br><span class="line">                factory.setPort(PORT);</span><br><span class="line">                factory.setUsername(<span class="string">"root"</span>);</span><br><span class="line">                factory.setPassword(<span class="string">"root"</span>);</span><br><span class="line">                Connection connection = factory.newConnection(); <span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">                Channel channel = connection.createChannel(); <span class="comment">//åˆ›å»ºä¿¡é“</span></span><br><span class="line">                <span class="comment">// åˆ›å»ºä¸€ä¸ª type direct ã€æŒä¹…åŒ–çš„ã€éè‡ªåŠ¨åˆ é™¤çš„äº¤æ¢å™¨</span></span><br><span class="line">                channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">"direct"</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">                <span class="comment">//åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–ã€éæ’ä»–çš„ã€éè‡ªåŠ¨åˆ é™¤çš„é˜Ÿåˆ—</span></span><br><span class="line">                channel.queueDeclare(QUEUE_NAME, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">                <span class="comment">//å°†äº¤æ¢å™¨ä¸é˜Ÿåˆ—é€šè¿‡è·¯ç”±é”®ç»‘å®š</span></span><br><span class="line">                channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, ROUTING_KEY);</span><br><span class="line">                <span class="comment">//å‘é€ä¸€æ¡æŒä¹…åŒ–çš„æ¶ˆæ¯ hello world !</span></span><br><span class="line">                String message = <span class="string">"Hello World!"</span>;</span><br><span class="line">                channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY,</span><br><span class="line">                        MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class="line">                        message.getBytes());</span><br><span class="line">                <span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">                channel.close();</span><br><span class="line">                connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯æ¶ˆè´¹è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"queue_demo"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IP_ADDRESS = <span class="string">"xxx.xxx.xxx.xxx"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PORT = <span class="number">5672</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">            TimeoutException, InterruptedException </span>&#123;</span><br><span class="line">        Address[] addresses = <span class="keyword">new</span> Address[]&#123;</span><br><span class="line">                <span class="keyword">new</span> Address(IP_ADDRESS, PORT)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        factory.setPassword(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œçš„è¿æ¥æ–¹å¼ä¸ç”Ÿäº§è€…çš„ demo ç•¥æœ‰ä¸åŒï¼Œæ³¨æ„è¾¨åˆ«åŒºåˆ«</span></span><br><span class="line">        Connection connection = factory.newConnection(addresses); <span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="keyword">final</span> Channel channel = connection.createChannel(); <span class="comment">//åˆ›å»ºä¿¡é“</span></span><br><span class="line">        channel.basicQos(<span class="number">64</span>); <span class="comment">//è®¾ç½®å®¢æˆ·ç«¯æœ€å¤šæ¥æ”¶æœªè¢« ack çš„æ¶ˆæ¯çš„ä¸ªæ•°</span></span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       Envelope envelope,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       AMQP.BasicProperties properties,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"recv message : "</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                channel.basicAck(envelope.getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, consumer);</span><br><span class="line">        <span class="comment">//ç­‰å¾…å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹å å…³é—­èµ„æº</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°æ‰“å°ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recv message : <span class="type">Hello</span> World!</span><br></pre></td></tr></table></figure><p>æ­¤å¤„é‡‡ç”¨ç»§æ‰¿ <code>DefaultConsumer</code> çš„æ–¹å¼æ¥å®ç°æ¶ˆè´¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>QueueingConsumer</code> æ¥å®ç°ï¼Œä½†ä¼šæœ‰äº›éšæ‚£ï¼Œå¹¶ä¸”è¿™ç§å®ç°å·²è¢«åºŸå¼ƒã€‚</p><hr><h2 id="ç¬¬ä¸‰èŠ‚-Rabbitå…¥é—¨"><a href="#ç¬¬ä¸‰èŠ‚-Rabbitå…¥é—¨" class="headerlink" title="ç¬¬ä¸‰èŠ‚ Rabbitå…¥é—¨"></a><strong>ç¬¬ä¸‰èŠ‚ Rabbitå…¥é—¨</strong></h2><p>RabbitMQçš„æ¨¡å‹æ¶æ„æ˜¯ä»€ä¹ˆï¼ŸAMQPåè®®æ˜¯ä»€ä¹ˆï¼Ÿä¸¤è€…é—´åˆæœ‰ä½•ç§è”ç³»ï¼Ÿæ¶ˆæ¯ä»ç”Ÿäº§è€…å‘å‡ºåˆ°æ¶ˆè´¹è€…æ¶ˆè´¹çš„è¿‡ç¨‹è¦ç»å†ä»€ä¹ˆï¼Ÿ</p><h3 id="3-1-RabbitMQåŸºæœ¬æ¦‚å¿µ"><a href="#3-1-RabbitMQåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.1 RabbitMQåŸºæœ¬æ¦‚å¿µ"></a><strong>3.1 RabbitMQåŸºæœ¬æ¦‚å¿µ</strong></h3><h4 id="ï¼ˆ1ï¼‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹"><a href="#ï¼ˆ1ï¼‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹" class="headerlink" title="ï¼ˆ1ï¼‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹"></a><strong>ï¼ˆ1ï¼‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹</strong></h4><p>RabbitMQ æ•´ä½“ä¸Šæ˜¯ä¸€ä¸ª<strong>ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å‹</strong>ï¼Œä¸»è¦<strong>è´Ÿè´£æ¥æ”¶ã€å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯</strong>ã€‚å¯ä»¥æŠŠæ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹æƒ³è±¡æˆå½“ä½ å°†ä¸€ä¸ªåŒ…è£¹é€åˆ°é‚®å±€ï¼Œé‚®å±€ä¼šæš‚å­˜å¹¶æœ€ç»ˆå°†é‚®ä»¶é€šè¿‡é‚®é€’å‘˜é€åˆ°æ”¶ä»¶äººçš„æ‰‹ä¸Šï¼ŒRabbitMQå°±å¥½æ¯”ç”±é‚®å±€ã€é‚®ç®±å’Œé‚®é€’å‘˜ç»„æˆçš„ä¸€ä¸ªç³»ç»Ÿã€‚</p><p>ä»è®¡ç®—æœºæœ¯è¯­å±‚é¢æ¥è¯´ï¼Œ RabbitMQæ¨¡å‹æ›´åƒæ˜¯ä¸€ç§<strong>äº¤æ¢æœºæ¨¡å‹</strong>ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010143.png" alt></p><p>æ¶ˆæ¯ä¸€èˆ¬åŒ…å«2ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><strong>æ¶ˆæ¯ä½“</strong>ï¼šæ¶ˆæ¯ä½“ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º payload ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¶ˆæ¯ä½“ä¸€èˆ¬æ˜¯ä¸€ä¸ªå¸¦æœ‰ä¸šåŠ¡é€»è¾‘ç»“æ„çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ª JSON å­—ç¬¦ä¸²ã€‚å½“ç„¶å¯ä»¥è¿›ä¸€æ­¥å¯¹è¿™ä¸ªæ¶ˆæ¯ä½“è¿›è¡Œåºåˆ—åŒ–æ“ä½œã€‚</li><li><strong>æ ‡ç­¾</strong>ï¼ˆLabelï¼‰ï¼šç”¨æ¥è¡¨è¿°è¿™æ¡æ¶ˆæ¯ï¼Œæ¯”å¦‚ä¸€ä¸ªäº¤æ¢å™¨çš„åç§°å’Œä¸€ä¸ªè·¯ç”±é”®ã€‚</li></ul><p>å¤§è‡´æµç¨‹ï¼š</p><ul><li><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong>å°†ä¸šåŠ¡æ•°æ®å°è£…ï¼ˆåºåˆ—åŒ–ï¼‰æˆæ¶ˆæ¯ï¼ˆæŒ‡å®šExchangeå’ŒRoutingKeyç­‰ï¼‰ï¼ŒæŠŠæ¶ˆæ¯äº¤ç”±RabbitMQï¼Œå³å‘é€ç»™Broker ï¼ˆAMQPåè®®ä¸­å¯¹åº”å‘½ä»¤ä¸ºBasic.Publishï¼‰ã€‚</li><li><strong>Broker ï¼ˆæ¶ˆæ¯ä¸­é—´ä»¶çš„æœåŠ¡èŠ‚ç‚¹ï¼‰</strong>ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥å°† RabbitMQ Broker çœ‹ä½œä¸€å° RabbitMQ æœåŠ¡å™¨ã€‚RabbitMQä¹‹åä¼šæ ¹æ®æ ‡ç­¾æŠŠæ¶ˆæ¯å‘é€ç»™æ„Ÿå…´è¶£çš„<strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ã€‚</li><li>æ¶ˆè´¹è€…è¿æ¥åˆ° RabbitMQ æœåŠ¡å™¨ï¼Œå¹¶è®¢é˜…åˆ°é˜Ÿåˆ—ä¸Šã€‚å½“æ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œ<strong>åªæ˜¯æ¶ˆè´¹æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</strong>ï¼ˆ payload ï¼‰ã€‚åœ¨æ¶ˆæ¯è·¯ç”±çš„è¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯çš„æ ‡ç­¾ä¼šä¸¢å¼ƒï¼Œ<strong>å­˜å…¥åˆ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åªæœ‰æ¶ˆæ¯ä½“</strong>ï¼Œæ¶ˆè´¹è€…ä¹Ÿåªä¼šæ¶ˆè´¹åˆ°æ¶ˆæ¯ä½“ï¼Œä¹Ÿå°±<strong>ä¸çŸ¥é“æ¶ˆæ¯çš„ç”Ÿäº§è€…æ˜¯è°</strong>ï¼Œå½“ç„¶æ¶ˆè´¹è€…ä¹Ÿä¸éœ€è¦çŸ¥é“ã€‚</li><li>æ¶ˆè´¹è€…å—åˆ°æ¶ˆæ¯ä½“åï¼ˆAMQPåè®®ä¸­å¯¹åº”å‘½ä»¤ä¸ºBasic.Consumeæˆ–Basic.Getï¼‰è¿›è¡Œååºåˆ—åŒ–ï¼Œå¾—åˆ°å¯¹åº”çš„ä¸šåŠ¡æ•°æ®ï¼Œå¹¶è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚</li></ul><p>æ¶ˆè´¹è€…è¿›è¡Œä¸šåŠ¡å¤„ç†å¯ä»¥ä¸å’Œæ¥æ”¶æ¶ˆæ¯çš„é€»è¾‘ä½¿ç”¨åŒä¸€çº¿ç¨‹ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å»æ¥æ”¶æ¶ˆæ¯å­˜å…¥å†…å­˜ï¼ˆ<code>BlockingQueue</code>ï¼‰ï¼Œä½¿ç”¨å¦ä¸€ä¸ªçº¿ç¨‹ä»å†…å­˜è¯»å–æ•°æ®ï¼Œè¿™æ ·å¯ä»¥è¿›ä¸€æ­¥è§£è€¦ï¼Œæé«˜æ•´ä½“å¤„ç†æ•ˆç‡ã€‚ </p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010144.png" alt></p><h4 id="ï¼ˆ2ï¼‰é˜Ÿåˆ—"><a href="#ï¼ˆ2ï¼‰é˜Ÿåˆ—" class="headerlink" title="ï¼ˆ2ï¼‰é˜Ÿåˆ—"></a><strong>ï¼ˆ2ï¼‰é˜Ÿåˆ—</strong></h4><p><strong>é˜Ÿåˆ—</strong>ï¼ˆQueueï¼‰æ˜¯ RabbitMQ çš„å†…éƒ¨å¯¹è±¡ï¼Œç”¨æ¥<strong>å­˜å‚¨æ¶ˆæ¯</strong>ã€‚<strong>æ¶ˆæ¯åªèƒ½å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­</strong>ï¼Œè¿™ä¸Kafkaè¿™ç§æ¶ˆæ¯ä¸­é—´ä»¶ç›¸åï¼ˆ<strong>Kafkaæ¶ˆæ¯å­˜å‚¨åœ¨ä¸»é¢˜topicé€»è¾‘å±‚é¢</strong>ï¼‰ï¼Œç›¸å¯¹åº”çš„é˜Ÿåˆ—é€»è¾‘åªæ˜¯ä¸»é¢˜å®é™…å­˜å‚¨æ–‡ä»¶ä¸­çš„ä½ç§»æ ‡è¯†ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010145.png" alt></p><p>å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šè¢«<strong>å¹³å‡åˆ†æ‘Š</strong>ï¼ˆRound-Robinï¼Œå³è½®è¯¢ï¼‰ç»™å¤šä¸ªæ¶ˆè´¹è€…å¤„ç†ï¼Œ<strong>ä¸æ˜¯æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ°æ‰€æœ‰çš„æ¶ˆæ¯å¹¶å¤„ç†</strong>ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010146.png" alt></p><p>RabbitMQ<strong>ä¸æ”¯æŒé˜Ÿåˆ—å±‚é¢çš„å¹¿æ’­æ¶ˆè´¹</strong>ï¼Œå¦‚æœéœ€è¦åªèƒ½è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</p><h4 id="ï¼ˆ3ï¼‰äº¤æ¢å™¨ã€è·¯ç”±é”®ã€ç»‘å®šã€äº¤æ¢å™¨ç±»å‹"><a href="#ï¼ˆ3ï¼‰äº¤æ¢å™¨ã€è·¯ç”±é”®ã€ç»‘å®šã€äº¤æ¢å™¨ç±»å‹" class="headerlink" title="ï¼ˆ3ï¼‰äº¤æ¢å™¨ã€è·¯ç”±é”®ã€ç»‘å®šã€äº¤æ¢å™¨ç±»å‹"></a><strong>ï¼ˆ3ï¼‰äº¤æ¢å™¨ã€è·¯ç”±é”®ã€ç»‘å®šã€äº¤æ¢å™¨ç±»å‹</strong></h4><p>ä¸Šé¢æˆ‘ä»¬ç†è§£ä¸ºç”Ÿäº§è€…å°†æ¶ˆæ¯ç›´æ¥æŠ•é€’åˆ°é˜Ÿåˆ—ä¸Šï¼Œä½†å…¶å®å¹¶éå¦‚æ­¤ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010147.png" alt></p><p><strong>äº¤æ¢å™¨</strong>ï¼ˆExchangeï¼‰ï¼Œç”Ÿäº§è€…ä¼šå…ˆå°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢å™¨ï¼Œäº¤æ¢å™¨è´Ÿè´£å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ä¸­ã€‚è‹¥è·¯ç”±ä¸åˆ°ï¼Œå¯ä»¥è¿”å›ç»™ç”Ÿäº§è€…æˆ–ç›´æ¥ä¸¢å¼ƒã€‚</p><p><strong>è·¯ç”±é”®</strong>ï¼ˆRoutingKeyï¼‰ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™äº¤æ¢å™¨æ—¶ï¼Œä¼šæŒ‡å®šä¸€ä¸ªè·¯ç”±é”®ï¼Œç”¨æ¥æŒ‡å®šæ¶ˆæ¯çš„è·¯ç”±è§„åˆ™ï¼Œå¯ä»¥å†³å®šæ¶ˆæ¯æµå‘å“ªé‡Œã€‚è·¯ç”±é”®éœ€è¦ä¸<strong>äº¤æ¢å™¨ç±»å‹</strong>å’Œ<strong>ç»‘å®šé”®</strong>ï¼ˆBindingKeyï¼‰è”åˆä½¿ç”¨ã€‚</p><p><strong>ç»‘å®šé”®</strong>ï¼ˆBindingKeyï¼‰ï¼Œå±äºè·¯ç”±é”®çš„ä¸€ç§ï¼Œé€šè¿‡ç»‘å®šé”®å°†äº¤æ¢å™¨å’Œé˜Ÿåˆ—å…³è”èµ·æ¥ã€‚<strong>æŸäº›æƒ…å½¢ä¸‹ç»‘å®šé”®ä¸è·¯ç”±é”®å¯ä»¥çœ‹ä½œåŒä¸€ä¸ªä¸œè¥¿ã€‚</strong></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010148.png" alt></p><p>å¯ä»¥è¿™æ ·åŒºåˆ«è·¯ç”±é”®å’Œç»‘å®šé”®ï¼š</p><ul><li>ä½¿ç”¨ç»‘å®šæ—¶ï¼Œéœ€è¦çš„è·¯ç”±é”®æ˜¯ BindingKey ã€‚<ul><li>æ¶‰åŠçš„å®¢æˆ·ç«¯æ–¹æ³•ï¼š<code>channel.exchangeBind</code> ã€<code>channel.queueBind</code> </li><li>å¯¹åº”AMQPå‘½ä»¤ï¼š<code>Exchange.Bind</code> ã€<code>Queue.Bind</code> ã€‚</li></ul></li><li>å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦çš„è·¯ç”±é”®æ˜¯ RoutingKey ã€‚<ul><li>æ¶‰åŠçš„å®¢æˆ·ç«¯æ–¹æ³•ï¼š<code>channel.basicPublish</code> </li><li>å¯¹åº”AMQPå‘½ä»¤ï¼š<code>Basic.Publish</code> </li></ul></li></ul><p><strong>äº¤æ¢å™¨ç±»å‹</strong>ï¼š</p><ul><li><p><strong>fanout</strong>ï¼šä¼šæŠŠå‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯è·¯ç”±åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ä¸­ã€‚</p></li><li><p><strong>direct</strong>ï¼šä¼šæŠŠæ¶ˆæ¯è·¯ç”±åˆ°BindingKeyå’ŒRoutingKeyå®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—ä¸­ã€‚</p><p>å¦‚ä¸‹æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·¯ç”±é”®ä¸ºwarningï¼Œæ¶ˆæ¯ä¼šè·¯ç”±åˆ°Queue1å’ŒQueue2</span></span><br><span class="line">channel.basicPublish(EXCHANGE_NAME, <span class="string">"warning"</span>, MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class="line">message.getBytes());</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010149.png" alt></p><p>è‹¥è®¾ç½®è·¯ç”±é”®ä¸ºâ€œinfoâ€æˆ–â€œdebugâ€ï¼Œæ¶ˆæ¯åªä¼šè·¯ç”±åˆ°Queue2ã€‚</p></li><li><p><strong>topic</strong>ï¼šåœ¨åŒ¹é…è§„åˆ™ä¸Šç›¸æ¯”directè¿›è¡Œäº†æ‰©å±•ï¼Œä¹Ÿæ˜¯æŠŠæ¶ˆæ¯è·¯ç”±åˆ°BindingKeyå’ŒRoutingKeyåŒ¹é…çš„é˜Ÿåˆ—ä¸­ï¼Œä½†åŒ¹é…è§„åˆ™åŒ…æ‹¬ï¼š</p><ul><li>RoutingKeyå’ŒBindingKeyä¸º <code>.</code> åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œå¦‚ <code>com.rabbitmq.client</code> ã€‚</li><li>BindingKeyä¸­å¯ä»¥å­˜ç€ä¸¤ä¸ªç‰¹æ®Šå­—ç¬¦ä¸² <code>*</code> å’Œ <code>#</code> ï¼Œç”¨äºæ¨¡ç³ŠåŒ¹é…ï¼Œ<code>*</code> ç”¨äºåŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ<code>#</code> ç”¨äºåŒ¹é…å¤šè§„æ ¼å•è¯ã€‚</li></ul><p>å¦‚ä¸‹æ¡ˆä¾‹ï¼š</p><ul><li>è·¯ç”±é”® <code>com.rabbitmq.client</code> çš„æ¶ˆæ¯åŒæ—¶è·¯ç”±åˆ°Queue1å’ŒQueue2ï¼›</li><li>è·¯ç”±é”® <code>com.hidden.client</code> çš„æ¶ˆæ¯åªè·¯ç”±åˆ°Queue2ï¼›</li><li>è·¯ç”±é”® <code>com.hidden.demo</code> çš„æ¶ˆæ¯åªè·¯ç”±åˆ°Queue2ï¼›</li><li>è·¯ç”±é”® <code>java.rabbitmq.demo</code> çš„æ¶ˆæ¯åªè·¯ç”±åˆ°Queue1ï¼›</li><li>è·¯ç”±é”® <code>java.util.concurrent</code> çš„æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–è¿”å›ç»™ç”Ÿäº§è€…ï¼›</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010150.png" alt></p></li><li><p><strong>headers</strong>ï¼šä¸ä¾èµ–äºè·¯ç”±é”®çš„åŒ¹é…è§„åˆ™æ¥è·¯ç”±æ¶ˆæ¯ï¼Œè€Œæ˜¯æ ¹æ®å‘é€çš„æ¶ˆæ¯å†…å®¹ä¸­çš„headerså±æ€§è¿›è¡ŒåŒ¹é…ã€‚åœ¨ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢å™¨æ—¶ä¼šåˆ¶å®šä¸€ç»„é”®å€¼å¯¹ï¼Œæ¶ˆæ¯åˆ°äº¤æ¢å™¨æ—¶ä¹Ÿæœ‰é”®å€¼å¯¹å½¢å¼çš„headersï¼Œå¯¹æ¯”è‹¥å®Œå…¨åŒ¹é…å°±è·¯ç”±åˆ°æ­¤é˜Ÿåˆ—ã€‚<strong>è¿™ä¸€ç±»å‹æ€§èƒ½å¾ˆå·®ä¸”ä¸å®ç”¨</strong>ã€‚</p></li></ul><h4 id="ï¼ˆ4ï¼‰RabbitMQè¿è½¬æµç¨‹"><a href="#ï¼ˆ4ï¼‰RabbitMQè¿è½¬æµç¨‹" class="headerlink" title="ï¼ˆ4ï¼‰RabbitMQè¿è½¬æµç¨‹"></a><strong>ï¼ˆ4ï¼‰RabbitMQè¿è½¬æµç¨‹</strong></h4><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼ˆæœ€åˆçŠ¶æ€ï¼‰ï¼š</p><ol><li>ç”Ÿäº§è€…è¿æ¥åˆ° RabbitMQ Broker å»ºç«‹ä¸€ä¸ª<strong>è¿æ¥</strong>ï¼ˆConnectionï¼‰ï¼Œå¼€å¯ä¸€ä¸ª<strong>ä¿¡é“</strong>ï¼ˆChannelï¼‰ ï¼›</li><li>ç”Ÿäº§è€…å£°æ˜ä¸€ä¸ªäº¤æ¢å™¨ï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§ï¼Œæ¯”å¦‚äº¤æ¢æœºç±»å‹ã€æ˜¯å¦æŒä¹…åŒ–ç­‰ï¼›</li><li>ç”Ÿäº§è€…å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—äº•è®¾ç½®ç›¸å…³å±æ€§ï¼Œæ¯”å¦‚æ˜¯å¦æ’ä»–ã€æ˜¯å¦æŒä¹…åŒ–ã€æ˜¯å¦è‡ªåŠ¨åˆ é™¤ç­‰ï¼›</li><li>ç”Ÿäº§è€…é€šè¿‡è·¯ç”±é”®å°†äº¤æ¢å™¨å’Œé˜Ÿåˆ—ç»‘å®šèµ·æ¥ï¼›</li><li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯è‡³ RabbitMQ Brokerï¼Œå…¶ä¸­åŒ…å«è·¯ç”±é”®ã€äº¤æ¢å™¨ç­‰ä¿¡æ¯ï¼›</li><li>ç›¸åº”çš„äº¤æ¢å™¨æ ¹æ®æ¥æ”¶åˆ°çš„è·¯ç”±é”®æŸ¥æ‰¾ç›¸åŒ¹é…çš„é˜Ÿåˆ—ï¼›</li><li>å¦‚æœæ‰¾åˆ°ï¼Œåˆ™å°†ä»ç”Ÿäº§è€…å‘é€è¿‡æ¥çš„æ¶ˆæ¯å­˜å…¥ç›¸åº”çš„é˜Ÿåˆ—ä¸­ã€‚</li><li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æ ¹æ®ç”Ÿäº§è€…é…ç½®çš„å±æ€§é€‰æ‹©ä¸¢å¼ƒè¿˜æ˜¯å›é€€ç»™ç”Ÿäº§è€…ã€‚</li><li>å…³é—­ä¿¡é“ã€‚</li><li>å…³é—­è¿æ¥ã€‚ </li></ol><p>æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯çš„è¿‡ç¨‹ï¼š </p><ol><li>æ¶ˆè´¹è€…è¿æ¥åˆ° RabbitMQ Broker ï¼Œå»ºç«‹ä¸€ä¸ª<strong>è¿æ¥</strong>ï¼ˆConnectionï¼‰ï¼Œå¼€å¯ä¸€ä¸ª<strong>ä¿¡é“</strong>ï¼ˆChannel)ï¼›</li><li>æ¶ˆè´¹è€…å‘ RabbitMQ Broker è¯·æ±‚æ¶ˆè´¹ç›¸åº”é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šè®¾ç½®ç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œä»¥åŠåšä¸€äº›å‡†å¤‡å·¥ä½œã€‚ </li><li>ç­‰å¾… RabbitMQ Broker å›åº”å¹¶æŠ•é€’ç›¸åº”é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ã€‚</li><li>æ¶ˆè´¹è€…ç¡®è®¤ï¼ˆackï¼‰æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚</li><li>RabbitMQ ä»é˜Ÿåˆ—ä¸­åˆ é™¤ç›¸åº”å·±ç»è¢«ç¡®è®¤çš„æ¶ˆæ¯ã€‚</li><li>å…³é—­ä¿¡é“ã€‚</li><li>å…³é—­è¿æ¥ã€‚</li></ol><h4 id="ï¼ˆ5ï¼‰è¿æ¥å’Œä¿¡é“"><a href="#ï¼ˆ5ï¼‰è¿æ¥å’Œä¿¡é“" class="headerlink" title="ï¼ˆ5ï¼‰è¿æ¥å’Œä¿¡é“"></a><strong>ï¼ˆ5ï¼‰è¿æ¥å’Œä¿¡é“</strong></h4><p><strong>è¿æ¥</strong>ï¼ˆConnectionï¼‰ï¼Œå³ä¸€æ¡TCPè¿æ¥ã€‚å½“TCPè¿æ¥å»ºç«‹èµ·æ¥ï¼Œå®¢æˆ·ç«¯ç´§æ¥ç€åˆ›å»ºä¸€ä¸ªAMQP<strong>ä¿¡é“</strong>ï¼ˆChannel)ï¼Œæ¯ä¸ªä¿¡é“éƒ½ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„IDã€‚ä¿¡é“æ˜¯è™šæ‹Ÿé“¾æ¥ï¼Œ<strong>RabbitMQå¤„ç†æ¯æ¡AMQPæŒ‡ä»¤éƒ½æ˜¯é€šè¿‡ä¿¡é“å®Œæˆ</strong>ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010151.png" alt></p><p><strong>ä¿¡é“çš„ä½œç”¨ï¼Ÿ</strong></p><p>ä¸€ä¸ªåº”ç”¨ç¨‹åºä¼šæœ‰å¾ˆå¤šçº¿ç¨‹éœ€è¦ä»MQä¸­æ¶ˆè´¹æ¶ˆæ¯æˆ–ç”Ÿäº§æ¶ˆæ¯ï¼Œæ‰€ä»¥è¦å»ºç«‹å¾ˆå¤šTCPè¿æ¥ã€‚å¯¹äºæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œ<strong>å»ºç«‹å’Œé”€æ¯TCPè¿æ¥éƒ½éœ€è¦æ˜‚è´µçš„å¼€é”€</strong>ï¼Œæ‰€ä»¥ RabbitMQ é‡‡ç”¨ç±»ä¼¼ NIOï¼ˆNon-blocking I/Oï¼‰çš„åšæ³•ï¼Œé€‰æ‹©<strong>TCPè¿æ¥å¤ç”¨</strong>ï¼Œæ—¢å‡å°‘æ€§èƒ½å¼€é”€ä¹Ÿä¾¿äºç®¡ç†ã€‚</p><p><strong>æ¯ä¸ªçº¿ç¨‹æŒæœ‰ä¸€ä¸ªä¿¡é“ï¼Œä¿¡é“å¤ç”¨äº†TCPè¿æ¥ï¼Œè€Œ RabbitMQ è¿˜å¯ä»¥ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„ç§å¯†æ€§å’ŒæŒæœ‰ç‹¬ç«‹çš„è¿æ¥ä¸€æ ·ã€‚</strong>å½“å•ä¸ªä¿¡é“æµé‡å¾ˆå¤§æ—¶ï¼Œå¤šä¸ªä¿¡é“å¤ç”¨ä¸€ä¸ªè¿æ¥å°±ä¼šäº§ç”Ÿæ€§èƒ½ç“¶é¢ˆï¼Œæ­¤æ—¶å¯ä»¥å¼€è¾Ÿå¤šä¸ªè¿æ¥å¹¶è¿›è¡Œå‡æ‘Šã€‚</p><h3 id="3-2-AMQPåè®®"><a href="#3-2-AMQPåè®®" class="headerlink" title="3.2 AMQPåè®®"></a><strong>3.2 AMQPåè®®</strong></h3><p>AMQPåè®®çš„æ¨¡å‹æ¶æ„å’Œ RabbitMQçš„æ¨¡å‹æ¶æ„ä¸€æ ·ï¼šç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢å™¨ï¼Œäº¤æ¢å™¨ä¸é˜Ÿåˆ—ç»‘å®šï¼Œå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶æ‰€æºå¸¦çš„ RoutingKey ä¸ç»‘å®šæ—¶çš„ BindingKey ç›¸åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯å³è¢«å­˜å…¥ç›¸åº”çš„é˜Ÿåˆ—ä¹‹ä¸­ã€‚æ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ç›¸åº”çš„é˜Ÿåˆ—æ¥è·å–æ¶ˆæ¯ã€‚</p><p>AMQPåè®®åŒ…æ‹¬ä¸‰å±‚ï¼š</p><ul><li><strong>Module Layer</strong>ï¼šä½äºåè®®<strong>æœ€é«˜å±‚</strong>ï¼Œä¸»è¦å®šä¹‰äº†ä¸€äº›ä¾›å®¢æˆ·ç«¯è°ƒç”¨çš„å‘½ä»¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥åˆ©ç”¨è¿™äº›å‘½ä»¤å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ <code>Queue.Declare</code> å‘½ä»¤å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—æˆ–è€…ä½¿ç”¨ <code>Basic.Consume</code> è®¢é˜…æ¶ˆè´¹ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ </li><li><strong>Session Layer</strong>ï¼šä½äº<strong>ä¸­é—´å±‚</strong>ï¼Œä¸»è¦è´Ÿè´£å°†å®¢æˆ·ç«¯çš„å‘½ä»¤å‘é€ç»™æœåŠ¡å™¨ï¼Œå†å°†æœåŠ¡ç«¯çš„åº”ç­”è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¸»è¦ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æä¾›å¯é æ€§åŒæ­¥æœºåˆ¶å’Œé”™è¯¯å¤„ç†ã€‚</li><li><strong>Transport Layer</strong> ï¼šä½äº<strong>æœ€åº•å±‚</strong>ï¼Œä¸»è¦ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®æµï¼Œæä¾›å¸§çš„å¤„ç†ã€ä¿¡é“å¤ç”¨ã€é”™è¯¯æ£€æµ‹å’Œæ•°æ®è¡¨ç¤ºç­‰ã€‚</li></ul><p><strong>AMQPè¯´åˆ°åº•è¿˜æ˜¯ä¸€ä¸ªé€šä¿¡åè®®ï¼Œéƒ½ä¼šæ¶‰åŠåˆ°æŠ¥æ–‡äº¤äº’</strong>ï¼Œä» low level ä¸¾ä¾‹æ¥è¯´ï¼ŒAMQP <strong>æœ¬èº«æ˜¯åº”ç”¨å±‚çš„åè®®ï¼Œå…¶å¡«å……äº TCP åè®®å±‚çš„æ•°æ®éƒ¨åˆ†</strong>ã€‚è€Œä» high-level æ¥è¯´ AMQP æ˜¯é€šè¿‡åè®®å‘½ä»¤è¿›è¡Œäº¤äº’çš„ã€‚AMQP åè®®å¯ä»¥çœ‹ä½œä¸€ç³»åˆ—ç»“æ„åŒ–å‘½ä»¤çš„é›†åˆï¼Œè¿™é‡Œçš„å‘½ä»¤ä»£è¡¨ä¸€ç§æ“ä½œï¼Œç±»ä¼¼äº HTTP ä¸­çš„æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETE ç­‰ï¼‰ã€‚</p><h4 id="ï¼ˆ1ï¼‰AMQPç”Ÿäº§è€…æµè½¬è¿‡ç¨‹"><a href="#ï¼ˆ1ï¼‰AMQPç”Ÿäº§è€…æµè½¬è¿‡ç¨‹" class="headerlink" title="ï¼ˆ1ï¼‰AMQPç”Ÿäº§è€…æµè½¬è¿‡ç¨‹"></a><strong>ï¼ˆ1ï¼‰AMQPç”Ÿäº§è€…æµè½¬è¿‡ç¨‹</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Connection connection = factory.newConnection(); <span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">Channel channel = connection.createChannel(); <span class="comment">//åˆ›å»ºä¿¡é“</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª type direct ã€æŒä¹…åŒ–çš„ã€éè‡ªåŠ¨åˆ é™¤çš„äº¤æ¢å™¨</span></span><br><span class="line">channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">"direct"</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–ã€éæ’ä»–çš„ã€éè‡ªåŠ¨åˆ é™¤çš„é˜Ÿåˆ—</span></span><br><span class="line">channel.queueDeclare(QUEUE_NAME, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//å°†äº¤æ¢å™¨ä¸é˜Ÿåˆ—é€šè¿‡è·¯ç”±é”®ç»‘å®š</span></span><br><span class="line">channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, ROUTING_KEY);</span><br><span class="line"><span class="comment">//å‘é€ä¸€æ¡æŒä¹…åŒ–çš„æ¶ˆæ¯ hello world !</span></span><br><span class="line">String message = <span class="string">"Hello World!"</span>;</span><br><span class="line">channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY,</span><br><span class="line">        MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class="line">        message.getBytes());</span><br><span class="line"><span class="comment">//å…³é—­èµ„æº</span></span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010152.png" alt></p><h4 id="ï¼ˆ2ï¼‰AMQPæ¶ˆè´¹è€…è€…æµè½¬è¿‡ç¨‹"><a href="#ï¼ˆ2ï¼‰AMQPæ¶ˆè´¹è€…è€…æµè½¬è¿‡ç¨‹" class="headerlink" title="ï¼ˆ2ï¼‰AMQPæ¶ˆè´¹è€…è€…æµè½¬è¿‡ç¨‹"></a><strong>ï¼ˆ2ï¼‰AMQPæ¶ˆè´¹è€…è€…æµè½¬è¿‡ç¨‹</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œçš„è¿æ¥æ–¹å¼ä¸ç”Ÿäº§è€…çš„ demo ç•¥æœ‰ä¸åŒï¼Œæ³¨æ„è¾¨åˆ«åŒºåˆ«</span></span><br><span class="line">        Connection connection = factory.newConnection(addresses); <span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="keyword">final</span> Channel channel = connection.createChannel(); <span class="comment">//åˆ›å»ºä¿¡é“</span></span><br><span class="line">        channel.basicQos(<span class="number">64</span>); <span class="comment">//è®¾ç½®å®¢æˆ·ç«¯æœ€å¤šæ¥æ”¶æœªè¢« ack çš„æ¶ˆæ¯çš„ä¸ªæ•°</span></span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       Envelope envelope,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       AMQP.BasicProperties properties,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"recv message : "</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                channel.basicAck(envelope.getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, consumer);</span><br><span class="line">        <span class="comment">//ç­‰å¾…å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹å å…³é—­èµ„æº</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010153.png" alt></p><h4 id="ï¼ˆ3ï¼‰AMQPå‘½ä»¤æ¦‚è§ˆ"><a href="#ï¼ˆ3ï¼‰AMQPå‘½ä»¤æ¦‚è§ˆ" class="headerlink" title="ï¼ˆ3ï¼‰AMQPå‘½ä»¤æ¦‚è§ˆ"></a><strong>ï¼ˆ3ï¼‰AMQPå‘½ä»¤æ¦‚è§ˆ</strong></h4><p>AMQPå‘½ä»¤ï¼š</p><table><thead><tr><th>åç§°</th><th>æ˜¯å¦åŒ…å«å†…å®¹ä½“</th><th>å¯¹åº”å®¢æˆ·ç«¯ä¸­çš„æ–¹æ³•</th><th>ç®€è¦æè¿°</th></tr></thead><tbody><tr><td>Connection.Start</td><td>å¦</td><td>factory.newConnection</td><td>å»ºç«‹è¿æ¥ç›¸å…³</td></tr><tr><td>Connection.Start-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Connection.Tune</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Connection.Tune-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Connection.Open</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Connection.Open-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Connection.Close</td><td>å¦</td><td>connection.close</td><td>å…³é—­è¿æ¥</td></tr><tr><td>Connection.Close-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Channel.Open</td><td>å¦</td><td>connection.openChannel</td><td>å¼€å¯ä¿¡é“</td></tr><tr><td>Channel.Open-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Channel.Close</td><td>å¦</td><td>channel.close</td><td>å…³é—­ä¿¡é“</td></tr><tr><td>Channel.Close-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Exchange.Declare</td><td>å¦</td><td>channel.exchangeDeclare</td><td>å£°æ˜äº¤æ¢å™¨</td></tr><tr><td>Exchange.Declare-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Exchange.Delete</td><td>å¦</td><td>channel.exchangeDelete</td><td>åˆ é™¤äº¤æ¢å™¨</td></tr><tr><td>Exchange.Delete-Ok</td><td>å¦</td><td>å‘ä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Exchange.Bind</td><td>å¦</td><td>channel.exchangeBind</td><td>äº¤æ¢å™¨ä¸äº¤æ¢å™¨ç»‘å®š</td></tr><tr><td>Exchange.Bind-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Exchange.Unbind</td><td>å¦</td><td>channel.exchangeUnbind</td><td>äº¤æ¢å™¨ä¸äº¤æ¢å™¨è§£ç»‘</td></tr><tr><td>Exchange.Unbind-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Queue.Declare</td><td>å¦</td><td>channel.queueDeclare</td><td>å£°æ˜é˜Ÿåˆ—</td></tr><tr><td>Queue.Declare-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Queue.Bind</td><td>å¦</td><td>channel.queueBind</td><td>é˜Ÿåˆ—ä¸äº¤æ¢å™¨ç»‘å®š</td></tr><tr><td>Queue.Bind-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Queue.Purge</td><td>å¦</td><td>channel.queuePurge</td><td>æ¸…é™¤é˜Ÿåˆ—ä¸­çš„å†…å®¹</td></tr><tr><td>Queue.Purge-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Queue.Delete</td><td>å¦</td><td>channel.queueDelete</td><td>åˆ é™¤é˜Ÿåˆ—</td></tr><tr><td>Queue.Delete-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>å‘ä¸Š</td></tr><tr><td>Queue.Unbind</td><td>å¦</td><td>channel.queueUnbind</td><td>é˜Ÿåˆ—ä¸äº¤æ¢å™¨è§£ç»‘</td></tr><tr><td>Queue.Unbind-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Basic.Qos</td><td>å¦</td><td>channel.basicQos</td><td>è®¾ç½®æœªè¢«ç¡®è®¤æ¶ˆè´¹çš„ä¸ªæ•°</td></tr><tr><td>Basic.Qos-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Basic.Consume</td><td>å¦</td><td>channel.basicConsume</td><td>æ¶ˆè´¹æ¶ˆæ¯ï¼ˆæ¨æ¨¡å¼ï¼‰</td></tr><tr><td>BasiÎ¹Consume-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Basic.Cancel</td><td>å¦</td><td>channel.basicCancel</td><td>å–æ¶ˆ</td></tr><tr><td>Basic.Cancel-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Basic.Publish</td><td>å¦</td><td>channel.basicPublish</td><td>å‘é€æ¶ˆæ¯</td></tr><tr><td>Basic.Return</td><td>å¦</td><td>æ— </td><td>æœªèƒ½æˆåŠŸè·¯ç”±çš„æ¶ˆæ¯è¿”å›</td></tr><tr><td>Basic.Deliver</td><td>å¦</td><td>æ— </td><td>Broker æ¨é€æ¶ˆæ¯</td></tr><tr><td>Basic.Get</td><td>å¦</td><td>channel.basicGet</td><td>æ¶ˆè´¹æ¶ˆæ¯ï¼ˆæ‹‰æ¨¡å¼ã€‰</td></tr><tr><td>Basic.Get-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Basic.Ack</td><td>å¦</td><td>channel.basicAck</td><td>ç¡®è®¤</td></tr><tr><td>Basic.Reject</td><td>å¦</td><td>channel.basicReject</td><td>æ‹’ç»ï¼ˆå•æ¡æ‹’ç»ï¼‰</td></tr><tr><td>Basic.Recover</td><td>å¦</td><td>channel.basicRecover</td><td>è¯·æ±‚ Broker é‡æ–°å‘é€æœªè¢«ç¡®è®¤çš„æ¶ˆæ¯</td></tr><tr><td>Basic.Recover-Ok</td><td>å¦</td><td>å‘ä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Basic.Nack</td><td>å¦</td><td>channel.basicNack</td><td>æ‹’ç»ï¼ˆå¯æ‰¹é‡æ‹’ç»ã€‰</td></tr><tr><td>Tx.Select</td><td>å¦</td><td>channel.txSelect</td><td>å¼€å¯äº‹åŠ¡</td></tr><tr><td>Tx.Select-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Tx.Commit</td><td>å¦</td><td>channel.txCommit</td><td>äº‹åŠ¡æäº¤</td></tr><tr><td>Tx.Commit-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Tx.Rollback</td><td>å¦</td><td>channel.txRollback</td><td>äº‹åŠ¡å›æ»š</td></tr><tr><td>Tx.Rollback-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr><tr><td>Confirm Select</td><td>å¦</td><td>channel.confinnSelect</td><td>å¼€å¯å‘é€ç«¯ç¡®è®¤æ¨¡å¼</td></tr><tr><td>Confirm.Select-Ok</td><td>å¦</td><td>åŒä¸Š</td><td>åŒä¸Š</td></tr></tbody></table><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹</p>]]></content>
    
    <summary type="html">
    
      å­¦ä¹ RabbitMQï¼Œç¬¬ä¸€ç« ã€Šç®€ä»‹å’Œå…¥é—¨ã€‹ï¼Œå†…å®¹æ¥è‡ªäºã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šRabbitMQæ¦‚è¿°ï¼Œå®‰è£…å’Œç®€å•ä½¿ç”¨ï¼ŒåŸºæœ¬æ¦‚å¿µï¼ŒAMQPåè®®ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="mom" scheme="http://linyishui.top/tags/mom/"/>
    
      <category term="rabbitmq" scheme="http://linyishui.top/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼æ¦‚è§ˆï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <link href="http://linyishui.top/2020091201.html"/>
    <id>http://linyishui.top/2020091201.html</id>
    <published>2020-09-12T12:20:42.000Z</published>
    <updated>2020-10-02T08:15:49.748Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="åˆ†å¸ƒå¼æ¦‚è§ˆ"><a href="#åˆ†å¸ƒå¼æ¦‚è§ˆ" class="headerlink" title="åˆ†å¸ƒå¼æ¦‚è§ˆ"></a><strong>åˆ†å¸ƒå¼æ¦‚è§ˆ</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-åˆ†å¸ƒå¼ç³»ç»Ÿ"><a href="#ç¬¬ä¸€èŠ‚-åˆ†å¸ƒå¼ç³»ç»Ÿ" class="headerlink" title="ç¬¬ä¸€èŠ‚ åˆ†å¸ƒå¼ç³»ç»Ÿ"></a><strong>ç¬¬ä¸€èŠ‚ åˆ†å¸ƒå¼ç³»ç»Ÿ</strong></h2><h3 id="1-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ"></a><strong>1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ</strong></h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸€ç§<strong>ç»„ä»¶åˆ†å¸ƒåœ¨ç½‘ç»œè®¡ç®—æœºä¸Š</strong>ï¼Œ<strong>ç»„ä»¶ä¹‹é—´ä»…ä»…é€šè¿‡æ¶ˆæ¯ä¼ é€’æ¥é€šä¿¡å¹¶åè°ƒè¡ŒåŠ¨</strong>çš„ç³»ç»Ÿã€‚</p><p>å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä»–é¢å¯¹çš„åªæ˜¯ä¸€å°æœåŠ¡å™¨ï¼Œä½†å®é™…ä¸Šè¿™å°æœåŠ¡å™¨æ˜¯ç”±ä¼—å¤šæœåŠ¡å™¨ç»„æˆçš„â€œä¸€å°è¶…çº§è®¡ç®—æœºâ€ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„å„ç§ç½‘ç«™ï¼Œå®ƒä»¬èƒŒåéƒ½æ˜¯ä¸€æ•´ä¸ªå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨æä¾›æœåŠ¡ã€‚</p><h3 id="1-2-åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ„ä¹‰ï¼Ÿ"><a href="#1-2-åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ„ä¹‰ï¼Ÿ" class="headerlink" title="1.2 åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ„ä¹‰ï¼Ÿ"></a><strong>1.2 åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ„ä¹‰ï¼Ÿ</strong></h3><p>ä¸ºä»€ä¹ˆè¦ä»å•ä¸€åº”ç”¨æ¶æ„æˆ–å‚ç›´åº”ç”¨æ¶æ„å‡çº§åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ</p><ul><li>å‡çº§å•æœºå¤„ç†èƒ½åŠ›çš„æ€§ä»·æ¯”è¶Šæ¥è¶Šä½</li><li>å•æœºå¤„ç†èƒ½åŠ›æœ‰ç“¶é¢ˆ</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥ç¨³å®šæ€§å’Œå¯ç”¨æ€§</li><li>å•ä¸€åº”ç”¨ä¸åˆ©äºæ‰©å±•å’Œå‡çº§ç»´æŠ¤</li><li>å•ä¸€åº”ç”¨æ‹†åˆ†åï¼Œåº”ç”¨é—´çš„äº¤äº’è¶Šæ¥è¶Šå¤æ‚</li></ul><h3 id="1-3-åŸºç¡€çŸ¥è¯†è¡¥é½"><a href="#1-3-åŸºç¡€çŸ¥è¯†è¡¥é½" class="headerlink" title="1.3 åŸºç¡€çŸ¥è¯†è¡¥é½"></a><strong>1.3 åŸºç¡€çŸ¥è¯†è¡¥é½</strong></h3><h4 id="1-3-1-ç»„æˆè®¡ç®—æœºçš„5è¦ç´ "><a href="#1-3-1-ç»„æˆè®¡ç®—æœºçš„5è¦ç´ " class="headerlink" title="1.3.1 ç»„æˆè®¡ç®—æœºçš„5è¦ç´ "></a><strong>1.3.1 ç»„æˆè®¡ç®—æœºçš„5è¦ç´ </strong></h4><p>å†¯ Â· è¯ºä¾æ›¼è®¡ç®—æœºçš„5ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><ul><li>è¿ç®—å™¨</li><li>æ§åˆ¶å™¨</li><li>å­˜å‚¨å™¨<ul><li>å†…å­˜</li><li>å¤–å­˜ï¼šæ–­ç”µåä»èƒ½ä¿å­˜æ•°æ®ã€‚</li></ul></li><li>è¾“å…¥è®¾å¤‡</li><li>è¾“å‡ºè®¾å¤‡</li></ul><p>æ—¢ç„¶åˆ†å¸ƒå¼ç³»ç»Ÿçœ‹èµ·æ¥åƒä¸€ä¸ªè¶…çº§è®¡ç®—æœºï¼Œæ˜¯ä¸æ˜¯ä¹Ÿæœ‰ç±»ä¼¼çš„ç»“æ„å‘¢ï¼Ÿ</p><h4 id="1-3-2-çº¿ç¨‹ä¸è¿›ç¨‹çš„æ‰§è¡Œæ¨¡å¼"><a href="#1-3-2-çº¿ç¨‹ä¸è¿›ç¨‹çš„æ‰§è¡Œæ¨¡å¼" class="headerlink" title="1.3.2 çº¿ç¨‹ä¸è¿›ç¨‹çš„æ‰§è¡Œæ¨¡å¼"></a><strong>1.3.2 çº¿ç¨‹ä¸è¿›ç¨‹çš„æ‰§è¡Œæ¨¡å¼</strong></h4><p>æˆ‘ä»¬å­¦ä¹ ç¼–ç¨‹éƒ½æ˜¯ä»å•çº¿ç¨‹æ¨¡å¼å¼€å§‹çš„ï¼Œé¢å¯¹çš„éƒ½æ˜¯<strong>ç¨‹åºçš„é¡ºåºã€åˆ†æ”¯å’Œå¾ªç¯æ‰§è¡Œ</strong>ã€‚å¤šçº¿ç¨‹ï¼ˆæŒ‡å•è¿›ç¨‹å†…çš„å¤šçº¿ç¨‹ï¼‰è¦å¤„ç†<strong>çº¿ç¨‹é—´é€šä¿¡</strong>ï¼Œè¦å¯¹<strong>çº¿ç¨‹å¹¶å‘</strong>åšæ§åˆ¶ï¼Œåšå¥½<strong>çº¿ç¨‹é—´çš„åè°ƒå·¥ä½œ</strong>ã€‚</p><p>åœ¨å¤šæ ¸CPUçš„æ—¶ä»£ï¼Œç¨‹åºçš„<strong>å¹¶å‘</strong>å’Œ<strong>å¹¶è¡Œ</strong>å¾ˆé‡è¦ï¼Œå†³å®šç€æ˜¯å¦èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨å¤šæ ¸å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚</p><p>å¤šçº¿ç¨‹çš„å‡ ç§äº¤äº’æ¨¡å¼ï¼š</p><ul><li><strong>äº’ä¸é€šä¿¡çš„å¤šçº¿ç¨‹æ¨¡å¼</strong>ï¼šæœ€ç®€å•çš„å¤šçº¿ç¨‹æ¨¡å¼ï¼Œçº¿ç¨‹é—´æ— å…±äº«æ•°æ®ï¼Œä¹Ÿä¸éœ€è¦åšåŠ¨ä½œåè°ƒï¼Œå°±æ˜¯å¤šä¸ªç‹¬ç«‹çš„çº¿ç¨‹å„è‡ªå®Œæˆè‡ªå·±çš„ä»»åŠ¡ã€‚</li><li><strong>åŸºäºå…±äº«å®¹å™¨çš„å¤šçº¿ç¨‹æ¨¡å¼</strong>ï¼šå¤šçº¿ç¨‹å…·æœ‰å…±äº«æ•°æ®ï¼Œå¦‚ç»å…¸çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦ä¿è¯æ•°æ®è®¿é—®çš„æ­£ç¡®æ€§ï¼Œå¯¹äºå­˜å‚¨æ•°æ®çš„å®¹å™¨æœ‰çº¿ç¨‹å®‰å…¨æˆ–ä¸å®‰å…¨ä¹‹åˆ†ï¼Œçº¿ç¨‹ä¸å®‰å…¨çš„å®¹å™¨ä¸€èˆ¬å¯ä»¥é€šè¿‡<strong>åŠ é”ï¼ˆæ•°æ®è¯»å†™æ¯”ä¾‹å¾ˆé«˜ï¼Œé‡‡ç”¨è¯»å†™é”è€Œéäº’æ–¥é”ï¼‰æˆ–å†™æ—¶å¤åˆ¶CopyOnWrite</strong>çš„æ–¹å¼æ¥æ§åˆ¶ã€‚</li><li><strong>é€šè¿‡äº‹ä»¶ååŒçš„å¤šçº¿ç¨‹æ¨¡å¼</strong>ï¼šé™¤äº†å¹¶å‘è®¿é—®çš„æ§åˆ¶ï¼Œçº¿ç¨‹é—´è¿˜ä¼šæœ‰åè°ƒçš„éœ€æ±‚ã€‚æ¯”å¦‚Aã€Bä¸¤ä¸ªçº¿ç¨‹ï¼ŒBçº¿ç¨‹éœ€è¦ç­‰å¾…æŸä¸ªçŠ¶æ€æˆ–äº‹ä»¶å‘ç”Ÿåæ‰èƒ½ç»§ç»­å·¥ä½œï¼Œè€Œè¿™ä¸ªæ”¹å˜å’ŒAçº¿ç¨‹æœ‰å…³ï¼Œè¿™æ—¶å°±éœ€è¦å®Œæˆçº¿ç¨‹é—´çš„åè°ƒï¼ˆç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹éœ€è¦æ³¨æ„é¿å…æ­»é”ã€‚</li></ul><p>å¤šè¿›ç¨‹æ¨¡å¼ï¼šçº¿ç¨‹å±äºè¿›ç¨‹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å…±äº«äº†è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œè€Œè¿›ç¨‹ä¹‹é—´çš„å†…å­˜ç©ºé—´æ˜¯ç‹¬ç«‹çš„ã€‚æ‰€ä»¥å¤šä¸ªè¿›ç¨‹é—´é€šè¿‡å†…å­˜å…±äº«ã€äº¤æ¢æ•°æ®çš„æ–¹å¼ä¸å¤šçº¿ç¨‹æœ‰æ‰€ä¸åŒã€‚</p><ul><li>å•æœºå¤šè¿›ç¨‹</li><li>å¤šæœºå¤šè¿›ç¨‹ï¼šå•æœºOSæ‰€æ”¯æŒçš„åŠŸèƒ½éœ€è¦å¦å¤–å®ç°ï¼Œå•ä¸ªæœºå™¨æ•…éšœå¤„ç†çš„å¥½å°±ä¸å½±å“é›†ç¾¤ã€‚</li></ul><h4 id="1-3-3-ç½‘ç»œé€šä¿¡"><a href="#1-3-3-ç½‘ç»œé€šä¿¡" class="headerlink" title="1.3.3 ç½‘ç»œé€šä¿¡"></a><strong>1.3.3 ç½‘ç»œé€šä¿¡</strong></h4><p><strong>OSIä¸TCP/IPç½‘ç»œæ¨¡å‹</strong></p><p><img src alt></p><p><img src alt></p><p>OSIä¸ƒå±‚æ¨¡å‹ï¼š</p><ul><li>åº”ç”¨å±‚</li><li><strong>è¡¨ç¤ºå±‚</strong> ï¼šæ•°æ®å‹ç¼©ã€åŠ å¯†ä»¥åŠæ•°æ®æè¿°ï¼Œè¿™ä½¿å¾—åº”ç”¨ç¨‹åºä¸å¿…å…³å¿ƒåœ¨å„å°ä¸»æœºä¸­æ•°æ®å†…éƒ¨æ ¼å¼ä¸åŒçš„é—®é¢˜ã€‚</li><li><strong>ä¼šè¯å±‚</strong> ï¼šå»ºç«‹åŠç®¡ç†ä¼šè¯ã€‚</li><li>è¿è¾“å±‚</li><li>ç½‘è·¯å±‚</li><li>æ•°æ®é“¾è·¯å±‚</li><li>ç‰©ç†å±‚</li></ul><p>äº”å±‚åè®®ï¼š</p><ul><li><strong>åº”ç”¨å±‚</strong> ï¼šä¸ºç‰¹å®šåº”ç”¨ç¨‹åºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä¾‹å¦‚ <strong>HTTP</strong>ã€<strong>DNS</strong> ç­‰åè®®ã€‚æ•°æ®å•ä½ä¸ºæŠ¥æ–‡ã€‚</li><li><strong>ä¼ è¾“å±‚</strong> ï¼šä¸ºè¿›ç¨‹æä¾›é€šç”¨æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç”±äºåº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå®šä¹‰é€šç”¨çš„ä¼ è¾“å±‚åè®®å°±å¯ä»¥æ”¯æŒä¸æ–­å¢å¤šçš„åº”ç”¨å±‚åè®®ã€‚è¿è¾“å±‚åŒ…æ‹¬ä¸¤ç§åè®®ï¼š<ul><li>ä¼ è¾“æ§åˆ¶åè®® <strong>TCP</strong>ï¼Œæä¾›é¢å‘è¿æ¥ã€å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºæŠ¥æ–‡æ®µï¼›</li><li>ç”¨æˆ·æ•°æ®æŠ¥åè®® <strong>UDP</strong>ï¼Œæä¾›æ— è¿æ¥ã€å°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºç”¨æˆ·æ•°æ®æŠ¥ã€‚</li><li>TCP ä¸»è¦æä¾›å®Œæ•´æ€§æœåŠ¡ï¼ŒUDP ä¸»è¦æä¾›åŠæ—¶æ€§æœåŠ¡ã€‚</li></ul></li><li><strong>ç½‘ç»œå±‚</strong> ï¼šä¸ºä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚è€Œä¼ è¾“å±‚åè®®æ˜¯ä¸ºä¸»æœºä¸­çš„è¿›ç¨‹æä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç½‘ç»œå±‚æŠŠä¼ è¾“å±‚ä¼ é€’ä¸‹æ¥çš„æŠ¥æ–‡æ®µæˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„ã€‚</li><li><strong>æ•°æ®é“¾è·¯å±‚</strong> ï¼šç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œé“¾è·¯å±‚åè®®å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„ä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚</li><li><strong>ç‰©ç†å±‚</strong> ï¼šè€ƒè™‘çš„æ˜¯æ€æ ·åœ¨ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµï¼Œè€Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚ç‰©ç†å±‚çš„ä½œç”¨æ˜¯å°½å¯èƒ½å±è”½ä¼ è¾“åª’ä½“å’Œé€šä¿¡æ‰‹æ®µçš„å·®å¼‚ï¼Œä½¿æ•°æ®é“¾è·¯å±‚æ„Ÿè§‰ä¸åˆ°è¿™äº›å·®å¼‚ã€‚</li></ul><p>äº”å±‚åè®®æ²¡æœ‰è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚ï¼Œè€Œæ˜¯å°†è¿™äº›åŠŸèƒ½ç•™ç»™åº”ç”¨ç¨‹åºå¼€å‘è€…å¤„ç†ã€‚</p><p>TCP/IPï¼š</p><p>å®ƒåªæœ‰å››å±‚ï¼Œç›¸å½“äºäº”å±‚åè®®ä¸­æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚åˆå¹¶ä¸ºç½‘ç»œæ¥å£å±‚ã€‚</p><p>TCP/IP ä½“ç³»ç»“æ„ä¸ä¸¥æ ¼éµå¾ª OSI åˆ†å±‚æ¦‚å¿µï¼Œåº”ç”¨å±‚å¯èƒ½ä¼šç›´æ¥ä½¿ç”¨ IP å±‚æˆ–è€…ç½‘ç»œæ¥å£å±‚ã€‚</p><p>ç½‘ç»œIOçš„å®ç°æ–¹å¼ï¼šä½¿ç”¨Socketå¥—æ¥å­—è¿›è¡Œç½‘ç»œé€šä¿¡å¼€å‘æ—¶ï¼Œä¼šä½¿ç”¨å“ªäº›å®ç°æ–¹å¼ã€‚</p><ul><li><strong>BIO</strong>ï¼šBlocking IOï¼Œé˜»å¡å¼å®ç°ã€‚ä¸€ä¸ªå¥—æ¥å­—éœ€è¦ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œå»ºç«‹è¿æ¥ã€è¯»æ•°æ®ã€å†™æ•°æ®éƒ½å¯èƒ½ä¼šé˜»å¡ã€‚</li><li><strong>NIO</strong>ï¼šNonblocking IOï¼Œéé˜»å¡å¼å®ç°ï¼ŒåŸºäºäº‹ä»¶é©±åŠ¨æ€æƒ³ï¼Œé‡‡ç”¨ Reactor æ¨¡å¼ã€‚ç›¸æ¯”äºBIOï¼ŒNIOä¸ç”¨ä¸ºæ¯ä¸ªå¥—æ¥å­—åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªå¥—æ¥å­—çš„ç›¸å…³å·¥ä½œã€‚</li><li><strong>AIO</strong>ï¼šAsynchronousIOï¼Œå¼‚æ­¥IOï¼Œé‡‡ç”¨ Proactor æ¨¡å¼ã€‚ä¸NIOçš„å·®å¼‚æ˜¯ï¼ŒAIOåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œåªéœ€è°ƒç”¨ç›¸åº”çš„ read/write æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥ CompletionHandlerï¼ˆåŠ¨ä½œå®Œæˆçš„å¤„ç†å™¨ï¼‰ï¼›åœ¨åŠ¨ä½œå®Œæˆåï¼Œä¼šè°ƒç”¨CompletionHandlerã€‚NIOçš„é€šçŸ¥å‘ç”Ÿåœ¨åŠ¨ä½œä¹‹å‰ï¼Œæ˜¯åœ¨å¯å†™ã€å¯è¯»çš„æ—¶å€™ï¼ŒSelectorå‘ç°è¿™äº›äº‹ä»¶åè°ƒç”¨ Handler å¤„ç†ã€‚</li></ul><h4 id="1-3-4-å¦‚ä½•æŠŠåº”ç”¨ä»å•æœºæ‰©å±•åˆ°åˆ†å¸ƒå¼"><a href="#1-3-4-å¦‚ä½•æŠŠåº”ç”¨ä»å•æœºæ‰©å±•åˆ°åˆ†å¸ƒå¼" class="headerlink" title="1.3.4 å¦‚ä½•æŠŠåº”ç”¨ä»å•æœºæ‰©å±•åˆ°åˆ†å¸ƒå¼"></a><strong>1.3.4 å¦‚ä½•æŠŠåº”ç”¨ä»å•æœºæ‰©å±•åˆ°åˆ†å¸ƒå¼</strong></h4><p>åˆ†å¸ƒå¼è¿™ç§â€œè¶…çº§è®¡ç®—æœºâ€çš„äº”ä¸ªç»„æˆéƒ¨åˆ†çš„å˜åŒ–ï¼š</p><ul><li>è¾“å…¥è®¾å¤‡ï¼š<ul><li>äº’ç›¸è¿æ¥çš„å¤šä¸ªèŠ‚ç‚¹ï¼ŒæŸä¸ªèŠ‚ç‚¹æ¥å—å…¶ä»–èŠ‚ç‚¹ä¿¡æ¯æ—¶ï¼Œå¯ä»¥çœ‹ä½œè¾“å…¥è®¾å¤‡ã€‚</li><li>ä¼ ç»Ÿäººæœºäº¤äº’çš„è¾“å…¥è®¾å¤‡ã€‚</li></ul></li><li>è¾“å‡ºè®¾å¤‡ï¼š<ul><li>äº’ç›¸è¿æ¥çš„å¤šä¸ªèŠ‚ç‚¹ï¼ŒæŸä¸ªèŠ‚ç‚¹å‘å…¶ä»–èŠ‚ç‚¹ä¼ é€’ä¿¡æ¯æ—¶ï¼Œå¯ä»¥çœ‹ä½œè¾“å‡ºè®¾å¤‡ã€‚</li><li>ä¼ ç»Ÿäººæœºäº¤äº’çš„è¾“å‡ºè®¾å¤‡ï¼Œå¦‚å±å¹•ã€‚</li></ul></li><li>æ§åˆ¶å™¨ï¼š<ul><li>å•æœºçš„æ§åˆ¶å™¨å°±æ˜¯CPUä¸­çš„æ§åˆ¶å™¨ã€‚</li><li>åˆ†å¸ƒå¼ä¸­æ§åˆ¶å™¨è´Ÿè´£åè°ƒæˆ–æ§åˆ¶èŠ‚ç‚¹ä¹‹é—´çš„åŠ¨ä½œå’Œè¡Œä¸ºã€‚å¦‚è¿œç¨‹æœåŠ¡è°ƒç”¨çš„åœºæ™¯ï¼Œæœ‰å‡ ç§å®ç°æ–¹å¼ï¼š<ul><li><strong>ç¡¬ä»¶è´Ÿè½½å‡è¡¡</strong>ï¼šæ‰€æœ‰è¯·æ±‚éƒ½è¦é€šè¿‡æœºå™¨è½¬å‘ã€‚</li><li><strong>LVSé€æ˜ä»£ç†</strong>ï¼šå¢åŠ äº†ç½‘ç»œçš„å¼€é”€ï¼ˆæµé‡å’Œå»¶è¿Ÿï¼‰ï¼Œå› ä¸ºå¤šäº†ä¸€å±‚è½¬å‘ï¼›ä»£ç†å´©æºƒä¼šå½±å“æ‰€æœ‰è¯·æ±‚ã€‚</li><li><strong>åç§°æœåŠ¡</strong>ï¼šæ²¡æœ‰ä»£ç†åœ°å€ï¼Œè¯·æ±‚çš„å‘èµ·è€…å’Œå¤„ç†è€…<strong>ç›´æ¥è¿æ¥</strong>ï¼Œåªä¸è¿‡åç§°æœåŠ¡æ¨¡å—æœé›†å¤„ç†æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯ï¼Œå‘èµ·è€…å…ˆä»æœ¬æœºåç§°æœåŠ¡è·å–åœ°å€ã€‚ä»£ç å‡çº§æ¯”è¾ƒå¤æ‚ã€‚</li><li><strong>è§„åˆ™æœåŠ¡å™¨</strong>ï¼šä¹Ÿæ˜¯<strong>ç›´æ¥è¿æ¥</strong>ï¼ŒåŒºåˆ«æ˜¯åç§°æœåŠ¡å’Œå¤„ç†è€…æœºå™¨äº¤äº’è®°å½•å…¶åœ°å€ï¼Œè§„åˆ™æœåŠ¡å™¨åˆ™ä¸å’Œå¤„ç†è€…äº¤äº’ï¼Œåªæä¾›è§„åˆ™ç»™è¯·æ±‚çš„å‘èµ·è€…ã€‚</li><li><strong>Master+Worker</strong>ï¼šMasterèŠ‚ç‚¹ç®¡ç†ä»»åŠ¡ï¼Œåˆ†é…ç»™ä¸åŒçš„Workerè¿›è¡Œå¤„ç†ã€‚</li></ul></li></ul></li><li>è¿ç®—å™¨ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿè¿ç”¨å¤šä¸ªèŠ‚ç‚¹çš„è®¡ç®—èƒ½åŠ›æ¥ååŒå®Œæˆæ•´ä½“çš„è®¡ç®—ä»»åŠ¡ã€‚<ul><li>ä¾‹å¦‚æˆ‘ä»¬éœ€è¦æ—¥å¿—å¤„ç†æœåŠ¡å™¨ä»åº”ç”¨æœåŠ¡å™¨é›†ç¾¤æ”¶é›†æ—¥å¿—å¹¶å¤„ç†ï¼Œéšç€åº”ç”¨æœåŠ¡å™¨çš„å¢å¤šï¼Œå•å°æ—¥å¿—å¤„ç†æœåŠ¡å™¨è¾¾åˆ°ç“¶é¢ˆï¼Œæ‰€ä»¥éœ€è¦å¢åŠ æ—¥å¿—æœåŠ¡å™¨æ¥æå‡å¤„ç†èƒ½åŠ›ã€‚</li><li>å¯ä»¥ä½¿ç”¨<strong>Master+Worker</strong>æ¥æ§åˆ¶æ—¥å¿—æœåŠ¡å™¨é›†ç¾¤ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨è§„åˆ™æœåŠ¡å™¨ç­‰ã€‚</li></ul></li><li>å­˜å‚¨å™¨ï¼š<ul><li>å•æœºä¸­å­˜å‚¨å™¨åˆ†ä¸ºå†…å­˜å’Œå¤–å­˜ã€‚</li><li>åˆ†å¸ƒå¼ä¸­è¦æŠŠæ‰¿æ‹…å­˜å‚¨åŠŸèƒ½çš„å¤šä¸ªèŠ‚ç‚¹ç»„ç»‡åœ¨ä¸€èµ·ã€‚</li><li>å®ç°æ–¹å¼ï¼šï¼ˆå¦‚KVå­˜å‚¨æœåŠ¡å™¨ï¼‰<ul><li>ä»£ç†æœåŠ¡å™¨ï¼Œæ ¹æ®è¯·æ±‚çš„Keyåˆ’åˆ†ï¼ˆShardingï¼‰è¿›è¡Œè½¬å‘</li><li>åç§°æœåŠ¡ï¼Œæ ¹æ®ä¸åŒåœºæ™¯æœ‰ä¸¤ç§å®ç°ï¼š<ul><li>é…åˆè§„åˆ™æœåŠ¡å™¨ï¼Œå®Œæˆå›ºå®šçš„Shardingç­–ç•¥</li><li>åœ¨æ¶ˆæ¯ä¸­é—´ä»¶çš„åº”ç”¨åœºæ™¯ï¼ŒåŒç­‰çœ‹å¾…KVå­˜å‚¨æœåŠ¡å™¨ï¼Œå¯ä»¥çµæ´»çš„å¢åŠ æˆ–å‡å°‘æœåŠ¡å™¨ã€‚</li></ul></li><li>è§„åˆ™æœåŠ¡å™¨ï¼Œé™¤äº†å¯¹æ•°æ®è¿›è¡ŒShardingï¼Œè¿˜åŒ…æ‹¬å…·ä½“KVå­˜å‚¨æœåŠ¡å™¨çš„åœ°å€ã€‚</li><li>Masteræ ¹æ®è¯·æ±‚è¿”å›ç›®æ ‡KVå­˜å‚¨æœåŠ¡å™¨åœ°å€ï¼Œç›¸æ¯”åç§°æœåŠ¡è¿”å›æ‰€æœ‰åœ°å€ï¼ŒMasteræ ¹æ®è¯·æ±‚è¿”å›å¯¹åº”åœ°å€ï¼›ç›¸æ¯”è§„åˆ™æœåŠ¡å™¨æŠŠè§„åˆ™ä¼ ç»™å…·ä½“åº”ç”¨å†ç”±åº”ç”¨æœåŠ¡å™¨è§£æå¹¶å®Œæˆè§„åˆ™ä¸‹çš„è·¯ç”±é€‰æ‹©ï¼ŒMasterè‡ªèº«å®Œæˆäº†è¿™ä»¶äº‹æƒ…ï¼ŒåªæŠŠç»“æœä¼ ç»™åº”ç”¨æœåŠ¡å™¨ï¼Œåº”ç”¨æœåŠ¡å™¨åªé¡»æ‹¿ç€åœ°å€å»è®¿é—®å³å¯ã€‚</li></ul></li></ul></li></ul><h4 id="1-3-5-åˆ†å¸ƒå¼ç³»ç»Ÿçš„éš¾ç‚¹"><a href="#1-3-5-åˆ†å¸ƒå¼ç³»ç»Ÿçš„éš¾ç‚¹" class="headerlink" title="1.3.5 åˆ†å¸ƒå¼ç³»ç»Ÿçš„éš¾ç‚¹"></a><strong>1.3.5 åˆ†å¸ƒå¼ç³»ç»Ÿçš„éš¾ç‚¹</strong></h4><ul><li><strong>ç¼ºä¹å…¨å±€æ—¶é’Ÿ</strong>ï¼šå•æœºæœ‰æœºå™¨æ—¶é’Ÿä¸ºæ ‡å‡†ï¼Œå®¹æ˜“æ§åˆ¶æ—¶åºã€‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åŒæ­¥æœ¬èº«å°±æœ‰æ—¶é—´å·®ï¼Œå¾ˆéš¾ä¿æŒæ‰€æœ‰æœºå™¨çš„æ—¶é—´ä¸€è‡´ã€‚ä¸è¿‡æˆ‘ä»¬ä½¿ç”¨æ—¶é’Ÿæ¥åŒºåˆ†åŠ¨ä½œé—´çš„é¡ºåºä¸éœ€è¦å‡†ç¡®çš„æ—¶é—´ï¼Œä¸€èˆ¬ä¼šç”±ä¸€ä¸ªå•ç‹¬çš„é›†ç¾¤æ¥åŒºåˆ†åŠ¨ä½œé—´çš„é¡ºåºã€‚</li><li><strong>é¢å¯¹æ•…éšœç‹¬ç«‹æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæŸä¸ªéƒ¨åˆ†æœ‰é—®é¢˜è€Œå…¶ä»–éƒ¨åˆ†æ­£å¸¸æ˜¯ç»å¸¸å‘ç”Ÿçš„ã€‚</li><li><strong>å¤„ç†å•ç‚¹æ•…éšœ</strong>ï¼šå•ç‚¹å³åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æŸä¸ªåŠŸèƒ½åªç”±å•æœºåœ¨æ”¯æŒï¼Œå…¶å‘ç”Ÿçš„æ•…éšœå³å•ç‚¹æ•…éšœï¼ŒSPoEï¼ˆSingle Point of Failureï¼‰ã€‚æ‰€ä»¥èƒ½æ‰©å±•ä¸ºé›†ç¾¤çš„å°±å°½é‡æ‰©å±•ï¼Œåªèƒ½å•ç‚¹å®ç°çš„ï¼š<ul><li>åšå¥½è¿™ä¸ªå•ç‚¹çš„å¤‡ä»½ï¼Œèƒ½å¤Ÿåœ¨å‡ºé—®é¢˜æ—¶åŠæ—¶æ¢å¤ï¼Œæœ€å¥½èƒ½è‡ªåŠ¨æ¢å¤ã€å¿«é€Ÿæ¢å¤ã€‚</li><li>é™ä½å•ç‚¹æ•…éšœçš„å½±å“èŒƒå›´ï¼Œå°½é‡å‡å°‘æ•…éšœå‘ç”Ÿæ—¶çš„æŸå¤±ã€‚</li></ul></li><li><strong>äº‹åŠ¡</strong>ï¼šä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ã€æœ€ç»ˆä¸€è‡´ã€BASEã€CAPã€Paxosç­‰</li></ul><hr><h2 id="ç¬¬äºŒèŠ‚-å¤§å‹ç½‘ç«™æ¶æ„æ¼”å˜å†ç¨‹"><a href="#ç¬¬äºŒèŠ‚-å¤§å‹ç½‘ç«™æ¶æ„æ¼”å˜å†ç¨‹" class="headerlink" title="ç¬¬äºŒèŠ‚ å¤§å‹ç½‘ç«™æ¶æ„æ¼”å˜å†ç¨‹"></a><strong>ç¬¬äºŒèŠ‚ å¤§å‹ç½‘ç«™æ¶æ„æ¼”å˜å†ç¨‹</strong></h2><h3 id="2-1-æ—©æœŸ-ç”¨JavaæŠ€æœ¯å’Œå•æœºæ¥æ„å»ºç½‘ç«™"><a href="#2-1-æ—©æœŸ-ç”¨JavaæŠ€æœ¯å’Œå•æœºæ¥æ„å»ºç½‘ç«™" class="headerlink" title="2.1 æ—©æœŸ-ç”¨JavaæŠ€æœ¯å’Œå•æœºæ¥æ„å»ºç½‘ç«™"></a><strong>2.1 æ—©æœŸ-ç”¨JavaæŠ€æœ¯å’Œå•æœºæ¥æ„å»ºç½‘ç«™</strong></h3><p><strong>ç†Ÿæ‚‰çš„æŠ€æœ¯</strong>ï¼šLAMPã€MVCæ¡†æ¶ã€JSPã€Servletã€JDBCã€Springã€Strutsã€Hibernateã€HTMLã€CSSã€JavaScriptã€Pythonç­‰ã€‚</p><p>ä¸¾ä¸€ä¸ªäº¤æ˜“ç½‘ç«™çš„ä¾‹å­ï¼Œæ ¸å¿ƒæ¨¡å—æœ‰<strong>ç”¨æˆ·ã€å•†å“å’Œäº¤æ˜“</strong>ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010119.png" alt></p><h3 id="2-2-å•æœºè´Ÿè½½å‘Šè­¦ï¼Œæ•°æ®åº“ä¸åº”ç”¨åˆ†ç¦»"><a href="#2-2-å•æœºè´Ÿè½½å‘Šè­¦ï¼Œæ•°æ®åº“ä¸åº”ç”¨åˆ†ç¦»" class="headerlink" title="2.2 å•æœºè´Ÿè½½å‘Šè­¦ï¼Œæ•°æ®åº“ä¸åº”ç”¨åˆ†ç¦»"></a><strong>2.2 å•æœºè´Ÿè½½å‘Šè­¦ï¼Œæ•°æ®åº“ä¸åº”ç”¨åˆ†ç¦»</strong></h3><p>éšç€è®¿é—®é‡å¢åŠ ï¼Œå•å°æœåŠ¡å™¨è´Ÿè½½æŒç»­å¢é«˜ï¼Œæˆ‘ä»¬é¦–å…ˆæŠŠæ•°æ®åº“ä¸åº”ç”¨åˆ†å¼€åˆ°ä¸¤æ¡æœåŠ¡å™¨ã€‚è¿™ç§å˜æ›´å¯¹ç³»ç»Ÿå½±å“å¾ˆå°ï¼Œåªé¡»ä¿®æ”¹æ•°æ®åº“åœ°å€å³å¯ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010120.png" alt></p><h3 id="2-3-åº”ç”¨æœåŠ¡å™¨è´Ÿè½½å‘Šè­¦ï¼Œèµ°å‘é›†ç¾¤"><a href="#2-3-åº”ç”¨æœåŠ¡å™¨è´Ÿè½½å‘Šè­¦ï¼Œèµ°å‘é›†ç¾¤" class="headerlink" title="2.3 åº”ç”¨æœåŠ¡å™¨è´Ÿè½½å‘Šè­¦ï¼Œèµ°å‘é›†ç¾¤"></a><strong>2.3 åº”ç”¨æœåŠ¡å™¨è´Ÿè½½å‘Šè­¦ï¼Œèµ°å‘é›†ç¾¤</strong></h3><p>åº”ç”¨æœåŠ¡å™¨å‹åŠ›ä¸æ–­å¢åŠ ï¼Œå¯ä»¥æ ¹æ®ç›‘æµ‹æ¥è¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬é€‰ç”¨å°†åº”ç”¨æœåŠ¡å™¨ç”±å•æœºè½¬ä¸ºé›†ç¾¤çš„ä¼˜åŒ–æ–¹å¼ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010121.png" alt></p><h4 id="ï¼ˆ1ï¼‰å•æœºè½¬ä¸ºé›†ç¾¤çš„ä¸¤ä¸ªé—®é¢˜"><a href="#ï¼ˆ1ï¼‰å•æœºè½¬ä¸ºé›†ç¾¤çš„ä¸¤ä¸ªé—®é¢˜" class="headerlink" title="ï¼ˆ1ï¼‰å•æœºè½¬ä¸ºé›†ç¾¤çš„ä¸¤ä¸ªé—®é¢˜"></a><strong>ï¼ˆ1ï¼‰å•æœºè½¬ä¸ºé›†ç¾¤çš„ä¸¤ä¸ªé—®é¢˜</strong></h4><p>å˜æ›´ä¸ºé›†ç¾¤ä¼šå¸¦æ¥ä¸¤ä¸ªè¦è§£å†³çš„é—®é¢˜ï¼š</p><ul><li>ä¸¤ä¸ªåº”ç”¨æœåŠ¡å™¨çš„é€‰æ‹©é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡DNSæˆ–è´Ÿè½½å‡è¡¡è®¾å¤‡æ¥è§£å†³ã€‚</li><li>Sessioné—®é¢˜ã€‚</li></ul><p>å¼•å…¥è´Ÿè½½å‡è¡¡è®¾å¤‡åï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010122.png" alt></p><p>æˆ‘ä»¬çŸ¥é“HTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸ºäº†æ”¯æŒæœ‰çŠ¶æ€çš„ä¼šè¯éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦Sessionæœºåˆ¶ï¼Œåœ¨ä¼šè¯å¼€å§‹æ—¶åˆ†é…ä¸€ä¸ªSessionIdï¼Œé€šè¿‡Cookieå‘ŠçŸ¥æµè§ˆå™¨ï¼Œä»¥åä¼šè¯ä¸­çš„æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦æ­¤SessionIdæ¥å‘ŠçŸ¥WebæœåŠ¡å™¨æ­¤æ¬¡å±äºå“ªä¸ªä¼šè¯ã€‚<strong>WebæœåŠ¡å™¨éœ€è¦ç‹¬ç«‹çš„å­˜å‚¨ä¼šè¯ä¿¡æ¯</strong>ï¼Œå½“Cookieç¦ç”¨æ—¶ä¼šæ‹¼æ¥åˆ°URLä¸­ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010123.png" alt></p><p>æ‰€ä»¥å½“æœåŠ¡å™¨å˜ä¸ºä¸¤å°æ—¶ï¼ŒSessionå°±å‡ºç°äº†é—®é¢˜ï¼Œä¿å­˜åœ¨å•æœºä¸Šçš„ä¼šè¯ï¼Œå’Œéšæœºè®¿é—®ä»»ä¸€æœåŠ¡å™¨çš„ä¼šè¯è¯·æ±‚äº§ç”Ÿäº†çŸ›ç›¾ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010124.png" alt></p><h4 id="ï¼ˆ2ï¼‰Sessioné—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"><a href="#ï¼ˆ2ï¼‰Sessioné—®é¢˜çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ï¼ˆ2ï¼‰Sessioné—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"></a><strong>ï¼ˆ2ï¼‰Sessioné—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</strong></h4><ol><li><p><strong>Session Sticky</strong>ï¼šé€šè¿‡è´Ÿè½½å‡è¡¡å™¨ä¿è¯åŒä¸€ä¸ªä¼šè¯çš„è¯·æ±‚éƒ½åœ¨åŒä¸€ä¸ªWebæœåŠ¡å™¨ä¸Šå¤„ç†ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010125.png" alt></p><p>æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œä½†ä¹Ÿå­˜åœ¨é—®é¢˜ï¼š</p><ul><li>ä¸€å°æœåŠ¡å™¨å®•æœºæˆ–é‡å¯ï¼Œå…¶ä¼šè¯æ•°æ®ä¼šä¸¢å¤±ï¼Œå¯¹åº”çš„ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•ï¼›</li><li>å› ä¸ºä¼šè¯æ ‡è¯†æ˜¯åº”ç”¨å±‚çš„ä¿¡æ¯ï¼Œè´Ÿè½½å‡è¡¡å™¨å°†ä¼šè¯è¯·æ±‚ä¿å­˜åœ¨åŒä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œéœ€è¦è¿›è¡Œåº”ç”¨å±‚ï¼ˆç¬¬7å±‚ï¼‰çš„è§£æï¼Œå¼€é”€ä¼šæ¯”ç¬¬4å±‚çš„äº¤æ¢å¤§ï¼›</li><li>è´Ÿè½½å‡è¡¡å™¨ä¹Ÿå˜æˆäº†ä¸€ä¸ªæœ‰çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œç›¸æ¯”æ— çŠ¶æ€èŠ‚ç‚¹ï¼Œå†…å­˜æ¶ˆè€—æ›´å¤§ï¼Œå®¹ç¾æ–¹é¢æ›´éº»çƒ¦ã€‚</li></ul></li><li><p><strong>Session Replication</strong>ï¼šæ¯å°WebæœåŠ¡å™¨éƒ½ä¿å­˜ç›¸åŒçš„ä¼šè¯ä¿¡æ¯ã€‚éœ€è¦åœ¨WebæœåŠ¡å™¨é—´è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¿è¯Sessionæ•°æ®ä¸€è‡´ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010126.png" alt></p><p>åŒæ ·ä¹Ÿæœ‰å…¶é—®é¢˜ï¼š</p><ul><li><strong>ç½‘ç»œå¼€é”€è¶Šæ¥è¶Šå¤§</strong>ï¼šåŒæ­¥Sessionæ•°æ®å¯¼è‡´äº†ç½‘ç»œå¸¦å®½çš„å¼€é”€ï¼Œåªè¦Sessionæ•°æ®æœ‰å˜åŒ–ï¼Œå°±éœ€è¦åŒæ­¥åˆ°æ‰€æœ‰æœºå™¨ï¼Œæœºå™¨æ•°è¶Šå¤šï¼Œå¸¦æ¥çš„ç½‘ç»œå¼€é”€è¶Šå¤§ï¼›</li><li><strong>å†…å­˜å ç”¨è¶Šæ¥è¶Šå¤§</strong>ï¼šæ¯å°æœåŠ¡å™¨éƒ½è¦ä¿å­˜æ‰€æœ‰çš„Sessionæ•°æ®ï¼Œå½“æ•´ä¸ªé›†ç¾¤çš„ç”¨æˆ·é‡å¾ˆå¤šæ—¶ï¼Œä¿å­˜æ•°æ®æ‰€éœ€çš„ç©ºé—´ä¼šå¾ˆå¤§ã€‚</li></ul></li><li><p><strong>Sessionæ•°æ®é›†ä¸­å­˜å‚¨</strong>ï¼šé›†ä¸­çš„å­˜æ”¾æ‰€æœ‰çš„Sessionæ•°æ®ï¼Œæ‰€æœ‰WebæœåŠ¡å™¨å‘åŒæ ·åœ°å€è·å–Sessionã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010127.png" alt></p><p>æ­¤æ–¹æ¡ˆçš„é—®é¢˜ï¼š</p><ul><li>è¯»å†™Sessionæ•°æ®å¼•å…¥äº†ç½‘ç»œæ“ä½œï¼Œç›¸æ¯”æœ¬æœºæ•°æ®è¯»å–å­˜åœ¨æ—¶å»¶å’Œä¸ç¨³å®šè¡Œï¼ˆå†…ç½‘é€šä¿¡å¥½ä¸€äº›ï¼‰ï¼›</li><li>é›†ä¸­å­˜å‚¨Sessionçš„æœºå™¨æœ‰é—®é¢˜ï¼Œä¼šå½±å“æ•´ä¸ªåº”ç”¨ï¼ˆæ‰©å±•é›†ç¾¤ï¼‰ã€‚</li></ul></li><li><p><strong>Cookie Based</strong>ï¼šæŠŠSessionå­˜æ”¾åœ¨Cookieä¸­ï¼ŒWebæœåŠ¡å™¨ä»Cookieä¸­ç”Ÿæˆå¯¹åº”Sessionæ•°æ®ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010128.png" alt></p><p>æ­¤æ–¹æ¡ˆçš„ä¸è¶³ï¼š</p><ul><li>Cookieæœ‰<strong>é•¿åº¦é™åˆ¶</strong>ï¼›</li><li><strong>å®‰å…¨æ€§</strong>ï¼šSessionæ•°æ®æœ¬èº«æ˜¯æœåŠ¡ç«¯æ•°æ®ï¼Œæ­¤æ–¹æ¡ˆæ˜¯ç”±å®¢æˆ·ç«¯å­˜æ”¾é€šè¿‡å¤–éƒ¨ç½‘ç»œä¼ è¾“ï¼Œæ‰€ä»¥è¦å¯¹å†™å…¥Cookieçš„Sessionæ•°æ®è¿›è¡ŒåŠ å¯†ï¼ˆå¹¶ä¸ç»å¯¹å®‰å…¨ï¼‰ã€‚</li><li><strong>å¸¦å®½æ¶ˆè€—</strong>ï¼šæŒ‡æ•°æ®ä¸­å¿ƒæ•´ä½“å¤–éƒ¨å¸¦å®½çš„æ¶ˆè€—ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½å¢åŠ äº†æ•°æ®ï¼‰ã€‚</li><li><strong>æ€§èƒ½å½±å“</strong>ï¼šæ¯æ¬¡HTTPè¯·æ±‚å’Œå“åº”éƒ½å¸¦æœ‰Sessionæ•°æ®ï¼Œå¯¹WebæœåŠ¡å™¨æ¥è¯´ï¼Œå“åº”çš„ç»“æœè¾“å‡ºè¶Šå°‘ï¼Œæ”¯æŒçš„å¹¶å‘è¯·æ±‚å°±è¶Šå¤šã€‚</li></ul></li></ol><p>å¤§å‹ç½‘ç«™æ¯”è¾ƒé€‚åˆ <strong>Session Sticky</strong> å’Œ <strong>Sessionæ•°æ®é›†ä¸­å­˜å‚¨</strong> ï¼Œæ ¹æ®å…·ä½“åœºæ™¯åšå‡ºé€‰æ‹©å’Œæƒè¡¡ã€‚</p><h3 id="2-4-æ•°æ®è¯»å‹åŠ›å¢å¤§ï¼Œè¯»å†™åˆ†ç¦»"><a href="#2-4-æ•°æ®è¯»å‹åŠ›å¢å¤§ï¼Œè¯»å†™åˆ†ç¦»" class="headerlink" title="2.4 æ•°æ®è¯»å‹åŠ›å¢å¤§ï¼Œè¯»å†™åˆ†ç¦»"></a><strong>2.4 æ•°æ®è¯»å‹åŠ›å¢å¤§ï¼Œè¯»å†™åˆ†ç¦»</strong></h3><h4 id="ï¼ˆ1ï¼‰é‡‡ç”¨æ•°æ®åº“ä½œä¸ºè¯»åº“"><a href="#ï¼ˆ1ï¼‰é‡‡ç”¨æ•°æ®åº“ä½œä¸ºè¯»åº“" class="headerlink" title="ï¼ˆ1ï¼‰é‡‡ç”¨æ•°æ®åº“ä½œä¸ºè¯»åº“"></a><strong>ï¼ˆ1ï¼‰é‡‡ç”¨æ•°æ®åº“ä½œä¸ºè¯»åº“</strong></h4><p>å¯¹äºå¤§å‹ç½‘ç«™ï¼Œå¤§éƒ¨åˆ†ä¸šåŠ¡æ˜¯è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥è€ƒè™‘<strong>è¯»å†™åˆ†ç¦»</strong>çš„æ–¹å¼ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨æ¶æ„ä¸­å¢åŠ ä¸€ä¸ªè¯»åº“ï¼Œå®ƒåªè´Ÿè´£è¯»å–æœåŠ¡ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010129.png" alt></p><p>å¸¦æ¥é—®é¢˜ï¼š</p><ul><li><p><strong>æ•°æ®å¤åˆ¶é—®é¢˜</strong>ï¼šæ•°æ®åº“ä¸€èˆ¬ä¼šæä¾›æ•°æ®å¤åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><ul><li>è¦è€ƒè™‘æ•°æ®å¤åˆ¶çš„æ—¶å»¶é—®é¢˜;</li><li>å¤åˆ¶è¿‡ç¨‹ä¸­æ•°æ®çš„æºå’Œç›®æ ‡ä¹‹é—´çš„æ˜ å°„å…³ç³»åŠè¿‡æ»¤æ¡ä»¶çš„æ”¯æŒé—®é¢˜ã€‚</li></ul><p>æ•°æ®åº“æ”¯æŒï¼šï¼ˆæ•°æ®åº“å¯¹æ•°æ®å¤åˆ¶çš„æ”¯æŒæ˜¯ç›¸å¯¹æœ‰é™çš„ï¼‰</p><ul><li>MySQLï¼šMasterï¼ˆä¸»åº“ï¼‰+ Slaveï¼ˆå¤‡åº“ï¼‰çš„ç»“æ„ï¼Œ5.5ç‰ˆæœ¬ä¹‹å‰éƒ½æ˜¯å¼‚æ­¥æ•°æ®å¤åˆ¶ï¼Œä¼šæœ‰å»¶è¿Ÿï¼Œæä¾›å®Œå…¨é•œåƒæ–¹å¼çš„å¤åˆ¶ï¼Œä¿è¯äº†å¤‡åº“å’Œä¸»åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚5.5ååŠ å…¥äº† semi-sync ï¼Œåœ¨æ•°æ®å®‰å…¨æ€§ä¸Šæ›´å¥½ï¼Œä½†ä»è¯»å†™åˆ†ç¦»çš„è§’åº¦çœ‹ä»æœ‰å¤åˆ¶å»¶è¿Ÿçš„å¯èƒ½ã€‚</li><li>Oracleï¼šData Guardæ–¹æ¡ˆï¼Œä¸»è¦ç”¨äºå®¹ç¾ã€æ•°æ®åº“ä¿æŠ¤ä»¥åŠæ•…éšœæ¢å¤ç­‰åœºæ™¯ï¼Œåœ¨å®æ–½ä¸­åˆåˆ†ä¸ºç‰©ç†å¤‡åº“ï¼ˆç‰©ç†StandByï¼‰å’Œé€»è¾‘å¤‡åº“ï¼ˆé€»è¾‘StandByï¼‰ã€‚</li></ul></li></ul><ul><li><strong>åº”ç”¨å¯¹äºæ•°æ®æºçš„é€‰æ‹©é—®é¢˜</strong>ï¼šå†™æ“ä½œèµ°ä¸»åº“ï¼Œäº‹åŠ¡è¯»ä¹Ÿè¦èµ°ä¸»åº“ï¼Œè¿˜è¦è€ƒè™‘å¤‡åº“æ•°æ®ç›¸å¯¹äºä¸»åº“çš„å»¶è¿Ÿã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰æœç´¢å¼•æ“"><a href="#ï¼ˆ2ï¼‰æœç´¢å¼•æ“" class="headerlink" title="ï¼ˆ2ï¼‰æœç´¢å¼•æ“"></a><strong>ï¼ˆ2ï¼‰æœç´¢å¼•æ“</strong></h4><p>å½“æˆ‘ä»¬éœ€è¦æ ¹æ®å•†å“æ ‡é¢˜æŸ¥è¯¢å•†å“ä¿¡æ¯æ—¶ï¼Œå¸¸è§„åšæ³•æ˜¯é€šè¿‡æ•°æ®åº“çš„ <code>like</code> åŠŸèƒ½è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ã€‚ä½¿ç”¨æœç´¢å¼•æ“çš„å€’æ’è¡¨æ–¹å¼å¯ä»¥å¤§å¤§æå‡æ£€ç´¢é€Ÿåº¦ã€‚</p><p>æœç´¢å¼•æ“é¦–å…ˆè¦æ ¹æ®è¢«æœç´¢æ•°æ®æ„å»ºç´¢å¼•ï¼Œæ•°æ®æ”¹å˜ç´¢å¼•ä¹Ÿè¦æ”¹å˜ã€‚åº”ç”¨è¦é€‰æ‹©ä»€ä¹ˆæ•°æ®èµ°æœç´¢å¼•æ“ï¼Œä»€ä¹ˆæ•°æ®èµ°æ•°æ®åº“ã€‚æ„å»ºç´¢å¼•çš„è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€ç§æ•°æ®å¤åˆ¶çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡ä¸æ˜¯ç®€å•çš„å¤åˆ¶å¯¹åº”æ•°æ®ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010130.png" alt></p><p>å¯ä»¥ä»ä¸¤ä¸ªç»´åº¦å¯¹æœç´¢ç³»ç»Ÿæ„å»ºç´¢å¼•çš„æ–¹å¼è¿›è¡Œåˆ’åˆ†ï¼š</p><ul><li>æŒ‰ç…§<strong>å…¨é‡/å¢é‡</strong>åˆ’åˆ†ï¼šç¬¬ä¸€æ¬¡æ„å»ºç´¢å¼•ç”¨å…¨é‡ï¼Œåœ¨å…¨é‡åŸºç¡€ä¸Šé‡‡ç”¨å¢é‡æ–¹å¼æ›´æ–°ç´¢å¼•ï¼ˆä¸€èˆ¬åŠ å…¥æ¯æ—¥çš„å…¨é‡ä½œä¸ºè¡¥å……ï¼‰ã€‚</li><li>æŒ‰ç…§<strong>å®æ—¶/éå®æ—¶</strong>åˆ’åˆ†ï¼šæ›´æ–°æ—¶é—´ä¸Šå€¾å‘äºå®æ—¶çš„æ–¹å¼ï¼Œéå®æ—¶ä¸»è¦è€ƒè™‘å¯¹æ•°æ®æºå¤´çš„ä¿æŠ¤ã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰ç¼“å­˜"><a href="#ï¼ˆ3ï¼‰ç¼“å­˜" class="headerlink" title="ï¼ˆ3ï¼‰ç¼“å­˜"></a><strong>ï¼ˆ3ï¼‰ç¼“å­˜</strong></h4><ol><li><p><strong>æ•°æ®ç¼“å­˜</strong>ï¼šæ•°æ®ç¼“å­˜çš„ç›®çš„ç±»ä¼¼äºè¯»åº“ï¼Œä¸€èˆ¬ç”¨æ¥ä¿å­˜å’ŒæŸ¥è¯¢é”®å€¼å¯¹ï¼Œæ¥åŠ é€Ÿåº”ç”¨åœ¨å“åº”è¯·æ±‚æ—¶çš„æ•°æ®è¯»å–é€Ÿåº¦ã€‚</p><p>ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><strong>åº”ç”¨ä¸»åŠ¨æ›´æ–°ç¼“å­˜</strong>ï¼šåº”ç”¨è®¿é—®ç¼“å­˜ï¼Œæ•°æ®ä¸å­˜åœ¨åˆ™ä»æ•°æ®åº“è¯»å‡ºå¹¶æ”¾å…¥ç¼“å­˜ï¼Œå½“ç¼“å­˜å®¹é‡ä¸è¶³æ—¶æ¸…é™¤æœ€è¿‘ä¸è¢«è®¿é—®çš„æ•°æ®ã€‚</li><li><strong>æ•°æ®åº“è®°å½•å˜åŒ–æ›´æ–°ç¼“å­˜</strong>ï¼šæ•°æ®åº“å‘ç”Ÿå˜åŒ–ï¼Œä¸»åŠ¨æŠŠæ•°æ®æ”¾å…¥ç¼“å­˜ï¼Œè¿™æ ·èƒ½å¤ŸåŠæ—¶æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä¸ä¼šé€ æˆè¯»å–å¤±æ•ˆã€‚<strong>ä¸€èˆ¬ç”¨äºå…¨æ•°æ®ç¼“å­˜ï¼Œè¦æ±‚ç›¸å…³ä»£ç è¦ç»“åˆä¸šåŠ¡é€»è¾‘ã€‚</strong></li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010131.png" alt></p></li><li><p><strong>é¡µé¢ç¼“å­˜</strong>ï¼šç¼“å­˜ä¸€äº›åŠ¨æ€äº§ç”Ÿçš„é¡µé¢æˆ–é¡µé¢çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼ŒESIæ˜¯ä¸€ç§é’ˆå¯¹è¿™ç§æƒ…å†µçš„è§„èŒƒã€‚</p><ul><li>WebæœåŠ¡å™¨äº§ç”Ÿçš„è¯·æ±‚å“åº”ç»“æœè¿”å›ç»™Apacheï¼Œå¤„ç†åæ‰¾åˆ°ESIæ ‡ç­¾ï¼Œåœ¨ç¼“å­˜ä¸­è·å–æ ‡ç­¾å¯¹åº”å†…å®¹ï¼›è‹¥å†…å®¹ä¸å­˜åœ¨ï¼ŒApacheæ¨¡æ¿é€šè¿‡WebæœåŠ¡å™¨æ¸²æŸ“è¿™äº›å†…å®¹ï¼Œå†æŠŠç»“æœæ”¾å›ç¼“å­˜ï¼Œç”¨å†…å®¹æ›¿æ¢æ‰ESIæ ‡ç­¾å¹¶è¿”å›ç»™å®¢æˆ·ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010132.png" alt></p><ul><li>ESIæ¨¡å—æ€»æ˜¯è¦å¯¹å“åº”ç»“æœè¿›è¡Œè§£æï¼ŒWebæœåŠ¡å™¨å¤„ç†æ—¶ç›´æ¥å®Œæˆè¿™é¡¹å·¥ä½œæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚æ‰€ä»¥æ”¹è¿›ä¸ºå¦‚ä¸‹ç»“æ„ï¼ŒæŠŠæ¸²æŸ“å’Œç¼“å­˜åŠŸèƒ½æ”¾åœ¨WebæœåŠ¡å™¨ï¼Œè¿™æ ·æ›´é«˜æ•ˆä¸€äº›ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010133.png" alt></p></li></ol><p>ä½¿ç”¨ç¼“å­˜æ¥åŠ é€Ÿæ•°æ®è¯»å–æ—¶è¦æ³¨æ„ï¼š</p><ul><li>ç¼“å­˜å‘½ä¸­ç‡ï¼šå¤ªä½å°±å¯¼è‡´å¤§é‡è¯·æ±‚ä»è¦å›åˆ°æ•°æ®åº“ï¼›</li><li>æ•°æ®çš„åˆ†å¸ƒå’Œæ›´æ–°ç­–ç•¥ï¼š<ul><li>åˆ†å¸ƒä¸Šè¦è€ƒè™‘<strong>é¿å…å±€éƒ¨çƒ­ç‚¹</strong>çš„æœºåˆ¶ï¼Œç¼“å­˜æœåŠ¡å™¨çš„æ‰©å®¹å’Œç¼©å®¹è¦å°½é‡å¹³æ»‘ï¼ˆè€ƒè™‘<strong>ä¸€è‡´æ€§Has</strong>hï¼‰ï¼›</li><li>æ›´æ–°ä¸Šä¼šæœ‰<strong>å®šæ—¶å¤±æ•ˆã€æ•°æ®å˜æ›´æ—¶å¤±æ•ˆå’Œæ•°æ®å˜æ›´æ—¶æ›´æ–°</strong>å‡ ç§ç­–ç•¥ã€‚</li></ul></li></ul><h3 id="2-5-å¼•å…¥åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ"><a href="#2-5-å¼•å…¥åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ" class="headerlink" title="2.5 å¼•å…¥åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ"></a><strong>2.5 å¼•å…¥åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</strong></h3><p>å¸¸è§çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼š</p><ul><li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼šå¼±æ ¼å¼ï¼Œå†…å®¹æ ¼å¼éœ€è¦è‡ªè¡Œç»„ç»‡ï¼Œè§£å†³å°æ–‡ä»¶å’Œå¤§æ–‡ä»¶çš„å­˜å‚¨é—®é¢˜ï¼›</li><li>åˆ†å¸ƒå¼Key-Valueç³»ç»Ÿï¼šæä¾›é«˜æ€§èƒ½çš„åŠç»“æ„åŒ–æ”¯æŒï¼›</li><li>åˆ†å¸ƒå¼æ•°æ®åº“ï¼šæä¾›ä¸€ä¸ªæ”¯æŒå¤§æ•°æ®ã€é«˜å¹¶å‘çš„æ•°æ®åº“ç³»ç»Ÿã€‚</li></ul><p>åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿé€šè¿‡é›†ç¾¤æä¾›äº†ä¸€ä¸ªé«˜å®¹é‡ã€é«˜å¹¶å‘è®¿é—®ã€æ•°æ®å†—ä½™å®¹ç¾çš„æ”¯æŒï¼Œç›´æ¥ä»£æ›¿åŸå…ˆçš„å•æœºä¸»åº“ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010134.png" alt></p><h3 id="2-6-è¯»å†™åˆ†ç¦»åï¼Œæ•°æ®åº“åˆé‡åˆ°ç“¶é¢ˆ"><a href="#2-6-è¯»å†™åˆ†ç¦»åï¼Œæ•°æ®åº“åˆé‡åˆ°ç“¶é¢ˆ" class="headerlink" title="2.6 è¯»å†™åˆ†ç¦»åï¼Œæ•°æ®åº“åˆé‡åˆ°ç“¶é¢ˆ"></a><strong>2.6 è¯»å†™åˆ†ç¦»åï¼Œæ•°æ®åº“åˆé‡åˆ°ç“¶é¢ˆ</strong></h3><p>è™½ç„¶è¿›è¡Œäº†ä»¥ä¸Šçš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬çš„æ ¸å¿ƒåŠŸèƒ½æ•°æ®ï¼ˆç”¨æˆ·ã€å•†å“å’Œäº¤æ˜“ï¼‰è¿˜éƒ½åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œéšç€æ•°æ®é‡å’Œè®¿é—®é‡çš„å¢å¤§ï¼Œæ•°æ®åº“çš„å‹åŠ›è¿˜åœ¨ä¸æ–­å¢åŠ ã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬éœ€è¦è¿›è¡Œæ•°æ®çš„<strong>å‚ç›´æ‹†åˆ†</strong>å’Œ<strong>æ°´å¹³æ‹†åˆ†</strong>ã€‚</p><h4 id="ï¼ˆ1ï¼‰ä¸“åº“ä¸“ç”¨ï¼Œæ•°æ®å‚ç›´æ‹†åˆ†"><a href="#ï¼ˆ1ï¼‰ä¸“åº“ä¸“ç”¨ï¼Œæ•°æ®å‚ç›´æ‹†åˆ†" class="headerlink" title="ï¼ˆ1ï¼‰ä¸“åº“ä¸“ç”¨ï¼Œæ•°æ®å‚ç›´æ‹†åˆ†"></a><strong>ï¼ˆ1ï¼‰ä¸“åº“ä¸“ç”¨ï¼Œæ•°æ®å‚ç›´æ‹†åˆ†</strong></h4><p>å‚ç›´æ‹†åˆ†å°±æ˜¯<strong>æŠŠæ•°æ®åº“ä¸­ä¸åŒä¸šåŠ¡æ•°æ®æ‹†åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“</strong>ï¼Œå¯¹äºäº¤æ˜“ç³»ç»Ÿè¿™ä¸ªä¾‹å­å°±æ˜¯æŠŠç”¨æˆ·ã€å•†å“ã€äº¤æ˜“æ•°æ®åˆ†å¼€ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010135.png" alt></p><p>å¸¦æ¥çš„å½±å“ï¼š</p><ul><li>åº”ç”¨é…ç½®å¤šæ•°æ®æºï¼›</li><li>å•æœºè·¨ä¸šåŠ¡äº‹åŠ¡è¦è½¬ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡ï¼›</li><li>è¡¨å…³è”è¦æ”¹å˜å®ç°ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰å‚ç›´æ‹†åˆ†åçš„å•æœºä»æœ‰ç“¶é¢ˆï¼Œæ•°æ®æ°´å¹³æ‹†åˆ†"><a href="#ï¼ˆ2ï¼‰å‚ç›´æ‹†åˆ†åçš„å•æœºä»æœ‰ç“¶é¢ˆï¼Œæ•°æ®æ°´å¹³æ‹†åˆ†" class="headerlink" title="ï¼ˆ2ï¼‰å‚ç›´æ‹†åˆ†åçš„å•æœºä»æœ‰ç“¶é¢ˆï¼Œæ•°æ®æ°´å¹³æ‹†åˆ†"></a><strong>ï¼ˆ2ï¼‰å‚ç›´æ‹†åˆ†åçš„å•æœºä»æœ‰ç“¶é¢ˆï¼Œæ•°æ®æ°´å¹³æ‹†åˆ†</strong></h4><p>æ°´å¹³æ‹†åˆ†å°±æ˜¯<strong>æŠŠåŒä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªæ•°æ®åº“ä¸­</strong>ã€‚ä¸€èˆ¬æ˜¯å› ä¸ºæŸä¸ªä¸šåŠ¡çš„æ•°æ®è¡¨çš„æ•°æ®é‡å¤ªå¤§ï¼Œè¾¾åˆ°äº†å•ä¸ªæ•°æ®åº“çš„ç“¶é¢ˆã€‚</p><p><strong>æ°´å¹³æ‹†åˆ†ä¸è¯»å†™åˆ†ç¦»</strong>ï¼šè¯»å†™åˆ†ç¦»è§£å†³çš„æ˜¯è¯»å‹åŠ›è¿‡å¤§çš„é—®é¢˜ï¼Œå¯¹äºæ•°æ®é‡å¤§æˆ–æ›´æ–°é‡çš„æƒ…å†µå¹¶ä¸èµ·ä½œç”¨ã€‚</p><p><strong>æ°´å¹³æ‹†åˆ†ä¸å‚ç›´æ‹†åˆ†</strong>ï¼šå‚ç›´æ‹†åˆ†æŠŠä¸åŒè¡¨æ”¾åˆ°ä¸åŒæ•°æ®åº“ï¼Œæ°´å¹³æ‹†åˆ†æŠŠåŒä¸€ä¸ªè¡¨æ‹†åˆ°ä¸åŒæ•°æ®åº“ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010136.png" alt></p><p>å¸¦æ¥çš„å½±å“ï¼šï¼ˆå‡è®¾æ‹†åˆ†ç”¨æˆ·è¡¨ï¼‰</p><ul><li><strong>è§£å†³SQLè·¯ç”±é—®é¢˜</strong>ï¼šç”¨æˆ·ä¿¡æ¯è¢«åˆ‡åˆ†åˆ°äº†ä¸¤ä¸ªåº“ï¼Œåœ¨è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶è¦çŸ¥é“æ“ä½œçš„æ•°æ®åœ¨å“ªä¸ªåº“ã€‚</li><li><strong>è§£å†³ä¸»é”®é—®é¢˜</strong>ï¼šåŸå…ˆå¯èƒ½æ˜¯Oracleçš„ Sequence æˆ–MySQLçš„è‡ªå¢å­—æ®µï¼Œç°åœ¨è¦ä¿è¯å¤šä¸ªåº“çš„ä¸»é”®ä¸é‡å¤ã€‚</li><li><strong>ä¿®æ”¹æŸ¥è¯¢</strong>ï¼šåŒä¸ªä¸šåŠ¡çš„æ•°æ®è¢«æ‹†åˆ†åˆ°ä¸åŒæ•°æ®åº“ï¼Œæ‰€ä»¥ä¸€äº›æŸ¥è¯¢è¦ä»å¤šä¸ªåº“å–æ•°æ®ï¼Œå¦‚æœè¿˜è¦åˆ†é¡µå°±å¾ˆéš¾å¤„ç†ã€‚</li></ul><p>å®Œæˆæ°´å¹³æ‹†åˆ†åï¼Œæˆ‘ä»¬èƒ½å¾ˆå¥½çš„åº”å¯¹æ•°æ®é‡åŠå†™å…¥é‡å¢é•¿çš„æƒ…å†µã€‚</p><h3 id="2-7-å•æœºè´Ÿè½½å‘Šè­¦ï¼Œæ•°æ®åº“ä¸åº”ç”¨åˆ†ç¦»"><a href="#2-7-å•æœºè´Ÿè½½å‘Šè­¦ï¼Œæ•°æ®åº“ä¸åº”ç”¨åˆ†ç¦»" class="headerlink" title="2.7 å•æœºè´Ÿè½½å‘Šè­¦ï¼Œæ•°æ®åº“ä¸åº”ç”¨åˆ†ç¦»"></a><strong>2.7 å•æœºè´Ÿè½½å‘Šè­¦ï¼Œæ•°æ®åº“ä¸åº”ç”¨åˆ†ç¦»</strong></h3><p>è§£å†³å®Œæ•°æ®åº“é—®é¢˜åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹åº”ç”¨çš„å˜åŒ–ã€‚æˆ‘ä»¬ä¹‹å‰å®Œæˆäº†åº”ç”¨æœåŠ¡å™¨ä»å•æœºåˆ°å¤šæœºçš„æ‰©å±•ï¼Œä½†éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œåº”ç”¨åŠŸèƒ½è¶Šæ¥è¶Šå¤šï¼Œä¸ºäº†æ§åˆ¶åº”ç”¨çš„å¤§å°ï¼Œæˆ‘ä»¬éœ€è¦æŠŠåº”ç”¨æ‹†å¼€ã€‚</p><h4 id="ï¼ˆ1ï¼‰æ‹†åˆ†åº”ç”¨"><a href="#ï¼ˆ1ï¼‰æ‹†åˆ†åº”ç”¨" class="headerlink" title="ï¼ˆ1ï¼‰æ‹†åˆ†åº”ç”¨"></a><strong>ï¼ˆ1ï¼‰æ‹†åˆ†åº”ç”¨</strong></h4><p><strong>æ ¹æ®ä¸šåŠ¡ç‰¹æ€§æ‹†åˆ†</strong>ï¼šäº¤æ˜“ç³»ç»Ÿä¸­å°±æ˜¯æ‹†æˆåˆ†åˆ«ä»¥äº¤æ˜“å’Œå•†å“ä¸ºä¸»çš„ä¸¤ä¸ªåº”ç”¨ï¼Œå½“ç„¶ä¸¤ä¸ªåº”ç”¨éƒ½æœ‰æ¶‰åŠç”¨æˆ·çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å…ˆç²—ç³™çš„è®©ç³»ç»Ÿå„è‡ªå®Œæˆç”¨æˆ·å·¥ä½œã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010137.png" alt></p><p>é€šå¸¸æ–°æ‹†å‡ºçš„åº”ç”¨ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œä½†å¯èƒ½ä¼šé“¾æ¥ç›¸åŒçš„æ•°æ®åº“ã€‚å¦‚ä¸‹ï¼Œæˆ‘ä»¬æ‹†åˆ†äº†å‡ ä¸ªä¸šåŠ¡ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„è°ƒç”¨ï¼Œéƒ½ä¾èµ–åº•å±‚çš„æ•°æ®åº“ã€ç¼“å­˜ã€æ–‡ä»¶ç³»ç»Ÿã€æœç´¢ç­‰ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010138.png" alt></p><h4 id="ï¼ˆ2ï¼‰æœåŠ¡åŒ–"><a href="#ï¼ˆ2ï¼‰æœåŠ¡åŒ–" class="headerlink" title="ï¼ˆ2ï¼‰æœåŠ¡åŒ–"></a><strong>ï¼ˆ2ï¼‰æœåŠ¡åŒ–</strong></h4><p>å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨åˆ†æˆäº†ä¸‰å±‚ï¼Œæœ€ä¸Šå±‚æ˜¯Webç³»ç»Ÿï¼Œç”¨äºå®Œæˆä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½ï¼›ä¸­é—´å±‚æ˜¯æœåŠ¡ä¸­å¿ƒï¼Œå„è‡ªæä¾›ä¸åŒçš„ä¸šåŠ¡æœåŠ¡ï¼›æœ€ä¸‹å±‚åˆ™æ˜¯ä¸šåŠ¡çš„æ•°æ®åº“ã€‚ï¼ˆå›¾ä¸­çœç•¥äº†ç¼“å­˜ç­‰åŸºç¡€ç³»ç»Ÿï¼‰</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010139.png" alt></p><p>æœåŠ¡åŒ–çš„åŒºåˆ«ï¼š</p><ul><li><strong>æ–¹æ³•è°ƒç”¨</strong>ï¼šä¸šåŠ¡åŠŸèƒ½å†…ä¸ä»…ä»…æ˜¯å•æœºçš„å†…éƒ¨æ–¹æ³•è°ƒç”¨äº†ï¼Œè¿˜<strong>éœ€è¦è¿œç¨‹æœåŠ¡è°ƒç”¨</strong>ï¼ˆRPCï¼‰ï¼›</li><li><strong>å…±äº«ä»£ç </strong>ï¼šä¸å†æ˜¯æ•£è½åœ¨ä¸åŒçš„åº”ç”¨ï¼Œè€Œæ˜¯<strong>é›†ä¸­åœ¨å„ä¸ªæœåŠ¡ä¸­å¿ƒ</strong>ã€‚</li><li><strong>æ•°æ®åº“è¿æ¥</strong>ï¼šæ•°æ®åº“äº¤äº’å·¥ä½œåœ¨æœåŠ¡ä¸­å¿ƒï¼ŒWebåº”ç”¨ä¸“æ³¨äºä¸æµè§ˆå™¨äº¤äº’çš„å·¥ä½œï¼Œä¸å¿…å¤šå…³æ³¨ä¸šåŠ¡é€»è¾‘ã€‚æœåŠ¡ä¸­å¿ƒä¸ä»…æŠŠæ•£è½çš„å¯å…±ç”¨çš„ä¸šåŠ¡ä»£ç é›†ä¸­èµ·æ¥ï¼Œè¿˜å¯ä»¥ä½¿å…¶å¾—åˆ°æ›´å¥½çš„ç»´æŠ¤ã€‚</li><li><strong>é€‚åˆäººå‘˜åˆ†å·¥</strong>ï¼šæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥ç”±å›ºå®šçš„å°å›¢é˜Ÿæ¥ç»´æŠ¤ï¼Œæ›´å¥½çš„ä¿æŒç¨³å®šæ€§ã€‚</li></ul><h3 id="2-8-æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#2-8-æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="2.8 æ¶ˆæ¯ä¸­é—´ä»¶"></a><strong>2.8 æ¶ˆæ¯ä¸­é—´ä»¶</strong></h3><p>æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMessage-oriented middlewareï¼ŒMOMï¼‰å°±æ˜¯é¢å‘æ¶ˆæ¯çš„ç³»ç»Ÿï¼Œæ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®Œæˆæ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶çš„åŸºç¡€è½¯ä»¶ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010140.png" alt></p><p>æ¶ˆæ¯ä¸­é—´ä»¶æœ‰ä¸¤ä¸ªä¸ºäººç†ŸçŸ¥çš„ä¼˜ç‚¹ï¼š<strong>å¼‚æ­¥</strong>å’Œ<strong>è§£è€¦</strong>ã€‚</p><h3 id="2-9-æ€»ç»“"><a href="#2-9-æ€»ç»“" class="headerlink" title="2.9 æ€»ç»“"></a><strong>2.9 æ€»ç»“</strong></h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010141.png" alt></p><hr><h2 id="ç¬¬ä¸‰èŠ‚-Javaä¸­é—´ä»¶"><a href="#ç¬¬ä¸‰èŠ‚-Javaä¸­é—´ä»¶" class="headerlink" title="ç¬¬ä¸‰èŠ‚ Javaä¸­é—´ä»¶"></a><strong>ç¬¬ä¸‰èŠ‚ Javaä¸­é—´ä»¶</strong></h2><p>åœ¨ç½‘ç«™çš„æ¼”å˜è¿‡ç¨‹ä¸­ï¼Œæ— è®ºæ˜¯æœåŠ¡åŒ–ã€æ•°æ®åº“çš„è¯»å†™åˆ†ç¦»å’Œæ‹†åˆ†å¤„ç†è¿˜æ˜¯æ¶ˆæ¯ç³»ç»Ÿï¼Œéƒ½ä¼šç”¨åˆ°ç›¸å…³çš„ä¸­é—´ä»¶ã€‚</p><p>ä¸­é—´ä»¶å°±æ˜¯ä¸ºè½¯ä»¶åº”ç”¨æä¾›é™¤æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ä»¥å¤–çš„æœåŠ¡ï¼Œè®©è½¯ä»¶å¼€å‘è€…æ›´æ–¹ä¾¿çš„å¤„ç†é€šä¿¡ã€è¾“å…¥å’Œè¾“å‡ºï¼Œå…³æ³¨è‡ªå·±åº”ç”¨çš„éƒ¨åˆ†ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œä¸»è¦äº†è§£ä¸‰ä¸ªé¢†åŸŸçš„ä¸­é—´ä»¶ï¼š</p><ul><li><strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å’Œå¯¹è±¡è®¿é—®ä¸­é—´ä»¶</strong>ï¼š</li><li><strong>æ¶ˆæ¯ä¸­é—´ä»¶</strong>ï¼š</li><li><strong>æ•°æ®è®¿é—®ä¸­é—´ä»¶</strong>ï¼š</li></ul><hr><h2 id="ç¬¬å››èŠ‚-æœåŠ¡æ¡†æ¶"><a href="#ç¬¬å››èŠ‚-æœåŠ¡æ¡†æ¶" class="headerlink" title="ç¬¬å››èŠ‚ æœåŠ¡æ¡†æ¶"></a><strong>ç¬¬å››èŠ‚ æœåŠ¡æ¡†æ¶</strong></h2><hr><h2 id="ç¬¬äº”èŠ‚-æ•°æ®è®¿é—®å±‚"><a href="#ç¬¬äº”èŠ‚-æ•°æ®è®¿é—®å±‚" class="headerlink" title="ç¬¬äº”èŠ‚ æ•°æ®è®¿é—®å±‚"></a><strong>ç¬¬äº”èŠ‚ æ•°æ®è®¿é—®å±‚</strong></h2><hr><h2 id="ç¬¬å…­èŠ‚-æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#ç¬¬å…­èŠ‚-æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="ç¬¬å…­èŠ‚ æ¶ˆæ¯ä¸­é—´ä»¶"></a><strong>ç¬¬å…­èŠ‚ æ¶ˆæ¯ä¸­é—´ä»¶</strong></h2><hr><h2 id="ç¬¬ä¸ƒèŠ‚-è½¯è´Ÿè½½ä¸­å¿ƒä¸é›†ä¸­é…ç½®ç®¡ç†"><a href="#ç¬¬ä¸ƒèŠ‚-è½¯è´Ÿè½½ä¸­å¿ƒä¸é›†ä¸­é…ç½®ç®¡ç†" class="headerlink" title="ç¬¬ä¸ƒèŠ‚ è½¯è´Ÿè½½ä¸­å¿ƒä¸é›†ä¸­é…ç½®ç®¡ç†"></a><strong>ç¬¬ä¸ƒèŠ‚ è½¯è´Ÿè½½ä¸­å¿ƒä¸é›†ä¸­é…ç½®ç®¡ç†</strong></h2><hr><h2 id="ç¬¬å…«èŠ‚-CDN"><a href="#ç¬¬å…«èŠ‚-CDN" class="headerlink" title="ç¬¬å…«èŠ‚ CDN"></a><strong>ç¬¬å…«èŠ‚ CDN</strong></h2><hr><h2 id="ç¬¬ä¹èŠ‚-åˆ†å¸ƒå¼å­˜å‚¨"><a href="#ç¬¬ä¹èŠ‚-åˆ†å¸ƒå¼å­˜å‚¨" class="headerlink" title="ç¬¬ä¹èŠ‚ åˆ†å¸ƒå¼å­˜å‚¨"></a><strong>ç¬¬ä¹èŠ‚ åˆ†å¸ƒå¼å­˜å‚¨</strong></h2><hr><h2 id="ç¬¬åèŠ‚-æœç´¢ç³»ç»Ÿ"><a href="#ç¬¬åèŠ‚-æœç´¢ç³»ç»Ÿ" class="headerlink" title="ç¬¬åèŠ‚ æœç´¢ç³»ç»Ÿ"></a><strong>ç¬¬åèŠ‚ æœç´¢ç³»ç»Ÿ</strong></h2><hr><h2 id="ç¬¬åä¸€èŠ‚-å…¶ä»–"><a href="#ç¬¬åä¸€èŠ‚-å…¶ä»–" class="headerlink" title="ç¬¬åä¸€èŠ‚ å…¶ä»–"></a><strong>ç¬¬åä¸€èŠ‚ å…¶ä»–</strong></h2><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šå¤§å‹ç½‘ç«™ç³»ç»Ÿä¸Javaä¸­é—´ä»¶å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      åˆ†å¸ƒå¼ç›¸å…³çŸ¥è¯†å†…å®¹çš„æ¦‚è§ˆï¼Œç®€å•æ•´ç†äº†ä¸€ä¸‹ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="updating" scheme="http://linyishui.top/tags/updating/"/>
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦ä¹ dubboï¼ˆäºŒï¼‰æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒ</title>
    <link href="http://linyishui.top/2020090801.html"/>
    <id>http://linyishui.top/2020090801.html</id>
    <published>2020-09-08T09:50:24.000Z</published>
    <updated>2020-10-02T08:16:14.825Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dubboï¼ˆäºŒï¼‰æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒ"><a href="#dubboï¼ˆäºŒï¼‰æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒ" class="headerlink" title="dubboï¼ˆäºŒï¼‰æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒ"></a><strong>dubboï¼ˆäºŒï¼‰æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒ</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-ç®€ä»‹"><a href="#ç¬¬ä¸€èŠ‚-ç®€ä»‹" class="headerlink" title="ç¬¬ä¸€èŠ‚ ç®€ä»‹"></a><strong>ç¬¬ä¸€èŠ‚ ç®€ä»‹</strong></h2><h3 id="1-1-dubboæ”¯æŒçš„å‡ ç§æ³¨å†Œä¸­å¿ƒ"><a href="#1-1-dubboæ”¯æŒçš„å‡ ç§æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="1.1 dubboæ”¯æŒçš„å‡ ç§æ³¨å†Œä¸­å¿ƒ"></a><strong>1.1 dubboæ”¯æŒçš„å‡ ç§æ³¨å†Œä¸­å¿ƒ</strong></h3><ul><li><strong>Multicast</strong>ï¼šä¸éœ€è¦å¯åŠ¨ä»»ä½•ä¸­å¿ƒèŠ‚ç‚¹ï¼Œåªè¦å¹¿æ’­åœ°å€ä¸€æ ·ï¼Œå°±å¯ä»¥äº’ç›¸å‘ç°ã€‚</li><li><strong>Zookeeper</strong>ï¼šApache Hadoop çš„å­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ ‘å‹çš„ç›®å½•æœåŠ¡ï¼Œæ”¯æŒå˜æ›´æ¨é€ï¼Œé€‚åˆä½œä¸º Dubbo æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒï¼Œå·¥ä¸šå¼ºåº¦è¾ƒé«˜ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå¹¶æ¨èä½¿ç”¨ã€‚</li><li><strong>Nacos</strong>ï¼šNacos æ˜¯ Dubbo ç”Ÿæ€ç³»ç»Ÿä¸­é‡è¦çš„æ³¨å†Œä¸­å¿ƒå®ç°ï¼Œå…¶ä¸­ <a href="https://github.com/apache/incubator-dubbo/tree/master/dubbo-registry/dubbo-registry-nacos" target="_blank" rel="noopener"><code>dubbo-registry-nacos</code></a> åˆ™æ˜¯ Dubbo èåˆ Nacos æ³¨å†Œä¸­å¿ƒçš„å®ç°ã€‚</li><li><strong>Redis</strong>ï¼šä½¿ç”¨ Redis çš„ Key/Map ç»“æ„å­˜å‚¨æ•°æ®ç»“æ„ï¼Œä½¿ç”¨ Redis çš„ Publish/Subscribe äº‹ä»¶é€šçŸ¥æ•°æ®å˜æ›´ã€‚</li><li><strong>Simple</strong>ï¼šSimple æ³¨å†Œä¸­å¿ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Dubbo æœåŠ¡ï¼Œå¯ä»¥å‡å°‘ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä½¿æ•´ä½“é€šè®¯æ–¹å¼ä¸€è‡´ã€‚</li></ul><h3 id="1-2-Zookeeperæ³¨å†Œä¸­å¿ƒ"><a href="#1-2-Zookeeperæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="1.2 Zookeeperæ³¨å†Œä¸­å¿ƒ"></a><strong>1.2 Zookeeperæ³¨å†Œä¸­å¿ƒ</strong></h3><p>å®˜æ–¹æ¨èçš„æ³¨å†Œä¸­å¿ƒï¼Œæ˜¯ä¸€ä¸ªæ ‘å‹çš„ç›®å½•æœåŠ¡ï¼Œæ”¯æŒå˜æ›´æ¨é€ï¼Œé€‚åˆä½œä¸º Dubbo æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒï¼Œå·¥ä¸šå¼ºåº¦è¾ƒé«˜ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚å¦‚ä¸‹å›¾æ ‘å‹ç»“æ„ã€‚</p><p><img src="http://dubbo.apache.org/docs/zh-cn/user/sources/images/zookeeper.jpg" alt></p><p>æµç¨‹è¯´æ˜ï¼š</p><ul><li><strong>æœåŠ¡æä¾›è€…å¯åŠ¨æ—¶</strong>: å‘ <code>/dubbo/com.foo.BarService/providers</code> ç›®å½•ä¸‹å†™å…¥è‡ªå·±çš„ URL åœ°å€</li><li><strong>æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨æ—¶</strong>: è®¢é˜… <code>/dubbo/com.foo.BarService/providers</code> ç›®å½•ä¸‹çš„æä¾›è€… URL åœ°å€ã€‚å¹¶å‘ <code>/dubbo/com.foo.BarService/consumers</code> ç›®å½•ä¸‹å†™å…¥è‡ªå·±çš„ URL åœ°å€</li><li><strong>ç›‘æ§ä¸­å¿ƒå¯åŠ¨æ—¶</strong>: è®¢é˜… <code>/dubbo/com.foo.BarService</code> ç›®å½•ä¸‹çš„æ‰€æœ‰æä¾›è€…å’Œæ¶ˆè´¹è€… URL åœ°å€ã€‚</li></ul><p>æ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>å½“æä¾›è€…å‡ºç°æ–­ç”µç­‰å¼‚å¸¸åœæœºæ—¶ï¼Œæ³¨å†Œä¸­å¿ƒèƒ½è‡ªåŠ¨åˆ é™¤æä¾›è€…ä¿¡æ¯ã€‚</li><li>å½“æ³¨å†Œä¸­å¿ƒé‡å¯æ—¶ï¼Œèƒ½è‡ªåŠ¨æ¢å¤æ³¨å†Œæ•°æ®ï¼Œä»¥åŠè®¢é˜…è¯·æ±‚ã€‚</li><li>å½“ä¼šè¯è¿‡æœŸæ—¶ï¼Œèƒ½è‡ªåŠ¨æ¢å¤æ³¨å†Œæ•°æ®ï¼Œä»¥åŠè®¢é˜…è¯·æ±‚ã€‚</li><li>å½“è®¾ç½® <code>&lt;dubbo:registry check=&quot;false&quot; /&gt;</code> æ—¶ï¼Œè®°å½•å¤±è´¥æ³¨å†Œå’Œè®¢é˜…è¯·æ±‚ï¼Œåå°å®šæ—¶é‡è¯•ã€‚</li><li>å¯é€šè¿‡ <code>&lt;dubbo:registry username=&quot;admin&quot; password=&quot;1234&quot; /&gt;</code> è®¾ç½® zookeeper ç™»å½•ä¿¡æ¯ã€‚</li><li>å¯é€šè¿‡ <code>&lt;dubbo:registry group=&quot;dubbo&quot; /&gt;</code> è®¾ç½® zookeeper çš„æ ¹èŠ‚ç‚¹ï¼Œä¸é…ç½®å°†ä½¿ç”¨é»˜è®¤çš„æ ¹èŠ‚ç‚¹ã€‚</li><li>æ”¯æŒ <code>*</code> å·é€šé…ç¬¦ <code>&lt;dubbo:reference group=&quot;*&quot; version=&quot;*&quot; /&gt;</code>ï¼Œå¯è®¢é˜…æœåŠ¡çš„æ‰€æœ‰åˆ†ç»„å’Œæ‰€æœ‰ç‰ˆæœ¬çš„æä¾›è€…ã€‚</li></ul><hr><h2 id="ç¬¬äºŒèŠ‚-ä½¿ç”¨"><a href="#ç¬¬äºŒèŠ‚-ä½¿ç”¨" class="headerlink" title="ç¬¬äºŒèŠ‚ ä½¿ç”¨"></a><strong>ç¬¬äºŒèŠ‚ ä½¿ç”¨</strong></h2><p>å­¦ä¹ ç¯å¢ƒï¼šLGç¬”è®°æœ¬ + Win10</p><h3 id="2-1-æ³¨å†Œä¸­å¿ƒ"><a href="#2-1-æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="2.1 æ³¨å†Œä¸­å¿ƒ"></a><strong>2.1 æ³¨å†Œä¸­å¿ƒ</strong></h3><p>é¦–å…ˆå®‰è£…Zookeeperæ³¨å†Œä¸­å¿ƒï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://zookeeper.apache.org/releases.html#download" target="_blank" rel="noopener">Zookeeper - download</a></p><p>åŒ…ç»“æ„ï¼š</p><ul><li>binï¼šäºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚ <code>zkServer.cmd</code> å¯ç”¨äºWin10æ‰§è¡Œã€‚</li><li>confï¼šé…ç½®æ–‡ä»¶ <code>.cfg</code> ã€‚</li><li>contribï¼š</li><li>dist-mavenï¼š</li><li>docsï¼š</li><li>libï¼š</li><li>recipesï¼š</li><li>srcï¼š</li></ul><p>é¦–æ¬¡å¯åŠ¨ <code>zkServer.cmd</code> ä¼šå‡ºé”™ã€‚</p><p>æ‰¾åˆ°é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºå‰¯æœ¬å¹¶æ”¹åä¸º <code>zoo.cfg</code> ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># The number of milliseconds of each tick</span><br><span class="line">tickTime=2000</span><br><span class="line"># The number of ticks that the initial </span><br><span class="line"># synchronization phase can take</span><br><span class="line">initLimit=10</span><br><span class="line"># The number of ticks that can pass between </span><br><span class="line"># sending a request and getting an acknowledgement</span><br><span class="line">syncLimit=5</span><br><span class="line"># the directory where the snapshot is stored.</span><br><span class="line"># do not use /tmp for storage, /tmp here is just </span><br><span class="line"># example sakes.</span><br><span class="line"># æ•°æ®å­˜å‚¨ä½ç½®</span><br><span class="line">dataDir=../data</span><br><span class="line"># the port at which the clients will connect</span><br><span class="line">clientPort=2181</span><br><span class="line"># the maximum number of client connections.</span><br><span class="line"># increase this if you need to handle more clients</span><br><span class="line">#maxClientCnxns=60</span><br><span class="line">#</span><br><span class="line"># Be sure to read the maintenance section of the </span><br><span class="line"># administrator guide before turning on autopurge.</span><br><span class="line">#</span><br><span class="line"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span><br><span class="line">#</span><br><span class="line"># The number of snapshots to retain in dataDir</span><br><span class="line">#autopurge.snapRetainCount=3</span><br><span class="line"># Purge task interval in hours</span><br><span class="line"># Set to &quot;0&quot; to disable auto purge feature</span><br><span class="line">#autopurge.purgeInterval=1</span><br></pre></td></tr></table></figure><p>å†æ¬¡å¯åŠ¨ <code>zkServer.cmd</code> ã€‚</p><p>å¯åŠ¨ <code>zkCli.cmd</code> ç®€å•ä½¿ç”¨ä»¥ä¸‹Zookeeperã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–æ ¹ç›®å½•æ–‡ä»¶</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 0] get /</span><br><span class="line"></span><br><span class="line">cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x0</span><br><span class="line">cversion = -1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ ¹ç›®å½•</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ–°å»ºèŠ‚ç‚¹<span class="built_in">test</span></span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] create -e /test 123456</span><br><span class="line">Created /test</span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ¬¡æŸ¥çœ‹ç›®å½•</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] ls /</span><br><span class="line">[zookeeper, test]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–<span class="built_in">test</span>èŠ‚ç‚¹</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] get /test</span><br><span class="line">123456</span><br><span class="line">cZxid = 0x4</span><br><span class="line">ctime = Tue Sep 08 20:10:35 CST 2020</span><br><span class="line">mZxid = 0x4</span><br><span class="line">mtime = Tue Sep 08 20:10:35 CST 2020</span><br><span class="line">pZxid = 0x4</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x100061cf1510001</span><br><span class="line">dataLength = 6</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure><h3 id="2-2-ç›‘æ§ä¸­å¿ƒ"><a href="#2-2-ç›‘æ§ä¸­å¿ƒ" class="headerlink" title="2.2 ç›‘æ§ä¸­å¿ƒ"></a><strong>2.2 ç›‘æ§ä¸­å¿ƒ</strong></h3><p>åœ¨GitHubæ‰¾åˆ°dubboé¡¹ç›®ï¼š<a href="https://github.com/apache/dubbo" target="_blank" rel="noopener">apache/dubbo</a>ã€‚å¾€ä¸‹æ‰¾åˆ°ecosystemï¼Œé¦–å…ˆä¸‹è½½Dubbo Adminè¿™æ˜¯ä¸€ä¸ªç®¡ç†æ§åˆ¶å°ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010101.png" alt></p><p>æŸ¥çœ‹ <code>application.properties</code> ä¸­Zookeeperåœ°å€æ˜¯å¦æ­£ç¡®ã€‚</p><p>åœ¨Ideaä¸­è¿è¡Œæˆ–ç”¨Mavenæ‰“åŒ…å¯åŠ¨ï¼Œæ³¨æ„è¿è¡Œç«¯å£ã€‚</p><p>ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š</p><ol><li><p>ä¸‹è½½ä»£ç : <code>git clone https://github.com/apache/dubbo-admin.git</code></p></li><li><p>åœ¨ <code>dubbo-admin-server/src/main/resources/application.properties</code>ä¸­æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€</p></li><li><p>æ„å»º</p><blockquote><ul><li><code>mvn clean package</code></li></ul></blockquote></li><li><p>å¯åŠ¨</p><ul><li><code>mvn --projects dubbo-admin-server spring-boot:run</code><br>æˆ–è€…</li><li><code>cd dubbo-admin-distribution/target; java -jar dubbo-admin-0.1.jar</code></li></ul></li><li><p>è®¿é—® <code>http://localhost:8080</code></p></li></ol><p>å¼€å‘ç¯å¢ƒé…ç½®ï¼š</p><ul><li>è¿è¡Œ<code>dubbo admin server</code> <code>dubbo admin server</code>æ˜¯ä¸€ä¸ªæ ‡å‡†çš„spring booté¡¹ç›®, å¯ä»¥åœ¨ä»»ä½•java IDEä¸­è¿è¡Œå®ƒ</li><li>è¿è¡Œ<code>dubbo admin ui</code> <code>dubbo admin ui</code>ç”±npmç®¡ç†å’Œæ„å»ºï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥å•ç‹¬è¿è¡Œ: <code>npm run dev</code></li><li>é¡µé¢è®¿é—® è®¿é—® <code>http://localhost:8081</code>, ç”±äºå‰åç«¯åˆ†å¼€éƒ¨ç½²ï¼Œå‰ç«¯æ”¯æŒçƒ­åŠ è½½ï¼Œä»»ä½•é¡µé¢çš„ä¿®æ”¹éƒ½å¯ä»¥å®æ—¶åé¦ˆï¼Œä¸éœ€è¦é‡å¯åº”ç”¨ã€‚</li></ul><p>éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥è®¿é—® <a href="http://localhost:8080/swagger-ui.html" target="_blank" rel="noopener">http://localhost:8080/swagger-ui.html</a> æ¥æŸ¥çœ‹æ‰€æœ‰çš„restful apiã€‚</p><p>è®¿é—®UIå¯¹åº”åœ°å€ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010102.png" alt></p><p>é»˜è®¤ä½¿ç”¨ root/root ç™»é™†ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010103.png" alt></p><p>ç™»å½•åå¯ä»¥æŸ¥çœ‹Dubbon Adminæä¾›çš„åŸºç¡€åŠŸèƒ½ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010104.png" alt></p><h3 id="2-3-å®ä¾‹"><a href="#2-3-å®ä¾‹" class="headerlink" title="2.3 å®ä¾‹"></a><strong>2.3 å®ä¾‹</strong></h3><h4 id="ï¼ˆ1ï¼‰éœ€æ±‚"><a href="#ï¼ˆ1ï¼‰éœ€æ±‚" class="headerlink" title="ï¼ˆ1ï¼‰éœ€æ±‚"></a><strong>ï¼ˆ1ï¼‰éœ€æ±‚</strong></h4><p>æè¿°ï¼šæŸç”µå•†ç³»ç»Ÿï¼Œå…¶è®¢å•æœåŠ¡éœ€è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰åœ°å€ã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦æ„å»ºä¸¤ä¸ªæœåŠ¡æ¨¡å—ï¼šè®¢å•æœåŠ¡Webæ¨¡å—ï¼Œç”¨æˆ·æœåŠ¡Serviceæ¨¡å—ã€‚</p><p>å®ç°ï¼šè®¢å•æœåŠ¡Webæ¨¡å—éƒ¨ç½²äºæœåŠ¡å™¨Aï¼Œç”¨æˆ·æœåŠ¡Serviceæ¨¡å—éƒ¨ç½²äºæœåŠ¡å™¨Bï¼ŒAå¯ä»¥è¿œç¨‹è°ƒç”¨Bã€‚</p><h4 id="ï¼ˆ2ï¼‰æ¶æ„"><a href="#ï¼ˆ2ï¼‰æ¶æ„" class="headerlink" title="ï¼ˆ2ï¼‰æ¶æ„"></a><strong>ï¼ˆ2ï¼‰æ¶æ„</strong></h4><p>æ ¹æ® dubboã€Š<a href="http://dubbo.apache.org/zh-cn/docs/user/best-practice.html" target="_blank" rel="noopener">æœåŠ¡åŒ–æœ€ä½³å®è·µ</a>ã€‹ï¼š</p><ol><li><p><strong>åˆ†åŒ…</strong>ï¼šå»ºè®®å°†æœåŠ¡æ¥å£ï¼ŒæœåŠ¡æ¨¡å‹ï¼ŒæœåŠ¡å¼‚å¸¸ç­‰å‡æ”¾åœ¨ API åŒ…ä¸­ï¼Œå› ä¸ºæœåŠ¡æ¨¡å‹åŠå¼‚å¸¸ä¹Ÿæ˜¯ API çš„ä¸€éƒ¨åˆ†ï¼ŒåŒæ—¶ï¼Œè¿™æ ·åšä¹Ÿç¬¦åˆåˆ†åŒ…åŸåˆ™ï¼š<strong>é‡ç”¨å‘å¸ƒç­‰ä»·åŸåˆ™</strong>(REP)ï¼Œ<strong>å…±åŒé‡ç”¨åŸåˆ™</strong>(CRP)ã€‚</p><p>å¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åœ¨ API åŒ…ä¸­æ”¾ç½®ä¸€ä»½ spring çš„å¼•ç”¨é…ç½®ï¼Œè¿™æ ·ä½¿ç”¨æ–¹ï¼Œåªéœ€åœ¨ spring åŠ è½½è¿‡ç¨‹ä¸­å¼•ç”¨æ­¤é…ç½®å³å¯ï¼Œé…ç½®å»ºè®®æ”¾åœ¨æ¨¡å—çš„åŒ…ç›®å½•ä¸‹ï¼Œä»¥å…å†²çªï¼Œå¦‚ï¼š/xxx/dubbo-reference.xmlã€‚</p></li><li><p><strong>ç²’åº¦</strong>ï¼šæœåŠ¡æ¥å£å°½å¯èƒ½å¤§ç²’åº¦ï¼Œæ¯ä¸ªæœåŠ¡æ–¹æ³•åº”ä»£è¡¨ä¸€ä¸ªåŠŸèƒ½ï¼Œè€Œä¸æ˜¯æŸåŠŸèƒ½çš„ä¸€ä¸ªæ­¥éª¤ï¼Œå¦åˆ™å°†é¢ä¸´åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼ŒDubbo æš‚æœªæä¾›åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒã€‚</p><p>æœåŠ¡æ¥å£å»ºè®®ä»¥ä¸šåŠ¡åœºæ™¯ä¸ºå•ä½åˆ’åˆ†ï¼Œå¹¶å¯¹ç›¸è¿‘ä¸šåŠ¡åšæŠ½è±¡ï¼Œé˜²æ­¢æ¥å£æ•°é‡çˆ†ç‚¸ã€‚</p><p>ä¸å»ºè®®ä½¿ç”¨è¿‡äºæŠ½è±¡çš„é€šç”¨æ¥å£ï¼Œå¦‚ï¼šMap query(Map)ï¼Œè¿™æ ·çš„æ¥å£æ²¡æœ‰æ˜ç¡®è¯­ä¹‰ï¼Œä¼šç»™åæœŸç»´æŠ¤å¸¦æ¥ä¸ä¾¿ã€‚</p></li><li><p><strong>ç‰ˆæœ¬</strong>ï¼šæ¯ä¸ªæ¥å£éƒ½åº”å®šä¹‰ç‰ˆæœ¬å·ï¼Œä¸ºåç»­ä¸å…¼å®¹å‡çº§æä¾›å¯èƒ½ï¼Œå¦‚ï¼š <code>&lt;dubbo:service interface=&quot;com.xxx.XxxService&quot; version=&quot;1.0&quot; /&gt;</code>ã€‚</p><p>å»ºè®®ä½¿ç”¨ä¸¤ä½ç‰ˆæœ¬å·ï¼Œå› ä¸ºç¬¬ä¸‰ä½ç‰ˆæœ¬å·é€šå¸¸è¡¨ç¤ºå…¼å®¹å‡çº§ï¼Œåªæœ‰ä¸å…¼å®¹æ—¶æ‰éœ€è¦å˜æ›´æœåŠ¡ç‰ˆæœ¬ã€‚</p><p>å½“ä¸å…¼å®¹æ—¶ï¼Œå…ˆå‡çº§ä¸€åŠæä¾›è€…ä¸ºæ–°ç‰ˆæœ¬ï¼Œå†å°†æ¶ˆè´¹è€…å…¨éƒ¨å‡ä¸ºæ–°ç‰ˆæœ¬ï¼Œç„¶åå°†å‰©ä¸‹çš„ä¸€åŠæä¾›è€…å‡ä¸ºæ–°ç‰ˆæœ¬ã€‚</p></li><li><p><strong>å…¼å®¹æ€§</strong>ï¼šæœåŠ¡æ¥å£å¢åŠ æ–¹æ³•ï¼Œæˆ–æœåŠ¡æ¨¡å‹å¢åŠ å­—æ®µï¼Œå¯å‘åå…¼å®¹ï¼Œåˆ é™¤æ–¹æ³•æˆ–åˆ é™¤å­—æ®µï¼Œå°†ä¸å…¼å®¹ï¼Œæšä¸¾ç±»å‹æ–°å¢å­—æ®µä¹Ÿä¸å…¼å®¹ï¼Œéœ€é€šè¿‡å˜æ›´ç‰ˆæœ¬å·å‡çº§ã€‚</p><p>å„åè®®çš„å…¼å®¹æ€§ä¸åŒï¼Œå‚è§ï¼š<a href="http://dubbo.apache.org/zh-cn/docs/user/references/protocol/introduction.html" target="_blank" rel="noopener">æœåŠ¡åè®®</a> ã€‚</p></li><li><p><strong>æšä¸¾å€¼</strong>ï¼š</p><ul><li>å¦‚æœæ˜¯å®Œå¤‡é›†ï¼Œå¯ä»¥ç”¨ <code>Enum</code>ï¼Œæ¯”å¦‚ï¼š<code>ENABLE</code>, <code>DISABLE</code>ã€‚</li><li>å¦‚æœæ˜¯ä¸šåŠ¡ç§ç±»ï¼Œä»¥åæ˜æ˜¾ä¼šæœ‰ç±»å‹å¢åŠ ï¼Œä¸å»ºè®®ç”¨ <code>Enum</code>ï¼Œå¯ä»¥ç”¨ <code>String</code> ä»£æ›¿ã€‚</li><li>å¦‚æœæ˜¯åœ¨è¿”å›å€¼ä¸­ç”¨äº† <code>Enum</code>ï¼Œå¹¶æ–°å¢äº† <code>Enum</code> å€¼ï¼Œå»ºè®®å…ˆå‡çº§æœåŠ¡æ¶ˆè´¹æ–¹ï¼Œè¿™æ ·æœåŠ¡æä¾›æ–¹ä¸ä¼šè¿”å›æ–°å€¼ã€‚</li><li>å¦‚æœæ˜¯åœ¨ä¼ å…¥å‚æ•°ä¸­ç”¨äº† <code>Enum</code>ï¼Œå¹¶æ–°å¢äº† <code>Enum</code> å€¼ï¼Œå»ºè®®å…ˆå‡çº§æœåŠ¡æä¾›æ–¹ï¼Œè¿™æ ·æœåŠ¡æ¶ˆè´¹æ–¹ä¸ä¼šä¼ å…¥æ–°å€¼ã€‚</li></ul></li><li><p><strong>åºåˆ—å·</strong>ï¼š</p><ul><li>æœåŠ¡å‚æ•°åŠè¿”å›å€¼å»ºè®®ä½¿ç”¨ POJO å¯¹è±¡ï¼Œå³é€šè¿‡ <code>setter</code>, <code>getter</code> æ–¹æ³•è¡¨ç¤ºå±æ€§çš„å¯¹è±¡ã€‚</li><li>æœåŠ¡å‚æ•°åŠè¿”å›å€¼ä¸å»ºè®®ä½¿ç”¨æ¥å£ï¼Œå› ä¸ºæ•°æ®æ¨¡å‹æŠ½è±¡çš„æ„ä¹‰ä¸å¤§ï¼Œå¹¶ä¸”åºåˆ—åŒ–éœ€è¦æ¥å£å®ç°ç±»çš„å…ƒä¿¡æ¯ï¼Œå¹¶ä¸èƒ½èµ·åˆ°éšè—å®ç°çš„æ„å›¾ã€‚</li><li>æœåŠ¡å‚æ•°åŠè¿”å›å€¼éƒ½å¿…é¡»æ˜¯<a href="https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_value" target="_blank" rel="noopener">ä¼ å€¼è°ƒç”¨</a>ï¼Œè€Œä¸èƒ½æ˜¯<a href="https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_reference" target="_blank" rel="noopener">ä¼ å¼•ç”¨è°ƒç”¨</a>ï¼Œæ¶ˆè´¹æ–¹å’Œæä¾›æ–¹çš„å‚æ•°æˆ–è¿”å›å€¼å¼•ç”¨å¹¶ä¸æ˜¯åŒä¸€ä¸ªï¼Œåªæ˜¯å€¼ç›¸åŒï¼ŒDubbo ä¸æ”¯æŒå¼•ç”¨è¿œç¨‹å¯¹è±¡ã€‚</li></ul></li><li><p><strong>å¼‚å¸¸</strong>ï¼š</p><ul><li>å»ºè®®ä½¿ç”¨å¼‚å¸¸æ±‡æŠ¥é”™è¯¯ï¼Œè€Œä¸æ˜¯è¿”å›é”™è¯¯ç ï¼Œå¼‚å¸¸ä¿¡æ¯èƒ½æºå¸¦æ›´å¤šä¿¡æ¯ï¼Œå¹¶ä¸”è¯­ä¹‰æ›´å‹å¥½ã€‚</li><li>å¦‚æœæ‹…å¿ƒæ€§èƒ½é—®é¢˜ï¼Œåœ¨å¿…è¦æ—¶ï¼Œå¯ä»¥é€šè¿‡ override æ‰å¼‚å¸¸ç±»çš„ <code>fillInStackTrace()</code> æ–¹æ³•ä¸ºç©ºæ–¹æ³•ï¼Œä½¿å…¶ä¸æ‹·è´æ ˆä¿¡æ¯ã€‚</li><li>æŸ¥è¯¢æ–¹æ³•ä¸å»ºè®®æŠ›å‡º checked å¼‚å¸¸ï¼Œå¦åˆ™è°ƒç”¨æ–¹åœ¨æŸ¥è¯¢æ—¶å°†è¿‡å¤šçš„ <code>try...catch</code>ï¼Œå¹¶ä¸”ä¸èƒ½è¿›è¡Œæœ‰æ•ˆå¤„ç†ã€‚</li><li>æœåŠ¡æä¾›æ–¹ä¸åº”å°† DAO æˆ– SQL ç­‰å¼‚å¸¸æŠ›ç»™æ¶ˆè´¹æ–¹ï¼Œåº”åœ¨æœåŠ¡å®ç°ä¸­å¯¹æ¶ˆè´¹æ–¹ä¸å…³å¿ƒçš„å¼‚å¸¸è¿›è¡ŒåŒ…è£…ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æ¶ˆè´¹æ–¹æ— æ³•ååºåˆ—åŒ–ç›¸åº”å¼‚å¸¸ã€‚</li></ul></li><li><p><strong>è°ƒç”¨</strong>ï¼š</p><ul><li>ä¸è¦åªæ˜¯å› ä¸ºæ˜¯ Dubbo è°ƒç”¨ï¼Œè€ŒæŠŠè°ƒç”¨ <code>try...catch</code> èµ·æ¥ã€‚<code>try...catch</code> åº”è¯¥åŠ ä¸Šåˆé€‚çš„å›æ»šè¾¹ç•Œä¸Šã€‚</li><li>Provider ç«¯éœ€è¦å¯¹è¾“å…¥å‚æ•°è¿›è¡Œæ ¡éªŒã€‚å¦‚æœ‰æ€§èƒ½ä¸Šçš„è€ƒè™‘ï¼ŒæœåŠ¡å®ç°è€…å¯ä»¥è€ƒè™‘åœ¨ API åŒ…ä¸ŠåŠ ä¸ŠæœåŠ¡ Stub ç±»æ¥å®Œæˆæ£€éªŒã€‚</li></ul></li></ol><p>æœ€ç»ˆï¼š</p><ul><li>gmall-order-webï¼šè®¢å•æœåŠ¡Webæ¨¡å—ã€‚</li><li>gmall-userï¼šç”¨æˆ·æœåŠ¡Serviceæ¨¡å—</li><li>gmall-interfaceï¼šå…¬å…±æ¥å£å±‚ã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰ç¼–ç "><a href="#ï¼ˆ3ï¼‰ç¼–ç " class="headerlink" title="ï¼ˆ3ï¼‰ç¼–ç "></a><strong>ï¼ˆ3ï¼‰ç¼–ç </strong></h4><p>åˆ›å»ºMavené¡¹ç›®gmallï¼Œå¹¶åˆ†åˆ«åˆ›å»ºå­é¡¹ç›®ï¼š</p><ul><li>gmall-order-webï¼šè®¢å•æœåŠ¡Webæ¨¡å—ã€‚</li><li>gmall-userï¼šç”¨æˆ·æœåŠ¡Serviceæ¨¡å—</li><li>gmall-interfaceï¼šå…¬å…±æ¥å£å±‚ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010105.png" alt></p><p>ä½¿ç”¨dubboï¼š</p><ul><li>é¦–å…ˆå¼•å…¥dubboå’Œæ“ä½œzookeeperçš„å®¢æˆ·ç«¯çš„ä¾èµ–ï¼›</li><li>åˆ›å»ºxmlï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­é…ç½®æœåŠ¡ï¼ˆå³å®˜ç½‘æ‰€è¯´çš„ç”¨Springé…ç½®æš´éœ²æœåŠ¡ï¼‰ï¼›</li><li>åœ¨å¯åŠ¨ç±»ä¸­åŠ è½½Springé…ç½®ã€‚</li></ul><h5 id="1-user-service-provider"><a href="#1-user-service-provider" class="headerlink" title="1.user-service-provider"></a><strong>1.user-service-provider</strong></h5><p>pom.xmlï¼Œåˆ†åˆ«å¼•å…¥dubboå’Œzookeeperå®¢æˆ·ç«¯ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xxx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lai.gmall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>user-service-provider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lai.gmall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥dubbo --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å†Œä¸­å¿ƒä½¿ç”¨çš„æ˜¯zookeeperï¼Œå¼•å…¥æ“ä½œzookeeperçš„å®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>provider.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 1ã€æŒ‡å®šå½“å‰æœåŠ¡/åº”ç”¨çš„åå­—ï¼ˆåŒæ ·çš„æœåŠ¡åå­—ç›¸åŒï¼Œä¸è¦å’Œåˆ«çš„æœåŠ¡åŒåï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"user-service-provider"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2ã€æŒ‡å®šæ³¨å†Œä¸­å¿ƒçš„ä½ç½® --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;dubbo:registry address="zookeeper://127.0.0.1:2181"&gt;&lt;/dubbo:registry&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span> <span class="attr">address</span>=<span class="string">"127.0.0.1:2181"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:registry</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3ã€æŒ‡å®šé€šä¿¡è§„åˆ™ï¼ˆé€šä¿¡åè®®ï¼Ÿé€šä¿¡ç«¯å£ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20882"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:protocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 4ã€æš´éœ²æœåŠ¡   refï¼šæŒ‡å‘æœåŠ¡çš„çœŸæ­£çš„å®ç°å¯¹è±¡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"gmall.service.UserService"</span></span></span><br><span class="line"><span class="tag"><span class="attr">ref</span>=<span class="string">"userServiceImpl01"</span> <span class="attr">timeout</span>=<span class="string">"1000"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"getUserAddressList"</span> <span class="attr">timeout</span>=<span class="string">"1000"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:method</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ç»Ÿä¸€è®¾ç½®æœåŠ¡æä¾›æ–¹çš„è§„åˆ™  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">timeout</span>=<span class="string">"1000"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:provider</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æœåŠ¡çš„å®ç° --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceImpl01"</span> <span class="attr">class</span>=<span class="string">"gmall.service.impl.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"gmall.service.UserService"</span></span></span><br><span class="line"><span class="tag"><span class="attr">ref</span>=<span class="string">"userServiceImpl02"</span> <span class="attr">timeout</span>=<span class="string">"1000"</span> <span class="attr">version</span>=<span class="string">"2.0.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"getUserAddressList"</span> <span class="attr">timeout</span>=<span class="string">"1000"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:method</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceImpl02"</span> <span class="attr">class</span>=<span class="string">"gmall.service.impl.UserServiceImpl2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è¿æ¥ç›‘æ§ä¸­å¿ƒ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:monitor</span> <span class="attr">protocol</span>=<span class="string">"registry"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:monitor</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>MainApplication</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">ClassPathXmlApplicationContext ioc = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"provider.xml"</span>);</span><br><span class="line">ioc.start();</span><br><span class="line">System.in.read();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">getUserAddressList</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"UserServiceImpl.....old..."</span>);</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">UserAddress address1 = <span class="keyword">new</span> UserAddress(<span class="number">1</span>, <span class="string">"åŒ—äº¬å¸‚æ˜Œå¹³åŒºå®ç¦ç§‘æŠ€å›­ç»¼åˆæ¥¼3å±‚"</span>, <span class="string">"1"</span>, <span class="string">"æè€å¸ˆ"</span>, <span class="string">"010-56253825"</span>, <span class="string">"Y"</span>);</span><br><span class="line">UserAddress address2 = <span class="keyword">new</span> UserAddress(<span class="number">2</span>, <span class="string">"æ·±åœ³å¸‚å®å®‰åŒºè¥¿éƒ¨ç¡…è°·å¤§å¦Båº§3å±‚ï¼ˆæ·±åœ³åˆ†æ ¡ï¼‰"</span>, <span class="string">"1"</span>, <span class="string">"ç‹è€å¸ˆ"</span>, <span class="string">"010-56253825"</span>, <span class="string">"N"</span>);</span><br><span class="line"><span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">Thread.sleep(4000);</span></span><br><span class="line"><span class="comment">&#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line"><span class="comment">e.printStackTrace();</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="keyword">return</span> Arrays.asList(address1,address2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceImpl2</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl2</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">getUserAddressList</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"UserServiceImpl.....new..."</span>);</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">UserAddress address1 = <span class="keyword">new</span> UserAddress(<span class="number">1</span>, <span class="string">"åŒ—äº¬å¸‚æ˜Œå¹³åŒºå®ç¦ç§‘æŠ€å›­ç»¼åˆæ¥¼3å±‚"</span>, <span class="string">"1"</span>, <span class="string">"æè€å¸ˆ"</span>, <span class="string">"010-56253825"</span>, <span class="string">"Y"</span>);</span><br><span class="line">UserAddress address2 = <span class="keyword">new</span> UserAddress(<span class="number">2</span>, <span class="string">"æ·±åœ³å¸‚å®å®‰åŒºè¥¿éƒ¨ç¡…è°·å¤§å¦Båº§3å±‚ï¼ˆæ·±åœ³åˆ†æ ¡ï¼‰"</span>, <span class="string">"1"</span>, <span class="string">"ç‹è€å¸ˆ"</span>, <span class="string">"010-56253825"</span>, <span class="string">"N"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Arrays.asList(address1,address2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceStub</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceStub</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¼ å…¥çš„æ˜¯userServiceè¿œç¨‹çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userService</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">UserServiceStub</span><span class="params">(UserService userService)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.userService = userService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">getUserAddressList</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">System.out.println(<span class="string">"UserServiceStub....."</span>);</span><br><span class="line"><span class="keyword">if</span>(!StringUtils.isEmpty(userId)) &#123;</span><br><span class="line"><span class="keyword">return</span> userService.getUserAddressList(userId);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-order-service-consumer"><a href="#2-order-service-consumer" class="headerlink" title="2.order-service-consumer"></a><strong>2.order-service-consumer</strong></h5><p>pom.xmlï¼Œä¹Ÿåˆ†åˆ«å¼•å…¥dubboå’Œzookeeperã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lai.gmall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>order-service-consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lai.gmall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥dubbo --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å†Œä¸­å¿ƒä½¿ç”¨çš„æ˜¯zookeeperï¼Œå¼•å…¥æ“ä½œzookeeperçš„å®¢æˆ·ç«¯ç«¯ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>consumer.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"gmall.service.impl"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"order-service-consumer"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://127.0.0.1:2181"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:registry</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  é…ç½®æœ¬åœ°å­˜æ ¹--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å£°æ˜éœ€è¦è°ƒç”¨çš„è¿œç¨‹æœåŠ¡çš„æ¥å£ï¼›ç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">1ï¼‰ã€ç²¾ç¡®ä¼˜å…ˆ (æ–¹æ³•çº§ä¼˜å…ˆï¼Œæ¥å£çº§æ¬¡ä¹‹ï¼Œå…¨å±€é…ç½®å†æ¬¡ä¹‹)</span></span><br><span class="line"><span class="comment">2ï¼‰ã€æ¶ˆè´¹è€…è®¾ç½®ä¼˜å…ˆ(å¦‚æœçº§åˆ«ä¸€æ ·ï¼Œåˆ™æ¶ˆè´¹æ–¹ä¼˜å…ˆï¼Œæä¾›æ–¹æ¬¡ä¹‹)</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- timeout="0" é»˜è®¤æ˜¯1000ms--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- retries="":é‡è¯•æ¬¡æ•°ï¼Œä¸åŒ…å«ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œ0ä»£è¡¨ä¸é‡è¯•--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¹‚ç­‰ï¼ˆè®¾ç½®é‡è¯•æ¬¡æ•°ï¼‰ã€æŸ¥è¯¢ã€åˆ é™¤ã€ä¿®æ”¹ã€‘ã€éå¹‚ç­‰ï¼ˆä¸èƒ½è®¾ç½®é‡è¯•æ¬¡æ•°ï¼‰ã€æ–°å¢ã€‘ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"gmall.service.UserService"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">timeout</span>=<span class="string">"5000"</span> <span class="attr">retries</span>=<span class="string">"3"</span> <span class="attr">version</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;dubbo:method name="getUserAddressList" timeout="1000"&gt;&lt;/dubbo:method&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®å½“å‰æ¶ˆè´¹è€…çš„ç»Ÿä¸€è§„åˆ™ï¼šæ‰€æœ‰çš„æœåŠ¡éƒ½ä¸æ£€æŸ¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">check</span>=<span class="string">"false"</span> <span class="attr">timeout</span>=<span class="string">"5000"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:consumer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:monitor</span> <span class="attr">protocol</span>=<span class="string">"registry"</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:monitor</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;dubbo:monitor address="127.0.0.1:7070"&gt;&lt;/dubbo:monitor&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>MainApplication</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"resource"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">ClassPathXmlApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"consumer.xml"</span>);</span><br><span class="line"></span><br><span class="line">OrderService orderService = applicationContext.getBean(OrderService.class);</span><br><span class="line"></span><br><span class="line">orderService.initOrder(<span class="string">"1"</span>);</span><br><span class="line">System.out.println(<span class="string">"è°ƒç”¨å®Œæˆ...."</span>);</span><br><span class="line">System.in.read();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> gmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1ã€å°†æœåŠ¡æä¾›è€…æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼ˆæš´éœ²æœåŠ¡ï¼‰</span></span><br><span class="line"><span class="comment"> * 1ï¼‰ã€å¯¼å…¥dubboä¾èµ–ï¼ˆ2.6.2ï¼‰\æ“ä½œzookeeperçš„å®¢æˆ·ç«¯(curator)</span></span><br><span class="line"><span class="comment"> * 2ï¼‰ã€é…ç½®æœåŠ¡æä¾›è€…</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 2ã€è®©æœåŠ¡æ¶ˆè´¹è€…å»æ³¨å†Œä¸­å¿ƒè®¢é˜…æœåŠ¡æä¾›è€…çš„æœåŠ¡åœ°å€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lfy</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">initOrder</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">System.out.println(<span class="string">"ç”¨æˆ·idï¼š"</span>+userId);</span><br><span class="line"><span class="comment">//1ã€æŸ¥è¯¢ç”¨æˆ·çš„æ”¶è´§åœ°å€</span></span><br><span class="line">List&lt;UserAddress&gt; addressList = userService.getUserAddressList(userId);</span><br><span class="line"><span class="keyword">for</span> (UserAddress userAddress : addressList) &#123;</span><br><span class="line">System.out.println(userAddress.getUserAddress());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> addressList;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-gmall-interface"><a href="#3-gmall-interface" class="headerlink" title="3.gmall-interface"></a><strong>3.gmall-interface</strong></h5><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lai.gmall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gmall-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>UserAddress</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·åœ°å€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lfy</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAddress</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String userAddress; <span class="comment">//ç”¨æˆ·åœ°å€</span></span><br><span class="line">    <span class="keyword">private</span> String userId; <span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">    <span class="keyword">private</span> String consignee; <span class="comment">//æ”¶è´§äºº</span></span><br><span class="line">    <span class="keyword">private</span> String phoneNum; <span class="comment">//ç”µè¯å·ç </span></span><br><span class="line">    <span class="keyword">private</span> String isDefault; <span class="comment">//æ˜¯å¦ä¸ºé»˜è®¤åœ°å€    Y-æ˜¯     N-å¦</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//constructor and getter and setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OrderService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–è®¢å•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">initOrder</span><span class="params">(String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gmall.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·æœåŠ¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lfy</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‰ç…§ç”¨æˆ·idè¿”å›æ‰€æœ‰çš„æ”¶è´§åœ°å€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;UserAddress&gt; <span class="title">getUserAddressList</span><span class="params">(String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ4ï¼‰å¯åŠ¨"><a href="#ï¼ˆ4ï¼‰å¯åŠ¨" class="headerlink" title="ï¼ˆ4ï¼‰å¯åŠ¨"></a><strong>ï¼ˆ4ï¼‰å¯åŠ¨</strong></h4><p>åˆ†åˆ«å¯åŠ¨æœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·idï¼š<span class="number">1</span></span><br><span class="line">åŒ—äº¬å¸‚æ˜Œå¹³åŒºå®ç¦ç§‘æŠ€å›­ç»¼åˆæ¥¼<span class="number">3</span>å±‚</span><br><span class="line">æ·±åœ³å¸‚å®å®‰åŒºè¥¿éƒ¨ç¡…è°·å¤§å¦Båº§<span class="number">3</span>å±‚ï¼ˆæ·±åœ³åˆ†æ ¡ï¼‰</span><br><span class="line">è°ƒç”¨å®Œæˆ....</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†å¯åŠ¨dubbo-adminï¼Œä½¿ç”¨ root / root ç™»å½•ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010106.png" alt></p><hr><h2 id="ç¬¬ä¸‰èŠ‚-æ•´åˆSpring-Boot"><a href="#ç¬¬ä¸‰èŠ‚-æ•´åˆSpring-Boot" class="headerlink" title="ç¬¬ä¸‰èŠ‚ æ•´åˆSpring Boot"></a><strong>ç¬¬ä¸‰èŠ‚ æ•´åˆSpring Boot</strong></h2><p>GitHubåœ°å€ï¼š<a href="https://github.com/apache/dubbo-spring-boot-project" target="_blank" rel="noopener">apache/dubbo-spring-boot-project</a> ã€‚</p><p>ä¸‹è½½é¡¹ç›®ä¸ä¾èµ–ï¼Œå¹¶è·‘é€šæ¡ˆä¾‹ <code>dubbo-spring-boot-samples</code> ã€‚</p><h3 id="3-1-å…¬å…±æ¥å£-sample-api"><a href="#3-1-å…¬å…±æ¥å£-sample-api" class="headerlink" title="3.1 å…¬å…±æ¥å£ sample-api"></a><strong>3.1 å…¬å…±æ¥å£ sample-api</strong></h3><p>é¦–å…ˆçœ‹ <code>dubbo-spring-boot-samples</code> / <code>sample-api</code> ï¼Œå®ƒæ˜¯<strong>å…¬å…±æ¥å£å±‚</strong>ï¼Œæä¾›äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è¦ä½¿ç”¨çš„DemoServiceæœåŠ¡æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.dubbo.spring.boot.sample.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">sayHello</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-è‡ªåŠ¨è£…é…-auto-configure-samples"><a href="#3-2-è‡ªåŠ¨è£…é…-auto-configure-samples" class="headerlink" title="3.2 è‡ªåŠ¨è£…é… auto-configure-samples"></a><strong>3.2 è‡ªåŠ¨è£…é… auto-configure-samples</strong></h3><p>å†çœ‹ <code>dubbo-spring-boot-samples</code> / <code>auto-configure-samples</code> ã€‚</p><h4 id="ï¼ˆ1ï¼‰provider"><a href="#ï¼ˆ1ï¼‰provider" class="headerlink" title="ï¼ˆ1ï¼‰provider"></a><strong>ï¼ˆ1ï¼‰provider</strong></h4><p>é¦–å…ˆçœ‹æœåŠ¡æä¾›è€…providerçš„å†…å®¹ï¼Œé…ç½®äº†åº”ç”¨ä¿¡æ¯ã€Dubboåè®®ä¿¡æ¯ç­‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Spring boot application </span><br><span class="line"># åº”ç”¨å</span><br><span class="line">spring.application.name=dubbo-auto-configuration-provider-demo</span><br><span class="line"># Base packages to scan Dubbo Component: @org.apache.dubbo.config.annotation.Service</span><br><span class="line"># æ‰«æçš„åŸºç¡€åŒ…</span><br><span class="line">dubbo.scan.base-packages=org.apache.dubbo.spring.boot.sample.provider.service</span><br><span class="line"># Dubbo Application</span><br><span class="line">## The default value of dubbo.application.name is $&#123;spring.application.name&#125;</span><br><span class="line">## dubbo.application.name=$&#123;spring.application.name&#125;</span><br><span class="line"></span><br><span class="line"># Protocolåœ°å€å’Œç«¯å£ï¼ŒæŒ‡å®šè¿œç¨‹è°ƒç”¨åè®®ä¸ºdubboï¼Œè¿˜å¯ä»¥ä¸ºrmiã€httpç­‰</span><br><span class="line"># Dubbo Protocol</span><br><span class="line">dubbo.protocol.name=dubbo</span><br><span class="line">dubbo.protocol.port=12345</span><br><span class="line">## Dubbo Registry</span><br><span class="line">## æ³¨å†Œä¸­å¿ƒæœåŠ¡å™¨åœ°å€ï¼ŒN/Aä¸ºé»˜è®¤å€¼ï¼Œè¡¨ç¤ºä¸ä½¿ç”¨æ³¨å†Œä¸­å¿ƒï¼Œç›´è¿å®¢æˆ·ç«¯ï¼Œåœ°å€å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå¤šä¸ªè¡¨ç¤ºé›†ç¾¤</span><br><span class="line">dubbo.registry.address=N/A</span><br></pre></td></tr></table></figure><p>providerå®ç°äº†DemoServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DubboService</span>(version = <span class="string">"1.0.0"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultDemoService</span> <span class="keyword">implements</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Random costTimeRandom = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The default value of $&#123;dubbo.application.name&#125; is $&#123;spring.application.name&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;dubbo.application.name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String serviceName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å…ˆç®€å•ä¼‘çœ ä¸€ä¸‹</span></span><br><span class="line">        await();</span><br><span class="line">        <span class="comment">//è‡ªå·±æ·»åŠ çš„æ›´ç›´è§‚çš„æ§åˆ¶å°è¾“å‡º</span></span><br><span class="line">        System.out.println(<span class="string">"sayHello: "</span> + name);</span><br><span class="line">        <span class="comment">//æ‰“å°serviceNameå’Œå®å‚</span></span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"[%s] : Hello, %s"</span>, serviceName, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> timeInMillisToWait = costTimeRandom.nextInt(<span class="number">500</span>);</span><br><span class="line">            Thread.sleep(timeInMillisToWait);</span><br><span class="line">            logger.info(<span class="string">"execution time : "</span> + timeInMillisToWait + <span class="string">" ms."</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>providerçš„å¯åŠ¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboAutoConfigurationProviderBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        new SpringApplicationBuilder(DubboAutoConfigurationProviderBootstrap.class)</span></span><br><span class="line"><span class="comment">//                .run(args);</span></span><br><span class="line">        SpringApplication.run(DubboAutoConfigurationProviderBootstrap.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰consumer"><a href="#ï¼ˆ2ï¼‰consumer" class="headerlink" title="ï¼ˆ2ï¼‰consumer"></a><strong>ï¼ˆ2ï¼‰consumer</strong></h4><p>å†æ¥çœ‹æœåŠ¡æ¶ˆè´¹è€…consumerï¼Œåªæ˜¯é…ç½®äº†åº”ç”¨åã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-auto-configure-consumer-sample</span><br></pre></td></tr></table></figure><p>consumerçš„å¯åŠ¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboAutoConfigurationConsumerBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœåŠ¡æä¾›è€…æ³¨å†Œçš„åœ°å€ç­‰ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@DubboReference</span>(</span><br><span class="line">            version = <span class="string">"1.0.0"</span>,</span><br><span class="line">            url = <span class="string">"dubbo://127.0.0.1:12345"</span>,</span><br><span class="line">            timeout = <span class="number">100</span>,</span><br><span class="line">            methods = &#123;</span><br><span class="line">                    <span class="meta">@Method</span>(name = <span class="string">"sayHello"</span>, timeout = <span class="number">300</span>)</span><br><span class="line">            &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DubboAutoConfigurationConsumerBootstrap.class).close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationRunner <span class="title">runner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"runner()"</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨å…¬å…±æ¥å£demoServiceï¼Œé€šè¿‡æŒ‡å®šçš„æœåŠ¡å®ç°è¿œç¨‹è°ƒç”¨æœåŠ¡</span></span><br><span class="line">        <span class="keyword">return</span> args -&gt; logger.info(demoService.sayHello(<span class="string">"mercyblitz"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å¹¶è§‚å¯Ÿæ˜¯å¦æ­£ç¡®æ‰“å°å‡ºç»“æœã€‚</p><h3 id="3-3-å¤–éƒ¨åŒ–é…ç½®-externalized-configuration-samples"><a href="#3-3-å¤–éƒ¨åŒ–é…ç½®-externalized-configuration-samples" class="headerlink" title="3.3 å¤–éƒ¨åŒ–é…ç½® externalized-configuration-samples"></a><strong>3.3 å¤–éƒ¨åŒ–é…ç½® externalized-configuration-samples</strong></h3><h4 id="ï¼ˆ1ï¼‰provider-1"><a href="#ï¼ˆ1ï¼‰provider-1" class="headerlink" title="ï¼ˆ1ï¼‰provider"></a><strong>ï¼ˆ1ï¼‰provider</strong></h4><p>providerä¸ <code>auto-configure-samples</code> ä¸­å”¯ä¸€ä¸åŒçš„æ˜¯å¤šäº†æœåŠ¡ç‰ˆæœ¬çš„é…ç½®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Spring boot application</span><br><span class="line">spring.application.name=dubbo-externalized-configuration-provider-sample</span><br><span class="line"># Base packages to scan Dubbo Component: @org.apache.dubbo.config.annotation.Service</span><br><span class="line">dubbo.scan.base-packages=org.apache.dubbo.spring.boot.sample.provider.service</span><br><span class="line"></span><br><span class="line"># Dubbo Application</span><br><span class="line">## The default value of dubbo.application.name is $&#123;spring.application.name&#125;</span><br><span class="line">## dubbo.application.name=$&#123;spring.application.name&#125;</span><br><span class="line"></span><br><span class="line"># Dubbo Protocol</span><br><span class="line">dubbo.protocol.name=dubbo</span><br><span class="line">dubbo.protocol.port=12345</span><br><span class="line"></span><br><span class="line">## Dubbo Registry</span><br><span class="line">dubbo.registry.address=N/A</span><br><span class="line"></span><br><span class="line">## DemoService version</span><br><span class="line">demo.service.version=1.0.0</span><br></pre></td></tr></table></figure><p>providerçš„æœåŠ¡å®ç°ï¼Œä¸åŒçš„æ˜¯æœåŠ¡çš„ç‰ˆæœ¬å·ä»é…ç½®æ–‡ä»¶ä¸­è·å–ï¼Œå¹¶ä¸”æ²¡æœ‰sleepã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DubboService</span>(version = <span class="string">"$&#123;demo.service.version&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultDemoService</span> <span class="keyword">implements</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The default value of $&#123;dubbo.application.name&#125; is $&#123;spring.application.name&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;dubbo.application.name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String serviceName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"[%s] : Hello, %s"</span>, serviceName, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>providerçš„å¯åŠ¨ç±»å®Œå…¨ä¸€è‡´ã€‚</p><h4 id="ï¼ˆ2ï¼‰consumer-1"><a href="#ï¼ˆ2ï¼‰consumer-1" class="headerlink" title="ï¼ˆ2ï¼‰consumer"></a><strong>ï¼ˆ2ï¼‰consumer</strong></h4><p>æ¶ˆè´¹è€…consumeråˆ™å¢åŠ äº†ä¸€äº›é…ç½®ï¼Œå¯åŠ¨äº†ä¸€äº›dubboç«¯ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-externalized-configuration-consumer-sample</span><br><span class="line"></span><br><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: &apos;*&apos;</span><br><span class="line">  endpoint:</span><br><span class="line">    dubbo:</span><br><span class="line">      enabled: true</span><br><span class="line">    dubboshutdown:</span><br><span class="line">      enabled: true</span><br><span class="line">    dubboconfigs:</span><br><span class="line">      enabled: true</span><br><span class="line">    dubboservices:</span><br><span class="line">      enabled: true</span><br><span class="line">    dubboreferences:</span><br><span class="line">      enabled: true</span><br><span class="line">    dubboproperties:</span><br><span class="line">      enabled: true</span><br><span class="line">  security:</span><br><span class="line">    ## Deprecated 2.x</span><br><span class="line">    enabled: false</span><br><span class="line"></span><br><span class="line">## For Spring Boot 1.x demo</span><br><span class="line">endpoints:</span><br><span class="line">  dubbo:</span><br><span class="line">    enabled: true</span><br><span class="line">    sensitive: false</span><br><span class="line">  dubboshutdown:</span><br><span class="line">    enabled: true</span><br><span class="line">  dubboconfigs:</span><br><span class="line">    enabled: true</span><br><span class="line">  dubboservices:</span><br><span class="line">    enabled: true</span><br><span class="line">  dubboreferences:</span><br><span class="line">    enabled: true</span><br><span class="line">  dubboproperties:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">demo:</span><br><span class="line">  service:</span><br><span class="line">    version: 1.0.0</span><br><span class="line">    url: dubbo://localhost:12345</span><br></pre></td></tr></table></figure><p>consumerçš„å¯åŠ¨ç±»ä¸­ <code>@DubboReference</code> ä¹Ÿæ”¹ä¸ºä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¹¶ä¸”å¢åŠ äº†Getè¯·æ±‚æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboExternalizedConfigurationConsumerBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DubboReference</span>(version = <span class="string">"$&#123;demo.service.version&#125;"</span>, url = <span class="string">"$&#123;demo.service.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DubboExternalizedConfigurationConsumerBootstrap.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/say-hello"</span>, method = GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(@RequestParam String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> demoService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationRunner <span class="title">runner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> args -&gt; logger.info(demoService.sayHello(<span class="string">"mercyblitz"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«å¯åŠ¨ provider å’Œ consumer å¹¶è®¿é—®æœåŠ¡æ¥å£ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200901/202009010108.png" alt></p><h3 id="3-4-æ³¨å†Œä¸­å¿ƒ-registry-samples"><a href="#3-4-æ³¨å†Œä¸­å¿ƒ-registry-samples" class="headerlink" title="3.4 æ³¨å†Œä¸­å¿ƒ registry-samples"></a><strong>3.4 æ³¨å†Œä¸­å¿ƒ registry-samples</strong></h3><p>è¿™ä¸ªå®ä¾‹æä¾›äº†Dubboæœ€å¸¸ç”¨çš„ä¸¤ç§æ³¨å†Œä¸­å¿ƒï¼šZookeeper å’Œ Nacos ã€‚</p><h4 id="ï¼ˆ1ï¼‰Zookeeper"><a href="#ï¼ˆ1ï¼‰Zookeeper" class="headerlink" title="ï¼ˆ1ï¼‰Zookeeper"></a><strong>ï¼ˆ1ï¼‰Zookeeper</strong></h4><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼Œæœ‰äº›è®¸å˜æ›´ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Spring boot application</span><br><span class="line">spring.application.name=dubbo-registry-zookeeper-provider-sample</span><br><span class="line"># Base packages to scan Dubbo Component: @org.apache.dubbo.config.annotation.Service</span><br><span class="line">dubbo.scan.base-packages=org.apache.dubbo.spring.boot.sample.provider.service</span><br><span class="line"></span><br><span class="line"># Dubbo Application</span><br><span class="line">## The default value of dubbo.application.name is $&#123;spring.application.name&#125;</span><br><span class="line">## dubbo.application.name=$&#123;spring.application.name&#125;</span><br><span class="line"></span><br><span class="line"># Dubbo Protocol</span><br><span class="line">dubbo.protocol.name=dubbo</span><br><span class="line">## Random port æ­¤å¤„æ”¹ä¸ºéšæœºç«¯å£ï¼Œä¼šåˆ†é…ä¸€ä¸ªæ²¡æœ‰è¢«å ç”¨çš„ç«¯å£</span><br><span class="line">dubbo.protocol.port=-1</span><br><span class="line"></span><br><span class="line">## Dubbo Registry</span><br><span class="line">## æŒ‡å®šäº†æ³¨å†Œä¸­å¿ƒåœ°å€</span><br><span class="line">dubbo.registry.address=zookeeper://127.0.0.1:2181</span><br><span class="line">## ä½¿ç”¨æ–‡ä»¶ç¼“å­˜æ³¨å†Œä¸­å¿ƒåœ°å€åˆ—è¡¨åŠæœåŠ¡æä¾›è€…åˆ—è¡¨ï¼Œåº”ç”¨é‡å¯æ—¶å°†åŸºäºæ­¤æ–‡ä»¶æ¢å¤ï¼Œæ³¨æ„ï¼šä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒä¸èƒ½ä½¿ç”¨åŒä¸€æ–‡ä»¶å­˜å‚¨</span><br><span class="line">dubbo.registry.file = $&#123;user.home&#125;/dubbo-cache/$&#123;spring.application.name&#125;/dubbo.cache</span><br><span class="line"></span><br><span class="line">## DemoService version</span><br><span class="line">demo.service.version=1.0.0</span><br></pre></td></tr></table></figure><p>æœåŠ¡å®ç°æ²¡æœ‰å˜æ›´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DubboService</span>(version = <span class="string">"$&#123;demo.service.version&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultDemoService</span> <span class="keyword">implements</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The default value of $&#123;dubbo.application.name&#125; is $&#123;spring.application.name&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;dubbo.application.name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String serviceName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"sayHello : "</span> + name);</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"[%s] : Hello, %s"</span>, serviceName, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»æ²¡æœ‰å˜æ›´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboRegistryZooKeeperProviderBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> SpringApplicationBuilder(DubboRegistryZooKeeperProviderBootstrap.class).run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>consumerä¸­é…ç½®æ–‡ä»¶ä¸­å¢åŠ äº†æ³¨å†Œä¸­å¿ƒçš„é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-registry-zookeeper-consumer-sample</span><br><span class="line"></span><br><span class="line">demo:</span><br><span class="line">  service:</span><br><span class="line">    version: 1.0.0</span><br><span class="line"></span><br><span class="line">embedded:</span><br><span class="line">  zookeeper:</span><br><span class="line">    port: 2181</span><br><span class="line"></span><br><span class="line">dubbo:</span><br><span class="line">  registry:</span><br><span class="line">    address: zookeeper://127.0.0.1:$&#123;embedded.zookeeper.port&#125;</span><br><span class="line">    file: $&#123;user.home&#125;/dubbo-cache/$&#123;spring.application.name&#125;/dubbo.cache</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»ä¸­ <code>@DubboReference</code> åªé…ç½®äº†æœåŠ¡ç‰ˆæœ¬ï¼Œå› ä¸ºä¹‹å‰æ˜¯é€šè¿‡å®¢æˆ·ç«¯ç›´è¿ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå®¢æˆ·ç«¯åœ°å€ï¼Œæ­¤æ—¶ä½¿ç”¨æ³¨å†Œä¸­å¿ƒï¼Œåªé¡»å…³æ³¨æœåŠ¡æ¥å£å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboRegistryZooKeeperConsumerBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DubboReference</span>(version = <span class="string">"$&#123;demo.service.version&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DubboRegistryZooKeeperConsumerBootstrap.class).close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationRunner <span class="title">runner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> args -&gt; logger.info(demoService.sayHello(<span class="string">"mercyblitz"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å¹¶è§‚å¯Ÿæ§åˆ¶å°ã€‚</p><h4 id="ï¼ˆ2ï¼‰Nacos"><a href="#ï¼ˆ2ï¼‰Nacos" class="headerlink" title="ï¼ˆ2ï¼‰Nacos"></a><strong>ï¼ˆ2ï¼‰Nacos</strong></h4><p>å†…å®¹åŸºæœ¬ä¸€è‡´ï¼Œæš‚ç•¥ã€‚</p><h3 id="3-5-æœåŠ¡è‡ªçœ-service-introspection-samples"><a href="#3-5-æœåŠ¡è‡ªçœ-service-introspection-samples" class="headerlink" title="3.5  æœåŠ¡è‡ªçœ service-introspection-samples"></a><strong>3.5  æœåŠ¡è‡ªçœ service-introspection-samples</strong></h3><h4 id="ï¼ˆ1ï¼‰provider-2"><a href="#ï¼ˆ1ï¼‰provider-2" class="headerlink" title="ï¼ˆ1ï¼‰provider"></a><strong>ï¼ˆ1ï¼‰provider</strong></h4><p>å¢åŠ äº† <code>registry-type</code> ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># Spring boot application</span><br><span class="line">spring.application.name=dubbo-zookeeper-service-introspection-provider-sample</span><br><span class="line"></span><br><span class="line"># Zookeeper Server Configuration</span><br><span class="line">zookeeper.server.host = 127.0.0.1</span><br><span class="line">zookeeper.server.port = 2181</span><br><span class="line"></span><br><span class="line"># Dubbo Spring Boot Externalization Configuration</span><br><span class="line">## Base packages to scan Dubbo Component: @org.apache.dubbo.config.annotation.Service</span><br><span class="line">dubbo.scan.base-packages=org.apache.dubbo.spring.boot.sample.provider.service</span><br><span class="line"></span><br><span class="line">## The default value of dubbo.application.name is $&#123;spring.application.name&#125;</span><br><span class="line">## dubbo.application.name=$&#123;spring.application.name&#125;</span><br><span class="line"></span><br><span class="line">## Dubbo Protocol</span><br><span class="line">dubbo.protocol.name=dubbo</span><br><span class="line">## Random port</span><br><span class="line">dubbo.protocol.port=-1</span><br><span class="line"></span><br><span class="line">## Dubbo Registry</span><br><span class="line">dubbo.registry.address=zookeeper://$&#123;zookeeper.server.host&#125;:$&#123;zookeeper.server.port&#125;?registry-type=service</span><br><span class="line"></span><br><span class="line">## DemoService version</span><br><span class="line">demo.service.version=1.0.0</span><br></pre></td></tr></table></figure><p>æœåŠ¡å®ç°å’Œå¯åŠ¨ç±»æ²¡æœ‰å˜åŒ–ã€‚</p><h4 id="ï¼ˆ2ï¼‰consumer-2"><a href="#ï¼ˆ2ï¼‰consumer-2" class="headerlink" title="ï¼ˆ2ï¼‰consumer"></a><strong>ï¼ˆ2ï¼‰consumer</strong></h4><p>å¢åŠ äº† <code>registry-type</code> ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-zookeeper-service-introspection-consumer-sample</span><br><span class="line"></span><br><span class="line">demo:</span><br><span class="line">  service:</span><br><span class="line">    version: 1.0.0</span><br><span class="line"></span><br><span class="line">embedded:</span><br><span class="line">  zookeeper:</span><br><span class="line">    port: 2181</span><br><span class="line"></span><br><span class="line">dubbo:</span><br><span class="line">  registry:</span><br><span class="line">    address: zookeeper://127.0.0.1:$&#123;embedded.zookeeper.port&#125;/?registry-type=service</span><br><span class="line">    file: $&#123;user.home&#125;/dubbo-cache/$&#123;spring.application.name&#125;/dubbo.cache</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»æ— å˜æ›´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboZooKeeperServiceIntrospectionConsumerBootstrap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DubboReference</span>(version = <span class="string">"$&#123;demo.service.version&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DubboZooKeeperServiceIntrospectionConsumerBootstrap.class).close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApplicationRunner <span class="title">runner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> args -&gt; logger.info(demoService.sayHello(<span class="string">"mercyblitz"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6-servletå®¹å™¨-servlet-container-samples"><a href="#3-6-servletå®¹å™¨-servlet-container-samples" class="headerlink" title="3.6 servletå®¹å™¨ servlet-container-samples"></a><strong>3.6 servletå®¹å™¨ servlet-container-samples</strong></h3><p>æœåŠ¡æä¾›è€…ä¹Ÿå¼€æ”¾äº†æœåŠ¡çš„ç›´æ¥è®¿é—®æ¥å£ã€‚</p><h4 id="ï¼ˆ1ï¼‰provider-3"><a href="#ï¼ˆ1ï¼‰provider-3" class="headerlink" title="ï¼ˆ1ï¼‰provider"></a><strong>ï¼ˆ1ï¼‰provider</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># Spring boot application</span><br><span class="line">spring.application.name=dubbo-spring-boot-servlet-container-provider-sample</span><br><span class="line"># Base packages to scan Dubbo Component: @org.apache.dubbo.config.annotation.Service</span><br><span class="line">dubbo.scan.base-packages=org.apache.dubbo.spring.boot.sample.provider.service</span><br><span class="line"></span><br><span class="line"># Dubbo Application</span><br><span class="line"></span><br><span class="line"># Dubbo Protocol</span><br><span class="line">dubbo.protocol.name=dubbo</span><br><span class="line">dubbo.protocol.port=23456</span><br><span class="line"></span><br><span class="line">## Dubbo Registry</span><br><span class="line">dubbo.registry.address=N/A</span><br><span class="line"></span><br><span class="line">## DemoService version</span><br><span class="line">demo.service.version=1.0.0</span><br></pre></td></tr></table></figure><p>æœåŠ¡å®ç°æ— å˜æ›´ã€‚</p><p>å¯åŠ¨ç±»å¢åŠ äº†æœåŠ¡æ¥å£ï¼Œé…ç½®äº† <code>WebApplicationType</code> ï¼Œè¡¨ç¤ºåº”ç”¨æ˜¯åŸºäºServletçš„Webç¨‹åºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboServletContainerProviderBootstrap</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/say/&#123;name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">say</span><span class="params">(@PathVariable String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> demoService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources(getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; <span class="comment">// Run as the generic Spring Boot Web(Servlet) Application</span></span><br><span class="line">        SpringApplication application = <span class="keyword">new</span> SpringApplication(DubboServletContainerProviderBootstrap.class);</span><br><span class="line">        application.setWebApplicationType(WebApplicationType.SERVLET);</span><br><span class="line">        application.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰consumer-3"><a href="#ï¼ˆ2ï¼‰consumer-3" class="headerlink" title="ï¼ˆ2ï¼‰consumer"></a><strong>ï¼ˆ2ï¼‰consumer</strong></h4><p>é…ç½®æ— å˜åŒ–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-servlet-container-consumer-sample</span><br><span class="line"></span><br><span class="line">demo:</span><br><span class="line">  service:</span><br><span class="line">    version: 1.0.0</span><br><span class="line">    url: dubbo://127.0.0.1:23456</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»å¼€æ”¾GETè®¿é—®æ¥å£ï¼Œé€šè¿‡è¯»å–é…ç½®æ–‡ä»¶åœ°å€ç›´æ¥è¿œç¨‹è°ƒç”¨å®¢æˆ·ç«¯ï¼ˆæœåŠ¡æä¾›è€…ï¼‰æœåŠ¡å®ç°ï¼ŒåŒæ ·è®¾ç½®äº† <code>WebApplicationType</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboServletContainerConsumerBootstrap</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DubboReference</span>(version = <span class="string">"$&#123;demo.service.version&#125;"</span>, url = <span class="string">"$&#123;demo.service.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/say-hello"</span>, method = GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(@RequestParam String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> demoService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources(getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; <span class="comment">// Run as the generic Spring Boot Web(Servlet) Application</span></span><br><span class="line">        SpringApplication application = <span class="keyword">new</span> SpringApplication(DubboServletContainerConsumerBootstrap.class);</span><br><span class="line">        application.setWebApplicationType(WebApplicationType.SERVLET);</span><br><span class="line">        application.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— <a href="http://dubbo.apache.org/zh-cn/docs/user/dependencies.html" target="_blank" rel="noopener">Dubboå®˜ç½‘-æ–‡æ¡£</a></p><p>ğŸ”— å°šç¡…è°·-dubbo</p>]]></content>
    
    <summary type="html">
    
      ä»é›¶å¼€å§‹å­¦ä¹ Dubboï¼Œç¬¬äºŒç« ã€Šæ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒã€‹ï¼Œå¹¶è·‘äº†ä¸€ä¸‹Dubbo Spring Bootçš„ç¤ºä¾‹ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="dubbo" scheme="http://linyishui.top/tags/dubbo/"/>
    
  </entry>
  
  <entry>
    <title>æ–‡æ¡£ç¼–è¾‘å™¨ï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <link href="http://linyishui.top/2020090601.html"/>
    <id>http://linyishui.top/2020090601.html</id>
    <published>2020-09-06T11:05:38.000Z</published>
    <updated>2020-09-06T11:53:20.815Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æ–‡æ¡£ç¼–è¾‘å™¨"><a href="#æ–‡æ¡£ç¼–è¾‘å™¨" class="headerlink" title="æ–‡æ¡£ç¼–è¾‘å™¨"></a><strong>æ–‡æ¡£ç¼–è¾‘å™¨</strong></h1><h3 id="MarkDownå·¥å…·"><a href="#MarkDownå·¥å…·" class="headerlink" title="MarkDownå·¥å…·"></a><strong>MarkDownå·¥å…·</strong></h3><p>è®°å½•ä¸€ä¸‹æ—¥å¸¸ä½¿ç”¨è¿‡çš„mdå·¥å…·ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥å†™åšå®¢å’Œæ—¥è®°ï¼ŒåŠå…¬åè€Œå¾ˆå°‘ç”¨åˆ°ã€‚</p><h4 id="ï¼ˆ1ï¼‰VSCode"><a href="#ï¼ˆ1ï¼‰VSCode" class="headerlink" title="ï¼ˆ1ï¼‰VSCode"></a><strong>ï¼ˆ1ï¼‰VSCode</strong></h4><p>æœ€å¼€å§‹ä½¿ç”¨VSCodeæ¥ç¼–è¾‘MarkDownæ–‡æ¡£ï¼Œä¼˜ç‚¹æ˜¯å¤§éƒ¨åˆ†ç¨‹åºå‘˜éƒ½å·²ç»æœ‰äº†è¿™ä¸ªå·¥å…·ï¼Œä¸ç”¨å†ä¸‹è½½ã€‚</p><p>ä½†æ—©æœŸå†™åšå®¢æ—¶ï¼Œæ€»æ„Ÿè§‰æ•ˆç‡ä¸Šè¿˜æœ‰æ‰€æ¬ ç¼ºï¼Œå› ä¸ºVSCodeçš„å®šä½æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè€Œä¸æ˜¯å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ‰€ä»¥ä¸èƒ½åƒä¸€äº›Markdownç¼–è¾‘å™¨ä¸€æ ·ï¼Œè·å¾—æ‰€è§å³æ‰€å¾—çš„ä½“éªŒã€‚</p><p>æ‰€ä»¥åœ¨æ–‡æ¡£å†…å®¹æ¯”è¾ƒé•¿æ—¶ï¼Œå°±å¾ˆéš¾å¿«é€Ÿå®šä½åˆ°æƒ³è¦ä¿®æ”¹çš„å†…å®¹ã€‚</p><h4 id="ï¼ˆ2ï¼‰Typora"><a href="#ï¼ˆ2ï¼‰Typora" class="headerlink" title="ï¼ˆ2ï¼‰Typora"></a><strong>ï¼ˆ2ï¼‰Typora</strong></h4><p>å› ä¸ºæˆ‘è¦æ•´ç†çš„æ–‡æ¡£å†…å®¹è¶Šæ¥è¶Šé•¿ï¼Œæ‰€ä»¥å¦‚ä½•æé«˜å†™ä½œæ•ˆç‡æˆä¸ºæˆ‘éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘æ¢ç”¨äº†æ­£è§„çš„Markdownç¼–è¾‘å™¨â€”â€”Typoraï¼Œå®ƒèƒ½è®©æˆ‘åƒå†™Wordä¸€æ ·çš„ç›´æ¥åœ¨æ•ˆæœé¡µé¢å†™ä½œï¼Œå¸¸ç”¨çš„MarkDownæ ¼å¼ä¹Ÿå¾ˆæ–¹ä¾¿ç”Ÿæˆï¼Œå¹¶ä¸”æ”¯æŒå¤šç§æ ¼å¼çš„å¯¼å…¥å¯¼å‡ºã€‚</p><p>å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæˆ‘éƒ½åœ¨ä½¿ç”¨Typoraä½œä¸ºå†™ä½œå·¥å…·ã€‚</p><p>æ¨èæ’ä»¶ï¼š</p><ul><li>Typoraï¼š<ul><li>VLOOK</li></ul></li></ul><p>ä½†æœ€è¿‘å‘ç°Typoraç»å¸¸ä¼šæœ‰ä¸€äº›è«åå…¶å¦™çš„BUGï¼Œå¹¶ä¸”åœ¨æ–‡æ¡£è¶…è¿‡2MBå·¦å³å°±ä¼šé™åˆ¶æ— æ³•æ‰“å¼€ï¼Œè¿™é€¼è¿«æˆ‘å¿…é¡»å†å¯»æ‰¾ä¸€ä¸ªå·¥å…·æ¥ä»£æ›¿Typoraã€‚</p><h4 id="ï¼ˆ3ï¼‰MarkText"><a href="#ï¼ˆ3ï¼‰MarkText" class="headerlink" title="ï¼ˆ3ï¼‰MarkText"></a><strong>ï¼ˆ3ï¼‰MarkText</strong></h4><p>è™½ç„¶æ²¡æœ‰æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œä½†éå¸¸å¡é¡¿ï¼Œåˆ‡æ¢æºç æ ¼å¼ç›´æ¥å¡å´©æºƒäº†ï¼Œå¼ƒç”¨ã€‚</p><p>æ— å¥ˆï¼Œå…ˆç”¨VSCodeæ¥å¤„ç†å¤§æ–‡ä»¶ï¼Œå¹³æ—¶è¿˜ç»§ç»­ç”¨Typoraã€‚</p><h4 id="ï¼ˆ4ï¼‰VSCodeæ’ä»¶"><a href="#ï¼ˆ4ï¼‰VSCodeæ’ä»¶" class="headerlink" title="ï¼ˆ4ï¼‰VSCodeæ’ä»¶"></a><strong>ï¼ˆ4ï¼‰VSCodeæ’ä»¶</strong></h4><p>æ¨èæ’ä»¶ï¼š</p><ul><li>VSCodeï¼š<ul><li>Markdown All in One</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†å·¥ä½œå’Œå­¦ä¹ æ—¶å¸¸ç”¨çš„æ–‡æ¡£ç¼–è¾‘å™¨ï¼ŒæŒç»­æ›´æ–°ä¸­ã€‚
    
    </summary>
    
      <category term="å®ç”¨å·¥å…·" scheme="http://linyishui.top/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="updating" scheme="http://linyishui.top/tags/updating/"/>
    
      <category term="tools" scheme="http://linyishui.top/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼ˆå››ï¼‰ç¬¬ä¸€å¤©å³å¼€å£</title>
    <link href="http://linyishui.top/2020090503.html"/>
    <id>http://linyishui.top/2020090503.html</id>
    <published>2020-09-05T13:28:52.000Z</published>
    <updated>2020-10-02T08:15:38.751Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ç¬¬ä¸€å¤©å³å¼€å£"><a href="#ç¬¬ä¸€å¤©å³å¼€å£" class="headerlink" title="ç¬¬ä¸€å¤©å³å¼€å£"></a><strong>ç¬¬ä¸€å¤©å³å¼€å£</strong></h1><h3 id="è¯æ±‡é‡ä¸å¤Ÿæ€ä¹ˆåŠ"><a href="#è¯æ±‡é‡ä¸å¤Ÿæ€ä¹ˆåŠ" class="headerlink" title="è¯æ±‡é‡ä¸å¤Ÿæ€ä¹ˆåŠ"></a><strong>è¯æ±‡é‡ä¸å¤Ÿæ€ä¹ˆåŠ</strong></h3><p>å½“ä½ ä½œä¸ºåˆå­¦è€…ï¼Œè¦åœ¨ç¬¬ä¸€å¤©å¼€å£è¯´å¤–è¯­æ—¶ï¼Œä½ çš„ç¬¬ä¸€ååº”æ˜¯ï¼šâ€œæˆ‘è¿˜ä»€ä¹ˆè¯éƒ½ä¸ä¼šå‘¢ï¼â€æœ€åˆçš„ä¸€å¯¹ä¸€äº¤æµå¹¶ä¸éœ€è¦ä½ è¯´å‡ºå‡ åƒä¸ªå•è¯ï¼Œå¯èƒ½ä½ åªéœ€è¦æŒæ¡èƒ½å¤Ÿåº”å¯¹ä¸¤ä¸‰ä¸ªé—®é¢˜çš„å•è¯ï¼Œæ„Ÿå—ä¸€ä¸‹è¯´å‡ºè¿™é—¨è¯­è¨€æ˜¯ä»€ä¹ˆæ ·å­å°±å¤Ÿäº†ã€‚</p><h3 id="æœ€åˆå‡ å°æ—¶"><a href="#æœ€åˆå‡ å°æ—¶" class="headerlink" title="æœ€åˆå‡ å°æ—¶"></a><strong>æœ€åˆå‡ å°æ—¶</strong></h3><p>ä¸ºç¬¬ä¸€æ¬¡äº¤è°ˆåšå‡†å¤‡ï¼š</p><ul><li>é€‰æ‹©ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨ç›®æ ‡è¯­è¨€çš„äººï¼Œæˆ–æ˜¯ä½ è§‰å¾—ä½œä¸ºè¯­è¨€è”ç³»çš„æ­æ¡£ä¹Ÿè®¸ä¸é”™çš„äººã€‚</li><li>ç¤¾äº¤è½¯ä»¶æˆ–é‚®ä»¶çº¦ä¸€ä¸ªå…·ä½“æ—¶é—´ã€‚</li><li>é€šè¿‡çº¿ä¸Šæ–¹å¼ç”¨æ‰€å­¦è¯­è¨€è¿›è¡Œäº¤æµã€‚</li></ul><p>å‡ ä¸ªå°æ—¶çš„å‡†å¤‡å·¥ä½œï¼š</p><ul><li>å¯ä»¥çœ‹ä¸€äº›æ—…è¡Œå¸¸ç”¨è¯­ä¸€ç±»çš„ä¹¦ã€‚</li><li>é€šè¿‡å…è´¹çš„èµ„æºå­¦ä¹ ä¸€äº›å¸¸ç”¨è¯­ï¼š<ul><li>How are you?</li><li>What`s your name?</li><li>My name is â€¦</li><li>I don`t understand.</li><li>Could you repeat that / Again, please.</li><li>Can you speak slower please.</li><li>What does that/â€¦ mean?</li></ul></li><li>é‡‡ç”¨å…³é”®è¯è®°å¿†æ³•æ¥è®°ä½å•è¯æˆ–å›ºå®šè¯ç»„ï¼š<ul><li>Yesã€NO</li><li>Pleaseã€Thank you</li><li>Hello</li><li>Good Bye</li></ul></li></ul><h3 id="æœ‰ä¸ä¼šçš„è¯å°±ä½œä¸ªå°å¼Š"><a href="#æœ‰ä¸ä¼šçš„è¯å°±ä½œä¸ªå°å¼Š" class="headerlink" title="æœ‰ä¸ä¼šçš„è¯å°±ä½œä¸ªå°å¼Š"></a><strong>æœ‰ä¸ä¼šçš„è¯å°±ä½œä¸ªå°å¼Š</strong></h3><p>è™½ç„¶ä½ çš„åˆæ¬¡å¯¹è¯å¯èƒ½åªæŒç»­äº†10ç§’æˆ–20ç§’ï¼Œä½†ä½ å¯ä»¥å›å½’ä¹¦æœ¬æˆ–ç¬”è®°ï¼Œå›æƒ³ä½ æƒ³è¯´ä½†ä¸ä¼šè¯´çš„å†…å®¹ï¼ŒæŠŠè¿™äº›çŸ­è¯­åšæˆå­¦ä¹ å¡ï¼Œç„¶åå­¦ä¼šå®ƒä»¬ã€‚</p><p>ä½ å¯ä»¥éšèº«å¸¦ä¸€ä¸ªå°æœ¬å­ï¼Œåˆ—å‡ºä½ æƒ³è¯´çš„å†…å®¹ä»¥åŠè¿˜æœªæŒæ¡å¥½çš„åéš¾è¯æ±‡ã€‚</p><h3 id="æ”¹å˜æªè¾ï¼šè®©äº¤è°ˆç®€å•ç›´æ¥"><a href="#æ”¹å˜æªè¾ï¼šè®©äº¤è°ˆç®€å•ç›´æ¥" class="headerlink" title="æ”¹å˜æªè¾ï¼šè®©äº¤è°ˆç®€å•ç›´æ¥"></a><strong>æ”¹å˜æªè¾ï¼šè®©äº¤è°ˆç®€å•ç›´æ¥</strong></h3><p>åˆå­¦è€…ä¼šå¾ˆå¿«å­¦ä¼šä¸€ä»¶äº‹ï¼š<strong>åœ¨è„‘æµ·ä¸­ç”¨æ¯è¯­ç»„ç»‡å¥½æƒ³è¡¨è¾¾çš„å†…å®¹ï¼Œç„¶åå†ç¿»è¯‘æˆç›®æ ‡è¯­è¨€</strong>ã€‚ä½†å¦‚æœä½ æƒ³è¾¾åˆ°çœŸæ­£æµåˆ©çš„æ°´å‡†ï¼Œ<strong>è¿™ä¸ªå¤šä½™çš„æ­¥éª¤ä¼šæŠŠä½ çš„é€Ÿåº¦æ‹–æ…¢å¾ˆå¤šã€‚</strong>å½“ç„¶ä½œä¸ºåˆå­¦è€…ï¼Œè¿™æ˜¯å¯ä»¥å®¹å¿çš„ã€‚</p><p>æ¯”å¦‚ä½ èŠåˆ°æœªæ¥çš„è®¡åˆ’ï¼Œä½ æœ¬æ¥æ‰“ç®—è¯´:â€I will travel to Spain in July for a two-week vacation.â€ã€‚ç„¶è€Œä½ çªç„¶æ„è¯†åˆ°ä½ ä¸ä¼šç”¨å°†æ¥æ—¶ï¼Œå¿˜è®°äº†â€travel toâ€ï¼ˆå»æ—…è¡Œï¼‰ï¼Œç”šè‡³æƒ³ä¸èµ·â€Julyâ€å’Œâ€vacationâ€å¯¹åº”å•è¯ã€‚</p><p>å¦‚æœä½ æ˜¯ä¼ ç»Ÿå‹çš„è¯­è¨€å­¦ä¹ è€…ï¼Œä½ åº”è¯¥ä¼šæ”¾å¼ƒäº†ï¼Œæ¥å—è‡ªå·±è¿˜æœªâ€œå‡†å¤‡å¥½â€çš„äº‹å®ã€‚ä½†æ‰§ç€äºäº¤æµè€Œä¸æ˜¯è¡¨è¾¾å‡†ç¡®æ€§çš„äººä¼šè€ƒè™‘æ”¹æ¢æªè¾ï¼Œè¿ç”¨å…¶ä»–è¯æ±‡æ¥ä¼ è¾¾åŒæ ·çš„æ„æ€ã€‚</p><p>ä¸ºäº†çœå»åŠ¨è¯å°†æ¥æ—¶è¯å½¢å˜åŒ–çš„çƒ¦æ¼ï¼Œå¾ˆå¤šè¯­è¨€éƒ½æœ‰ä¸€ä¸ªå¾ˆä¾¿æ·çš„ç‰¹å¾ï¼šåŠ¨è¯ä¸å®šå¼è·Ÿåœ¨æƒ…æ€åŠ¨è¯ä¹‹åã€‚æ¯”å¦‚â€wantâ€ã€â€needâ€ã€â€would likeâ€ã€â€shouldâ€ã€â€mayâ€ã€â€canâ€è¿™æ ·çš„è¯çš„ä¸€èˆ¬ç°åœ¨æ—¶å½¢å¼ä¸â€Iâ€è¿ç”¨ï¼Œå¦‚â€I wantâ€ã€â€I canâ€ï¼Œåé¢å°±å¯ä»¥æŒ‰è¯å…¸ä¸Šåˆ—å‡ºçš„ä¸å®šå¼å½¢å¼æ¥ä½¿ç”¨ä½ æƒ³ç”¨çš„é‡è¦åŠ¨è¯â€to travelâ€ã€‚æƒ³æƒ³â€I want to travelâ€å’Œâ€I will travelâ€çš„åŒºåˆ«ï¼Œè™½ç„¶å¾ˆé‡è¦ï¼Œä½†å¯¹äºè¡¨è¾¾æ„æ€åˆæ²¡é‚£ä¹ˆé‡è¦äº†ã€‚ä½ å¯èƒ½ä¸çŸ¥é“â€travelâ€è¿™ä¸ªè¯ï¼Œä½†å¯ä»¥ç”¨â€goâ€æ¥ä»£æ›¿ã€‚</p><p>æ‰€ä»¥ä¸Šè¿°å¥å­å¯ä»¥è½¬æ¢ä¸ºâ€I want to go to Spain this summer to be a tourist for two weeksâ€ã€‚</p><h3 id="æœ€åˆå‡ å¤©"><a href="#æœ€åˆå‡ å¤©" class="headerlink" title="æœ€åˆå‡ å¤©"></a><strong>æœ€åˆå‡ å¤©</strong></h3><p><strong>åé¦ˆè‡³å…³é‡è¦ã€‚</strong>é‡å¤ä½ åœ¨ä»¥å‰çš„è°ˆè¯ä¸­è¯´è¿‡çš„å†…å®¹ï¼Œæ¯æ¬¡éƒ½æ›´åŠ è‡ªä¿¡çš„è¯´å‡ºæ¥ã€‚å‡†å¤‡ä½ è‡ªå·±çš„â€œæ¼”è®²ç¨¿â€ï¼Œåœ¨æ—©æœŸè¿™ç§å¯é¢„æµ‹çš„æ¨¡æ¿æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå½“ç„¶ä»¥åçš„é˜¶æ®µå°±ä¸å¤ªé€‚ç”¨äº†ã€‚</p><h3 id="è¿ç”¨åˆ†ç±»ä½“ç³»æ¥ç®¡ç†å­¦åˆ°çš„å†…å®¹"><a href="#è¿ç”¨åˆ†ç±»ä½“ç³»æ¥ç®¡ç†å­¦åˆ°çš„å†…å®¹" class="headerlink" title="è¿ç”¨åˆ†ç±»ä½“ç³»æ¥ç®¡ç†å­¦åˆ°çš„å†…å®¹"></a><strong>è¿ç”¨åˆ†ç±»ä½“ç³»æ¥ç®¡ç†å­¦åˆ°çš„å†…å®¹</strong></h3><p>è‡´åŠ›äºè¯­è¨€äº¤æµå’Œåº”è¯•æˆ–é¡ºç•…é˜…è¯»çš„å­¦ä¹ è€…ä¸åŒï¼Œå‰è€…æ‰€æœ‰çš„åŠªåŠ›éƒ½æŒ‡å‘åŒä¸€ä¸ªç›®æ ‡ï¼šåœ¨ä¸‹ä¸€æ¬¡ä¼šè¯ä¸­è¡¨ç°çš„æ›´å‡ºè‰²ä¸€äº›ã€‚</p><p>å¶å°”å›å½’ä¼ ç»Ÿçš„è¯­è¨€è¯¾ç¨‹ï¼Œå°¤å…¶æ˜¯å’Œä¸€äº›èšç„¦å£è¯­çš„è¯¾ç¨‹ç›¸æ¯”æ›´èƒ½æ»¡è¶³ä½ è‡ªèº«å­¦ä¹ éœ€æ±‚çš„è¯¾ç¨‹ã€‚åœ¨è§£å†³äº†â€œè¯´â€è¿™ä¸ªéš¾é¢˜åï¼Œå°±å¯ä»¥å°½é‡éµå¾ªè¯¾ç¨‹å»ºè®®è¿›è¡Œå­¦ä¹ ã€‚å¦‚æœè¯¾ç¨‹ä¸­çš„å†…å®¹ä¸é€‚åˆç°åœ¨çš„ä½ å­¦ä¹ ï¼Œè¯·è·³è¿‡å®ƒã€‚æ¯”å¦‚ä½ å¯èƒ½è¦å­¦ä¹ æ¸¸å®¢å¸¸è§å£è¯­ï¼Œä½†å¯¹äºæ­£åœ¨å®¶ä¸­è‡ªå­¦çš„ä½ æ¥è¯´å¹¶ä¸æ˜¯æœ€æƒ³å­¦çš„å†…å®¹ï¼Œä½ å¯èƒ½åªæƒ³é—®ä½ çš„å¯¹è¯æ­æ¡£ä»Šå¤©åšäº†ä»€ä¹ˆã€‚</p><h3 id="æˆ‘ä¸æ˜ç™½å¯¹æ–¹çš„å›å¤"><a href="#æˆ‘ä¸æ˜ç™½å¯¹æ–¹çš„å›å¤" class="headerlink" title="æˆ‘ä¸æ˜ç™½å¯¹æ–¹çš„å›å¤"></a><strong>æˆ‘ä¸æ˜ç™½å¯¹æ–¹çš„å›å¤</strong></h3><p>æ—©æœŸäº¤æµä¸­ï¼Œä½ å¬åˆ°çš„å¤§éƒ¨åˆ†å†…å®¹ä¼¼ä¹éƒ½æ˜¯éš¾ä»¥ç†è§£çš„ã€‚å®Œå…¨çš„ç†è§£æ•´æ®µè¯è¯­å†…å®¹åœ¨æ—©æœŸé˜¶æ®µå¹¶ä¸åˆé€‚ï¼Œæå–åˆ«äººè®²è¯ä¸­ä½ èƒ½å¬æ‡‚çš„è¯æ±‡æˆ–ç‰‡æ®µï¼Œç”±æ­¤æ¨æ–­å¯¹æ–¹åœ¨è¯´ä»€ä¹ˆã€‚</p><p>ä¸è¦æŠ±å®šâ€œæˆ‘ä¸æ‡‚â€çš„æƒ³æ³•ä¸æ”¾ï¼Œæ ¹æ®è¯­å¢ƒå»çŒœæµ‹å¯¹æ–¹çš„å†…å®¹ï¼Œå¹¶è¿›è¡Œåˆç†çš„å›å¤ã€‚</p><h3 id="ä½œè€…çš„ä¸¤å°æ—¶æ³¢å…°è¯­ç»å†"><a href="#ä½œè€…çš„ä¸¤å°æ—¶æ³¢å…°è¯­ç»å†" class="headerlink" title="ä½œè€…çš„ä¸¤å°æ—¶æ³¢å…°è¯­ç»å†"></a><strong>ä½œè€…çš„ä¸¤å°æ—¶æ³¢å…°è¯­ç»å†</strong></h3><p>ä½œè€…æ›¾å› è¦åšæ¼”è®²è€Œè¿›è¡Œè¿‡ä¸€æ¬¡ä¸¤ä¸ªå°æ—¶çš„æ³¢å…°è¯­Skypeå­¦ä¹ ï¼š</p><ul><li>ä½¿ç”¨å¸¸ç”¨è¯­æ‰‹å†Œå­¦ä¹ ä¸€äº›åˆæ¬¡ä¼šè¯çš„åŸºç¡€è¯æ±‡ï¼š<ul><li>â€œI just started learning Polishâ€</li><li>â€œI am going to Poland soonâ€</li></ul></li><li>ç”¨ç”µå­è¯å…¸æŸ¥å¥½äº¤æµè¦ç”¨çš„è¯æ±‡ã€‚</li><li>åœ¨å±å¹•ä¸Šæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ï¼Œåœ¨ä¸Šé¢è®°å½•å¯èƒ½è®°ä¸ä½çš„è¯ï¼Œå‡†å¤‡å‡ åä¸ªè¿™æ ·çš„è¯ã€‚</li><li>å½“å¯¹æ–¹è¯´å‡ºä¸€ä¸ªä½ ä¸ä¼šçš„è¯æ—¶ï¼Œè¯·ä»–åœ¨èŠå¤©çª—å£æ‰“å‡ºæ¥ï¼Œå¤åˆ¶ä¸‹æ¥å¹¶æŠ½ç©ºå­¦ä¹ ã€‚</li></ul><p>åœ¨è¿™æ¬¡åŠä¸ªå°æ—¶çš„å¯¹è¯ä¸­ï¼Œä½œè€…åšæŒä¸€ç›´ä½¿ç”¨æ³¢å…°è¯­ï¼Œè™½ç„¶å¾ˆå¤šæ¬¡å¼„ä¸æ‡‚å¯¹æ–¹è¯´ä»€ä¹ˆï¼Œè‡ªå·±ä¹Ÿè¯´ä¸å‡ºä¸€äº›ç®€å•çš„å†…å®¹ï¼Œè¿™ç§ä¸å®Œç¾çš„æ„Ÿè§‰ä¼šä¸€ç›´ä¼´éšç€å­¦ä¹ çš„è¿‡ç¨‹ã€‚</p><p>å»ºè®®ç”¨ä¸¤å‘¨çš„æ—¶é—´æ¥å­¦ä¹ ä¸€ä¸‹ä¸–ç•Œè¯­ï¼Œæœ‰ç ”ç©¶è¡¨æ˜å­¦ä¹ ä¸€å¹´ä¸–ç•Œè¯­å†å­¦ä¸€å¹´æ³•è¯­çš„å­¦ç”Ÿæ¯”ç›´æ¥å­¦ä¹ ä¸¤å¹´æ³•è¯­çš„å­¦ç”Ÿæ›´æœ‰ä¼˜åŠ¿ã€‚</p><p>ä¸–ç•Œè¯­çš„è®¾è®¡å¾ˆç®€å•ï¼Œå¯ä»¥è®©ä½ åœ¨å¾ˆçŸ­çš„æ—¶é—´æŒæ¡å¥½å®ƒï¼Œå…‹æœäº†ç¬¬ä¸€é—¨å¤–è¯­çš„éš¾å…³åï¼Œä½ å†æ¬¡å­¦ä¹ å…¶ä»–å¤–è¯­ä¼šç®€å•å¾ˆå¤šã€‚</p><h3 id="å°½æ—©å¼€å§‹å…¨ç¨‹ç›®æ ‡è¯­äº¤æµ"><a href="#å°½æ—©å¼€å§‹å…¨ç¨‹ç›®æ ‡è¯­äº¤æµ" class="headerlink" title="å°½æ—©å¼€å§‹å…¨ç¨‹ç›®æ ‡è¯­äº¤æµ"></a><strong>å°½æ—©å¼€å§‹å…¨ç¨‹ç›®æ ‡è¯­äº¤æµ</strong></h3><p>ä¼ ç»Ÿçš„å­¦ä¹ æ–¹æ³•ä¼šç”¨ä½ çš„æ¯è¯­æ•™ä½ è¿™é—¨è¯­è¨€æ€ä¹ˆè¿ä½œï¼Œæ•´ä¸ªå­¦ä¹ è¿‡ç¨‹ä½ éƒ½åœ¨ä»”ç»†çš„å‰–æç›®æ ‡è¯­çš„è¯­æ³•å’Œè¯æ±‡ã€‚è¯­è¨€ä½œä¸ºäº¤æµçš„æ‰‹æ®µï¼Œä»ä¸€å¼€å§‹å°±åº”è¯¥æ˜¯è¢«ä½¿ç”¨çš„ã€‚</p><p><strong>ä½ éœ€è¦åŸ¹å…»ç”¨ç›®æ ‡è¯­æ€è€ƒçš„ä¹ æƒ¯ã€‚</strong></p><p>åœ¨ä¼šè¯ä¸­ä½¿ç”¨å…¶ä»–è¯­è¨€åªä¼šæ‹–æ…¢ä½ å‰è¿›çš„æ­¥ä¼ï¼Œå…³é”®å°±æ˜¯è¦å°½æ—©ä¸‹å®šå†³å¿ƒï¼Œåªè¦ä½ èƒ½å®¹å¿è¾ƒé•¿çš„åœé¡¿å’Œä¸æ–­çš„æŸ¥æ‰¾å•è¯ï¼Œå³ä½¿ä»ç¬¬ä¸€å¤©å¼€å£å¯¹è¯ä¹Ÿæ˜¯èƒ½åšåˆ°çš„ã€‚</p><h3 id="å¯¹æ–¹ç”¨ä½ çš„æ¯è¯­å›å¤æ€ä¹ˆåŠ"><a href="#å¯¹æ–¹ç”¨ä½ çš„æ¯è¯­å›å¤æ€ä¹ˆåŠ" class="headerlink" title="å¯¹æ–¹ç”¨ä½ çš„æ¯è¯­å›å¤æ€ä¹ˆåŠ"></a><strong>å¯¹æ–¹ç”¨ä½ çš„æ¯è¯­å›å¤æ€ä¹ˆåŠ</strong></h3><p>å¥½çš„è€å¸ˆæˆ–æ‹æ¡£åº”è¯¥åªæŠŠæ¯è¯­æœ€ç»ˆæ‰‹æ®µæ¥ä½¿ç”¨ï¼Œè¯·å°½å¯èƒ½ç”¨ä¸€äº›æ‰‹æ®µæ¥ä½œä¸ºå›æŠ¥ï¼Œè®©å¯¹æ–¹èƒ½å°½é‡ä½¿ç”¨ç›®æ ‡è¯­æ¥å¯¹è¯ï¼ŒæŒ‡å‡ºä½ æ˜¯ä¸ºäº†å­¦ä¹ è¿™é—¨è¯­è¨€è€Œåœ¨åŠªåŠ›ï¼Œå¦‚æœæ— æ³•å¾—åˆ°å¥½çš„ç»“æœï¼Œå°±é€‰æ‹©å’Œå…¶ä»–äººäº¤è°ˆå§ã€‚</p><h3 id="æ°å…‹-Â·-æ–¯å¸•ç½—æ³•åˆ™ï¼šé¿å…å› è¿Ÿç–‘è€Œè€—è´¹æ—¶é—´"><a href="#æ°å…‹-Â·-æ–¯å¸•ç½—æ³•åˆ™ï¼šé¿å…å› è¿Ÿç–‘è€Œè€—è´¹æ—¶é—´" class="headerlink" title="æ°å…‹ Â· æ–¯å¸•ç½—æ³•åˆ™ï¼šé¿å…å› è¿Ÿç–‘è€Œè€—è´¹æ—¶é—´"></a><strong>æ°å…‹ Â· æ–¯å¸•ç½—æ³•åˆ™ï¼šé¿å…å› è¿Ÿç–‘è€Œè€—è´¹æ—¶é—´</strong></h3><p>åˆå­¦è€…è¦é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä½ åœ¨åˆšå¼€å§‹å¯¹è¯æ—¶åªä¼šâ€œå—¯å—¯å•Šå•Šâ€è€Œä¸å¾—ä¸ä¸­æ­¢äº¤è°ˆï¼Œè¿™å¾ˆå°´å°¬ã€‚æ—©æœŸå¯¹è¯ä¸­ï¼ŒçŠ¹è±«å’Œè¿Ÿç–‘æ˜¯ä¸å¯é¿å…çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›å°æŠ€å·§è®©è¿™äº›æ—¶åˆ»å˜å¾—ä¸é‚£ä¹ˆç´§å¼ å’Œå°´å°¬ã€‚</p><p>åœ¨ã€ŠåŠ å‹’æ¯”æµ·ç›—ã€‹ä¸­ï¼Œæ°å…‹ Â· æ–¯å¸•ç½—èˆ¹é•¿çš„è‚¢ä½“è¯­è¨€ååˆ†ä¸°å¯Œï¼Œå³ä½¿ä¸è¯´è¯ä¹Ÿä¾ç„¶ç”ŸåŠ¨é²œæ´»ã€‚è¿™ç§æ–¹æ³•å¯ä»¥ç”¨æ¥ä¿æŒå¯¹æ–¹çš„æ³¨æ„åŠ›ï¼Œæ¯”å¦‚ä½ æƒ³è¯´â€I want to go to the supermarketâ€ï¼Œå½“ä½ è¯´é“â€go toâ€æ—¶ä½ å‘ç°ä½ å¿˜è®°äº†è¶…å¸‚æ€ä¹ˆè¯´ï¼Œä½ éœ€è¦ä¸€äº›æ—¶é—´æ¥æƒ³æƒ³ã€‚è¿™ä¸ªæ—¶å€™ä½ å¯ä»¥çœ‹ç€å¯¹æ–¹çš„çœ¼ç›ï¼Œå¸å¼•ä»–çš„å…¨éƒ¨æ³¨æ„ï¼Œç„¶åä¸¾èµ·é£ŸæŒ‡æŒ‡å‘è¿œæ–¹ï¼Œå¹¶ä¸”é¢å¸¦æ²‰æ€çš„å‡æœ›æ‰€æŒ‡å‘çš„æ–¹å‘ã€‚è¿™æ—¶ä½ å¯ä»¥è¯´ä½ æƒ³å»æœºåœºã€æ²™æ¼ â€¦â€¦åªè¦ç¨å¾®ç»ƒä¹ ï¼Œä½ å¯ä»¥æŠŠè¿™äº›åœé¡¿è¿ç”¨çš„æ›´åŠ è‡ªç„¶ã€‚</p><h3 id="ç¢°æ¯æ³•åˆ™ï¼šæŠ›å¼€å®³ç¾çš„æƒ³æ³•"><a href="#ç¢°æ¯æ³•åˆ™ï¼šæŠ›å¼€å®³ç¾çš„æƒ³æ³•" class="headerlink" title="ç¢°æ¯æ³•åˆ™ï¼šæŠ›å¼€å®³ç¾çš„æƒ³æ³•"></a><strong>ç¢°æ¯æ³•åˆ™ï¼šæŠ›å¼€å®³ç¾çš„æƒ³æ³•</strong></h3><p>ç¢°æ¯æ³•åˆ™â€”â€”æŠ›å¼€æˆ‘å¾ˆå®³ç¾çš„æƒ³æ³•ï¼Œåªè¦æ¥è¿‘é‚£ä¸ªäººè·Ÿä»–é—®å¥½å°±æ˜¯äº†ã€‚</p><h3 id="å‚ä¸å³ç†è§£"><a href="#å‚ä¸å³ç†è§£" class="headerlink" title="å‚ä¸å³ç†è§£"></a><strong>å‚ä¸å³ç†è§£</strong></h3><blockquote><p><strong>ä¸é—»ä¸è‹¥é—»ä¹‹ï¼Œé—»ä¹‹ä¸è‹¥è§ä¹‹ï¼Œè§ä¹‹ä¸è‹¥çŸ¥ä¹‹ï¼ŒçŸ¥ä¹‹ä¸è‹¥è¡Œä¹‹ã€‚å­¦è‡³äºè¡Œè€Œæ­¢çŸ£ã€‚</strong></p><p>â€‹                                                                                            â€”â€”ä¸­å›½è°šè¯­</p></blockquote><hr><p>å†…å®¹æ¥æºï¼š</p><p>ğŸ”— ã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹</p>]]></content>
    
    <summary type="html">
    
      ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼Œå†…å®¹æ¥è‡ªäºã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹å’Œè‡ªæˆ‘æ„Ÿå—ã€‚
    
    </summary>
    
      <category term="å­¦ä¹ è¯­è¨€" scheme="http://linyishui.top/categories/%E5%AD%A6%E4%B9%A0%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="language" scheme="http://linyishui.top/tags/language/"/>
    
      <category term="english" scheme="http://linyishui.top/tags/english/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼ˆä¸‰ï¼‰å¦‚ä½•è®°å•è¯</title>
    <link href="http://linyishui.top/2020090502.html"/>
    <id>http://linyishui.top/2020090502.html</id>
    <published>2020-09-05T10:03:08.000Z</published>
    <updated>2020-10-02T08:16:46.865Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å¦‚ä½•å¿«é€Ÿè®°ä½ä¸Šåƒä¸ªå•è¯"><a href="#å¦‚ä½•å¿«é€Ÿè®°ä½ä¸Šåƒä¸ªå•è¯" class="headerlink" title="å¦‚ä½•å¿«é€Ÿè®°ä½ä¸Šåƒä¸ªå•è¯"></a><strong>å¦‚ä½•å¿«é€Ÿè®°ä½ä¸Šåƒä¸ªå•è¯</strong></h1><h3 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å­¦æ ¡å­¦åˆ°çš„è®°å¿†æ–¹æ³•ä¸èµ·ä½œç”¨"><a href="#ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å­¦æ ¡å­¦åˆ°çš„è®°å¿†æ–¹æ³•ä¸èµ·ä½œç”¨" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å­¦æ ¡å­¦åˆ°çš„è®°å¿†æ–¹æ³•ä¸èµ·ä½œç”¨"></a><strong>ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å­¦æ ¡å­¦åˆ°çš„è®°å¿†æ–¹æ³•ä¸èµ·ä½œç”¨</strong></h3><p>å¦‚ä»Šæˆ‘ä»¬æœ‰äº†è¶Šæ¥è¶Šå¤šçš„ä¿¡æ¯æ¥æºï¼Œå¾ˆå¤šäººä¸å†å­¦ä¹ ã€èƒŒè¯µä»»ä½•ä¸œè¥¿ï¼Œå› ä¸ºéšæ—¶å¯ä»¥Googleåˆ°ã€‚è¿™ç§æƒ…å†µå¾ˆä»¤äººé—æ†¾ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å‘æŒ¥è‡ªå·±å¤§è„‘çš„æœ€å¤§æ½œåŠ›ã€‚</p><p><strong>ä¿¡æ¯çš„é‡å¤å‡ºç°è®©æˆ‘ä»¬ä»¥ä¸ºè‡ªå·±å·²ç»è®°ä½äº†å®ƒã€‚</strong>æˆ‘ä»¬åœ¨å­¦æ ¡æ—¶ï¼Œä¸ºäº†å­¦ä¼šä¸€ä¸ªå•è¯å”¯ä¸€çš„æ–¹æ³•å°±æ˜¯æ­»è®°ç¡¬èƒŒã€‚ç»è¿‡å‡ åæ¬¡ç”šè‡³å‡ ç™¾æ¬¡çš„é‡å¤ï¼Œä½ å¯èƒ½ä¼šåœ¨çŸ­æœŸè®°ä½å®ƒï¼Œä½†èƒ½å¦è¿ç”¨å°±çœ‹è¿æ°”äº†ã€‚</p><p><strong>ä¸å…¶ç®€å•çš„è¯»å‡ºæˆ–è¯†åˆ«å‡ºå•è¯ï¼Œä¸å¦‚å°è¯•æ›´æœ‰æ•ˆçš„å­¦ä¹ æ–¹æ³•ã€‚</strong></p><h3 id="ä¸¤ç§ä¼˜ç§€çš„è®°å¿†æ–¹æ³•"><a href="#ä¸¤ç§ä¼˜ç§€çš„è®°å¿†æ–¹æ³•" class="headerlink" title="ä¸¤ç§ä¼˜ç§€çš„è®°å¿†æ–¹æ³•"></a><strong>ä¸¤ç§ä¼˜ç§€çš„è®°å¿†æ–¹æ³•</strong></h3><h4 id="æ–¹æ³•ä¸€ï¼šå…³é”®å­—è”æƒ³è®°å¿†æ³•"><a href="#æ–¹æ³•ä¸€ï¼šå…³é”®å­—è”æƒ³è®°å¿†æ³•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šå…³é”®å­—è”æƒ³è®°å¿†æ³•"></a><strong>æ–¹æ³•ä¸€ï¼šå…³é”®å­—è”æƒ³è®°å¿†æ³•</strong></h4><p>å½“ä½ è¦è®°å¿†ä¸€ä¸ªå•è¯æˆ–å¥å­æ—¶ï¼Œéœ€è¦æ„å»ºä¸€ä¸ªæœ‰è¶£çš„ã€æ ©æ ©å¦‚ç”Ÿçš„ã€ä»¤äººéš¾å¿˜çš„ç”»é¢æˆ–å°æ•…äº‹ã€‚</p><p><strong>è¯·è‡ªå·±ä»è®¤è¯†è¿™ä¸ªè¯è¯­çš„ç¬¬ä¸€å°è±¡å¼€å§‹ï¼Œæ ¹æ®è¯»éŸ³æƒ³è±¡ä¸€ä¸ªåœºæ™¯æˆ–æ•…äº‹ã€‚</strong></p><p>åˆšå¼€å§‹å¯èƒ½æ¯ä¸ªå•è¯éƒ½è¦èŠ±è´¹ä¸€ä¸¤åˆ†é’Ÿæ¥æ„æ€æ•…äº‹ï¼Œä½†å‡ å¤©æˆ–ä¸€å‘¨åï¼Œä½ ä¼šå˜å¾—ç†Ÿç»ƒèµ·æ¥ã€‚è€Œåœ¨ä¸‰å››æ¬¡å›æƒ³èµ·æ•…äº‹åï¼Œä½ å°±å¯ä»¥ç‰¢ç‰¢è®°ä½è¿™ä¸ªè¯ï¼Œä»¥åå°±å¯ä»¥ç›´æ¥çŸ¥é“å…¶å«ä¹‰ã€‚</p><h4 id="æ–¹æ³•äºŒï¼šé—´éš”é‡å¤è®°å¿†æ³•"><a href="#æ–¹æ³•äºŒï¼šé—´éš”é‡å¤è®°å¿†æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šé—´éš”é‡å¤è®°å¿†æ³•"></a><strong>æ–¹æ³•äºŒï¼šé—´éš”é‡å¤è®°å¿†æ³•</strong></h4><p><strong>é€šè¿‡å•è¯å¡å’Œè¯ç»„å¡é‡æ–°æ’åˆ—æ¥è¾…åŠ©è®°å¿†ã€‚</strong>å°†è®°ä¸ä½çš„å•è¯æ’åˆ°å‰é¢ï¼Œå·²çŸ¥çš„å•è¯æ’åœ¨åé¢ã€‚ç›®å‰å¾ˆå¤šä¸»æµçš„APPéƒ½æ”¯æŒè¿™ç§è®°å¿†æ³•ã€‚</p><h3 id="ç”¨éŸ³ä¹æ¥å­¦ä¹ è¯ç»„å’Œæ•´å¥"><a href="#ç”¨éŸ³ä¹æ¥å­¦ä¹ è¯ç»„å’Œæ•´å¥" class="headerlink" title="ç”¨éŸ³ä¹æ¥å­¦ä¹ è¯ç»„å’Œæ•´å¥"></a><strong>ç”¨éŸ³ä¹æ¥å­¦ä¹ è¯ç»„å’Œæ•´å¥</strong></h3><p><strong>ä»è¯ç»„å’Œæ•´å¥æ¥å¼€å§‹å­¦ä¹ è¯­è¨€å¯èƒ½æ•ˆæœä¼šæ¯”ä»å•è¯å¼€å§‹è¦æ›´å¥½ã€‚</strong>å¤šä½¿ç”¨å¦‚â€œå•æ‰€åœ¨å“ªé‡Œâ€ã€â€œè¿™ä¸ªå¤šå°‘é’±â€è¿™æ ·çš„å¸¸ç”¨å¥å­ã€‚</p><p>è®°ä½è¿™äº›å¥å­å¹¶ä¸å®¹æ˜“ï¼Œå‡ ç™¾å¹´æ¥ï¼Œäººä»¬å¸¸å¸¸é€šè¿‡å”±æ­Œæ¥èƒŒè¯µæ–‡ç« ã€‚é¦–å…ˆå¯ä»¥æŠŠå¥å­å’Œå…³é”®å­—è®°å¿†æ³•ç»“åˆï¼Œåœ¨çŸ­å¥çš„å¼€å¤´æ¥å¯å‘è®°å¿†ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬è¦ç›¸å¤„é€‚åˆçš„æ›²è°ƒæ¥å¯å‘è®°å¿†ï¼Œæ›²è°ƒè¦ç®€æ´ï¼Œå°±åƒå¤§æœ¬é’Ÿçš„é’Ÿå£°ä¸€æ ·ã€‚è®°ä½æƒ³è±¡è¶Šç¦»å¥‡ï¼Œè¶Šæœ‰åˆ©äºè®°å¿†ã€‚</p><h3 id="1åˆ†é’Ÿè¿·ä½ è®²è¯ç¨¿"><a href="#1åˆ†é’Ÿè¿·ä½ è®²è¯ç¨¿" class="headerlink" title="1åˆ†é’Ÿè¿·ä½ è®²è¯ç¨¿"></a><strong>1åˆ†é’Ÿè¿·ä½ è®²è¯ç¨¿</strong></h3><p>æˆ‘ä»¬äº†è§£äº†æ€æ ·è®°ä½å•è¯å’Œè¯ç»„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ›´éš¾çš„å†…å®¹â€”â€”è®°ä½æ•´æ®µæ–‡å­—ã€‚</p><p>è¯·å‡†å¤‡å¥½é™Œç”Ÿäººè§é¢çš„å‡ ä¸ªåŸºæœ¬é—®é¢˜çš„ç­”æ¡ˆï¼š</p><ol><li>ä½ æ˜¯å“ªä½ï¼Ÿ</li><li>ä½ ä»å“ªé‡Œæ¥ï¼Ÿ</li><li>ä½ åšä»€ä¹ˆå·¥ä½œï¼Ÿ</li><li>ä½ ä¸ºä»€ä¹ˆè¦å­¦è¿™ç§è¯­è¨€ï¼Ÿ</li></ol><p>ä½ å¯ä»¥ç”¨æ¯è¯­å†™å¥½ç¨¿å­ï¼Œæ‹œæ‰˜ä¸€ä½ä»¥æ‰€å­¦è¯­è¨€ä¸ºæ¯è¯­çš„äººå¸®å¿™å‡†ç¡®çš„ç¿»è¯‘å®ƒï¼Œæˆ–è€…ä»ä¹¦ä¸Šæˆ–ç½‘ä¸Šæ‰¾åˆ°åœ°é“çš„è¡¨è¿°ï¼Œè¯·ä¸è¦èƒŒç”µè„‘ç¿»è¯‘æˆ–è‡ªå·±ç¿»è¯‘çš„å¥å­ã€‚</p><p>ä¸ºæ¯ä¸ªé—®é¢˜éƒ½å‡†å¤‡ä¸€å¼ å¡ç‰‡ï¼Œå¹¶ç”¨è®°å¿†æ³•è®°ä½æ¯ä¸ªå¥å­å¼€å¤´çš„å•è¯å’ŒéŸ³èŠ‚ï¼Œå†ä¸ºæ¯ä¸ªå¥å­æ‰¾åˆ°ä¸€ä¸ªè°ƒå­æˆ–æ­Œæ›²ã€‚</p><h3 id="å•è¯å°±æ˜¯ä½ çš„æ­¦å™¨"><a href="#å•è¯å°±æ˜¯ä½ çš„æ­¦å™¨" class="headerlink" title="å•è¯å°±æ˜¯ä½ çš„æ­¦å™¨"></a><strong>å•è¯å°±æ˜¯ä½ çš„æ­¦å™¨</strong></h3><blockquote><p><strong>ä¸æ±‚ä¸äººç›¸æ¯”ï¼Œåªæ±‚çªç ´è‡ªå·±ã€‚</strong></p><p>â€‹                                                â€”â€”å˜‰çº³æ²»äº”éƒï¼ŒæŸ”é“åˆ›å§‹äºº</p></blockquote><p>å­¦ä¹ è¯­è¨€çš„æ¯ä¸€å¤©ï¼Œä½ çš„è¯æ±‡é‡éƒ½åœ¨å¢åŠ ï¼ŒåŒæ—¶ä½ çš„æ²Ÿé€šèƒ½åŠ›ä¹Ÿä¼šå¾—åˆ°æå‡ã€‚</p><hr><p>å†…å®¹æ¥æºï¼š</p><p>ğŸ”— ã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹</p>]]></content>
    
    <summary type="html">
    
      ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼Œå†…å®¹æ¥è‡ªäºã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹å’Œè‡ªæˆ‘æ„Ÿå—ã€‚
    
    </summary>
    
      <category term="å­¦ä¹ è¯­è¨€" scheme="http://linyishui.top/categories/%E5%AD%A6%E4%B9%A0%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="language" scheme="http://linyishui.top/tags/language/"/>
    
      <category term="english" scheme="http://linyishui.top/tags/english/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼ˆäºŒï¼‰è®¡åˆ’</title>
    <link href="http://linyishui.top/2020090501.html"/>
    <id>http://linyishui.top/2020090501.html</id>
    <published>2020-09-05T09:02:28.000Z</published>
    <updated>2020-10-02T08:15:59.208Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="è®¡åˆ’"><a href="#è®¡åˆ’" class="headerlink" title="è®¡åˆ’"></a><strong>è®¡åˆ’</strong></h1><h3 id="è®¾å®šä¸€ä¸ªå…·ä½“åŒ–çš„ç›®æ ‡"><a href="#è®¾å®šä¸€ä¸ªå…·ä½“åŒ–çš„ç›®æ ‡" class="headerlink" title="è®¾å®šä¸€ä¸ªå…·ä½“åŒ–çš„ç›®æ ‡"></a><strong>è®¾å®šä¸€ä¸ªå…·ä½“åŒ–çš„ç›®æ ‡</strong></h3><p><strong>å¦‚ä½•å®šä¹‰â€œæµåˆ©â€è¿™ä¸ªè¯è¯­ï¼Ÿ</strong>ç‰›æ´¥å­—å…¸ä¸Šçš„å®šä¹‰ï¼šæµåˆ©ï¼Œå½¢å®¹è¯ï¼Œå¯å‡†ç¡®ã€è‡ªå¦‚åœ°è¡¨è¾¾è‡ªå·±çš„æƒ³æ³•ã€‚</p><p>è¯·ä¸è¦é”™è¯¯çš„æŠŠç›®æ ‡å®šä½å¤–è¯­è¦è¾¾åˆ°æ¯è¯­çš„æ°´å¹³ã€‚æ¬§æ´²å‡ ä¸ªä¸»è¦çš„è¯­è¨€æµ‹è¯•ç»„ç»‡æ‰€ä½¿ç”¨çš„ä¸€å¥—ç§‘å­¦ã€æˆç†Ÿçš„è¯­è¨€å…¥é—¨æ ‡å‡†â€”â€”ã€Šæ¬§æ´²å…±åŒè¯­è¨€å‚è€ƒæ ‡å‡†ã€‹ï¼ˆCommon European Framework of Reference for Languagesï¼ŒCEFRLç³»ç»Ÿï¼‰å®šä¹‰äº†ä¸‰ä¸ªç­‰çº§ï¼šâ€œAâ€è¡¨ç¤ºåˆçº§æ°´å¹³ï¼Œâ€œBâ€è¡¨ç¤ºä¸­çº§ï¼Œâ€œCâ€ä»£è¡¨é«˜çº§ã€‚æ¯ä¸ªç­‰çº§åˆåˆ†â€œ1â€ï¼ˆè¾ƒå·®ï¼‰å’Œâ€œ2â€ï¼ˆè¾ƒå¥½ï¼‰ä¸¤ç§ç¨‹åº¦ã€‚</p><p>Açº§æ°´å¹³å°±æ˜¯å¸¸è¯´çš„å…·æœ‰åŸºæœ¬è¯­è¨€èƒ½åŠ›çš„æ¸¸å®¢æ°´å¹³ï¼Œå¯ä»¥è¿›è¡ŒåŸºç¡€çš„å¯¹è¯äº¤æµã€‚Cçº§æ°´å¹³æ„å‘³ç€å·²ç»æŒæ¡äº†è¿™é—¨è¯­è¨€ï¼Œèƒ½å¤Ÿè¾¾åˆ°æ¯è¯­ä½¿ç”¨è€…çš„æ°´å¹³ã€‚</p><p><strong>æˆ‘ä»¬å°†B2åŠä»¥ä¸Šçš„æ°´å¹³å®šä½ä¸ºæµåˆ©ï¼Œèƒ½å¤Ÿæµåˆ©åœ°ã€è‡ªç„¶åœ°ä»¥è¯¥ç§è¯­è¨€ä¸ºæ¯è¯­çš„äººç»å¸¸è¿›è¡Œäº¤æµï¼Œå¯¹äºåŒæ–¹è€Œè¨€ï¼Œè¿™ç§äº¤æµéƒ½æ¯«æ— é˜»ç¢ã€‚</strong></p><h3 id="è¾¾åˆ°æµåˆ©éœ€è¦å¤šé•¿æ—¶é—´"><a href="#è¾¾åˆ°æµåˆ©éœ€è¦å¤šé•¿æ—¶é—´" class="headerlink" title="è¾¾åˆ°æµåˆ©éœ€è¦å¤šé•¿æ—¶é—´"></a><strong>è¾¾åˆ°æµåˆ©éœ€è¦å¤šé•¿æ—¶é—´</strong></h3><p>ä½œè€…æ¨èæ˜¯3ä¸ªæœˆå†…å…ˆè¾¾åˆ°åŸºæœ¬å¯¹è¯çš„æ°´å¹³ï¼ˆB1ï¼‰ï¼Œé«˜å¼ºåº¦çš„è¯­è¨€å­¦ä¹ è®¡åˆ’éœ€è¦ç»å¯¹çš„é›†ä¸­å’Œä¸“å¿ƒï¼Œå³ä½¿ä½ æ˜¯å…¨èŒå·¥ä½œï¼Œä¹Ÿè¦æŒ¤å‡ºæ—¶é—´ï¼Œæ¯å¤©å­¦å‡ å°æ—¶ã€‚<strong>å¦‚æœä½ æƒ³è¦è¿…é€Ÿçš„è¿›æ­¥ï¼Œæ¯å¤©è‡³å°‘ä¸¤ä¸ªå°æ—¶çš„è¯­è¨€å­¦ä¹ æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</strong>å¦‚æœä½ åªèƒ½æ¯å‘¨æŠ•å…¥å‡ ä¸ªå°æ—¶ï¼Œé‚£ä½ æ²¡æœ‰å¯èƒ½åœ¨3ä¸ªæœˆå°±æŒæ¡æµåˆ©çš„å¤–è¯­ã€‚</p><p>å³ä½¿ä½ çš„æœŸé™ä¸æ˜¯3ä¸ªæœˆã€6ä¸ªæœˆï¼Œä¹Ÿè¯·å°½é‡å°†ä¸€å¹´åˆ†æˆæ›´å°çš„ã€æ›´å¯æ§çš„å¤šä¸ªæ—¶é—´æ®µã€‚</p><h3 id="æ€»æ˜¯æœç€æ›´é«˜ä¸€çº§çš„ç›®æ ‡åŠªåŠ›"><a href="#æ€»æ˜¯æœç€æ›´é«˜ä¸€çº§çš„ç›®æ ‡åŠªåŠ›" class="headerlink" title="æ€»æ˜¯æœç€æ›´é«˜ä¸€çº§çš„ç›®æ ‡åŠªåŠ›"></a><strong>æ€»æ˜¯æœç€æ›´é«˜ä¸€çº§çš„ç›®æ ‡åŠªåŠ›</strong></h3><p>åªè¦èƒ½å’Œå…¶ä»–äººäº¤æµï¼Œä½ çš„è¯­è¨€å­¦ä¹ å°±ä¸ç®—å¤±è´¥ã€‚ä½†æ˜¯ï¼Œ<strong>æ³¨æ„ä¸è¦ç”¨â€œä»»ä½•ä¸€ä¸ªå°è¿›æ­¥éƒ½æ˜¯æˆåŠŸâ€æ¥çºµå®¹è‡ªå·±çš„æ‡’æƒ°ã€‚ä¸€å®šè¦æŠŠè‡ªå·±æ¨å‡ºâ€œèˆ’é€‚åœ°å¸¦â€ï¼Œå¦‚æœä½ è®¾å®šçš„ç›®æ ‡æ˜¯ä½ ç™¾åˆ†ç™¾èƒ½è¾¾åˆ°çš„ï¼Œè¯´æ˜ä½ çš„ç›®æ ‡è¿˜æ˜¯å¤ªä½äº†ã€‚</strong></p><h3 id="è¿·ä½ ä»»åŠ¡ï¼šé€¼è‡ªå·±ç¦»å¼€èˆ’é€‚åŒº"><a href="#è¿·ä½ ä»»åŠ¡ï¼šé€¼è‡ªå·±ç¦»å¼€èˆ’é€‚åŒº" class="headerlink" title="è¿·ä½ ä»»åŠ¡ï¼šé€¼è‡ªå·±ç¦»å¼€èˆ’é€‚åŒº"></a><strong>è¿·ä½ ä»»åŠ¡ï¼šé€¼è‡ªå·±ç¦»å¼€èˆ’é€‚åŒº</strong></h3><p>åœ¨è¯­è¨€å­¦ä¹ çš„æŸä¸ªç‰¹å®šæ—¶æœŸï¼Œä½ ä¼šé‡åˆ°ä¸€äº›å…·ä½“é—®é¢˜ï¼Œâ€œè¿·ä½ ä»»åŠ¡â€å¯ä»¥å¸®ä½ å°½å¿«è§£å†³å®ƒä»¬ã€‚</p><p>åœ¨ä½œè€…åˆšå¼€å§‹å­¦æ±‰è¯­æ—¶ï¼Œå› ä¸ºè¯­è°ƒä¸å¯¹ï¼Œåˆ«äººå®Œå…¨ä¸èƒ½å¬æ‡‚ä»–çš„è¯ã€‚æ‰€ä»¥ä»–åªå…³æ³¨è¯­è°ƒï¼Œä¸å»ç®¡è¯æ±‡å’Œé˜…è¯»ç­‰é—®é¢˜ã€‚ä¸€å‘¨åï¼Œäººä»¬å¯ä»¥ç¨å¾®å¬æ‡‚ä»–çš„ä¸€ç‚¹è¯äº†ï¼Œä¹‹åæ‰å¼€å§‹äº†åŸºæœ¬è¯æ±‡çš„å­¦ä¹ ã€‚</p><p>ç¬¬äºŒå‘¨ï¼Œä½œè€…æœ€å¤§çš„é—®é¢˜æ˜¯è¿‡åº¦ä¾èµ–è¯æ±‡ä¹¦ï¼Œæ‰€ä»¥ç»ƒä¹ è‡ªå‘çš„è¯´è¯å˜æˆäº†è¿·ä½ ä»»åŠ¡ã€‚å¾ˆå¿«ä»–ä¹Ÿèƒ½ä¸çœ‹ä¹¦çš„å»è¯´ä¸€äº›è¯æ±‡äº†ã€‚</p><p>è¿™ç§è¿·ä½ ä»»åŠ¡å¯ä»¥ç»™ä½ ä¸€ç§çœŸå®çš„ã€è¾›è‹¦å¾—æ¥çš„æˆå°±æ„Ÿå’Œè¿›æ­¥æ„Ÿï¼Œä½¿ä½ é›†ä¸­ç²¾åŠ›åº”å¯¹é—®é¢˜ç›´åˆ°è§£å†³å®ƒä»¬ã€‚æ¯”å¦‚ä½œè€…å­¦ä¹ æ±‰è¯­æ—¶æ²¡æœ‰ç»™è‡ªå·±è®¾å®šæ¯å‘¨çš„è¯æ±‡ä»»åŠ¡ï¼Œè€Œæ˜¯æ¯å¤©çœ‹60å¼ è¯æ±‡å¡ç‰‡ï¼Œå¡ç‰‡ä¸Šçš„è¯æ±‡éƒ½æ˜¯å…³äºæ€æ ·ç‚¹èœçš„ã€‚</p><p>ä¸€ä¸ªæœˆåï¼Œä½œè€…è¾¾åˆ°äº†ç“¶é¢ˆæœŸï¼Œå¯ä»¥å‡­å€Ÿè®°å¿†è¿›è¡Œç®€å•çš„äº¤è°ˆï¼Œè¯­è°ƒä¹Ÿè¿˜å¯ä»¥ã€‚ä½†è¿™äº›äº¤è°ˆåªèƒ½æŒç»­10~15ç§’ï¼Œä¸ç®—æ˜¯çœŸæ­£çš„äº¤è°ˆã€‚æ‰€ä»¥ä»–å¼€å§‹ä¸€ä¸ªæ–°çš„è¿·ä½ ä»»åŠ¡â€”â€”æå‡æ€ç»´é€Ÿåº¦çš„â€œå¤§è„‘èåˆâ€ã€‚â€œå¤§è„‘èåˆâ€å¼ºè¿«ä½ å¿«é€Ÿæ€ç»´ï¼Œæ ¹æ®å¬åˆ°çš„ä¿¡æ¯è¿›è¡Œæ¨æ–­ã€æœç´¢è¯æ±‡çš„æ„æ€ï¼ŒåŒæ—¶æ ¹æ®è¯­å¢ƒæ¥ç†è§£è¯­è¨€çš„å«ä¹‰ã€‚æ‰€ä»¥ä»–çº¦äº†æ±‰è¯­æ¯è¯­çš„æœ‹å‹æ¥è¿›è¡Œä¸€ä¸ªå°æ—¶ä»¥ä¸Šçš„å¯¹è¯ã€‚</p><p>è¿·ä½ ä»»åŠ¡çš„ç›®çš„å°±æ˜¯é€¼è¿«è‡ªå·±ç¦»å¼€èˆ’é€‚åŒºï¼Œä»è€Œä¸æ–­å‡çº§ã€æŒºè¿‡è‰°éš¾çš„å­¦ä¹ é˜¶æ®µã€‚</p><h3 id="å€¦æ€ æ˜¯æ”¾å¼ƒè¯­è¨€å­¦ä¹ çš„ä¸»è¦åŸå› ä¹‹ä¸€"><a href="#å€¦æ€ æ˜¯æ”¾å¼ƒè¯­è¨€å­¦ä¹ çš„ä¸»è¦åŸå› ä¹‹ä¸€" class="headerlink" title="å€¦æ€ æ˜¯æ”¾å¼ƒè¯­è¨€å­¦ä¹ çš„ä¸»è¦åŸå› ä¹‹ä¸€"></a><strong>å€¦æ€ æ˜¯æ”¾å¼ƒè¯­è¨€å­¦ä¹ çš„ä¸»è¦åŸå› ä¹‹ä¸€</strong></h3><p>å¦‚æœæ•´ä¸ªå­¦ä¹ è¿‡ç¨‹éƒ½å……æ»¡äº†â€œå¤§è„‘èåˆâ€ä»»åŠ¡ï¼Œä½ å¯èƒ½å¾ˆå¿«ä¼šå€¦æ€ ã€‚é€‚å½“çš„ä¼‘æ¯ï¼Œåœ¨è¿™æ®µæ—¶é—´å¿˜è®°è¯­è¨€å­¦ä¹ ï¼Œå¯èƒ½ä¼šæœ‰æ•ˆçš„å¸®åŠ©åˆ°ä½ ã€‚</p><h3 id="åˆ¶è®¢è¡ŒåŠ¨è®¡åˆ’"><a href="#åˆ¶è®¢è¡ŒåŠ¨è®¡åˆ’" class="headerlink" title="åˆ¶è®¢è¡ŒåŠ¨è®¡åˆ’"></a><strong>åˆ¶è®¢è¡ŒåŠ¨è®¡åˆ’</strong></h3><p>æ²¡æœ‰ä»˜è¯¸å®è·µï¼Œä»»ä½•å¥½ä¸»æ„éƒ½ä¸€æ–‡ä¸å€¼ã€‚è¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>è®¾å®šç¨é«˜çš„ç›®æ ‡ã€‚</li><li>è®¾å®šå…·ä½“çš„æœŸé™ã€‚</li><li>é›†ä¸­å­¦ä¹ è¯­è¨€æ—¶ï¼Œä½¿ç”¨è¿·ä½ ä»»åŠ¡å»ä¸“æ³¨è§£å†³çœ¼å‰çš„æœ€å¤§é—®é¢˜ã€‚</li><li>å¦‚æœä½ çš„å…¨éƒ¨æ—¶é—´éƒ½ç”¨æ¥å­¦ä¹ ï¼Œå°±è¦ä¿è¯ä¼‘æ¯ï¼Œä¸è¦æŠŠè‡ªå·±æå¾—ç²¾ç–²åŠ›ç«­ã€‚</li><li>å‘å¤–ç•Œå±•ç¤ºä½ çš„å­¦ä¹ ä»»åŠ¡ï¼Œè®©æœ‹å‹å’Œå®¶äººç›‘ç£ä½ ã€‚</li></ul><h3 id="æˆ‘çš„è®¡åˆ’"><a href="#æˆ‘çš„è®¡åˆ’" class="headerlink" title="æˆ‘çš„è®¡åˆ’"></a><strong>æˆ‘çš„è®¡åˆ’</strong></h3><p>å› ä¸ºæˆ‘æœ€è¿‘åˆšå¥½å¤„äºæ‹©ä¸šæœŸï¼Œè€Œä¸”æŠ€æœ¯ä¸Šæœ‰å¾ˆå¤šçŸ­æ¿éœ€è¦è¡¥é½ï¼Œæ‰€ä»¥ä¸»è¦å­¦ä¹ å†…å®¹è¿˜æ˜¯ä¸“ä¸šæŠ€æœ¯ï¼Œè¯­è¨€åˆ™ä½œä¸ºå¦ä¸€é¡¹åŒæ—¶è¿›è¡Œçš„å­¦ä¹ ä»»åŠ¡ã€‚</p><p><strong>æˆ‘ä¼šæŠŠå­¦ä¹ å‘¨æœŸå®šä¸º6ä¸ªæœˆï¼Œæ¯å¤©ä¸€ä¸ªå°æ—¶çš„è¯­è¨€å­¦ä¹ æ—¶é—´ã€‚</strong>ä¹Ÿå°±æ˜¯æ˜å¹´3åˆ°4æœˆä»½éªŒæ”¶æˆæœã€‚</p><hr><p>å†…å®¹æ¥æºï¼š</p><p>ğŸ”— ã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹</p>]]></content>
    
    <summary type="html">
    
      ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼Œå†…å®¹æ¥è‡ªäºã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹å’Œè‡ªæˆ‘æ„Ÿå—ã€‚
    
    </summary>
    
      <category term="å­¦ä¹ è¯­è¨€" scheme="http://linyishui.top/categories/%E5%AD%A6%E4%B9%A0%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="language" scheme="http://linyishui.top/tags/language/"/>
    
      <category term="english" scheme="http://linyishui.top/tags/english/"/>
    
  </entry>
  
  <entry>
    <title>èŒä¸šè§„åˆ’</title>
    <link href="http://linyishui.top/2020090401.html"/>
    <id>http://linyishui.top/2020090401.html</id>
    <published>2020-09-04T06:28:26.000Z</published>
    <updated>2020-09-04T08:05:56.473Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="èŒä¸šè§„åˆ’"><a href="#èŒä¸šè§„åˆ’" class="headerlink" title="èŒä¸šè§„åˆ’"></a><strong>èŒä¸šè§„åˆ’</strong></h1><h2 id="å²—ä½é€‰æ‹©"><a href="#å²—ä½é€‰æ‹©" class="headerlink" title="å²—ä½é€‰æ‹©"></a><strong>å²—ä½é€‰æ‹©</strong></h2><p>ç›®å‰æƒ…å†µï¼šJavaåç«¯å¼€å‘ï¼Œ2å¹´å·¥ä½œç»éªŒã€‚</p><p>ä¸€å¹´åï¼šJavaåç«¯ / å¤§æ•°æ®å¼€å‘ ï¼Œ3å¹´å·¥ä½œç»éªŒ</p><h2 id="è®¾å®šç›®æ ‡"><a href="#è®¾å®šç›®æ ‡" class="headerlink" title="è®¾å®šç›®æ ‡"></a><strong>è®¾å®šç›®æ ‡</strong></h2><p>ç»Ÿè®¡å²—ä½è–ªé…¬æ•°æ®ï¼š</p><table><thead><tr><th>Java</th><th>åŒ—äº¬</th><th>ä¸Šæµ·</th><th>æ­å·</th></tr></thead><tbody><tr><td>1-3å¹´å¹´æ”¶å…¥-10åˆ†ä½</td><td>79.948</td><td>76.488</td><td>71.014</td></tr><tr><td>1-3å¹´å¹´æ”¶å…¥-25åˆ†ä½</td><td>106.167</td><td>100.479</td><td>94.989</td></tr><tr><td>1-3å¹´å¹´æ”¶å…¥-50åˆ†ä½</td><td>146.831</td><td>137.871</td><td>130.364</td></tr><tr><td>1-3å¹´å¹´æ”¶å…¥-75åˆ†ä½</td><td>208.853</td><td>186.494</td><td>181.281</td></tr><tr><td>1-3å¹´å¹´æ”¶å…¥-90åˆ†ä½</td><td>287.424</td><td>251.109</td><td>247.048</td></tr><tr><td>1-3å¹´æœˆå¹³å‡æ”¶å…¥å’Œäººæ•°å æ¯”</td><td>13.904/19%</td><td>12.900/22%</td><td>12.608/32%</td></tr><tr><td>3-5å¹´æœˆå¹³å‡æ”¶å…¥å’Œäººæ•°å æ¯”</td><td>18.544/56%</td><td>17.661/56%</td><td>18.103/55%</td></tr><tr><td>5-10å¹´æœˆå¹³å‡æ”¶å…¥å’Œäººæ•°å æ¯”</td><td>25.207/24%</td><td>24.766/21%</td><td>24.068/12%</td></tr><tr><td>äººæ•°æ ·æœ¬</td><td>4162601</td><td>2270467</td><td>1604825</td></tr></tbody></table><p><em>æ•°æ®æ¥æºï¼šBossç›´è˜</em></p><p>è®¾å®šå²—ä½ç­›é€‰æ¡ä»¶ï¼š3-5å¹´ç»éªŒï¼Œ20kä»¥ä¸Šã€‚</p><h2 id="ç»Ÿè®¡è¦æ±‚"><a href="#ç»Ÿè®¡è¦æ±‚" class="headerlink" title="ç»Ÿè®¡è¦æ±‚"></a><strong>ç»Ÿè®¡è¦æ±‚</strong></h2><table><thead><tr><th>è¦æ±‚</th><th>å­é¡¹</th><th>æŒæ¡ç¨‹åº¦</th><th>æ¬¡æ•°</th></tr></thead><tbody><tr><td>å·¥é¾„</td><td>3å¹´</td><td></td><td>12</td></tr><tr><td>å­¦å†</td><td>æœ¬ç§‘</td><td></td><td>7</td></tr><tr><td>Java</td><td>åŸºç¡€</td><td>åŸºç¡€æ‰å®ï¼ŒJDKæºç ï¼Œå¤šæ€</td><td>11</td></tr><tr><td></td><td>IO</td><td></td><td>5</td></tr><tr><td></td><td>å¹¶å‘/å¤šçº¿ç¨‹</td><td></td><td>6</td></tr><tr><td></td><td>é›†åˆ</td><td></td><td>4</td></tr><tr><td></td><td>JVM</td><td>äº†è§£åŸç†</td><td>5</td></tr><tr><td></td><td>ç½‘ç»œç¼–ç¨‹</td><td></td><td>2</td></tr><tr><td>Webæ¡†æ¶</td><td>Webå¼€å‘</td><td>æ·±å…¥äº†è§£åº•å±‚å®ç°</td><td>9</td></tr><tr><td></td><td>Spring</td><td></td><td>8</td></tr><tr><td></td><td>SpringMVC</td><td></td><td>2</td></tr><tr><td></td><td>SpringBoot</td><td></td><td>5</td></tr><tr><td>ORM</td><td>Mybatis</td><td>æ·±å…¥äº†è§£åº•å±‚å®ç°</td><td>7</td></tr><tr><td>æ•°æ®åº“</td><td>ä»»ä¸€</td><td>ç†Ÿæ‚‰æ•°æ®åº“ä¼˜åŒ–</td><td>10</td></tr><tr><td></td><td>Mysql</td><td></td><td>8</td></tr><tr><td></td><td>Oracle</td><td></td><td>4</td></tr><tr><td></td><td>db2</td><td></td><td>2</td></tr><tr><td></td><td>sqlä¼˜åŒ–</td><td></td><td>1</td></tr><tr><td>åˆ†å¸ƒå¼ç³»ç»Ÿ</td><td>é¡¹ç›®</td><td>ç†Ÿæ‚‰è®¾è®¡å’Œåº”ç”¨</td><td>6</td></tr><tr><td></td><td>ç›‘æ§ã€éƒ¨ç½²</td><td></td><td>1</td></tr><tr><td></td><td>è´Ÿè½½å‡è¡¡</td><td></td><td>1</td></tr><tr><td>åˆ†å¸ƒå¼ç¼“å­˜</td><td>ä»»ä¸€</td><td>ç†Ÿç»ƒä½¿ç”¨ï¼Œä¼˜åŒ–</td><td>9</td></tr><tr><td></td><td>Redis</td><td></td><td>6</td></tr><tr><td></td><td>Memcache</td><td></td><td>2</td></tr><tr><td></td><td>MongoDB</td><td></td><td>2</td></tr><tr><td></td><td>Hbase</td><td></td><td>1</td></tr><tr><td>æ¶ˆæ¯é˜Ÿåˆ—</td><td>ä»»ä¸€</td><td>ç†Ÿæ‚‰è§£å†³æ–¹æ¡ˆåŠåº”ç”¨åœºæ™¯</td><td>9</td></tr><tr><td></td><td>RabbitMQ</td><td></td><td>4</td></tr><tr><td></td><td>ActiveMQ</td><td></td><td>1</td></tr><tr><td></td><td>Kafka</td><td></td><td>2</td></tr><tr><td>WebæœåŠ¡å™¨</td><td>Nginx</td><td>ä¼˜åŒ–é…ç½®ä¸ä½¿ç”¨</td><td>2</td></tr><tr><td></td><td>Tomcat</td><td></td><td>2</td></tr><tr><td></td><td>ç¼“å­˜æœåŠ¡å™¨</td><td></td><td>1</td></tr><tr><td>ä¸­é—´ä»¶</td><td>Elasticsearch</td><td>ä½¿ç”¨å’ŒåŸç†</td><td>1</td></tr><tr><td>UML</td><td></td><td>ç†Ÿæ‚‰</td><td>1</td></tr><tr><td>è®¾è®¡æ¨¡å¼</td><td></td><td>äº†è§£</td><td>1</td></tr><tr><td>å¾®æœåŠ¡</td><td>ä»»ä¸€</td><td></td><td>5</td></tr><tr><td></td><td>Dubbo</td><td></td><td>3</td></tr><tr><td></td><td>Spring Cloud</td><td></td><td>2</td></tr><tr><td>å·¥å…·</td><td>Docker</td><td>ç†Ÿç»ƒæŒæ¡</td><td>1</td></tr><tr><td></td><td>K8s</td><td></td><td>1</td></tr><tr><td></td><td>Linux</td><td>ç†Ÿæ‚‰æ“ä½œï¼Œæœ‰Linuxç¯å¢ƒä¸‹å¤šçº¿ç¨‹ã€å¹¶å‘ã€ç½‘ç»œç¼–ç¨‹ç»éªŒï¼Œå¸¸ç”¨å‘½ä»¤</td><td>2</td></tr><tr><td>è„šæœ¬è¯­è¨€</td><td>ä»»ä¸€</td><td>ç†Ÿæ‚‰</td><td>2</td></tr><tr><td></td><td>shell</td><td></td><td>2</td></tr><tr><td></td><td>php</td><td></td><td>1</td></tr><tr><td></td><td>python</td><td></td><td>1</td></tr><tr><td>å‰ç«¯</td><td>JS</td><td></td><td>2</td></tr><tr><td></td><td>Jquery</td><td></td><td>2</td></tr><tr><td></td><td>VUE</td><td></td><td>2</td></tr><tr><td>ç½‘ç»œ</td><td>åŸºç¡€</td><td></td><td>1</td></tr><tr><td></td><td>TCP/IP</td><td>åŸç†</td><td>1</td></tr><tr><td>å¼€æºé¡¹ç›®</td><td></td><td>æœ‰ç»éªŒ</td><td>2</td></tr><tr><td>é«˜å¹¶å‘ã€é«˜è´Ÿè½½ã€é«˜å¯ç”¨</td><td></td><td>è®¾è®¡å’Œå¼€å‘ï¼Œä¼˜å…ˆ</td><td>7</td></tr><tr><td>åˆ†å¸ƒå¼é˜Ÿåˆ—</td><td></td><td>ä¼˜å…ˆ</td><td>1</td></tr><tr><td>åˆ†å¸ƒå¼ä»»åŠ¡åˆ†å‘æ¡†æ¶</td><td></td><td>ä¼˜å…ˆ</td><td>1</td></tr><tr><td>å…¨æ–‡æ£€ç´¢åŠåˆ†è¯</td><td></td><td>ä¼˜å…ˆ</td><td>1</td></tr><tr><td>æµ·é‡æ•°æ®å­˜å‚¨å’Œå¤„ç†</td><td></td><td>ä¼˜å…ˆ</td><td>4</td></tr><tr><td>åˆ†å¸ƒå¼å­˜å‚¨</td><td></td><td>ä¼˜å…ˆ</td><td>1</td></tr><tr><td>Flinkã€Clickhouse</td><td></td><td>ä¼˜å…ˆ</td><td>1</td></tr><tr><td>Java EEã€SOAã€OSGIã€jax-rs</td><td></td><td>ç†Ÿæ‚‰ç›¸å…³æŠ€æœ¯</td><td>1</td></tr></tbody></table><h2 id="ç®€å•è§„åˆ’"><a href="#ç®€å•è§„åˆ’" class="headerlink" title="ç®€å•è§„åˆ’"></a><strong>ç®€å•è§„åˆ’</strong></h2><p>æ ¹æ®å²—ä½è¦æ±‚è¿›è¡Œç®€å•è§„åˆ’ï¼Œå…ˆå­¦é™Œç”Ÿçš„æŠ€æœ¯ï¼Œå†è¡¥ä¸è¶³ã€‚</p><p>éœ€è¦å­¦ä¼šå’Œç²¾é€šçš„æŠ€æœ¯ï¼š</p><ul><li>Javaã€é›†åˆã€å¤šçº¿ç¨‹ã€å¹¶å‘ç¼–ç¨‹ã€ç½‘ç»œç¼–ç¨‹ã€JVMã€IOã€NIO</li><li>Springã€Spring MVCã€Spring Boot</li><li>MyBatisã€MySqlã€Redisã€RabbitMQã€ELK</li><li>Dubboã€Zookeeper ã€Spring Cloud</li><li>Linuxã€Dockerã€k8sã€shell</li><li>ç½‘ç»œã€æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼ç³»ç»Ÿã€æµ·é‡æ•°æ®å¤„ç†</li></ul><p>å°†ä»¥ä¸Šå†…å®¹è¡¥å……åˆ°ã€Š<a href="../2018080801.html" title="Title">JavaæŠ€æœ¯æ ˆ-å­¦ä¹ è·¯çº¿</a>ã€‹ã€‚</p><p>æœ€åç½—åˆ—ä¸€ä¸‹å­¦ä¹ çš„ä¼˜å…ˆçº§ï¼š</p><ul><li><p>éœ€è¦ç³»ç»Ÿå­¦ä¹ ï¼šMysql -&gt; RabbitMQ -&gt; Zookeeper + Dubbo -&gt; Spring Cloud -&gt; Redis</p></li><li><p>åªè¦å®æˆ˜å­¦ä¹ ï¼šMyBatis -&gt; ELK -&gt; Linux + shell -&gt; Docker -&gt; k8s</p></li></ul>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†ä¸€ä¸‹JavaèŒåœºä¿¡æ¯ï¼Œä¸ºè‡ªå·±è®¾å®šä¸€ä¸ªä¸€å¹´åçš„ç›®æ ‡ã€‚
    
    </summary>
    
      <category term="ç¬”è®°æ‚è°ˆ" scheme="http://linyishui.top/categories/%E7%AC%94%E8%AE%B0%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="java" scheme="http://linyishui.top/tags/java/"/>
    
      <category term="other" scheme="http://linyishui.top/tags/other/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦ä¹ dubboï¼ˆä¸€ï¼‰ç®€ä»‹å’Œæ­å»º</title>
    <link href="http://linyishui.top/2020090301.html"/>
    <id>http://linyishui.top/2020090301.html</id>
    <published>2020-09-03T06:12:39.000Z</published>
    <updated>2020-10-02T08:15:00.048Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="dubboï¼ˆä¸€ï¼‰ç®€ä»‹å’Œæ­å»º"><a href="#dubboï¼ˆä¸€ï¼‰ç®€ä»‹å’Œæ­å»º" class="headerlink" title="dubboï¼ˆä¸€ï¼‰ç®€ä»‹å’Œæ­å»º"></a><strong>dubboï¼ˆä¸€ï¼‰ç®€ä»‹å’Œæ­å»º</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-æ¦‚è¿°"><a href="#ç¬¬ä¸€èŠ‚-æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€èŠ‚ æ¦‚è¿°"></a><strong>ç¬¬ä¸€èŠ‚ æ¦‚è¿°</strong></h2><h3 id="1-1-èƒŒæ™¯"><a href="#1-1-èƒŒæ™¯" class="headerlink" title="1.1 èƒŒæ™¯"></a><strong>1.1 èƒŒæ™¯</strong></h3><p>ç½‘ç«™è§„æ¨¡çš„æ‰©å¤§ï¼ŒæŠ€æœ¯æ¶æ„ç»å†äº†ä»<strong>å•ä¸€åº”ç”¨æ¶æ„</strong>åˆ°<strong>å‚ç›´åº”ç”¨æ¶æ„</strong>ï¼Œæœ€ååˆ°<strong>åˆ†å¸ƒå¼æœåŠ¡æ¶æ„</strong>å’Œ<strong>æµåŠ¨è®¡ç®—æ¶æ„</strong>çš„å‘å±•å†ç¨‹ã€‚</p><p><img src="http://dubbo.apache.org/docs/zh-cn/user/sources/images/dubbo-architecture-roadmap.jpg" alt></p><ul><li><strong>å•ä¸€åº”ç”¨æ¶æ„</strong>ï¼šå½“ç½‘ç«™æµé‡å¾ˆå°æ—¶ï¼Œåªéœ€ä¸€ä¸ªåº”ç”¨ï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚æ­¤æ—¶ï¼Œç”¨äºç®€åŒ–å¢åˆ æ”¹æŸ¥å·¥ä½œé‡çš„æ•°æ®è®¿é—®æ¡†æ¶(ORM)æ˜¯å…³é”®ã€‚<ul><li>é€‚åˆå°å‹ç½‘ç«™ï¼Œå°å‹ç®¡ç†ç³»ç»Ÿï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åˆ°ä¸€ä¸ªåŠŸèƒ½é‡Œï¼Œç®€å•æ˜“ç”¨ã€‚</li><li>ç¼ºç‚¹ï¼š<ul><li>æ€§èƒ½æ‰©å±•æ¯”è¾ƒéš¾</li><li>ååŒå¼€å‘é—®é¢˜</li><li>ä¸åˆ©äºå‡çº§ç»´æŠ¤</li></ul></li></ul></li><li><strong>å‚ç›´åº”ç”¨æ¶æ„</strong>ï¼šå½“è®¿é—®é‡é€æ¸å¢å¤§ï¼Œå•ä¸€åº”ç”¨å¢åŠ æœºå™¨å¸¦æ¥çš„åŠ é€Ÿåº¦è¶Šæ¥è¶Šå°ï¼Œå°†åº”ç”¨æ‹†æˆäº’ä¸ç›¸å¹²çš„å‡ ä¸ªåº”ç”¨ï¼Œä»¥æå‡æ•ˆç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºåŠ é€Ÿå‰ç«¯é¡µé¢å¼€å‘çš„Webæ¡†æ¶(MVC)æ˜¯å…³é”®ã€‚<ul><li>é€šè¿‡åˆ‡åˆ†ä¸šåŠ¡æ¥å®ç°å„ä¸ªæ¨¡å—ç‹¬ç«‹éƒ¨ç½²ï¼Œé™ä½äº†ç»´æŠ¤å’Œéƒ¨ç½²çš„éš¾åº¦ï¼Œå›¢é˜Ÿå„å¸å…¶èŒæ›´æ˜“ç®¡ç†ï¼Œæ€§èƒ½æ‰©å±•ä¹Ÿæ›´æ–¹ä¾¿ï¼Œæ›´æœ‰é’ˆå¯¹æ€§ã€‚</li><li>ç¼ºç‚¹ï¼š å…¬ç”¨æ¨¡å—æ— æ³•é‡å¤åˆ©ç”¨ï¼Œå¼€å‘æ€§çš„æµªè´¹ã€‚</li></ul></li><li><strong>åˆ†å¸ƒå¼æœåŠ¡æ¶æ„</strong>ï¼šå½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„<strong>åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶</strong>(RPC)æ˜¯å…³é”®ã€‚</li><li><strong>æµåŠ¨è®¡ç®—æ¶æ„</strong>ï¼šå½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾ç°ï¼Œæ­¤æ—¶éœ€å¢åŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚æ­¤æ—¶ï¼Œç”¨äº<strong>æé«˜æœºå™¨åˆ©ç”¨ç‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒ(SOA)[ Service Oriented Architecture]æ˜¯å…³é”®</strong>ã€‚</li></ul><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¯ä¸ªåŠŸèƒ½æ¨¡å—ä¹‹é—´æœ‰å¤æ‚çš„è”ç³»ï¼Œéœ€è¦æœ‰ä¸€ä¸ª<strong>æ²»ç†ç³»ç»Ÿ</strong>ç¡®ä¿æ¶æ„æœ‰æ¡ä¸ç´Šçš„æ¼”è¿›ã€‚</p><h3 id="1-2-RPCå’ŒRMI"><a href="#1-2-RPCå’ŒRMI" class="headerlink" title="1.2 RPCå’ŒRMI"></a><strong>1.2 RPCå’ŒRMI</strong></h3><p>RPCæ˜¯æŒ‡Remote Procedure Call Protocolï¼Œ<strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®</strong>ï¼Œæ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®ã€‚</p><p>å¸¸è§çš„å¼€æºæ¡†æ¶åŒ…æ‹¬ï¼š</p><ul><li><p>å•è¯­è¨€ï¼š</p><ul><li><p><strong>RMI</strong>ï¼šJava RMI ï¼ˆRemote Method Invocationï¼‰- è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ŒåŸºäºJavaè¿œç¨‹æ–¹æ³•åè®®(Java Remote Method Protocol) å’Œjavaçš„åŸç”Ÿåºåˆ—åŒ–ï¼Œèƒ½å¤Ÿ<strong>è®©å®¢æˆ·ç«¯åƒä½¿ç”¨æœ¬åœ°è°ƒç”¨ä¸€æ ·è°ƒç”¨æœåŠ¡ç«¯ Java è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡æ–¹æ³•</strong>ã€‚RMI æ˜¯é¢å‘å¯¹è±¡è¯­è¨€é¢†åŸŸå¯¹ RPC ï¼ˆRemote Procedure Callï¼‰çš„å®Œå–„ï¼Œç”¨æˆ·æ— éœ€ä¾é  IDL çš„å¸®åŠ©æ¥å®Œæˆåˆ†å¸ƒå¼è°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡<strong>ä¾èµ–æ¥å£</strong>è¿™ç§æ›´ç®€å•è‡ªç„¶çš„æ–¹å¼ã€‚</p></li><li><p><strong>Dubbo</strong>ï¼šé˜¿é‡Œå·´å·´å¼€å‘ï¼Œåªæ”¯æŒJavaã€‚</p></li><li><strong>Motan</strong>ï¼šå¾®åšå¼€å‘ï¼Œåªæ”¯æŒJavaã€‚</li><li><strong>Tars</strong>ï¼šè…¾è®¯å¼€å‘ï¼Œåªæ”¯æŒC++ã€‚</li><li><strong>Spring Cloud</strong>ï¼šPivotalå¼€å‘ï¼Œåªæ”¯æŒJavaã€‚</li></ul></li><li><p>è·¨è¯­è¨€ï¼š</p><ul><li><p><strong>gRPC</strong>ï¼šGoogleå¼€å‘ã€‚</p></li><li><p><strong>Thrift</strong>ï¼šFacebookå¼€å‘ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªä»£ç ç”Ÿæˆå¼•æ“è”åˆäº†ä¸€ä¸ªè½¯ä»¶æ ˆï¼Œæ¥åˆ›å»ºä¸åŒç¨‹åº¦çš„ã€æ— ç¼çš„<a href="https://zh.wikipedia.org/wiki/è·¨å¹³å°" target="_blank" rel="noopener">è·¨å¹³å°</a>é«˜æ•ˆæœåŠ¡ã€‚ä»¥å‰æ˜¯ç”±Facebookå¼€å‘çš„ï¼Œä½†å®ƒç°åœ¨æ˜¯<a href="https://zh.wikipedia.org/wiki/Apacheè½¯ä»¶åŸºé‡‘ä¼š" target="_blank" rel="noopener">Apacheè½¯ä»¶åŸºé‡‘ä¼š</a>çš„å¼€æºé¡¹ç›®äº†ã€‚</p></li><li><p><strong>Avro</strong>ï¼šä¸€ç§è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å’Œæ•°æ®åºåˆ—åŒ–æ¡†æ¶ï¼Œæ˜¯åœ¨Apacheçš„Hadoopé¡¹ç›®ä¹‹å†…å¼€å‘çš„ã€‚å®ƒä½¿ç”¨JSONæ¥å®šä¹‰æ•°æ®ç±»å‹å’Œé€šè®¯åè®®ï¼Œä½¿ç”¨å‹ç¼©äºŒè¿›åˆ¶æ ¼å¼æ¥åºåˆ—åŒ–æ•°æ®ã€‚å®ƒä¸»è¦ç”¨äºHadoopï¼Œå®ƒå¯ä»¥ä¸ºæŒä¹…åŒ–æ•°æ®æä¾›ä¸€ç§åºåˆ—åŒ–æ ¼å¼ï¼Œå¹¶ä¸ºHadoopèŠ‚ç‚¹é—´åŠä»å®¢æˆ·ç«¯ç¨‹åºåˆ°HadoopæœåŠ¡çš„é€šè®¯æä¾›ä¸€ç§ç”µæŠ¥æ ¼å¼ã€‚</p><p>å®ƒç±»ä¼¼äºThriftï¼Œä½†å½“æ•°æ®åº“æ¨¡å¼æ”¹å˜æ—¶ï¼Œå®ƒä¸è¦æ±‚è¿è¡Œä»£ç ç”Ÿæˆç¨‹åºï¼Œé™¤éæ˜¯å¯¹é™æ€ç±»å‹çš„è¯­è¨€ã€‚</p></li></ul></li></ul><h4 id="ï¼ˆ1ï¼‰RMIå·¥ä½œåŸç†"><a href="#ï¼ˆ1ï¼‰RMIå·¥ä½œåŸç†" class="headerlink" title="ï¼ˆ1ï¼‰RMIå·¥ä½œåŸç†"></a><strong>ï¼ˆ1ï¼‰RMIå·¥ä½œåŸç†</strong></h4><ol><li>æœåŠ¡ç«¯å‘ RMI æ³¨å†ŒæœåŠ¡ç»‘å®šè‡ªå·±çš„åœ°å€ï¼Œ</li><li>å®¢æˆ·ç«¯é€šè¿‡ RMI æ³¨å†ŒæœåŠ¡è·å–ç›®æ ‡åœ°å€ï¼Œ</li><li>å®¢æˆ·ç«¯è°ƒç”¨æœ¬åœ°çš„ Stub å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œå’Œè°ƒç”¨æœ¬åœ°å¯¹è±¡ä¸Šçš„æ–¹æ³•ä¸€è‡´ï¼Œ</li><li>æœ¬åœ°å­˜æ ¹å¯¹è±¡å°†è°ƒç”¨ä¿¡æ¯æ‰“åŒ…ï¼Œé€šè¿‡ç½‘ç»œå‘é€åˆ°æœåŠ¡ç«¯ï¼Œ</li><li>æœåŠ¡ç«¯çš„ Skeleton å¯¹è±¡æ”¶åˆ°ç½‘ç»œè¯·æ±‚ä¹‹åï¼Œå°†è°ƒç”¨ä¿¡æ¯è§£åŒ…ï¼Œ</li><li>ç„¶åæ‰¾åˆ°çœŸæ­£çš„æœåŠ¡å¯¹è±¡å‘èµ·è°ƒç”¨ï¼Œå¹¶å°†è¿”å›ç»“æœæ‰“åŒ…é€šè¿‡ç½‘ç»œå‘é€å›å®¢æˆ·ç«¯ã€‚</li></ol><p>æœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨æœ‰ä¸¤ä¸ªå…³é”®éƒ¨åˆ†ï¼š</p><ul><li>æœåŠ¡é—´é€šä¿¡ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¦å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œå¹¶ä¼ é€’æ•°æ®ã€‚æ‰€ä»¥é€šä¿¡æ•ˆç‡å†³å®šç€RPCæ¡†æ¶çš„æ€§èƒ½ï¼ˆå¦‚ä¼ é€’äºŒè¿›åˆ¶æµè¦å¿«äºXMLæˆ–JSONï¼‰</li><li>å¯¹è±¡åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šå‚æ•°å¯¹è±¡åœ¨ç½‘ç»œä¸­ä¼ é€’è¦è¿›è¡Œåºåˆ—åŒ–ï¼Œæ¥æ”¶åˆ°åè¦ååºåˆ—åŒ–è§£æã€‚æ‰€ä»¥åºåˆ—åŒ–æ•ˆç‡ä¹Ÿå†³å®šç€RPCæ¡†æ¶çš„æ€§èƒ½ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰RMIåŸºæœ¬æ¦‚å¿µ"><a href="#ï¼ˆ2ï¼‰RMIåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ï¼ˆ2ï¼‰RMIåŸºæœ¬æ¦‚å¿µ"></a><strong>ï¼ˆ2ï¼‰RMIåŸºæœ¬æ¦‚å¿µ</strong></h4><ol><li>é€šè¿‡<strong>æ¥å£</strong>è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼šå®¢æˆ·ç«¯éœ€è¦ä¾èµ–æ¥å£ï¼Œè€ŒæœåŠ¡ç«¯éœ€è¦æä¾›è¯¥æ¥å£çš„å®ç°ã€‚</li><li>é€šè¿‡å®¢æˆ·ç«¯çš„ <strong>Stub å¯¹è±¡</strong>å’ŒæœåŠ¡ç«¯çš„ <strong>Skeleton å¯¹è±¡</strong>çš„å¸®åŠ©å°†è¿œç¨‹è°ƒç”¨ä¼ªè£…æˆæœ¬åœ°è°ƒç”¨ï¼šåœ¨ J2SE 1.5 ç‰ˆæœ¬ä¹‹å‰éœ€è¦é€šè¿‡ rmic é¢„å…ˆç¼–è¯‘å¥½å®¢æˆ·ç«¯çš„ Stub å¯¹è±¡å’ŒæœåŠ¡ç«¯çš„ Skeleton å¯¹è±¡ã€‚åœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œä¸å†éœ€è¦äº‹å…ˆç”Ÿæˆ Stub å’Œ Skeleton å¯¹è±¡ã€‚</li><li>é€šè¿‡ <strong>RMI æ³¨å†ŒæœåŠ¡</strong>å®ŒæˆæœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ã€‚</li></ol><p>æœåŠ¡ç«¯æ³¨å†Œæ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–æœåŠ¡å¯¹è±¡å®ä¾‹</span></span><br><span class="line">Hello obj = <span class="keyword">new</span> HelloImpl(); </span><br><span class="line"><span class="comment">// ç”Ÿæˆå¯ä»¥ä¸æœåŠ¡ç«¯é€šè®¯çš„ Stub å¯¹è±¡</span></span><br><span class="line">Hello stub = (Hello) UnicastRemoteObject.exportObject(obj, <span class="number">0</span>); </span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„ RMI æ³¨å†ŒæœåŠ¡ï¼Œç›‘å¬ç«¯å£ä¸º 1099ã€‚è¯¥æ³¨å†ŒæœåŠ¡è¿è¡Œåœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå¯ä»¥å•ç‹¬å¯åŠ¨ä¸€ä¸ªæ³¨å†ŒæœåŠ¡çš„è¿›ç¨‹</span></span><br><span class="line">Registry registry = LocateRegistry.createRegistry(<span class="number">1099</span>); </span><br><span class="line"><span class="comment">// å°† Stub å¯¹è±¡ç»‘å®šåˆ°æ³¨å†ŒæœåŠ¡ä¸Šï¼Œè¿™æ ·ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ *Hello* è¿™ä¸ªåå­—æŸ¥æ‰¾åˆ°è¯¥è¿œç¨‹å¯¹è±¡</span></span><br><span class="line">registry.rebind(<span class="string">"Hello"</span>, stub);</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–æ³¨å†ŒæœåŠ¡å®ä¾‹ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œç”±äºæ²¡æœ‰ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œå‡å®šè¦è·å–çš„æ³¨å†ŒæœåŠ¡å®ä¾‹éƒ¨ç½²åœ¨æœ¬æœºï¼Œå¹¶ç›‘å¬åœ¨ 1099 ç«¯å£ä¸Š</span></span><br><span class="line">Registry registry = LocateRegistry.getRegistry();</span><br><span class="line"><span class="comment">// ä»æ³¨å†ŒæœåŠ¡ä¸­æŸ¥æ‰¾æœåŠ¡åä¸º *Hello* çš„è¿œç¨‹å¯¹è±¡</span></span><br><span class="line">Hello stub = (Hello) registry.lookup(<span class="string">"Hello"</span>);</span><br><span class="line"><span class="comment">// é€šè¿‡è·å–çš„ Stub å¯¹è±¡å‘èµ·ä¸€æ¬¡ RMI è°ƒç”¨å¹¶è·å¾—ç»“æœ</span></span><br><span class="line">String response = stub.sayHello();</span><br></pre></td></tr></table></figure><h3 id="1-3-ä¸ºä»€ä¹ˆéœ€è¦Dubboï¼Ÿ"><a href="#1-3-ä¸ºä»€ä¹ˆéœ€è¦Dubboï¼Ÿ" class="headerlink" title="1.3 ä¸ºä»€ä¹ˆéœ€è¦Dubboï¼Ÿ"></a><strong>1.3 ä¸ºä»€ä¹ˆéœ€è¦Dubboï¼Ÿ</strong></h3><p>åœ¨å¤§è§„æ¨¡æœåŠ¡åŒ–ä¹‹å‰ï¼Œåº”ç”¨å¯èƒ½åªæ˜¯é€šè¿‡ RMI æˆ– Hessian ç­‰å·¥å…·ï¼Œç®€å•çš„æš´éœ²å’Œå¼•ç”¨è¿œç¨‹æœåŠ¡ï¼Œé€šè¿‡é…ç½®æœåŠ¡çš„URLåœ°å€è¿›è¡Œè°ƒç”¨ï¼Œé€šè¿‡ F5 ç­‰ç¡¬ä»¶è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚</p><p><strong>å½“æœåŠ¡è¶Šæ¥è¶Šå¤šæ—¶ï¼ŒæœåŠ¡ URL é…ç½®ç®¡ç†å˜å¾—éå¸¸å›°éš¾ï¼ŒF5 ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨çš„å•ç‚¹å‹åŠ›ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚</strong> æ­¤æ—¶<strong>éœ€è¦ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆEurekaã€Zookeeperï¼‰ï¼ŒåŠ¨æ€åœ°æ³¨å†Œå’Œå‘ç°æœåŠ¡ï¼Œä½¿æœåŠ¡çš„ä½ç½®é€æ˜</strong>ã€‚å¹¶é€šè¿‡åœ¨æ¶ˆè´¹æ–¹è·å–æœåŠ¡æä¾›æ–¹åœ°å€åˆ—è¡¨ï¼Œå®ç°è½¯è´Ÿè½½å‡è¡¡å’Œ Failoverï¼Œé™ä½å¯¹ F5 ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨çš„ä¾èµ–ï¼Œä¹Ÿèƒ½å‡å°‘éƒ¨åˆ†æˆæœ¬ã€‚</p><p><strong>å½“è¿›ä¸€æ­¥å‘å±•ï¼ŒæœåŠ¡é—´ä¾èµ–å…³ç³»å˜å¾—é”™è¸ªå¤æ‚ï¼Œç”šè‡³åˆ†ä¸æ¸…å“ªä¸ªåº”ç”¨è¦åœ¨å“ªä¸ªåº”ç”¨ä¹‹å‰å¯åŠ¨ï¼Œæ¶æ„å¸ˆéƒ½ä¸èƒ½å®Œæ•´çš„æè¿°åº”ç”¨çš„æ¶æ„å…³ç³»ã€‚</strong> è¿™æ—¶ï¼Œéœ€è¦è‡ªåŠ¨ç”»å‡ºåº”ç”¨é—´çš„ä¾èµ–å…³ç³»å›¾ï¼Œä»¥å¸®åŠ©æ¶æ„å¸ˆç†æ¸…å…³ç³»ã€‚</p><p><strong>æ¥ç€ï¼ŒæœåŠ¡çš„è°ƒç”¨é‡è¶Šæ¥è¶Šå¤§ï¼ŒæœåŠ¡çš„å®¹é‡é—®é¢˜å°±æš´éœ²å‡ºæ¥ï¼Œè¿™ä¸ªæœåŠ¡éœ€è¦å¤šå°‘æœºå™¨æ”¯æ’‘ï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥åŠ æœºå™¨ï¼Ÿ</strong> ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç¬¬ä¸€æ­¥ï¼Œè¦å°†æœåŠ¡ç°åœ¨æ¯å¤©çš„è°ƒç”¨é‡ï¼Œå“åº”æ—¶é—´ï¼Œéƒ½ç»Ÿè®¡å‡ºæ¥ï¼Œä½œä¸ºå®¹é‡è§„åˆ’çš„å‚è€ƒæŒ‡æ ‡ã€‚å…¶æ¬¡ï¼Œè¦å¯ä»¥åŠ¨æ€è°ƒæ•´æƒé‡ï¼Œåœ¨çº¿ä¸Šï¼Œå°†æŸå°æœºå™¨çš„æƒé‡ä¸€ç›´åŠ å¤§ï¼Œå¹¶åœ¨åŠ å¤§çš„è¿‡ç¨‹ä¸­è®°å½•å“åº”æ—¶é—´çš„å˜åŒ–ï¼Œç›´åˆ°å“åº”æ—¶é—´åˆ°è¾¾é˜ˆå€¼ï¼Œè®°å½•æ­¤æ—¶çš„è®¿é—®é‡ï¼Œå†ä»¥æ­¤è®¿é—®é‡ä¹˜ä»¥æœºå™¨æ•°åæ¨æ€»å®¹é‡ã€‚</p><p><img src="http://dubbo.apache.org/docs/zh-cn/user/sources/images/dubbo-service-governance.jpg" alt></p><p>dubboçš„æ ¸å¿ƒç‰¹æ€§ï¼š</p><ul><li><strong>è¿œç¨‹æ–¹æ³•è°ƒç”¨</strong>ï¼šé¢å‘æ¥å£ä»£ç†çš„é«˜æ€§èƒ½RPCè°ƒç”¨ï¼Œä½¿ç”¨æ—¶åªéœ€è°ƒç”¨æ¥å£å³å¯ã€‚</li><li><strong>æ™ºèƒ½è´Ÿè½½å‡è¡¡</strong>ï¼šåŒä¸€ä¸ªæœåŠ¡å¯èƒ½æœ‰å¤šå°æœåŠ¡å™¨åœ¨è¿è¡Œï¼Œæ¯å°æœåŠ¡å™¨æœ‰ä¸åŒçš„å·¥ä½œçŠ¶æ€ï¼Œè´Ÿè½½å‡è¡¡ä¼šå°½é‡çš„æŒ‘é€‰ä¼‘é—²çš„æœåŠ¡å™¨ã€‚</li><li><strong>æœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°</strong>ï¼šæ‰€æœ‰æœåŠ¡éƒ½è¦æ³¨å†Œåˆ°ä¸­å¿ƒï¼Œä¸­å¿ƒè´Ÿè´£ç®¡ç†æ‰€æœ‰æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼ŒæœåŠ¡éƒ¨ç½²åœ¨å“ªäº›æœåŠ¡å™¨è¿™äº›ä¿¡æ¯å¯ä»¥åœ¨ä¸­å¿ƒè·å–ã€‚</li><li><strong>é«˜åº¦å¯æ‰©å±•</strong>ï¼šéµå¾ªå¾®å†…æ ¸å’Œæ’ä»¶çš„è®¾è®¡åŸåˆ™ï¼Œæ ¸å¿ƒåŠŸèƒ½å¦‚Protocolã€Transportã€Serializationéƒ½è¢«è®¾è®¡ä¸ºæ‰©å±•ç‚¹ï¼ŒåŒç­‰å¯¹å¾…å†…ç½®å®ç°å’Œç¬¬ä¸‰æ–¹å®ç°ã€‚</li><li><strong>è¿è¡ŒæœŸæµé‡è°ƒåº¦</strong>ï¼šå†…ç½®æ¡ä»¶ã€è„šæœ¬ç­‰è·¯ç”±ç­–ç•¥ï¼Œé€šè¿‡é…ç½®ä¸åŒçš„è·¯ç”±è§„åˆ™ï¼Œå®ç°ç°åº¦å‘å¸ƒã€åŒæœºæˆ¿ä¼˜å…ˆç­‰åŠŸèƒ½ã€‚</li><li><strong>å¯è§†åŒ–çš„æœåŠ¡æ²»ç†ä¸è¿ç»´</strong>ï¼šæä¾›ä¸°å¯Œçš„æœåŠ¡æ²»ç†ã€è¿ç»´å·¥å…·ï¼šéšæ—¶æŸ¥è¯¢æœåŠ¡å…ƒæ•°æ®ã€æœåŠ¡å¥åº·çŠ¶æ€ä»¥åŠè°ƒç”¨ç»Ÿè®¡ï¼Œå®æ—¶ä¸‹å‘è·¯ç”±ç­–ç•¥ã€è°ƒæ•´é…ç½®å‚æ•°ã€‚</li></ul><h3 id="1-4-æŠ€æœ¯æ¶æ„"><a href="#1-4-æŠ€æœ¯æ¶æ„" class="headerlink" title="1.4 æŠ€æœ¯æ¶æ„"></a><strong>1.4 æŠ€æœ¯æ¶æ„</strong></h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªèŠ‚ç‚¹è§’è‰²ä¹‹é—´çš„å…³ç³»ï¼Œæ³¨æ„åªæœ‰æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æ˜¯åŒæ­¥ï¼Œå…¶ä»–éƒ½æ˜¯å¼‚æ­¥æ“ä½œã€‚</p><p><img src="http://dubbo.apache.org/docs/zh-cn/user/sources/images/dubbo-architecture.jpg" alt="dubbo-architucture"></p><h5 id="èŠ‚ç‚¹è§’è‰²è¯´æ˜"><a href="#èŠ‚ç‚¹è§’è‰²è¯´æ˜" class="headerlink" title="èŠ‚ç‚¹è§’è‰²è¯´æ˜"></a>èŠ‚ç‚¹è§’è‰²è¯´æ˜</h5><table><thead><tr><th>èŠ‚ç‚¹</th><th>è§’è‰²è¯´æ˜</th></tr></thead><tbody><tr><td><code>Provider</code></td><td>æš´éœ²æœåŠ¡çš„<strong>æœåŠ¡æä¾›æ–¹</strong></td></tr><tr><td><code>Consumer</code></td><td>è°ƒç”¨è¿œç¨‹æœåŠ¡çš„<strong>æœåŠ¡æ¶ˆè´¹æ–¹</strong></td></tr><tr><td><code>Registry</code></td><td>æœåŠ¡æ³¨å†Œä¸å‘ç°çš„<strong>æ³¨å†Œä¸­å¿ƒ</strong></td></tr><tr><td><code>Monitor</code></td><td>ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„<strong>ç›‘æ§ä¸­å¿ƒ</strong></td></tr><tr><td><code>Container</code></td><td><strong>æœåŠ¡è¿è¡Œå®¹å™¨</strong></td></tr></tbody></table><h5 id="è°ƒç”¨å…³ç³»è¯´æ˜"><a href="#è°ƒç”¨å…³ç³»è¯´æ˜" class="headerlink" title="è°ƒç”¨å…³ç³»è¯´æ˜"></a>è°ƒç”¨å…³ç³»è¯´æ˜</h5><ol><li>æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚</li><li>æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚</li><li>æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚</li><li>æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚</li><li>æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚</li><li>æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚</li></ol><p>Dubbo æ¶æ„å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼Œåˆ†åˆ«æ˜¯è¿é€šæ€§ã€å¥å£®æ€§ã€ä¼¸ç¼©æ€§ã€ä»¥åŠå‘æœªæ¥æ¶æ„çš„å‡çº§æ€§ã€‚</p><h5 id="è¿é€šæ€§"><a href="#è¿é€šæ€§" class="headerlink" title="è¿é€šæ€§"></a>è¿é€šæ€§</h5><ul><li>æ³¨å†Œä¸­å¿ƒè´Ÿè´£æœåŠ¡åœ°å€çš„æ³¨å†Œä¸æŸ¥æ‰¾ï¼Œç›¸å½“äºç›®å½•æœåŠ¡ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…åªåœ¨å¯åŠ¨æ—¶ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’ï¼Œæ³¨å†Œä¸­å¿ƒä¸è½¬å‘è¯·æ±‚ï¼Œå‹åŠ›è¾ƒå°</li><li>ç›‘æ§ä¸­å¿ƒè´Ÿè´£ç»Ÿè®¡å„æœåŠ¡è°ƒç”¨æ¬¡æ•°ï¼Œè°ƒç”¨æ—¶é—´ç­‰ï¼Œç»Ÿè®¡å…ˆåœ¨å†…å­˜æ±‡æ€»åæ¯åˆ†é’Ÿä¸€æ¬¡å‘é€åˆ°ç›‘æ§ä¸­å¿ƒæœåŠ¡å™¨ï¼Œå¹¶ä»¥æŠ¥è¡¨å±•ç¤º</li><li>æœåŠ¡æä¾›è€…å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå…¶æä¾›çš„æœåŠ¡ï¼Œå¹¶æ±‡æŠ¥è°ƒç”¨æ—¶é—´åˆ°ç›‘æ§ä¸­å¿ƒï¼Œæ­¤æ—¶é—´ä¸åŒ…å«ç½‘ç»œå¼€é”€</li><li>æœåŠ¡æ¶ˆè´¹è€…å‘æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ï¼Œå¹¶æ ¹æ®è´Ÿè½½ç®—æ³•ç›´æ¥è°ƒç”¨æä¾›è€…ï¼ŒåŒæ—¶æ±‡æŠ¥è°ƒç”¨æ—¶é—´åˆ°ç›‘æ§ä¸­å¿ƒï¼Œæ­¤æ—¶é—´åŒ…å«ç½‘ç»œå¼€é”€</li><li>æ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡æä¾›è€…ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¸‰è€…ä¹‹é—´å‡ä¸ºé•¿è¿æ¥ï¼Œç›‘æ§ä¸­å¿ƒé™¤å¤–</li><li>æ³¨å†Œä¸­å¿ƒé€šè¿‡é•¿è¿æ¥æ„ŸçŸ¥æœåŠ¡æä¾›è€…çš„å­˜åœ¨ï¼ŒæœåŠ¡æä¾›è€…å®•æœºï¼Œæ³¨å†Œä¸­å¿ƒå°†ç«‹å³æ¨é€äº‹ä»¶é€šçŸ¥æ¶ˆè´¹è€…</li><li>æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒå…¨éƒ¨å®•æœºï¼Œä¸å½±å“å·²è¿è¡Œçš„æä¾›è€…å’Œæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…åœ¨æœ¬åœ°ç¼“å­˜äº†æä¾›è€…åˆ—è¡¨</li><li>æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒéƒ½æ˜¯å¯é€‰çš„ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¯ä»¥ç›´è¿æœåŠ¡æä¾›è€…</li></ul><h5 id="å¥å£®æ€§"><a href="#å¥å£®æ€§" class="headerlink" title="å¥å£®æ€§"></a>å¥å£®æ€§</h5><ul><li>ç›‘æ§ä¸­å¿ƒå®•æ‰ä¸å½±å“ä½¿ç”¨ï¼Œåªæ˜¯ä¸¢å¤±éƒ¨åˆ†é‡‡æ ·æ•°æ®</li><li>æ•°æ®åº“å®•æ‰åï¼Œæ³¨å†Œä¸­å¿ƒä»èƒ½é€šè¿‡ç¼“å­˜æä¾›æœåŠ¡åˆ—è¡¨æŸ¥è¯¢ï¼Œä½†ä¸èƒ½æ³¨å†Œæ–°æœåŠ¡</li><li>æ³¨å†Œä¸­å¿ƒå¯¹ç­‰é›†ç¾¤ï¼Œä»»æ„ä¸€å°å®•æ‰åï¼Œå°†è‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€å°</li><li>æ³¨å†Œä¸­å¿ƒå…¨éƒ¨å®•æ‰åï¼ŒæœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ä»èƒ½é€šè¿‡æœ¬åœ°ç¼“å­˜é€šè®¯</li><li>æœåŠ¡æä¾›è€…æ— çŠ¶æ€ï¼Œä»»æ„ä¸€å°å®•æ‰åï¼Œä¸å½±å“ä½¿ç”¨</li><li>æœåŠ¡æä¾›è€…å…¨éƒ¨å®•æ‰åï¼ŒæœåŠ¡æ¶ˆè´¹è€…åº”ç”¨å°†æ— æ³•ä½¿ç”¨ï¼Œå¹¶æ— é™æ¬¡é‡è¿ç­‰å¾…æœåŠ¡æä¾›è€…æ¢å¤</li></ul><h5 id="ä¼¸ç¼©æ€§"><a href="#ä¼¸ç¼©æ€§" class="headerlink" title="ä¼¸ç¼©æ€§"></a>ä¼¸ç¼©æ€§</h5><ul><li>æ³¨å†Œä¸­å¿ƒä¸ºå¯¹ç­‰é›†ç¾¤ï¼Œå¯åŠ¨æ€å¢åŠ æœºå™¨éƒ¨ç½²å®ä¾‹ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯å°†è‡ªåŠ¨å‘ç°æ–°çš„æ³¨å†Œä¸­å¿ƒ</li><li>æœåŠ¡æä¾›è€…æ— çŠ¶æ€ï¼Œå¯åŠ¨æ€å¢åŠ æœºå™¨éƒ¨ç½²å®ä¾‹ï¼Œæ³¨å†Œä¸­å¿ƒå°†æ¨é€æ–°çš„æœåŠ¡æä¾›è€…ä¿¡æ¯ç»™æ¶ˆè´¹è€…</li></ul><h5 id="å‡çº§æ€§"><a href="#å‡çº§æ€§" class="headerlink" title="å‡çº§æ€§"></a>å‡çº§æ€§</h5><p>å½“æœåŠ¡é›†ç¾¤è§„æ¨¡è¿›ä¸€æ­¥æ‰©å¤§ï¼Œå¸¦åŠ¨ITæ²»ç†ç»“æ„è¿›ä¸€æ­¥å‡çº§ï¼Œéœ€è¦å®ç°åŠ¨æ€éƒ¨ç½²ï¼Œè¿›è¡ŒæµåŠ¨è®¡ç®—ï¼Œç°æœ‰åˆ†å¸ƒå¼æœåŠ¡æ¶æ„ä¸ä¼šå¸¦æ¥é˜»åŠ›ã€‚ä¸‹å›¾æ˜¯æœªæ¥å¯èƒ½çš„ä¸€ç§æ¶æ„ï¼š</p><p><img src="http://dubbo.apache.org/docs/zh-cn/user/sources/images/dubbo-architecture-future.jpg" alt="dubbo-architucture-futures"></p><h5 id="èŠ‚ç‚¹è§’è‰²è¯´æ˜-1"><a href="#èŠ‚ç‚¹è§’è‰²è¯´æ˜-1" class="headerlink" title="èŠ‚ç‚¹è§’è‰²è¯´æ˜"></a>èŠ‚ç‚¹è§’è‰²è¯´æ˜</h5><table><thead><tr><th>èŠ‚ç‚¹</th><th>è§’è‰²è¯´æ˜</th></tr></thead><tbody><tr><td><code>Deployer</code></td><td>è‡ªåŠ¨éƒ¨ç½²æœåŠ¡çš„æœ¬åœ°ä»£ç†</td></tr><tr><td><code>Repository</code></td><td>ä»“åº“ç”¨äºå­˜å‚¨æœåŠ¡åº”ç”¨å‘å¸ƒåŒ…</td></tr><tr><td><code>Scheduler</code></td><td>è°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›è‡ªåŠ¨å¢å‡æœåŠ¡æä¾›è€…</td></tr><tr><td><code>Admin</code></td><td>ç»Ÿä¸€ç®¡ç†æ§åˆ¶å°</td></tr><tr><td><code>Registry</code></td><td>æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ</td></tr><tr><td><code>Monitor</code></td><td>ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ</td></tr></tbody></table><hr><h2 id="ç¬¬äºŒèŠ‚-å…¥é—¨"><a href="#ç¬¬äºŒèŠ‚-å…¥é—¨" class="headerlink" title="ç¬¬äºŒèŠ‚ å…¥é—¨"></a><strong>ç¬¬äºŒèŠ‚ å…¥é—¨</strong></h2><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/apache" target="_blank" rel="noopener">apache</a>/<strong><a href="https://github.com/apache/dubbo" target="_blank" rel="noopener">dubbo</a></strong></p><h3 id="2-1-å®‰è£…"><a href="#2-1-å®‰è£…" class="headerlink" title="2.1 å®‰è£…"></a><strong>2.1 å®‰è£…</strong></h3><p>å®‰è£…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/apache/dubbo.git</span><br><span class="line"><span class="built_in">cd</span> dubbo/dubbo-demo/dubbo-demo-xml</span><br><span class="line">è¿è¡Œ dubbo-demo-xml-providerä¸­çš„org.apache.dubbo.demo.provider.Application</span><br><span class="line">å¦‚æœä½¿ç”¨Intellij Idea è¯·åŠ ä¸Š-Djava.net.preferIPv4Stack=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>é…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resources/spring/dubbo-provider.xml</span><br><span class="line">ä¿®æ”¹å…¶ä¸­çš„dubbo:registryï¼Œæ›¿æ¢æˆçœŸå®çš„æ³¨å†Œä¸­å¿ƒåœ°å€ï¼Œæ¨èä½¿ç”¨zookeeperï¼Œå¦‚ï¼š</span><br><span class="line">&lt;dubbo:registry address=<span class="string">"zookeeper://127.0.0.1:2181"</span>/&gt;</span><br></pre></td></tr></table></figure><p>é€šè¿‡Ideaæ‰“å¼€é¡¹ç›®ï¼Œç­‰å¾…ä¾èµ–ä¸‹è½½å®Œæ¯•åæŒ‰å®˜ç½‘æ•™ç¨‹å¯åŠ¨ <code>dubbo-demo-xml-provider</code> ã€‚</p><p>å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\Java\WorkPlace\FromGitHub\dubbo-master\dubbo-config\dubbo-config-api\src\<span class="built_in">test</span>\java\org\apache\dubbo\config\bootstrap\rest\UserService.java</span><br><span class="line">Error:(22, 50) java: ç¨‹åºåŒ…org.apache.dubbo.rpc.protocol.rest.supportä¸å­˜åœ¨</span><br><span class="line">Error:(37, 12) java: æ‰¾ä¸åˆ°ç¬¦å·</span><br><span class="line">  ç¬¦å·: å˜é‡ ContentType</span><br><span class="line">Error:(37, 48) java: æ‰¾ä¸åˆ°ç¬¦å·</span><br><span class="line">  ç¬¦å·: å˜é‡ ContentType</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ï¼ˆdubbo-config-apiï¼‰<code>pom.xml</code> å¹¶æ³¨é‡Šæ‰æ‰€æœ‰Mavençš„testä½œç”¨åŸŸã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment">&lt;!-- FIXME, we shouldn't rely on these modules, even in test scope --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-rpc-dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.parent.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‡å¯ï¼ŒOKä¸Šè¿°é”™è¯¯ä¸å†æç¤ºï¼Œä½†æœ‰äº†æ–°çš„é”™è¯¯ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Error:(26, 52) java: ç¨‹åºåŒ…org.apache.dubbo.common.serialize.nativejavaä¸å­˜åœ¨</span><br><span class="line">Error:(99, 43) java: æ‰¾ä¸åˆ°ç¬¦å·</span><br><span class="line">  ç¬¦å·:   ç±» NativeJavaSerialization</span><br><span class="line">  ä½ç½®: ç±» org.apache.dubbo.rpc.protocol.hessian.HessianProtocolTest</span><br><span class="line">Warning:(110, 59) java: org.apache.dubbo.common.serialize.ObjectInputä¸­çš„readObject()å·²è¿‡æ—¶</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ï¼ˆdubbo-rpc-restï¼‰<code>pom.xml</code> å¹¶æ³¨é‡Šæ‰testä½œç”¨åŸŸã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-serialization-jdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.parent.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡å¯åŠ¨ï¼ŒOKé¡ºåˆ©è¿è¡Œã€‚</p><h3 id="2-2-ç®€å•ä½¿ç”¨"><a href="#2-2-ç®€å•ä½¿ç”¨" class="headerlink" title="2.2 ç®€å•ä½¿ç”¨"></a><strong>2.2 ç®€å•ä½¿ç”¨</strong></h3><h4 id="ï¼ˆ1ï¼‰æœåŠ¡æä¾›è€…"><a href="#ï¼ˆ1ï¼‰æœåŠ¡æä¾›è€…" class="headerlink" title="ï¼ˆ1ï¼‰æœåŠ¡æä¾›è€…"></a><strong>ï¼ˆ1ï¼‰æœåŠ¡æä¾›è€…</strong></h4><p>æ‰¾åˆ° <code>dubbo-demo-interface</code> å­é¡¹ç›®ï¼Œå…¶ä¸­æœ‰å®šä¹‰æ¥å£ <code>DemoService.java</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.dubbo.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">sayHello</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> CompletableFuture&lt;String&gt; <span class="title">sayHelloAsync</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.completedFuture(sayHello(name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ° <code>dubbo-demo-api</code> å­é¡¹ç›®ï¼Œå…¶ä¸­æœ‰å®šä¹‰æ¥å£å®ç° <code>DemoServiceImpl.java</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.dubbo.demo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.demo.DemoService;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.rpc.RpcContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(DemoServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"Hello "</span> + name + <span class="string">", request from consumer: "</span> + RpcContext.getContext().getRemoteAddress());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello "</span> + name + <span class="string">", response from provider: "</span> + RpcContext.getContext().getLocalAddress();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CompletableFuture&lt;String&gt; <span class="title">sayHelloAsync</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åé€šè¿‡Springçš„xmlé…ç½®æ¥å°†æœåŠ¡æš´éœ²ï¼Œ<code>provider.xml</code> ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- æä¾›æ–¹åº”ç”¨ä¿¡æ¯ï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³» --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"hello-world-app"</span>  /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- ä½¿ç”¨multicastå¹¿æ’­æ³¨å†Œä¸­å¿ƒæš´éœ²æœåŠ¡åœ°å€ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"multicast://224.5.6.7:1234"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- ç”¨dubboåè®®åœ¨20880ç«¯å£æš´éœ²æœåŠ¡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- å£°æ˜éœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"org.apache.dubbo.demo.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- å’Œæœ¬åœ°beanä¸€æ ·å®ç°æœåŠ¡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">class</span>=<span class="string">"org.apache.dubbo.demo.provider.DemoServiceImpl"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€ååœ¨ <code>dubbo-demo-xml-provider</code> å¯åŠ¨ç±»åŠ è½½Springé…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.dubbo.demo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"spring/dubbo-provider.xml"</span>);</span><br><span class="line">        context.start();</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰æœåŠ¡æ¶ˆè´¹è€…"><a href="#ï¼ˆ2ï¼‰æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="ï¼ˆ2ï¼‰æœåŠ¡æ¶ˆè´¹è€…"></a><strong>ï¼ˆ2ï¼‰æœåŠ¡æ¶ˆè´¹è€…</strong></h4><p>é¦–å…ˆé€šè¿‡ Spring é…ç½®å¼•ç”¨è¿œç¨‹æœåŠ¡ dubbo-consumer.xmlï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- æ¶ˆè´¹æ–¹åº”ç”¨åï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³»ï¼Œä¸æ˜¯åŒ¹é…æ¡ä»¶ï¼Œä¸è¦ä¸æä¾›æ–¹ä¸€æ · --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"consumer-of-helloworld-app"</span>  /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- ä½¿ç”¨multicastå¹¿æ’­æ³¨å†Œä¸­å¿ƒæš´éœ²å‘ç°æœåŠ¡åœ°å€ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"multicast://224.5.6.7:1234"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- ç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†ï¼Œå¯ä»¥å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨demoService --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"org.apache.dubbo.demo.DemoService"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment">  contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment">  this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment">  The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment">  (the "License"); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment">  the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License.</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"demo-consumer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">"mapping-type"</span> <span class="attr">value</span>=<span class="string">"metadata"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">"enable-auto-migration"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dubbo:application</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    &lt;dubbo:metadata-report address="zookeeper://127.0.0.1:2181"/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://127.0.0.1:2181"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">provided-by</span>=<span class="string">"demo-provider"</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">check</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">"org.apache.dubbo.demo.DemoService"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">provided-by</span>=<span class="string">"demo-provider"</span> <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">group</span>=<span class="string">"greeting"</span> <span class="attr">id</span>=<span class="string">"greetingService"</span> <span class="attr">check</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">"org.apache.dubbo.demo.GreetingService"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååŠ è½½Springé…ç½®ï¼Œå¹¶è°ƒç”¨è¿œç¨‹æœåŠ¡Consumer.java </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.demo.DemoService;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="keyword">new</span> String[] &#123;<span class="string">"META-INF/spring/dubbo-demo-consumer.xml"</span>&#125;);</span><br><span class="line">        context.start();</span><br><span class="line">        DemoService demoService = (DemoService)context.getBean(<span class="string">"demoService"</span>); <span class="comment">// è·å–è¿œç¨‹æœåŠ¡ä»£ç†</span></span><br><span class="line">        String hello = demoService.sayHello(<span class="string">"world"</span>); <span class="comment">// æ‰§è¡Œè¿œç¨‹æ–¹æ³•</span></span><br><span class="line">        System.out.println( hello ); <span class="comment">// æ˜¾ç¤ºè°ƒç”¨ç»“æœ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.apache.dubbo.demo.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.demo.DemoService;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.demo.GreetingService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * In order to make sure multicast registry works, need to specify '-Djava.net.preferIPv4Stack=true' before</span></span><br><span class="line"><span class="comment">     * launch the application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"spring/dubbo-consumer.xml"</span>);</span><br><span class="line">        context.start();</span><br><span class="line">        DemoService demoService = context.getBean(<span class="string">"demoService"</span>, DemoService.class);</span><br><span class="line">        GreetingService greetingService = context.getBean(<span class="string">"greetingService"</span>, GreetingService.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                String greetings = greetingService.hello();</span><br><span class="line">                System.out.println(greetings + <span class="string">" from separated thread."</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            CompletableFuture&lt;String&gt; hello = demoService.sayHelloAsync(<span class="string">"world"</span>);</span><br><span class="line">            System.out.println(<span class="string">"result: "</span> + hello.get());</span><br><span class="line"></span><br><span class="line">            String greetings = greetingService.hello();</span><br><span class="line">            System.out.println(<span class="string">"result: "</span> + greetings);</span><br><span class="line"></span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol><li>è¯¥æ¥å£éœ€å•ç‹¬æ‰“åŒ…ï¼Œåœ¨æœåŠ¡æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹å…±äº« <a href="http://dubbo.apache.org/zh-cn/docs/user/quick-start.html#fnref1" target="_blank" rel="noopener">â†©ï¸</a></li><li>å¯¹æœåŠ¡æ¶ˆè´¹æ–¹éšè—å®ç° <a href="http://dubbo.apache.org/zh-cn/docs/user/quick-start.html#fnref2" target="_blank" rel="noopener">â†©ï¸</a></li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨ IoC æ³¨å…¥ <a href="http://dubbo.apache.org/zh-cn/docs/user/quick-start.html#fnref3" target="_blank" rel="noopener">â†©ï¸</a></li></ol><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— <a href="http://dubbo.apache.org/zh-cn/docs/user/dependencies.html" target="_blank" rel="noopener">Dubboå®˜ç½‘-æ–‡æ¡£</a></p><p>ğŸ”— <a href="http://jm.taobao.org/2018/06/13/%E5%BA%94%E7%94%A8/" target="_blank" rel="noopener">ç¬¬ä¸€ä¸ª Dubbo åº”ç”¨</a></p>]]></content>
    
    <summary type="html">
    
      ä»é›¶å¼€å§‹å­¦ä¹ Dubboï¼Œç¬¬ä¸€ç« ã€Šç®€ä»‹å’Œæ­å»ºã€‹
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="dubbo" scheme="http://linyishui.top/tags/dubbo/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼ˆä¸€ï¼‰å¯ç¨‹</title>
    <link href="http://linyishui.top/2020090101.html"/>
    <id>http://linyishui.top/2020090101.html</id>
    <published>2020-09-01T10:14:30.000Z</published>
    <updated>2020-10-02T08:16:26.708Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å¯ç¨‹"><a href="#å¯ç¨‹" class="headerlink" title="å¯ç¨‹"></a><strong>å¯ç¨‹</strong></h1><h3 id="ä¸ºä»€ä¹ˆè¦å­¦ä¹ è‹±è¯­ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å­¦ä¹ è‹±è¯­ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å­¦ä¹ è‹±è¯­ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆè¦å­¦ä¹ è‹±è¯­ï¼Ÿ</strong></h3><p>ä»Šå¤©ï¼Œå½“æˆ‘ç»ˆäºä¸‹å®šå†³å¿ƒè¦å¼€å§‹å­¦ä¹ è‹±è¯­æ—¶ï¼Œæˆ‘å‘ç°æœ€å¼€å§‹æƒ³è¦å­¦ä¹ ä¸€é—¨å¤–è¯­åˆ°ç°åœ¨å·²ç»è¿‡å»äº†å°†è¿‘5å¹´çš„æ—¶é—´ã€‚å¤§éƒ¨åˆ†äººåº”è¯¥å’Œæˆ‘ä¸€æ ·è™½ç„¶ä¼šè§‰å¾—è‡ªå·±åº”è¯¥è‡³å°‘å­¦ä¹ ä¸€é—¨å¤–è¯­ï¼Œä½†åœ¨æ€è€ƒè¿™ä¸ªé—®é¢˜æ—¶ï¼Œ<strong>æ€»æ˜¯ä¼šæƒ³åœ¨ä¸€ä¸ªæ›´åˆé€‚çš„æ—¶é—´å¼€å§‹å­¦ä¹ </strong>ã€‚</p><p>åœ¨é€ƒé¿å­¦ä¹ çš„è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘æœ‰æ—¶å¿™äºç©ä¹ï¼Œæœ‰æ—¶å¿™äºå·¥ä½œï¼Œä¸€ç›´åœ¨ç„¦è™‘å’Œéº»æœ¨çš„çŠ¶æ€ä¸­ç”Ÿæ´»ã€‚æ—¶é—´æ¥åˆ°è¿™ä¸ªæœˆï¼Œæˆ‘å¤„äºäººç”Ÿä¸­çš„ç¬¬äºŒä¸ªæ±‚èŒé˜¶æ®µï¼Œé¢è¯•çš„ä¸é¡ºåˆ©å’Œå†…å¿ƒçš„ä¸ç”˜å¿ƒï¼Œè®©æˆ‘çªç„¶å‘ç°ï¼Œ<strong>äººç”Ÿä¸­çš„å¤§éƒ¨åˆ†æ—¶é—´æˆ‘éƒ½æ˜¯åœ¨è¢«è¿«å­¦ä¹ </strong>ï¼šå°‘å¹´æ—¶å› ä¸ºè¦è€ƒè¯•è€Œå»å­¦ä¹ ï¼›æˆå¹´åè¿›å…¥å¤§å­¦ï¼Œåˆä¸ºäº†å¥–å­¦é‡‘è€ŒçŸ­æš‚å­¦ä¹ è¿‡ï¼›å·¥ä½œåä¸ºäº†æ›´å¥½çš„å²—ä½å’Œè–ªæ°´è€Œå»å¼ºè¿«è‡ªå·±å­¦ä¹ ã€‚<strong>æˆ‘è¿˜ä»æ¥æ²¡æœ‰å› ä¸ºæƒ³è¦å­¦ä¸€ä¸ªä¸œè¥¿è€Œå»è®¤çœŸçš„å®ç°è¿™ä¸ªæƒ³æ³•ï¼Œè¿™è®©æˆ‘æ„è¯†åˆ°ä¸ç®¡æ˜å¤©ä¼šæ€æ ·ï¼Œæˆ‘éƒ½è¦ä»ä»Šå¤©å¼€å§‹æˆ‘çš„å­¦ä¹ è®¡åˆ’äº†</strong>ã€‚</p><p>æˆ‘ä¸ºè‡ªå·±æƒ³äº†å‡ ä¸ªå­¦ä¹ è‹±è¯­çš„ç›®çš„ï¼š</p><ul><li>ä¸ºäº†å’Œè‹±è¯­ä¸–ç•Œçš„äººäº¤æµï¼Œè®¤è¯†æ›´å¤šçš„æœ‹å‹ã€‚</li><li>ä¸å±€é™äºä¸­æ–‡ç¯å¢ƒï¼Œå»è§è¯†å’Œäº†è§£åˆ°æ›´å¤§èŒƒå›´çš„ä¸–ç•Œã€‚</li><li>æ— éšœç¢çš„çœ‹æ‡‚ç¾å‰§è€Œä¸ç”¨ç›¯ç€å­—å¹•ï¼Œå¯ä»¥å¬æ‡‚è‹±æ–‡æ­Œæ›²ã€‚</li><li>å°†æ¥æœ‰æ›´å¤šçš„å·¥ä½œæœºä¼šï¼Œä»¥åŠåœ¨å…¶ä»–ç¯å¢ƒç”Ÿæ´»çš„æœºä¼šã€‚</li><li>å¢å¼ºè‡ªä¿¡å¿ƒï¼Œæé«˜æˆ‘å¯¹è‡ªå·±çš„è‡ªæˆ‘è¯„ä»·ã€‚</li></ul><p>æˆ‘é¦–å…ˆé€‰æ‹©äº†ä¸€æœ¬åœ¨å¤§å­¦æ—¶å°±æ”¶è—çš„ä¹¦ç±ã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹ï¼Œåœ¨å¼€å¯è‹±è¯­å­¦ä¹ ä¹‹è·¯ä¸Šï¼Œå…ˆæ±²å–ä¸€ä¸‹åœ¨åŒæ ·äº‹æƒ…ä¸ŠæˆåŠŸçš„äººçš„ç»éªŒã€‚</p><hr><h3 id="å­¦ä¹ è¯­è¨€çš„é”™è¯¯è§‚ç‚¹"><a href="#å­¦ä¹ è¯­è¨€çš„é”™è¯¯è§‚ç‚¹" class="headerlink" title="å­¦ä¹ è¯­è¨€çš„é”™è¯¯è§‚ç‚¹"></a><strong>å­¦ä¹ è¯­è¨€çš„é”™è¯¯è§‚ç‚¹</strong></h3><p><strong>æˆ‘ä»¬ä¸ºå­¦ä¸ä¼šä¸€ç§è¯­è¨€æ‰¾çš„å€Ÿå£å¾€å¾€æ˜¯å¯¹è‡ªæˆ‘çš„é”™è¯¯è®¤çŸ¥ã€‚</strong></p><h4 id="è§‚ç‚¹1ï¼šå¹´çºªå¤ªå¤§ï¼Œä¸åˆ©äºå­¦ä¹ è¯­è¨€"><a href="#è§‚ç‚¹1ï¼šå¹´çºªå¤ªå¤§ï¼Œä¸åˆ©äºå­¦ä¹ è¯­è¨€" class="headerlink" title="è§‚ç‚¹1ï¼šå¹´çºªå¤ªå¤§ï¼Œä¸åˆ©äºå­¦ä¹ è¯­è¨€"></a>è§‚ç‚¹1ï¼šå¹´çºªå¤ªå¤§ï¼Œä¸åˆ©äºå­¦ä¹ è¯­è¨€</h4><p>è¿™ç§è§‚ç‚¹ä»æ¥æ²¡æœ‰ç†è®ºæˆ–ç§‘å­¦ç ”ç©¶çš„æ”¯æŒï¼Œå®é™…ä¸Šæ— è®ºå­¦ä¹ ä»€ä¹ˆä¸œè¥¿ï¼Œæˆå¹´äººéƒ½è¦æ¯”å°å­©å­æ›´æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºæˆ‘ä»¬æˆå¹´äººä¸æ˜¯ä»é›¶å¼€å§‹å­¦ä¹ ç¬¬ä¸€è¯­éŸ³ã€‚æ ¹æ®ç ”ç©¶ï¼Œ93%çš„æƒ…æ„Ÿäº¤æµéƒ½ä¸æ˜¯é€šè¿‡è¯­è¨€å®Œæˆçš„ï¼Œæ¯”å¦‚ç¬‘ä¹Ÿæ˜¯ä¸€ç§ä¿¡æ¯çš„ä¼ é€’æ–¹å¼ï¼Œæˆå¹´äººä¸ç”¨å†èŠ±å¤§é‡æ—¶é—´å»å­¦ä¹ å¦‚ä½•ä¸äººäº¤æµã€‚</p><p><strong>ç›¸æ¯”äºå­©å­ï¼Œæˆå¹´äººè¦å­¦ä¹ çš„å†…å®¹æ›´å°‘ã€‚</strong>æˆå¹´äººæœ‰æ›´å¤šçš„å­¦ä¹ ç»éªŒåº”ç”¨åˆ°å­¦ä¹ è¯­è¨€ä¸Šé¢ï¼Œæˆå¹´äººæ¯”å­©å­æ›´æœ‰åˆ†æåŠ›ã€‚ç›¸åï¼Œæˆå¹´äººåº”è¯¥å­¦ä¹ å­©å­ä¸å®³æ€•çŠ¯é”™è¯¯è¿™ä¸€ç‚¹ï¼Œäº«å—å­¦ä¹ çš„è¿‡ç¨‹ï¼Œä¸è¦å®³æ€•å°´å°¬ã€‚</p><h4 id="è§‚ç‚¹2ï¼šæˆ‘æ²¡æœ‰å­¦ä¹ è¯­è¨€çš„å¤©èµ‹"><a href="#è§‚ç‚¹2ï¼šæˆ‘æ²¡æœ‰å­¦ä¹ è¯­è¨€çš„å¤©èµ‹" class="headerlink" title="è§‚ç‚¹2ï¼šæˆ‘æ²¡æœ‰å­¦ä¹ è¯­è¨€çš„å¤©èµ‹"></a>è§‚ç‚¹2ï¼šæˆ‘æ²¡æœ‰å­¦ä¹ è¯­è¨€çš„å¤©èµ‹</h4><p>äº‹å®ä¸Šï¼Œæ‰€æœ‰äººéƒ½æœ‰å­¦ä¹ è¯­è¨€çš„å¤©èµ‹ï¼Œåœ¨ä¸€äº›å¤šè¯­ç§çš„å›½å®¶ï¼Œäººä»¬éƒ½èƒ½åœ¨å¾ˆå¤šè¯­è¨€ä¹‹é—´è‡ªç”±çš„åˆ‡æ¢ï¼Œæ¯”å¦‚å¢æ£®å ¡çš„å­¦ç”Ÿåœ¨æ¯•ä¸šæ—¶èƒ½æµåˆ©çš„ä½¿ç”¨æ³•è¯­ã€å¾·è¯­ã€å¢æ£®å ¡è¯­ã€‚</p><p>æˆ‘ä»¬åœ¨å­¦ä¹ åˆšå¼€å§‹å°±è¦æŠ›å¼€è¿™ç§è‡ªæˆ‘æ€€ç–‘ã€‚</p><h4 id="è§‚ç‚¹3ï¼šæˆ‘æ²¡æœ‰æ—¶é—´"><a href="#è§‚ç‚¹3ï¼šæˆ‘æ²¡æœ‰æ—¶é—´" class="headerlink" title="è§‚ç‚¹3ï¼šæˆ‘æ²¡æœ‰æ—¶é—´"></a>è§‚ç‚¹3ï¼šæˆ‘æ²¡æœ‰æ—¶é—´</h4><p>å¤§éƒ¨åˆ†äººéƒ½æœ‰å·¥ä½œè¦åšï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¥å£ã€‚ä½†äº‹å®ä¸Šï¼Œå¤§éƒ¨åˆ†å­¦ä¹ è¯­è¨€å¾ˆæˆåŠŸçš„äººéƒ½æœ‰æ­£å¼çš„å·¥ä½œï¼Œæˆ–æ˜¯æ“æŒå®¶åŠ¡ã€ç…§é¡¾å®¶äººã€‚</p><p>åªè¦çœŸæ­£çš„æŠ½å‡ºæ—¶é—´å»å­¦ä¹ ï¼Œä½ å°±èƒ½å–å¾—è¿›æ­¥ã€‚æ¯”å¦‚çœ‹ç”µè§†ã€æµè§ˆå„ç§APPã€æ‰“æ¸¸æˆç­‰ç­‰ï¼Œè¿™äº›æ´»åŠ¨å ç”¨äº†æˆ‘ä»¬å¤§é‡çš„æ—¶é—´ï¼Œç”šè‡³è¿˜æœ‰ä¸€äº›æ˜¯æ— æ„ä¹‰çš„æ´»åŠ¨ï¼Œè¿˜æœ‰å¦‚ç­‰ç”µæ¢¯ã€åå…¬äº¤è½¦ã€åœ°é“ç­‰ã€‚å³ä½¿æ˜¯å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œç”¨æ¥å­¦ä¹ å‡ ä¸ªå•è¯æˆ–æ—¥å¸¸ç”¨è¯­ä¹Ÿæ˜¯è¶³å¤Ÿçš„ã€‚</p><p><strong>å½“ä½ çœŸæ­£æƒ³è¦å­¦ä¹ ä¸€é—¨è¯­è¨€æ—¶ï¼Œæ¯ä¸€åˆ†é’Ÿéƒ½æ˜¯å¯ä»¥åˆ©ç”¨çš„ã€‚</strong></p><p>å½“ç„¶ï¼ŒèŠ±å‡ ä¸ªæœˆçš„æ—¶é—´å»åšä¸€ä»¶äº‹å¾ˆä¸é”™ï¼Œä½†å¦‚æœæ²¡æœ‰è¿™ä¸ªæ¡ä»¶ï¼Œè¯·å°½é‡æŠŠèƒ½ç”¨çš„æ—¶é—´åˆ©ç”¨èµ·æ¥ï¼Œè™½ç„¶å‘¨æœŸä¼šé•¿ä¸€äº›ï¼Œä½†ä½ æ€»èƒ½è¾¾åˆ°ç›®æ ‡çš„ã€‚</p><h4 id="è§‚ç‚¹4ï¼šå­¦è¯­è¨€æ˜¯æœ‰é’±äººçš„ä¸“åˆ©"><a href="#è§‚ç‚¹4ï¼šå­¦è¯­è¨€æ˜¯æœ‰é’±äººçš„ä¸“åˆ©" class="headerlink" title="è§‚ç‚¹4ï¼šå­¦è¯­è¨€æ˜¯æœ‰é’±äººçš„ä¸“åˆ©"></a>è§‚ç‚¹4ï¼šå­¦è¯­è¨€æ˜¯æœ‰é’±äººçš„ä¸“åˆ©</h4><p>æ˜‚è´µçš„è¯¾ç¨‹å’Œå­¦ä¹ äº§å“å¹¶ä¸æ¯”ç½‘ä¸Šçš„å…è´¹å·¥å…·ã€åšå®¢ã€ä»¥åŠå’Œå¤–å›½æœ‹å‹èŠå¤©æ›´æœ‰å¸®åŠ©ã€‚</p><h4 id="è§‚ç‚¹5ï¼šæˆ‘åœ¨ç­‰å¾…å®Œç¾çš„è¯­è¨€è¯¾ç¨‹"><a href="#è§‚ç‚¹5ï¼šæˆ‘åœ¨ç­‰å¾…å®Œç¾çš„è¯­è¨€è¯¾ç¨‹" class="headerlink" title="è§‚ç‚¹5ï¼šæˆ‘åœ¨ç­‰å¾…å®Œç¾çš„è¯­è¨€è¯¾ç¨‹"></a>è§‚ç‚¹5ï¼šæˆ‘åœ¨ç­‰å¾…å®Œç¾çš„è¯­è¨€è¯¾ç¨‹</h4><p>æ²¡æœ‰å®Œç¾çš„è¯¾ç¨‹ï¼Œå³ä½¿æ˜¯ä¼˜ç§€çš„è¯­è¨€è¯¾ç¨‹èƒ½æ•™ç»™ä½ çš„ä¸œè¥¿ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œè€Œä¸”å®ƒ<strong>å¹¶ä¸æ¯”ä½ åŠªåŠ›å­¦ä¹ æ›´æœ‰æ•ˆæœ</strong>ã€‚</p><h4 id="è§‚ç‚¹6ï¼šå¦‚æœæˆ‘ä½¿ç”¨äº†é”™è¯¯çš„å­¦ä¹ æ–¹æ³•ï¼Œé‚£æˆ‘è¿˜æ²¡å¼€å§‹å°±æ³¨å®šè¦å¤±è´¥"><a href="#è§‚ç‚¹6ï¼šå¦‚æœæˆ‘ä½¿ç”¨äº†é”™è¯¯çš„å­¦ä¹ æ–¹æ³•ï¼Œé‚£æˆ‘è¿˜æ²¡å¼€å§‹å°±æ³¨å®šè¦å¤±è´¥" class="headerlink" title="è§‚ç‚¹6ï¼šå¦‚æœæˆ‘ä½¿ç”¨äº†é”™è¯¯çš„å­¦ä¹ æ–¹æ³•ï¼Œé‚£æˆ‘è¿˜æ²¡å¼€å§‹å°±æ³¨å®šè¦å¤±è´¥"></a>è§‚ç‚¹6ï¼šå¦‚æœæˆ‘ä½¿ç”¨äº†é”™è¯¯çš„å­¦ä¹ æ–¹æ³•ï¼Œé‚£æˆ‘è¿˜æ²¡å¼€å§‹å°±æ³¨å®šè¦å¤±è´¥</h4><p><strong>æœ€é‡è¦çš„äº‹æƒ…æ˜¯ä½ ç»ˆäºå¼€å§‹å­¦ä¹ äº†</strong>ï¼Œè€Œæ—©æœŸçš„é”™è¯¯å¹¶æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚é‡åˆ°æŒ«æŠ˜ï¼Œæœæ–­çš„å»è§£å†³å®ƒï¼ŒæŒ¯ä½œç²¾ç¥ï¼Œé‡æ–°å¼€å§‹ï¼Œåªè¦å†åšæŒä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><p><strong>ä¸è¦æŠŠç²¾åŠ›æŠ•å…¥åˆ°ç ”ç©¶å“ªç§å­¦ä¹ æ–¹æ³•æ›´å¥½ï¼Œè€Œæ˜¯æŠŠç²¾åŠ›æŠ•å…¥åˆ°å­¦ä¹ å’Œä½¿ç”¨è¯­è¨€ä¸Šé¢ã€‚</strong></p><h4 id="è§‚ç‚¹7ï¼šåªæœ‰å­¦åˆ°ä¸€å®šç¨‹åº¦ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ç»ƒä¹ å¯¹è¯"><a href="#è§‚ç‚¹7ï¼šåªæœ‰å­¦åˆ°ä¸€å®šç¨‹åº¦ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ç»ƒä¹ å¯¹è¯" class="headerlink" title="è§‚ç‚¹7ï¼šåªæœ‰å­¦åˆ°ä¸€å®šç¨‹åº¦ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ç»ƒä¹ å¯¹è¯"></a>è§‚ç‚¹7ï¼šåªæœ‰å­¦åˆ°ä¸€å®šç¨‹åº¦ï¼Œæˆ‘æ‰èƒ½å¼€å§‹ç»ƒä¹ å¯¹è¯</h4><p>äº‹å®ä¸Šï¼Œ<strong>ä»å­¦ä¹ çš„ç¬¬ä¸€å¤©å¼€å§‹ï¼Œä½ å°±è¦å°è¯•å»è¯´</strong>ã€‚è¿™å’Œä¼ ç»Ÿè®¤çŸ¥å¹¶ä¸ç›¸ç¬¦ï¼Œ<strong>å› ä¸ºä½ æ°¸è¿œä¸ä¼šæœ‰å‡†å¤‡å¥½çš„é‚£ä¸€å¤©</strong>ï¼Œå“ªæ€•ä½ å·²ç»æŒæ¡äº†ä¸€é—¨è¯­è¨€ï¼Œä½ è¿˜æ˜¯èƒ½è¯æ˜è‡ªå·±æ²¡æœ‰å‡†å¤‡å¥½ï¼Œå•è¯æ˜¯æ°¸è¿œä¹Ÿå­¦ä¸å®Œçš„ï¼Œè¯­æ³•ä¹Ÿæœ‰å¾ˆå¤šçš„å­¦ä¹ ç©ºé—´ï¼Œå‘éŸ³ä¹Ÿè¦æ›´å¤šçš„ç»ƒä¹ ã€‚</p><p><strong>è¦ä»ç°åœ¨å°±å¼€å§‹å°½é‡å»ä½¿ç”¨è‡ªå·±æ‰€å­¦çš„è¯­è¨€ï¼Œè€Œä¸æ˜¯ç­‰å¾…å¾ˆå¤šå¹´ã€‚</strong></p><h4 id="è§‚ç‚¹8ï¼šæˆ‘ä¸èƒ½é›†ä¸­ç²¾åŠ›"><a href="#è§‚ç‚¹8ï¼šæˆ‘ä¸èƒ½é›†ä¸­ç²¾åŠ›" class="headerlink" title="è§‚ç‚¹8ï¼šæˆ‘ä¸èƒ½é›†ä¸­ç²¾åŠ›"></a>è§‚ç‚¹8ï¼šæˆ‘ä¸èƒ½é›†ä¸­ç²¾åŠ›</h4><p><strong>åªä¸“æ³¨äºçœ¼å‰çš„ä»»åŠ¡ï¼Œä¸ç®¡æœ‰å¤šå¤§çš„è¯±æƒ‘ã€‚</strong>ä¸€äº›ä¼˜ç§€çš„äººæ‰ä¹Ÿåªæ˜¯æŠŠå„ç§å…´è¶£çˆ±å¥½å®‰æ’å¥½ï¼ŒæŒ‰ç…§æ¬¡åºä¸€ä¸€å®Œæˆï¼Œè€Œä¸æ˜¯åŒæ—¶å»åšå¾ˆå¤šäº‹æƒ…ã€‚ä»–ä»¬ä¹Ÿåªæ˜¯æœ‰è€å¿ƒçš„ã€æœ‰æ¡ç†çš„å»åšã€‚</p><h4 id="è§‚ç‚¹9ï¼šæœ‰äº›è¯­è¨€å¤ªéš¾äº†"><a href="#è§‚ç‚¹9ï¼šæœ‰äº›è¯­è¨€å¤ªéš¾äº†" class="headerlink" title="è§‚ç‚¹9ï¼šæœ‰äº›è¯­è¨€å¤ªéš¾äº†"></a>è§‚ç‚¹9ï¼šæœ‰äº›è¯­è¨€å¤ªéš¾äº†</h4><p>æ²¡æœ‰äººèƒ½åœ¨è¿™ç§æ— æ„ä¹‰çš„æ¯”è¾ƒä¸­è·ç›Šï¼Œäº‹å®ä¸Šå³ä½¿æ˜¯å…¬è®¤çš„éš¾å­¦ä¹ çš„è¯­ç§ä¹Ÿæœ‰å¾ˆå¤šäººåœ¨ä½¿ç”¨å®ƒæ¥äº¤æµã€‚å¦‚æœä½ æ­£åœ¨å­¦ä¹ ä¸€é—¨è¯­è¨€ï¼Œè¯·å¿˜æ‰å…¶ä»–å­¦è¿‡çš„è¯­è¨€ï¼Œé›†ä¸­çƒ­æƒ…åœ¨å®ƒä¸Šé¢å§ï¼</p><h4 id="è§‚ç‚¹10ï¼šç“¶é¢ˆæœŸä¸å¯é¿å…"><a href="#è§‚ç‚¹10ï¼šç“¶é¢ˆæœŸä¸å¯é¿å…" class="headerlink" title="è§‚ç‚¹10ï¼šç“¶é¢ˆæœŸä¸å¯é¿å…"></a>è§‚ç‚¹10ï¼šç“¶é¢ˆæœŸä¸å¯é¿å…</h4><p>å­¦ä¹ ä¸­ç¡®å®éš¾å…é‡åˆ°ç“¶é¢ˆæœŸï¼Œåˆå­¦è€…ä¸ä¼šé‡åˆ°æ­¤é—®é¢˜ï¼Œç›´åˆ°æœ‰æ‰€è¿›æ­¥åï¼Œæ¯”å¦‚èƒ½å¤Ÿäº¤æµåå°±åœæ»åœ¨é‚£é‡Œäº†ã€‚è¿™å¾ˆå¯èƒ½æ˜¯æˆ‘ä»¬è¿‡å¾€çš„å­¦ä¹ æ–¹æ³•åœ¨æ­¤é˜¶æ®µä¸å†é€‚åˆäº†ï¼Œ<strong>â€œæ„šè ¢â€çš„è¡Œä¸ºå°±æ˜¯ä¸€ç›´é‡å¤ç”¨åŒæ ·çš„æ–¹æ³•åšäº‹ï¼Œå´æœŸæœ›å¾—åˆ°ä¸åŒçš„ç»“æœ</strong>ã€‚</p><p>ä¸è¦æ€•ï¼Œå¤§èƒ†çš„æ”¹å˜ï¼Œæ”¹å˜ç»ƒä¹ çš„é¢‘ç‡ï¼Œæ”¹å˜å¯¹è¯çš„å¯¹è±¡ã€‚</p><h4 id="è§‚ç‚¹11ï¼šå®Œå…¨æŒæ¡æ˜¯ä¸å¯èƒ½çš„ä»»åŠ¡"><a href="#è§‚ç‚¹11ï¼šå®Œå…¨æŒæ¡æ˜¯ä¸å¯èƒ½çš„ä»»åŠ¡" class="headerlink" title="è§‚ç‚¹11ï¼šå®Œå…¨æŒæ¡æ˜¯ä¸å¯èƒ½çš„ä»»åŠ¡"></a>è§‚ç‚¹11ï¼šå®Œå…¨æŒæ¡æ˜¯ä¸å¯èƒ½çš„ä»»åŠ¡</h4><p>å¦‚æœè¯´å­¦ä¸€é—¨è¯­è¨€ï¼Œå°±æ˜¯è¦ç”¨å®ƒæ¥è¾©è®ºå„ç§å“²å­¦æ€æƒ³ï¼Œå¹¶ä¸”ä¸å¸¦ä¸€ä¸å£éŸ³å’Œåœé¡¿çš„è¯ï¼Œé‚£ä¹ˆè¿™ç¡®å®ä¼šèŠ±è´¹ä¸Šæ•°åå¹´ã€‚</p><p>ä½†è¯·ä»”ç»†æƒ³æƒ³ï¼Œ<strong>ä½ å¯¹è‡ªå·±çš„æ¯è¯­æœ‰æŒæ¡åˆ°ä»€ä¹ˆæ ·çš„ç¨‹åº¦ï¼Œå†æƒ³æƒ³ä¸ºä»€ä¹ˆè¦å¯¹ä¸€é—¨å¤–è¯­æœ‰è¿™æ ·çš„é«˜è¦æ±‚ï¼Ÿ</strong></p><p>è¯·æŠŠç›®æ ‡æ”¾åœ¨ç®€å•å¯¹è¯ï¼Œå†æœç€æµåˆ©çš„æ–¹å‘åŠªåŠ›ã€‚</p><h4 id="è§‚ç‚¹12ï¼šå­¦ä¹ è¿‡ç¨‹å¾ˆæ¯ç‡¥"><a href="#è§‚ç‚¹12ï¼šå­¦ä¹ è¿‡ç¨‹å¾ˆæ¯ç‡¥" class="headerlink" title="è§‚ç‚¹12ï¼šå­¦ä¹ è¿‡ç¨‹å¾ˆæ¯ç‡¥"></a>è§‚ç‚¹12ï¼šå­¦ä¹ è¿‡ç¨‹å¾ˆæ¯ç‡¥</h4><p><strong>è¯­è¨€å­¦ä¹ å¹¶ä¸æ¯ç‡¥ï¼Œä¹Ÿè®¸åªæ˜¯ä½ çš„æ–¹æ³•æ¯ç‡¥è€Œå·²ã€‚</strong>æ¯”å¦‚è¯•è¯•å¬éŸ³ä¹ã€çœ‹åŠ¨ç”»ç‰‡ã€çœ‹ç”µå½±ã€è¯»æ‚å¿—ã€çœ‹ç¬‘è¯ã€‚æ‰¾ä¸€ä¸ªäº’ç›¸å¸®åŠ©çš„ä¼™ä¼´ï¼Œæˆ–è€…ä»»ä½•èƒ½è°ƒåŠ¨ä½ ç§¯ææ€§çš„æ–¹å¼ã€‚</p><h4 id="è§‚ç‚¹13ï¼šå½“åœ°äººä¸ä¼šç†æˆ‘"><a href="#è§‚ç‚¹13ï¼šå½“åœ°äººä¸ä¼šç†æˆ‘" class="headerlink" title="è§‚ç‚¹13ï¼šå½“åœ°äººä¸ä¼šç†æˆ‘"></a>è§‚ç‚¹13ï¼šå½“åœ°äººä¸ä¼šç†æˆ‘</h4><p><strong>è¯·è®°ä½ï¼Œä½ æ°¸è¿œä¹Ÿä¸ä¼šå‡†å¤‡å¥½ï¼Œæ°¸è¿œéƒ½æœ‰è¦å­¦çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¸€ç›´ç»™è‡ªå·±æ‰¾å€Ÿå£ã€‚</strong>è¿™ç§æ¶æ€§å¾ªç¯å¯¼è‡´å¾ˆå¤šäººå­¦äº†å¾ˆå¤šå¹´ä¹Ÿä¸æ•¢å¼€å£è¯´è¯ã€‚</p><p>ç°å®ä¸­ï¼Œå¤§å®¶å¾€å¾€ä¼šé¼“åŠ±ä½ ã€å¸®åŠ©ä½ ï¼Œä¼šå¾ˆæœ‰è€å¿ƒå’ŒåŒ…å®¹ã€‚æ¯”å¦‚ä½ æ˜¯é‚£ä¸ªæœ¬åœ°äººï¼Œå½“ä½ é‡åˆ°ä¸€ä¸ªå°è¯•åŠªåŠ›å­¦ä¹ ä½ çš„æ¯è¯­çš„å¤–äººæ—¶ï¼Œä½ ä¼šæœ‰æ€æ ·çš„æ„Ÿå—ï¼Ÿ</p><h4 id="è§‚ç‚¹14ï¼šæˆ‘æ€»æ˜¯æœ‰å£éŸ³"><a href="#è§‚ç‚¹14ï¼šæˆ‘æ€»æ˜¯æœ‰å£éŸ³" class="headerlink" title="è§‚ç‚¹14ï¼šæˆ‘æ€»æ˜¯æœ‰å£éŸ³"></a>è§‚ç‚¹14ï¼šæˆ‘æ€»æ˜¯æœ‰å£éŸ³</h4><p>å®é™…ä¸Šæœ‰ç‚¹å£éŸ³æ˜¯å¥½äº‹ï¼Œè¿™å¹¶ä¸å½±å“äº¤æµã€‚å³ä½¿æ˜¯æ¯è¯­ä¹Ÿå­˜åœ¨å¾ˆå¤šå‘éŸ³é—®é¢˜ï¼Œä»–ä»¬ä¹Ÿæœ‰å„ç§å„æ ·çš„å£éŸ³ã€‚</p><h4 id="è§‚ç‚¹15ï¼šæˆ‘çš„å®¶äººæœ‹å‹ä¸æ”¯æŒæˆ‘"><a href="#è§‚ç‚¹15ï¼šæˆ‘çš„å®¶äººæœ‹å‹ä¸æ”¯æŒæˆ‘" class="headerlink" title="è§‚ç‚¹15ï¼šæˆ‘çš„å®¶äººæœ‹å‹ä¸æ”¯æŒæˆ‘"></a>è§‚ç‚¹15ï¼šæˆ‘çš„å®¶äººæœ‹å‹ä¸æ”¯æŒæˆ‘</h4><p>è¿™ä¸ªé—®é¢˜æ²¡æœ‰å¾ˆå¥½çš„è§£å†³æ–¹æ³•ï¼Œä½†ä½ å¯ä»¥å°½é‡çš„é˜è¿°è‡ªå·±å¾ˆå–œæ¬¢è¿™é—¨è¯­è¨€ï¼Œè¡¨ç¤ºå‡ºä½ è®¤çœŸçš„æ€åº¦ï¼Œå¦‚æœå¯¹æ–¹èƒ½ç†è§£ä¹Ÿè®¸ä»–ä»¬ä¼šæ”¯æŒä½ ã€‚</p><p>å¦‚æœä½ å¾—ä¸åˆ°ä»–ä»¬çš„æ”¯æŒï¼Œè¯·ç›¸ä¿¡åœ¨è¿™ä¸ªä¸–ç•Œä¸Šæœ‰å¾ˆå¤šå’Œä½ ä¸€æ ·æ€€æŠ±ç›¸åŒæ¢¦æƒ³çš„äººï¼Œä½ ä¼šæ‰¾åˆ°æ”¯æŒå’Œç†è§£çš„ã€‚</p><h4 id="è§‚ç‚¹16ï¼šæ¯ä¸ªäººéƒ½è¯´è‹±è¯­-æ±‰è¯­"><a href="#è§‚ç‚¹16ï¼šæ¯ä¸ªäººéƒ½è¯´è‹±è¯­-æ±‰è¯­" class="headerlink" title="è§‚ç‚¹16ï¼šæ¯ä¸ªäººéƒ½è¯´è‹±è¯­/æ±‰è¯­"></a>è§‚ç‚¹16ï¼šæ¯ä¸ªäººéƒ½è¯´è‹±è¯­/æ±‰è¯­</h4><p>å­¦ä¼šä¸€é—¨æ–°çš„è¯­è¨€ï¼Œå¹¶ä¸ä»…ä»…æ„å‘³ç€ä½ æ”¶è·äº†è¿™äº›çŸ¥è¯†ï¼Œå®ƒä¼šä¸ºä½ å¸¦æ¥æ–°çš„æœºä¼šå’Œä½“éªŒã€‚</p><h4 id="è§‚ç‚¹17ï¼šæˆ‘è·Ÿä¸ä¸Šæ¯”äººçš„è„šæ­¥"><a href="#è§‚ç‚¹17ï¼šæˆ‘è·Ÿä¸ä¸Šæ¯”äººçš„è„šæ­¥" class="headerlink" title="è§‚ç‚¹17ï¼šæˆ‘è·Ÿä¸ä¸Šæ¯”äººçš„è„šæ­¥"></a>è§‚ç‚¹17ï¼šæˆ‘è·Ÿä¸ä¸Šæ¯”äººçš„è„šæ­¥</h4><p>æŠŠè‡ªå·±å’Œåˆ«äººä½œæ¯”è¾ƒè¿™ç§è¡Œä¸ºæœ¬èº«å°±å¾ˆæœ‰é—®é¢˜ï¼Œä½†è¿™æ˜¯äººçš„æœ¬æ€§ã€‚ä½†ä½ è¦æ˜ç™½ï¼Œä½ çœ‹åˆ°çš„åªæ˜¯åˆ«äººå±•ç¤ºç»™ä½ çš„ä¸€é¢ï¼Œä»–ä»¬åˆ†äº«ç»å†æ—¶ï¼Œåªä¼šè¯´é‡åˆ°çš„å„ç§å›°éš¾ï¼Œå·²æ˜¾ç¤ºå‡ºå…¶é«˜å¤§çš„å½¢è±¡ã€‚</p><p>é‡åˆ°å›°éš¾æ—¶ï¼Œè¯·æŠ›å¼ƒâ€œæˆåŠŸçš„äººä¸ä¼šé¢å¯¹è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘è¿˜æ˜¯æ”¾å¼ƒå§â€è¿™æ ·çš„æƒ³æ³•ã€‚è€Œåº”è¯¥é—®è‡ªå·±â€œæˆåŠŸçš„äººä¼šæ€ä¹ˆè§£å†³è¿™ä¸ªå›°éš¾å‘¢ï¼Ÿâ€ã€‚</p><h4 id="è§‚ç‚¹18ï¼šä»¥å‰å¤±è´¥ï¼Œç°åœ¨è¿˜ä¼šå¤±è´¥"><a href="#è§‚ç‚¹18ï¼šä»¥å‰å¤±è´¥ï¼Œç°åœ¨è¿˜ä¼šå¤±è´¥" class="headerlink" title="è§‚ç‚¹18ï¼šä»¥å‰å¤±è´¥ï¼Œç°åœ¨è¿˜ä¼šå¤±è´¥"></a>è§‚ç‚¹18ï¼šä»¥å‰å¤±è´¥ï¼Œç°åœ¨è¿˜ä¼šå¤±è´¥</h4><p>å¦‚æœä½ ä»¥å‰å°è¯•è¿‡å­¦ä¹ è¯­è¨€ï¼Œä½†æœ€ç»ˆå¤±è´¥äº†ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—è‡ªå·±ä¸æ“…é•¿å­¦ä¹ è¯­è¨€ï¼Œä½†è¯·ç›¸ä¿¡è¿™åªèƒ½è¯´æ˜è¿‡å»çš„æ–¹æ³•å¹¶ä¸é€‚åˆä½ ã€‚</p><p><strong>æ²¡æœ‰ä¸€ç§æ–¹æ³•æ˜¯å®Œç¾é€‚åˆæ¯ä¸€ä¸ªè¯­è¨€å­¦ä¹ è€…çš„ã€‚</strong>å¦‚æœä½ å°è¯•ç€æŸç§æ–¹æ³•ï¼Œä½†æ ¹æœ¬ä¸èµ·ä½œç”¨ï¼Œè¯·æœæ–­çš„æ”¾å¼ƒï¼Œå¹¶è¯•ç€æ¢å¦ä¸€ç§æ–¹æ³•ã€‚</p><p><strong>è¯·æ˜ç™½å¤±è´¥çš„å¹¶ä¸æ˜¯ä½ è¿™ä¸ªäººï¼Œè€Œæ˜¯ä½ åœ¨ç”¨çš„æ–¹æ³•ã€‚</strong>è¯·åœ¨é‡åˆ°é—®é¢˜æ—¶ï¼Œå¤šå’Œåˆ«äººäº¤æµï¼Œä¹¦æœ¬å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰çš„é—®é¢˜ã€‚æœ‰å¯èƒ½è§£å†³æ–¹æ¡ˆåœ¨ä½ çš„å·²çŸ¥çš„çŸ¥è¯†ä¸–ç•Œä»¥å¤–ï¼Œè€Œä¸€ä¸ªå­¦è¿‡çš„äººå¯ä»¥å¸®ä½ è½»æ¾çš„è·¨è¿‡è¿™ä¸ªéš¾å…³ã€‚</p><h4 id="è§‚ç‚¹19ï¼šä¸€æ—¦å¿˜äº†æŸç§è¯­è¨€ï¼Œæˆ‘å°±ä¸å¯èƒ½å†é‡æ–°å­¦ä¼šå®ƒäº†"><a href="#è§‚ç‚¹19ï¼šä¸€æ—¦å¿˜äº†æŸç§è¯­è¨€ï¼Œæˆ‘å°±ä¸å¯èƒ½å†é‡æ–°å­¦ä¼šå®ƒäº†" class="headerlink" title="è§‚ç‚¹19ï¼šä¸€æ—¦å¿˜äº†æŸç§è¯­è¨€ï¼Œæˆ‘å°±ä¸å¯èƒ½å†é‡æ–°å­¦ä¼šå®ƒäº†"></a>è§‚ç‚¹19ï¼šä¸€æ—¦å¿˜äº†æŸç§è¯­è¨€ï¼Œæˆ‘å°±ä¸å¯èƒ½å†é‡æ–°å­¦ä¼šå®ƒäº†</h4><p>æˆ‘ä»¬å°æ—¶å€™å­¦è¿‡çš„è¯­è¨€ï¼Œåé¢æ²¡æœ‰å†å­¦ï¼Œæ‰€ä»¥æ€»è§‰å¾—é”™è¿‡äº†å­¦ä¹ å®ƒçš„æœ€ä½³æœºä¼šã€‚ä½†å…¶å®åªè¦é‡æ–°å¼€å§‹åŠªåŠ›ï¼Œä½ ä¼šæ¯”åˆæ¬¡æ›´é¡ºåˆ©çš„å­¦å¥½è¿™é—¨è¯­è¨€ã€‚</p><h4 id="è§‚ç‚¹20ï¼šæ®‹éšœäººå£«å­¦è¯­è¨€æ¯”æ­£å¸¸äººæ›´éš¾"><a href="#è§‚ç‚¹20ï¼šæ®‹éšœäººå£«å­¦è¯­è¨€æ¯”æ­£å¸¸äººæ›´éš¾" class="headerlink" title="è§‚ç‚¹20ï¼šæ®‹éšœäººå£«å­¦è¯­è¨€æ¯”æ­£å¸¸äººæ›´éš¾"></a>è§‚ç‚¹20ï¼šæ®‹éšœäººå£«å­¦è¯­è¨€æ¯”æ­£å¸¸äººæ›´éš¾</h4><p>æˆ‘ä»¬ä¼šè§‰å¾—è‡ªå·±æœ‰æŸç§ç¼ºé™·ï¼Œåœ¨å­¦ä¹ è¯­è¨€æ—¶ä¼šå’Œåˆ«äººä¸åŒã€‚ä½†ç°å®ä¸­ï¼Œå¾ˆå¤šæ®‹ç–¾äººå£«éƒ½èƒ½å¾ˆå¥½çš„å…‹æœèº«ä½“ä¸Šçš„ç¼ºé™·ï¼Œè¿™äº›é—®é¢˜åœ¨ä½ å› ä¸ºå®ƒè€Œæ­¢æ­¥ä¸å‰æ—¶æ˜¯éš¾ä»¥å…‹æœçš„éš¾å…³ï¼Œä½†è¯·ç›¸ä¿¡åœ¨ä½ å¼€å§‹ä¸æ–­å°è¯•ä¹‹åï¼Œæ€»ä¼šæ‰¾åˆ°å‡ºè·¯çš„ã€‚</p><hr><h3 id="æ„Ÿå—"><a href="#æ„Ÿå—" class="headerlink" title="æ„Ÿå—"></a><strong>æ„Ÿå—</strong></h3><blockquote><p><strong>ä¸ç®¡ä½ è§‰å¾—è‡ªå·±è¡Œæˆ–ä¸è¡Œï¼Œä½ éƒ½æ˜¯å¯¹çš„ã€‚</strong></p><p>â€‹                                                                â€”â€”äº¨åˆ© Â· ç¦ç‰¹</p></blockquote><p>è¯­è¨€å­¦ä¹ éœ€è¦é¢å¯¹æŒ‘æˆ˜ï¼Œéœ€è¦ä»˜å‡ºåŠªåŠ›ï¼Œå¦‚æœæˆ‘ä»¬ç¡®ä¿¡è‡ªå·±ä¸è¡Œï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¤±å»äº†ä¿¡å¿ƒå’Œçƒ­æƒ…ï¼Œæ‚²è§‚ä¸»ä¹‰æƒ…ç»ªå·²ç»å äº†ä¸Šé£ï¼Œæˆ‘ä»¬ä¹Ÿå°±æ³¨å®šå­¦ä¸å¥½è¿™ç§è¯­è¨€äº†ã€‚è¯·å¤§èƒ†çš„æ‰¿è®¤å¤±è´¥ï¼Œä¸è¦ç»™è‡ªå·±æ‰¾æ²¡æœ‰å­¦å¥½çš„å€Ÿå£ã€‚ä¸ç®¡ä½ é‡åˆ°ä»€ä¹ˆå›°éš¾ï¼Œåˆ«äººéƒ½å¯èƒ½é‡åˆ°è¿‡ï¼Œå¹¶ä¸”å…‹æœè¿‡è¿™ä¸ªå›°éš¾ã€‚</p><p>Benny Lewisçš„è§‚ç‚¹å¾ˆèƒ½è¯´åŠ¨ç°åœ¨çš„æˆ‘ï¼Œå¥½åƒæ¯ä¸ªé—®é¢˜éƒ½æ˜¯æˆ‘æ›¾ç”¨æ¥é€ƒé¿çš„ç†ç”±ï¼Œä½†è¿˜å¥½æˆ‘ç°åœ¨æ¯”èµ·ä»¥å‰æœ‰äº†äº›è®¸çš„æ”¹å˜ï¼Œä¹Ÿè®¸è¿ˆå‡ºç¬¬ä¸€æ­¥ä¹‹åï¼Œå°±æ˜¯ç„•ç„¶ä¸€æ–°çš„è‡ªå·±ã€‚</p><p>ä¸ä»…ä»…æ˜¯è¯­è¨€å­¦ä¹ ï¼Œè¿™äº›å¸¸è¯†æ€§çš„é—®é¢˜åœ¨å¤§å¤šæ•°å­¦ä¹ åœºæ™¯éƒ½æ˜¯é›·åŒçš„ï¼Œæˆ‘ä»¬è¦å…‹æœçš„æ˜¯è‡ªå·±çš„æ‡¦å¼±å’Œæ‡’æƒ°ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªè‡ªå‘½ä¸å‡¡çš„äººï¼Œæˆ–è€…åªæ˜¯å¯¹ç°åœ¨çš„è‡ªå·±ä¸å¤Ÿæ»¡æ„ï¼Œå°±è¯·ä¸è¦å†æµªè´¹æ—¶é—´åœ¨å‡†å¤‡é˜¶æ®µäº†ï¼Œå°è¯•çš„å»åšå§ã€‚</p><hr><p>å†…å®¹æ¥æºï¼š</p><p>ğŸ”— ã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹</p>]]></content>
    
    <summary type="html">
    
      ä»é›¶å¼€å§‹å­¦ä¹ è‹±è¯­ï¼Œå†…å®¹æ¥è‡ªäºã€Šè·Ÿå„å›½äººéƒ½èŠå¾—æ¥-ä¸‰ä¸ªæœˆå¤–è¯­æµåˆ©æœ¯ã€‹å’Œè‡ªæˆ‘æ„Ÿå—ã€‚
    
    </summary>
    
      <category term="å­¦ä¹ è¯­è¨€" scheme="http://linyishui.top/categories/%E5%AD%A6%E4%B9%A0%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="language" scheme="http://linyishui.top/tags/language/"/>
    
      <category term="english" scheme="http://linyishui.top/tags/english/"/>
    
  </entry>
  
  <entry>
    <title>å¤§æ•°æ®é‡è¡¨çš„ä¼˜åŒ–æ€è·¯</title>
    <link href="http://linyishui.top/2020082201.html"/>
    <id>http://linyishui.top/2020082201.html</id>
    <published>2020-09-01T05:32:46.000Z</published>
    <updated>2020-10-02T08:22:21.855Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å¤§æ•°æ®é‡è¡¨çš„ä¼˜åŒ–æ€è·¯"><a href="#å¤§æ•°æ®é‡è¡¨çš„ä¼˜åŒ–æ€è·¯" class="headerlink" title="å¤§æ•°æ®é‡è¡¨çš„ä¼˜åŒ–æ€è·¯"></a><strong>å¤§æ•°æ®é‡è¡¨çš„ä¼˜åŒ–æ€è·¯</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-é—®é¢˜æè¿°"><a href="#ç¬¬ä¸€èŠ‚-é—®é¢˜æè¿°" class="headerlink" title="ç¬¬ä¸€èŠ‚ é—®é¢˜æè¿°"></a><strong>ç¬¬ä¸€èŠ‚ é—®é¢˜æè¿°</strong></h2><h2 id="1-1-å¸¸è§é—®é¢˜"><a href="#1-1-å¸¸è§é—®é¢˜" class="headerlink" title="1.1 å¸¸è§é—®é¢˜"></a><strong>1.1 å¸¸è§é—®é¢˜</strong></h2><ol><li>å•è¡¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«åï¼ŒæŸ¥è¯¢æ“ä½œè€—æ—¶è¿‡ä¹…ã€‚</li><li>é’ˆå¯¹æµ·é‡çš„æ•°æ®è¡¨è¿›è¡Œä¿®æ”¹æ“ä½œã€‚</li></ol><h2 id="1-2-MySqlæ¨¡æ‹Ÿ"><a href="#1-2-MySqlæ¨¡æ‹Ÿ" class="headerlink" title="1.2 MySqlæ¨¡æ‹Ÿ"></a><strong>1.2 MySqlæ¨¡æ‹Ÿ</strong></h2><p>åˆ›å»ºåƒä¸‡æ¡æ¨¡æ‹Ÿæ•°æ®ï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºMyISAMæ¨¡å¼è¡¨æ–¹ä¾¿æ‰¹é‡è·‘æ•°æ®</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`logs1`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`logtype`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`logurl`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`logip`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`logdz`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`ladduser`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`lfadduser`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`laddtime`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`htmlname`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM  AUTO_INCREMENT=<span class="number">1811</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'æ—¥å¿—è¡¨'</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">#åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_insert;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> my_insert()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">DECLARE</span> n <span class="built_in">int</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">DECLARE</span> in_dateTime <span class="keyword">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="string">'2020-01-01 00:00:00'</span>;</span><br><span class="line">        while n &lt;= 10000000 do</span><br><span class="line">            <span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`logs1`</span>(<span class="string">`logtype`</span>,<span class="string">`logurl`</span>,<span class="string">`logip`</span>,<span class="string">`logdz`</span>,<span class="string">`ladduser`</span> ,<span class="string">`lfadduser`</span>,<span class="string">`laddtime`</span>,<span class="string">`htmlname`</span>) <span class="keyword">VALUES</span> (<span class="keyword">FLOOR</span>(<span class="number">1</span> + (<span class="keyword">RAND</span>() * <span class="number">2</span>)), <span class="string">'/index'</span>, <span class="string">'0:0:0:0:0:0:0:1'</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="string">'null'</span>, in_dateTime, <span class="string">'é¦–é¡µ'</span>);</span><br><span class="line">            <span class="keyword">set</span> in_dateTime = in_dateTime + <span class="built_in">interval</span> <span class="number">1</span> MINUTE_SECOND;</span><br><span class="line">            <span class="keyword">SET</span> n = n + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"> </span><br><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹</span><br><span class="line"><span class="keyword">CALL</span> my_insert();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">#æ•°æ®æ’å…¥æˆåŠŸåä¿®æ”¹è¡¨æ¨¡å¼InnoDB æ—¶é—´ç¨å¾®ä¹…ç‚¹</span><br><span class="line"> <span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`logs1`</span> <span class="keyword">engine</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥è¯¢è¡¨ä¸­è¡Œæ•°ï¼Œç”¨æ—¶2.6så·¦å³</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">FROM</span> logs1;</span><br><span class="line"></span><br><span class="line">#åˆ†é¡µæŸ¥è¯¢ï¼Œidä»1811å¼€å§‹ï¼ŒæŸ¥è¯¢ç¬¬6001æ¡åˆ°6010æ¡æ•°æ®ï¼Œç”¨æ—¶0.025s</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> logs1 <span class="keyword">limit</span> <span class="number">6000</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">#ç”¨æ—¶0.048s</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> logs1 <span class="keyword">limit</span> <span class="number">60000</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">#ç”¨æ—¶0.256s</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> logs1 <span class="keyword">limit</span> <span class="number">600000</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">#ç”¨æ—¶4.372s</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> logs1 <span class="keyword">limit</span> <span class="number">9000000</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><strong>åˆ†é¡µæŸ¥è¯¢æ–¹å¼ä¼šä»æ•°æ®åº“ç¬¬ä¸€æ¡è®°å½•å¼€å§‹æ‰«æï¼Œæ‰€ä»¥è¶Šå¾€åï¼ŒæŸ¥è¯¢é€Ÿåº¦è¶Šæ…¢ï¼Œè€Œä¸”æŸ¥è¯¢çš„æ•°æ®è¶Šå¤šï¼Œä¹Ÿä¼šæ‹–æ…¢æ€»æŸ¥è¯¢é€Ÿåº¦ã€‚</strong></p><hr><h2 id="ç¬¬äºŒèŠ‚-è§£å†³æµç¨‹"><a href="#ç¬¬äºŒèŠ‚-è§£å†³æµç¨‹" class="headerlink" title="ç¬¬äºŒèŠ‚ è§£å†³æµç¨‹"></a><strong>ç¬¬äºŒèŠ‚ è§£å†³æµç¨‹</strong></h2><h2 id="2-1-ç´¢å¼•"><a href="#2-1-ç´¢å¼•" class="headerlink" title="2.1 ç´¢å¼•"></a><strong>2.1 ç´¢å¼•</strong></h2><p>explainå¾—çŸ¥æŸ¥è¯¢å¹¶æœªèµ°ç´¢å¼•ï¼Œé¦–å…ˆå¢åŠ ç´¢å¼•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># type=allå…¨è¡¨æŸ¥è¯¢ï¼Œå…ˆåˆ›å»ºç´¢å¼•</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> logs1 <span class="keyword">where</span> logtype = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">#å¢åŠ å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> logs1 <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> index_id (<span class="keyword">id</span>)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> logs1 <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_logtype (logtype)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> logs1 <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_laddtime (laddtime)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> logs1 <span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_logtype</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> logs1 <span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_laddtime</span><br><span class="line"></span><br><span class="line">#<span class="keyword">type</span>æ˜¯é€‰æ‹©æ€§ä½çš„å±æ€§ï¼Œè€Œ<span class="keyword">time</span>åˆ™ä¸æ˜¯ï¼Œæ‰€ä»¥ç´¢å¼•çš„å½±å“ä¹Ÿä¸åŒ</span><br><span class="line">#å…¨è¡¨æŸ¥è¯¢ <span class="number">5.073</span>-&gt;ç´¢å¼• <span class="number">4.226</span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> logtype <span class="keyword">from</span> logs1 <span class="keyword">where</span> logtype &gt; <span class="number">1</span>;</span><br><span class="line">#ALL 3.566-&gt;range 0.426</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> laddtime <span class="keyword">from</span> logs1 <span class="keyword">where</span> laddtime &gt;= <span class="string">'2020-04-14 04:00:00'</span>;</span><br></pre></td></tr></table></figure><p>ç´¢å¼•å¹¶éä¸‡èƒ½çš„ï¼Œå¦‚æœæˆ‘ä»¬æŸ¥è¯¢çš„å±æ€§åˆ—æ˜¯å¤šä¸ªã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#index 4.572</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">id</span>,logtype,laddtime <span class="keyword">from</span> logs1 <span class="keyword">where</span> laddtime &gt;= <span class="string">'2020-04-14 04:00:00'</span>;</span><br><span class="line"></span><br><span class="line">#å¢åŠ whereååˆ¤æ–­æ¡ä»¶</span><br><span class="line">#0.966-&gt;0.853</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">id</span>,logtype,laddtime <span class="keyword">from</span> logs1 <span class="keyword">where</span> laddtime &gt;= <span class="string">'2020-04-14 04:00:00'</span> <span class="keyword">and</span> <span class="keyword">id</span> &gt; <span class="string">'9001812'</span> <span class="keyword">and</span> logtype = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºç»„åˆç´¢å¼•</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> logs1 <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_union (<span class="keyword">id</span>,logtype,laddtime)</span><br></pre></td></tr></table></figure><h2 id="2-2-ä¼˜åŒ–SQL"><a href="#2-2-ä¼˜åŒ–SQL" class="headerlink" title="2.2 ä¼˜åŒ–SQL"></a><strong>2.2 ä¼˜åŒ–SQL</strong></h2><p>é¿å…select *ï¼Œå°†éœ€è¦æŸ¥æ‰¾çš„å­—æ®µåˆ—å‡ºæ¥</p><p>ä½¿ç”¨è¿æ¥(join)æ¥ä»£æ›¿å­æŸ¥è¯¢</p><p>æ‹†åˆ†å¤§çš„deleteæˆ–insertè¯­å¥</p><p>é€šè¿‡å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—æ¥æ‰¾å‡ºè¾ƒæ…¢çš„SQL</p><p>ä¸åšåˆ—è¿ç®—ï¼šSELECT id WHERE age + 1 = 10ï¼Œä»»ä½•å¯¹åˆ—çš„æ“ä½œéƒ½å°†å¯¼è‡´è¡¨æ‰«æï¼Œå®ƒåŒ…æ‹¬æ•°æ®åº“æ•™ç¨‹å‡½æ•°ã€è®¡ç®—è¡¨è¾¾å¼ç­‰ç­‰ï¼ŒæŸ¥è¯¢æ—¶è¦å°½å¯èƒ½å°†æ“ä½œç§»è‡³ç­‰å·å³è¾¹</p><p>sqlè¯­å¥å°½å¯èƒ½ç®€å•ï¼šä¸€æ¡sqlåªèƒ½åœ¨ä¸€ä¸ªcpuè¿ç®—;å¤§è¯­å¥æ‹†å°è¯­å¥ï¼Œå‡å°‘é”æ—¶é—´;ä¸€æ¡å¤§sqlå¯ä»¥å µæ­»æ•´ä¸ªåº“</p><p>ORæ”¹å†™æˆINï¼šORçš„æ•ˆç‡æ˜¯nçº§åˆ«ï¼ŒINçš„æ•ˆç‡æ˜¯log(n)çº§åˆ«ï¼Œinçš„ä¸ªæ•°å»ºè®®æ§åˆ¶åœ¨200ä»¥å†…</p><p>é¿å…%xxxå¼æŸ¥è¯¢</p><p>å°½é‡é¿å…åœ¨WHEREå­å¥ä¸­ä½¿ç”¨!=æˆ–&lt;&gt;æ“ä½œç¬¦ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ</p><p>å¯¹äºè¿ç»­æ•°å€¼ï¼Œä½¿ç”¨BETWEENä¸ç”¨INï¼šSELECT id FROM t WHERE num BETWEEN 1 AND 5</p><p>åˆ—è¡¨æ•°æ®ä¸è¦æ‹¿å…¨è¡¨ï¼Œè¦ä½¿ç”¨LIMITæ¥åˆ†é¡µï¼Œæ¯é¡µæ•°é‡ä¹Ÿä¸è¦å¤ªå¤§</p><h2 id="2-3-åˆ†åŒº"><a href="#2-3-åˆ†åŒº" class="headerlink" title="2.3 åˆ†åŒº"></a><strong>2.3 åˆ†åŒº</strong></h2><p>MySql 5.1ç‰ˆæœ¬å¼•å…¥ï¼Œç”¨æˆ·éœ€è¦åœ¨å»ºè¡¨çš„æ—¶å€™åŠ ä¸Šåˆ†åŒºå‚æ•°ã€‚åˆ†åŒºè¡¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘è¡¨ï¼Œä½†æ˜¯åº•å±‚ç”±å¤šä¸ªç‰©ç†å­è¡¨ç»„æˆï¼Œå®ç°åˆ†åŒºçš„ä»£ç å®é™…ä¸Šæ˜¯é€šè¿‡å¯¹ä¸€ç»„åº•å±‚è¡¨çš„å¯¹è±¡å°è£…ï¼Œä½†å¯¹SQLå±‚æ¥è¯´æ˜¯ä¸€ä¸ªå®Œå…¨å°è£…åº•å±‚çš„é»‘ç›’å­ã€‚MySQLå®ç°åˆ†åŒºçš„æ–¹å¼ä¹Ÿæ„å‘³ç€ç´¢å¼•ä¹Ÿæ˜¯æŒ‰ç…§åˆ†åŒºçš„å­è¡¨å®šä¹‰ï¼Œæ²¡æœ‰å…¨å±€ç´¢å¼•ã€‚</p><p><strong>åˆ†åŒºçš„å¥½å¤„æ˜¯ï¼š</strong></p><ol><li>å¯ä»¥è®©å•è¡¨å­˜å‚¨æ›´å¤šçš„æ•°æ®</li><li>åˆ†åŒºè¡¨çš„æ•°æ®æ›´å®¹æ˜“ç»´æŠ¤ï¼Œå¯ä»¥é€šè¿‡æ¸…æ¥šæ•´ä¸ªåˆ†åŒºæ‰¹é‡åˆ é™¤å¤§é‡æ•°æ®ï¼Œä¹Ÿå¯ä»¥å¢åŠ æ–°çš„åˆ†åŒºæ¥æ”¯æŒæ–°æ’å…¥çš„æ•°æ®ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥å¯¹ä¸€ä¸ªç‹¬ç«‹åˆ†åŒºè¿›è¡Œä¼˜åŒ–ã€æ£€æŸ¥ã€ä¿®å¤ç­‰æ“ä½œ</li><li>éƒ¨åˆ†æŸ¥è¯¢èƒ½å¤Ÿä»æŸ¥è¯¢æ¡ä»¶ç¡®å®šåªè½åœ¨å°‘æ•°åˆ†åŒºä¸Šï¼Œé€Ÿåº¦ä¼šå¾ˆå¿«</li><li>åˆ†åŒºè¡¨çš„æ•°æ®è¿˜å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†è®¾å¤‡ä¸Šï¼Œä»è€Œæç¬‘åˆ©ç”¨å¤šä¸ªç¡¬ä»¶è®¾å¤‡</li><li>å¯ä»¥ä½¿ç”¨åˆ†åŒºè¡¨èµ–é¿å…æŸäº›ç‰¹æ®Šç“¶é¢ˆï¼Œä¾‹å¦‚InnoDBå•ä¸ªç´¢å¼•çš„äº’æ–¥è®¿é—®ã€ext3æ–‡ä»¶ç³»ç»Ÿçš„inodeé”ç«äº‰</li><li>å¯ä»¥å¤‡ä»½å’Œæ¢å¤å•ä¸ªåˆ†åŒº</li></ol><p><strong>åˆ†åŒºçš„é™åˆ¶å’Œç¼ºç‚¹ï¼š</strong></p><ol><li>ä¸€ä¸ªè¡¨æœ€å¤šåªèƒ½æœ‰1024ä¸ªåˆ†åŒº</li><li>å¦‚æœåˆ†åŒºå­—æ®µä¸­æœ‰ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•çš„åˆ—ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¸»é”®åˆ—å’Œå”¯ä¸€ç´¢å¼•åˆ—éƒ½å¿…é¡»åŒ…å«è¿›æ¥</li><li>åˆ†åŒºè¡¨æ— æ³•ä½¿ç”¨å¤–é”®çº¦æŸ</li><li>NULLå€¼ä¼šä½¿åˆ†åŒºè¿‡æ»¤æ— æ•ˆ</li><li>æ‰€æœ‰åˆ†åŒºå¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­˜å‚¨å¼•æ“</li></ol><p><strong>åˆ†åŒºçš„ç±»å‹ï¼š</strong></p><ol><li>RANGEåˆ†åŒºï¼šåŸºäºå±äºä¸€ä¸ªç»™å®šè¿ç»­åŒºé—´çš„åˆ—å€¼ï¼ŒæŠŠå¤šè¡Œåˆ†é…ç»™åˆ†åŒº</li><li>LISTåˆ†åŒºï¼šç±»ä¼¼äºæŒ‰RANGEåˆ†åŒºï¼ŒåŒºåˆ«åœ¨äºLISTåˆ†åŒºæ˜¯åŸºäºåˆ—å€¼åŒ¹é…ä¸€ä¸ªç¦»æ•£å€¼é›†åˆä¸­çš„æŸä¸ªå€¼æ¥è¿›è¡Œé€‰æ‹©</li><li>HASHåˆ†åŒºï¼šåŸºäºç”¨æˆ·å®šä¹‰çš„è¡¨è¾¾å¼çš„è¿”å›å€¼æ¥è¿›è¡Œé€‰æ‹©çš„åˆ†åŒºï¼Œè¯¥è¡¨è¾¾å¼ä½¿ç”¨å°†è¦æ’å…¥åˆ°è¡¨ä¸­çš„è¿™äº›è¡Œçš„åˆ—å€¼è¿›è¡Œè®¡ç®—ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥åŒ…å«MySQLä¸­æœ‰æ•ˆçš„ã€äº§ç”Ÿéè´Ÿæ•´æ•°å€¼çš„ä»»ä½•è¡¨è¾¾å¼</li><li>KEYåˆ†åŒºï¼šç±»ä¼¼äºæŒ‰HASHåˆ†åŒºï¼ŒåŒºåˆ«åœ¨äºKEYåˆ†åŒºåªæ”¯æŒè®¡ç®—ä¸€åˆ—æˆ–å¤šåˆ—ï¼Œä¸”MySQLæœåŠ¡å™¨æä¾›å…¶è‡ªèº«çš„å“ˆå¸Œå‡½æ•°ã€‚å¿…é¡»æœ‰ä¸€åˆ—æˆ–å¤šåˆ—åŒ…å«æ•´æ•°å€¼</li><li>å…·ä½“å…³äºmysqlåˆ†åŒºçš„æ¦‚å¿µè¯·è‡ªè¡Œgoogleæˆ–æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘è¿™é‡Œåªæ˜¯æŠ›ç –å¼•ç‰äº†ã€‚</li></ol><h2 id="2-4-åˆ†è¡¨"><a href="#2-4-åˆ†è¡¨" class="headerlink" title="2.4 åˆ†è¡¨"></a><strong>2.4 åˆ†è¡¨</strong></h2><p>åˆ†è¡¨å°±æ˜¯æŠŠä¸€å¼ å¤§è¡¨ï¼ŒæŒ‰ç…§å¦‚ä¸Šè¿‡ç¨‹éƒ½ä¼˜åŒ–äº†ï¼Œè¿˜æ˜¯æŸ¥è¯¢å¡æ­»ï¼Œé‚£å°±æŠŠè¿™ä¸ªè¡¨åˆ†æˆå¤šå¼ è¡¨ï¼ŒæŠŠä¸€æ¬¡æŸ¥è¯¢åˆ†æˆå¤šæ¬¡æŸ¥è¯¢ï¼Œç„¶åæŠŠç»“æœç»„åˆè¿”å›ç»™ç”¨æˆ·ã€‚</p><p>åˆ†è¡¨åˆ†ä¸ºå‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†ï¼Œé€šå¸¸ä»¥æŸä¸ªå­—æ®µåšæ‹†åˆ†é¡¹ã€‚æ¯”å¦‚ä»¥idå­—æ®µæ‹†åˆ†ä¸º100å¼ è¡¨ï¼š è¡¨åä¸º tableName_id%100</p><p>ä½†ï¼šåˆ†è¡¨éœ€è¦ä¿®æ”¹æºç¨‹åºä»£ç ï¼Œä¼šç»™å¼€å‘å¸¦æ¥å¤§é‡å·¥ä½œï¼Œæå¤§çš„å¢åŠ äº†å¼€å‘æˆæœ¬ï¼Œæ•…ï¼šåªé€‚åˆåœ¨å¼€å‘åˆæœŸå°±è€ƒè™‘åˆ°äº†å¤§é‡æ•°æ®å­˜åœ¨ï¼Œåšå¥½äº†åˆ†è¡¨å¤„ç†ï¼Œä¸é€‚åˆåº”ç”¨ä¸Šçº¿äº†å†åšä¿®æ”¹ï¼Œæˆæœ¬å¤ªé«˜!!!è€Œä¸”é€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆï¼Œéƒ½ä¸å¦‚é€‰æ‹©æˆ‘æä¾›çš„ç¬¬äºŒç¬¬ä¸‰ä¸ªæ–¹æ¡ˆçš„æˆæœ¬ä½!æ•…ä¸å»ºè®®é‡‡ç”¨ã€‚</p><h2 id="2-5-åˆ†åº“"><a href="#2-5-åˆ†åº“" class="headerlink" title="2.5 åˆ†åº“"></a><strong>2.5 åˆ†åº“</strong></h2><p>æŠŠä¸€ä¸ªæ•°æ®åº“åˆ†æˆå¤šä¸ªï¼Œå»ºè®®åšä¸ªè¯»å†™åˆ†ç¦»å°±è¡Œäº†ï¼ŒçœŸæ­£çš„åšåˆ†åº“ä¹Ÿä¼šå¸¦æ¥å¤§é‡çš„å¼€å‘æˆæœ¬ï¼Œå¾—ä¸å¿å¤±!ä¸æ¨èä½¿ç”¨ã€‚</p><h2 id="2-5-å‡çº§æ•°æ®åº“"><a href="#2-5-å‡çº§æ•°æ®åº“" class="headerlink" title="2.5 å‡çº§æ•°æ®åº“"></a><strong>2.5 å‡çº§æ•°æ®åº“</strong></h2><p>é€‰ç”¨ä¸€æ¬¾å…¼å®¹MySqlçš„é«˜æ€§èƒ½æ•°æ®åº“ã€‚</p><h2 id="2-6-æ¢å¤§æ•°æ®å¼•æ“å¤„ç†æ•°æ®"><a href="#2-6-æ¢å¤§æ•°æ®å¼•æ“å¤„ç†æ•°æ®" class="headerlink" title="2.6 æ¢å¤§æ•°æ®å¼•æ“å¤„ç†æ•°æ®"></a><strong>2.6 æ¢å¤§æ•°æ®å¼•æ“å¤„ç†æ•°æ®</strong></h2><p>å½“æ•°æ®é‡è¿‡äº¿ï¼Œå¯èƒ½å®ç°æ— æ³•æ”¯æ’‘ï¼Œåªèƒ½æ›´æ¢Hadoopç­‰å¤§æ•°æ®å¼•æ“æ¥ä»£æ›¿ä¼ ç»Ÿæ•°æ®åº“ã€‚</p><p>æˆ–è€…è´­ä¹°ä¸“ä¸šçš„å¤§æ•°æ®äº‘è§£å†³æ–¹æ¡ˆï¼Œæ¯”è¾ƒä¾¿å®œçœäººåŠ›ã€‚</p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— <a href="https://database.51cto.com/art/201902/592522.htm" target="_blank" rel="noopener">è®°å½•ä¸€æ¬¡MySQLä¸¤åƒä¸‡æ•°æ®çš„å¤§è¡¨ä¼˜åŒ–è§£å†³è¿‡ç¨‹ï¼Œæä¾›ä¸‰ç§è§£å†³æ–¹æ¡ˆ</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="sql" scheme="http://linyishui.top/tags/sql/"/>
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ConcurrentSkipListMap</title>
    <link href="http://linyishui.top/2020070801.html"/>
    <id>http://linyishui.top/2020070801.html</id>
    <published>2020-07-08T08:56:37.000Z</published>
    <updated>2020-10-02T08:22:06.294Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ConcurrentSkipListMap"><a href="#ConcurrentSkipListMap" class="headerlink" title="ConcurrentSkipListMap"></a><strong>ConcurrentSkipListMap</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-æ¦‚è¿°"><a href="#ç¬¬ä¸€èŠ‚-æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€èŠ‚ æ¦‚è¿°"></a><strong>ç¬¬ä¸€èŠ‚ æ¦‚è¿°</strong></h2><h3 id="1-1-ä»€ä¹ˆæ˜¯ConcurrentSkipListMap"><a href="#1-1-ä»€ä¹ˆæ˜¯ConcurrentSkipListMap" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ConcurrentSkipListMap"></a><strong>1.1 ä»€ä¹ˆæ˜¯ConcurrentSkipListMap</strong></h3><p>ConcurrentSkipListMapæ˜¯ç”±å¹¶å‘åŒ…æä¾›çš„ä¸€ç§çº¿ç¨‹å®‰å…¨çš„å¹¶å‘å®¹å™¨ï¼Œï¼ˆä¼˜ç‚¹ï¼‰ä½¿æˆ‘ä»¬èƒ½å¤Ÿ<strong>ä»¥æ— é”æ–¹å¼å®ç°çº¿ç¨‹å®‰å…¨</strong>ï¼Œ<strong>åº•å±‚æ˜¯é€šè¿‡è·³è¡¨æ¥å®ç°</strong>çš„èƒ½å¤Ÿä¿è¯<strong>å…ƒç´ æœ‰åº</strong>ã€‚</p><p>è·³è¡¨æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨<strong>â€œè·³è·ƒå¼â€</strong>æŸ¥æ‰¾çš„æ–¹å¼ä½¿å¾—æ’å…¥ã€è¯»å–æ•°æ®æ—¶å¤æ‚åº¦å˜æˆäº† <strong>O(logn)</strong> ã€‚æ³¨æ„ï¼š<code>size()</code> ç”±äºå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¯¹æ˜ å°„è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥éœ€è¦éå†æ•´ä¸ªæ˜ å°„æ‰èƒ½è¿”å›å…ƒç´ ä¸ªæ•°ï¼Œè¿™æ˜¯ä¸ª <strong>O(logn)</strong> çš„æ“ä½œã€‚</p><h3 id="1-2-ç®€å•ä½¿ç”¨"><a href="#1-2-ç®€å•ä½¿ç”¨" class="headerlink" title="1.2 ç®€å•ä½¿ç”¨"></a><strong>1.2 ç®€å•ä½¿ç”¨</strong></h3><p>ä¸€ä¸ªç®€å•çš„å®ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    ConcurrentSkipListMap&lt;Integer, String&gt; map = <span class="keyword">new</span> ConcurrentSkipListMap&lt;&gt;(</span><br><span class="line">            Comparator.comparingInt(v -&gt; v));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šè¿‡putæ·»åŠ </span></span><br><span class="line">    map.put(<span class="number">1</span>, <span class="string">"a"</span>);</span><br><span class="line">    map.put(<span class="number">2</span>, <span class="string">"b"</span>);</span><br><span class="line">    map.put(<span class="number">3</span>, <span class="string">"c"</span>);</span><br><span class="line">    map.put(-<span class="number">1</span>, <span class="string">"a"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çº¿ç¨‹é›†åˆ</span></span><br><span class="line">    List&lt;Thread&gt; ts = <span class="keyword">new</span> ArrayList&lt;Thread&gt;(<span class="number">600</span>);</span><br><span class="line">    <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">    <span class="comment">//éå†çº¿ç¨‹é›†åˆï¼Œæ„å»ºæ¯ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åˆ†åˆ«è°ƒç”¨çº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨çš„è®¡æ•°å™¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">100</span>; j++) &#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;<span class="comment">//åˆ†åˆ«è°ƒç”¨å®‰å…¨å’Œä¸å®‰å…¨çš„è®¡æ•°å™¨</span></span><br><span class="line">                    map.put(i, i + <span class="string">""</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ts.add(t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//éå†æ‰§è¡Œæ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (Thread t : ts) &#123;</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæˆ</span></span><br><span class="line">    <span class="keyword">for</span> (Thread t : ts) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ‰“å°æœ€ç»ˆç»“æœ</span></span><br><span class="line">    map.forEach((k,v) -&gt; &#123;System.out.println(<span class="string">"k: "</span> + k + <span class="string">" v: "</span> + v);&#125;);</span><br><span class="line">    System.out.println(System.currentTimeMillis() - start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">k:</span> <span class="number">-1</span> <span class="string">v:</span> a</span><br><span class="line"><span class="string">k:</span> <span class="number">0</span> <span class="string">v:</span> <span class="number">0</span></span><br><span class="line"><span class="string">k:</span> <span class="number">1</span> <span class="string">v:</span> <span class="number">1</span></span><br><span class="line"><span class="string">k:</span> <span class="number">2</span> <span class="string">v:</span> <span class="number">2</span></span><br><span class="line">...</span><br><span class="line"><span class="string">k:</span> <span class="number">98</span> <span class="string">v:</span> <span class="number">98</span></span><br><span class="line"><span class="string">k:</span> <span class="number">99</span> <span class="string">v:</span> <span class="number">99</span></span><br><span class="line"><span class="number">82</span></span><br></pre></td></tr></table></figure><p>æŠŠ ConcurrentSkipListMap æ›¿æ¢ä¸º TreeMap ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">k:</span> <span class="number">-1</span> <span class="string">v:</span> a</span><br><span class="line"><span class="string">k:</span> <span class="number">0</span> <span class="string">v:</span> <span class="number">0</span></span><br><span class="line"><span class="string">k:</span> <span class="number">1</span> <span class="string">v:</span> <span class="number">1</span></span><br><span class="line"><span class="string">k:</span> <span class="number">2</span> <span class="string">v:</span> <span class="number">2</span></span><br><span class="line"><span class="string">k:</span> <span class="number">3</span> <span class="string">v:</span> <span class="number">3</span></span><br><span class="line"><span class="string">k:</span> <span class="number">4</span> <span class="string">v:</span> <span class="number">4</span></span><br><span class="line"><span class="string">k:</span> <span class="number">5</span> <span class="string">v:</span> <span class="number">5</span></span><br><span class="line"><span class="string">k:</span> <span class="number">6</span> <span class="string">v:</span> <span class="number">6</span></span><br><span class="line"><span class="string">k:</span> <span class="number">7</span> <span class="string">v:</span> <span class="number">7</span></span><br><span class="line"><span class="string">k:</span> <span class="number">12</span> <span class="string">v:</span> <span class="number">12</span></span><br><span class="line"><span class="string">k:</span> <span class="number">8</span> <span class="string">v:</span> <span class="number">8</span></span><br><span class="line"><span class="string">k:</span> <span class="number">9</span> <span class="string">v:</span> <span class="number">9</span></span><br><span class="line"><span class="string">k:</span> <span class="number">10</span> <span class="string">v:</span> <span class="number">10</span></span><br><span class="line"><span class="string">k:</span> <span class="number">11</span> <span class="string">v:</span> <span class="number">11</span></span><br><span class="line"><span class="string">k:</span> <span class="number">12</span> <span class="string">v:</span> <span class="number">12</span></span><br><span class="line">...</span><br><span class="line"><span class="string">k:</span> <span class="number">50</span> <span class="string">v:</span> <span class="number">50</span></span><br><span class="line"><span class="string">k:</span> <span class="number">51</span> <span class="string">v:</span> <span class="number">51</span></span><br><span class="line"><span class="string">k:</span> <span class="number">52</span> <span class="string">v:</span> <span class="number">52</span></span><br><span class="line"><span class="string">k:</span> <span class="number">53</span> <span class="string">v:</span> <span class="number">53</span></span><br><span class="line"><span class="string">k:</span> <span class="number">54</span> <span class="string">v:</span> <span class="number">54</span></span><br><span class="line"><span class="string">k:</span> <span class="number">55</span> <span class="string">v:</span> <span class="number">55</span></span><br><span class="line"><span class="string">k:</span> <span class="number">57</span> <span class="string">v:</span> <span class="number">57</span></span><br><span class="line"><span class="string">k:</span> <span class="number">56</span> <span class="string">v:</span> <span class="number">56</span></span><br><span class="line"><span class="string">k:</span> <span class="number">57</span> <span class="string">v:</span> <span class="number">57</span></span><br><span class="line"><span class="string">k:</span> <span class="number">58</span> <span class="string">v:</span> <span class="number">58</span></span><br><span class="line"><span class="string">k:</span> <span class="number">59</span> <span class="string">v:</span> <span class="number">59</span></span><br><span class="line">...</span><br><span class="line"><span class="string">k:</span> <span class="number">99</span> <span class="string">v:</span> <span class="number">99</span></span><br><span class="line"><span class="number">46</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°ä¸€ä¸ªåˆå°è±¡ï¼šTreeMap å¤šçº¿ç¨‹ç¯å¢ƒä¸‹éçº¿ç¨‹å®‰å…¨ï¼Œä½†å•çº¿ç¨‹çš„æœ‰åºæ˜ å°„æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œè€Œ ConcurrentSkipListMap åˆ™å¯ä»¥åœ¨ç›¸åŒéœ€æ±‚çš„å¤šçº¿ç¨‹åœºæ™¯ä½œä¸ºæ›¿ä»£å“ã€‚  </p><hr><h2 id="ç¬¬äºŒèŠ‚-è·³è¡¨"><a href="#ç¬¬äºŒèŠ‚-è·³è¡¨" class="headerlink" title="ç¬¬äºŒèŠ‚ è·³è¡¨"></a><strong>ç¬¬äºŒèŠ‚ è·³è¡¨</strong></h2><h3 id="2-1-æ¦‚è¿°"><a href="#2-1-æ¦‚è¿°" class="headerlink" title="2.1 æ¦‚è¿°"></a><strong>2.1 æ¦‚è¿°</strong></h3><p> è·³è¡¨ï¼ˆSkipListï¼‰ï¼šæ˜¯ä¸€ç§ä¼˜ç§€çš„æ•°æ®ç»“æ„ï¼Œ<strong>ä½¿å¾—åŒ…å«nä¸ªå…ƒç´ çš„æœ‰åºåºåˆ—çš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œçš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn) ï¼Œè¦ä¼˜äºæ•°ç»„çš„ O(n) </strong>ã€‚</p><p>å¿«é€Ÿçš„æŸ¥è¯¢æ•ˆæœæ˜¯<strong>é€šè¿‡ç»´æŠ¤ä¸€ä¸ªå¤šå±‚æ¬¡çš„é“¾è¡¨å®ç°çš„</strong>ï¼Œä¸”ä¸å‰ä¸€å±‚ï¼ˆä¸‹é¢ä¸€å±‚ï¼‰é“¾è¡¨å…ƒç´ çš„æ•°é‡ç›¸æ¯”ï¼Œæ¯ä¸€å±‚é“¾è¡¨ä¸­çš„å…ƒç´ çš„æ•°é‡æ›´å°‘ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚ä¸€å¼€å§‹æ—¶ï¼Œç®—æ³•åœ¨æœ€ç¨€ç–çš„å±‚æ¬¡è¿›è¡Œæœç´¢ï¼Œç›´è‡³éœ€è¦æŸ¥æ‰¾çš„å…ƒç´ åœ¨è¯¥å±‚ä¸¤ä¸ªç›¸é‚»çš„å…ƒç´ ä¸­é—´ã€‚è¿™æ—¶ï¼Œç®—æ³•å°†è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå±‚æ¬¡ï¼Œé‡å¤åˆšæ‰çš„æœç´¢ï¼Œç›´åˆ°æ‰¾åˆ°éœ€è¦æŸ¥æ‰¾çš„å…ƒç´ ä¸ºæ­¢ã€‚è·³è¿‡çš„å…ƒç´ çš„æ–¹æ³•å¯ä»¥æ˜¯éšæœºæ€§é€‰æ‹©æˆ–ç¡®å®šæ€§é€‰æ‹©ï¼Œå…¶ä¸­å‰è€…æ›´ä¸ºå¸¸è§ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010118.png" alt></p><p><em>ä¸€å¼ è·³è·ƒåˆ—è¡¨çš„ç¤ºæ„å›¾ã€‚æ¯ä¸ªå¸¦æœ‰ç®­å¤´çš„æ¡†è¡¨ç¤ºä¸€ä¸ªæŒ‡é’ˆ, è€Œæ¯è¡Œæ˜¯ä¸€ä¸ªç¨€ç–å­åºåˆ—çš„é“¾è¡¨ï¼›åº•éƒ¨çš„ç¼–å·æ¡†ï¼ˆé»„è‰²ï¼‰è¡¨ç¤ºæœ‰åºçš„æ•°æ®åºåˆ—ã€‚æŸ¥æ‰¾ä»é¡¶éƒ¨æœ€ç¨€ç–çš„å­åºåˆ—å‘ä¸‹è¿›è¡Œ, ç›´è‡³éœ€è¦æŸ¥æ‰¾çš„å…ƒç´ åœ¨è¯¥å±‚ä¸¤ä¸ªç›¸é‚»çš„å…ƒç´ ä¸­é—´ã€‚</em></p><h3 id="2-2-ç®—æ³•"><a href="#2-2-ç®—æ³•" class="headerlink" title="2.2 ç®—æ³•"></a><strong>2.2 ç®—æ³•</strong></h3><p>è·³è·ƒåˆ—è¡¨æ˜¯æŒ‰å±‚å»ºé€ çš„ã€‚<strong>åº•å±‚æ˜¯ä¸€ä¸ªæ™®é€šçš„æœ‰åºé“¾è¡¨</strong>ã€‚æ¯ä¸ªæ›´é«˜å±‚éƒ½å……å½“ä¸‹é¢åˆ—è¡¨çš„<strong>â€œå¿«é€Ÿé€šé“â€</strong>ï¼Œè¿™é‡Œåœ¨ç¬¬ i å±‚ä¸­çš„å…ƒç´ æŒ‰æŸä¸ªå›ºå®šçš„æ¦‚ç‡ pï¼ˆé€šå¸¸ä¸º 1/2 æˆ– 1/4 ï¼‰å‡ºç°åœ¨ç¬¬ i+1 å±‚ä¸­ã€‚æ¯ä¸ªå…ƒç´ å¹³å‡å‡ºç°åœ¨ 1 / 1-p ä¸ªåˆ—è¡¨ä¸­ï¼Œè€Œæœ€é«˜å±‚çš„å…ƒç´ ï¼ˆé€šå¸¸æ˜¯åœ¨è·³è·ƒåˆ—è¡¨å‰ç«¯çš„ä¸€ä¸ªç‰¹æ®Šçš„å¤´å…ƒç´ ï¼‰åœ¨ log~1/p~n ä¸ªåˆ—è¡¨ä¸­å‡ºç°ã€‚</p><p>åœ¨æŸ¥æ‰¾ç›®æ ‡å…ƒç´ æ—¶ï¼Œä»é¡¶å±‚åˆ—è¡¨ã€å¤´å…ƒç´ èµ·æ­¥ã€‚ç®—æ³•æ²¿ç€æ¯å±‚é“¾è¡¨æœç´¢ï¼Œç›´è‡³æ‰¾åˆ°ä¸€ä¸ªå¤§äºæˆ–ç­‰äºç›®æ ‡çš„å…ƒç´ ï¼Œæˆ–è€…åˆ°è¾¾å½“å‰å±‚åˆ—è¡¨æœ«å°¾ã€‚å¦‚æœè¯¥å…ƒç´ ç­‰äºç›®æ ‡å…ƒç´ ï¼Œåˆ™è¡¨æ˜è¯¥å…ƒç´ å·²è¢«æ‰¾åˆ°ï¼›å¦‚æœè¯¥å…ƒç´ å¤§äºç›®æ ‡å…ƒç´ æˆ–å·²åˆ°è¾¾é“¾è¡¨æœ«å°¾ï¼Œåˆ™é€€å›åˆ°å½“å‰å±‚çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œç„¶åè½¬å…¥ä¸‹ä¸€å±‚è¿›è¡Œæœç´¢ã€‚æ¯å±‚é“¾è¡¨ä¸­é¢„æœŸçš„æŸ¥æ‰¾æ­¥æ•°æœ€å¤šä¸º 1/p ï¼Œè€Œå±‚æ•°ä¸º log~1/p~n ï¼Œæ‰€ä»¥æŸ¥æ‰¾çš„æ€»ä½“æ­¥æ•°ä¸º -log~p~n / pï¼Œç”±äº p æ˜¯å¸¸æ•°ï¼ŒæŸ¥æ‰¾æ“ä½œæ€»ä½“çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log n) ã€‚è€Œé€šè¿‡é€‰æ‹©ä¸åŒ p å€¼ï¼Œå°±å¯ä»¥åœ¨æŸ¥æ‰¾ä»£ä»·å’Œå­˜å‚¨ä»£ä»·ä¹‹é—´è·å–å¹³è¡¡ã€‚</p><p>è·³è·ƒåˆ—è¡¨ä¸åƒå¹³è¡¡æ ‘ç­‰æ•°æ®ç»“æ„é‚£æ ·æä¾›å¯¹æœ€åæƒ…å†µçš„æ€§èƒ½ä¿è¯ï¼šç”±äºç”¨æ¥å»ºé€ è·³è·ƒåˆ—è¡¨é‡‡ç”¨éšæœºé€‰å–å…ƒç´ è¿›å…¥æ›´é«˜å±‚çš„æ–¹æ³•ï¼Œåœ¨å°æ¦‚ç‡æƒ…å†µä¸‹ä¼šç”Ÿæˆä¸€ä¸ªä¸å¹³è¡¡çš„è·³è·ƒåˆ—è¡¨ï¼ˆæœ€åæƒ…å†µä¾‹å¦‚æœ€åº•å±‚ä»…æœ‰ä¸€ä¸ªå…ƒç´ è¿›å…¥äº†æ›´é«˜å±‚ï¼Œæ­¤æ—¶è·³è·ƒåˆ—è¡¨çš„æŸ¥æ‰¾ä¸æ™®é€šåˆ—è¡¨ä¸€è‡´ï¼‰ã€‚ä½†æ˜¯åœ¨å®é™…ä¸­å®ƒé€šå¸¸å·¥ä½œè‰¯å¥½ï¼ŒéšæœºåŒ–å¹³è¡¡æ–¹æ¡ˆä¹Ÿæ¯”å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ç­‰æ•°æ®ç»“æ„ä¸­ä½¿ç”¨çš„ç¡®å®šæ€§å¹³è¡¡æ–¹æ¡ˆå®¹æ˜“å®ç°ã€‚è·³è·ƒåˆ—è¡¨åœ¨å¹¶è¡Œè®¡ç®—ä¸­ä¹Ÿå¾ˆæœ‰ç”¨ï¼šæ’å…¥å¯ä»¥åœ¨è·³è·ƒåˆ—è¡¨ä¸åŒçš„éƒ¨åˆ†å¹¶è¡Œåœ°è¿›è¡Œï¼Œè€Œä¸ç”¨å¯¹æ•°æ®ç»“æ„è¿›è¡Œå…¨å±€çš„é‡æ–°å¹³è¡¡ã€‚</p><h3 id="2-3-å®ç°ç»†èŠ‚"><a href="#2-3-å®ç°ç»†èŠ‚" class="headerlink" title="2.3 å®ç°ç»†èŠ‚"></a><strong>2.3 å®ç°ç»†èŠ‚</strong></h3><p>å› ä¸ºè·³è·ƒåˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥åœ¨å¤šä¸ªåˆ—è¡¨ä¸­ï¼Œæ‰€ä»¥æ¯ä¸ªå…ƒç´ å¯ä»¥æœ‰å¤šäºä¸€ä¸ªæŒ‡é’ˆã€‚</p><p>è·³è·ƒåˆ—è¡¨çš„æ’å…¥å’Œåˆ é™¤çš„å®ç°ä¸æ™®é€šçš„é“¾è¡¨æ“ä½œç±»ä¼¼ï¼Œä½†é«˜å±‚å…ƒç´ å¿…é¡»åœ¨è¿›è¡Œå¤šä¸ªé“¾è¡¨ä¸­è¿›è¡Œæ’å…¥æˆ–åˆ é™¤ã€‚</p><p>è·³è·ƒåˆ—è¡¨çš„æœ€åæ—¶é—´æ€§èƒ½å…·æœ‰ä¸€å®šéšæœºæ€§ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„éå†æ“ä½œï¼ˆä¾‹å¦‚åœ¨æ‰“å°åˆ—è¡¨å…¨éƒ¨å†…å®¹æ—¶ï¼‰ä»¥æ— éšæœºçš„ç®—æ³•é‡æ•´åˆ—è¡¨çš„ç»“æ„ï¼Œä»è€Œä½¿è·³è·ƒåˆ—è¡¨çš„å®é™…æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦å°½é‡ç¬¦åˆç†è®ºå¹³å‡å€¼ O(log n) ã€‚</p><h4 id="ï¼ˆ1ï¼‰æ’å…¥æ“ä½œ"><a href="#ï¼ˆ1ï¼‰æ’å…¥æ“ä½œ" class="headerlink" title="ï¼ˆ1ï¼‰æ’å…¥æ“ä½œ"></a><strong>ï¼ˆ1ï¼‰æ’å…¥æ“ä½œ</strong></h4><p>å¾€è·³è·ƒåˆ—è¡¨ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/Skip_list_add_element-en.gif" alt></p><ol><li>æ–°èŠ‚ç‚¹å’Œå„å±‚ç´¢å¼•èŠ‚ç‚¹é€ä¸€æ¯”è¾ƒï¼Œç¡®å®šåŸé“¾è¡¨çš„æ’å…¥ä½ç½®ï¼ŒO(log n)ã€‚</li><li>æŠŠç´¢å¼•æ’å…¥åˆ°åŸé“¾è¡¨ï¼ŒO(1)ã€‚</li><li>åˆ©ç”¨æŠ›ç¡¬å¸çš„éšæœºæ–¹å¼ï¼Œå†³å®šæ–°èŠ‚ç‚¹æ˜¯å¦æå‡ä¸ºä¸Šä¸€çº§ç´¢å¼•ã€‚ç»“æœä¸ºâ€œæ­£â€åˆ™æå‡å¹¶ç»§ç»­æŠ›ç¡¬å¸ï¼Œç»“æœä¸ºâ€œè´Ÿâ€åˆ™åœæ­¢ï¼ŒO(log n)ã€‚</li></ol><p>æ€»ä½“ä¸Šï¼Œè·³è·ƒè¡¨æ’å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(log n) ï¼Œè€Œè¿™ç§æ•°æ®ç»“æ„æ‰€å ç©ºé—´æ˜¯2Nï¼Œæ—¢ç©ºé—´å¤æ‚åº¦æ˜¯ O(n) ã€‚</p><h4 id="ï¼ˆ2ï¼‰åˆ é™¤æ“ä½œ"><a href="#ï¼ˆ2ï¼‰åˆ é™¤æ“ä½œ" class="headerlink" title="ï¼ˆ2ï¼‰åˆ é™¤æ“ä½œ"></a><strong>ï¼ˆ2ï¼‰åˆ é™¤æ“ä½œ</strong></h4><p>åœ¨ç´¢å¼•å±‚æ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œä¾æ¬¡åˆ é™¤æ¯å±‚ç›¸åŒèŠ‚ç‚¹å³å¯ã€‚è‹¥æŸå±‚ç´¢å¼•åœ¨åˆ é™¤ååªå‰©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥åˆ é™¤æ­¤å±‚ã€‚</p><ol><li>è‡ªä¸Šè€Œä¸‹ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€æ¬¡å‡ºç°èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œå¹¶é€å±‚æ‰¾åˆ°æ¯ä¸€å±‚å¯¹åº”çš„èŠ‚ç‚¹ï¼ŒO(log n) ã€‚</li><li>åˆ é™¤æ¯ä¸€å±‚æŸ¥æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œå¦‚æœè¯¥å±‚åªå‰©ä¸‹1ä¸ªèŠ‚ç‚¹ï¼Œåˆ é™¤æ•´ä¸ªä¸€å±‚ï¼ˆåŸé“¾è¡¨é™¤å¤–ï¼‰ï¼ŒO(log n) ã€‚</li></ol><p>æ€»ä½“ä¸Šï¼Œè·³è·ƒè¡¨åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(log n) ã€‚</p><h3 id="2-4-è·³è·ƒè¡¨å’ŒäºŒå‰æ ‘çš„åŒºåˆ«"><a href="#2-4-è·³è·ƒè¡¨å’ŒäºŒå‰æ ‘çš„åŒºåˆ«" class="headerlink" title="2.4 è·³è·ƒè¡¨å’ŒäºŒå‰æ ‘çš„åŒºåˆ«"></a><strong>2.4 è·³è·ƒè¡¨å’ŒäºŒå‰æ ‘çš„åŒºåˆ«</strong></h3><ul><li>è·³è¡¨ç»´æŒç»“æ„å¹³è¡¡çš„æˆæœ¬è¾ƒä½ï¼Œå®Œå…¨ä¾é éšæœºï¼›äºŒå‰æ ‘åˆ™åœ¨å¤šæ¬¡æ’å…¥åˆ é™¤åï¼Œé€šè¿‡å†å¹³è¡¡æ“ä½œæ¥é‡æ–°è°ƒæ•´ç»“æ„å¹³è¡¡ã€‚</li><li>è·³è¡¨éæ ‘ç»“æ„ï¼Œåˆ†ç´¢å¼•èŠ‚ç‚¹å’Œåº•å±‚é“¾è¡¨èŠ‚ç‚¹ï¼Œç´¢å¼•èŠ‚ç‚¹åªæœ‰å³è¾¹å’Œä¸‹è¾¹ä¸¤æ¡ç´¢å¼•ï¼Œé“¾è¡¨èŠ‚ç‚¹åˆ™åªæœ‰ä¸‹ä¸ªèŠ‚ç‚¹ç´¢å¼•ï¼Œè€ŒäºŒå‰æ ‘èŠ‚ç‚¹åˆ™æœ‰å·¦å³å­ç»“ç‚¹ã€‚</li></ul><p>è¡¥å……ï¼šRedisé€šè¿‡è·³è·ƒè¡¨çš„ä¼˜åŒ–å®ç°Sorted-setç»´æŠ¤æœ‰åºé›†åˆï¼Œè€Œå…³ç³»å‹æ•°æ®åº“åˆ™é‡‡ç”¨B+æ ‘ã€‚</p><hr><h2 id="ç¬¬ä¸‰èŠ‚-æºç è§£æ"><a href="#ç¬¬ä¸‰èŠ‚-æºç è§£æ" class="headerlink" title="ç¬¬ä¸‰èŠ‚ æºç è§£æ"></a><strong>ç¬¬ä¸‰èŠ‚ æºç è§£æ</strong></h2><h3 id="1-1-åŸºæœ¬ç»“æ„"><a href="#1-1-åŸºæœ¬ç»“æ„" class="headerlink" title="1.1 åŸºæœ¬ç»“æ„"></a><strong>1.1 åŸºæœ¬ç»“æ„</strong></h3><p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentSkipListMap.html" target="_blank" rel="noopener">ConcurrentSkipListMap</a> ä¸­åŒ…æ‹¬ Node å’Œ Index ä¸¤ç§èŠ‚ç‚¹ï¼Œå…¶ä¸­ Node å³æ™®é€šé“¾è¡¨èŠ‚ç‚¹ï¼Œè€Œ Index åˆ™æ˜¯ç´¢å¼•èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentSkipListMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">ConcurrentNavigableMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;, <span class="title">Cloneable</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·³è¡¨çš„æœ€é«˜å¤´ç´¢å¼•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> HeadIndex&lt;K,V&gt; head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»´æŠ¤æ˜ å°„å†…å…ƒç´ é¡ºåºçš„æ¯”è¾ƒå™¨ï¼Œå¯ä»¥ä¸ºç©ºè¡¨ç¤ºè‡ªç„¶é¡ºåº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> Comparator&lt;? <span class="keyword">super</span> K&gt; comparator;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** å»¶è¿Ÿåˆå§‹åŒ–çš„é”®é›† */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> KeySet&lt;K&gt; keySet;</span><br><span class="line">    <span class="comment">/** å»¶è¿Ÿåˆå§‹åŒ–çš„æ¡ç›®é›† */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> EntrySet&lt;K,V&gt; entrySet;</span><br><span class="line">    <span class="comment">/** å»¶è¿Ÿåˆå§‹åŒ–çš„å€¼é›†åˆ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Values&lt;V&gt; values;</span><br><span class="line">    <span class="comment">/** å»¶è¿Ÿåˆå§‹åŒ–çš„é™åºé”®é›† */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> ConcurrentNavigableMap&lt;K,V&gt; descendingMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        <span class="keyword">volatile</span> Object value;</span><br><span class="line">        <span class="keyword">volatile</span> Node&lt;K,V&gt; next;</span><br><span class="line"></span><br><span class="line">        Node(K key, Object value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡è®°èŠ‚ç‚¹. æ ‡è®°çš„åŒºåˆ«åœ¨äºå…¶å€¼å­—æ®µæŒ‡å‘è‡ªèº«ã€‚æ ‡è®°èŠ‚ç‚¹ä¹Ÿå…·æœ‰ç©ºé”®ï¼Œè¿™ä¸€äº‹å®åœ¨ä¸€äº›åœ°æ–¹å¾—åˆ°äº†åˆ©ç”¨ï¼Œä½†è¿™å¹¶ä¸èƒ½å°†æ ‡è®°ä¸ä¹Ÿå…·æœ‰ç©ºé”®çš„åŸºæœ¬çº§åˆ«æ ‡å¤´èŠ‚ç‚¹ï¼ˆhead.nodeï¼‰åŒºåˆ†å¼€ã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Node(Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.key = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">this</span>.value = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¯”è¾ƒå¹¶è®¾ç½®valueå­—æ®µ</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">casValue</span><span class="params">(Object cmp, Object val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, valueOffset, cmp, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¯”è¾ƒå¹¶è®¾ç½®nextå­—æ®µ</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">casNext</span><span class="params">(Node&lt;K,V&gt; cmp, Node&lt;K,V&gt; val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, nextOffset, cmp, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">helpDelete</span><span class="params">(Node&lt;K,V&gt; b, Node&lt;K,V&gt; f)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//é‡æ–°æ£€æŸ¥é“¾æ¥ï¼Œç„¶ååœ¨æ¯ä¸ªè°ƒç”¨ä¸­ä»…æ‰§è¡Œä¸€ä¸ªhelp-outé˜¶æ®µï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘å¸®åŠ©çº¿ç¨‹ä¹‹é—´çš„CASå¹²æ‰°</span></span><br><span class="line">            <span class="comment">//å¦‚æœfæ˜¯æ­¤èŠ‚ç‚¹çš„ä¸‹ä¸ªèŠ‚ç‚¹ï¼Œbæ˜¯æ­¤èŠ‚ç‚¹çš„å‰ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (f == next &amp;&amp; <span class="keyword">this</span> == b.next) &#123;</span><br><span class="line">                <span class="comment">//å¦‚æœfä¸ºç©ºæˆ–fçš„valueå­—æ®µä¸ç­‰äºfï¼Œåˆ™å°è¯•CASå°†æ–°NodeèŠ‚ç‚¹æ’å…¥få‰</span></span><br><span class="line">                <span class="keyword">if</span> (f == <span class="keyword">null</span> || f.value != f) <span class="comment">// not already marked</span></span><br><span class="line">                    casNext(f, <span class="keyword">new</span> Node&lt;K,V&gt;(f));</span><br><span class="line">                <span class="comment">//å¦åˆ™ï¼Œç”¨fçš„ä¸‹ä¸ªèŠ‚ç‚¹è¦†ç›–f</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b.casNext(<span class="keyword">this</span>, f.next);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Index</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Node&lt;K,V&gt; node;<span class="comment">//å¯¹åº”é“¾è¡¨èŠ‚ç‚¹ï¼Œå³value</span></span><br><span class="line">        <span class="keyword">final</span> Index&lt;K,V&gt; down;<span class="comment">//ä¸‹å±‚ç´¢å¼•èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">volatile</span> Index&lt;K,V&gt; right;<span class="comment">//å³è¾¹ç´¢å¼•èŠ‚ç‚¹</span></span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¯”è¾ƒå¹¶è®¾ç½®rightå­—æ®µï¼ŒCAS set right value</span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">casRight</span><span class="params">(Index&lt;K,V&gt; cmp, Index&lt;K,V&gt; val)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, rightOffset, cmp, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ˜¯å¦å·²åˆ é™¤æ­¤ç´¢å¼•çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">indexesDeletedNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> node.value == <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°è¯•CASç´¢å¼•èŠ‚ç‚¹newSuccä½œä¸ºå½“å‰èŠ‚ç‚¹çš„æ–°å³è¾¹èŠ‚ç‚¹ï¼ˆæ’å…¥ï¼‰ï¼Œå¹¶å°†åŸå³è¾¹èŠ‚ç‚¹succå³ç§»ä¸€ä½</span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">link</span><span class="params">(Index&lt;K,V&gt; succ, Index&lt;K,V&gt; newSucc)</span> </span>&#123;</span><br><span class="line">            Node&lt;K,V&gt; n = node;</span><br><span class="line">            newSucc.right = succ;</span><br><span class="line">            <span class="keyword">return</span> n.value != <span class="keyword">null</span> &amp;&amp; casRight(succ, newSucc);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°è¯•CASè¦†ç›–å½“å‰èŠ‚ç‚¹çš„å³è¾¹èŠ‚ç‚¹succã€‚å¦‚æœå·²çŸ¥å·²åˆ é™¤æ­¤èŠ‚ç‚¹ï¼Œåˆ™å¤±è´¥(å¼ºåˆ¶è°ƒç”¨è€…è¿›è¡Œéå†) </span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">unlink</span><span class="params">(Index&lt;K,V&gt; succ)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> node.value != <span class="keyword">null</span> &amp;&amp; casRight(succ, succ.right);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Unsafe mechanics</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> rightOffset;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">                Class&lt;?&gt; k = Index.class;</span><br><span class="line">                rightOffset = UNSAFE.objectFieldOffset</span><br><span class="line">                    (k.getDeclaredField(<span class="string">"right"</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Error(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-get"><a href="#1-2-get" class="headerlink" title="1.2 get"></a><strong>1.2 get</strong></h3><p>é€šè¿‡ <code>get()</code> è·å–é”®å€¼å¯¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> doGet(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> V <span class="title">doGet</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//é”®ä¸å…è®¸ä¸ºnull</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    Comparator&lt;? <span class="keyword">super</span> K&gt; cmp = comparator;</span><br><span class="line">    <span class="comment">//outeré…åˆbreakï¼Œå¤–å±‚å¾ªç¯</span></span><br><span class="line">    outer: <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">//å†…å±‚å¾ªç¯ï¼Œæ‰¾åˆ°æ‰€ç»™é”®çš„å‰é©±èŠ‚ç‚¹bï¼Œå¹¶æ‰¾åˆ°é”®å¯¹åº”èŠ‚ç‚¹n</span></span><br><span class="line">        <span class="keyword">for</span> (Node&lt;K,V&gt; b = findPredecessor(key, cmp), n = b.next;;) &#123;</span><br><span class="line">            Object v; <span class="keyword">int</span> c;</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°èŠ‚ç‚¹å·²ä¸ºnullï¼Œè·³å‡ºouter</span></span><br><span class="line">            <span class="keyword">if</span> (n == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">break</span> outer;</span><br><span class="line">            Node&lt;K,V&gt; f = n.next;</span><br><span class="line">            <span class="comment">//è‹¥æ­¤æ—¶æ•°æ®å·²å‘ç”Ÿæ”¹å˜ï¼Œè·³å‡ºå†…å±‚å¾ªç¯ï¼Œé‡æ–°æŸ¥æ‰¾</span></span><br><span class="line">            <span class="keyword">if</span> (n != b.next)                <span class="comment">// inconsistent read</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//nèŠ‚ç‚¹çš„å€¼å·²ä¸ºnullï¼Œè¯´æ˜å·²è¢«åˆ é™¤ï¼Œè°ƒç”¨helpDeleteåˆ æ‰æ­¤èŠ‚ç‚¹ï¼Œè·³å‡ºå†…å±‚å¾ªç¯ï¼Œé‡æ–°æŸ¥æ‰¾</span></span><br><span class="line">            <span class="keyword">if</span> ((v = n.value) == <span class="keyword">null</span>) &#123;    <span class="comment">// n is deleted</span></span><br><span class="line">                n.helpDelete(b, f);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//bå·²è¢«åˆ é™¤ï¼Œè·³å‡ºå†…å±‚å¾ªç¯ï¼Œé‡æ–°æŸ¥æ‰¾</span></span><br><span class="line">            <span class="keyword">if</span> (b.value == <span class="keyword">null</span> || v == n)  <span class="comment">// b is deleted</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//è‹¥å‘½ä¸­ï¼Œåˆ™è¿”å›value</span></span><br><span class="line">            <span class="keyword">if</span> ((c = cpr(cmp, key, n.key)) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) V vv = (V)v;</span><br><span class="line">                <span class="keyword">return</span> vv;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ‰€ç»™é”®å°äºæ‰¾åˆ°çš„nèŠ‚ç‚¹é”®ï¼Œè·³å‡ºouter</span></span><br><span class="line">            <span class="keyword">if</span> (c &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span> outer;</span><br><span class="line">            <span class="comment">//å¦åˆ™å³ç§»ï¼Œç»§ç»­å¾ªç¯åˆ¤æ–­</span></span><br><span class="line">            b = n;</span><br><span class="line">            n = f;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-put"><a href="#1-3-put" class="headerlink" title="1.3 put"></a><strong>1.3 put</strong></h3><p>é€šè¿‡ <code>put()</code> æ”¾ç½®é”®å€¼å¯¹ï¼Œå‰é¢å’Œ <code>get()</code> æµç¨‹ç±»ä¼¼ï¼Œå½“æ–°å¢èŠ‚ç‚¹æ—¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">return</span> doPut(key, value, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> V <span class="title">doPut</span><span class="params">(K key, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; z;             <span class="comment">// added node</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    Comparator&lt;? <span class="keyword">super</span> K&gt; cmp = comparator;</span><br><span class="line">    outer: <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;K,V&gt; b = findPredecessor(key, cmp), n = b.next;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (n != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Object v; <span class="keyword">int</span> c;</span><br><span class="line">                Node&lt;K,V&gt; f = n.next;</span><br><span class="line">                <span class="keyword">if</span> (n != b.next)               <span class="comment">// inconsistent read</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> ((v = n.value) == <span class="keyword">null</span>) &#123;   <span class="comment">// n is deleted</span></span><br><span class="line">                    n.helpDelete(b, f);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (b.value == <span class="keyword">null</span> || v == n) <span class="comment">// b is deleted</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> ((c = cpr(cmp, key, n.key)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    b = n;</span><br><span class="line">                    n = f;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (onlyIfAbsent || n.casValue(v, value)) &#123;</span><br><span class="line">                        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) V vv = (V)v;</span><br><span class="line">                        <span class="keyword">return</span> vv;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>; <span class="comment">// restart if lost race to replace value</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// else c &lt; 0; fall through</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            z = <span class="keyword">new</span> Node&lt;K,V&gt;(key, value, n);</span><br><span class="line">            <span class="keyword">if</span> (!b.casNext(n, z))</span><br><span class="line">                <span class="keyword">break</span>;         <span class="comment">// restart if lost race to append to b</span></span><br><span class="line">            <span class="keyword">break</span> outer;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éåªè¦†ç›–valueï¼Œæ–°å¢äº†èŠ‚ç‚¹ï¼Œé€šè¿‡éšæœºæ•°ç»´æŒå¹³è¡¡</span></span><br><span class="line">    <span class="keyword">int</span> rnd = ThreadLocalRandom.nextSecondarySeed();</span><br><span class="line">    <span class="keyword">if</span> ((rnd &amp; <span class="number">0x80000001</span>) == <span class="number">0</span>) &#123; <span class="comment">// test highest and lowest bits</span></span><br><span class="line">        <span class="keyword">int</span> level = <span class="number">1</span>, max;</span><br><span class="line">        <span class="keyword">while</span> (((rnd &gt;&gt;&gt;= <span class="number">1</span>) &amp; <span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">            ++level;</span><br><span class="line">        Index&lt;K,V&gt; idx = <span class="keyword">null</span>;</span><br><span class="line">        HeadIndex&lt;K,V&gt; h = head;</span><br><span class="line">        <span class="keyword">if</span> (level &lt;= (max = h.level)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= level; ++i)</span><br><span class="line">                idx = <span class="keyword">new</span> Index&lt;K,V&gt;(z, idx, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">// try to grow by one level</span></span><br><span class="line">            level = max + <span class="number">1</span>; <span class="comment">// hold in array and later pick the one to use</span></span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)Index&lt;K,V&gt;[] idxs =</span><br><span class="line">                (Index&lt;K,V&gt;[])<span class="keyword">new</span> Index&lt;?,?&gt;[level+<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= level; ++i)</span><br><span class="line">                idxs[i] = idx = <span class="keyword">new</span> Index&lt;K,V&gt;(z, idx, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                h = head;</span><br><span class="line">                <span class="keyword">int</span> oldLevel = h.level;</span><br><span class="line">                <span class="keyword">if</span> (level &lt;= oldLevel) <span class="comment">// lost race to add level</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                HeadIndex&lt;K,V&gt; newh = h;</span><br><span class="line">                Node&lt;K,V&gt; oldbase = h.node;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = oldLevel+<span class="number">1</span>; j &lt;= level; ++j)</span><br><span class="line">                    newh = <span class="keyword">new</span> HeadIndex&lt;K,V&gt;(oldbase, newh, idxs[j], j);</span><br><span class="line">                <span class="keyword">if</span> (casHead(h, newh)) &#123;</span><br><span class="line">                    h = newh;</span><br><span class="line">                    idx = idxs[level = oldLevel];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// find insertion points and splice in</span></span><br><span class="line">        splice: <span class="keyword">for</span> (<span class="keyword">int</span> insertionLevel = level;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = h.level;</span><br><span class="line">            <span class="keyword">for</span> (Index&lt;K,V&gt; q = h, r = q.right, t = idx;;) &#123;</span><br><span class="line">                <span class="keyword">if</span> (q == <span class="keyword">null</span> || t == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">break</span> splice;</span><br><span class="line">                <span class="keyword">if</span> (r != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    Node&lt;K,V&gt; n = r.node;</span><br><span class="line">                    <span class="comment">// compare before deletion check avoids needing recheck</span></span><br><span class="line">                    <span class="keyword">int</span> c = cpr(cmp, key, n.key);</span><br><span class="line">                    <span class="keyword">if</span> (n.value == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!q.unlink(r))</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        r = q.right;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        q = r;</span><br><span class="line">                        r = r.right;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (j == insertionLevel) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!q.link(r, t))</span><br><span class="line">                        <span class="keyword">break</span>; <span class="comment">// restart</span></span><br><span class="line">                    <span class="keyword">if</span> (t.node.value == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        findNode(key);</span><br><span class="line">                        <span class="keyword">break</span> splice;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (--insertionLevel == <span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">break</span> splice;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (--j &gt;= insertionLevel &amp;&amp; j &lt; level)</span><br><span class="line">                    t = t.down;</span><br><span class="line">                q = q.down;</span><br><span class="line">                r = q.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-remove"><a href="#1-4-remove" class="headerlink" title="1.4 remove"></a><strong>1.4 remove</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> doRemove(key, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">doRemove</span><span class="params">(Object key, Object value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    Comparator&lt;? <span class="keyword">super</span> K&gt; cmp = comparator;</span><br><span class="line">    outer: <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;K,V&gt; b = findPredecessor(key, cmp), n = b.next;;) &#123;</span><br><span class="line">            Object v; <span class="keyword">int</span> c;</span><br><span class="line">            <span class="keyword">if</span> (n == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">break</span> outer;</span><br><span class="line">            Node&lt;K,V&gt; f = n.next;</span><br><span class="line">            <span class="keyword">if</span> (n != b.next)                    <span class="comment">// inconsistent read</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> ((v = n.value) == <span class="keyword">null</span>) &#123;        <span class="comment">// n is deleted</span></span><br><span class="line">                n.helpDelete(b, f);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (b.value == <span class="keyword">null</span> || v == n)      <span class="comment">// b is deleted</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> ((c = cpr(cmp, key, n.key)) &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span> outer;</span><br><span class="line">            <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                b = n;</span><br><span class="line">                n = f;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value != <span class="keyword">null</span> &amp;&amp; !value.equals(v))</span><br><span class="line">                <span class="keyword">break</span> outer;</span><br><span class="line">            <span class="keyword">if</span> (!n.casValue(v, <span class="keyword">null</span>))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> (!n.appendMarker(f) || !b.casNext(n, f))</span><br><span class="line">                findNode(key);                  <span class="comment">// retry via findNode</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                findPredecessor(key, cmp);      <span class="comment">// clean index</span></span><br><span class="line">                <span class="keyword">if</span> (head.right == <span class="keyword">null</span>)</span><br><span class="line">                    tryReduceLevel();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) V vv = (V)v;</span><br><span class="line">            <span class="keyword">return</span> vv;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-findPredecessor"><a href="#1-5-findPredecessor" class="headerlink" title="1.5 findPredecessor"></a><strong>1.5 findPredecessor</strong></h3><p>é€šè¿‡ <code>findPredecessor()</code> æŸ¥æ‰¾ç»™å®šé”®å’Œæ¯”è¾ƒå™¨çš„å‰é©±èŠ‚ç‚¹ï¼ˆå°ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ä¸€ä¸ªå…¶é”®ä¸¥æ ¼å°äºç»™å®šé”®çš„base-levelèŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„èŠ‚ç‚¹ï¼Œåˆ™è¿”å›base-level headerã€‚</span></span><br><span class="line"><span class="comment"> * é€šè¿‡ä¸æ–­å³ç§»å’Œä¸‹ç§»ç´¢å¼•ï¼Œæ‰¾åˆ°å¯¹åº”é“¾è¡¨èŠ‚ç‚¹ï¼Œè¿‡ç¨‹ä¸­ä¼šunlinkå‘ç°åˆ°çš„å·²åˆ é™¤èŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node&lt;K,V&gt; <span class="title">findPredecessor</span><span class="params">(Object key, Comparator&lt;? <span class="keyword">super</span> K&gt; cmp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(); <span class="comment">// don't postpone errors</span></span><br><span class="line">    <span class="comment">//å¤–å±‚å¾ªç¯</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">//å†…å±‚å¾ªç¯ï¼Œä»å¤´ç´¢å¼•å¼€å§‹</span></span><br><span class="line">        <span class="keyword">for</span> (Index&lt;K,V&gt; q = head, r = q.right, d;;) &#123;</span><br><span class="line">            <span class="comment">//å³è¾¹è¿˜æœ‰èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (r != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Node&lt;K,V&gt; n = r.node;</span><br><span class="line">                K k = n.key;</span><br><span class="line">                <span class="comment">//å³è¾¹ç´¢å¼•å¯¹åº”Nodeæ‰€å­˜å€¼ä¸ºç©ºï¼Œåˆ™åˆ æ‰å®ƒï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">                <span class="keyword">if</span> (n.value == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!q.unlink(r)) <span class="comment">//åˆ æ‰å³è¾¹ç´¢å¼•èŠ‚ç‚¹</span></span><br><span class="line">                        <span class="keyword">break</span>;           <span class="comment">// restart</span></span><br><span class="line">                    r = q.right;         <span class="comment">// æ›´æ–°å³è¾¹ç´¢å¼•èŠ‚ç‚¹ï¼ˆåŸå³è¾¹èŠ‚ç‚¹çš„å³è¾¹èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//è‹¥æ‰€ç»™é”®å¤§äºå³è¾¹èŠ‚ç‚¹çš„é”®ï¼Œåˆ™æŒ‡é’ˆå³ç§»ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">                <span class="keyword">if</span> (cpr(cmp, key, k) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    q = r;</span><br><span class="line">                    r = r.right;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å½“å‰ç´¢å¼•èŠ‚ç‚¹æ²¡æœ‰ä¸‹å±‚ç´¢å¼•ï¼Œç›´æ¥è¿”å›å…¶NodeèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> ((d = q.down) == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> q.node;</span><br><span class="line">            <span class="comment">//å¦åˆ™æŒ‡é’ˆqä¸‹ç§»åˆ°ä¸‹å±‚ç´¢å¼•ï¼ŒåŒæ—¶æ›´æ–°d</span></span><br><span class="line">            q = d;</span><br><span class="line">            r = d.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-6-findNode"><a href="#1-6-findNode" class="headerlink" title="1.6 findNode"></a><strong>1.6 findNode</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns node holding key or null if no such, clearing out any</span></span><br><span class="line"><span class="comment"> * deleted nodes seen along the way.  Repeatedly traverses at</span></span><br><span class="line"><span class="comment"> * base-level looking for key starting at predecessor returned</span></span><br><span class="line"><span class="comment"> * from findPredecessor, processing base-level deletions as</span></span><br><span class="line"><span class="comment"> * encountered. Some callers rely on this side-effect of clearing</span></span><br><span class="line"><span class="comment"> * deleted nodes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Restarts occur, at traversal step centered on node n, if:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   (1) After reading n's next field, n is no longer assumed</span></span><br><span class="line"><span class="comment"> *       predecessor b's current successor, which means that</span></span><br><span class="line"><span class="comment"> *       we don't have a consistent 3-node snapshot and so cannot</span></span><br><span class="line"><span class="comment"> *       unlink any subsequent deleted nodes encountered.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   (2) n's value field is null, indicating n is deleted, in</span></span><br><span class="line"><span class="comment"> *       which case we help out an ongoing structural deletion</span></span><br><span class="line"><span class="comment"> *       before retrying.  Even though there are cases where such</span></span><br><span class="line"><span class="comment"> *       unlinking doesn't require restart, they aren't sorted out</span></span><br><span class="line"><span class="comment"> *       here because doing so would not usually outweigh cost of</span></span><br><span class="line"><span class="comment"> *       restarting.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   (3) n is a marker or n's predecessor's value field is null,</span></span><br><span class="line"><span class="comment"> *       indicating (among other possibilities) that</span></span><br><span class="line"><span class="comment"> *       findPredecessor returned a deleted node. We can't unlink</span></span><br><span class="line"><span class="comment"> *       the node because we don't know its predecessor, so rely</span></span><br><span class="line"><span class="comment"> *       on another call to findPredecessor to notice and return</span></span><br><span class="line"><span class="comment"> *       some earlier predecessor, which it will do. This check is</span></span><br><span class="line"><span class="comment"> *       only strictly needed at beginning of loop, (and the</span></span><br><span class="line"><span class="comment"> *       b.value check isn't strictly needed at all) but is done</span></span><br><span class="line"><span class="comment"> *       each iteration to help avoid contention with other</span></span><br><span class="line"><span class="comment"> *       threads by callers that will fail to be able to change</span></span><br><span class="line"><span class="comment"> *       links, and so will retry anyway.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The traversal loops in doPut, doRemove, and findNear all</span></span><br><span class="line"><span class="comment"> * include the same three kinds of checks. And specialized</span></span><br><span class="line"><span class="comment"> * versions appear in findFirst, and findLast and their</span></span><br><span class="line"><span class="comment"> * variants. They can't easily share code because each uses the</span></span><br><span class="line"><span class="comment"> * reads of fields held in locals occurring in the orders they</span></span><br><span class="line"><span class="comment"> * were performed.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> node holding key, or null if no such</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node&lt;K,V&gt; <span class="title">findNode</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(); <span class="comment">// don't postpone errors</span></span><br><span class="line">    Comparator&lt;? <span class="keyword">super</span> K&gt; cmp = comparator;</span><br><span class="line">    outer: <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;K,V&gt; b = findPredecessor(key, cmp), n = b.next;;) &#123;</span><br><span class="line">            Object v; <span class="keyword">int</span> c;</span><br><span class="line">            <span class="keyword">if</span> (n == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">break</span> outer;</span><br><span class="line">            Node&lt;K,V&gt; f = n.next;</span><br><span class="line">            <span class="keyword">if</span> (n != b.next)                <span class="comment">// inconsistent read</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> ((v = n.value) == <span class="keyword">null</span>) &#123;    <span class="comment">// n is deleted</span></span><br><span class="line">                n.helpDelete(b, f);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (b.value == <span class="keyword">null</span> || v == n)  <span class="comment">// b is deleted</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> ((c = cpr(cmp, key, n.key)) == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> n;</span><br><span class="line">            <span class="keyword">if</span> (c &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span> outer;</span><br><span class="line">            b = n;</span><br><span class="line">            n = f;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— <a href="https://zh.wikipedia.org/wiki/%E8%B7%B3%E8%B7%83%E5%88%97%E8%A1%A8" target="_blank" rel="noopener">è·³è·ƒåˆ—è¡¨</a></p><p>ğŸ”— <a href="https://www.baeldung.com/java-concurrent-skip-list-map" target="_blank" rel="noopener">Guide to the ConcurrentSkipListMap</a></p>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†äº†ä¸‹Javaä¸­ConcurrentSkipListMapçš„å®ç°åŸç†ï¼ŒåŒ…æ‹¬ï¼šæ¦‚è¿°ï¼Œè·³è¡¨ï¼Œæºç è§£æç­‰å†…å®¹ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="java" scheme="http://linyishui.top/tags/java/"/>
    
      <category term="lock" scheme="http://linyishui.top/tags/lock/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•å¤ä¹  (äºŒ) æŸ¥æ‰¾-æ•£åˆ—è¡¨</title>
    <link href="http://linyishui.top/2020070501.html"/>
    <id>http://linyishui.top/2020070501.html</id>
    <published>2020-07-05T09:35:09.000Z</published>
    <updated>2020-10-02T08:18:19.563Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æ•£åˆ—è¡¨"><a href="#æ•£åˆ—è¡¨" class="headerlink" title="æ•£åˆ—è¡¨"></a><strong>æ•£åˆ—è¡¨</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-æ¦‚è¿°"><a href="#ç¬¬ä¸€èŠ‚-æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€èŠ‚ æ¦‚è¿°"></a><strong>ç¬¬ä¸€èŠ‚ æ¦‚è¿°</strong></h2><h3 id="1-1-ä»€ä¹ˆæ˜¯æ•£åˆ—è¡¨"><a href="#1-1-ä»€ä¹ˆæ˜¯æ•£åˆ—è¡¨" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯æ•£åˆ—è¡¨"></a><strong>1.1 ä»€ä¹ˆæ˜¯æ•£åˆ—è¡¨</strong></h3><p><strong>æ•£åˆ—è¡¨</strong>ï¼ˆ<strong>Hash table</strong>ï¼Œä¹Ÿå«<strong>å“ˆå¸Œè¡¨</strong>ï¼‰ï¼Œæ˜¯æ ¹æ®<strong>é”®</strong>ï¼ˆKeyï¼‰è€Œç›´æ¥è®¿é—®åœ¨å†…å­˜å‚¨å­˜ä½ç½®çš„æ•°æ®ç»“æ„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒé€šè¿‡è®¡ç®—ä¸€ä¸ªå…³äºé”®å€¼çš„å‡½æ•°ï¼Œå°†æ‰€éœ€æŸ¥è¯¢çš„æ•°æ®æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œè¿™åŠ å¿«äº†æŸ¥æ‰¾é€Ÿåº¦ã€‚è¿™ä¸ªæ˜ å°„å‡½æ•°ç§°åš<strong>æ•£åˆ—å‡½æ•°</strong>ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„ç§°åš<strong>æ•£åˆ—è¡¨</strong>ã€‚</p><p>é€šè¿‡æ•£åˆ—è¡¨æˆ‘ä»¬å¯ä»¥åœ¨ä¸€èˆ¬åº”ç”¨ä¸­æ‹¥æœ‰ï¼ˆå‡æ‘Šåï¼‰<strong>å¸¸æ•°çº§åˆ«</strong>çš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œã€‚</p><p>æ•£åˆ—è¡¨çš„æŸ¥æ‰¾åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>é€šè¿‡<strong>æ•£åˆ—å‡½æ•°</strong>å°†è¢«æŸ¥æ‰¾çš„é”®è½¬åŒ–ä¸ºæ•°ç»„çš„ä¸€ä¸ªç´¢å¼•ã€‚</li><li>å¤„ç†<strong>ç¢°æ’å†²çª</strong>çš„æƒ…å†µã€‚</li></ol><h3 id="1-2-æ•£åˆ—å‡½æ•°"><a href="#1-2-æ•£åˆ—å‡½æ•°" class="headerlink" title="1.2 æ•£åˆ—å‡½æ•°"></a><strong>1.2 æ•£åˆ—å‡½æ•°</strong></h3><p>æ•£åˆ—å‡½æ•°çš„è®¡ç®—è¿‡ç¨‹å°†é”®è½¬åŒ–ä¸ºæ•°ç»„çš„ç´¢å¼•ï¼šå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªèƒ½ä¿æŒMä¸ªé”®å€¼å¯¹çš„æ•°ç»„ï¼Œå°±éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå°†ä»»æ„é”®è½¬åŒ–ä¸ºè¯¥æ•°ç»„èŒƒå›´å†…çš„ç´¢å¼•ï¼ˆ[0,M-1]ï¼‰çš„<strong>æ•£åˆ—å‡½æ•°</strong>ã€‚</p><p>ä¸¥æ ¼æ¥è¯´ï¼Œ<strong>å¯¹äºæ¯ç§ç±»å‹çš„é”®éƒ½éœ€è¦ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„æ•£åˆ—å‡½æ•°</strong>ã€‚</p><ul><li>æ­£æ•´æ•°ï¼šå¸¸ç”¨<strong>é™¤ç•™ä½™æ•°æ³•</strong>ï¼Œæ•°ç»„å¤§å°ä¸ºç´ æ•°Mï¼Œä»»æ„æ•´æ•°ké™¤ä»¥Mè·å¾—ä½™æ•°ã€‚é€‰ç”¨ç´ æ•°çš„åŸå› æ˜¯é¿å…æ— æ³•å‡åŒ€çš„æ•£åˆ—ã€‚</li><li>æµ®ç‚¹æ•°ï¼š0åˆ°1é—´çš„å®æ•°ï¼Œå¯ä»¥ä¹˜ä»¥Må¹¶å››èˆäº”å…¥å¾—åˆ°ä¸€ä¸ª0è‡³M-1é—´çš„ç´¢å¼•å€¼ã€‚ä½†è¿™ç§æ–¹æ³•ä½¿é”®çš„é«˜ä½å æ›´å¤§ä½œç”¨ï¼Œä½ä½åˆ™æ²¡ä»€ä¹ˆå½±å“ï¼ŒJavaä¸­é‡‡ç”¨çš„ä¿®æ­£æ–¹æ³•æ˜¯<strong>å°†é”®è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶å†ä½¿ç”¨é™¤ç•™ä½™æ•°æ³•</strong>ã€‚</li><li>å­—ç¬¦ä¸²ï¼šä¹Ÿå¯ä»¥ä½¿ç”¨<strong>é™¤ç•™ä½™æ•°æ³•</strong>ï¼ŒJavaä¸­æœ‰ <code>charAt()</code> å‡½æ•°èƒ½è¿”å›ä¸€ä¸ªcharå€¼ï¼Œå³ä¸€ä¸ªéè´Ÿ16ä½æ•´æ•°ã€‚æŠŠå­—ç¬¦ä¸²å½“ä½œä¸€ä¸ªNä½çš„Rè¿›åˆ¶å€¼ï¼Œé™¤ä»¥Må¹¶å–ä½™ã€‚Javaé»˜è®¤ä½¿ç”¨ç±»ä¼¼ <code>Horner</code> æ–¹æ³•çš„ç®—æ³•ï¼Œç”¨Næ¬¡ä¹˜æ³•ã€åŠ æ³•å’Œå–ä½™è®¡ç®—ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ•£åˆ—å€¼ã€‚</li><li>ç»„åˆé”®ï¼šé”®ç±»å‹åŒ…å«å¤šç§ç±»å‹ï¼Œå¦‚å¤šä¸ªæ•´å‹å˜é‡ç»„åˆï¼Œæ¯”å¦‚Dateç±»å‹ï¼Œå¯ä»¥é€šè¿‡ <code>int hash = (((day * R + month) % M ) * R + year) % M</code> æ¥è®¡ç®—æ•£åˆ—å€¼ã€‚åªè¦Rè¶³å¤Ÿå°ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª0è‡³M-1é—´çš„æ•£åˆ—å€¼ã€‚</li></ul><p>Javaä¸ºå¾ˆå¤šå¸¸ç”¨çš„æ•°æ®ç±»å‹é‡å†™äº† <code>hashcode()</code> æ–¹æ³•ï¼ˆå¦‚Stringã€Integerã€Doubleã€Fileå’ŒURLï¼‰ã€‚</p><h3 id="1-3-å“ˆå¸Œç¢°æ’"><a href="#1-3-å“ˆå¸Œç¢°æ’" class="headerlink" title="1.3 å“ˆå¸Œç¢°æ’"></a><strong>1.3 å“ˆå¸Œç¢°æ’</strong></h3><p>å¯¹ä¸åŒçš„å…³é”®å­—å¯èƒ½å¾—åˆ°åŒä¸€æ•£åˆ—åœ°å€ï¼Œå³ k~1~ != k~2~ ï¼Œè€Œ f(k~1~) == f(k~2~) ï¼Œè¿™ç§ç°è±¡ç§°ä¸º<strong>å†²çª</strong>ï¼ˆè‹±è¯­ï¼šCollisionï¼‰ï¼Œä¹Ÿå«å“ˆå¸Œå†²çª/ç¢°æ’ã€‚</p><p>ä¸¤ç§å¤„ç†å“ˆå¸Œç¢°æ’çš„æ–¹æ³•ï¼š</p><ul><li><strong>å¼€æ”¾åœ°å€æ³•</strong>ï¼šå½“é‡åˆ°å“ˆå¸Œå†²çªæ—¶ï¼Œä¾ç…§å¢é‡è§„åˆ™å‘åå–åœ°å€ç›´åˆ°æœ‰æœªè¢«å ç”¨åœ°å€ä¸ºæ­¢ã€‚å®ä¾‹å…¬å¼ï¼š<code>Hash(key) = (Hash(key) + di) mod TableSize</code> ï¼Œdiè¡¨ç¤ºå¢é‡åºåˆ—ï¼Œdiä¸åŒçš„å¢é•¿å¯åˆ†ä¸ºï¼š<ul><li><strong>çº¿æ€§æ¢æµ‹æ³•</strong>ï¼šdi = i++ [1,2,3â€¦â€¦ï¼ŒTableSize-1] ï¼Œå³ä¾æ¬¡æŒ‰åœ°å€åå–ï¼Œå½“ä¸€ä¸ªé”®æ•£åˆ—å€¼è¢«å ç”¨æ—¶ï¼Œç›´æ¥æ£€æŸ¥æ•£åˆ—è¡¨çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼ˆç´¢å¼•å€¼åŠ 1ï¼‰ï¼Œå¼Šç«¯æ˜¯å…ƒç´ ç§¯èšï¼Œæ²¡æœ‰å‡åŒ€çš„åˆ†å¸ƒå…ƒç´ ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ï¼Œå¤šæŸ¥è¯¢äº†è¶Šæ¥è¶Šå¤šçš„æ— å…³é¡¹ã€‚</li><li><strong>äºŒæ¬¡æ¢æµ‹æ³•</strong>ï¼šdi = (i++)^2^ * (di  / |di|) [1,-1,4,-4,9,-9â€¦â€¦] ï¼Œå¼Šç«¯æ˜¯å½“å‰©ä½™ç©ºé—´è¾ƒå°‘æ—¶ï¼Œåœ¨è¿˜æœ‰ç©ºé—´çš„æƒ…å†µä¸‹ä¼šææœ‰å¯èƒ½æ’å…¥å¤±è´¥ã€‚</li><li><strong>åŒæ•£åˆ—æ¢æµ‹æ³•</strong>ï¼šdi = (i++) * Hash2(key) [1H,2H,3Hâ€¦â€¦] ï¼Œ<code>Hash2(key) = p â€“ (key mod p)</code> ï¼Œ<code>Hash2(key) = (key % 97) + 1</code> ï¼Œå…¶ä¸­pä¸ºå°äºè¡¨é•¿çš„ä»»æ„ç´ æ•°ã€‚é€šè¿‡å¦å¤–ä¸€ä¸ªæ•£åˆ—å‡½æ•°æ¥å‡å°‘ç§¯èšé—®é¢˜ï¼Œç¬¬äºŒä¸ªå‡½æ•°éœ€è¦æ’å‡ºæ•£åˆ—å€¼ä¸º0çš„æƒ…å†µï¼Œè®¡ç®—çš„æ•£åˆ—å€¼è¦å’Œè¡¨é•¿äº’ç´ ã€‚</li></ul></li><li><strong>é“¾åœ°å€æ³•/æ‹‰é“¾æ³•</strong>ï¼šå³å°†æ•£åˆ—è¡¨æ¯ä¸€ä¸ªåœ°å€éƒ½å¯¹åº”ä¸€ä¸ªé“¾è¡¨ï¼Œä¼¼ä¹é“¾è¡¨ä¼šå ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œä½†å®é™…ä½¿ç”¨ä¸­ï¼Œå› ä¸ºè£…å¡«å› å­çš„å­˜åœ¨æ‰€ä»¥é“¾åœ°å€æ³•å¯èƒ½ä¼šæ›´èŠ‚çœç©ºé—´ã€‚é€šå¸¸æƒ…å†µä¸‹å“ˆå¸Œè¡¨éƒ½éå¸¸é«˜æ•ˆï¼Œæ’å…¥æˆ–æŸ¥è¯¢éƒ½æ˜¯O(1)ï¼Œæœ€å·®æƒ…å†µæ˜¯é›†ä¸­æ˜ å°„åˆ°å°‘é‡åœ°å€ä¸Šï¼Œå°±ä¼šé€€åŒ–ä¸ºé“¾è¡¨æŸ¥è¯¢ï¼Œè‹¥è¢«äººé€šè¿‡Hashæ”»å‡»çš„æ–¹å¼äº§ç”Ÿå¤§é‡çš„ç¢°æ’ï¼Œä¼šå¯¼è‡´æœ¬æ¥é«˜æ•ˆçš„æœåŠ¡å¤„ç†å˜å¾—å¼‚å¸¸ç¼“æ…¢ï¼Œå¯ä»¥é€šè¿‡é™åˆ¶è¡¨å•æäº¤é•¿åº¦ç­‰æ–¹æ³•æ¥é˜²æ­¢æ­¤ç±»æ”»å‡»ã€‚</li></ul><hr><h2 id="ç¬¬äºŒèŠ‚-å®ç°"><a href="#ç¬¬äºŒèŠ‚-å®ç°" class="headerlink" title="ç¬¬äºŒèŠ‚ å®ç°"></a><strong>ç¬¬äºŒèŠ‚ å®ç°</strong></h2><h3 id="2-1-åŸºäºæ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨"><a href="#2-1-åŸºäºæ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨" class="headerlink" title="2.1 åŸºäºæ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨"></a><strong>2.1 åŸºäºæ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨</strong></h3><p>ä¸‹é¢è¿™ä¸ªç®€å•çš„ç¬¦å·è¡¨ç»´æŠ¤äº†ä¸€æ¡é“¾è¡¨æ•°ç»„ï¼Œé€šè¿‡æ•£åˆ—å‡½æ•°æ¥ä¸ºæ¯ä¸ªé”®é€‰æ‹©é“¾è¡¨ã€‚åˆ›å»º <code>st[]</code> æ—¶éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå› ä¸º Java ä¸å…è®¸æ³›å‹çš„æ•°ç»„ã€‚é»˜è®¤æ„é€ å™¨ä¼šä½¿ç”¨997æ¡é“¾è¡¨ï¼Œæ­¤æ®µç®€å•çš„ä»£ç å·²ç»å¯ä»¥åœ¨å·²çŸ¥ç¬¦å·è¡¨å¤§å°æ—¶å¾—åˆ°ä¸é”™çš„æ€§èƒ½ï¼Œå½“ç„¶è¿˜å¯ä»¥æ·»åŠ <strong>åŠ¨æ€è°ƒæ•´é“¾è¡¨æ•°ç»„çš„å¤§å°</strong>ï¼ˆrehash-å†æ•£åˆ—ï¼‰çš„åŠŸèƒ½ï¼Œä»è€Œèƒ½åœ¨ä»»æ„å¤§å°éƒ½èƒ½ä¿è¯é“¾è¡¨çš„çŸ­å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeparateChainingHashST</span>&lt;<span class="title">Key</span>, <span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> N;<span class="comment">//é”®å€¼å¯¹æ€»æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> M;<span class="comment">//æ•£åˆ—è¡¨å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> SequentialSearchST&lt;Key, Value&gt;[] st;<span class="comment">//å­˜æ”¾é“¾è¡¨å¯¹è±¡çš„æ•°ç»„</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SeparateChainingHashST</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">997</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SeparateChainingHashST</span><span class="params">(<span class="keyword">int</span> M)</span></span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºMæ¡é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">this</span>.M = M;</span><br><span class="line">        st = (SequentialSearchST&lt;Key, Value&gt;[]) <span class="keyword">new</span> SequentialSearchST[M];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; M;i++)</span><br><span class="line">            st[i] = <span class="keyword">new</span> SequentialSearchST();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Key key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key.hashCode() &amp; <span class="number">0x7fffffff</span>) % M;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Value <span class="title">get</span><span class="params">(Key key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Value) st[hash(key)].get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Key key, Value val)</span></span>&#123;</span><br><span class="line">        st[hash(key)].put(key, val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-åŸºäºçº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨"><a href="#2-2-åŸºäºçº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨" class="headerlink" title="2.2 åŸºäºçº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨"></a><strong>2.2 åŸºäºçº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨</strong></h3><p>çº¿æ€§æ¢æµ‹è¡¨<strong>é€šè¿‡ç©ºï¼ˆnullï¼‰æ¥è¡¨ç¤ºä¸€ç°‡é”®çš„ç»“æŸ</strong>ï¼Œå¯¹äºåˆ é™¤æ“ä½œæ¥è¯´ï¼Œç›´æ¥å°†å¯¹åº”å…ƒç´ å€¼è®¾ç½®ä¸º <code>null</code> æ˜¯ä¸è¡Œçš„ï¼Œä¼šå¯¼è‡´æ­¤ä½ç½®ä¹‹åçš„å…ƒç´ æ— æ³•è¢«æŸ¥æ‰¾ã€‚æ­£ç¡®çš„åšæ³•æ˜¯å°†å³ä¾§æ‰€æœ‰é”®é‡æ–°æ’å…¥æ•£åˆ—è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinearProbingHashST</span>&lt;<span class="title">Key</span>, <span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> N;<span class="comment">//é”®å€¼å¯¹æ€»æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> M = <span class="number">16</span>;<span class="comment">//çº¿æ€§æ¢æµ‹è¡¨å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> key[] keys;<span class="comment">//é”®æ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> value[] vals;<span class="comment">//å€¼æ•°ç»„</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinearProbingHashST</span><span class="params">()</span></span>&#123;</span><br><span class="line">        keys = (key[]) <span class="keyword">new</span> Object[M];</span><br><span class="line">        vals = (value[]) <span class="keyword">new</span> Object[M];</span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Key key)</span></span>&#123;<span class="comment">//æ•£åˆ—å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> (key.hashCode() &amp; <span class="number">0x7fffffff</span>) % M;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> cap)</span></span>&#123;<span class="comment">//å†æ•£åˆ—</span></span><br><span class="line">        <span class="comment">//å®ä¾‹åŒ–æ–°çš„çº¿æ€§æ¢æµ‹è¡¨</span></span><br><span class="line">        LinearProbingHashST&lt;Key, Value&gt; t;</span><br><span class="line">        t = <span class="keyword">new</span> LinearProbingHashST&lt;Key, Value&gt;(cap);</span><br><span class="line">        <span class="comment">//å¾ªç¯éå†æ‹·è´æ—§è¡¨å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; M;i++)</span><br><span class="line">        <span class="keyword">if</span>(keys[i] != <span class="keyword">null</span>)</span><br><span class="line">                t.put(keys[i], vals[i]);</span><br><span class="line">        <span class="comment">//æ›´æ–°å½“å‰å¼•ç”¨ï¼Œtä¸ºå±€éƒ¨å˜é‡</span></span><br><span class="line">        keys = t.keys;</span><br><span class="line">        vals = t.vals;</span><br><span class="line">        M = t.M;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Key key, Value val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(N &gt;= M/<span class="number">2</span>) resize(M*<span class="number">2</span>); <span class="comment">//MåŠ å€æ‰©å®¹æ•£åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="comment">//iæ•£åˆ—å¾—åˆ°ç´¢å¼•ï¼Œè‹¥é”®ç›¸ç­‰åˆ™æ›¿æ¢å€¼ï¼Œå¦åˆ™æ£€æŸ¥ä¸‹ä¸€ä¸ªä½ç½®ï¼Œç›´åˆ°å¯¹åº”keyä¸ºç©º</span></span><br><span class="line">        <span class="keyword">for</span>(i = hash(key);keys[i] != <span class="keyword">null</span>;i = (i + <span class="number">1</span>) % M)</span><br><span class="line">            <span class="keyword">if</span>(keys[i].equals(key))&#123;</span><br><span class="line">                vals[i] = val;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//å°†é”®å€¼æ”¾å…¥å½“å‰i</span></span><br><span class="line">        keys[i] = key;</span><br><span class="line">        vals[i] = val;</span><br><span class="line">        N++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Value <span class="title">get</span><span class="params">(Key key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = hash(key);keys[i] != <span class="keyword">null</span>;i = (i + <span class="number">1</span>) % M)</span><br><span class="line">            <span class="keyword">if</span>(keys[i].equals(key))</span><br><span class="line">                <span class="keyword">return</span> vals[i];</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Key key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!contains(key)) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> i = hash(key);</span><br><span class="line">        <span class="comment">//éå†é”®ç°‡ç›´åˆ°æ‰¾åˆ°å¯¹åº”key</span></span><br><span class="line">        <span class="keyword">while</span>(!key.equals(key[i]))</span><br><span class="line">            i = (i + <span class="number">1</span>) % M;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å…ˆå°†å¯¹åº”ç´¢å¼•ç½®ç©º</span></span><br><span class="line">        keys[i] = <span class="keyword">null</span>;</span><br><span class="line">        vals[i] = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//æ›´æ–°iåˆ°ä¸‹ä¸€ä¸ªä½ç½®</span></span><br><span class="line">        i = (i + <span class="number">1</span>) % M;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å¾ªç¯å°†åé¢å…ƒç´ é‡æ–°åŠ å…¥æ•£åˆ—è¡¨ï¼Œç›´åˆ°éå†åˆ°ä¸‹ä¸€ä¸ªç©º</span></span><br><span class="line">        <span class="keyword">while</span>(keys[i] != <span class="keyword">null</span>)&#123;</span><br><span class="line">            Key keyToRedo = keys[i];</span><br><span class="line">            Value valueToRedo = vals[i];</span><br><span class="line">        keys[i] = <span class="keyword">null</span>;</span><br><span class="line">        vals[i] = <span class="keyword">null</span>;</span><br><span class="line">            N--;</span><br><span class="line">            put(keyToRedo, valueToRedo);</span><br><span class="line">            i = (i + <span class="number">1</span>) % M;</span><br><span class="line">        &#125;</span><br><span class="line">        N--;</span><br><span class="line">        <span class="comment">//è‹¥æ­¤æ—¶é”®å€¼å¯¹æ€»æ•°è¾¾åˆ°1/8è¡¨å¤§å°ï¼Œåˆ™å†æ•£åˆ—ç¼©å°</span></span><br><span class="line">        <span class="keyword">if</span>(N &gt; <span class="number">0</span> &amp;&amp; N == M/<span class="number">8</span>) </span><br><span class="line">            resize(M/<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ç¬¬ä¸‰èŠ‚-æŸ¥æ‰¾æ€»ç»“"><a href="#ç¬¬ä¸‰èŠ‚-æŸ¥æ‰¾æ€»ç»“" class="headerlink" title="ç¬¬ä¸‰èŠ‚ æŸ¥æ‰¾æ€»ç»“"></a><strong>ç¬¬ä¸‰èŠ‚ æŸ¥æ‰¾æ€»ç»“</strong></h2><h3 id="3-1-å„ç§ç¬¦å·è¡¨æ¸è¿›æ€§èƒ½çš„æ€»ç»“"><a href="#3-1-å„ç§ç¬¦å·è¡¨æ¸è¿›æ€§èƒ½çš„æ€»ç»“" class="headerlink" title="3.1 å„ç§ç¬¦å·è¡¨æ¸è¿›æ€§èƒ½çš„æ€»ç»“"></a><strong>3.1 å„ç§ç¬¦å·è¡¨æ¸è¿›æ€§èƒ½çš„æ€»ç»“</strong></h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010117.jpg" alt></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šç®—æ³• ç¬¬4ç‰ˆã€‹</p>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†äº†æ•£åˆ—è¡¨çš„ç›¸å…³å†…å®¹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šæ¦‚è¿°ï¼ˆä»€ä¹ˆæ˜¯æ•£åˆ—è¡¨ã€æ•£åˆ—å‡½æ•°ã€å“ˆå¸Œç¢°æ’ï¼‰ï¼Œå®ç°ï¼ˆåŸºäºæ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨ã€åŸºäºçº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨ï¼‰ï¼ŒæŸ¥æ‰¾æ€»ç»“ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="hash" scheme="http://linyishui.top/tags/hash/"/>
    
      <category term="algorithm" scheme="http://linyishui.top/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Bæ ‘å’ŒB+æ ‘</title>
    <link href="http://linyishui.top/2020070201.html"/>
    <id>http://linyishui.top/2020070201.html</id>
    <published>2020-07-02T08:40:04.000Z</published>
    <updated>2020-10-02T08:20:45.628Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Bæ ‘å’ŒB-æ ‘"><a href="#Bæ ‘å’ŒB-æ ‘" class="headerlink" title="Bæ ‘å’ŒB+æ ‘"></a><strong>Bæ ‘å’ŒB+æ ‘</strong></h1><h2 id="ç¬¬ä¸€èŠ‚-Bæ ‘"><a href="#ç¬¬ä¸€èŠ‚-Bæ ‘" class="headerlink" title="ç¬¬ä¸€èŠ‚ Bæ ‘"></a><strong>ç¬¬ä¸€èŠ‚ Bæ ‘</strong></h2><h3 id="1-1-ä»€ä¹ˆæ˜¯Bæ ‘"><a href="#1-1-ä»€ä¹ˆæ˜¯Bæ ‘" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯Bæ ‘"></a><strong>1.1 ä»€ä¹ˆæ˜¯Bæ ‘</strong></h3><p>Bæ ‘æ˜¯ä¸€ç§<strong>è‡ªå¹³è¡¡</strong>çš„æ ‘ï¼Œèƒ½å¤Ÿä¿æŒæ•°æ®<strong>æœ‰åº</strong>ã€‚ä¿è¯æŸ¥æ‰¾æ•°æ®ã€é¡ºåºè®¿é—®ã€æ’å…¥æ•°æ®ã€åˆ é™¤ç­‰æ“ä½œéƒ½èƒ½åœ¨<strong>å¯¹æ•°æ—¶é—´</strong>å†…å®Œæˆã€‚</p><p>Bæ ‘ä¹Ÿå±äºäºŒå‰æŸ¥æ‰¾æ ‘ï¼Œ<strong>ä¸€ä¸ªèŠ‚ç‚¹å…è®¸æ‹¥æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„å­èŠ‚ç‚¹</strong>ã€‚ä¸å¹³è¡¡äºŒå‰æ ‘ä¸åŒçš„æ˜¯ï¼ŒBæ ‘é€‚ç”¨äºè¯»å†™ç›¸å¯¹è¾ƒå¤§çš„æ•°æ®å—çš„å­˜å‚¨ç³»ç»Ÿï¼Œå¦‚ç£ç›˜ã€‚</p><p>Bæ ‘å‡å°‘å®šä½è®°å½•æ—¶æ‰€ç»å†çš„ä¸­é—´è¿‡ç¨‹ï¼Œä»è€ŒåŠ å¿«å­˜å–é€Ÿåº¦ã€‚</p><p><strong>2-3æ ‘ã€çº¢é»‘æ ‘éƒ½æ˜¯å¸¸è§çš„Bæ ‘</strong>ã€‚</p><h3 id="1-2-åº”ç”¨åœºæ™¯"><a href="#1-2-åº”ç”¨åœºæ™¯" class="headerlink" title="1.2 åº”ç”¨åœºæ™¯"></a><strong>1.2 åº”ç”¨åœºæ™¯</strong></h3><p>Bæ ‘è¿™ç§æ•°æ®ç»“æ„å¯ä»¥ç”¨æ¥æè¿°å¤–éƒ¨å­˜å‚¨ã€‚å¸¸è¢«åº”ç”¨åœ¨<strong>æ•°æ®åº“</strong>å’Œ<strong>æ–‡ä»¶ç³»ç»Ÿ</strong>çš„å®ç°ä¸Šã€‚</p><h3 id="1-3-æè¿°"><a href="#1-3-æè¿°" class="headerlink" title="1.3 æè¿°"></a><strong>1.3 æè¿°</strong></h3><p>å‡ ä¸ªå®šä¹‰ï¼š</p><ul><li><strong>å†…éƒ¨èŠ‚ç‚¹</strong>ï¼šå†…éƒ¨èŠ‚ç‚¹æ˜¯é™¤å¶å­èŠ‚ç‚¹å’Œæ ¹èŠ‚ç‚¹ä¹‹å¤–çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚å®ƒä»¬é€šå¸¸è¢«è¡¨ç¤ºä¸ºä¸€ç»„æœ‰åºçš„å…ƒç´ å’ŒæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚</li><li><strong>æ ¹èŠ‚ç‚¹</strong>ï¼šæ ¹èŠ‚ç‚¹æ‹¥æœ‰çš„å­èŠ‚ç‚¹æ•°é‡çš„ä¸Šé™å’Œå†…éƒ¨èŠ‚ç‚¹ç›¸åŒï¼Œä½†æ˜¯æ²¡æœ‰ä¸‹é™ã€‚</li><li><strong>å¶å­èŠ‚ç‚¹</strong>ï¼šå¶å­èŠ‚ç‚¹å¯¹å…ƒç´ çš„æ•°é‡æœ‰ç›¸åŒçš„é™åˆ¶ï¼Œä½†æ˜¯æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œä¹Ÿæ²¡æœ‰æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚</li></ul><p>Bæ ‘çš„å†…éƒ¨ç»“ç‚¹ï¼ˆéå¶å­ï¼‰å¯ä»¥æ‹¥æœ‰å¯å˜æ•°é‡çš„å­ç»“ç‚¹ã€‚å› ä¸ºå­ç»“ç‚¹å¯å˜æ•°é‡è¿™ä¸€ç‰¹æ€§ï¼ŒBæ ‘ä¸éœ€è¦åƒå…¶ä»–å¹³è¡¡äºŒå‰æ ‘é‚£æ ·é¢‘ç¹çš„è¿›è¡Œé‡æ–°ä¿æŒå¹³è¡¡çš„æ“ä½œï¼Œä½†ç›¸åº”çš„ä¹Ÿé€ æˆäº†ç©ºé—´æµªè´¹ï¼ˆä»¥ç©ºé—´æ¢æ—¶é—´ï¼‰ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200601/400px-B-tree.svg.png" alt></p><p>å­èŠ‚ç‚¹æ•°é‡çš„ä¸Šç•Œå’Œä¸‹ç•Œä¾ç‰¹å®šçš„å®ç°è€Œè®¾ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª2-3 Bæ ‘ï¼ˆé€šå¸¸ç®€ç§°<a href="https://zh.wikipedia.org/wiki/2-3æ ‘" target="_blank" rel="noopener">2-3æ ‘</a>ï¼‰ï¼Œæ¯ä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹åªèƒ½æœ‰2æˆ–3ä¸ªå­èŠ‚ç‚¹ã€‚</p><h3 id="1-4-æ“ä½œ"><a href="#1-4-æ“ä½œ" class="headerlink" title="1.4 æ“ä½œ"></a><strong>1.4 æ“ä½œ</strong></h3><h4 id="ï¼ˆ1ï¼‰æœç´¢"><a href="#ï¼ˆ1ï¼‰æœç´¢" class="headerlink" title="ï¼ˆ1ï¼‰æœç´¢"></a><strong>ï¼ˆ1ï¼‰æœç´¢</strong></h4><p>Bæ ‘çš„æœç´¢å’ŒäºŒå‰æœç´¢æ ‘ç±»ä¼¼ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä»ä¸Šåˆ°ä¸‹<strong>é€’å½’çš„éå†æ ‘</strong>ã€‚åœ¨æ¯ä¸€å±‚ä¸Šï¼Œæœç´¢çš„èŒƒå›´è¢«å‡å°åˆ°åŒ…å«äº†æœç´¢å€¼çš„å­æ ‘ä¸­ï¼ˆå·¦å°å³å¤§ï¼‰ã€‚å­æ ‘å€¼çš„èŒƒå›´è¢«å®ƒçš„çˆ¶èŠ‚ç‚¹çš„é”®ç¡®å®šã€‚</p><h4 id="ï¼ˆ2ï¼‰æ’å…¥"><a href="#ï¼ˆ2ï¼‰æ’å…¥" class="headerlink" title="ï¼ˆ2ï¼‰æ’å…¥"></a><strong>ï¼ˆ2ï¼‰æ’å…¥</strong></h4><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200601/B_tree_insertion_example.png" alt></p><p>æ‰€æœ‰çš„æ’å…¥éƒ½ä»æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚è¦æ’å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œé¦–å…ˆæœç´¢è¿™æ£µæ ‘æ‰¾åˆ°æ–°å…ƒç´ åº”è¯¥è¢«æ·»åŠ åˆ°çš„å¯¹åº”èŠ‚ç‚¹ã€‚å°†æ–°å…ƒç´ æ’å…¥åˆ°è¿™ä¸€èŠ‚ç‚¹ä¸­çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœèŠ‚ç‚¹æ‹¥æœ‰çš„å…ƒç´ æ•°é‡å°äºæœ€å¤§å€¼ï¼Œé‚£ä¹ˆæœ‰ç©ºé—´å®¹çº³æ–°çš„å…ƒç´ ã€‚å°†æ–°å…ƒç´ æ’å…¥åˆ°è¿™ä¸€èŠ‚ç‚¹ï¼Œä¸”ä¿æŒèŠ‚ç‚¹ä¸­å…ƒç´ æœ‰åºã€‚</li><li>å¦åˆ™çš„è¯è¿™ä¸€èŠ‚ç‚¹å·²ç»æ»¡äº†ï¼Œå°†å®ƒå¹³å‡åœ°åˆ†è£‚æˆä¸¤ä¸ªèŠ‚ç‚¹ï¼š<ol><li>ä»è¯¥èŠ‚ç‚¹çš„åŸæœ‰å…ƒç´ å’Œæ–°çš„å…ƒç´ ä¸­é€‰æ‹©å‡ºä¸­ä½æ•°ã€‚</li><li>å°äºè¿™ä¸€ä¸­ä½æ•°çš„å…ƒç´ æ”¾å…¥å·¦è¾¹èŠ‚ç‚¹ï¼Œå¤§äºè¿™ä¸€ä¸­ä½æ•°çš„å…ƒç´ æ”¾å…¥å³è¾¹èŠ‚ç‚¹ï¼Œä¸­ä½æ•°ä½œä¸ºåˆ†éš”å€¼ã€‚</li><li>åˆ†éš”å€¼è¢«æ’å…¥åˆ°çˆ¶èŠ‚ç‚¹ä¸­ï¼Œè¿™å¯èƒ½ä¼šé€ æˆçˆ¶èŠ‚ç‚¹åˆ†è£‚ï¼Œåˆ†è£‚çˆ¶èŠ‚ç‚¹æ—¶å¯èƒ½åˆä¼šä½¿å®ƒçš„çˆ¶èŠ‚ç‚¹åˆ†è£‚ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœæ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼ˆè¿™ä¸€èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ï¼‰ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ ¹èŠ‚ç‚¹ï¼ˆå¢åŠ äº†æ ‘çš„é«˜åº¦ï¼‰ã€‚</li></ol></li></ol><h4 id="ï¼ˆ3ï¼‰åˆ é™¤å¶å­èŠ‚ç‚¹ä¸­çš„å…ƒç´ "><a href="#ï¼ˆ3ï¼‰åˆ é™¤å¶å­èŠ‚ç‚¹ä¸­çš„å…ƒç´ " class="headerlink" title="ï¼ˆ3ï¼‰åˆ é™¤å¶å­èŠ‚ç‚¹ä¸­çš„å…ƒç´ "></a><strong>ï¼ˆ3ï¼‰åˆ é™¤å¶å­èŠ‚ç‚¹ä¸­çš„å…ƒç´ </strong></h4><ol><li>æœç´¢è¦åˆ é™¤çš„å…ƒç´ ã€‚</li><li>å¦‚æœå®ƒåœ¨å¶å­èŠ‚ç‚¹ï¼Œå°†å®ƒä»ä¸­åˆ é™¤ã€‚</li><li>å¦‚æœå‘ç”Ÿäº†ä¸‹æº¢å‡ºï¼ŒæŒ‰ç…§åé¢<strong>åˆ é™¤åé‡æ–°å¹³è¡¡</strong>éƒ¨åˆ†çš„æè¿°é‡æ–°è°ƒæ•´æ ‘ã€‚</li></ol><h4 id="ï¼ˆ4ï¼‰åˆ é™¤å†…éƒ¨èŠ‚ç‚¹ä¸­çš„å…ƒç´ "><a href="#ï¼ˆ4ï¼‰åˆ é™¤å†…éƒ¨èŠ‚ç‚¹ä¸­çš„å…ƒç´ " class="headerlink" title="ï¼ˆ4ï¼‰åˆ é™¤å†…éƒ¨èŠ‚ç‚¹ä¸­çš„å…ƒç´ "></a><strong>ï¼ˆ4ï¼‰åˆ é™¤å†…éƒ¨èŠ‚ç‚¹ä¸­çš„å…ƒç´ </strong></h4><p>å†…éƒ¨èŠ‚ç‚¹ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä½œä¸ºåˆ†éš”ä¸¤é¢—å­æ ‘çš„åˆ†éš”å€¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é‡æ–°åˆ’åˆ†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯å·¦å­æ ‘ä¸­æœ€å¤§çš„å…ƒç´ ä»ç„¶å°äºåˆ†éš”å€¼ã€‚åŒæ ·çš„ï¼Œå³å­æ ‘ä¸­æœ€å°çš„å…ƒç´ ä»ç„¶å¤§äºåˆ†éš”å€¼ã€‚è¿™ä¸¤ä¸ªå…ƒç´ éƒ½åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥ä½œä¸ºä¸¤é¢—å­æ ‘çš„æ–°åˆ†éš”å€¼ã€‚ç®—æ³•çš„æè¿°å¦‚ä¸‹ï¼š</p><ol><li>é€‰æ‹©ä¸€ä¸ªæ–°çš„åˆ†éš”ç¬¦ï¼ˆå·¦å­æ ‘ä¸­æœ€å¤§çš„å…ƒç´ æˆ–å³å­æ ‘ä¸­æœ€å°çš„å…ƒç´ ï¼‰ï¼Œå°†å®ƒä»å¶å­èŠ‚ç‚¹ä¸­ç§»é™¤ï¼Œæ›¿æ¢æ‰è¢«åˆ é™¤çš„å…ƒç´ ä½œä¸ºæ–°çš„åˆ†éš”å€¼ã€‚</li><li>å‰ä¸€æ­¥åˆ é™¤äº†ä¸€ä¸ªå¶å­èŠ‚ç‚¹ä¸­çš„å…ƒç´ ã€‚å¦‚æœè¿™ä¸ªå¶å­èŠ‚ç‚¹æ‹¥æœ‰çš„å…ƒç´ æ•°é‡å°äºæœ€ä½è¦æ±‚ï¼Œé‚£ä¹ˆä»è¿™ä¸€å¶å­èŠ‚ç‚¹å¼€å§‹é‡æ–°è¿›è¡Œå¹³è¡¡ã€‚</li></ol><h4 id="ï¼ˆ5ï¼‰åˆ é™¤åçš„é‡æ–°å¹³è¡¡"><a href="#ï¼ˆ5ï¼‰åˆ é™¤åçš„é‡æ–°å¹³è¡¡" class="headerlink" title="ï¼ˆ5ï¼‰åˆ é™¤åçš„é‡æ–°å¹³è¡¡"></a><strong>ï¼ˆ5ï¼‰åˆ é™¤åçš„é‡æ–°å¹³è¡¡</strong></h4><p>é‡æ–°å¹³è¡¡ä»å¶å­èŠ‚ç‚¹å¼€å§‹å‘æ ¹èŠ‚ç‚¹è¿›è¡Œï¼Œç›´åˆ°æ ‘é‡æ–°å¹³è¡¡ï¼ˆè‡ªåº•å‘ä¸Šï¼‰ã€‚å¦‚æœåˆ é™¤èŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªå…ƒç´ ä½¿è¯¥èŠ‚ç‚¹çš„å…ƒç´ æ•°é‡ä½äºæœ€å°å€¼ï¼Œé‚£ä¹ˆä¸€äº›å…ƒç´ å¿…é¡»è¢«é‡æ–°åˆ†é…ã€‚é€šå¸¸ï¼Œç§»åŠ¨ä¸€ä¸ªå…ƒç´ æ•°é‡å¤§äºæœ€å°å€¼çš„å…„å¼ŸèŠ‚ç‚¹ä¸­çš„å…ƒç´ ã€‚å¦‚æœå…„å¼ŸèŠ‚ç‚¹éƒ½æ²¡æœ‰å¤šä½™çš„å…ƒç´ ï¼Œé‚£ä¹ˆç¼ºå°‘å…ƒç´ çš„èŠ‚ç‚¹å°±å¿…é¡»è¦å’Œä»–çš„å…„å¼ŸèŠ‚ç‚¹<strong>åˆå¹¶</strong>ã€‚åˆå¹¶å¯èƒ½å¯¼è‡´çˆ¶èŠ‚ç‚¹å¤±å»äº†åˆ†éš”å€¼ï¼Œæ‰€ä»¥çˆ¶èŠ‚ç‚¹å¯èƒ½ç¼ºå°‘å…ƒç´ å¹¶éœ€è¦é‡æ–°å¹³è¡¡ã€‚åˆå¹¶å’Œé‡æ–°å¹³è¡¡å¯èƒ½ä¸€ç›´è¿›è¡Œåˆ°æ ¹èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹å˜æˆæƒŸä¸€ç¼ºå°‘å…ƒç´ çš„èŠ‚ç‚¹ã€‚é‡æ–°å¹³è¡¡æ ‘çš„ç®—æ³•å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœç¼ºå°‘å…ƒç´ èŠ‚ç‚¹çš„å³å…„å¼Ÿå­˜åœ¨ä¸”æ‹¥æœ‰å¤šä½™çš„å…ƒç´ ï¼Œé‚£ä¹ˆå‘å·¦æ—‹è½¬ï¼š<ol><li>å°†çˆ¶èŠ‚ç‚¹çš„åˆ†éš”å€¼å¤åˆ¶åˆ°ç¼ºå°‘å…ƒç´ èŠ‚ç‚¹çš„æœ€åï¼ˆåˆ†éš”å€¼è¢«ç§»ä¸‹æ¥ï¼›ç¼ºå°‘å…ƒç´ çš„èŠ‚ç‚¹ç°åœ¨æœ‰æœ€å°æ•°é‡çš„å…ƒç´ ï¼‰ã€‚</li><li>å°†çˆ¶èŠ‚ç‚¹çš„åˆ†éš”å€¼æ›¿æ¢ä¸ºå³å…„å¼Ÿçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå³å…„å¼Ÿå¤±å»äº†ä¸€ä¸ªèŠ‚ç‚¹ä½†ä»ç„¶æ‹¥æœ‰æœ€å°æ•°é‡çš„å…ƒç´ ï¼‰ã€‚</li><li>æ ‘åˆé‡æ–°å¹³è¡¡ã€‚</li></ol></li><li>å¦åˆ™ï¼Œå¦‚æœç¼ºå°‘å…ƒç´ èŠ‚ç‚¹çš„å·¦å…„å¼Ÿå­˜åœ¨ä¸”æ‹¥æœ‰å¤šä½™çš„å…ƒç´ ï¼Œé‚£ä¹ˆå‘å³æ—‹è½¬ï¼š<ol><li>å°†çˆ¶èŠ‚ç‚¹çš„åˆ†éš”å€¼å¤åˆ¶åˆ°ç¼ºå°‘å…ƒç´ èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆåˆ†éš”å€¼è¢«ç§»ä¸‹æ¥ï¼›ç¼ºå°‘å…ƒç´ çš„èŠ‚ç‚¹ç°åœ¨æœ‰æœ€å°æ•°é‡çš„å…ƒç´ ï¼‰ã€‚</li><li>å°†çˆ¶èŠ‚ç‚¹çš„åˆ†éš”å€¼æ›¿æ¢ä¸ºå·¦å…„å¼Ÿçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆå·¦å…„å¼Ÿå¤±å»äº†ä¸€ä¸ªèŠ‚ç‚¹ä½†ä»ç„¶æ‹¥æœ‰æœ€å°æ•°é‡çš„å…ƒç´ ï¼‰ã€‚</li><li>æ ‘åˆé‡æ–°å¹³è¡¡ã€‚</li></ol></li><li>å¦åˆ™ï¼Œå¦‚æœå®ƒçš„ä¸¤ä¸ªç›´æ¥å…„å¼ŸèŠ‚ç‚¹éƒ½åªæœ‰æœ€å°æ•°é‡çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°†å®ƒä¸ä¸€ä¸ªç›´æ¥å…„å¼ŸèŠ‚ç‚¹ä»¥åŠçˆ¶èŠ‚ç‚¹ä¸­å®ƒä»¬çš„åˆ†éš”å€¼åˆå¹¶ï¼š<ol><li>å°†åˆ†éš”å€¼å¤åˆ¶åˆ°å·¦è¾¹çš„èŠ‚ç‚¹ï¼ˆå·¦è¾¹çš„èŠ‚ç‚¹å¯ä»¥æ˜¯ç¼ºå°‘å…ƒç´ çš„èŠ‚ç‚¹æˆ–è€…æ‹¥æœ‰æœ€å°æ•°é‡å…ƒç´ çš„å…„å¼ŸèŠ‚ç‚¹ï¼‰ã€‚</li><li>å°†å³è¾¹èŠ‚ç‚¹ä¸­æ‰€æœ‰çš„å…ƒç´ ç§»åŠ¨åˆ°å·¦è¾¹èŠ‚ç‚¹ï¼ˆå·¦è¾¹èŠ‚ç‚¹ç°åœ¨æ‹¥æœ‰æœ€å¤§æ•°é‡çš„å…ƒç´ ï¼Œå³è¾¹èŠ‚ç‚¹ä¸ºç©ºï¼‰ã€‚</li><li>å°†çˆ¶èŠ‚ç‚¹ä¸­çš„åˆ†éš”å€¼å’Œç©ºçš„å³å­æ ‘ç§»é™¤ï¼ˆçˆ¶èŠ‚ç‚¹å¤±å»äº†ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚<ul><li>å¦‚æœçˆ¶èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹å¹¶ä¸”æ²¡æœ‰å…ƒç´ äº†ï¼Œé‚£ä¹ˆé‡Šæ”¾å®ƒå¹¶ä¸”è®©åˆå¹¶ä¹‹åçš„èŠ‚ç‚¹æˆä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ï¼ˆæ ‘çš„æ·±åº¦å‡å°ï¼‰ã€‚</li><li>å¦åˆ™ï¼Œå¦‚æœçˆ¶èŠ‚ç‚¹çš„å…ƒç´ æ•°é‡å°äºæœ€å°å€¼ï¼Œé‡æ–°å¹³è¡¡çˆ¶èŠ‚ç‚¹ã€‚</li></ul></li></ol></li></ul><h3 id="1-5-å˜ä½“"><a href="#1-5-å˜ä½“" class="headerlink" title="1.5 å˜ä½“"></a><strong>1.5 å˜ä½“</strong></h3><p>Bæ ‘åœ¨å†…éƒ¨ç»“ç‚¹ä¸Šå­˜å‚¨é”®å€¼ï¼Œä½†ä¸éœ€è¦åœ¨å¶å­ç»“ç‚¹ä¸Šå­˜å‚¨è¿™äº›é”®å€¼çš„è®°å½•ã€‚</p><ul><li><strong>B+æ ‘</strong>ï¼š<ul><li>è¿™äº›é”®å€¼çš„æ‹·è´è¢«å­˜å‚¨åœ¨å†…éƒ¨ç»“ç‚¹ï¼›</li><li>é”®å€¼å’Œè®°å½•å­˜å‚¨åœ¨å¶å­ç»“ç‚¹ï¼›</li><li>ä¸€ä¸ªå¶å­ç»“ç‚¹å¯ä»¥åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å¦ä¸€ä¸ªå¶å­ç»“ç‚¹ä»¥åŠ é€Ÿé¡ºåºå­˜å–ã€‚</li></ul></li><li><strong>B*æ ‘</strong>ï¼šåˆ†æ”¯å‡ºæ›´å¤šçš„å†…éƒ¨é‚»å±…èŠ‚ç‚¹ä»¥ä¿æŒå†…éƒ¨èŠ‚ç‚¹æ›´å¯†é›†åœ°å¡«å……ã€‚æ­¤å˜ä½“è¦æ±‚éæ ¹èŠ‚ç‚¹è‡³å°‘2/3å¡«å……ï¼Œè€Œä¸æ˜¯1/2ã€‚ä¸ºäº†ç»´æŒè¿™æ ·çš„ç»“æ„ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹å¡«æ»¡ä¹‹åå°†ä¸ä¼šå†ç«‹å³åˆ†å‰²èŠ‚ç‚¹ï¼Œè€Œæ˜¯å°†å®ƒçš„é”®å€¼ä¸ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å…±äº«ã€‚å½“ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å¡«æ»¡ä¹‹åï¼Œåˆ†å‰²æˆ3ä¸ªèŠ‚ç‚¹ã€‚</li><li>è®¡æ•°Bæ ‘å­˜å‚¨ï¼Œæ¯ä¸€æ ‘éƒ½å¸¦æœ‰ä¸€ä¸ªæŒ‡é’ˆå’Œå…¶æŒ‡å‘å­æ ‘çš„èŠ‚ç‚¹æ•°ç›®ã€‚è¿™å°±å…è®¸äº†ä»¥é”®å€¼ä¸ºåºå¿«é€ŸæŸ¥æ‰¾ç¬¬Nç¬”è®°å½•ï¼Œæˆ–æ˜¯ç»Ÿè®¡2ç¬”è®°å½•ä¹‹é—´çš„è®°å½•æ•°ç›®ï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¤šç›¸å…³çš„æ“ä½œã€‚</li></ul><h3 id="1-6-Bæ ‘ä¸å¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«"><a href="#1-6-Bæ ‘ä¸å¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«" class="headerlink" title="1.6 Bæ ‘ä¸å¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«"></a><strong>1.6 Bæ ‘ä¸å¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«</strong></h3><p>å¹³è¡¡äºŒå‰æ ‘é€šå¸¸æ˜¯æŒ‡æŸ¥æ‰¾è·¯å¾„åªæœ‰ä¸¤ç§ï¼ˆå³åªæœ‰äºŒå‰ï¼‰ï¼Œè€ŒBæ ‘åˆ™ä¸ä»…ä»…äºŒå‰ï¼Œæ‰€ä»¥ä¹Ÿå«<strong>å¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘</strong>ã€‚</p><p>Bæ ‘ç›¸æ¯”å¹³è¡¡äºŒå‰æ ‘åœ¨æ¯ä¸ªç»“ç‚¹æ‰€åŒ…å«çš„å†…å®¹æ›´å¤šï¼Œåœ¨åº”ç”¨åˆ°æ•°æ®åº“ä¸­çš„æ—¶å€™ï¼Œå……åˆ†åˆ©ç”¨äº†ç£ç›˜å—çš„åŸç†ï¼ˆç£ç›˜æ•°æ®å­˜å‚¨æ˜¯é‡‡ç”¨å—çš„å½¢å¼å­˜å‚¨çš„ï¼Œæ¯ä¸ªå—çš„å¤§å°ä¸º4Kï¼Œæ¯æ¬¡IOè¿›è¡Œæ•°æ®è¯»å–æ—¶ï¼ŒåŒä¸€ä¸ªç£ç›˜å—çš„æ•°æ®å¯ä»¥ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼‰æŠŠç»“ç‚¹å¤§å°é™åˆ¶å’Œå……åˆ†ä½¿ç”¨åœ¨ç£ç›˜å—å¤§å°èŒƒå›´ã€‚æ‰€ä»¥æ ‘çš„ç»“ç‚¹èƒ½åŒ…å«æ›´å¤šçš„å†…å®¹åï¼Œæ ‘çš„å±‚çº§æ¯”åŸæ¥çš„äºŒå‰æ ‘å°‘äº†ï¼Œå°±å¯ä»¥å‡å°‘æ•°æ®æŸ¥æ‰¾çš„æ¬¡æ•°å’Œå¤æ‚åº¦ã€‚</p><hr><h2 id="ç¬¬äºŒèŠ‚-B-æ ‘"><a href="#ç¬¬äºŒèŠ‚-B-æ ‘" class="headerlink" title="ç¬¬äºŒèŠ‚ B+æ ‘"></a><strong>ç¬¬äºŒèŠ‚ B+æ ‘</strong></h2><h3 id="2-1-ä»€ä¹ˆæ˜¯B-æ ‘"><a href="#2-1-ä»€ä¹ˆæ˜¯B-æ ‘" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯B+æ ‘"></a><strong>2.1 ä»€ä¹ˆæ˜¯B+æ ‘</strong></h3><p><strong>B+ æ ‘</strong>æ˜¯ä¸€ç§æ ‘æ•°æ®ç»“æ„ï¼Œé€šå¸¸ç”¨äºæ•°æ®åº“å’Œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚B+ æ ‘çš„ç‰¹ç‚¹æ˜¯<strong>èƒ½å¤Ÿä¿æŒæ•°æ®ç¨³å®šæœ‰åº</strong>ï¼Œå…¶<strong>æ’å…¥ä¸ä¿®æ”¹æ‹¥æœ‰è¾ƒç¨³å®šçš„å¯¹æ•°æ—¶é—´å¤æ‚åº¦</strong>ã€‚B+ æ ‘å…ƒç´ <strong>è‡ªåº•å‘ä¸Šæ’å…¥</strong>ï¼Œè¿™ä¸äºŒå‰æ ‘æ°å¥½ç›¸åã€‚</p><p>B+ æ ‘åœ¨èŠ‚ç‚¹è®¿é—®æ—¶é—´è¿œè¿œè¶…è¿‡èŠ‚ç‚¹å†…éƒ¨è®¿é—®æ—¶é—´çš„æ—¶å€™ï¼Œæ¯”å…¶ä»–å¯ä½œä¸ºæ›¿ä»£çš„å®ç°æœ‰ç€å®åœ¨çš„ä¼˜åŠ¿ã€‚è¿™é€šå¸¸åœ¨å¤šæ•°èŠ‚ç‚¹åœ¨æ¬¡çº§å­˜å‚¨æ¯”å¦‚ç¡¬ç›˜ä¸­çš„æ—¶å€™å‡ºç°ã€‚<strong>é€šè¿‡æœ€å¤§åŒ–åœ¨æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹å†…çš„å­èŠ‚ç‚¹çš„æ•°ç›®å‡å°‘æ ‘çš„é«˜åº¦ï¼Œå¹³è¡¡æ“ä½œä¸ç»å¸¸å‘ç”Ÿï¼Œè€Œä¸”æ•ˆç‡å¢åŠ äº†</strong>ã€‚é€šå¸¸éœ€è¦æ¯ä¸ªèŠ‚ç‚¹åœ¨æ¬¡çº§å­˜å‚¨ä¸­å æ®å®Œæ•´çš„ç£ç›˜å—æˆ–è¿‘ä¼¼çš„å¤§å°ã€‚</p><p>B+ èƒŒåçš„è®¾è®¡æ€æƒ³æ˜¯<strong>å†…éƒ¨èŠ‚ç‚¹å¯ä»¥æœ‰åœ¨é¢„å®šèŒƒå›´å†…çš„å¯å˜é‡ç›®çš„å­èŠ‚ç‚¹</strong>ã€‚å› æ­¤ï¼ŒB+ æ ‘ä¸éœ€è¦åƒå…¶ä»–è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘é‚£æ ·ç»å¸¸çš„é‡æ–°å¹³è¡¡ã€‚å¯¹äºç‰¹å®šçš„å®ç°åœ¨å­èŠ‚ç‚¹æ•°ç›®ä¸Šçš„ä½å’Œé«˜è¾¹ç•Œæ˜¯å›ºå®šçš„ã€‚</p><p>B+ æ ‘çš„åˆ›é€ è€… <code>Rudolf Bayer</code> æ²¡æœ‰è§£é‡Š <code>B</code> ä»£è¡¨ä»€ä¹ˆã€‚æœ€å¸¸è§çš„è§‚ç‚¹æ˜¯ <code>B</code> ä»£è¡¨<strong>å¹³è¡¡</strong>(balanced)ï¼Œå› ä¸ºæ‰€æœ‰çš„å¶å­èŠ‚ç‚¹åœ¨æ ‘ä¸­éƒ½åœ¨ç›¸åŒçš„çº§åˆ«ä¸Šã€‚<code>B</code> ä¹Ÿå¯èƒ½ä»£è¡¨ <code>Bayer</code>ï¼Œæˆ–è€…æ˜¯<a href="https://zh.wikipedia.org/wiki/æ³¢éŸ³" target="_blank" rel="noopener">æ³¢éŸ³</a>ï¼ˆBoeingï¼‰ï¼Œå› ä¸ºä»–æ›¾ç»å·¥ä½œäº<em>æ³¢éŸ³ç§‘å­¦ç ”ç©¶å®éªŒå®¤</em>ã€‚</p><p>å¦‚ä¸‹å›¾ï¼ŒæŠŠé”® <code>1-7</code> è¿æ¥åˆ°å€¼ <code>d1-d7</code> çš„B+æ ‘ã€‚é“¾è¡¨ï¼ˆçº¢è‰²ï¼‰ç”¨äºå¿«é€Ÿé¡ºåºéå†å¶å­èŠ‚ç‚¹ã€‚æ ‘çš„åˆ†å‰å› å­ <code>b=4</code> ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200601/400px-Bplustree.png" alt></p><h3 id="2-2-èŠ‚ç‚¹ç»“æ„"><a href="#2-2-èŠ‚ç‚¹ç»“æ„" class="headerlink" title="2.2 èŠ‚ç‚¹ç»“æ„"></a><strong>2.2 èŠ‚ç‚¹ç»“æ„</strong></h3><p>åœ¨B+æ ‘ä¸­çš„èŠ‚ç‚¹é€šå¸¸è¢«è¡¨ç¤ºä¸ºä¸€ç»„æœ‰åºçš„å…ƒç´ å’Œå­æŒ‡é’ˆã€‚å¦‚æœæ­¤B+æ ‘çš„é˜¶æ•°æ˜¯ <code>m</code> ï¼Œåˆ™é™¤äº†æ ¹ä¹‹å¤–çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«æœ€å°‘ <code>m/2</code> ä¸ªå…ƒç´ æœ€å¤š <code>m-1</code> ä¸ªå…ƒç´ ï¼Œå¯¹äºä»»æ„çš„ç»“ç‚¹æœ‰æœ€å¤š <code>m</code> ä¸ªå­æŒ‡é’ˆã€‚å¯¹äºæ‰€æœ‰å†…éƒ¨èŠ‚ç‚¹ï¼Œå­æŒ‡é’ˆçš„æ•°ç›®æ€»æ˜¯æ¯”å…ƒç´ çš„æ•°ç›®å¤šä¸€ä¸ªã€‚æ‰€æœ‰å¶å­éƒ½åœ¨ç›¸åŒçš„é«˜åº¦ä¸Šï¼Œå¶ç»“ç‚¹æœ¬èº«æŒ‰å…³é”®å­—å¤§å°ä»å°åˆ°å¤§é“¾æ¥ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œéå¶å­ç»“ç‚¹çš„å…³é”®å­—ä¸ä¿å­˜æ•°æ®ï¼Œåªç”¨æ¥ç´¢å¼•ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ã€‚æ‰€æœ‰çš„å¶å­ç»“ç‚¹ä¸­åŒ…å«äº†å…¨éƒ¨å…³é”®å­—çš„ä¿¡æ¯ï¼ŒåŠæŒ‡å‘å«è¿™äº›å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œä¸”å¶å­ç»“ç‚¹æœ¬èº«ä¾å…³é”®å­—çš„å¤§å°è‡ªå°è€Œå¤§é¡ºåºé“¾æ¥ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010115.png" alt></p><h3 id="2-3-ç®—æ³•"><a href="#2-3-ç®—æ³•" class="headerlink" title="2.3 ç®—æ³•"></a><strong>2.3 ç®—æ³•</strong></h3><h4 id="2-3-1-æŸ¥æ‰¾"><a href="#2-3-1-æŸ¥æ‰¾" class="headerlink" title="2.3.1 æŸ¥æ‰¾"></a><strong>2.3.1 æŸ¥æ‰¾</strong></h4><p>æŸ¥æ‰¾ä»¥å…¸å‹çš„æ–¹å¼è¿›è¡Œï¼Œç±»ä¼¼äº<a href="https://zh.wikipedia.org/wiki/äºŒå‰æŸ¥æ‰¾æ ‘" target="_blank" rel="noopener">äºŒå‰æŸ¥æ‰¾æ ‘</a>ã€‚èµ·å§‹äºæ ¹èŠ‚ç‚¹ï¼Œè‡ªé¡¶å‘ä¸‹éå†æ ‘ï¼Œé€‰æ‹©å…¶åˆ†ç¦»å€¼åœ¨è¦æŸ¥æ‰¾å€¼çš„ä»»æ„ä¸€è¾¹çš„å­æŒ‡é’ˆã€‚åœ¨èŠ‚ç‚¹å†…éƒ¨å…¸å‹çš„ä½¿ç”¨æ˜¯<a href="https://zh.wikipedia.org/wiki/äºŒåˆ†æŸ¥æ‰¾" target="_blank" rel="noopener">äºŒåˆ†æŸ¥æ‰¾</a>æ¥ç¡®å®šè¿™ä¸ªä½ç½®ã€‚</p><h4 id="2-3-2-æ’å…¥"><a href="#2-3-2-æ’å…¥" class="headerlink" title="2.3.2 æ’å…¥"></a><strong>2.3.2 æ’å…¥</strong></h4><p>èŠ‚ç‚¹è¦å¤„äºè¿è§„çŠ¶æ€ï¼Œå®ƒå¿…é¡»åŒ…å«åœ¨å¯æ¥å—èŒƒå›´ä¹‹å¤–æ•°ç›®çš„å…ƒç´ ã€‚</p><ol><li>é¦–å…ˆï¼ŒæŸ¥æ‰¾è¦æ’å…¥å…¶ä¸­çš„èŠ‚ç‚¹çš„ä½ç½®ã€‚æ¥ç€æŠŠå€¼æ’å…¥è¿™ä¸ªèŠ‚ç‚¹ä¸­ã€‚</li><li>å¦‚æœæ²¡æœ‰èŠ‚ç‚¹å¤„äºè¿è§„çŠ¶æ€åˆ™å¤„ç†ç»“æŸã€‚</li><li>å¦‚æœæŸä¸ªèŠ‚ç‚¹æœ‰è¿‡å¤šå…ƒç´ ï¼Œåˆ™æŠŠå®ƒåˆ†è£‚ä¸ºä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªéƒ½æœ‰æœ€å°æ•°ç›®çš„å…ƒç´ ã€‚åœ¨æ ‘ä¸Šé€’å½’å‘ä¸Šç»§ç»­è¿™ä¸ªå¤„ç†ç›´åˆ°åˆ°è¾¾æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹è¢«åˆ†è£‚ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ ¹èŠ‚ç‚¹ã€‚ä¸ºäº†ä½¿å®ƒå·¥ä½œï¼Œå…ƒç´ çš„æœ€å°å’Œæœ€å¤§æ•°ç›®å…¸å‹çš„å¿…é¡»é€‰æ‹©ä¸ºä½¿æœ€å°æ•°ä¸å°äºæœ€å¤§æ•°çš„ä¸€åŠã€‚</li></ol><h4 id="2-3-3-åˆ é™¤"><a href="#2-3-3-åˆ é™¤" class="headerlink" title="2.3.3 åˆ é™¤"></a><strong>2.3.3 åˆ é™¤</strong></h4><ol><li>é¦–å…ˆï¼ŒæŸ¥æ‰¾è¦åˆ é™¤çš„å€¼ã€‚æ¥ç€ä»åŒ…å«å®ƒçš„èŠ‚ç‚¹ä¸­åˆ é™¤è¿™ä¸ªå€¼ã€‚</li><li>å¦‚æœæ²¡æœ‰èŠ‚ç‚¹å¤„äºè¿è§„çŠ¶æ€åˆ™å¤„ç†ç»“æŸã€‚</li><li>å¦‚æœèŠ‚ç‚¹å¤„äºè¿è§„çŠ¶æ€åˆ™æœ‰ä¸¤ç§å¯èƒ½æƒ…å†µï¼š<ol><li>å®ƒçš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå°±æ˜¯åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¯ä»¥æŠŠä¸€ä¸ªæˆ–å¤šä¸ªå®ƒçš„å­èŠ‚ç‚¹è½¬ç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼Œè€ŒæŠŠå®ƒè¿”å›ä¸ºåˆæ³•çŠ¶æ€ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œåœ¨æ›´æ”¹çˆ¶èŠ‚ç‚¹å’Œä¸¤ä¸ªå…„å¼ŸèŠ‚ç‚¹çš„åˆ†ç¦»å€¼ä¹‹åå¤„ç†ç»“æŸã€‚</li><li>å®ƒçš„å…„å¼ŸèŠ‚ç‚¹ç”±äºå¤„åœ¨ä½è¾¹ç•Œä¸Šè€Œæ²¡æœ‰é¢å¤–çš„å­èŠ‚ç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹æŠŠä¸¤ä¸ªå…„å¼ŸèŠ‚ç‚¹åˆå¹¶åˆ°ä¸€ä¸ªå•ä¸€çš„èŠ‚ç‚¹ä¸­ï¼Œè€Œä¸”æˆ‘ä»¬é€’å½’åˆ°çˆ¶èŠ‚ç‚¹ä¸Šï¼Œå› ä¸ºå®ƒè¢«åˆ é™¤äº†ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚æŒç»­è¿™ä¸ªå¤„ç†ç›´åˆ°å½“å‰èŠ‚ç‚¹æ˜¯åˆæ³•çŠ¶æ€æˆ–è€…åˆ°è¾¾æ ¹èŠ‚ç‚¹ï¼Œåœ¨å…¶ä¸Šæ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹è¢«åˆå¹¶è€Œä¸”åˆå¹¶åçš„èŠ‚ç‚¹æˆä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ã€‚</li></ol></li></ol><h3 id="2-4-å®ä¾‹è¯´æ˜"><a href="#2-4-å®ä¾‹è¯´æ˜" class="headerlink" title="2.4 å®ä¾‹è¯´æ˜"></a><strong>2.4 å®ä¾‹è¯´æ˜</strong></h3><p>å‡è®¾B+æ ‘ç»“ç‚¹æœ€å¤šå®¹çº³å­˜æ”¾3ä¸ªé”®å’Œ4ä¸ªæŒ‡é’ˆï¼Œ <code>m = 3</code> ä¸ºå¥‡æ•°ï¼Œ<code>d = 1</code> ï¼Œå¶å­ç»“ç‚¹è‡³å°‘2ä¸ªæ¡ç›®ï¼ˆd + 1ï¼‰ï¼Œéå¶å­ç»“ç‚¹è‡³å°‘2ä¸ªæŒ‡é’ˆï¼ˆd + 1ï¼‰ï¼Œ1ä¸ªæ¡ç›®ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010101.png" alt></p><p>é¦–å…ˆæ’å…¥1ï¼šåˆ¤æ–­æ ¹ç»“ç‚¹ä¸ºç©ºç›´æ¥æ”¾å…¥ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010102.png" alt></p><p>æ¥ç€è¿ç»­æ’å…¥3ã€5ï¼šæ ¹ç»“ç‚¹æœªæ»¡ï¼Œè¿ç»­æ”¾å…¥ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010103.png" alt></p><p>æ¥ç€æ’å…¥7ï¼šæ­¤æ—¶æ ¹ç»“ç‚¹è¾¾åˆ°maxï¼Œåˆ¤æ–­éœ€è¦åˆ†è£‚ï¼š<strong>å½“èŠ‚ç‚¹å…ƒç´ æ•°é‡å¤§äºm-1çš„æ—¶å€™ï¼Œä»ä¸­é—´å…ƒç´ åˆ†è£‚æˆå·¦å³ä¸¤éƒ¨åˆ†ï¼Œä¸­é—´å…ƒç´ åˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹å½“åšç´¢å¼•å­˜å‚¨ï¼Œå½“ç„¶æœ¬èº«ä¸­é—´å…ƒç´ è¿˜æ˜¯åˆ†è£‚å³è¾¹è¿™ä¸€éƒ¨åˆ†çš„ï¼Œä¿è¯å·¦å°å³å¤§çš„è§„åˆ™</strong>ã€‚æ‰€ä»¥åˆ†è£‚æˆä¸¤ä¸ªå­ç»“ç‚¹ï¼Œ1å’Œ3ä¸‹æ²‰åˆ°å·¦è¾¹ï¼Œ5å’Œ7ä¸‹æ²‰åˆ°å³è¾¹ï¼Œå†…éƒ¨ç»“ç‚¹åªä¿å­˜ç´¢å¼•ï¼Œæœ€åº•å±‚å¶å­ç»“ç‚¹è¿æˆæœ‰åºé“¾è¡¨ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010104.png" alt></p><p>æ¥ç€æ’å…¥9ï¼šæ‰¾åˆ°ä½ç½®ï¼Œè¿˜æœ‰ç©ºé—´ï¼Œç›´æ¥æ”¾å…¥ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010105.png" alt></p><p>æ¥ç€æ’å…¥2ï¼šå¦‚ä¸Šæ”¾å…¥ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010106.png" alt></p><p>æ¥ç€æ’å…¥4ï¼šæ­¤æ—¶å¯¹åº”å¶å­ç»“ç‚¹å·²æ”¾æ»¡ï¼Œéœ€è¦å†åº¦åˆ†è£‚æˆä¸¤ä¸ªç»“ç‚¹ï¼Œ1å’Œ2ä¿ç•™åœ¨å·¦ç»“ç‚¹ï¼Œ3å’Œ4åˆ™ç§»åˆ°æ–°ç»“ç‚¹ï¼Œå¹¶å°†æ–°ç»“ç‚¹é¦–ä¸ªå…ƒç´ æŒ‡å‘çˆ¶ç»“ç‚¹ï¼ˆæ­¤æ—¶çˆ¶ç»“ç‚¹ä»æœ‰ç©ºé—´ï¼‰ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010107.png" alt></p><p>æ¥ç€æ’å…¥6ï¼šå¯¹åº”å¶å­ç»“ç‚¹åŒæ ·å·²æ»¡ï¼Œç»§ç»­ç›¸åŒåˆ†è£‚æ“ä½œï¼Œå¹¶å°†æ–°ç»“ç‚¹é¦–ä¸ªå…ƒç´ æŒ‡å‘çˆ¶ç»“ç‚¹ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010108.png" alt></p><p>æ¥ç€æ’å…¥8ï¼šä»æœ‰ç©ºé—´ï¼Œç›´æ¥æ”¾å…¥ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010109.png" alt></p><p>æ¥ç€æ’å…¥10ï¼šæ­¤æ—¶å¯¹åº”å¶å­ç»“ç‚¹å·²æ»¡ï¼Œæ‰€ä»¥å…ˆåˆ†è£‚å¼€ï¼Œ7å’Œ8ä¿ç•™ï¼Œ9å’Œ10ç”Ÿæˆæ–°å¶å­ç»“ç‚¹ï¼Œå°†æ–°å¶å­ç»“ç‚¹é¦–ä¸ªå…ƒç´ æŒ‡å‘çˆ¶ç»“ç‚¹ï¼Œæ­¤æ—¶çˆ¶ç»“ç‚¹è¶…è¿‡ä¸Šé™ï¼ˆå·²æ˜¯æ ¹ç»“ç‚¹ï¼Œé€’å½’å‘ä¸Šåˆ†è£‚ï¼Œç›´åˆ°æ ¹ç»“ç‚¹åˆ†è£‚ï¼Œå¢åŠ é«˜åº¦ï¼‰ï¼Œæ‰€ä»¥æ ¹ç»“ç‚¹åˆ†è£‚ï¼Œä¸­é—´å…ƒç´ 7æˆä¸ºæ–°çš„æ ¹ç»“ç‚¹ï¼Œå·¦å°å³å¤§ï¼Œæ–°çš„ç»“æ„ä»æ˜¯ç¨³å®šçš„ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010110.png" alt></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹B+æ ‘çš„åˆ é™¤æ“ä½œï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010111.png" alt></p><p>é¦–å…ˆåˆ é™¤9ï¼šæŸ¥æ‰¾9æ‰€åœ¨ç»“ç‚¹ï¼ŒæŠŠå®ƒåˆ é™¤ï¼Œç„¶ååˆ¤æ–­æ­¤æ—¶æ ‘çŠ¶æ€ï¼Œå‘ç°å¶å­ç»“ç‚¹è¿è§„ï¼šå¶å­ç»“ç‚¹è‡³å°‘2ä¸ªæ¡ç›®ï¼ˆd + 1ï¼‰ï¼Œéå¶å­ç»“ç‚¹è‡³å°‘2ä¸ªæŒ‡é’ˆï¼ˆd + 1ï¼‰ï¼Œ1ä¸ªæ¡ç›®ã€‚åˆå¹¶å…„å¼Ÿç»“ç‚¹ï¼Œ10ã€11å’Œ12åˆå¹¶ï¼Œæ­¤æ—¶çˆ¶ç»“ç‚¹å› ä¸ºå°‘äº†ä¸€ä¸ªå­ç»“ç‚¹è¿è§„ï¼Œæ‰€ä»¥éœ€è¦ç»§ç»­å¤„ç†ã€‚ï¼ˆæ­¤å¤„ä¸ºä½•ä¸º9è¿˜æœªææ‡‚ï¼‰</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010112.png" alt></p><p>æ¥ç€åˆ é™¤7ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010113.png" alt></p><p>æ¥ç€åˆ é™¤8ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20200701/202007010114.png" alt></p><h3 id="2-5-B-æ ‘çš„ç‰¹ç‚¹"><a href="#2-5-B-æ ‘çš„ç‰¹ç‚¹" class="headerlink" title="2.5 B+æ ‘çš„ç‰¹ç‚¹"></a><strong>2.5 B+æ ‘çš„ç‰¹ç‚¹</strong></h3><ol><li>B+æ ‘çš„éå¶å­ç»“ç‚¹ä¸ä¿å­˜å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œåªè¿›è¡Œæ•°æ®ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥ä½¿B+æ ‘æ¯ä¸ªéå¶å­ç»“ç‚¹æ‰€èƒ½ä¿å­˜çš„å…³é”®å­—æ•°å¤§å¤§å¢åŠ ã€‚</li><li>B+æ ‘å¶å­ç»“ç‚¹ä¿å­˜äº†çˆ¶ç»“ç‚¹çš„æ‰€æœ‰å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œæ‰€æœ‰æ•°æ®åœ°å€å¿…é¡»åˆ°å¶å­ç»“ç‚¹æ‰èƒ½è·å–åˆ°ï¼Œæ‰€ä»¥æ¯æ¬¡æ•°æ®æŸ¥è¯¢çš„æ¬¡æ•°éƒ½ç›¸åŒã€‚</li><li>B+æ ‘å¶å­ç»“ç‚¹çš„å…³é”®å­—ä»å°åˆ°å¤§æœ‰åºæ’åˆ—ï¼Œå·¦è¾¹ç»“å°¾æ•°æ®éƒ½ä¼šä¿å­˜å³è¾¹èŠ‚ç‚¹å¼€å§‹æ•°æ®çš„æŒ‡é’ˆã€‚</li><li><strong>éå¶å­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°</strong> = <strong>å…³é”®å­—æ•°</strong>ï¼Œæˆ–è€…<strong>éå¶èŠ‚ç‚¹çš„å…³é”®å­—æ•°</strong> = <strong>å­èŠ‚ç‚¹æ•°</strong> - 1ï¼Œè™½ç„¶ä»–ä»¬æ•°æ®æ’åˆ—ç»“æ„ä¸ä¸€æ ·ï¼Œä½†å…¶åŸç†è¿˜æ˜¯ä¸€æ ·çš„ï¼ŒMysql çš„B+æ ‘æ˜¯ç”¨ç¬¬ä¸€ç§æ–¹å¼å®ç°ã€‚</li></ol><h3 id="2-6-B-æ ‘ä¸Bæ ‘çš„åŒºåˆ«"><a href="#2-6-B-æ ‘ä¸Bæ ‘çš„åŒºåˆ«" class="headerlink" title="2.6 B+æ ‘ä¸Bæ ‘çš„åŒºåˆ«"></a><strong>2.6 B+æ ‘ä¸Bæ ‘çš„åŒºåˆ«</strong></h3><ol><li>B+æ ‘çš„<strong>å±‚çº§æ›´å°‘</strong>ï¼šç›¸è¾ƒäºBæ ‘ï¼ŒB+æ ‘çš„æ¯ä¸ª<strong>éå¶å­</strong>èŠ‚ç‚¹å­˜å‚¨çš„å…³é”®å­—æ•°æ›´å¤šï¼Œæ ‘çš„å±‚çº§æ›´å°‘æ‰€ä»¥æŸ¥è¯¢æ•°æ®æ›´å¿«ï¼›</li><li>B+æ ‘<strong>æŸ¥è¯¢é€Ÿåº¦æ›´ç¨³å®š</strong>ï¼šB+æ‰€æœ‰å…³é”®å­—æ•°æ®åœ°å€éƒ½å­˜åœ¨<strong>å¶å­</strong>èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥æ¯æ¬¡æŸ¥æ‰¾çš„æ¬¡æ•°éƒ½ç›¸åŒæ‰€ä»¥æŸ¥è¯¢é€Ÿåº¦è¦æ¯”Bæ ‘æ›´ç¨³å®š;</li><li>B+æ ‘<strong>å¤©ç„¶å…·å¤‡æ’åºåŠŸèƒ½ï¼š</strong>B+æ ‘æ‰€æœ‰çš„<strong>å¶å­</strong>èŠ‚ç‚¹æ•°æ®æ„æˆäº†ä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œåœ¨æŸ¥è¯¢å¤§å°åŒºé—´çš„æ•°æ®æ—¶å€™æ›´æ–¹ä¾¿ï¼Œæ•°æ®ç´§å¯†æ€§å¾ˆé«˜ï¼Œç¼“å­˜çš„å‘½ä¸­ç‡ä¹Ÿä¼šæ¯”Bæ ‘é«˜ã€‚</li><li>B+<strong>æ ‘å…¨èŠ‚ç‚¹éå†æ›´å¿«ï¼š</strong>B+æ ‘éå†æ•´æ£µæ ‘åªéœ€è¦éå†æ‰€æœ‰çš„<strong>å¶å­</strong>èŠ‚ç‚¹å³å¯ï¼Œè€Œä¸éœ€è¦åƒBæ ‘ä¸€æ ·éœ€è¦å¯¹æ¯ä¸€å±‚è¿›è¡Œéå†ï¼Œè¿™æœ‰åˆ©äºæ•°æ®åº“åšå…¨è¡¨æ‰«æã€‚</li></ol><p><strong>Bæ ‘</strong>ç›¸å¯¹äº<strong>B+æ ‘</strong>çš„ä¼˜ç‚¹æ˜¯ï¼Œå¦‚æœç»å¸¸è®¿é—®çš„æ•°æ®ç¦»æ ¹èŠ‚ç‚¹å¾ˆè¿‘ï¼Œè€Œ<strong>Bæ ‘</strong>çš„<strong>éå¶å­</strong>èŠ‚ç‚¹æœ¬èº«å­˜æœ‰å…³é”®å­—å…¶æ•°æ®çš„åœ°å€ï¼Œæ‰€ä»¥è¿™ç§æ•°æ®æ£€ç´¢çš„æ—¶å€™ä¼šè¦æ¯”<strong>B+æ ‘</strong>å¿«ã€‚</p><table><thead><tr><th style="text-align:center">S.NO</th><th style="text-align:center">B TREE</th><th style="text-align:center">B+ TREE</th></tr></thead><tbody><tr><td style="text-align:center">1.</td><td style="text-align:center">æ‰€æœ‰çš„å†…éƒ¨å’Œå¶å­ç»“ç‚¹éƒ½æœ‰æ•°æ®æŒ‡é’ˆ</td><td style="text-align:center">åªæœ‰å¶å­ç»“ç‚¹æœ‰æ•°æ®æŒ‡é’ˆ</td></tr><tr><td style="text-align:center">2.</td><td style="text-align:center">ç”±äºå¶å­ç»“ç‚¹ä¸Šçš„æ‰€æœ‰é”®éƒ½ä¸å¯ç”¨ï¼Œæ‰€ä»¥æœç´¢é€šå¸¸æ›´è´¹æ—¶</td><td style="text-align:center">æ‰€æœ‰é”®éƒ½åœ¨å¶èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤æœç´¢æ›´å¿«ï¼Œæ›´å‡†ç¡®</td></tr><tr><td style="text-align:center">3.</td><td style="text-align:center">æ ‘ä¸­æ²¡æœ‰é‡å¤çš„é”®</td><td style="text-align:center">å…è®¸é‡å¤çš„é”®ï¼Œå¹¶ä¸”æ‰€æœ‰ç»“ç‚¹éƒ½å­˜åœ¨äºå¶å­ä¸Š</td></tr><tr><td style="text-align:center">4.</td><td style="text-align:center">æ’å…¥ä¼šèŠ±è´¹æ›´å¤šæ—¶é—´ï¼Œæœ‰æ—¶æ— æ³•é¢„æµ‹</td><td style="text-align:center">æ’å…¥æ›´å®¹æ˜“ï¼Œç»“æœå§‹ç»ˆç›¸åŒ</td></tr><tr><td style="text-align:center">5.</td><td style="text-align:center">å†…éƒ¨ç»“ç‚¹çš„åˆ é™¤éå¸¸å¤æ‚ï¼Œå¹¶ä¸”æ ‘å¿…é¡»è¿›è¡Œå¤§é‡è½¬æ¢</td><td style="text-align:center">åˆ é™¤ä»»ä½•èŠ‚ç‚¹éƒ½å¾ˆå®¹æ˜“ï¼Œå› ä¸ºæ‰€æœ‰ç»“ç‚¹éƒ½å¯ä»¥åœ¨å¶å­ä¸Šæ‰¾åˆ°</td></tr><tr><td style="text-align:center">6.</td><td style="text-align:center">å¶å­ç»“ç‚¹ä¸å­˜å‚¨ä¸ºç»“æ„é“¾è¡¨</td><td style="text-align:center">å¶å­ç»“ç‚¹å­˜å‚¨ä¸ºç»“æ„é“¾è¡¨</td></tr><tr><td style="text-align:center">7.</td><td style="text-align:center">æ²¡æœ‰å¤šä½™çš„æœç´¢é”®</td><td style="text-align:center">å¯èƒ½å­˜åœ¨å¤šä½™çš„æœç´¢é”®</td></tr></tbody></table><h3 id="2-7-B-æ ‘ä¸B-æ ‘çš„åŒºåˆ«"><a href="#2-7-B-æ ‘ä¸B-æ ‘çš„åŒºåˆ«" class="headerlink" title="2.7 B+æ ‘ä¸B*æ ‘çš„åŒºåˆ«"></a><strong>2.7 B+æ ‘ä¸B*æ ‘çš„åŒºåˆ«</strong></h3><p>B*æ ‘æ˜¯B+æ ‘çš„å˜ç§ï¼Œç›¸å¯¹äºB+æ ‘ä»–ä»¬çš„ä¸åŒä¹‹å¤„å¦‚ä¸‹ï¼š</p><ol><li><p>é¦–å…ˆæ˜¯å…³é”®å­—ä¸ªæ•°é™åˆ¶é—®é¢˜ï¼ŒB+æ ‘åˆå§‹åŒ–çš„å…³é”®å­—åˆå§‹åŒ–ä¸ªæ•°æ˜¯ <code>cei(m/2)</code> ï¼Œ<code>b*</code> æ ‘çš„åˆå§‹åŒ–ä¸ªæ•°ä¸º<code>cei(2/3*m)</code> ã€‚</p></li><li><p>B+æ ‘èŠ‚ç‚¹æ»¡æ—¶å°±ä¼šåˆ†è£‚ï¼Œè€ŒB<em>æ ‘èŠ‚ç‚¹æ»¡æ—¶ä¼šæ£€æŸ¥å…„å¼ŸèŠ‚ç‚¹æ˜¯å¦æ»¡ï¼ˆå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æŒ‡å‘å…„å¼Ÿçš„æŒ‡é’ˆï¼‰ï¼Œå¦‚æœå…„å¼ŸèŠ‚ç‚¹æœªæ»¡åˆ™å‘å…„å¼ŸèŠ‚ç‚¹è½¬ç§»å…³é”®å­—ï¼Œå¦‚æœå…„å¼ŸèŠ‚ç‚¹å·²æ»¡ï¼Œåˆ™ä»å½“å‰èŠ‚ç‚¹å’Œå…„å¼ŸèŠ‚ç‚¹å„æ‹¿å‡º1/3çš„æ•°æ®åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å‡ºæ¥ï¼›</em></p></li><li>åœ¨B+æ ‘çš„åŸºç¡€ä¸Šå› å…¶åˆå§‹åŒ–çš„å®¹é‡å˜å¤§ï¼Œä½¿å¾—èŠ‚ç‚¹ç©ºé—´ä½¿ç”¨ç‡æ›´é«˜ï¼Œè€Œåˆå­˜æœ‰å…„å¼ŸèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¯ä»¥å‘å…„å¼ŸèŠ‚ç‚¹è½¬ç§»å…³é”®å­—çš„ç‰¹æ€§ä½¿å¾—B*æ ‘é¢åˆ†è§£æ¬¡æ•°å˜å¾—æ›´å°‘ï¼›</li></ol><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— <a href="https://zh.wikipedia.org/wiki/Bæ ‘" target="_blank" rel="noopener">Bæ ‘-ç»´åŸºç™¾ç§‘</a></p><p>ğŸ”— <a href="https://zh.wikipedia.org/wiki/B%2B%E6%A0%91" target="_blank" rel="noopener">B+æ ‘-ç»´åŸºç™¾ç§‘</a></p><p>ğŸ”— ã€Šç®—æ³• ç¬¬4ç‰ˆã€‹</p>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†äº†Bæ ‘å’ŒB+æ ‘çš„ç›¸å…³å†…å®¹ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="algorithm" scheme="http://linyishui.top/tags/algorithm/"/>
    
  </entry>
  
</feed>
