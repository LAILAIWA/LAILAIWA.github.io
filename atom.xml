<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¿ºçš„éƒ¨è½æ ¼</title>
  
  <subtitle>ä¿ºå¯»æ€ä¿ºéœ€è¦è®°ç‚¹ä¸œè¥¿</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://linyishui.top/"/>
  <updated>2021-06-15T15:40:24.000Z</updated>
  <id>http://linyishui.top/</id>
  
  <author>
    <name>æ—æ²‚æ°´</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€Šç¤¾ä¼šå¿ƒç†å­¦ã€‹è¯»ä¹¦ç¬”è®°ï¼ˆä¸€ï¼‰å¯¼è®º</title>
    <link href="http://linyishui.top/2021061501.html"/>
    <id>http://linyishui.top/2021061501.html</id>
    <published>2021-06-15T07:03:45.000Z</published>
    <updated>2021-06-15T15:40:24.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å¯¼è®º"><a href="#å¯¼è®º" class="headerlink" title="å¯¼è®º"></a>å¯¼è®º</h1><h2 id="ä¸€-ä»€ä¹ˆæ˜¯ç¤¾ä¼šå¿ƒç†å­¦"><a href="#ä¸€-ä»€ä¹ˆæ˜¯ç¤¾ä¼šå¿ƒç†å­¦" class="headerlink" title="ä¸€. ä»€ä¹ˆæ˜¯ç¤¾ä¼šå¿ƒç†å­¦"></a>ä¸€. ä»€ä¹ˆæ˜¯ç¤¾ä¼šå¿ƒç†å­¦</h2><blockquote><p>äººç±»æ˜¯æƒ…å¢ƒä¸­çš„ç”Ÿç‰©ï¼Œæƒ…å¢ƒå¡‘é€ äº†æˆ‘ä»¬ï¼Œå†³å®šæˆ‘ä»¬æœªæ¥çš„è¯¸å¤šå¯èƒ½æ€§ï¼Œæˆ‘ä»¬ä¾¿ä¸å¯ç‹¬ç«‹äºå®ƒè€Œå­˜åœ¨ã€‚</p></blockquote><p>ç¤¾ä¼šå¿ƒç†å­¦æ˜¯ä¸€é—¨<strong>ç ”ç©¶æˆ‘ä»¬å‘¨å›´æƒ…å¢ƒåŠ›é‡</strong>çš„ç§‘å­¦ï¼Œå°¤å…¶æ˜¯æˆ‘ä»¬<strong>å¦‚ä½•çœ‹å¾…ä»–äººã€å¦‚ä½•å½±å“ä»–äººã€åˆå¦‚ä½•äº’ç›¸å…³è”</strong>ã€‚ã€</p><p>æˆ‘ä»¬çš„ç¤¾ä¼šè¡Œä¸ºä¸ä»…å–å†³äº<strong>å®¢è§‚æƒ…å¢ƒ</strong>ï¼Œè¿˜å–å†³äºæˆ‘ä»¬å¦‚ä½•å¯¹å…¶è¿›è¡Œ<strong>ä¸»è§‚å»ºæ„</strong>ã€‚</p><h3 id="ç ”ç©¶çš„é—®é¢˜"><a href="#ç ”ç©¶çš„é—®é¢˜" class="headerlink" title="ç ”ç©¶çš„é—®é¢˜"></a>ç ”ç©¶çš„é—®é¢˜</h3><p>ç¤¾ä¼šå¿ƒç†å­¦ç ”ç©¶ä¸‰ç±»é—®é¢˜ï¼š</p><ul><li><strong>ç¤¾ä¼šæ€ç»´ï¼š</strong><ul><li>æˆ‘ä»¬å¦‚ä½•çŸ¥è§‰è‡ªæˆ‘å’Œä»–äºº</li><li>æˆ‘ä»¬çš„ä¿¡å¿µæ˜¯ä»€ä¹ˆ</li><li>æˆ‘ä»¬æ‰€åšçš„åˆ¤æ–­</li><li>æˆ‘ä»¬çš„æ€åº¦</li></ul></li><li><strong>ç¤¾ä¼šå½±å“ï¼š</strong><ul><li>æ–‡åŒ–ä¸ç”Ÿç‰©ä»ä¼—çš„å‹åŠ›</li><li>è¯´æœ</li><li>å›¢ä½“</li></ul></li><li><strong>ç¤¾ä¼šå…³ç³»ï¼š</strong><ul><li>åè§</li><li>æ”»å‡»</li><li>å¸å¼•åŠ›å’Œäº²å¯†å…³ç³»</li><li>åŠ©äºº</li></ul></li></ul><p>æˆ‘ä»¬çš„ç¤¾äº¤ç”Ÿæ´»åœ¨å¤šå¤§ç¨‹åº¦ä¸Šå­˜åœ¨äºæˆ‘ä»¬çš„å¤´è„‘ä¹‹ä¸­ï¼Ÿå¦‚æœè¢«è¦æ±‚å¬å‘½è¡Œäº‹ï¼Œä½ ä¼šç”¨æ®‹å¿çš„æ–¹å¼è¡ŒåŠ¨å—ï¼Ÿé€‰æ‹©åŠ©äººè¿˜æ˜¯åŠ©å·±ï¼Ÿ</p><h3 id="ç¤¾ä¼šå¿ƒç†å­¦çš„è§‚ç‚¹"><a href="#ç¤¾ä¼šå¿ƒç†å­¦çš„è§‚ç‚¹" class="headerlink" title="ç¤¾ä¼šå¿ƒç†å­¦çš„è§‚ç‚¹"></a>ç¤¾ä¼šå¿ƒç†å­¦çš„è§‚ç‚¹</h3><ul><li>ç¤¾ä¼šæ€ç»´ï¼š<ol><li><strong>æˆ‘ä»¬æ„å»ºèµ·ç¤¾ä¼šç°å®ã€‚</strong>äººç±»çš„é€šæ€§æ˜¯æƒ³è¦è§£é‡Šè¡Œä¸ºï¼Œä½¿å…¶å½’å› å˜å¾—æ¬¡åºäº•ç„¶ï¼Œå…·æœ‰å¯é¢„è§æ€§ï¼Œèƒ½å¤Ÿè¢«æŒæ¡ã€‚æˆ‘ä»¬ä¼šä¹ æƒ¯è§£é‡Šä»–äººçš„è¡Œä¸ºï¼Œå°†å…¶â€œäººæ ¼â€å½’ç±»ã€‚çœ‹å¾…è‡ªå·±æ˜¯ä¹è§‚æˆ–æ‚²è§‚ï¼Œä¹ æƒ¯é«˜äººä¸€ç­‰è¿˜æ˜¯ä½äººä¸€ç­‰ï¼Ÿ</li><li><strong>æˆ‘ä»¬çš„ç¤¾ä¼šç›´è§‰çš„åŠ›é‡æ˜¯å¼ºå¤§çš„ï¼Œä½†æœ‰æ—¶æ˜¯å±é™©çš„ã€‚</strong>æˆ‘ä»¬çš„ç›´è§‰å½±å“æˆ‘ä»¬æŸäº›æ—¶åˆ»çš„é€‰æ‹©ï¼Œäººçš„å¿ƒçµæˆ–è®¸æ˜¯æ— æ„è¯†çš„ï¼Œä¸€ä¸ªç”±ç›´è§‰æ‰€æ“æ§çš„ã€‚æ€ç»´ã€è®°å¿†å’Œæ€åº¦éƒ½æ˜¯åŒæ—¶åœ¨ä¸¤ä¸ªæ°´å¹³ä¸Šè¿è¡Œçš„ï¼Œä¸€ä¸ªæœ‰æ„è¯†å’Œæ„å›¾ï¼Œä¸€ä¸ªæ— æ„è¯†å’Œè‡ªåŠ¨ï¼Œå³<strong>åŒé‡åŠ å·¥</strong>ã€‚æˆ‘ä»¬è‡ªå·±çš„ç›´è§‰æ—¶å¸¸ä¼šå‡ºé”™ï¼Œå¤ªè¿‡äºç›¸ä¿¡è‡ªå·±çš„è®°å¿†åŠ›ï¼Œé”™è¯¯çš„è§£è¯»è‡ªå·±çš„å¿ƒç†ï¼Œé”™è¯¯ä¼°è®¡è‡ªå·±çš„æœªæ¥ã€‚å¤§éƒ¨åˆ†åœºæ™¯ä¸­ï¼Œå¿«æ·çœåŠ›çš„é€Ÿé£Ÿå‹åˆ¤æ–­æ–¹å¼è¶³ä»¥æ»¡è¶³éœ€æ±‚ï¼Œä½†ä¸€äº›éœ€è¦<strong>å‡†ç¡®æ€§</strong>çš„ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æœ€å¥½ä½¿ç”¨<strong>æ‰¹åˆ¤æ€§æ€ç»´</strong>æ¥æŠ‘åˆ¶ç›´è§‰å†²åŠ¨ã€‚</li><li><strong>æ€åº¦å¡‘é€ è¡Œä¸ºã€‚</strong>æˆ‘ä»¬å¯¹æŸäº›äº‹æƒ…çš„æ€åº¦ä¼šå·¦å³ç›¸å…³çš„è¡Œä¸ºï¼Œæ€åº¦ä¹ŸåŒæ ·ä¾é™„äºè¡Œä¸ºã€‚</li></ol></li><li>ç¤¾ä¼šå½±å“ï¼š<ol start="4"><li><strong>ç¤¾ä¼šå½±å“å¡‘é€ è¡Œä¸ºã€‚</strong>æˆ‘ä»¬æ˜¯ç¤¾ä¼šåŠ¨ç‰©ï¼Œä¼šå¯¹å‘¨å›´ç¯å¢ƒåšå‡ºååº”ã€‚æœ‰æ—¶ï¼ŒæŸäº›ç¤¾ä¼šæƒ…å¢ƒå…·æœ‰çš„å½±å“åŠ›ä¼šå¼•å‘æˆ‘ä»¬åšå‡ºèƒŒç¦»è‡ªå·±æ€åº¦çš„ä¸¾åŠ¨ã€‚æ¯”å¦‚ä¼Šæ‹‰å…‹æˆ˜äº‰çˆ†å‘æ—¶ï¼Œç¾å›½å’Œä»¥è‰²åˆ—çš„ç¾¤ä¼—ä¼šæ›´å€¾å‘äºæˆ˜äº‰ï¼Œè€Œä¸–ç•Œå…¶ä»–å›½å®¶çš„ç¾¤ä¼—åˆ™åå¯¹æˆ˜äº‰ã€‚æˆ‘ä»¬å¯¹å¥³æ€§ç¾çš„å®šä¹‰å–å†³äºæˆ‘ä»¬æ‰€åœ¨çš„æ–‡åŒ–ç¯å¢ƒç­‰ç­‰ã€‚<strong>ç¯å¢ƒæ— æ—¶æ— åˆ»ä¸åœ¨å½±å“ä¸ªäººã€‚</strong></li><li><strong>æ€§æ ¼å€¾å‘å¡‘é€ è¡Œä¸ºã€‚</strong>é¢å¯¹åŒæ ·çš„æƒ…å¢ƒï¼Œä¸åŒæ€§æ ¼çš„äººä¼šåšå‡ºä¸åŒçš„é€‰æ‹©ã€‚<strong>ä½œä¸ºç¤¾ä¼šä¸ªä½“ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯ç¤¾ä¼šçš„äº§ç‰©ï¼Œä¹ŸåŒæ ·æ˜¯ç¤¾ä¼šçš„åˆ›é€ è€…ã€‚</strong>ï¼ˆç›¸äº’å½±å“ï¼‰</li></ol></li><li>ç¤¾ä¼šå…³ç³»ï¼š<ol start="6"><li><strong>ç¤¾ä¼šè¡Œä¸ºåŒæ ·ä¹Ÿæ˜¯ç”Ÿç‰©æ€§è¡Œä¸ºã€‚</strong>äººç±»æ˜¯å…ˆå¤©ä¸åå¤©å…±åŒä½œç”¨çš„ç”Ÿç‰©ï¼Œé—ä¼ å¾—åˆ°çš„å¤©æ€§æ˜¯æˆ‘ä»¬åšå‡ºæœ‰åˆ©äºç¹è¡çš„è¡Œä¸ºï¼Œæˆ‘ä»¬é—ä¼ äº†è¿™äº›ä½¿å¾—è¡€è„‰å¾—ä»¥å»¶ç»­çš„åŸºå› ã€‚è¿›åŒ–å¿ƒç†å­¦ç ”ç©¶çš„æ˜¯è‡ªç„¶é€‰æ‹©å¦‚ä½•å½±å“æˆ‘ä»¬çš„ä¸€äº›è¡Œä¸ºä¸ååº”ã€‚å¤§è„‘ã€å¿ƒçµå’Œè¡Œä¸ºæ˜¯å¦‚ä½•å…±åŒä½œç”¨æˆä¸ºä¸€ä¸ªç›¸äº’åè°ƒçš„å·¥ä½œç³»ç»Ÿï¼Œè¿™æ˜¯ç¤¾ä¼šè®¤çŸ¥ç¥ç»ç§‘å­¦å…³æ³¨çš„é—®é¢˜ã€‚</li><li><strong>å¯¹ä»–äººçš„æ„Ÿå—å’Œåšå‡ºçš„è¡Œä¸ºæœ‰æ—¶æ˜¯ç§¯æï¼Œæœ‰æ—¶åˆ™æ˜¯æ¶ˆæçš„ã€‚</strong></li></ol></li></ul><h2 id="äºŒ-ç¤¾ä¼šå¿ƒç†å­¦ä¸ç›¸å…³å­¦ç§‘"><a href="#äºŒ-ç¤¾ä¼šå¿ƒç†å­¦ä¸ç›¸å…³å­¦ç§‘" class="headerlink" title="äºŒ. ç¤¾ä¼šå¿ƒç†å­¦ä¸ç›¸å…³å­¦ç§‘"></a>äºŒ. ç¤¾ä¼šå¿ƒç†å­¦ä¸ç›¸å…³å­¦ç§‘</h2><ul><li><p><strong>ç¤¾ä¼šå­¦ï¼š</strong>ç¤¾ä¼šå­¦å®¶ç ”ç©¶<strong>å›¢ä½“</strong>â€”ä»å°å›¢ä½“åˆ°å¤§å›¢ä½“ï¼ˆç¤¾ä¼šä¸å…¶å‘å±•è¶‹åŠ¿ï¼‰ï¼›ç¤¾ä¼šå¿ƒç†å­¦å®¶ç ”ç©¶<strong>ä¸ªä½“</strong>â€”ä¸ªä½“åœ¨æŸä¸ªç‰¹å®šæ—¶é—´å¯¹ä»–äººçš„çœ‹æ³•ï¼Œä¸ªä½“ä¹‹é—´çš„ç›¸äº’å½±å“åŠå…³ç³»ã€‚æ¯”å¦‚äº²å¯†å…³ç³»çš„ç ”ç©¶ä¸­ï¼Œç¤¾ä¼šå­¦å…³ç³»å©šå§»å…³ç³»ã€ç¦»å©šä»¥åŠåŒå±…æ¯”ä¾‹ï¼Œç¤¾ä¼šå¿ƒç†å­¦åˆ™å…³å¿ƒä¸ªä½“å¦‚ä½•è¢«å¦ä¸€ä¸ªä¸ªä½“å¸å¼•ã€‚</p></li><li><p><strong>äººæ ¼å¿ƒç†å­¦ï¼š</strong>äºŒè€…éƒ½å…³æ³¨ä¸ªä½“ï¼Œç¤¾ä¼šå¿ƒç†å­¦æ›´å¤šå…³æ³¨ç¤¾ä¼šå› ç´ ï¼Œäººæ ¼å¿ƒç†å­¦åˆ™å…³æ³¨ä¸ªä½“å†…éƒ¨åŠŸèƒ½ä»¥åŠä¸ªä½“é—´çš„å·®å¼‚ã€‚ç¤¾ä¼šå¿ƒç†å­¦å…³æ³¨ä¸ªä½“é—´çš„ç›¸åŒç‚¹ï¼Œäººæ ¼å¿ƒç†å­¦å…³æ³¨ä¸ªä½“é—´çš„å·®å¼‚ç‚¹ã€‚</p></li></ul><h2 id="ä¸‰-ä»·å€¼è§‚ä¸äº‹åèªæ˜"><a href="#ä¸‰-ä»·å€¼è§‚ä¸äº‹åèªæ˜" class="headerlink" title="ä¸‰. ä»·å€¼è§‚ä¸äº‹åèªæ˜"></a>ä¸‰. ä»·å€¼è§‚ä¸äº‹åèªæ˜</h2><blockquote><p>å¿ƒç†å­¦æ— æ³•è§£é‡Šäººç±»å­˜åœ¨çš„ç›®çš„ï¼Œä¹Ÿæ— æ³•è§£é‡Šäººç±»ç”Ÿæ´»çš„æ„ä¹‰ï¼Œä»¥åŠäººç±»çš„æœ€ç»ˆå‘½è¿ã€‚ç¤¾ä¼šå¿ƒç†å­¦åªæ˜¯æˆ‘ä»¬çœ‹å¾…è‡ªæˆ‘ï¼Œäº†è§£è‡ªæˆ‘çš„å…¶ä¸­ä¸€ä¸ªè§†è§’ã€‚</p></blockquote><p>å¦‚æœå¤§è„‘æ²¡æœ‰é¢„å…ˆè®¾å®šä½ å°†çŸ¥è§‰åˆ°æŸä¸ªç‰©ä½“ï¼Œå®ƒä¾¿ä¼šå°†å…¶é˜»éš”åœ¨ä½ çš„ä¸€è§†ä¹‹å¤–ã€‚æˆ‘ä»¬å¯¹ç°å®çš„çŸ¥è§‰ä¼šä¸ºæˆ‘ä»¬çš„é¢„æœŸæ‰€å·¦å³ã€‚<strong>å®¢è§‚ç°å®çš„ç¡®å­˜åœ¨ï¼Œä½†æˆ‘ä»¬æ€»æ˜¯é€è¿‡ä¿¡å¿µä¸ä»·å€¼è§‚çš„çœ¼é•œè§‚å¯Ÿå®ƒä»¬ã€‚</strong></p><p>æ¯ä¸ªäººéƒ½éš¾ä»¥è„±ç¦»ä¸ªäººä¸»è§‚çš„å½±å“ï¼Œå› æ­¤ç¤¾ä¼šå¿ƒç†å­¦çš„æ¦‚å¿µä¹Ÿä¼šè¢«éšå«çš„ä»·å€¼è§‚æ¸—å…¥ã€‚æˆ‘ä»¬ç”Ÿæ´»ä¸­ä¹Ÿä¼šæœ‰è¿™ç§é—®é¢˜ï¼Œå½“åˆ«äººèµç¾å›½å®¶å’Œäººæ°‘æ—¶æˆ‘ä»¬ç§°å…¶ä¸ºæ°‘æ—ä¸»ä¹‰ï¼Œå½“æˆ‘ä»¬è¿™æ ·åšæ—¶å°±å«çˆ±å›½ä¸»ä¹‰ã€‚ä¸€ä¸ªå·å…¥å©šå¤–æƒ…çš„äººæ˜¯è¿½æ±‚å©šå§»è§£æ”¾è¿˜æ˜¯é€šå¥¸ï¼Œå–å†³äºæˆ‘ä»¬ä¸ªäººä»·å€¼è§‚ã€‚é›„å¿ƒå‹ƒå‹ƒçš„ç”·äººä¸ç››æ°”å‡Œäººçš„å¥³äººï¼Œå°å¿ƒè°¨æ…çš„ç”·å­©å­ä¸æ€¯ç”Ÿç”Ÿçš„å¥³å­©å­ç­‰ã€‚</p><p>ç¤¾ä¼šå¿ƒç†å­¦ä¸æ˜¯æ—¨åœ¨äº‹ååˆ†æï¼Œè€Œæ˜¯èƒ½å¤Ÿé¢„æµ‹ã€‚å½“å¾—çŸ¥ç»“æœåå°±ä¼šè§‰å¾—æ˜¾è€Œæ˜“è§ï¼Œæ¯”å¦‚è‚¡å¸‚éœ‡è¡æˆ–å¤§é€‰è½å®šï¼Œå¤§éƒ¨åˆ†è¯„è®ºå¯¹æ­¤å¹¶ä¸æ„Ÿåˆ°æ„å¤–ã€‚ç»å¤§å¤šæ•°çš„å¿ƒç†å­¦å®éªŒå¾—åˆ°ç»“è®ºçœ‹èµ·æ¥éƒ½åƒå¸¸è¯†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æå‰çŸ¥é“äº†ç»“æœï¼ˆäº‹åèªæ˜ï¼‰ã€‚</p><blockquote><p>å°†ä¸€ç¾¤äººåˆ†ä¸ºä¸¤ç»„ï¼Œä¸€ç»„å‘ŠçŸ¥å…¶æ— è®ºäº¤å‹è¿˜æ˜¯å å…¥çˆ±æ²³ï¼Œæ€§æ ¼ä¸æˆ‘ä»¬ä¸åŒçš„äººæ›´æœ‰å¸å¼•åŠ›ï¼Œä¿—è¯è¯´å¼‚æ€§ç›¸å¸ï¼›å¦ä¸€ç»„åˆ™å‘ŠçŸ¥å…¶æ€§æ ¼ç›¸ä¼¼çš„äººæœ€æœ‰å¸å¼•åŠ›ï¼Œä¿—è¯è¯´ç‰©ä»¥ç±»èšã€äººä»¥ç¾¤åˆ†ã€‚</p><p>æ— è®ºå“ªç§è¯´æ³•ï¼Œç”šè‡³æ˜¯ç›¸åçš„è®ºç‚¹éƒ½ä¼šè®©æˆ‘ä»¬è§‰å¾—å¾ˆæœ‰é“ç†ï¼Œæ¯”å¦‚â€œå •è½çš„äººä¸èƒ½å¸®åŠ©å¦ä¸€ä¸ªå •è½çš„äººâ€ä¸â€œå •è½çš„äººèƒ½å¤Ÿå¸®åŠ©å¦ä¸€ä¸ªå •è½çš„äººâ€è¿™ç§åŒé‡æ ¼è¨€ã€‚</p></blockquote><h2 id="å››-ç ”ç©¶æ–¹æ³•"><a href="#å››-ç ”ç©¶æ–¹æ³•" class="headerlink" title="å››. ç ”ç©¶æ–¹æ³•"></a>å››. ç ”ç©¶æ–¹æ³•</h2><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šç¤¾ä¼šå¿ƒç†å­¦ã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹æ¥è‡ªã€Šç¤¾ä¼šå¿ƒç†å­¦ã€‹ã€‚
    
    </summary>
    
      <category term="å¿ƒç†å­¦" scheme="http://linyishui.top/categories/%E5%BF%83%E7%90%86%E5%AD%A6/"/>
    
    
      <category term="psychology" scheme="http://linyishui.top/tags/psychology/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šç¤¾ä¼šå¿ƒç†å­¦ã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="http://linyishui.top/2021061401.html"/>
    <id>http://linyishui.top/2021061401.html</id>
    <published>2021-06-14T07:03:45.000Z</published>
    <updated>2021-06-15T14:27:22.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ç¤¾ä¼šå¿ƒç†å­¦"><a href="#ç¤¾ä¼šå¿ƒç†å­¦" class="headerlink" title="ç¤¾ä¼šå¿ƒç†å­¦"></a>ç¤¾ä¼šå¿ƒç†å­¦</h1><h2 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="headerlink" title="ä¸€. å‰è¨€"></a>ä¸€. å‰è¨€</h2><h2 id="äºŒ-ç¤¾ä¼šæ€ç»´"><a href="#äºŒ-ç¤¾ä¼šæ€ç»´" class="headerlink" title="äºŒ. ç¤¾ä¼šæ€ç»´"></a>äºŒ. ç¤¾ä¼šæ€ç»´</h2><h2 id="ä¸‰-ç¤¾ä¼šå½±å“"><a href="#ä¸‰-ç¤¾ä¼šå½±å“" class="headerlink" title="ä¸‰. ç¤¾ä¼šå½±å“"></a>ä¸‰. ç¤¾ä¼šå½±å“</h2><h2 id="å››-ç¤¾ä¼šå…³ç³»"><a href="#å››-ç¤¾ä¼šå…³ç³»" class="headerlink" title="å››. ç¤¾ä¼šå…³ç³»"></a>å››. ç¤¾ä¼šå…³ç³»</h2><h2 id="äº”-å®é™…åº”ç”¨"><a href="#äº”-å®é™…åº”ç”¨" class="headerlink" title="äº”. å®é™…åº”ç”¨"></a>äº”. å®é™…åº”ç”¨</h2><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šç¤¾ä¼šå¿ƒç†å­¦ã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹æ¥è‡ªã€Šç¤¾ä¼šå¿ƒç†å­¦ã€‹ã€‚
    
    </summary>
    
      <category term="å¿ƒç†å­¦" scheme="http://linyishui.top/categories/%E5%BF%83%E7%90%86%E5%AD%A6/"/>
    
    
      <category term="psychology" scheme="http://linyishui.top/tags/psychology/"/>
    
  </entry>
  
  <entry>
    <title>ZooKeeperï¼ˆäº”ï¼‰æŠ€æœ¯å†…å¹•</title>
    <link href="http://linyishui.top/2021061001.html"/>
    <id>http://linyishui.top/2021061001.html</id>
    <published>2021-06-10T07:03:45.000Z</published>
    <updated>2021-06-20T14:02:48.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ZooKeeperï¼ˆäº”ï¼‰æŠ€æœ¯å†…å¹•"><a href="#ZooKeeperï¼ˆäº”ï¼‰æŠ€æœ¯å†…å¹•" class="headerlink" title="ZooKeeperï¼ˆäº”ï¼‰æŠ€æœ¯å†…å¹•"></a>ZooKeeperï¼ˆäº”ï¼‰æŠ€æœ¯å†…å¹•</h1><h2 id="ä¸€-ç³»ç»Ÿæ¨¡å‹"><a href="#ä¸€-ç³»ç»Ÿæ¨¡å‹" class="headerlink" title="ä¸€. ç³»ç»Ÿæ¨¡å‹"></a>ä¸€. ç³»ç»Ÿæ¨¡å‹</h2><h3 id="1-1-æ•°æ®æ¨¡å‹"><a href="#1-1-æ•°æ®æ¨¡å‹" class="headerlink" title="1.1 æ•°æ®æ¨¡å‹"></a>1.1 æ•°æ®æ¨¡å‹</h3><p>ZooKeeperçš„æ•°æ®æ¨¡å‹ä¸º ZNodeï¼Œå³æ•°æ®èŠ‚ç‚¹ï¼Œå¯ä»¥ä¿å­˜æ•°æ®ï¼ŒåŒäº‹å¯ä»¥æŒ‚è½½å­èŠ‚ç‚¹ï¼Œå› æ­¤æ„æˆäº†ä¸€ä¸ªå±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼Œä¸€ä¸ªæ ‘ç»“æ„ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010101.png" alt></p><p>ZooKeeperä¸­çš„äº‹åŠ¡æŒ‡èƒ½å¤Ÿæ”¹å˜ZKæœåŠ¡å™¨çŠ¶æ€çš„æ“ä½œï¼Œä¸€èˆ¬åŒ…æ‹¬æ•°æ®èŠ‚ç‚¹çš„åˆ›å»ºå’Œåˆ é™¤ã€æ•°æ®èŠ‚ç‚¹å†…å®¹æ›´æ–°å’Œå®¢æˆ·ç«¯ä¼šè¯åˆ›å»ºä¸å¤±æ•ˆç­‰æ“ä½œã€‚æ¯ä¸ªäº‹åŠ¡ä¼šè¢«åˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„äº‹åŠ¡IDï¼Œå³ZXIDï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª64ä½çš„æ•°å­—ï¼Œæ¯ä¸ªZXIDå¯¹åº”ä¸€æ¬¡æ›´æ–°æ“ä½œï¼Œè€Œä¸”å¯ä»¥é—´æ¥çœ‹å‡ºZKå¤„ç†è¿™äº›è¯·æ±‚çš„å…¨å±€é¡ºåºã€‚</p><h3 id="1-2-èŠ‚ç‚¹ç‰¹æ€§"><a href="#1-2-èŠ‚ç‚¹ç‰¹æ€§" class="headerlink" title="1.2 èŠ‚ç‚¹ç‰¹æ€§"></a>1.2 èŠ‚ç‚¹ç‰¹æ€§</h3><h4 id="ï¼ˆ1ï¼‰èŠ‚ç‚¹ç±»å‹"><a href="#ï¼ˆ1ï¼‰èŠ‚ç‚¹ç±»å‹" class="headerlink" title="ï¼ˆ1ï¼‰èŠ‚ç‚¹ç±»å‹"></a>ï¼ˆ1ï¼‰èŠ‚ç‚¹ç±»å‹</h4><ul><li><strong>æŒä¹…èŠ‚ç‚¹ï¼ˆPERSISTENTï¼‰ï¼š</strong>æ•°æ®èŠ‚ç‚¹åˆ›å»ºåå°±ä¼šä¸€ç›´å­˜åœ¨äºZKæœåŠ¡å™¨ä¸Šï¼Œç›´åˆ°ç”±åˆ é™¤æ“ä½œä¸»åŠ¨æ¸…é™¤æ­¤èŠ‚ç‚¹ã€‚</li><li><strong>æŒä¹…é¡ºåºèŠ‚ç‚¹ï¼ˆPERSISTENT_SEQUENTIALï¼‰ï¼š</strong>æœ‰é¢å¤–çš„é¡ºåºæ€§ç‰¹ç‚¹ï¼Œæ¯ä¸ªçˆ¶èŠ‚ç‚¹éƒ½ä¼šä¸ºå®ƒçš„ä¸€çº§å­èŠ‚ç‚¹ç»´æŠ¤ä¸€ä»½é¡ºåºï¼Œåˆ›å»ºå­èŠ‚ç‚¹æ—¶å¯ä»¥è®¾ç½®è¿™ä¸ªæ ‡è®°ï¼ŒZKä¼šè‡ªåŠ¨ç»™èŠ‚ç‚¹åååŠ ä¸€ä¸ªæ•°å­—åç¼€ã€‚</li><li><strong>ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEPHEMERALï¼‰ï¼š</strong>æ­¤èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸä¸å®¢æˆ·ç«¯ä¼šè¯ç»‘å®šï¼Œå½“ä¼šè¯å¤±æ•ˆï¼ŒèŠ‚ç‚¹å°±ä¼šè¢«è‡ªåŠ¨æ¸…ç†æ‰ï¼ˆéTCPè¿æ¥æ–­å¼€ï¼‰ï¼Œä¸´æ—¶èŠ‚ç‚¹åªèƒ½ä½œä¸ºå¶å­èŠ‚ç‚¹ï¼Œä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ã€‚</li><li><strong>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEPHEMERAL_SEQUENTIALï¼‰ï¼š</strong>é¢å¤–æœ‰äº†é¡ºåºæ€§ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰çŠ¶æ€ä¿¡æ¯"><a href="#ï¼ˆ2ï¼‰çŠ¶æ€ä¿¡æ¯" class="headerlink" title="ï¼ˆ2ï¼‰çŠ¶æ€ä¿¡æ¯"></a>ï¼ˆ2ï¼‰çŠ¶æ€ä¿¡æ¯</h4><p>é€šè¿‡getå‘½ä»¤è·å–ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹çš„å†…å®¹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010102.png" alt></p><p>ç¬¬ä¸€è¡Œæ˜¯æ•°æ®å†…å®¹ï¼Œåé¢å°±æ˜¯èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ï¼Œå…¶å®å°±æ˜¯æ•°æ®èŠ‚ç‚¹çš„Statå¯¹è±¡çš„æ ¼å¼åŒ–è¾“å‡ºï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010103.png" alt></p><p>Statç±»åŒ…å«ä¸Šä¸€ä¸ªæ•°æ®èŠ‚ç‚¹çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ï¼ˆäº‹åŠ¡IDã€ç‰ˆæœ¬ä¿¡æ¯å’Œå­èŠ‚ç‚¹ä¸ªæ•°ç­‰ï¼‰ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010104.png" alt></p><h3 id="1-3-ç‰ˆæœ¬â€”ä¹è§‚é”ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œ"><a href="#1-3-ç‰ˆæœ¬â€”ä¹è§‚é”ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œ" class="headerlink" title="1.3 ç‰ˆæœ¬â€”ä¹è§‚é”ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œ"></a>1.3 ç‰ˆæœ¬â€”ä¹è§‚é”ä¿è¯åˆ†å¸ƒå¼æ•°æ®åŸå­æ€§æ“ä½œ</h3><p>æ¯ä¸ªæ•°æ®èŠ‚ç‚¹éƒ½æœ‰ä¸‰ç§ç±»ä¼¼æ–°çš„ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010105.png" alt></p><p>å½“èŠ‚ç‚¹åˆ›å»ºåï¼Œversionå€¼ä¸º0ï¼Œå½“å¯¹æ­¤èŠ‚ç‚¹è¿›è¡Œæ›´æ–°åï¼Œæ›´æ–°ä¸º1ï¼Œä»£è¡¨å˜æ›´æ¬¡æ•°ã€‚é€šè¿‡ç‰ˆæœ¬å·å®ç°çš„ä¹è§‚é”æ¥å®ç°åœ¨æ•°æ®å¹¶å‘ç«äº‰ä¸å¤§ã€äº‹åŠ¡å†²çªè¾ƒå°‘çš„åº”ç”¨åœºæ™¯ã€‚</p><p>ZKçš„PrepRequestProcessorå¤„ç†å™¨ç±»ä¸­ï¼Œå¤„ç†æ¯ä¸ªæ•°æ®æ›´æ–°è¯·æ±‚ï¼ˆsetDataRequestï¼‰æ—¶ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹ç‰ˆæœ¬æ£€æŸ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version = setDataRequest.getVersion();</span><br><span class="line"><span class="comment">// è·å–å½“å‰æœåŠ¡å™¨ä¸Šè¯¥æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">int</span> currentVersion = nodeRecord.stat.getVersion();</span><br><span class="line"><span class="comment">// -1è¡¨ç¤ºå®¢æˆ·ç«¯ä¸è¦æ±‚ä½¿ç”¨ä¹è§‚é”</span></span><br><span class="line"><span class="keyword">if</span> (version != -<span class="number">1</span> &amp;&amp; version != currentVersion) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> KeeperException.BadVersionException(path);</span><br><span class="line">   &#125;</span><br><span class="line">version = currentVersion + <span class="number">1</span>;</span><br></pre></td></tr></table></figure><h3 id="1-4-Watcher"><a href="#1-4-Watcher" class="headerlink" title="1.4 Watcher"></a>1.4 Watcher</h3><p>ZKé€šè¿‡Watcheræœºåˆ¶æ¥å®ç°å‘å¸ƒ/è®¢é˜…çš„åˆ†å¸ƒå¼é€šçŸ¥åŠŸèƒ½ï¼Œå½“æœåŠ¡ç«¯æŒ‡å®šäº‹ä»¶è§¦å‘äº†Watcherï¼Œå°±ä¼šå‘æŒ‡å®šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªäº‹ä»¶é€šçŸ¥ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010106.png" alt></p><h4 id="1-4-1-ç»“æ„"><a href="#1-4-1-ç»“æ„" class="headerlink" title="1.4.1 ç»“æ„"></a>1.4.1 ç»“æ„</h4><p>Watcherå¯¹è±¡å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„WatchManagerä¸­ï¼Œæ”¶åˆ°é€šçŸ¥åä»ä¸­å–å‡ºå¯¹åº”çš„Watcherå¯¹åº”æ¥æ‰§è¡Œå›è°ƒé€»è¾‘ã€‚</p><p>æ¥å£ç±»Watcherè¡¨ç¤ºä¸€ä¸ªæ ‡å‡†çš„äº‹ä»¶å¤„ç†å™¨ï¼ŒåŒ…å«KeeperStateå’ŒEventTypeä¸¤ä¸ªæšä¸¾ç±»ï¼Œåˆ†åˆ«è¡¨ç¤ºé€šçŸ¥çŠ¶æ€å’Œäº‹ä»¶ç±»å‹ï¼ŒåŒæ—¶å®šä¹‰äº†äº‹ä»¶çš„å›è°ƒæ–¹æ³•ï¼š<code>process(WatchedEvent event)</code> ã€‚</p><p>Watcheräº‹ä»¶å¸¸è§çš„é€šçŸ¥çŠ¶æ€å’Œäº‹ä»¶ç±»å‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010107.png" alt></p><p>å†…å®¹å˜æ›´åŒ…æ‹¬èŠ‚ç‚¹çš„æ•°æ®å†…å®¹å’Œæ•°æ®çš„ç‰ˆæœ¬å·dataVersionï¼Œå³ä½¿ç›¸åŒæ•°æ®å†…å®¹ï¼Œä¸€æ—¦æœ‰å®¢æˆ·ç«¯è°ƒç”¨æ•°æ®æ›´æ–°çš„æ¥å£ï¼Œè§¦å‘çš„æ›´æ–°ä¸€æ ·ä¼šå‘é€ç›¸åº”é€šçŸ¥ã€‚</p><p>AuthFailedæ˜¯æˆæƒå¤±è´¥è§¦å‘ï¼Œä½¿ç”¨é”™è¯¯çš„Authåªä¼šæŠ›å‡ºNoAuthExceptionå¼‚å¸¸ï¼Œè€Œä½¿ç”¨é”™è¯¯çš„Schemeåˆ™ä¼šæŠ›å‡ºAuthFailedExceptionï¼Œå¹¶ä¸”æ”¶åˆ°äº‹ä»¶é€šçŸ¥(AuthFailed, None)ã€‚</p><p>å›è°ƒæ–¹æ³• <code>process()</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WatchedEventå¯¹è±¡å°è£…æœåŠ¡ç«¯äº‹ä»¶å¹¶ä¼ é€’ç»™Watcher</span></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent event)</span></span>;</span><br></pre></td></tr></table></figure><p>WatchedEventåŒ…å«æ¯ä¸ªäº‹ä»¶çš„ä¸‰ä¸ªåŸºæœ¬å±æ€§ï¼šé€šçŸ¥çŠ¶æ€ï¼ˆKeeperStateï¼‰ã€äº‹ä»¶ç±»å‹ï¼ˆeventTypeï¼‰å’ŒèŠ‚ç‚¹è·¯å¾„ï¼ˆpathï¼‰ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010108.png" alt></p><p>ç›¸å¯¹çš„WatcherEventå®ç°äº†åºåˆ—å·æ¥å£ï¼Œå¯ä»¥ç”¨äºç½‘ç»œä¼ è¾“ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010109.png" alt></p><p>æœåŠ¡ç«¯ç”ŸæˆWatchedEventäº‹ä»¶åï¼Œä¼šè°ƒç”¨getWrapperæ–¹æ³•å°†è‡ªå·±åŒ…è£…æˆä¸€ä¸ªå¯åºåˆ—åŒ–çš„WatcherEventäº‹ä»¶ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ°äº‹ä»¶å¯¹è±¡åä¼šå…ˆå°†WatcherEventè¿˜åŸä¸ºWatchedEventï¼Œå¹¶ä¼ é€’ç»™processæ–¹æ³•å¤„ç†ã€‚äºŒè€…å¯¹äºäº‹ä»¶çš„å°è£…éƒ½å¾ˆç®€å•ï¼Œæ¯”å¦‚èŠ‚ç‚¹æ•°æ®å˜æ›´ï¼Œå®¢æˆ·ç«¯æ— æ³•ç›´æ¥è·å–åˆ°åŸå§‹æ•°æ®å’Œå˜æ›´åæ•°æ®ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">KeeperState:</span> SyncConnected</span><br><span class="line"><span class="symbol">EventType:</span> NodeDataChanged</span><br><span class="line"><span class="symbol">Path:</span> /zk-book</span><br></pre></td></tr></table></figure><p>Watcherå†…éƒ¨å„ç»„ä»¶é—´å…³ç³»ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010110.png" alt></p><h4 id="1-4-2-å®¢æˆ·ç«¯æ³¨å†ŒWatcher"><a href="#1-4-2-å®¢æˆ·ç«¯æ³¨å†ŒWatcher" class="headerlink" title="1.4.2 å®¢æˆ·ç«¯æ³¨å†ŒWatcher"></a>1.4.2 å®¢æˆ·ç«¯æ³¨å†ŒWatcher</h4><p>æ³¨å†ŒWatcherï¼š</p><ul><li><p>åˆ›å»ºZKå®¢æˆ·ç«¯å®ä¾‹æ—¶ï¼Œå¯ä»¥ç»™å®šä¸€ä¸ªé»˜è®¤çš„Watcherï¼Œå®ƒä¼šä¸€ç›´ä¿å­˜åœ¨å®¢æˆ·ç«¯ZKWatchManagerçš„defaultWatcherä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ZooKeeper</span><span class="params">(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é€šè¿‡ <code>getData()</code> ã€<code>getChildren()</code> å’Œ <code>exist()</code> ä¸‰ä¸ªæ¥å£æ¥æ³¨å†ŒWatcherï¼Œä¾‹å¦‚getDataï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  é€šè¿‡å¸ƒå°”å‚æ•°æ ‡è¯†æ˜¯å¦ä½¿ç”¨å‰é¢çš„é»˜è®¤Watcheræ¥è¿›è¡Œæ³¨å†Œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getData(String path, <span class="keyword">boolean</span> watch, Stat stat);</span><br><span class="line"><span class="comment">// ç›´æ¥æä¾›Watcher</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getData(<span class="keyword">final</span> String path, Watcher watcher, Stat stat);</span><br></pre></td></tr></table></figure></li></ul><p>å®¢æˆ·ç«¯é¦–å…ˆä¼šå¯¹å½“å‰å®¢æˆ·ç«¯è¯·æ±‚requestè¿›è¡Œæ ‡è®°ï¼Œè®¾ç½®ä¸ºâ€œä½¿ç”¨Watcherç›‘å¬â€ï¼ŒåŒæ—¶å°è£…ä¸€ä¸ªWatcheræ³¨å†Œä¿¡æ¯WatchRegistrationå¯¹è±¡ï¼Œä¸´æ—¶ä¿å­˜æ•°æ®èŠ‚ç‚¹çš„è·¯å¾„å’ŒWatcherçš„å…³ç³»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Stat <span class="title">getData</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, Stat stat)</span> </span>&#123;</span><br><span class="line">       ...</span><br><span class="line">       WatchRegistration wcb = <span class="keyword">null</span>;</span><br><span class="line">       <span class="keyword">if</span> (watcher != <span class="keyword">null</span>) &#123;</span><br><span class="line">           wcb = <span class="keyword">new</span> DataWatchRegistration(watcher, clientPath);</span><br><span class="line">       &#125;</span><br><span class="line">       ...</span><br><span class="line">       request.setWatch(watcher != <span class="keyword">null</span>);</span><br><span class="line">       ReplyHeader r = cnxn.submitRequest(h, request, response, wcb);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>Packetå¯ä»¥çœ‹ä½œæ˜¯ZKä¸­æœ€å°çš„é€šä¿¡åè®®å•å…ƒï¼Œç”¨äºè¿›è¡Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ç½‘ç»œä¼ è¾“ï¼Œä»»ä½•éœ€è¦ä¼ è¾“çš„å¯¹è±¡éƒ½éœ€è¦åŒ…è£…æˆä¸€ä¸ªPacketå¯¹è±¡ã€‚ClientCnxnçš„WatchRegistrationä¹Ÿä¼šå°è£…åˆ°Packetä¸­ï¼Œå†æ”¾å…¥å‘é€é˜Ÿåˆ—ä¸­ç­‰å¾…å®¢æˆ·ç«¯å‘é€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Packet <span class="title">queuePacket</span><span class="params">(RequestHeader h, ReplyHeader r, Record request, Record response, AsyncCallback cb, String clientPath, String serverPath, Object ctx, WatchRegistration watchRegistration)</span> </span>&#123;</span><br><span class="line">       Packet packet = <span class="keyword">null</span>;</span><br><span class="line">       ...</span><br><span class="line">       <span class="keyword">synchronized</span>(outgoingQueue) &#123;</span><br><span class="line">           packet = <span class="keyword">new</span> Packet(h, r, request, response, watchRegistration);</span><br><span class="line">       ...</span><br><span class="line">           outgoingQueue.add(packet);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>éšåï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒåŒæ—¶ç­‰å¾…è¯·æ±‚è¿”å›ã€‚å®Œæˆå‘é€åï¼Œç”±å®¢æˆ·ç«¯SendThreadçº¿ç¨‹çš„readResponseæ–¹æ³•è´Ÿè´£æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯çš„å“åº”ï¼ŒfinishPacketæ–¹æ³•ä»Packetä¸­å–å‡ºå¯¹åº”çš„Watcherå¹¶æ³¨å†Œåˆ°ZKWatchManagerä¸­å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finishPacket</span><span class="params">(Packet p)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (p.watchRegistration != <span class="keyword">null</span>) &#123;</span><br><span class="line">           p.watchRegistration.register(p.replyHeader.getErr());</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Map&lt;String, Set&lt;Watcher&gt;&gt; getWatches(<span class="keyword">int</span> rc) &#123;</span><br><span class="line">       <span class="keyword">return</span> watchManager.dataWatches;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯å°†æš‚æ—¶ä¿å­˜çš„Watcherè½¬äº¤ç»™ZKWatchManagerï¼Œæœ€ç»ˆä¿å­˜åˆ°dataWatches</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(<span class="keyword">int</span> rc)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (shouldAddWatch(rc)) &#123;</span><br><span class="line">           Map&lt;String, Set&lt;Watcher&gt;&gt; watches = getWatches(rc);</span><br><span class="line">           <span class="keyword">synchronized</span>(watches) &#123;</span><br><span class="line">               Set&lt;Watcher&gt; watchers = watches.get(clientPath);</span><br><span class="line">               <span class="keyword">if</span> (watchers == <span class="keyword">null</span>) &#123;</span><br><span class="line">                   watchers = <span class="keyword">new</span> HashSet&lt;Watcher&gt;();</span><br><span class="line">                   watchers.put(clientPath, watchers);</span><br><span class="line">               &#125;</span><br><span class="line">               watchers.add(watcher);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æµç¨‹å›¾ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010111.png" alt></p><p>æç«¯æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ¯è°ƒç”¨ä¸€æ¬¡ <code>getData()</code> æ¥å£ï¼Œå°±ä¼šæ³¨å†Œä¸€ä¸ªWatcherï¼Œä½†è¿™äº›Watcherå¹¶ä¸ä¼šéƒ½éšç€å®¢æˆ·ç«¯è¯·æ±‚å‘é€åˆ°æœåŠ¡ç«¯é€ æˆå†…å­˜ç´§å¼ ç­‰æ€§èƒ½é—®é¢˜ã€‚ZKåº•å±‚å®é™…çš„ç½‘ç»œä¼ è¾“åºåˆ—åŒ–è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰å°†WatchRegistrationå¯¹è±¡å®Œå…¨çš„åºåˆ—åŒ–åˆ°åº•å±‚å­—èŠ‚æ•°ç»„ä¸­ï¼ŒPacketå†…éƒ¨åºåˆ—åŒ–è¿‡ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createBB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">           BinaryOutputArchive boa = BinaryOutputArchive.getArchive(baos);</span><br><span class="line">           <span class="comment">// We'll fill this in later</span></span><br><span class="line">           boa.writeInt(-<span class="number">1</span>, <span class="string">"len"</span>);</span><br><span class="line">           <span class="keyword">if</span> (requestHeader != <span class="keyword">null</span>) &#123;</span><br><span class="line">               requestHeader.serialize(boa, <span class="string">"header"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (request <span class="keyword">instanceof</span> ConnectRequest) &#123;</span><br><span class="line">               request.serialize(boa, <span class="string">"connect"</span>);</span><br><span class="line">               <span class="comment">// append "am-I-allowed-to-be-readonly" flag</span></span><br><span class="line">               boa.wirteBool(readOnly, <span class="string">"readOnly"</span>);</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request != <span class="keyword">null</span>) &#123;</span><br><span class="line">               request.serialize(boa, <span class="string">"request"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong>åªæœ‰requestHeaderå’Œrequestè¿›è¡Œäº†åºåˆ—åŒ–ï¼Œæ‰€ä»¥å°½ç®¡WatchRegistrationè¢«å°è£…åˆ°äº†Packetä¸­ï¼Œä½†å¹¶æ²¡æœ‰åºåˆ—åŒ–åˆ°åº•å±‚å­—èŠ‚æ•°ç»„ï¼Œå› æ­¤ä¸ä¼šè¿›è¡Œç½‘ç»œä¼ è¾“ã€‚</strong></p><h4 id="1-4-3-æœåŠ¡ç«¯å¤„ç†Watcher"><a href="#1-4-3-æœåŠ¡ç«¯å¤„ç†Watcher" class="headerlink" title="1.4.3 æœåŠ¡ç«¯å¤„ç†Watcher"></a>1.4.3 æœåŠ¡ç«¯å¤„ç†Watcher</h4><p>å®¢æˆ·ç«¯å¹¶ä¸ä¼šå°†Watcherå¯¹è±¡çœŸæ­£çš„ä¼ é€’åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¦‚ä½•å®Œæˆå®¢æˆ·ç«¯çš„Watcheræ³¨å†Œï¼Ÿ</p><h5 id="ï¼ˆ1ï¼‰ServerCnxnå­˜å‚¨"><a href="#ï¼ˆ1ï¼‰ServerCnxnå­˜å‚¨" class="headerlink" title="ï¼ˆ1ï¼‰ServerCnxnå­˜å‚¨"></a>ï¼ˆ1ï¼‰ServerCnxnå­˜å‚¨</h5><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010112.png" alt></p><p>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œåœ¨ <code>FinalRequestProcessor.processRequest()</code> ä¸­åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦éœ€è¦æ³¨å†ŒWatcherï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> OpCode.getData: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// å½“getDtatRequest.getWatch()ä¸ºTrueæ—¶ï¼Œå°†å½“å‰ServerCnxnå¯¹è±¡å’Œæ•°æ®èŠ‚ç‚¹è·¯å¾„ä¼ å…¥getDataæ–¹æ³•ï¼Œæœ€ç»ˆå­˜å‚¨åœ¨WatchManagerçš„watchTableå’Œwatch2Pathsä¸­</span></span><br><span class="line">    <span class="keyword">byte</span> b[] = zks.getZKDatabase().getData(getDataRequest.getPath(), stat, getDtatRequest.getWatch() ? cnxn : <span class="keyword">null</span>);</span><br><span class="line">    rsp = <span class="keyword">new</span> GetDataResponse(b, stat);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ServerCnxnæ˜¯ä¸€ä¸ªZooKeeperå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ¥å£ï¼Œä»£è¡¨äº†ä¸€ä¸ªäºŒè€…é—´çš„è¿æ¥ã€‚é»˜è®¤å®ç°æ˜¯NIOServerCnxnï¼Œ3.4.0ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†åŸºäºNettyçš„å®ç°NettyServerCnxnã€‚éƒ½å®ç°äº†Watcherçš„processæ¥å£ï¼Œæ‰€ä»¥ServerCnxnä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªWatcherã€‚</p><p>WatchManageræ˜¯ZKæœåŠ¡ç«¯Watcherçš„ç®¡ç†è€…ï¼Œå†…éƒ¨ä¸¤ç§å­˜å‚¨ç»“æ„å¯¹åº”ä¸åŒç»´åº¦ï¼š</p><ul><li><strong>watchTableï¼š</strong>ä»æ•°æ®èŠ‚ç‚¹è·¯å¾„çš„ç²’åº¦æ¥æ‰˜ç®¡Watcherã€‚</li><li><strong>watch2Pathsï¼š</strong>ä»Watcherçš„ç²’åº¦æ§åˆ¶äº‹ä»¶è§¦å‘éœ€è¦è§¦å‘çš„æ•°æ®èŠ‚ç‚¹ã€‚</li></ul><p>WatchManagerè¿˜è´Ÿè´£Watcheräº‹ä»¶çš„è§¦å‘ï¼Œç§»é™¤æ‰å·²è¢«è§¦å‘çš„Watcherã€‚æœåŠ¡ç«¯DataTreeä¼šæ‰˜ç®¡ä¸¤ä¸ªWatchManagerï¼ˆdataWatcheså’ŒchildWatchesï¼Œå¯¹åº”æ•°æ®å˜æ›´å’Œå­èŠ‚ç‚¹å˜æ›´ï¼‰ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010113.png" alt></p><h5 id="ï¼ˆ2ï¼‰Watcherè§¦å‘"><a href="#ï¼ˆ2ï¼‰Watcherè§¦å‘" class="headerlink" title="ï¼ˆ2ï¼‰Watcherè§¦å‘"></a>ï¼ˆ2ï¼‰Watcherè§¦å‘</h5><p>æœåŠ¡ç«¯å¦‚ä½•è§¦å‘Watcher</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Stat <span class="title">setData</span><span class="params">(String path, <span class="keyword">byte</span> data[], <span class="keyword">int</span> version, <span class="keyword">long</span> zxid, <span class="keyword">long</span> time)</span> <span class="keyword">throws</span> KeeperException.NoNodeException </span>&#123;</span><br><span class="line">       DataNode n = nodes.get(path);</span><br><span class="line">       <span class="keyword">if</span> (n == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> KeeperException.NoNodeException();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">byte</span> lasdtdata[] = <span class="keyword">null</span>;</span><br><span class="line">       <span class="keyword">synchronized</span> (n) &#123;</span><br><span class="line">           lastdata = n.data;</span><br><span class="line">           n.data = data;</span><br><span class="line">           n.stat.setMtime(time);</span><br><span class="line">           n.stat.setMzxid(zxid);</span><br><span class="line">           n.stat.setVersion(version);</span><br><span class="line">           n.copyStat(s);</span><br><span class="line">       &#125;</span><br><span class="line">       ......</span><br><span class="line">       <span class="comment">// æŒ‡å®šèŠ‚ç‚¹æ•°æ®æ›´æ–°åï¼Œè°ƒç”¨WatchManagerçš„triggerWatchæ¥è§¦å‘ç›¸å…³äº‹ä»¶</span></span><br><span class="line">       dataWatches.triggerWatch(path, EventType.NodeDataChanged);</span><br><span class="line">       <span class="keyword">return</span> s;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Watcher&gt; <span class="title">triggerWatch</span><span class="params">(String path, EventType type)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> triggerWatch(path, type, <span class="keyword">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Watcher&gt; <span class="title">triggerWatch</span><span class="params">(String path, EventType type, Set&lt;Watcher&gt; supress)</span> </span>&#123;</span><br><span class="line">       WatchedEvent e = <span class="keyword">new</span> WatchedEvent(type, KeeperState.SyncConnected, path);</span><br><span class="line">       HashSet&lt;Watcher&gt; watchers;</span><br><span class="line">       <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">           watchers = watchTable.remove(path);</span><br><span class="line">           ......</span><br><span class="line">           <span class="comment">// å¦‚æœä¸å­˜åœ¨Watcherï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">           <span class="keyword">for</span> (Watcher w : watchers) &#123;</span><br><span class="line">               HashSet&lt;String&gt; paths = watch2Paths.get(w);</span><br><span class="line">               <span class="keyword">if</span> (paths != <span class="keyword">null</span>) &#123;</span><br><span class="line">                   paths.remove(path);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span> (Watcher w : watchers) &#123;</span><br><span class="line">           <span class="keyword">if</span> (supress != <span class="keyword">null</span> &amp;&amp; supress.contains(w)) &#123;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           w.process(e);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> watchers;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>WatchManagerçš„è§¦å‘é€»è¾‘ï¼š</p><ol><li><p><strong>å°è£…WatchedEventï¼š</strong>å…ˆå°†é€šçŸ¥çŠ¶æ€ï¼ˆKeeperStateï¼‰ã€äº‹ä»¶ç±»å‹ï¼ˆEventTypeï¼‰å’ŒèŠ‚ç‚¹è·¯å¾„å°è£…æˆä¸€ä¸ªWatchedEventå¯¹è±¡ã€‚</p></li><li><p><strong>æŸ¥è¯¢Watcherï¼š</strong>æ ¹æ®èŠ‚ç‚¹è·¯å¾„ä»watchTableä¸­å–å‡ºå¯¹åº”çš„Watcherï¼Œè‹¥æ²¡æ‰¾åˆ°åˆ™è¯´æ˜æ²¡æœ‰å®¢æˆ·ç«¯åœ¨è¯¥èŠ‚ç‚¹æ³¨å†Œè¿‡Watcherï¼Œç›´æ¥é€€å‡ºï¼›è‹¥æ‰¾åˆ°äº†åˆ™å°†å…¶æå–å‡ºæ¥ï¼ŒåŒæ—¶ç›´æ¥ä»watchTableå’Œwatch2Pathsä¸­å°†å…¶åˆ é™¤ï¼ˆ<strong>Watcheråœ¨æœåŠ¡ç«¯æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œç”¨å®ŒåŠåˆ </strong>ï¼‰ã€‚</p></li><li><p><strong>è°ƒç”¨processæ–¹æ³•æ¥è§¦å‘Watcherï¼š</strong>é€ä¸ªè°ƒç”¨æ­¥éª¤2æ‰¾åˆ°çš„Watcherçš„processæ–¹æ³•ï¼Œå³è¯·æ±‚ä¸­çš„ServerCnxnå¯¹åº”æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NIOServerCnxn</span> <span class="keyword">extends</span> <span class="title">ServerCnxn</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚å¤´æ ‡è®°-1ï¼Œæ ‡è¯†å½“å‰æ˜¯ä¸€ä¸ªé€šçŸ¥</span></span><br><span class="line">        ReplyHeader h -= <span class="keyword">new</span> ReplyHeader(-<span class="number">1</span>, -<span class="number">1L</span>, <span class="number">0</span>);</span><br><span class="line">        ......</span><br><span class="line">        <span class="comment">// Convert WatchedEvent to a type that can be sent over the write</span></span><br><span class="line">        <span class="comment">// WatchedEventåŒ…è£…ä¸ºWatcherEventæ–¹ä¾¿ç½‘ç»œä¼ è¾“åºåˆ—åŒ–</span></span><br><span class="line">        WatcherEvent e = event.getWrapper();</span><br><span class="line">        <span class="comment">// å‘å®¢æˆ·ç«¯å‘é€é€šçŸ¥</span></span><br><span class="line">        sendResponse(h, e, <span class="string">"notification"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ServerCnxnä¸­çš„processä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼ŒçœŸæ­£çš„Watcherå›è°ƒå’Œä¸šåŠ¡é€»è¾‘éƒ½åœ¨å®¢æˆ·ç«¯</p></li></ol><h5 id="ï¼ˆ3ï¼‰å®¢æˆ·ç«¯å›è°ƒWatcher"><a href="#ï¼ˆ3ï¼‰å®¢æˆ·ç«¯å›è°ƒWatcher" class="headerlink" title="ï¼ˆ3ï¼‰å®¢æˆ·ç«¯å›è°ƒWatcher"></a>ï¼ˆ3ï¼‰å®¢æˆ·ç«¯å›è°ƒWatcher</h5><ul><li><p><strong>SendThreadæ¥æ”¶äº‹ä»¶é€šçŸ¥ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ZKå®¢æˆ·ç«¯å¦‚ä½•æ¥æ”¶äº‹ä»¶é€šçŸ¥</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// æœåŠ¡ç«¯å“åº”ç»Ÿä¸€å¤„ç†</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">readResponse</span><span class="params">(ByteBuffer incomingBuffer)</span> throw IOException </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (replyHdr.getXid() == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// -1 means notification é€šçŸ¥ç±»å‹çš„å“åº”</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="comment">// 1.å°†å­—èŠ‚æµè½¬æ¢ä¸ºWatcherEventå¯¹è±¡</span></span><br><span class="line">            WatcherEvent event = <span class="keyword">new</span> WatcherEvent();</span><br><span class="line">            event.deserialize(bbia, <span class="string">"response"</span>);</span><br><span class="line">            <span class="comment">// 2.å¤„ç†chrootPath</span></span><br><span class="line">            <span class="comment">// convert from a server path to a client path</span></span><br><span class="line">            <span class="keyword">if</span> (chrootPath != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å¯¹æœåŠ¡ç«¯ä¼ è¿‡æ¥çš„å®Œæ•´å­—èŠ‚è·¯å¾„è¿›è¡Œå¤„ç†ï¼Œç”Ÿæˆå®¢æˆ·ç«¯ä¸€ä¸ªç›¸å¯¹èŠ‚ç‚¹è·¯å¾„</span></span><br><span class="line">                String serverPath = event.getPath();</span><br><span class="line">                <span class="keyword">if</span> (serverPath.compareTo(chrootPath) == <span class="number">0</span>)</span><br><span class="line">                    event.setPath(<span class="string">"/"</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (serverPath.length() &gt; chrootPath.length())</span><br><span class="line">                    event.setPath(serverPath.substring(chrootPath.length()));</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3.è¿˜åŸWatchedEventï¼Œé€‚é…processæ¥å£å‚æ•°</span></span><br><span class="line">            WatchedEvent we = <span class="keyword">new</span> WatchedEvent(event);</span><br><span class="line">            ...</span><br><span class="line">            <span class="comment">// 4.å›è°ƒWatcherï¼Œå°†WatchedEventäº¤ç»™EventThreadçº¿ç¨‹ï¼Œåœ¨ä¸‹ä¸€ä¸ªè½®è¯¢å‘¨æœŸè¿›è¡ŒWatcherå›è°ƒ</span></span><br><span class="line">            eventThread.queueEvent(we);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>EventThreadå¤„ç†äº‹ä»¶é€šçŸ¥ï¼š</strong></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010114.png" alt></p><p>SentThreadé€šè¿‡ <code>EventThread.queueEvent()</code> å°†äº‹ä»¶ä¼ ç»™EventThreadçº¿ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queueEvent</span><span class="params">(WatchedEvent event)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (event.getType() == EventType.None &amp;&amp; sessionState == event.getState()) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       sessionState = event.getState();</span><br><span class="line">       <span class="comment">// materialize the watchers based on the event</span></span><br><span class="line">       WatcherSetEventPair pair = <span class="keyword">new</span> WatcherSetEventPair();</span><br><span class="line">       watcher.materialize(event.getState(), event.getType(), event.getPath(), event));</span><br><span class="line">       <span class="comment">// queue the pair (watch set &amp; event) for later processing</span></span><br><span class="line">       <span class="comment">// å–å‡ºæ‰€æœ‰ç›¸å…³Watcheråï¼Œæ”¾å…¥waitingEventsé˜Ÿåˆ—</span></span><br><span class="line">       waitingEvents.add(pair);</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// æ ¹æ®é€šçŸ¥äº‹ä»¶ï¼Œä»ZKWatchManagerä¸­å–å‡ºæ‰€æœ‰ç›¸å…³Watcher</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Watcher&gt; <span class="title">materialize</span><span class="params">(Watcher.Event.KeeperState state, Watcher.Event.EventType type, String clientPath)</span> </span>&#123;</span><br><span class="line">       Set&lt;Watcher&gt; result = <span class="keyword">new</span> HashSet&lt;Watcher&gt;();</span><br><span class="line">       <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">       ...</span><br><span class="line">           <span class="keyword">case</span> NodeDataChanged:</span><br><span class="line">           <span class="keyword">case</span> NodeCreated:</span><br><span class="line">               <span class="comment">// ä»ç›¸åº”çš„Watcherå­˜å‚¨ä¸­å»é™¤å¯¹åº”çš„Watcherï¼Œå®¢æˆ·ç«¯çš„Watcherä¹Ÿæ˜¯ä¸€æ¬¡æ€§çš„</span></span><br><span class="line">               <span class="keyword">synchronized</span> (dataWatches) &#123;</span><br><span class="line">                   addTo(dataWatches.remove(clientPath), result);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">synchronized</span> (existWatches) &#123;</span><br><span class="line">                   addTo(existWatches.remove(clientPath), result);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           ...</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addTo</span><span class="params">(Set&lt;Watcher&gt; from, Set&lt;Watcher&gt; to)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (from != <span class="keyword">null</span>) &#123;</span><br><span class="line">           to.addAll(from);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>EventThreadçš„runæ–¹æ³•ä¸æ–­å¯¹waitingEventsé˜Ÿåˆ—è¿›è¡Œå¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           isRunning = <span class="keyword">true</span>;</span><br><span class="line">           <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">               Object event = waitingEvents.take();</span><br><span class="line">               <span class="keyword">if</span> (event == eventOfDeath) &#123;</span><br><span class="line">                   wasKilled = <span class="keyword">true</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   processEvent(event);</span><br><span class="line">               &#125;</span><br><span class="line">               ...</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processEvent</span><span class="params">(Object event)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">if</span> (event <span class="keyword">instanceof</span> WatcherSetEventPair) &#123;</span><br><span class="line">               <span class="comment">// each watcher will process the event</span></span><br><span class="line">               WatcherSetEventPair pair = (WatcherSetEventPair) event;</span><br><span class="line">               <span class="comment">// æ¯æ¬¡ä»waitingEventsä¸­å–å‡ºä¸€ä¸ªWatcherå¹¶è¿›è¡Œä¸²è¡ŒåŒæ­¥å¤„ç†</span></span><br><span class="line">               <span class="keyword">for</span> (Watcher watcher : pair.watchers) &#123;</span><br><span class="line">                   <span class="keyword">try</span>&#123;</span><br><span class="line">                       <span class="comment">// è°ƒç”¨processå®Œæˆå›è°ƒ</span></span><br><span class="line">                       watcher.process(pair.event);</span><br><span class="line">                   &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">           ...</span><br></pre></td></tr></table></figure></li></ul><h4 id="1-4-4-Watcherç‰¹æ€§"><a href="#1-4-4-Watcherç‰¹æ€§" class="headerlink" title="1.4.4 Watcherç‰¹æ€§"></a>1.4.4 Watcherç‰¹æ€§</h4><ul><li><strong>ä¸€æ¬¡æ€§ï¼š</strong>æ— è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œä¸€æ—¦Watcherè¢«è§¦å‘ï¼Œå°±ä¼šä»ZKå­˜å‚¨ä¸­åˆ é™¤ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶è¦åå¤æ³¨å†Œï¼Œè¿™æ ·èƒ½å¤Ÿå‡è½»æœåŠ¡å™¨çš„å‹åŠ›ã€‚</li><li><strong>å®¢æˆ·ç«¯ä¸²è¡Œæ‰§è¡Œï¼š</strong>å®¢æˆ·ç«¯Watcherå›è°ƒæ—¶ä¸€ä¸ªä¸²è¡ŒåŒæ­¥è¿‡ç¨‹ï¼Œä¿è¯äº†æ‰§è¡Œé¡ºåºã€‚</li><li><strong>è½»é‡ï¼š</strong>WatchedEventæ˜¯Watcheré€šçŸ¥æœºåˆ¶çš„æœ€å°é€šçŸ¥å•å…ƒï¼ŒåªåŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼ˆé€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„ï¼‰ï¼Œå®¢æˆ·ç«¯éœ€è¦ä¸»åŠ¨å»è·å–æ›´æ–°æ•°æ®ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æ³¨å†ŒWatcheræ—¶ï¼Œæ²¡æœ‰æŠŠçœŸå®Watcherå¯¹è±¡ä¼ ç»™æœåŠ¡ç«¯ï¼Œåªæ˜¯åœ¨è¯·æ±‚ä¸­ä½¿ç”¨Booleanç±»å‹æ ‡è®°ï¼ŒæœåŠ¡ç«¯ä»…ä»…ä¿å­˜äº†å½“å‰è¿æ¥çš„ServerCnxnå¯¹è±¡ã€‚</li></ul><h3 id="1-5-ACLâ€”ä¿éšœæ•°æ®å®‰å…¨"><a href="#1-5-ACLâ€”ä¿éšœæ•°æ®å®‰å…¨" class="headerlink" title="1.5 ACLâ€”ä¿éšœæ•°æ®å®‰å…¨"></a>1.5 ACLâ€”ä¿éšœæ•°æ®å®‰å…¨</h3><h4 id="æƒé™æ¨¡å¼-Scheme"><a href="#æƒé™æ¨¡å¼-Scheme" class="headerlink" title="æƒé™æ¨¡å¼-Scheme"></a>æƒé™æ¨¡å¼-Scheme</h4><p>æƒé™æ¨¡å¼ç”¨æ¥ç¡®å®šæƒé™éªŒè¯è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ£€éªŒç­–ç•¥ï¼Œå¸¸ç”¨çš„å››ç§æƒé™æ¨¡å¼ï¼š</p><ul><li><p><strong>IPï¼š</strong>é€šè¿‡IPåœ°å€ç²’åº¦è¿›è¡Œæƒé™æ§åˆ¶ï¼Œä¹Ÿæ”¯æŒæŒ‰ç½‘æ®µçš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œå¦‚ <code>ip:192.168.0.1/24</code> è¡¨ç¤ºé’ˆå¯¹ <code>192.168.0.*</code> IPæ®µè¿›è¡Œæƒé™æ§åˆ¶ã€‚</p></li><li><p><strong>Digestï¼š</strong></p><ul><li><p>æœ€å¸¸ç”¨çš„æ¨¡å¼ï¼Œç±»ä¼¼äº <code>username:password</code> å½¢å¼çš„æƒé™è¡¨ç¤ºè¿›è¡Œæƒé™æ§åˆ¶æ¥åŒºåˆ†ä¸åŒåº”ç”¨ã€‚</p></li><li><p>ZKå…ˆåä¼šè¿›è¡Œä¸¤æ¬¡ç¼–ç å¤„ç†ï¼Œ<strong>SHA-1ç®—æ³•åŠ å¯†</strong>å’Œ<strong>BASE64ç¼–ç </strong>ï¼Œç”± <code>DigestAuthenticationProvider.generateDigest(String idPassword)</code> å‡½æ•°è¿›è¡Œå°è£…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DigestAuthenticationProviderUsage</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class="line">        System.out.println(DigestAuthenticationProvider.generateDigest(<span class="string">"foo:zk-book"</span>));</span><br><span class="line">        <span class="comment">// è¾“å‡ºï¼šfoo:kWN6aNS.... æ··æ·†æ— åºçš„å­—ç¬¦ä¸²</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>Worldï¼š</strong>æœ€å¼€æ”¾çš„æ¨¡å¼ï¼Œæ•°æ®èŠ‚ç‚¹è®¿é—®å¯¹æ‰€æœ‰ç”¨æˆ·å¼€æ”¾ï¼Œåªæœ‰ä¸€ä¸ªæƒé™æ ‡è¯† <code>world:anyone</code> ã€‚</p></li><li><p><strong>Superï¼š</strong>è¶…çº§ç”¨æˆ·æ¨¡å¼ï¼Œå¯ä»¥å¯¹ä»»æ„ZKèŠ‚ç‚¹è¿›è¡Œä»»æ„æ“ä½œã€‚</p></li></ul><h4 id="æˆæƒå¯¹è±¡-ID"><a href="#æˆæƒå¯¹è±¡-ID" class="headerlink" title="æˆæƒå¯¹è±¡-ID"></a>æˆæƒå¯¹è±¡-ID</h4><p>æˆæƒå¯¹è±¡æŒ‡æƒé™èµ‹äºˆçš„ç”¨æˆ·æˆ–ä¸€ä¸ªæŒ‡å®šå®ä½“ï¼Œå¦‚IPåœ°å€æˆ–æœºå™¨ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210601/202106010115.png" alt></p><h4 id="æƒé™-Permission"><a href="#æƒé™-Permission" class="headerlink" title="æƒé™-Permission"></a>æƒé™-Permission</h4><p>æƒé™æŒ‡é€šè¿‡æƒé™æ£€æŸ¥åå…è®¸æ‰§è¡Œçš„æ“ä½œï¼Œåˆ†ä¸º5ç±»ï¼š</p><ul><li><strong>CREATEï¼š</strong>æ•°æ®èŠ‚ç‚¹çš„åˆ›å»ºæƒé™ï¼Œå…è®¸æˆæƒå¯¹è±¡åœ¨è¯¥æ•°æ®èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹ã€‚</li><li><strong>DELETEï¼š</strong>å­èŠ‚ç‚¹çš„åˆ é™¤æƒé™ï¼Œå…è®¸æˆæƒå¯¹è±¡åˆ é™¤è¯¥æ•°æ®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚</li><li><strong>READï¼š</strong>æ•°æ®èŠ‚ç‚¹çš„è¯»å–æƒé™ï¼Œå…è®¸æˆæƒå¯¹è±¡è®¿é—®è¯¥æ•°æ®èŠ‚ç‚¹å¹¶è¯»å–å…¶æ•°æ®å†…å®¹æˆ–å­èŠ‚ç‚¹åˆ—è¡¨ç­‰ã€‚</li><li><strong>WRITEï¼š</strong>æ•°æ®èŠ‚ç‚¹çš„æ›´æ–°æƒé™ï¼Œå…è®¸æˆæƒå¯¹è±¡å¯¹è¯¥æ•°æ®èŠ‚ç‚¹è¿›è¡Œæ›´æ–°æ“ä½œã€‚</li><li><strong>ADMINï¼š</strong>æ•°æ®èŠ‚ç‚¹çš„ç®¡ç†æƒé™ï¼Œå…è®¸æˆæƒå¯¹è±¡å¯¹è¯¥æ•°æ®èŠ‚ç‚¹è¿›è¡ŒACLç›¸å…³çš„è®¾ç½®æ“ä½œã€‚</li></ul><h4 id="è‡ªå®šä¹‰æ‰©å±•"><a href="#è‡ªå®šä¹‰æ‰©å±•" class="headerlink" title="è‡ªå®šä¹‰æ‰©å±•"></a>è‡ªå®šä¹‰æ‰©å±•</h4><p>ZKå…è®¸å¼€å‘äººå‘˜ç”¨è¿‡æŒ‡å®šæ–¹å¼å¯¹ZKè¿›è¡Œæ‰©å±•ï¼Œå³ Pluggable ZooKeeper Authentication æœºåˆ¶ï¼Œå®ç°æ¥å£AuthenticationProviderï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ZKé»˜è®¤çš„å‡ ç§æƒé™æ¨¡å¼å¯¹åº”DigestAuthenticationProviderå’ŒIPAuthenticationProvider</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AuthenticationProvider</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getScheme</span><span class="params">()</span></span>;</span><br><span class="line">    KeeperException.<span class="function">Code <span class="title">handleAuthentication</span><span class="params">(ServerCnxn cnxn, <span class="keyword">byte</span> authData[])</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(String id, String aclExpr)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAuthenticated</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°è‡ªå®šä¹‰æƒé™æ§åˆ¶å™¨åï¼Œéœ€è¦å°†å…¶æ³¨å†Œåˆ°ZKä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><p><strong>ç³»ç»Ÿå±æ€§ï¼š</strong>å¯åŠ¨å‚æ•°æ·»åŠ é…ç½®ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dzookeeper.authProvider.1=com.zkbook.CustomAuthenticationProvider</span><br></pre></td></tr></table></figure></li><li><p><strong>é…ç½®æ–‡ä»¶ï¼š</strong><code>zoo.cfg</code> ä¸­æ·»åŠ é…ç½®ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authProvider.1=com.zkbook.CustomAuthenticationProvider</span><br></pre></td></tr></table></figure></li></ul><p>æƒé™æ§åˆ¶å™¨æ³¨å†Œé‡‡ç”¨äº†<strong>å»¶è¿ŸåŠ è½½</strong>çš„ç­–ç•¥ï¼Œç¬¬ä¸€æ¬¡å¤„ç†åŒ…å«æƒé™æ§åˆ¶è¯·æ±‚æ—¶æ‰ä¼šè¿›è¡Œæƒé™æ§åˆ¶å™¨çš„åˆå§‹åŒ–ï¼ŒåŒæ—¶ZKå°†æ‰€æœ‰æ§åˆ¶å™¨æ³¨å†Œåˆ°ProviderRegistryä¸­ï¼Œé¡ºåºä¸ºï¼šDigestAuthenticationProviderå’ŒIPAuthenticationProviderå…ˆåˆå§‹åŒ–ï¼Œç„¶åæ‰«æ <code>zookeeper.authProvider</code> è·å–è‡ªå®šä¹‰æ§åˆ¶å™¨å¹¶åˆå§‹åŒ–ã€‚</p><h4 id="ACLç®¡ç†"><a href="#ACLç®¡ç†" class="headerlink" title="ACLç®¡ç†"></a>ACLç®¡ç†</h4><p>é€šè¿‡zkCliè„šæœ¬ç™»å½•ZKæœåŠ¡å™¨åï¼Œé€šè¿‡ä¸¤ç§æ–¹å¼è®¾ç½®ACLï¼š</p><ul><li><p><strong>æ•°æ®èŠ‚ç‚¹åˆ›å»ºçš„åŒæ—¶è¿›è¡ŒACLæƒé™çš„è®¾ç½®ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤æ ¼å¼</span></span><br><span class="line">create [-s] [-e] path data acl</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> create -e /zk-book init digest: foo:MiHs3Eiylp......</span></span><br><span class="line">Created /zk-book</span><br><span class="line"><span class="meta">$</span><span class="bash"> getAcl /zk-book</span></span><br><span class="line">'digest,'foo:MiHs3Eiylp......</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ <code>setAcl</code> å‘½ä»¤å•ç‹¬å¯¹å·²ç»å­˜åœ¨çš„æ•°æ®èŠ‚ç‚¹è¿›è¡ŒACLè®¾ç½®ï¼š</strong>ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">setAcl path acl</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> create -e /zk-book init</span></span><br><span class="line">Created /zk-book</span><br><span class="line"><span class="meta">$</span><span class="bash"> setAcl /zk-book digest:foo:MiHs3Eiylp......</span></span><br><span class="line">cZxid = 0x400000042</span><br><span class="line">ctime = ......</span><br><span class="line">mZxid = 0x400000042</span><br><span class="line">mtime = ......</span><br><span class="line">pZxid = 0x400000042</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 1</span><br><span class="line">ephemeralOwner = 0x1472ff49b020003</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br><span class="line"><span class="meta">$</span><span class="bash"> getAcl /zk-book</span></span><br><span class="line">'digest,'foo:MiHs3Eiylp......</span><br></pre></td></tr></table></figure></li></ul><p>ä¸€æ—¦å¯¹ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹è®¾ç½®äº†ACLæƒé™æ§åˆ¶ï¼Œæ²¡æœ‰æˆæƒçš„ZKå®¢æˆ·ç«¯å°±æ— æ³•è®¿é—®è¯¥æ•°æ®èŠ‚ç‚¹ï¼Œä½†å¦‚æœä¸€ä¸ªæŒä¹…æ•°æ®èŠ‚ç‚¹åŒ…å«äº†ACLæƒé™æ§åˆ¶ï¼Œå…¶åˆ›å»ºå®¢æˆ·ç«¯å·²ä¸å†ä½¿ç”¨ï¼Œè¿™äº›æ•°æ®èŠ‚ç‚¹å¦‚ä½•æ¸…ç†ï¼Ÿ<strong>Superæ¨¡å¼</strong>ä¸‹ä½¿ç”¨è¶…çº§ç®¡ç†å‘˜æƒé™ã€‚</p><p>ZKæœåŠ¡å™¨å¯åŠ¨æ—¶æ·»åŠ å¦‚ä¸‹ç³»ç»Ÿå±æ€§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># fooè¡¨ç¤ºç®¡ç†å‘˜åï¼Œåç»­å­—ç¬¦ä¸²ç”±ç®¡ç†å‘˜è‡ªä¸»é…ç½®</span><br><span class="line">-Dzookeeper.DigestAuthenticationProvider.superDigest=foo:MiHs3Eiylp......</span><br></pre></td></tr></table></figure><p>åº”ç”¨ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthSampleSuper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String PATH = <span class="string">"/zk-book"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ZooKeeper zk1 = <span class="keyword">new</span> ZooKeeper(<span class="string">"domain1.book.zookeeper:2181"</span>, <span class="number">5000</span>, <span class="keyword">null</span>);</span><br><span class="line">        zk1.addAuthInfo(<span class="string">"digest"</span>, <span class="string">"foo:true"</span>.getBytes());</span><br><span class="line">        zk1.create(PATH, <span class="string">"init"</span>.getBytes(), Ids.CREATOR_ALL_ACL, CreateMode.EPHEMERAL);</span><br><span class="line">        ZooKeeper zk2 = <span class="keyword">new</span> ZooKeeper(<span class="string">"domain1.book.zookeeper:2181"</span>, <span class="number">50000</span>, <span class="keyword">null</span>);</span><br><span class="line">        zk2.addAuthInfo(<span class="string">"digest"</span>, <span class="string">"foo:zk-book"</span>.getBytes());</span><br><span class="line">        System.out.println(zk2.getData(PATH, <span class="keyword">false</span>, <span class="keyword">null</span>));</span><br><span class="line">        ZooKeeper zk3 = <span class="keyword">new</span> ZooKeeper(<span class="string">"domain1.book.zookeeper:2181"</span>, <span class="number">50000</span>, <span class="keyword">null</span>);</span><br><span class="line">        zk3.addAuthInfo(<span class="string">"digest"</span>, <span class="string">"foo:false"</span>.getBytes());</span><br><span class="line">        System.out.println(zk3.getData(PATH, <span class="keyword">false</span>, <span class="keyword">null</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º org.apache.zookeeper.KeeperException$NoAuthException: KeeperErrorCode = NoAuth for /zk-book foo:falseæ— æ³•é€šè¿‡æƒé™æ ¡éªŒï¼Œfoo:zk-bookè¶…çº§ç®¡ç†å‘˜å¯ä»¥éšæ„è¿›è¡Œæ“ä½œ</span></span><br></pre></td></tr></table></figure><h2 id="äºŒ-åºåˆ—åŒ–ä¸åè®®"><a href="#äºŒ-åºåˆ—åŒ–ä¸åè®®" class="headerlink" title="äºŒ. åºåˆ—åŒ–ä¸åè®®"></a>äºŒ. åºåˆ—åŒ–ä¸åè®®</h2><h2 id="ä¸‰-å®¢æˆ·ç«¯"><a href="#ä¸‰-å®¢æˆ·ç«¯" class="headerlink" title="ä¸‰. å®¢æˆ·ç«¯"></a>ä¸‰. å®¢æˆ·ç«¯</h2><h2 id="å››-ä¼šè¯"><a href="#å››-ä¼šè¯" class="headerlink" title="å››. ä¼šè¯"></a>å››. ä¼šè¯</h2><h2 id="äº”-æœåŠ¡å™¨å¯åŠ¨"><a href="#äº”-æœåŠ¡å™¨å¯åŠ¨" class="headerlink" title="äº”. æœåŠ¡å™¨å¯åŠ¨"></a>äº”. æœåŠ¡å™¨å¯åŠ¨</h2><h2 id="å…­-Leaderé€‰ä¸¾"><a href="#å…­-Leaderé€‰ä¸¾" class="headerlink" title="å…­. Leaderé€‰ä¸¾"></a>å…­. Leaderé€‰ä¸¾</h2><h2 id="ä¸ƒ-å„æœåŠ¡å™¨è§’è‰²ä»‹ç»"><a href="#ä¸ƒ-å„æœåŠ¡å™¨è§’è‰²ä»‹ç»" class="headerlink" title="ä¸ƒ. å„æœåŠ¡å™¨è§’è‰²ä»‹ç»"></a>ä¸ƒ. å„æœåŠ¡å™¨è§’è‰²ä»‹ç»</h2><h2 id="å…«-è¯·æ±‚å¤„ç†"><a href="#å…«-è¯·æ±‚å¤„ç†" class="headerlink" title="å…«. è¯·æ±‚å¤„ç†"></a>å…«. è¯·æ±‚å¤„ç†</h2><h2 id="ä¹-æ•°æ®ä¸å­˜å‚¨"><a href="#ä¹-æ•°æ®ä¸å­˜å‚¨" class="headerlink" title="ä¹. æ•°æ®ä¸å­˜å‚¨"></a>ä¹. æ•°æ®ä¸å­˜å‚¨</h2><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹æ¥è‡ªã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="zookeeper" scheme="http://linyishui.top/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>ZooKeeperï¼ˆå››ï¼‰åº”ç”¨åœºæ™¯ä¸å®ç°</title>
    <link href="http://linyishui.top/2021052001.html"/>
    <id>http://linyishui.top/2021052001.html</id>
    <published>2021-05-20T07:03:45.000Z</published>
    <updated>2021-06-13T14:02:36.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ZooKeeperï¼ˆå››ï¼‰åº”ç”¨åœºæ™¯ä¸å®ç°"><a href="#ZooKeeperï¼ˆå››ï¼‰åº”ç”¨åœºæ™¯ä¸å®ç°" class="headerlink" title="ZooKeeperï¼ˆå››ï¼‰åº”ç”¨åœºæ™¯ä¸å®ç°"></a>ZooKeeperï¼ˆå››ï¼‰åº”ç”¨åœºæ™¯ä¸å®ç°</h1><h2 id="ä¸€-å…¸å‹åº”ç”¨åœºæ™¯"><a href="#ä¸€-å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸€. å…¸å‹åº”ç”¨åœºæ™¯"></a>ä¸€. å…¸å‹åº”ç”¨åœºæ™¯</h2><p>ZooKeeperæ˜¯ä¸€ä¸ªé«˜å¯ç”¨çš„åŸºäºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„åˆ†å¸ƒå¼æ•°æ®ç®¡ç†å’Œåè°ƒæ¡†æ¶ï¼ŒåŸºäºZABç®—æ³•ï¼ŒZKå¯ä»¥å¾ˆå¥½çš„ä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒçš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><h3 id="1-1-æ•°æ®å‘å¸ƒ-è®¢é˜…"><a href="#1-1-æ•°æ®å‘å¸ƒ-è®¢é˜…" class="headerlink" title="1.1 æ•°æ®å‘å¸ƒ/è®¢é˜…"></a>1.1 æ•°æ®å‘å¸ƒ/è®¢é˜…</h3><p>æ•°æ®å‘å¸ƒ/è®¢é˜…ï¼ˆé…ç½®ä¸­å¿ƒï¼‰ï¼š<strong>å‘å¸ƒè€…å°†æ•°æ®å‘å¸ƒåˆ°ZKçš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—èŠ‚ç‚¹ä¸Šï¼Œè®¢é˜…è€…è¿›è¡Œè®¢é˜…ï¼Œä»è€ŒåŠ¨æ€çš„è·å–æ•°æ®ï¼Œå®ç°é…ç½®ä¿¡æ¯çš„é›†ä¸­å¼ç®¡ç†å’Œæ•°æ®çš„åŠ¨æ€æ›´æ–°</strong>ã€‚</p><p>å‘å¸ƒ/è®¢é˜…ç³»ç»Ÿä¸€èˆ¬éƒ½åŒ…å«ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼š<strong>æ¨å’Œæ‹‰æ¨¡å¼</strong>ã€‚æ¨æ¨¡å¼ä¸‹æœåŠ¡ç«¯ä¸»åŠ¨å°†æ•°æ®æ›´æ–°å‘é€ç»™æ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯ï¼Œæ‹‰æ¨¡å¼ä¸‹åˆ™æ˜¯ç”±å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¯·æ±‚è·å–æœ€æ–°æ•°æ®ï¼ˆè½®è¯¢ï¼‰ã€‚ZKå°†æ¨æ‹‰ç»“åˆï¼Œ<strong>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æ³¨å†Œè‡ªå·±æ„Ÿå…´è¶£çš„èŠ‚ç‚¹ï¼Œå½“èŠ‚ç‚¹æ•°æ®å˜æ›´ï¼ŒæœåŠ¡ç«¯å‘é€Watcheräº‹ä»¶é€šçŸ¥ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯åä¸»åŠ¨è·å–æœ€æ–°æ•°æ®</strong>ã€‚</p><p>æ¡ˆä¾‹ï¼šç³»ç»Ÿä¸­éœ€è¦ä¸€äº›é€šç”¨çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æœºå™¨åˆ—è¡¨ä¿¡æ¯ã€è¿è¡Œæ—¶çš„å¼€å…³é…ç½®ã€æ•°æ®åº“é…ç½®ä¿¡æ¯ç­‰ï¼Œè¿™äº›å…¨å±€çš„é…ç½®ä¿¡æ¯é€šå¸¸æœ‰3ä¸ªç‰¹æ€§ï¼š</p><ul><li>æ•°æ®é‡è¾ƒå°</li><li>æ•°æ®å†…å®¹ä¼šåœ¨è¿è¡Œæ—¶å‘ç”ŸåŠ¨æ€å˜åŒ–</li><li>é›†ç¾¤ä¸­å„æœºå™¨å…±äº«ï¼Œé…ç½®ä¸€è‡´</li></ul><p>å•æœºç³»ç»Ÿé€šå¸¸ä¼šé‡‡ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶æˆ–å†…å­˜å˜é‡ï¼ˆJMXæ¥å®ç°å¯¹ç³»ç»Ÿè¿è¡Œæ—¶å†…å­˜å˜é‡çš„æ›´æ–°ï¼‰çš„æ–¹å¼ï¼Œä½†å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´è¿™ä¸¤å¼ æ–¹å¼æ¯”è¾ƒéš¾ç®¡ç†ã€‚</p><ul><li><p><strong>é…ç½®å­˜å‚¨ï¼š</strong></p><p>é¦–å…ˆå°†åˆå§‹åŒ–é…ç½®å­˜æ”¾åœ¨ZKä¸Šï¼Œé€‰å–ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010101.png" alt></p><p>å†™å…¥é…ç½®ä¿¡æ¯ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DBCP</span></span><br><span class="line"><span class="string">dbcp.driverClassName=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="string">dbcp.dbJDBCUrl=jdbc:mysql://1.1.1.1:3306/taokeeper</span></span><br><span class="line"><span class="string">dbcp.characterEncoding=GBK</span></span><br><span class="line"><span class="string">dbcp.username=xiaoming</span></span><br><span class="line"><span class="string">dbcp.password=123456</span></span><br><span class="line"><span class="string">dbcp.maxActive=30</span></span><br><span class="line"><span class="string">dbcp.maxIdle=10</span></span><br><span class="line"><span class="string">dbcp.maxWait=10000</span></span><br></pre></td></tr></table></figure></li><li><p><strong>é…ç½®è·å–ï¼š</strong>æ¯ä¸ªå®¢æˆ·ç«¯å¯åŠ¨æ—¶ä»ZKèŠ‚ç‚¹ä¸Šè¯»å–é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨è¯¥é…ç½®èŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€ä¸ªæ•°æ®å˜æ›´çš„Watcherç›‘å¬ï¼Œä¸€æ—¦æ•°æ®å‘ç”Ÿå˜æ›´ï¼Œæ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯éƒ½èƒ½æ”¶åˆ°é€šçŸ¥ã€‚</p></li><li><p><strong>é…ç½®å˜æ›´ï¼š</strong>è¿è¡Œæ—¶å¯èƒ½è¦åˆ‡æ¢æ•°æ®åº“ï¼Œæ­¤æ—¶åªéœ€å¯¹ZKèŠ‚ç‚¹ä¸Šçš„é…ç½®ä¿¡æ¯è¿›è¡Œæ›´æ”¹ã€‚</p></li></ul><h3 id="1-2-è´Ÿè½½å‡è¡¡"><a href="#1-2-è´Ÿè½½å‡è¡¡" class="headerlink" title="1.2 è´Ÿè½½å‡è¡¡"></a>1.2 è´Ÿè½½å‡è¡¡</h3><p>è´Ÿè½½å‡è¡¡å³å¯¹å¤šå°æœºå™¨ã€ç½‘ç»œè¿æ¥ã€CPUã€ç£ç›˜é©±åŠ¨æˆ–å…¶ä»–èµ„æºè¿›è¡Œåˆ†é…è´Ÿè½½ï¼Œä»¥è¾¾åˆ°ä¼˜åŒ–èµ„æºä½¿ç”¨ã€æœ€å¤§åŒ–ååç‡ã€æœ€å°åŒ–å“åº”æ—¶é—´å’Œé¿å…è¿‡è½½çš„ç›®çš„ã€‚</p><p>åˆ†å¸ƒå¼ç³»ç»Ÿå…·æœ‰å¯¹ç­‰æ€§ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œé€šå¸¸é‡‡ç”¨å‰¯æœ¬çš„æ–¹å¼æ¥å¯¹æ•°æ®å’ŒæœåŠ¡è¿›è¡Œéƒ¨ç½²ï¼Œå¯¹äºæ¶ˆè´¹è€…è€Œè¨€éœ€è¦åœ¨è¿™äº›å¯¹ç­‰çš„æœåŠ¡æä¾›æ–¹é€‰æ‹©ä¸€ä¸ªæ¥æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</p><p>å…¸å‹çš„è´Ÿè½½å‡è¡¡å¦‚<strong>DNS</strong>ï¼Œå³<strong>åŸŸåç³»ç»Ÿ</strong>ï¼ˆDomain Name Systemï¼‰ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¶…å¤§è§„æ¨¡çš„åˆ†å¸ƒå¼æ˜ å°„è¡¨ï¼Œç”¨äºå°†åŸŸåå’ŒIPåœ°å€è¿›è¡Œä¸€ä¸€æ˜ å°„ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨åŸŸåæ¥è®¿é—®äº’è”ç½‘ç«™ç‚¹ã€‚</p><p>æˆ‘ä»¬åªèƒ½æ³¨å†Œæœ‰é™çš„åŸŸåï¼Œå½“ç³»ç»Ÿè§„æ¨¡å˜å¤§ï¼Œå¾ˆéš¾é€šè¿‡ç»Ÿä¸€çš„DNSé…ç½®æ¥ç®¡ç†ã€‚å¯ä»¥ä½¿ç”¨æœ¬åœ°HOSTç»‘å®šæ¥å®ç°åŸŸåè§£æçš„å·¥ä½œï¼Œè§£å†³äº†åŸŸåç´§å¼ çš„é—®é¢˜ï¼Œå¯ä»¥éšæ—¶ä¿®æ”¹åŸŸåå’ŒIPçš„æ˜ å°„ï¼Œä½†æœºå™¨è§„æ¨¡æ‰©å¤§æ—¶ï¼Œç³»ç»Ÿä¸Šçº¿å‰è¦åœ¨æ¯å°æœºå™¨ä¸Šç»‘å®šåŸŸåä¼šéå¸¸ä¸æ–¹ä¾¿ï¼Œå¦‚æœéœ€è¦ä¸´æ—¶æ›´æ–°åŸŸåè¿˜éœ€è¦åˆ°æ¯å°æœºå™¨ä¸Šå˜æ›´ã€‚</p><h4 id="ï¼ˆ1ï¼‰åŠ¨æ€DNSæœåŠ¡"><a href="#ï¼ˆ1ï¼‰åŠ¨æ€DNSæœåŠ¡" class="headerlink" title="ï¼ˆ1ï¼‰åŠ¨æ€DNSæœåŠ¡"></a>ï¼ˆ1ï¼‰åŠ¨æ€DNSæœåŠ¡</h4><ul><li><p><strong>é…ç½®ç®¡ç†ï¼š</strong></p><p>é¦–å…ˆè¦åœ¨ZKä¸Šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹è¿›è¡ŒåŸŸåé…ç½®ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010102.png" alt></p><p>æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥åˆ›å»ºä¸€ä¸ªå±äºè‡ªå·±çš„æ•°æ®èŠ‚ç‚¹ä½œä¸ºåŸŸåé…ç½®çš„æ ¹èŠ‚ç‚¹ï¼Œé…ç½®æ¸…å•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å•ä¸ªIP:PORT</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8080</span></span><br><span class="line"><span class="comment">#å¤šä¸ªIP:PORT</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8080,</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.2</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure></li><li><p><strong>åŸŸåè§£æï¼š</strong></p><p>ä¼ ç»ŸDNSè§£æçš„å·¥ä½œç”±æ“ä½œç³»ç»Ÿçš„åŸŸåå’ŒIPåœ°å€æ˜ å°„æœºåˆ¶æˆ–åŸŸåè§£ææœåŠ¡å™¨å®Œæˆã€‚è€ŒZKå®ç°çš„DDNSåˆ™éœ€è¦æ¯ä¸ªåº”ç”¨è‡ªå·±ä»ZKæ•°æ®èŠ‚ç‚¹ä¸Šè·å–ä¸€ä»½IPåœ°å€å’Œç«¯å£çš„é…ç½®ï¼Œå¹¶è‡ªè¡Œè§£æã€‚æ¯ä¸ªåº”ç”¨éƒ½ä¼šåœ¨åŸŸåèŠ‚ç‚¹æ³¨å†Œä¸€ä¸ªæ•°æ®å˜æ›´Watcherç›‘å¬ã€‚</p></li><li><p><strong>åŸŸåå˜æ›´ï¼š</strong></p><p>è¿è¡Œè¿‡ç¨‹ä¸­è¦æ›´æ–°IPåœ°å€æˆ–ç«¯å£æ—¶ï¼Œåªéœ€å¯¹æŒ‡å®šçš„åŸŸåèŠ‚ç‚¹è¿›è¡Œæ›´æ–°æ“ä½œï¼ŒZKä¼šå‘è®¢é˜…çš„å®¢æˆ·ç«¯å‘é€é€šçŸ¥ã€‚</p></li></ul><h4 id="ï¼ˆ2ï¼‰è‡ªåŠ¨åŒ–çš„DNSæœåŠ¡"><a href="#ï¼ˆ2ï¼‰è‡ªåŠ¨åŒ–çš„DNSæœåŠ¡" class="headerlink" title="ï¼ˆ2ï¼‰è‡ªåŠ¨åŒ–çš„DNSæœåŠ¡"></a>ï¼ˆ2ï¼‰è‡ªåŠ¨åŒ–çš„DNSæœåŠ¡</h4><p>ä¸Šè¿°å®ç°åœ¨åŸŸåå˜æ›´çš„ç¯èŠ‚è¿˜æ˜¯éœ€è¦äººä¸ºçš„ä»‹å…¥å–ä¿®æ”¹åŸŸåèŠ‚ç‚¹ä¸Šçš„IPåœ°å€å’Œç«¯å£ï¼ŒZKå®ç°äº†è‡ªåŠ¨åŒ–çš„DNSæœåŠ¡ä¸ºäº†å®ç°æœåŠ¡çš„è‡ªåŠ¨åŒ–å®šä½ï¼Œç³»ç»Ÿæ¶æ„å¦‚ä¸‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010103.png" alt></p><p>é‡è¦çš„ç»„ä»¶ï¼š</p><ul><li><strong>Registerï¼š</strong>é›†ç¾¤è´Ÿè´£åŸŸåçš„åŠ¨æ€æ³¨å†Œ</li><li><strong>Dispatcherï¼š</strong>é›†ç¾¤è´Ÿè´£åŸŸåè§£æ</li><li><strong>Scannerï¼š</strong>é›†ç¾¤è´Ÿè´£æ£€æµ‹ä»¥åŠç»´æŠ¤æœåŠ¡çŠ¶æ€ï¼ˆæ¢æµ‹æœåŠ¡çš„å¯ç”¨æ€§ã€å±è”½å¼‚å¸¸æœåŠ¡èŠ‚ç‚¹ç­‰ï¼‰</li><li><strong>SDKï¼š</strong>æä¾›å„ç§è¯­è¨€çš„ç³»ç»Ÿæ¥å…¥åè®®ï¼Œæä¾›æœåŠ¡æ³¨å†Œä»¥åŠæŸ¥è¯¢æ¥å£</li><li><strong>Monitorï¼š</strong>è´Ÿè´£æ”¶é›†æœåŠ¡ä¿¡æ¯ä»¥åŠå¯¹DDNSè‡ªèº«çŠ¶æ€çš„ç›‘æ§</li><li><strong>Controllerï¼š</strong>åå°ç®¡ç†çš„Consoleï¼Œè´Ÿè´£æˆæƒç®¡ç†ã€æµé‡æ§åˆ¶ã€é™æ€é…ç½®æœåŠ¡å’Œæ‰‹åŠ¨å±è”½æœåŠ¡ç­‰åŠŸèƒ½ï¼Œè¿ç»´äººå‘˜å¯ä»¥åœ¨ä¸Šé¢ç®¡ç†Registerã€Dispatcherã€Scannerç­‰é›†ç¾¤ã€‚</li></ul><p>è‡ªåŠ¨åŒ–DNSæµç¨‹ï¼š</p><ul><li><p><strong>åŸŸåæ³¨å†Œï¼š</strong></p><p>æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨è¿‡ç¨‹æŠŠè‡ªå·±çš„åŸŸåä¿¡æ¯æ³¨å†Œåˆ° Register é›†ç¾¤ä¸­å»</p><ol><li>æœåŠ¡æä¾›è€…é€šè¿‡SDKæä¾›çš„APIæ¥å£ï¼Œå°†åŸŸåã€IPåœ°å€å’Œç«¯å£å‘é€ç»™ Register é›†ç¾¤ã€‚</li><li>Register æ”¶åˆ°åæ ¹æ®åŸŸåå°†ä¿¡æ¯å†™å…¥ç›¸åº”çš„ZKåŸŸåèŠ‚ç‚¹ä¸­ã€‚</li></ol></li><li><p><strong>åŸŸåè§£æï¼š</strong>ä¸åŸŸåæ³¨å†Œè¿‡ç¨‹ç›¸åï¼ŒæœåŠ¡æ¶ˆè´¹è€…åœ¨ä½¿ç”¨åŸŸåæ—¶ï¼Œä¼šå‘ Dispatcher å‘å‡ºåŸŸåè§£æè¯·æ±‚ã€‚Dispatcher æ”¶åˆ°è¯·æ±‚åï¼Œä¼šä»ZKä¸ŠæŒ‡å®šåŸŸåèŠ‚ç‚¹è¯»å–ç›¸åº”çš„IP:PORTåˆ—è¡¨ï¼Œé€šè¿‡ä¸€å®šçš„ç­–ç•¥é€‰å–ä¸€ä¸ªè¿”å›ç»™å‰ç«¯åº”ç”¨ã€‚</p></li><li><p><strong>åŸŸåæ¢æµ‹ï¼š</strong></p><p>æŒ‡DDNSç³»ç»Ÿå¯¹åŸŸåä¸‹æ‰€æœ‰æ³¨å†Œçš„IPåœ°å€å’Œç«¯å£è¿›è¡Œå¯ç”¨æ€§æ£€æµ‹/å¥åº·åº¦æ£€æµ‹ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>æœåŠ¡ç«¯ä¸»åŠ¨å‘èµ·å¥åº·åº¦å¿ƒè·³æ£€æµ‹ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹èµ·ä¸€ä¸ªTCPé•¿é“¾æ¥ï¼›</li><li>å®¢æˆ·ç«¯ä¸»åŠ¨å‘æœåŠ¡ç«¯å‘èµ·å¥åº·åº¦å¿ƒè·³æ£€æµ‹ã€‚</li></ol><p>DDNSæ¶æ„ä¸­çš„åŸŸåæ£€æµ‹ä½¿ç”¨çš„æ˜¯æœåŠ¡æä¾›è€…ä¸»åŠ¨å®šæ—¶å‘Scannerè¿›è¡ŒçŠ¶æ€æ±‡æŠ¥çš„æ¨¡å¼ï¼ˆç¬¬äºŒç§ï¼‰ã€‚Scannerè´Ÿè´£è®°å½•æ¯ä¸ªæœåŠ¡æä¾›è€…æœ€è¿‘ä¸€æ¬¡çš„çŠ¶æ€æ±‡æŠ¥æ—¶é—´ï¼Œä¸€æ—¦è¶…è¿‡5ç§’æ²¡æœ‰æ”¶åˆ°çŠ¶æ€æ±‡æŠ¥å°±è®¤å®šæ­¤IPå’Œç«¯å£ä¸å¯ç”¨ï¼Œå¹¶è¿›è¡ŒåŸŸåæ¸…ç†è¿‡ç¨‹ã€‚</p><p>åŸŸåæ¸…ç†ï¼ŒScannerä¼šåœ¨ZKä¸­æ‰¾åˆ°å¯¹äºåŸŸåèŠ‚ç‚¹ï¼Œå¹¶å°†IPå’Œç«¯å£é…ç½®ä»èŠ‚ç‚¹å†…å®¹ä¸­ç§»é™¤ã€‚</p></li></ul><h3 id="1-3-å‘½åæœåŠ¡"><a href="#1-3-å‘½åæœåŠ¡" class="headerlink" title="1.3 å‘½åæœåŠ¡"></a>1.3 å‘½åæœåŠ¡</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¢«å‘½åçš„å®ä½“é€šå¸¸æ˜¯é›†ç¾¤ä¸­çš„æœºå™¨ã€æä¾›çš„æœåŠ¡åœ°å€æˆ–è¿œç¨‹å¯¹è±¡ç­‰ï¼Œè¾ƒå¸¸è§çš„æ˜¯ä¸€äº›åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶RPCæˆ–RMIä¸­çš„æœåŠ¡åœ°å€åˆ—è¡¨ï¼Œé€šè¿‡å‘½åæœåŠ¡ï¼Œå®¢æˆ·ç«¯åº”ç”¨èƒ½å¤Ÿæ ¹æ®æŒ‡å®šåå­—æ¥è·å–èµ„æºçš„å®ä½“ã€æœåŠ¡åœ°å€å’Œæä¾›è€…çš„ä¿¡æ¯ç­‰ã€‚</p><ul><li>Javaçš„JNDIï¼ˆJavaå‘½åä¸ç›®å½•æ¥å£ï¼ŒJava Naming and Directory Interfaceï¼‰æ˜¯ä¸€ç§å…¸å‹çš„å‘½åæœåŠ¡ï¼Œæ ‡å‡†çš„J2EEå®¹å™¨éƒ½æä¾›äº†å¯¹JNDIè§„èŒƒçš„å®ç°ï¼Œå¯ä»¥ç”¨æ¥å®Œæˆæ•°æ®æºçš„é…ç½®å’Œç®¡ç†ã€‚</li><li>ZKçš„å‘½åæœåŠ¡ï¼Œä¸Šå±‚åº”ç”¨åªéœ€ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„åå­—ï¼Œç±»ä¼¼äºå”¯ä¸€ä¸»é”®ã€‚</li></ul><p>ä½¿ç”¨ZKæ¥å®ç°ä¸€å¥—åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€IDçš„åˆ†é…æœºåˆ¶ï¼šæ•°æ®åº“çš„å•åº“å•è¡¨å¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„ <code>auto_increment</code> å±æ€§æ¥è‡ªåŠ¨ä¸ºæ¯æ¡è®°å½•ç”Ÿæˆä¸€ä¸ªå”¯ä¸€IDï¼Œä½†éšç€æ•°æ®åº“æ•°æ®è§„æ¨¡ä¸æ–­å¢å¤§ï¼Œåˆ†åº“åˆ†è¡¨åè¿™ä¸ªå±æ€§å°±åªèƒ½é’ˆå¯¹å•ä¸€è¡¨ä¸­è®°å½•è‡ªåŠ¨ç”ŸæˆIDã€‚</p><p>UUIDï¼ˆé€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ŒUniversally Unique Identifierï¼‰åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸ç”¨äºä½œå”¯ä¸€æ ‡è¯†å…ƒç´ æ ‡å‡†ï¼Œä¸€ä¸ªæ ‡å‡†çš„UUIDæ˜¯ä¸€ä¸ªåŒ…å«32ä½å­—ç¬¦å’Œ4ä¸ªçŸ­çº¿çš„å­—ç¬¦ä¸²ã€‚</p><p>UUIDçš„ç¼ºç‚¹ï¼š</p><ul><li>é•¿åº¦è¿‡é•¿ï¼šç”Ÿæˆçš„å­—ç¬¦ä¸²è¿‡é•¿ï¼Œç›¸æ¯”INTç±»å‹å­˜å‚¨å¼€é”€æ›´å¤§ã€‚</li><li>å«ä¹‰ä¸æ˜ï¼šå­—ç¬¦ä¸²æœ¬èº«æ²¡æœ‰å«ä¹‰ã€‚</li></ul><p>å¯ä»¥é€šè¿‡ZKèŠ‚ç‚¹æ¥ç”Ÿæˆå…¨å±€å”¯ä¸€IDï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010104.png" alt></p><p>ZKä¸­æ¯ä¸ªæ•°æ®èŠ‚ç‚¹éƒ½èƒ½ç»´æŠ¤ä¸€ä»½å­èŠ‚ç‚¹çš„é¡ºåºé˜Ÿåˆ—ï¼Œå½“å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªé¡ºåºå­èŠ‚ç‚¹æ—¶ï¼ŒZKä¼šè‡ªåŠ¨ä»¥åç¼€çš„å½¢å¼åœ¨å­èŠ‚ç‚¹ä¸Šæ·»åŠ ä¸€ä¸ªåºå·ï¼š</p><ol><li>æ‰€æœ‰å®¢æˆ·ç«¯æ ¹æ®è‡ªå·±çš„ä»»åŠ¡ç±»å‹ï¼Œåœ¨æŒ‡å®šç±»å‹çš„ä»»åŠ¡ä¸‹é€šè¿‡è°ƒç”¨ <code>create()</code> æ¥å£æ¥åˆ›å»ºä¸€ä¸ªé¡ºåºèŠ‚ç‚¹ï¼ˆå¦‚â€œjob-â€èŠ‚ç‚¹ï¼‰ã€‚</li><li>èŠ‚ç‚¹åˆ›å»ºå®Œæ¯•ï¼Œ <code>create()</code> è¿”å›ä¸€ä¸ªå®Œæ•´çš„èŠ‚ç‚¹åï¼ˆå¦‚â€œjob-0000000003â€ï¼‰ã€‚</li><li>å®¢æˆ·ç«¯æ‹¿åˆ°è¿”å›å€¼åï¼Œæ‹¼æ¥ä¸Štypeç±»å‹ï¼ˆå¦‚â€œtype2-job-0000000003â€ï¼‰ä½œä¸ºå…¨å±€å”¯ä¸€IDã€‚</li></ol><h3 id="1-4-åˆ†å¸ƒå¼åè°ƒ-é€šçŸ¥"><a href="#1-4-åˆ†å¸ƒå¼åè°ƒ-é€šçŸ¥" class="headerlink" title="1.4 åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥"></a>1.4 åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦å¼•å…¥ä¸€ä¸ªåè°ƒè€…ï¼ˆCoordinatorï¼‰æ§åˆ¶æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæµç¨‹ï¼ˆå¦‚åˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†æˆ–æœºå™¨é—´çš„äº’ç›¸åè°ƒç­‰ï¼‰ä¾¿äºå°†åˆ†å¸ƒå¼åè°ƒçš„èŒè´£ä»åº”ç”¨æœ¬èº«æŠ½ç¦»ï¼Œå‡å°‘ç³»ç»Ÿé—´çš„è€¦åˆæ€§ï¼Œæä¾›å¯æ‰©å±•æ€§ã€‚</p><p>åŸºäºZKå®ç°çš„åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥é€šå¸¸åšæ³•ï¼šä¸åŒçš„å®¢æˆ·ç«¯éƒ½å¯¹ZKä¸ŠåŒä¸€ä¸ªæ•°æ®èŠ‚ç‚¹è¿›è¡ŒWatcheræ³¨å†Œï¼Œç›‘å¬æ•°æ®èŠ‚ç‚¹çš„å˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œæ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯éƒ½èƒ½æ”¶åˆ°å¹¶å¤„ç†ã€‚</p><h4 id="ï¼ˆ1ï¼‰MySQLæ•°æ®å¤åˆ¶æ€»çº¿-Mysql-Replicator"><a href="#ï¼ˆ1ï¼‰MySQLæ•°æ®å¤åˆ¶æ€»çº¿-Mysql-Replicator" class="headerlink" title="ï¼ˆ1ï¼‰MySQLæ•°æ®å¤åˆ¶æ€»çº¿-Mysql_Replicator"></a>ï¼ˆ1ï¼‰MySQLæ•°æ®å¤åˆ¶æ€»çº¿-Mysql_Replicator</h4><p>MySQLæ•°æ®å¤åˆ¶æ€»çº¿æ˜¯ä¸€ä¸ªå®æ—¶æ•°æ®å¤åˆ¶æ¡†æ¶ï¼Œ<strong>ç”¨äºåœ¨ä¸åŒçš„MySQLæ•°æ®åº“å®ä¾‹ä¹‹é—´è¿›è¡Œå¼‚æ­¥æ•°æ®å¤åˆ¶åˆæ•°æ®å˜åŒ–é€šçŸ¥</strong>ã€‚</p><p>ç³»ç»Ÿæ˜¯ç”±ä¸€ä¸ªMySQLæ•°æ®åº“é›†ç¾¤ã€æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€ä»»åŠ¡ç®¡ç†ç›‘æ§å¹³å°ä»¥åŠZKé›†ç¾¤ç­‰ç»„ä»¶å…±åŒæ„æˆçš„ä¸€ä¸ªåŒ…å«æ•°æ®ç”Ÿäº§è€…ã€å¤åˆ¶ç®¡é“å’Œæ•°æ®æ¶ˆè´¹è€…ç­‰éƒ¨åˆ†çš„æ•°æ®æ€»çº¿ç³»ç»Ÿï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010105.png" alt></p><p>ZKè´Ÿè´£ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼åè°ƒå·¥ä½œï¼Œæ ¹æ®åŠŸèƒ½å°†æ•°æ®å¤åˆ¶ç»„ä»¶åˆ’åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä½œä¸ºç‹¬ç«‹çš„è¿›ç¨‹è¿è¡Œåœ¨æœåŠ¡ç«¯ï¼Œè¿è¡Œæ—¶æ•°æ®å’Œé…ç½®ä¿¡æ¯ä¿å­˜åœ¨ZKä¸Šï¼š</p><ul><li><strong>Coreï¼š</strong>å®ç°äº†æ•°æ®å¤åˆ¶çš„æ ¸å¿ƒé€»è¾‘ï¼Œå°†æ•°æ®å¤åˆ¶å°è£…æˆç®¡é“ï¼Œå¹¶æŠ½è±¡å‡ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸¤ä¸ªæ¦‚å¿µï¼Œç”Ÿäº§è€…é€šå¸¸æ˜¯MySQLçš„Binlogæ—¥å¿—ã€‚</li><li><strong>Serverï¼š</strong>è´Ÿè´£å¯åŠ¨å’Œåœæ­¢å¤åˆ¶ä»»åŠ¡ã€‚</li><li><strong>Monitorï¼š</strong>è´Ÿè´£ç›‘æ§ä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœåœ¨æ•°æ®å¤åˆ¶æœŸé—´å‘ç”Ÿå¼‚å¸¸æˆ–æ•…éšœä¼šå‘Šè­¦ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010106.png" alt></p><h4 id="ï¼ˆ2ï¼‰Coreè¿›è¡Œåˆ†å¸ƒå¼åè°ƒçš„æµç¨‹"><a href="#ï¼ˆ2ï¼‰Coreè¿›è¡Œåˆ†å¸ƒå¼åè°ƒçš„æµç¨‹" class="headerlink" title="ï¼ˆ2ï¼‰Coreè¿›è¡Œåˆ†å¸ƒå¼åè°ƒçš„æµç¨‹"></a>ï¼ˆ2ï¼‰Coreè¿›è¡Œåˆ†å¸ƒå¼åè°ƒçš„æµç¨‹</h4><ol><li><p><strong>ä»»åŠ¡æ³¨å†Œï¼š</strong></p><p>Coreè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œé¦–å…ˆå‘ <code>/mysql_replicator/tasks</code> èŠ‚ç‚¹ï¼ˆä»»åŠ¡åˆ—è¡¨èŠ‚ç‚¹ï¼‰æ³¨å†Œä»»åŠ¡ã€‚å½“æ³¨å†Œè¿‡ç¨‹å‘ç°å­èŠ‚ç‚¹å·²å­˜åœ¨ï¼Œè¡¨ç¤ºå·²æœ‰å…¶ä»–Taskæœºå™¨æ³¨å†Œäº†è¯¥ä»»åŠ¡ï¼Œä»¥ä¸‹ä¸ºâ€œå¤åˆ¶çƒ­é—¨å•†å“â€çš„ä»»åŠ¡ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010107.png" alt></p></li><li><p><strong>ä»»åŠ¡çƒ­å¤‡ä»½ï¼š</strong></p><ul><li>å¤åˆ¶ç»„ä»¶é‡‡ç”¨çƒ­å¤‡ä»½çš„å®¹ç¾æ–¹å¼æ¥åº”å¯¹å¤åˆ¶ä»»åŠ¡å¯èƒ½ä¼šé‡åˆ°çš„æ•…éšœï¼Œå³0å°†åŒä¸€ä¸ªå¤åˆ¶ä»»åŠ¡éƒ¨ç½²åœ¨ä¸åŒçš„ä¸»æœºä¸Šï¼Œä¸»å¤‡æœºå™¨é€šè¿‡ZKäº’ç›¸æ£€æµ‹è¿è¡Œå¥åº·çŠ¶å†µã€‚</li><li>å®ç°çƒ­å¤‡æ–¹æ¡ˆï¼Œä¸ç®¡ç¬¬ä¸€æ­¥æ˜¯å¦åˆ›å»ºäº†ä»»åŠ¡èŠ‚ç‚¹ï¼Œæ¯å°ä»»åŠ¡æœºå™¨éƒ½è¦åœ¨ <code>/mysql_replicator/tasks/copy_hot_item/instances</code> èŠ‚ç‚¹ä¸Šå°†è‡ªå·±çš„ä¸»æœºåæ³¨å†Œä¸Šå»ã€‚æ³¨å†Œçš„æ˜¯ä¸€ä¸ªä¸´æ—¶çš„é¡ºåºèŠ‚ç‚¹ <code>/mysql_replicator/tasks/copy_hot_item/instances/[Hostname]-1</code> æœ€åçš„åºåˆ—å·æ˜¯ä¸´æ—¶é¡ºåºèŠ‚ç‚¹çš„ç²¾åã€‚</li><li>å®Œæˆå­èŠ‚ç‚¹åˆ›å»ºåï¼Œæ¯å°æœºå™¨éƒ½å¯ä»¥é€šè¿‡å¯¹æ¯”è‡ªå·±æ˜¯å¦æ˜¯æ‰€æœ‰å­èŠ‚ç‚¹åºå·ä¸­æœ€å°çš„ï¼Œå¦‚æœæ˜¯å°±å°†è‡ªå·±çš„è¿è¡ŒçŠ¶æ€ç½®ä¸º RUNNINGï¼Œå…¶ä½™çš„æœºå™¨åˆ™è®¾ç½®ä¸º STANDBYï¼Œå³<strong>å°åºå·ä¼˜å…ˆ</strong>ã€‚</li></ul></li><li><p><strong>çƒ­å¤‡åˆ‡æ¢ï¼š</strong></p><ul><li>ä»»åŠ¡æœºå™¨åœ¨å®ŒæˆçŠ¶æ€æ ‡è¯†åå°±å¯ä»¥å·¥ä½œäº†ï¼ŒRUNNINGè¿›è¡Œæ•°æ®å¤åˆ¶ï¼ŒSTANDBYåˆ™è¿›å…¥å¾…å‘½çŠ¶æ€ï¼Œä¸€æ—¦RUNNINGçš„æœºå™¨å‡ºç°æ•…éšœï¼Œå–ä¸€ä¸ªå¾…å‘½çŠ¶æ€æœ€å°çš„æœºå™¨æ›¿è¡¥æ‰§è¡Œã€‚</li><li>æ‰€ä»¥å¾…å‘½çš„æœºå™¨éƒ½è¦åœ¨ <code>/mysql_replicator/tasks/copy_hot_item/instances</code> èŠ‚ç‚¹æ³¨å†Œä¸€ä¸ªWatcherç›‘å¬å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´ï¼Œè®¢é˜…æ‰€æœ‰ä»»åŠ¡æœºå™¨çš„å˜åŒ–æƒ…å†µï¼ŒRUNNINGæœºå™¨å®•æœºä¸ZKæ–­å¼€è¿æ¥åèŠ‚ç‚¹ä¼šæ¶ˆå¤±ï¼Œå…¶ä½™æœºå™¨æ”¶åˆ°é€šçŸ¥åå¼€å¯æ–°ä¸€è½®çš„RUNNINGé€‰ä¸¾ã€‚</li></ul></li><li><p><strong>è®°å½•æ‰§è¡ŒçŠ¶æ€ï¼š</strong>RUNNINGæœºå™¨éœ€è¦å°†è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ä¿ç•™ç»™STANDBYæœºå™¨ï¼ŒMySQLé€‰æ‹© <code>/mysql_replicator/tasks/copy_hot_item/lastCommit</code> ä½œä¸ºBinlogæ—¥å¿—æ¶ˆè´¹ä½ç‚¹çš„å­˜å‚¨èŠ‚ç‚¹ï¼Œ RUNNINGå®šæ—¶å†™å…¥å½“å‰ä¿¡æ¯ã€‚</p></li></ol><h4 id="ï¼ˆ3ï¼‰Serverç®¡ç†Coreç»„ä»¶"><a href="#ï¼ˆ3ï¼‰Serverç®¡ç†Coreç»„ä»¶" class="headerlink" title="ï¼ˆ3ï¼‰Serverç®¡ç†Coreç»„ä»¶"></a>ï¼ˆ3ï¼‰Serverç®¡ç†Coreç»„ä»¶</h4><ol><li><p><strong>æ§åˆ¶å°åè°ƒï¼š</strong>Serverçš„ä¸»è¦å·¥ä½œæ˜¯é€šè¿‡ZKæ¥å¯¹ä¸åŒä»»åŠ¡è¿›è¡Œæ§åˆ¶å’Œåè°ƒï¼ŒServerå°†æ¯ä¸ªå¤åˆ¶ä»»åŠ¡å¯¹äºç”Ÿäº§è€…çš„å…ƒæ•°æ®ï¼ˆåº“åã€è¡¨åã€ç”¨æˆ·åå’Œå¯†ç ç­‰æ•°æ®åº“ä¿¡æ¯ä»¥åŠæ¶ˆè´¹è€…ç›¸å…³ä¿¡æ¯ï¼‰ä»¥é…ç½®çš„å½¢å¼å†™å…¥ä»»åŠ¡èŠ‚ç‚¹ <code>/mysql_replicator/tasks/copy_hot_item</code> ä½¿ä»»åŠ¡çš„æ‰€æœ‰æœºå™¨éƒ½èƒ½èƒ½å…±äº«é…ç½®ã€‚</p></li><li><p><strong>å†·å¤‡åˆ‡æ¢ï¼š</strong></p><p>åœ¨ä¸€å®šè§„æ¨¡çš„åˆ†å¸ƒå¼é¡¹ç›®ä¸­ï¼Œå¾€å¾€æœ‰è®¸å¤šMySQLå®ä¾‹éœ€è¦è¿›è¡Œæ•°æ®å¤åˆ¶ï¼Œæ¯ä¸ªå®ä¾‹éƒ½è¦å¯¹åº”ä¸€ä¸ªå¤åˆ¶ä»»åŠ¡ï¼Œå¦‚æœæ¯ä¸ªä»»åŠ¡éƒ½è¿›è¡ŒåŒæœºçƒ­å¤‡ä»½ä¼šæ¶ˆè€—å¤ªå¤šçš„æœºå™¨ã€‚</p><p>æ ¹æ®è¿™ä¸ªé—®é¢˜è®¾è®¡ä¸€ç§æ–°çš„å†·å¤‡ä»½çš„æ–¹æ¡ˆï¼Œå®ƒå¯¹æ‰€æœ‰ä»»åŠ¡è¿›è¡Œåˆ†ç»„ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010108.png" alt></p><p>Coreè¿›ç¨‹è¢«é…ç½®äº†æ‰€å±Groupï¼Œ<strong>å†·å¤‡ä»½æ‰«æ</strong>ï¼š</p><ul><li>å‡å¦‚ä¸€ä¸ªCoreè¿›ç¨‹è¢«æ ‡è®°äº†group1ï¼Œå¯åŠ¨åä¼šè·å–å¯¹åº”èŠ‚ç‚¹ä¸‹æ‰€æœ‰çš„Taskåˆ—è¡¨ã€‚</li><li>å¦‚æœæ‰¾åˆ°äº†ä»»åŠ¡ <code>copy_hot_item</code> ä¼šéå†instancesèŠ‚ç‚¹ï¼Œè‹¥æ²¡æœ‰å­èŠ‚ç‚¹åˆ™åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„é¡ºåºèŠ‚ç‚¹ <code>copy_hot_item/instances/[Hostname]-1</code> ã€‚</li><li>ç±»ä¼¼äºçƒ­å¤‡ä»½çš„å°åºå·ä¼˜å…ˆï¼Œ<strong>æœ€å°çš„Coreè¿›ç¨‹æ ‡è®°ä¸ºRUNNINGï¼Œä¸åŒçš„æ˜¯å…¶ä»–Coreè¿›ç¨‹ä¼šè‡ªåŠ¨å°†åˆ›å»ºçš„å­èŠ‚ç‚¹åˆ é™¤ï¼Œç„¶åç»§ç»­éå†ä¸‹ä¸€ä¸ªTaskèŠ‚ç‚¹</strong>ã€‚</li></ul></li><li><p><strong>å†·çƒ­å¤‡ä»½å¯¹æ¯”ï¼š</strong></p><ul><li>çƒ­å¤‡ä»½ï¼šé’ˆå¯¹ä¸€ä¸ªä»»åŠ¡ä½¿ç”¨ä¸¤å°æœºå™¨åšå¤‡ä»½ï¼Œç”±äºWatcheré€šçŸ¥å’Œä¸´æ—¶é¡ºåºèŠ‚ç‚¹çš„ç‰¹æ€§ï¼Œå¯ä»¥å®æ—¶çš„è¿›è¡Œåè°ƒï¼›æœºå™¨èµ„æºæ¶ˆè€—è¾ƒå¤§ã€‚</li><li>å†·å¤‡ä»½ï¼šä½¿ç”¨äº†æ‰«ææœºåˆ¶ï¼Œè™½ç„¶é™ä½äº†å®æ—¶æ€§ï¼Œä½†èŠ‚çœäº†æœºå™¨èµ„æºã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010109.png" alt></p></li></ol><h4 id="ï¼ˆ4ï¼‰æœºå™¨é—´é€šä¿¡æ–¹å¼"><a href="#ï¼ˆ4ï¼‰æœºå™¨é—´é€šä¿¡æ–¹å¼" class="headerlink" title="ï¼ˆ4ï¼‰æœºå™¨é—´é€šä¿¡æ–¹å¼"></a>ï¼ˆ4ï¼‰æœºå™¨é—´é€šä¿¡æ–¹å¼</h4><p>å¸¸è§åˆ†å¸ƒå¼ç³»ç»Ÿæœºå™¨é—´é€šä¿¡æ–¹å¼ï¼š</p><ul><li><strong>å¿ƒè·³æ£€æµ‹ï¼š</strong>ä¸åŒæœºå™¨ä¹‹é—´æ£€æµ‹å½¼æ­¤æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œï¼Œä½¿ç”¨ZKçš„ä¸´æ—¶èŠ‚ç‚¹å®ç°è€Œä¸åŒäºå¸¸è§„çš„PINGæˆ–TCPé•¿è¿æ¥ã€‚æ‰€æœ‰æœºå™¨åœ¨ZKçš„ä¸€ä¸ªæŒ‡å®šèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ï¼Œæœºå™¨ä¹‹é—´å¯ä»¥æ ¹æ®ä¸´æ—¶èŠ‚ç‚¹åˆ¤æ–­å¯¹åº”æœºå™¨æ˜¯å¦å­˜æ´»ï¼Œè¿™æ ·æœºå™¨ä¹‹é—´ä¸éœ€è¦ç›´æ¥äº¤äº’ã€‚</li><li><strong>å·¥ä½œè¿›åº¦æ±‡æŠ¥ï¼š</strong>ä»»åŠ¡åˆ†å‘åˆ°ä¸åŒæœºå™¨ä¸Šæ‰§è¡Œåï¼Œéœ€è¦å®æ—¶çš„å°†è‡ªå·±çš„æ‰§è¡Œè¿›åº¦æ±‡æŠ¥ç»™åˆ†å‘ç³»ç»Ÿï¼Œæ¯ä¸ªä»»åŠ¡å®¢æˆ·ç«¯åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ï¼š<ul><li>é€šè¿‡åˆ¤æ–­ä¸´æ—¶èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨åˆ¤æ–­å¯¹åº”ä»»åŠ¡æœºå™¨æ˜¯å¦å­˜æ´»ï¼›</li><li>å„ä¸ªä»»åŠ¡æœºå™¨å®æ—¶çš„å°†è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œè¿›åº¦å†™å…¥ä¸´æ—¶èŠ‚ç‚¹ï¼Œä¸­å¿ƒç³»ç»Ÿå®šæ—¶çš„è·å–ã€‚</li></ul></li><li><strong>ç³»ç»Ÿè°ƒåº¦ï¼š</strong>æ§åˆ¶å°å°†æŒ‡ä»¤å‘é€ç»™æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œå®é™…æ˜¯æ”¹ZKèŠ‚ç‚¹çš„æ•°æ®ï¼Œæ•°æ®å˜æ›´çš„é€šçŸ¥å†å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>ç”¨ZKæ¥å®ç°åˆ†å¸ƒå¼é€šä¿¡å¯ä»¥é™ä½ç³»ç»Ÿé—´çš„è€¦åˆå’Œå‡å°‘åº•å±‚ç½‘ç»œé€šä¿¡ä»¥åŠåè®®è®¾è®¡ä¸Šçš„é‡å¤å·¥ä½œã€‚</p><h3 id="1-5-é›†ç¾¤ç®¡ç†"><a href="#1-5-é›†ç¾¤ç®¡ç†" class="headerlink" title="1.5 é›†ç¾¤ç®¡ç†"></a>1.5 é›†ç¾¤ç®¡ç†</h3><p>é›†ç¾¤ç®¡ç†åŒ…æ‹¬ï¼š</p><ul><li>é›†ç¾¤ç›‘æ§ï¼šä¾§é‡å¯¹é›†ç¾¤è¿è¡Œæ—¶çŠ¶æ€çš„æ”¶é›†</li><li>é›†ç¾¤æ§åˆ¶ï¼šä¾§é‡å¯¹é›†ç¾¤è¿›è¡Œæ“ä½œä¸æ§åˆ¶</li></ul><h4 id="ï¼ˆ1ï¼‰ä¼ ç»ŸAgentçš„å¼Šç«¯"><a href="#ï¼ˆ1ï¼‰ä¼ ç»ŸAgentçš„å¼Šç«¯" class="headerlink" title="ï¼ˆ1ï¼‰ä¼ ç»ŸAgentçš„å¼Šç«¯"></a>ï¼ˆ1ï¼‰ä¼ ç»ŸAgentçš„å¼Šç«¯</h4><p>ä¼ ç»ŸåŸºäºAgentçš„åˆ†å¸ƒå¼é›†ç¾¤ç®¡ç†ä½“ç³»ï¼Œæ¯å°æœºå™¨éƒ¨ç½²ä¸€ä¸ªAgentï¼Œè´Ÿè´£ä¸»åŠ¨å‘æŒ‡å®šçš„ç›‘æ§ä¸­å¿ƒæ±‡æŠ¥çŠ¶æ€ï¼Œæ¥å®ç°é›†ç¾¤ç›‘æ§ï¼Œå…¶å¼Šç«¯ï¼š</p><ul><li><strong>å¤§è§„æ¨¡å‡çº§å›°éš¾ï¼š</strong>å¤§è§„æ¨¡å‡çº§çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å½¢å¼çš„Agentéå¸¸éº»çƒ¦ã€‚</li><li><strong>ç»Ÿä¸€çš„Agentæ— æ³•æ»¡è¶³å¤šæ ·çš„éœ€æ±‚ï¼š</strong>Agentå¯ä»¥æ»¡è¶³å¦‚CPUä½¿ç”¨ç‡ã€è´Ÿè½½ã€å†…å­˜ä½¿ç”¨ç‡ã€ç½‘ç»œååä»¥åŠç£ç›˜å®¹é‡ç­‰åŸºæœ¬ç‰©ç†çŠ¶æ€çš„ç›‘æ§ï¼Œä½†å¦‚æœè¦æ·±å…¥åˆ°ä¸šåŠ¡çŠ¶æ€ï¼ˆæ¯”å¦‚ç›‘æ§æ¯ä¸ªæ¶ˆè´¹è€…å¯¹æ¶ˆæ¯çš„æ¶ˆè´¹çŠ¶æ€ï¼Œæˆ–æ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¯å°ä»»åŠ¡æœºå™¨ä¸Šçš„ä»»åŠ¡æ‰§è¡Œæƒ…å†µï¼‰å°±ä¸é€‚åˆç”±ç»Ÿä¸€çš„Agentæ¥æä¾›ã€‚</li><li><strong>ç¼–ç¨‹è¯­è¨€å¤šæ ·æ€§ï¼š</strong>ä¼ ç»Ÿçš„Agentéœ€è¦æä¾›å„ç§è¯­è¨€ç‰ˆçš„å®¢æˆ·ç«¯ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿ"><a href="#ï¼ˆ2ï¼‰åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿ" class="headerlink" title="ï¼ˆ2ï¼‰åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿ"></a>ï¼ˆ2ï¼‰åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿ</h4><p>åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿè¦è§£å†³çš„é—®é¢˜ï¼š</p><ul><li><strong>å˜åŒ–çš„æ—¥å¿—æºæœºå™¨ï¼š</strong>æ¯ä¸ªåº”ç”¨çš„æœºå™¨å‡ ä¹æ¯å¤©éƒ½æ˜¯å˜åŒ–çš„ï¼Œå¯èƒ½æ˜¯å› ä¸º</li><li><strong>å˜åŒ–çš„æ”¶é›†å™¨æœºå™¨ï¼š</strong>æ—¥å¿—æ”¶é›†ç³»ç»Ÿè‡ªèº«ä¹Ÿä¼šæœ‰æœºå™¨çš„å˜æ›´å’Œæ‰©å®¹ã€‚</li></ul><p>æµç¨‹ï¼š</p><ul><li><p><strong>æ³¨å†Œæ”¶é›†å™¨æœºå™¨ï¼š</strong>åœ¨ZKä¸Šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ”¶é›†å™¨çš„æ ¹èŠ‚ç‚¹ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨å¯åŠ¨æ—¶éƒ½ä¼šåœ¨æ”¶é›†å™¨èŠ‚ç‚¹ä¸‹åˆ›å»ºè‡ªå·±çš„èŠ‚ç‚¹ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010110.png" alt></p></li><li><p><strong>ä»»åŠ¡åˆ†å‘ï¼š</strong>å¾…æ‰€æœ‰æ”¶é›†å™¨éƒ½åˆ›å»ºå¥½è‡ªå·±çš„èŠ‚ç‚¹ï¼Œæ ¹æ®å­èŠ‚ç‚¹æ•°ç›®å°†æ‰€æœ‰æ—¥å¿—æºæœºå™¨åˆ†ä¸ºå¯¹åº”çš„è‹¥å¹²ç»„ï¼Œç„¶åå°†åˆ†ç»„åçš„æœºå™¨åˆ—è¡¨åˆ†åˆ«å†™åˆ°æ”¶é›†å™¨åˆ›å»ºçš„å­èŠ‚ç‚¹ä¸Šï¼Œæ¯å°æ”¶é›†å™¨éƒ½å¯ä»¥ä»è‡ªå·±çš„èŠ‚ç‚¹ä¸Šè·å–æ—¥å¿—æºæœºå™¨åˆ—è¡¨ã€‚</p></li><li><p><strong>çŠ¶æ€æ±‡æŠ¥ï¼š</strong>æˆ‘ä»¬è¦è€ƒè™‘åˆ°æœºå™¨æœ‰éšæ—¶æŒ‚æ‰çš„å¯èƒ½ï¼Œæ‰€ä»¥è¦æœ‰ä¸€ä¸ªæ”¶é›†å™¨çš„çŠ¶æ€æ±‡æŠ¥æœºåˆ¶ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨åœ¨åˆ›å»ºå®Œè‡ªå·±çš„èŠ‚ç‚¹åè¿˜è¦å†å¯¹åº”çš„å­èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªçŠ¶æ€å­èŠ‚ç‚¹ï¼Œå®šæœŸå‘è¯¥èŠ‚ç‚¹å†™å…¥è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼ˆç±»ä¼¼äºå¿ƒè·³æ£€æµ‹ï¼‰ã€‚</p></li><li><p><strong>åŠ¨æ€åˆ†é…ï¼š</strong>å¦‚æœæ”¶é›†å™¨æŒ‚æ‰æˆ–è€…æ‰©å®¹ï¼Œéœ€è¦åŠ¨æ€çš„è¿›è¡Œæ”¶é›†ä»»åŠ¡çš„åˆ†é…ã€‚åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ—¥å¿—ç³»ç»Ÿå§‹ç»ˆå…³æ³¨ç€ <code>/logs/collector</code> èŠ‚ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹çš„å˜æ›´ï¼Œä¸€æ—¦æ£€æµ‹åˆ°æœ‰æ”¶é›†å™¨åœæ­¢æ±‡æŠ¥æˆ–æœ‰æ–°çš„æ”¶é›†å™¨åŠ å…¥å°±ä¼šè¿›è¡Œä»»åŠ¡çš„é‡æ–°åˆ†é…ã€‚</p><p>å°†ä¹‹å‰åˆ†é…çš„ä»»åŠ¡è½¬ç§»çš„æ–¹æ³•ï¼š</p><ul><li><strong>å…¨å±€åŠ¨æ€åˆ†é…ï¼š</strong>ç³»ç»Ÿæ ¹æ®æ–°çš„æ”¶é›†å™¨æœºå™¨åˆ—è¡¨ï¼Œå°†æ‰€æœ‰æ—¥å¿—æºæœºå™¨é‡æ–°è¿›è¡Œåˆ†ç»„ï¼Œé‡æ–°åˆ†é…ç»™å½“å‰æ‰€æœ‰æ”¶é›†å™¨ã€‚</li><li><strong>å±€éƒ¨åŠ¨æ€åˆ†é…ï¼š</strong>åœ¨å°èŒƒå›´å†…è¿›è¡Œä»»åŠ¡çš„åŠ¨æ€åˆ†é…ï¼Œæ¯ä¸ªæ”¶é›†å™¨åœ¨æ±‡æŠ¥çŠ¶æ€çš„åŒæ—¶ä¹Ÿæºå¸¦è‡ªå·±çš„è´Ÿè½½ï¼ˆéCPUè´Ÿè½½è€Œæ˜¯å½“å‰ä»»åŠ¡çš„ç»¼åˆè¯„ä¼°ï¼‰ï¼Œå½“æ”¶é›†å™¨æŒ‚æ‰ï¼Œå°±ä¼˜å…ˆåˆ†é…ç»™è´Ÿè½½è¾ƒä½çš„æœºå™¨ï¼Œæ–°çš„æœºå™¨åŠ å…¥æ—¶ä¹Ÿä¼šæŠŠè´Ÿè½½è¾ƒé«˜çš„æœºå™¨éƒ¨åˆ†ä»»åŠ¡è½¬ç§»è¿‡å»ã€‚</li></ul></li></ul><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li><strong>èŠ‚ç‚¹ç±»å‹ï¼š</strong>æ¯ä¸ªä»£è¡¨æ”¶é›†å™¨çš„å­èŠ‚ç‚¹å¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œå½“èŠ‚ç‚¹å¤±æ•ˆæ—¶ä¼šè¢«ç«‹å³åˆ é™¤ï¼Œè®°å½•çš„æ—¥å¿—æºæœºå™¨åˆ—è¡¨ä¹Ÿä¼šéšä¹‹æ¶ˆå¤±ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯æŒä¹…èŠ‚ç‚¹ã€‚</li><li><strong>æ—¥å¿—ç³»ç»ŸèŠ‚ç‚¹ç›‘å¬ï¼š</strong>å®é™…ç”Ÿäº§è¿è¡Œä¸­ï¼Œæ”¶é›†å™¨æ›´æ”¹çŠ¶æ€èŠ‚ç‚¹çš„é¢‘ç‡å¯èƒ½å¾ˆé«˜ï¼ˆå°äº1ç§’ï¼‰ï¼Œä¸”æ”¶é›†å™¨æ•°é‡ä¼šå¾ˆå¤§ï¼Œæ—¥å¿—ç³»ç»Ÿå¦‚æœè¦ç›‘å¬æ‰€æœ‰èŠ‚ç‚¹å˜åŒ–ï¼Œå¯¹åº”çš„æ•°æ®é‡å¤ªè¿‡åºå¤§ï¼Œæ‰€ä»¥æ—¥å¿—ç³»ç»Ÿå¹¶æ²¡æœ‰å®æ—¶çš„æ¥æ”¶æ¯æ¬¡èŠ‚ç‚¹çŠ¶æ€å˜æ›´ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ²¡ä»€ä¹ˆç”¨çš„ï¼Œè€Œæ˜¯é‡‡ç”¨<strong>ä¸»åŠ¨è½®è¯¢</strong>çš„æ–¹æ¡ˆï¼Œåªæ˜¯æœ‰ä¸€ç‚¹å»¶æ—¶ã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰åœ¨çº¿äº‘ä¸»æœºç®¡ç†"><a href="#ï¼ˆ3ï¼‰åœ¨çº¿äº‘ä¸»æœºç®¡ç†" class="headerlink" title="ï¼ˆ3ï¼‰åœ¨çº¿äº‘ä¸»æœºç®¡ç†"></a>ï¼ˆ3ï¼‰åœ¨çº¿äº‘ä¸»æœºç®¡ç†</h4><p>é›†ç¾¤æœºå™¨çš„ç›‘æ§ï¼Œå¯¹æœºå™¨çš„çŠ¶æ€å°¤å…¶æ˜¯æœºå™¨åœ¨çº¿ç‡ç»Ÿè®¡æœ‰è¾ƒé«˜è¦æ±‚ï¼Œå¹¶èƒ½å¯¹æœºå™¨å˜æ›´æœ‰å¿«é€Ÿçš„å“åº”ï¼š</p><ol><li>å¦‚ä½•å¿«é€Ÿç»Ÿè®¡å‡ºå½“å‰ç”Ÿäº§ç¯å¢ƒä¸€å…±æœ‰å¤šå°‘å°æœºå™¨ï¼Ÿ</li><li>å¦‚ä½•å¿«é€Ÿè·å–åˆ°æœºå™¨ä¸Šä¸‹çº¿æƒ…å†µï¼Ÿ</li><li>å¦‚ä½•å®æ—¶ç›‘æ§é›†ç¾¤ä¸­æ¯å°ä¸»æœºçš„è¿è¡Œæ—¶çŠ¶æ€ï¼Ÿ</li></ol><ul><li><p><strong>æœºå™¨ä¸Šä¸‹çº¿ï¼š</strong>æ–°å¢æœºå™¨æ—¶ï¼Œå…ˆå°†æŒ‡å®šçš„Agentéƒ¨ç½²åˆ°æœºå™¨ï¼Œéƒ¨ç½²å¯åŠ¨åå‘ZKæŒ‡å®šèŠ‚ç‚¹è¿›è¡Œæ³¨å†Œï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶å­èŠ‚ç‚¹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010111.png" alt></p><p>åˆ›å»ºå®Œå­èŠ‚ç‚¹åï¼Œå¯¹ <code>/XAE/machines</code> èŠ‚ç‚¹å…³æ³¨çš„ç›‘æ§ä¸­å¿ƒä¼šæ”¶åˆ°â€œå­èŠ‚ç‚¹å˜æ›´â€çš„äº‹ä»¶ï¼Œå³ä¸Šçº¿é€šçŸ¥ï¼›åŒç†ä¹Ÿå¯ä»¥æ”¶åˆ°ä¸‹çº¿é€šçŸ¥ã€‚</p></li><li><p><strong>æœºå™¨ç›‘æ§ï¼š</strong>è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒAgentä¼šå®šæ—¶å°†ä¸»æœºçš„è¿è¡ŒçŠ¶æ€ä¿¡æ¯å†™å…¥ZKå¯¹åº”ä¸»æœºèŠ‚ç‚¹ï¼Œç›‘æ§ä¸­å¿ƒé€šè¿‡è®¢é˜…è¿™äº›èŠ‚ç‚¹æ•°æ®å˜æ›´æ¥è·å–è¿è¡Œæ—¶ä¿¡æ¯ã€‚</p></li></ul><h3 id="1-6-Masteré€‰ä¸¾"><a href="#1-6-Masteré€‰ä¸¾" class="headerlink" title="1.6 Masteré€‰ä¸¾"></a>1.6 Masteré€‰ä¸¾</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¸¸å¸¸éœ€è¦MasterèŠ‚ç‚¹æ¥åè°ƒå…¶ä»–å•å…ƒï¼Œå¦‚ä¸€äº›è¯»å†™åˆ†ç¦»çš„åº”ç”¨åœºæ™¯ï¼Œå®¢æˆ·ç«¯çš„å†™è¯·æ±‚å¾€å¾€æ˜¯ç”±Masteræ¥å¤„ç†çš„ã€‚</p><p>åˆ†å¸ƒå¼ç¯å¢ƒå¸¸è§åœºæ™¯ï¼šé›†ç¾¤ä¸­æ‰€æœ‰ç³»ç»Ÿå•å…ƒéœ€è¦å¯¹å‰ç«¯ä¸šåŠ¡æä¾›æ•°æ®ï¼Œå¦‚ä¸€ä¸ªç»è¿‡ä¸€ç³»åˆ—æµ·é‡æ•°æ®å¤„ç†è®¡ç®—å¾—åˆ°çš„å•†å“IDï¼Œè®©ä¸€å°æœºå™¨è®¡ç®—åå…±äº«ç»™å…¶ä»–æœºå™¨æ¥å‡å°‘é‡å¤åŠ³åŠ¨ï¼Œç³»ç»Ÿå¯ä»¥åˆ†ä¸ºå®¢æˆ·ç«¯é›†ç¾¤ã€åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿã€æµ·é‡æ•°æ®å¤„ç†æ€»çº¿å’ŒZooKeeperå››ä¸ªéƒ¨åˆ†ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010112.png" alt></p><p>Clienté›†ç¾¤æ¯å°å®šæ—¶é€šè¿‡ZKå®ŒæˆMasteré€‰ä¸¾ï¼Œé€‰å‡ºçš„Masterè¿›è¡Œä¸€ç³»åˆ—æµ·é‡æ•°æ®å¤„ç†å¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå°†å…¶æ”¾ç½®åœ¨ä¸€ä¸ªå†…å­˜/æ•°æ®åº“ä¸­ï¼Œå¹¶é€šçŸ¥å…¶ä»–å®¢æˆ·ç«¯æ¥è·å–ã€‚</p><p>æˆ‘ä»¬å¯¹Masteré€‰ä¸¾çš„éœ€æ±‚æ˜¯ä»æ‰€æœ‰æœºå™¨ä¸­é€‰æ‹©ä¸€å°æœºå™¨ï¼Œé€šå¸¸æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨æ•°æ®åº“ä¸»é”®æ¥å®ç°ï¼šæ‰€æœ‰æœºå™¨æ’å…¥ä¸€æ¡ç›¸åŒä¸»é”®çš„è®°å½•ï¼ŒæˆåŠŸçš„ä¸€å°ä¸ºMasterã€‚ä½†è¿™ç§æ–¹æ¡ˆæ²¡æ³•åº”å¯¹MasteræŒ‚æ‰çš„é—®é¢˜ï¼Œå› ä¸ºå…³ç³»å‹æ•°æ®åº“æ— æ³•é€šçŸ¥è¿™ä¸€äº‹ä»¶ã€‚</p><p>åˆ©ç”¨ZooKeeperçš„å¼ºä¸€è‡´æ€§ï¼Œæˆ‘ä»¬åœ¨åˆ†å¸ƒå¼é«˜å¹¶å‘åœºæ™¯ä¸‹å¯ä»¥åˆ›å»ºä¸€ä¸ªå…¨å±€å”¯ä¸€çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®ç°ï¼š<strong>æ¯å¤©æ‰€æœ‰å®¢æˆ·ç«¯å®šæ—¶åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ <code>/master_election/2013-09-20/binding</code> ï¼Œåªæœ‰ä¸€ä¸ªä¼šæˆåŠŸåˆ›å»ºï¼Œå…¶å°±æˆä¸ºäº†Masterï¼Œæ²¡æœ‰åˆ›å»ºæˆåŠŸçš„å†æ¬¡èŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€ä¸ªèŠ‚ç‚¹å˜æ›´çš„Watcherï¼Œç›‘æ§å½“å‰çš„Masteræœºå™¨æ˜¯å¦å­˜æ´»ï¼Œä¸€æ—¦æŒ‚æ‰å°±é‡æ–°è¿›è¡Œé€‰ä¸¾</strong>ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010113.png" alt></p><h3 id="1-7-åˆ†å¸ƒå¼é”"><a href="#1-7-åˆ†å¸ƒå¼é”" class="headerlink" title="1.7 åˆ†å¸ƒå¼é”"></a>1.7 åˆ†å¸ƒå¼é”</h3><p>ä¸åŒä¸»æœºå…±äº«ä¸€ç»„èµ„æºï¼Œéœ€è¦äº’æ–¥æ‰‹æ®µé˜²æ­¢å½¼æ­¤çš„å¹²æ‰°æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œæ­¤æ—¶ä½¿ç”¨åˆ†å¸ƒå¼é”ã€‚å…³ç³»å‹æ•°æ®åº“æœ¬èº«å…·æœ‰æ’ä»–æ€§ï¼Œæ¥å®ç°ä¸åŒè¿›ç¨‹çš„äº’æ–¥ï¼Œä½†å®¹æ˜“å¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚</p><h4 id="ï¼ˆ1ï¼‰æ’ä»–é”"><a href="#ï¼ˆ1ï¼‰æ’ä»–é”" class="headerlink" title="ï¼ˆ1ï¼‰æ’ä»–é”"></a>ï¼ˆ1ï¼‰æ’ä»–é”</h4><p>æ’ä»–é”ï¼ˆExclusive Locksï¼Œå³Xé”ï¼‰åˆå«å†™é”æˆ–ç‹¬å é”ï¼Œå½“äº‹åŠ¡Aå¯¹æ•°æ®å¯¹è±¡OåŠ æ’ä»–é”ï¼Œåœ¨æŒæœ‰é”æœŸé—´åªå…è®¸äº‹åŠ¡Aå¯¹Oè¿›è¡Œè¯»å–å’Œæ›´æ–°æ“ä½œã€‚</p><ul><li><p><strong>å®šä¹‰é”ï¼š</strong>Javaå¸¸ç”¨ synchronized æˆ– ReentrantLock æ¥å®šä¹‰é”ï¼ŒZKæ²¡æœ‰ç±»ä¼¼çš„APIæ¥ä½¿ç”¨ï¼Œè€Œæ˜¯ç›´æ¥ç”¨ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹æ¥è¡¨ç¤ºä¸€ä¸ªé”ï¼ˆå¦‚ <code>/exclusive_lock/lock</code> ï¼‰</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010114.png" alt></p></li><li><p><strong>è·å–é”ï¼š</strong>å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ <code>create()</code> æ¥å£åœ¨ <code>/exclusive_lock</code> èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ï¼Œæœ€ç»ˆåªæœ‰ä¸€ä¸ªå¯ä»¥åˆ›å»ºæˆåŠŸï¼Œå³è·å–åˆ°äº†é”ï¼Œæ²¡æœ‰è·å–åˆ°çš„å®¢æˆ·ç«¯åœ¨ <code>/exclusive_lock</code> èŠ‚ç‚¹æ³¨å†Œä¸€ä¸ªå­èŠ‚ç‚¹å˜æ›´çš„Watcherç›‘å¬ã€‚</p></li><li><p><strong>é‡Šæ”¾é”ï¼š</strong>å› ä¸ºé”æ˜¯ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œæœ‰ä¸¤ç§æƒ…å†µä¼šé‡Šæ”¾é”ï¼š</p><ul><li>å½“å‰è·å–é”çš„å®¢æˆ·ç«¯é›†ç¾¤å®•æœºï¼ŒZKä¸Šæ­¤ä¸´æ—¶èŠ‚ç‚¹ä¼šè¢«ç§»é™¤ã€‚</li><li>æ­£å¸¸æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨åˆ é™¤è‡ªå·±åˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹ã€‚</li></ul><p>èŠ‚ç‚¹åˆ é™¤åï¼Œå…¶ä»–å®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥å†æ¬¡å‘èµ·åˆ†å¸ƒå¼é”çš„è·å–ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010115.png" alt></p></li></ul><h4 id="ï¼ˆ2ï¼‰å…±äº«é”"><a href="#ï¼ˆ2ï¼‰å…±äº«é”" class="headerlink" title="ï¼ˆ2ï¼‰å…±äº«é”"></a>ï¼ˆ2ï¼‰å…±äº«é”</h4><p>å…±äº«é”ï¼ˆShared Locksï¼Œç®€ç§°Sé”ï¼‰åˆå«è¯»é”ï¼Œäº‹åŠ¡Aå¯¹æ•°æ®å¯¹è±¡OåŠ ä¸Šå…±äº«é”ï¼Œå…¶ä»–äº‹åŠ¡åªèƒ½å¯¹Oè¿›è¡Œè¯»æ“ä½œå’ŒåŠ å…±äº«é”ï¼Œç›´åˆ°æ‰€æœ‰å…±äº«é”é‡Šæ”¾ã€‚</p><ul><li><p><strong>å®šä¹‰é”ï¼š</strong>ç›´æ¥ç”¨ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹æ¥è¡¨ç¤ºä¸€ä¸ªé”ï¼ˆå¦‚ <code>/shared_lock/192.168.0.1-R-000000001</code> ï¼‰</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010116.png" alt></p></li><li><p><strong>è·å–é”ï¼š</strong>å®¢æˆ·ç«¯åˆ° <code>/shared_lock</code> èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œè‹¥å½“å‰æ˜¯è¯»è¯·æ±‚ï¼Œå°±åˆ›å»ºRç±»èŠ‚ç‚¹ï¼›å¦‚æœæ˜¯å†™è¯·æ±‚ï¼Œå°±åˆ›å»ºWç±»èŠ‚ç‚¹ã€‚</p></li><li><p><strong>åˆ¤æ–­è¯»å†™é¡ºåºï¼š</strong></p><ol><li>åˆ›å»ºå®ŒèŠ‚ç‚¹åï¼Œè·å– <code>/shared_lock</code> èŠ‚ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå¹¶æ³¨å†ŒWatcherå˜æ›´ç›‘å¬ã€‚</li><li>ç¡®å®šè‡ªå·±çš„èŠ‚ç‚¹åºå·åœ¨æ‰€æœ‰å­èŠ‚ç‚¹ä¸­çš„é¡ºåºã€‚</li><li>è¯»å†™ä¸¤ç§æƒ…å†µï¼š<ul><li>è¯»è¯·æ±‚ï¼šå¦‚æœæ²¡æœ‰æ¯”è‡ªå·±åºå·å°çš„å­èŠ‚ç‚¹ï¼Œæˆ–æ˜¯å°çš„èŠ‚ç‚¹éƒ½æ˜¯è¯»è¯·æ±‚ï¼Œè¡¨ç¤ºè‡ªå·±å·²ç»è·å–åˆ°å…±äº«é”ï¼ŒåŒæ—¶å¼€å§‹æ‰§è¡Œè¯»å–é€»è¾‘ã€‚</li><li>å†™è¯·æ±‚ï¼šå¦‚æœè‡ªå·±ä¸æ˜¯åºå·æœ€å°çš„å­èŠ‚ç‚¹ï¼Œå°±è¦è¿›å…¥ç­‰å¾…ã€‚</li></ul></li><li>æ¥æ”¶åˆ°Watcheré€šçŸ¥åï¼Œé‡å¤æ­¥éª¤1ã€‚</li></ol></li><li><p><strong>é‡Šæ”¾é”ï¼š</strong>æµç¨‹åŒæ’ä»–é”ã€‚</p><p>æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010117.png" alt></p></li></ul><h5 id="ç¾Šç¾¤æ•ˆåº”"><a href="#ç¾Šç¾¤æ•ˆåº”" class="headerlink" title="ç¾Šç¾¤æ•ˆåº”"></a>ç¾Šç¾¤æ•ˆåº”</h5><p>ä¸Šè¿°å…±äº«é”å®ç°å¯ä»¥æ»¡è¶³æœºå™¨è§„æ¨¡è¾ƒå°çš„åœºæ™¯ï¼ˆ10å°ä»¥å†…ï¼‰ï¼Œå½“æœºå™¨è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œé’ˆå¯¹åˆ¤æ–­è¯»å†™é¡ºåºæ­¥éª¤ç»“åˆä¸‹å›¾å®ä¾‹ï¼ŒçŒœæƒ³å®é™…è¿è¡Œçš„æƒ…å†µã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010118.png" alt></p><p>å®é™…è¿è¡Œï¼š</p><ol><li>192.168.0.1æœºå™¨é¦–å…ˆè¿›è¡Œè¯»æ“ä½œï¼Œå®Œæˆåå°†é¦–ä¸ªå­èŠ‚ç‚¹åˆ é™¤ã€‚</li><li>ä½™ä¸‹4å°æœºå™¨å‡å—åˆ°èŠ‚ç‚¹ç§»é™¤çš„é€šçŸ¥ï¼Œé‡æ–°ä» <code>/shared_lock</code> èŠ‚ç‚¹ä¸Šè·å–ä¸€ä»½æ–°çš„å­èŠ‚ç‚¹åˆ—è¡¨ã€‚</li><li>æ¯ä¸ªæœºå™¨åˆ¤æ–­è‡ªå·±çš„è¯»å†™é¡ºåºï¼Œå…¶ä¸­192.168.0.2è¿™å°æœºå™¨æ£€æµ‹åˆ°è‡ªå·±å·²ç»æ˜¯æœ€å°æœºå™¨äº†ï¼Œäºæ˜¯å¼€å§‹è¯»æ“ä½œï¼Œè€Œå…¶ä»–æœºå™¨å‘ç°æœªè½®åˆ°è‡ªå·±å°±ç»§ç»­ç­‰å¾…ã€‚</li><li>ç»§ç»­â€¦.</li></ol><p>å…¶ä¸­æ­¥éª¤3ï¼Œè¯¥é€šçŸ¥å‘ç»™äº†æ‰€æœ‰æœºå™¨ï¼Œä½†å®é™…ä¸Šåªå¯¹192.168.0.2è¿™å°æœºå™¨æœ‰ç”¨ï¼Œæ•´ä¸ªæµç¨‹å¤§é‡çš„Watcheré€šçŸ¥å’Œå­èŠ‚ç‚¹åˆ—è¡¨è·å–æ“ä½œé‡å¤è¿è¡Œï¼Œå¤§éƒ¨åˆ†æœºå™¨åˆ¤æ–­çš„ç»“æœéƒ½æ˜¯éœ€è¦ç»§ç»­ç­‰å¾…ã€‚<strong>åœ¨é›†ç¾¤è§„æ¨¡è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼Œä¸ä»…ä¼šå¯¹ZooKeeperæœåŠ¡å™¨é€ æˆå·¨å¤§çš„æ€§èƒ½å½±å“å’Œç½‘ç»œå†²å‡»</strong>ï¼Œæ›´ä¸ºä¸¥é‡çš„æ˜¯ï¼Œ<strong>è‹¥åŒä¸€æ—¶é—´æœ‰å¤šä¸ªèŠ‚ç‚¹å¯¹åº”çš„å®¢æˆ·ç«¯å®Œæˆäº‹åŠ¡æˆ–æ˜¯äº‹åŠ¡ä¸­æ–­å¼•èµ·èŠ‚ç‚¹æ¶ˆå¤±ï¼ŒZKæœåŠ¡å™¨å°±ä¼šåœ¨çŸ­æ—¶é—´å†…å‘å…¶ä½™å®¢æˆ·ç«¯å‘é€å¤§é‡çš„äº‹ä»¶é€šçŸ¥â€”å³ç¾Šç¾¤æ•ˆåº”</strong>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»æµå­¦é‡Œç»å¸¸ç”¨â€œç¾Šç¾¤æ•ˆåº”â€æ¥æè¿°ç»æµä¸ªä½“çš„ä»ä¼—è·Ÿé£å¿ƒç†ã€‚â€œç¾Šç¾¤æ•ˆåº”â€å°±æ˜¯æ¯”å–»äººéƒ½æœ‰ä¸€ç§ä»ä¼—å¿ƒç†ï¼Œä»ä¼—å¿ƒç†å¾ˆå®¹æ˜“å¯¼è‡´ç›²ä»ï¼Œè€Œç›²ä»å¾€å¾€ä¼šé™·å…¥éª—å±€æˆ–é­åˆ°å¤±è´¥ã€‚</span><br></pre></td></tr></table></figure><p>äº§ç”Ÿé—®é¢˜çš„åŸå› åœ¨äºæ²¡æœ‰æ‰¾å‡†å®¢æˆ·ç«¯çœŸæ­£çš„å…³æ³¨ç‚¹ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯åªéœ€å…³æ³¨æ¯”è‡ªå·±å°çš„é‚£ä¸€ä¸ªèŠ‚ç‚¹çš„å˜æ›´æƒ…å†µå³å¯ï¼š</p><ol><li>å®¢æˆ·ç«¯è°ƒç”¨ <code>create()</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªç±»ä¼¼äº <code>/shared_lock/[hostname]-è¯·æ±‚ç±»å‹-åºå·</code> çš„ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ã€‚</li><li>å®¢æˆ·ç«¯è°ƒç”¨ <code>getChildren()</code> æ¥å£æ¥è·å–æ‰€æœ‰å·²ç»åˆ›å»ºçš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œè¿™é‡Œä¸å†æ³¨å†Œä»»ä½•Watcherã€‚</li><li>å¦‚æœæ— æ³•è·å–å…±äº«é”ï¼Œå°±è°ƒç”¨ <code>exist()</code> æ¥å¯¹æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹æ³¨å†ŒWatcherï¼Œè¯»å†™è¯·æ±‚æƒ…å†µä¸ä¸€æ ·ï¼š<ul><li>è¯»è¯·æ±‚ï¼šå‘æ¯”è‡ªå·±åºå·å°çš„æœ€åä¸€ä¸ªå†™è¯·æ±‚èŠ‚ç‚¹æ³¨å†Œ</li><li>å†™è¯·æ±‚ï¼šå‘æ¯”è‡ªå·±åºå·å°çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æ³¨å†Œ</li></ul></li><li>ç­‰å¾…Watcheré€šçŸ¥ï¼Œç»§ç»­è¿›å…¥æ­¥éª¤2ã€‚</li></ol><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010119.png" alt></p><h3 id="1-8-åˆ†å¸ƒå¼é˜Ÿåˆ—"><a href="#1-8-åˆ†å¸ƒå¼é˜Ÿåˆ—" class="headerlink" title="1.8 åˆ†å¸ƒå¼é˜Ÿåˆ—"></a>1.8 åˆ†å¸ƒå¼é˜Ÿåˆ—</h3><p>åˆ†å¸ƒå¼é˜Ÿåˆ—å¦‚å¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼šActiveMQã€Metamorphosisã€Kafkaå’ŒHornetQç­‰ã€‚åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå¸¸è§„çš„å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ã€ç­‰åˆ°é˜Ÿåˆ—å…ƒç´ é›†èšåæ‰ç»Ÿä¸€å®‰æ’çš„Barrieræ¨¡å‹ã€‚</p><h4 id="ï¼ˆ1ï¼‰FIFO-å…ˆå…¥å…ˆå‡º"><a href="#ï¼ˆ1ï¼‰FIFO-å…ˆå…¥å…ˆå‡º" class="headerlink" title="ï¼ˆ1ï¼‰FIFO-å…ˆå…¥å…ˆå‡º"></a>ï¼ˆ1ï¼‰FIFO-å…ˆå…¥å…ˆå‡º</h4><p>ä½¿ç”¨ZooKeeperå®ç°FIFOé˜Ÿåˆ—ç±»ä¼¼äºå…¨å†™çš„å…±äº«é”æ¨¡å‹ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯åˆ° <code>/queue_fifo</code> èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶é¡ºåºèŠ‚ç‚¹ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010120.png" alt></p><p>åˆ›å»ºå®ŒèŠ‚ç‚¹åï¼Œç¡®å®šæ‰§è¡Œé¡ºåºçš„æ­¥éª¤ï¼š</p><ol><li>é€šè¿‡è°ƒç”¨ <code>getChildren()</code> æ¥å£æ¥è·å– <code>/queue_fifo</code> èŠ‚ç‚¹ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è·å–é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„å…ƒç´ ã€‚</li><li>ç¡®å®šè‡ªå·±çš„èŠ‚ç‚¹åºå·åœ¨æ‰€æœ‰å­èŠ‚ç‚¹ä¸­çš„é¡ºåºã€‚</li><li>å¦‚æœè‡ªå·±ä¸æ˜¯åºå·æœ€å°çš„å­èŠ‚ç‚¹ï¼Œè¿›å…¥ç­‰å¾…ï¼ŒåŒæ—¶å‘æ¯”è‡ªå·±åºå·å°çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æ³¨å†ŒWatcherç›‘å¬ã€‚</li><li>æ¥æ”¶åˆ°Watcheré€šçŸ¥ï¼Œé‡å¤æ­¥éª¤1ã€‚</li></ol><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010121.png" alt></p><h4 id="ï¼ˆ2ï¼‰Barrierï¼šåˆ†å¸ƒå¼å±éšœ"><a href="#ï¼ˆ2ï¼‰Barrierï¼šåˆ†å¸ƒå¼å±éšœ" class="headerlink" title="ï¼ˆ2ï¼‰Barrierï¼šåˆ†å¸ƒå¼å±éšœ"></a>ï¼ˆ2ï¼‰Barrierï¼šåˆ†å¸ƒå¼å±éšœ</h4><p>BarrieråŸæ„éšœç¢ç‰©ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æŒ‡ç³»ç»Ÿé—´çš„ä¸€ä¸ªåè°ƒæ¡ä»¶ï¼Œè§„å®šä¸€ä¸ªé˜Ÿåˆ—çš„å…ƒç´ å¿…é¡»éƒ½é›†èšåæ‰èƒ½ç»Ÿä¸€è¿›è¡Œå®‰æ’ï¼Œå¦åˆ™ä¸€ç›´ç­‰å¾…ã€‚</p><p>å¼€å§‹æ—¶ï¼Œ<code>/queue_barrier</code> èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå·²å­˜åœ¨çš„é»˜è®¤èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶èŠ‚ç‚¹çš„æ•°æ®å†…å®¹èµ‹å€¼ä¸ºä¸€ä¸ªæ•°å­—næ¥ä»£è¡¨Barrierå€¼ï¼Œå½“å­èŠ‚ç‚¹æ•°è¾¾åˆ°nåæ‰èƒ½æ‰“å¼€Barrierï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½è¦åˆ°æ­¤èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010122.png" alt></p><p>åˆ›å»ºå®ŒèŠ‚ç‚¹åï¼Œç¡®å®šæ‰§è¡Œé¡ºåºçš„æ­¥éª¤ï¼š</p><ol><li>é€šè¿‡è°ƒç”¨ <code>getData()</code> æ¥å£è·å– <code>/queue_barrier</code> èŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼š10ã€‚</li><li>é€šè¿‡è°ƒç”¨ <code>getChildren()</code> æ¥å£è·å– <code>/queue_barrier</code> èŠ‚ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå³è·å–é˜Ÿåˆ—ä¸­æ‰€æœ‰å…ƒç´ ï¼ŒåŒæ—¶æ³¨å†Œå¯¹å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´çš„Watcherç›‘å¬ã€‚</li><li>ç»Ÿè®¡å­èŠ‚ç‚¹çš„ä¸ªæ•°ã€‚</li><li>å¦‚æœå­èŠ‚ç‚¹ä¸ªæ•°ä¸è¶³10ä¸ªï¼Œéœ€è¦è¿›å…¥ç­‰å¾…ã€‚</li><li>æ¥æ”¶åˆ°Watcheré€šçŸ¥åï¼Œé‡å¤æ­¥éª¤2ã€‚</li></ol><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010123.png" alt></p><h2 id="äºŒ-å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨"><a href="#äºŒ-å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨" class="headerlink" title="äºŒ. å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨"></a>äºŒ. å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨</h2><p>ZKå› ä¸ºä¾¿æ·çš„ä½¿ç”¨æ–¹å¼ã€å“è¶Šçš„è¿è¡Œæ€§èƒ½å’Œè‰¯å¥½çš„ç¨³å®šæ€§ï¼Œå·²ç»è¢«å¹¿æ³›çš„åº”ç”¨åœ¨è¶Šæ¥è¶Šå¤šçš„å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”¨æ¥è§£å†³å¦‚é…ç½®ç®¡ç†ã€åˆ†å¸ƒå¼é€šçŸ¥/åè°ƒã€é›†ç¾¤ç®¡ç†å’ŒMasteré€‰ä¸¾ç­‰ä¸€ç³»åˆ—åˆ†å¸ƒå¼é—®é¢˜ã€‚</p><h3 id="2-1-Hadoop"><a href="#2-1-Hadoop" class="headerlink" title="2.1 Hadoop"></a>2.1 Hadoop</h3><p>Hadoopæ˜¯Apacheå¼€æºçš„ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œå®šä¹‰äº†ä¸€ç§èƒ½å¤Ÿå¼€å‘å’Œè¿è¡Œå¤„ç†æµ·é‡æ•°æ®çš„è½¯ä»¶è§„èŒƒï¼Œç”¨æ¥å®ç°ä¸€ä¸ªåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­å¯¹æµ·é‡æ•°æ®è¿›è¡Œåˆ†å¸ƒå¼è®¡ç®—çš„è½¯ä»¶å¹³å°ã€‚<strong>æ ¸å¿ƒæ˜¯HDFSå’ŒMapReduceï¼Œåˆ†åˆ«æä¾›äº†å¯¹æµ·é‡æ•°æ®çš„å­˜å‚¨å’Œè®¡ç®—èƒ½åŠ›</strong>ã€‚0.23.0ç‰ˆæœ¬ååˆå¼•å…¥å…¨æ–°ä¸€ä»£MapReduceæ¡†æ¶YARNã€‚</p><p>åœ¨Hadoopä¸­ï¼ŒZooKeeperæ³¨æ„ç”¨äºå®ç°HAï¼ˆHigh Availabilityï¼Œé«˜å¯ç”¨ï¼‰é›†ä¸­äºHadoop Commonä¸­çš„HAæ¨¡å—ï¼ŒHDFSçš„NameNodeä¸YARNçš„ResourceManageréƒ½æ˜¯åŸºäºæ­¤HAæ¨¡å—å®ç°è‡ªå·±çš„HAåŠŸèƒ½ï¼ŒYARNè¿˜ç”¨ZooKeeperæ¥å­˜å‚¨åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ã€‚</p><h4 id="ï¼ˆ1ï¼‰YARN"><a href="#ï¼ˆ1ï¼‰YARN" class="headerlink" title="ï¼ˆ1ï¼‰YARN"></a>ï¼ˆ1ï¼‰YARN</h4><p>YARNæ˜¯Hadoopä¸ºäº†æé«˜è®¡ç®—èŠ‚ç‚¹Masterçš„æ‰©å±•æ€§ï¼ŒåŒæ—¶ä¸ºäº†æ”¯æŒå¤šè®¡ç®—æ¨¡å‹å’Œæä¾›èµ„æºçš„ç»†ç²’åº¦è°ƒåº¦è€Œå¼•å…¥çš„å…¨æ–°ä¸€ä»£åˆ†å¸ƒå¼è°ƒåº¦æ¡†æ¶ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010124.png" alt></p><p>YARNç”±å››éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>ResourceManagerï¼ˆRMï¼‰ï¼š</strong>æ ¸å¿ƒæ¨¡å—ï¼Œå…¨å±€èµ„æºç®¡ç†å™¨ï¼Œè´Ÿè´£æ•´ä¸ªç³»ç»Ÿçš„èµ„æºç®¡ç†å’Œåˆ†é…ï¼ŒåŒæ—¶æ¥æ”¶å„ä¸ªèŠ‚ç‚¹ï¼ˆNodeManagerï¼‰çš„èµ„æºæ±‡æŠ¥ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥åˆ†é…ç»™å„ä¸ªåº”ç”¨ç¨‹åºï¼ˆApplicationMasterï¼‰ã€‚å…¶å†…éƒ¨ç»´æŠ¤äº†å„ä¸ªåº”ç”¨ç¨‹åºçš„ApplicationMasterä¿¡æ¯ã€NodeManagerä¿¡æ¯ä»¥åŠèµ„æºä½¿ç”¨ä¿¡æ¯ç­‰ã€‚</li><li><strong>NodeManagerï¼ˆNMï¼‰</strong></li><li><strong>ApplicationMasterï¼ˆAMï¼‰</strong></li><li><strong>Container</strong></li></ul><h4 id="ï¼ˆ2ï¼‰ResourceManagerå•ç‚¹é—®é¢˜"><a href="#ï¼ˆ2ï¼‰ResourceManagerå•ç‚¹é—®é¢˜" class="headerlink" title="ï¼ˆ2ï¼‰ResourceManagerå•ç‚¹é—®é¢˜"></a>ï¼ˆ2ï¼‰ResourceManagerå•ç‚¹é—®é¢˜</h4><p>ä¸Šè¿°æ¶æ„å¯ä»¥æ˜æ˜¾çœ‹å‡ºå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šResourceManagerå•ç‚¹é—®é¢˜ã€‚YARNè®¾è®¡äº†ä¸€å¥— <strong>Active/Standby æ¨¡å¼çš„ ResourceManager HA æ¶æ„</strong>ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010125.png" alt></p><p>è¿è¡ŒæœŸé—´æœ‰å¤šä¸ªRMå¹¶å­˜ï¼Œåªæœ‰ä¸€ä¸ªå¤„äºActiveçŠ¶æ€ï¼Œå¦å¤–åˆ™å¤„äºStandbyçŠ¶æ€ï¼Œå½“ActiveèŠ‚ç‚¹æ— æ³•æ­£å¸¸å·¥ä½œæ—¶ï¼Œå…¶ä½™èŠ‚ç‚¹é€šè¿‡ç«äº‰é€‰ä¸¾å‡ºæ–°çš„ActiveèŠ‚ç‚¹ã€‚</p><p>YARNä½¿ç”¨åŸºäºZooKeeperå®ç°çš„ActiveStandbyElectorç»„ä»¶æ¥ç¡®å®šRMçš„çŠ¶æ€ï¼Œä»è€Œå®ç°å¤šä¸ªRMçš„ä¸»å¤‡åˆ‡æ¢ï¼š</p><ol><li><strong>åˆ›å»ºé”èŠ‚ç‚¹ï¼š</strong>ZKä¸Šä¼šæœ‰ä¸€ä¸ªç±»ä¼¼äº <code>/yarn-leader-election/pseudo-yarn-rm-cluster</code> çš„é”èŠ‚ç‚¹ï¼Œæ‰€æœ‰RMåœ¨å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šå»ç«äº‰å†™ä¸€ä¸ªLockå­èŠ‚ç‚¹ <code>../ActiveStandbyElectorLock</code> ï¼Œè¯¥å­èŠ‚ç‚¹ç±»å‹æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸçš„RMåˆ‡æ¢ä¸ºActiveçŠ¶æ€ï¼Œæ²¡æœ‰çš„åˆ‡æ¢ä¸ºStandbyçŠ¶æ€ã€‚</li><li><strong>æ³¨å†ŒWatcherç›‘å¬ï¼š</strong>StandbyçŠ¶æ€çš„RMå‘ <code>../ActiveStandbyElectorLock</code> èŠ‚ç‚¹æ³¨å†Œä¸€ä¸ªWatcherç›‘å¬èŠ‚ç‚¹å˜æ›´ã€‚</li><li><strong>ä¸»å¤‡åˆ‡æ¢ï¼š</strong>å½“ActiveçŠ¶æ€çš„èŠ‚ç‚¹å‡ºç°å¼‚å¸¸æƒ…å†µï¼Œå…¶åˆ›å»ºçš„LockèŠ‚ç‚¹ä¼šéšä¹‹åˆ é™¤ï¼Œæ‰€æœ‰StandbyçŠ¶æ€çš„RMæ”¶åˆ°é€šçŸ¥åé‡å¤æ­¥éª¤1æ“ä½œã€‚</li></ol><p>HDFSä¸­çš„NameNodeå’ŒResourceManageréƒ½ä½¿ç”¨è¯¥ç»„ä»¶æ¥å®ç°å„è‡ªçš„HAã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010126.png" alt></p><h4 id="ï¼ˆ3ï¼‰Fencingéš”ç¦»"><a href="#ï¼ˆ3ï¼‰Fencingéš”ç¦»" class="headerlink" title="ï¼ˆ3ï¼‰Fencingéš”ç¦»"></a>ï¼ˆ3ï¼‰Fencingéš”ç¦»</h4><p>åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæœºå™¨ä¼šç”±äºç½‘ç»œé—ªæ–­æˆ–è‡ªèº«è´Ÿè½½è¿‡é«˜ï¼ˆGCå ç”¨æ—¶é—´è¿‡é•¿æˆ–CPUè´Ÿè½½è¿‡é«˜ï¼‰å¯¼è‡´æ— æ³•æ­£å¸¸çš„å¯¹å¤–è¿›è¡ŒåŠæ—¶å“åº”ï¼Œå³â€œ<strong>å‡æ­»</strong>â€çš„æƒ…å†µã€‚å½“ActiveçŠ¶æ€çš„RM1æœºå™¨å‘ç”Ÿå‡æ­»æƒ…å†µï¼Œä¸»å¤‡åˆ‡æ¢åRM2æˆä¸ºActiveçŠ¶æ€ï¼Œè€ŒRM1æ¢å¤æ­£å¸¸åä¾ç„¶ä¼šè®¤ä¸ºè‡ªå·±å¤„äºActiveçŠ¶æ€ï¼Œå³<strong>åˆ†å¸ƒå¼è„‘è£‚ç°è±¡</strong>ï¼ˆBrain-Splitï¼‰ã€‚</p><p>Fencingæœºåˆ¶åˆ©ç”¨ZKæ•°æ®èŠ‚ç‚¹çš„ACLæƒé™æ§åˆ¶æœºåˆ¶æ¥å®ç°ä¸åŒRMä¹‹é—´çš„éš”ç¦»ï¼Œå¤šä¸ªRMä¹‹é—´é€šè¿‡ç«äº‰åˆ›å»ºé”èŠ‚ç‚¹æ¥å®ç°ä¸»å¤‡çŠ¶æ€çš„ç¡®å®šï¼Œæ”¹è¿›ä¸ºåˆ›å»ºçš„æ ¹èŠ‚ç‚¹å¿…é¡»æºå¸¦ZKçš„ACLä¿¡æ¯ï¼Œç›®çš„æ˜¯ä¸ºäº†ç‹¬å è¯¥æ ¹èŠ‚ç‚¹ï¼Œé˜²æ­¢å…¶ä»–RMå¯¹èŠ‚ç‚¹è¿›è¡Œæ›´æ–°ã€‚</p><p>å½“RM1å‡ºç°å‡æ­»åï¼ŒZKä¼šå°†å…¶åˆ›å»ºçš„é”èŠ‚ç‚¹ç§»é™¤ï¼ŒRM2åˆ›å»ºç›¸åº”çš„é”èŠ‚ç‚¹å¹¶åˆ‡æ¢ä¸ºActiveçŠ¶æ€ã€‚RM1æ¢å¤ä¹‹åä¼šè¯•å›¾æ›´æ–°ZKçš„ç›¸å…³æ•°æ®ï¼Œä½†å‘ç°æ²¡æœ‰æƒé™ï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹ä¸æ˜¯è‡ªå·±åˆ›å»ºçš„ï¼Œäºæ˜¯è‡ªåŠ¨åˆ‡æ¢å›StandbyçŠ¶æ€ã€‚</p><h4 id="ï¼ˆ4ï¼‰ResourceManagerçŠ¶æ€å­˜å‚¨"><a href="#ï¼ˆ4ï¼‰ResourceManagerçŠ¶æ€å­˜å‚¨" class="headerlink" title="ï¼ˆ4ï¼‰ResourceManagerçŠ¶æ€å­˜å‚¨"></a>ï¼ˆ4ï¼‰ResourceManagerçŠ¶æ€å­˜å‚¨</h4><p>åœ¨ResourceManagerä¸­ï¼ŒRMStateStoreèƒ½å¤Ÿå­˜å‚¨ä¸€äº›RMçš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬Applicationå’Œå®ƒä»¬çš„Attemptsä¿¡æ¯ã€Delegation TokenåŠVersion Informationç­‰ï¼Œå¤§éƒ¨åˆ†çŠ¶æ€ä¿¡æ¯å› ä¸ºå¾ˆå®¹æ˜“ä»ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸­é‡æ„å‡ºæ¥æ‰€ä»¥ä¸éœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œæ‰€ä»¥å­˜å‚¨çš„è®¾è®¡æ–¹æ¡ˆæœ‰ï¼š</p><ul><li>åŸºäºå†…å­˜å®ç°ï¼Œä¸€èˆ¬ç”¨äºæ—¥å¸¸å¼€å‘æµ‹è¯•ã€‚</li><li>åŸºäºæ–‡ä»¶ç³»ç»Ÿå®ç°ï¼Œå¦‚HDFSã€‚</li><li>åŸºäºZooKeeperå®ç°ã€‚</li></ul><p>Hadoopå®˜æ–¹å»ºè®®ä½¿ç”¨ZooKeeperæ¥å®ç°ï¼Œå­˜æ”¾åœ¨ <code>/rmstore</code> èŠ‚ç‚¹ä¸‹ï¼ŒRMAppRootèŠ‚ç‚¹ä¸‹å­˜æ”¾çš„æ˜¯ä¸å„ä¸ªApplicationç›¸å…³çš„ä¿¡æ¯ï¼ŒRMDTSecretManagerRootå­˜æ”¾çš„æ˜¯å®‰å…¨ç›¸å…³çš„Tokenç­‰ä¿¡æ¯ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010127.png" alt></p><p>æ¯ä¸ªActiveçŠ¶æ€çš„RMåœ¨åˆå§‹åŒ–é˜¶æ®µä¼šä»ZKä¸Šè¯»å–è¿™äº›çŠ¶æ€ä¿¡æ¯ã€‚</p><h3 id="2-2-HBase"><a href="#2-2-HBase" class="headerlink" title="2.2 HBase"></a>2.2 HBase</h3><p>HBaseï¼Œå³ Hadoop Databaseï¼Œæ˜¯ Google Bigtable çš„å¼€æºå®ç°ï¼ŒåŸºäºHadoopæ–‡ä»¶ç³»ç»Ÿè®¾è®¡çš„é¢å‘æµ·é‡æ•°æ®çš„é«˜å¯é æ€§ã€é«˜æ€§èƒ½ã€é¢å‘åˆ—ã€å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚</p><p>ä¸å¤§éƒ¨åˆ†åˆ†å¸ƒå¼NoSQLæ•°æ®åº“ä¸åŒçš„æ˜¯ï¼ŒHBaseé’ˆå¯¹æ•°æ®å†™å…¥å…·æœ‰å¼ºä¸€è‡´æ€§çš„ç‰¹æ€§ï¼Œç”šè‡³åŒ…æ‹¬ç´¢å¼•åˆ—ä¹Ÿå®ç°äº†å¼ºä¸€è‡´æ€§ã€‚</p><p>HBaseåœ¨å®ç°ä¸Šéµå®ˆäº† Google BigTable è®ºæ–‡çš„è®¾è®¡æ€æƒ³ï¼ŒBigTableä½¿ç”¨Chubbyæ¥è´Ÿè´£åˆ†å¸ƒå¼çŠ¶æ€çš„åè°ƒï¼ŒChubbyæ˜¯Googleå®ç°çš„ä¸€ç§åŸºäºPaxosç®—æ³•çš„åˆ†å¸ƒå¼é”æœåŠ¡ï¼ŒHBaseåˆ™é‡‡ç”¨äº†å¼€æºçš„ZooKeeperæœåŠ¡æ¥å®Œæˆå¯¹æ•´ä¸ªç³»ç»Ÿçš„åˆ†å¸ƒå¼åè°ƒå·¥ä½œã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010128.png" alt></p><h4 id="ï¼ˆ1ï¼‰ç³»ç»Ÿå†—é”™"><a href="#ï¼ˆ1ï¼‰ç³»ç»Ÿå†—é”™" class="headerlink" title="ï¼ˆ1ï¼‰ç³»ç»Ÿå†—é”™"></a>ï¼ˆ1ï¼‰ç³»ç»Ÿå†—é”™</h4><p>å¯åŠ¨æ—¶ï¼Œæ¯ä¸ªRegionServeræœåŠ¡å™¨éƒ½ä¼šåˆ°ZKçš„ <code>/hbase/rs</code> èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªä¿¡æ¯èŠ‚ç‚¹ï¼ˆrsçŠ¶æ€èŠ‚ç‚¹ï¼‰ï¼ŒåŒæ—¶HMasterå¯¹è¿™ä¸ªèŠ‚ç‚¹æ³¨å†Œç›‘å¬ã€‚æŸä¸ªRSæŒ‚æ‰ï¼ŒZKå› ä¸ºä¸€æ®µæ—¶é—´æ— æ³•æ”¶åˆ°å¿ƒè·³ä¿¡æ¯ï¼Œè€Œåˆ é™¤æ‰å…¶å¯¹åº”çš„rsçŠ¶æ€èŠ‚ç‚¹ã€‚</p><p>åŒæ—¶HMasteræ”¶åˆ°ZKçš„NodeDeleteé€šçŸ¥ï¼Œä»è€Œæ„ŸçŸ¥åˆ°æŸä¸ªèŠ‚ç‚¹æ–­å¼€ï¼Œå¹¶ç«‹å³å¼€å§‹å†—é”™å·¥ä½œï¼Œå°†è¯¥RSå¤„ç†çš„æ•°æ®åˆ†ç‰‡Regioné‡æ–°è·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œå¹¶è®°å½•åˆ°Metaä¿¡æ¯ä¸­ä¾›å®¢æˆ·ç«¯æŸ¥è¯¢ã€‚</p><p>HMasterä¸ç›´æ¥é€šè¿‡å¿ƒè·³æœºåˆ¶ç®¡ç†RSçš„çŠ¶æ€ï¼Œå› ä¸ºä¼šéšç€ç³»ç»Ÿå®¹é‡çš„ä¸æ–­å¢åŠ å…¶ç®¡ç†è´Ÿæ‹…ä¼šè¶Šæ¥è¶Šé‡ã€‚</p><h4 id="ï¼ˆ2ï¼‰RootRegionç®¡ç†"><a href="#ï¼ˆ2ï¼‰RootRegionç®¡ç†" class="headerlink" title="ï¼ˆ2ï¼‰RootRegionç®¡ç†"></a>ï¼ˆ2ï¼‰RootRegionç®¡ç†</h4><p>æ•°æ®å­˜å‚¨çš„ä½ç½®ä¿¡æ¯è®°å½•åœ¨å…ƒæ•°æ®åˆ†ç‰‡RootRegionï¼Œæ¯æ¬¡å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚è¦çŸ¥é“æ•°æ®çš„ä½ç½®ï¼Œå…ˆè¦æŸ¥è¯¢RootRegionï¼ˆå­˜å‚¨åœ¨ZKä¸Šçš„ <code>/hbase/root-region-server</code> èŠ‚ç‚¹ï¼‰ï¼ŒRootRegionå‘ç”Ÿå˜åŒ–ï¼Œå¦‚Regionçš„æ‰‹å·¥ç§»åŠ¨ã€Balanceæˆ–RootRegionæ‰€åœ¨æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œèƒ½å¤Ÿé€šè¿‡ZKæ¥æ„ŸçŸ¥å˜åŒ–å¹¶æ‰§è¡Œå®¹ç¾æªæ–½ï¼Œä»è€Œä¿è¯å®¢æˆ·ç«¯æ€»èƒ½æ‹¿åˆ°æ­£ç¡®çš„RootRegionä¿¡æ¯ã€‚</p><h4 id="ï¼ˆ3ï¼‰RegionçŠ¶æ€ç®¡ç†"><a href="#ï¼ˆ3ï¼‰RegionçŠ¶æ€ç®¡ç†" class="headerlink" title="ï¼ˆ3ï¼‰RegionçŠ¶æ€ç®¡ç†"></a>ï¼ˆ3ï¼‰RegionçŠ¶æ€ç®¡ç†</h4><p>Regionæ˜¯HBaseä¸­æ•°æ®çš„ç‰©ç†åˆ‡ç‰‡ï¼Œæ¯ä¸ªRegionè®°å½•å…¨å±€æ•°æ®çš„ä¸€å°éƒ¨åˆ†ï¼Œä¸åŒRegioné—´æ•°æ®ä¸é‡å¤ã€‚ä½†å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼ŒRegionæ˜¯ä¼šç»å¸¸å› ä¸ºç³»ç»Ÿæ•…éšœã€è´Ÿè½½å‡è¡¡ã€é…ç½®ä¿®æ”¹ã€Regionåˆ†è£‚å’Œåˆå¹¶ç­‰å‘ç”Ÿå˜æ›´ã€‚ä¸€æ—¦Regionç§»åŠ¨å°±ä¼šå°½åŠ›Offlineå’Œé‡æ–°Onlineçš„è¿‡ç¨‹ã€‚</p><p>OfflineæœŸé—´æ•°æ®ä¸èƒ½è¢«è®¿é—®ï¼Œå¹¶ä¸”Regionçš„çŠ¶æ€å˜åŒ–éœ€è¦è®©å…¨å±€çŸ¥æ™“ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æŸäº›äº‹åŠ¡æ€§å¼‚å¸¸ã€‚å¯¹äºHBaseé›†ç¾¤ï¼ŒRegionçš„æ•°é‡å¯èƒ½è¾¾åˆ°10ä¸‡çº§åˆ«ï¼Œæ‰€ä»¥éœ€è¦ä¾èµ–ZKæ¥åšåˆ°ã€‚</p><h4 id="ï¼ˆ4ï¼‰åˆ†å¸ƒå¼SplitLogä»»åŠ¡ç®¡ç†"><a href="#ï¼ˆ4ï¼‰åˆ†å¸ƒå¼SplitLogä»»åŠ¡ç®¡ç†" class="headerlink" title="ï¼ˆ4ï¼‰åˆ†å¸ƒå¼SplitLogä»»åŠ¡ç®¡ç†"></a>ï¼ˆ4ï¼‰åˆ†å¸ƒå¼SplitLogä»»åŠ¡ç®¡ç†</h4><p>æŸå°RegionServeræœåŠ¡å™¨æŒ‚æ‰æ—¶ï¼Œæ€»æœ‰ä¸€éƒ¨åˆ†æ–°å†™å…¥çš„æ•°æ®è¿˜æ²¡æœ‰æŒä¹…åŒ–åˆ°HFileä¸­ï¼Œå› æ­¤è¿ç§»è¯¥RegionServeræœåŠ¡æ—¶è¦ä»HLogä¸­æ¢å¤è¿™éƒ¨åˆ†è¿˜åœ¨å†…å­˜ä¸­çš„æ•°æ®ï¼Œæœ€å…³é”®çš„ä¸€æ­¥æ˜¯SplitLogï¼Œå³HMasteréœ€è¦éå†è¯¥RegionServeræœåŠ¡å™¨çš„HLogï¼Œå¹¶æŒ‰Regionåˆ‡åˆ†æˆå°å—ç§»åŠ¨åˆ°æ–°çš„åœ°å€ä¸‹ï¼Œå†è¿›è¡Œæ•°æ®çš„Replayã€‚</p><p>å•ä¸ªRegionServerçš„æ—¥å¿—é‡ç›¸å¯¹åºå¤§ï¼ˆæ•°åƒä¸ªRegionï¼Œä¸ŠGBçš„æ—¥å¿—ï¼‰ï¼Œä½†åˆéœ€è¦ç³»ç»Ÿå¿«é€Ÿçš„å®Œæˆæ—¥å¿—çš„æ¢å¤å·¥ä½œï¼Œä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆæ˜¯å°†å¤„ç†HLogçš„ä»»åŠ¡åˆ†é…ç»™å¤šå°RegionServeræœåŠ¡å™¨æ¥å…±åŒå¤„ç†ï¼Œéœ€è¦ä¸€ä¸ªæŒä¹…åŒ–ç»„ä»¶è¾…åŠ©HMasterå®Œæˆä»»åŠ¡çš„åˆ†é…ã€‚</p><p>HMasterä¼šåœ¨ZKä¸Šåˆ›å»ºä¸€ä¸ª <code>/hbase/splitlog</code> çš„èŠ‚ç‚¹ï¼Œå°†å“ªä¸ªRegionServerå¤„ç†å“ªä¸ªRegionè¿™æ ·çš„ä¿¡æ¯ä»¥åˆ—è¡¨çš„å½¢å¼å­˜æ”¾åœ¨è¯¥èŠ‚ç‚¹ï¼Œå„ä¸ªRegionServeræœåŠ¡å™¨è‡ªè¡Œåˆ°è¯¥èŠ‚ç‚¹ä¸Šé¢†å–ä»»åŠ¡å¹¶åœ¨ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥åæ›´æ–°è¯¥èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œä»¥é€šçŸ¥HMasterç»§ç»­è¿›è¡Œåç»­æ­¥éª¤ã€‚ZKè´Ÿè´£åˆ†å¸ƒå¼é›†ç¾¤ä¸­ç›¸äº’é€šçŸ¥å’Œä¿¡æ¯æŒä¹…åŒ–çš„è§’è‰²ã€‚</p><h4 id="ï¼ˆ5ï¼‰Replicationç®¡ç†"><a href="#ï¼ˆ5ï¼‰Replicationç®¡ç†" class="headerlink" title="ï¼ˆ5ï¼‰Replicationç®¡ç†"></a>ï¼ˆ5ï¼‰Replicationç®¡ç†</h4><p>HBaseé€šè¿‡Replicationå®ç°å®æ—¶çš„ä¸»å¤‡åŒæ­¥ï¼Œä»è€Œæ‹¥æœ‰äº†å®¹ç¾å’Œåˆ†æµç­‰å…³ç³»å‹æ•°æ®åº“æ‹¥æœ‰çš„åŠŸèƒ½ã€‚ä¸ä¼ ç»ŸReplicationä¸åŒçš„æ˜¯ï¼ŒHBaseä¸­Replicationæ˜¯å¤šå¯¹å¤šçš„ï¼Œä¸”æ¯ä¸ªèŠ‚ç‚¹éšæ—¶éƒ½æœ‰å¯èƒ½æŒ‚æ‰ã€‚</p><p>åœ¨ZKä¸Šè®°å½•ä¸€ä¸ª <code>/hbase/replication</code> èŠ‚ç‚¹ï¼Œç„¶åæŠŠä¸åŒçš„RegionServeræœåŠ¡å™¨å¯¹åº”çš„HLogæ–‡ä»¶åç§°è®°å½•åˆ°ç›¸åº”çš„èŠ‚ç‚¹ä¸Šï¼ŒHMasteré›†ç¾¤ä¼šå°†æ–°å¢çš„æ•°æ®æ¨é€ç»™Slaveé›†ç¾¤ï¼Œå¹¶åŒæ—¶å°†æ¨é€ä¿¡æ¯è®°å½•åˆ°ZKä¸Šï¼ˆæ–­ç‚¹è®°å½•ï¼‰ï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹ã€‚æœåŠ¡å™¨æŒ‚æ‰æ—¶ï¼Œå› ä¸ºZKä¸Šå·²ç»ä¿å­˜äº†æ–­ç‚¹ä¿¡æ¯ï¼Œåªè¦ç”¨è¿™äº›ä¿¡æ¯åè°ƒæ¨é€HLogæ•°æ®çš„ä¸»èŠ‚ç‚¹æœåŠ¡å™¨å°±å¯ä»¥ç»§ç»­å¤åˆ¶ã€‚</p><h4 id="ï¼ˆ6ï¼‰ZooKeeperéƒ¨ç½²"><a href="#ï¼ˆ6ï¼‰ZooKeeperéƒ¨ç½²" class="headerlink" title="ï¼ˆ6ï¼‰ZooKeeperéƒ¨ç½²"></a>ï¼ˆ6ï¼‰ZooKeeperéƒ¨ç½²</h4><p>HBaseçš„å¯åŠ¨è„šæœ¬ï¼ˆhbase-env.shï¼‰ä¸­å¯ä»¥é€‰æ‹©ç”±HBaseå¯åŠ¨å…¶è‡ªå¸¦çš„é»˜è®¤ZKè¿˜æ˜¯ä½¿ç”¨ä¸€ä¸ªå·²æœ‰çš„å¤–éƒ¨ZKé›†ç¾¤ã€‚ä¸€èˆ¬å»ºè®®åè€…ï¼Œå¯ä»¥æ–¹ä¾¿å¤šä¸ªHBaseå¤ç”¨ä¸€å¥—ZKé›†ç¾¤ï¼Œä½†è¦ä¸ºæ¯ä¸ªHBaseé›†ç¾¤æ˜ç¡®æŒ‡å®šå¯¹åº”çš„ZKæ ¹èŠ‚ç‚¹é…ç½®ï¼ˆé…ç½®é¡¹zookeeper.znode.parentï¼‰ç¡®ä¿HBaseé›†ç¾¤é—´äº’ä¸å¹²æ‰°ã€‚</p><p>å¯¹åº”HBaseå®¢æˆ·ç«¯åªè¦æŒ‡å®šZKçš„é›†ç¾¤åœ°å€å’Œå¯¹åº”HBaseæ ¹èŠ‚ç‚¹é…ç½®å³å¯ã€‚HBaseé›†ç¾¤å¯åŠ¨æ—¶ä¼šåœ¨ZKä¸Šé€ä¸ªæ·»åŠ å¯¹åº”çš„åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œå¹¶åœ¨HMasterä»¥åŠRegionServerè¿›ç¨‹ä¸­è¿›è¡Œç›¸åº”èŠ‚ç‚¹çš„Watcheræ³¨å†Œã€‚</p><h3 id="2-3-Kafka"><a href="#2-3-Kafka" class="headerlink" title="2.3 Kafka"></a>2.3 Kafka</h3><p>Kafkaæ˜¯ç”±ç¤¾äº¤å…¬å¸LinkedInäº2010å¹´12æœˆä»½å¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œç”±Scalaè¯­è¨€å¼€å‘ï¼Œå¹¿æ³›è¿ç”¨åœ¨Twitterã€Netflixå’ŒTumblrç­‰å¤§å‹äº’è”ç½‘ç«™ç‚¹ä¸Šã€‚</p><ul><li>ä¸»è¦ç”¨äº<strong>å®ç°ä½å»¶è¿Ÿçš„å‘é€å’Œæ”¶é›†å¤§é‡çš„äº‹ä»¶å’Œæ—¥å¿—æ•°æ®</strong>ï¼ˆæ´»è·ƒæ•°æ®ï¼Œå¦‚ç½‘ç«™çš„PVæ•°å’Œç”¨æˆ·è®¿é—®è®°å½•ï¼‰ï¼Œè¿™äº›æ•°æ®ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•ä¸‹æ¥ï¼Œç„¶åç”±ä¸€ä¸ªä¸“é—¨çš„ç³»ç»Ÿè¿›è¡Œæ—¥å¿—çš„æ”¶é›†ä¸ç»Ÿè®¡ã€‚</li><li>ååé‡æé«˜ï¼Œæ•´ä½“è®¾è®¡æ˜¯å…¸å‹çš„å‘å¸ƒä¸è®¢é˜…æ¨¡å¼ç³»ç»Ÿã€‚é›†ç¾¤ä¸­æ‰€æœ‰æœåŠ¡å™¨éƒ½æ˜¯å¯¹ç­‰çš„ï¼Œå¯ä»¥åœ¨ä¸åšä»»ä½•é…ç½®æ›´æ”¹çš„æƒ…å†µä¸‹å®ç°æœåŠ¡å™¨çš„æ·»åŠ ä¸åˆ é™¤ï¼Œæ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹Ÿèƒ½åšåˆ°éšæ„é‡å¯å’Œæœºå™¨ä¸Šä¸‹çº¿ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010129.png" alt></p><h4 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h4><ul><li><strong>æ¶ˆæ¯ç”Ÿäº§è€…ï¼š</strong>å³Producerï¼Œç”Ÿæˆæ¶ˆæ¯å¹¶å‘é€åˆ°KafkaæœåŠ¡å™¨ä¸Šã€‚</li><li><strong>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼š</strong>å³Consumerï¼Œè´Ÿè´£æ¶ˆè´¹KafkaæœåŠ¡å™¨ä¸Šçš„æ¶ˆæ¯ã€‚</li><li><strong>ä¸»é¢˜ï¼š</strong>å³Topicï¼Œç”±ç”¨æˆ·å®šä¹‰å¹¶é…ç½®åœ¨KafkaæœåŠ¡ç«¯ï¼Œç”¨äºå»ºç«‹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„è®¢é˜…å…³ç³»ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°æŒ‡å®štopicä¸‹ï¼Œæ¶ˆè´¹è€…ä»è¯¥topicæ¶ˆè´¹æ¶ˆæ¯ã€‚</li><li><strong>æ¶ˆæ¯åˆ†åŒºï¼š</strong>å³Partitionï¼Œä¸€ä¸ªtopicä¸‹åˆ†å¤šä¸ªåˆ†åŒºï¼Œå¦‚topic1åˆ†10ä¸ªåˆ†åŒºï¼Œç”±ä¸¤å°æœåŠ¡å™¨æä¾›ï¼Œæ¯å°5ä¸ªåˆ†åŒºï¼ŒæœåŠ¡å™¨IDä¸º0å’Œ1ï¼Œåˆ†åŒºä¸º0-0åˆ°0-4å’Œ1-0åˆ°1-4ã€‚æ¶ˆæ¯åˆ†åŒºæœºåˆ¶å’Œåˆ†åŒºæ•°é‡ä¸æ¶ˆè´¹è€…çš„è´Ÿè½½å‡è¡¡æœºåˆ¶æœ‰å¾ˆå¤§å…³ç³»ã€‚</li><li><strong>Brokerï¼š</strong>å³Kafkaçš„æœåŠ¡å™¨ï¼Œç”¨äºå­˜å‚¨æ¶ˆæ¯ã€‚</li><li><strong>æ¶ˆè´¹è€…åˆ†ç»„ï¼š</strong>å³Groupï¼Œç”¨äºå½’ç»„åŒç±»æ¶ˆè´¹è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å…±åŒæ¶ˆè´¹ä¸€ä¸ªtopicä¸‹çš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆè´¹è€…ç»„æˆä¸€ä¸ªåˆ†ç»„/é›†ç¾¤ã€‚</li><li><strong>Offsetï¼š</strong>æ¶ˆæ¯å­˜å‚¨åœ¨Kafkaçš„Brokerä¸Šï¼Œæ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯æ•°æ®çš„è¿‡ç¨‹éœ€è¦åœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ã€‚</li></ul><h4 id="Brokeræ³¨å†Œ"><a href="#Brokeræ³¨å†Œ" class="headerlink" title="Brokeræ³¨å†Œ"></a>Brokeræ³¨å†Œ</h4><p>Brokerã€Producerå’ŒConsumeræ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼ŒBrokerè™½ç„¶ç›¸äº’ç‹¬ç«‹è¿è¡Œä½†éœ€è¦ä¸€ä¸ªæ³¨å†Œç³»ç»Ÿç»Ÿä¸€ç®¡ç†æ‰€æœ‰èŠ‚ç‚¹ã€‚ZKä¸Šé…ç½®ä¸€ä¸ªBrokerèŠ‚ç‚¹ <code>/broker/ids</code> ï¼Œæ¯ä¸ªBrokeræœåŠ¡å™¨å¯åŠ¨æ—¶éƒ½å…ˆä¼šåˆ°ZKä¸Šè¿›è¡Œæ³¨å†Œ <code>/broker/ids/[0...N]</code> ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ã€‚</p><p>ä½¿ç”¨å…¨å±€å”¯ä¸€IDï¼ˆBroker  IDï¼‰æ¥æŒ‡ä»£æ¯å°BrokeræœåŠ¡å™¨ï¼Œåˆ›å»ºå®ŒèŠ‚ç‚¹åæ¯ä¸ªBrokerä¼šå°†è‡ªå·±çš„IPåœ°å€å’Œç«¯å£ç­‰ä¿¡æ¯å†™å…¥æ­¤èŠ‚ç‚¹ã€‚</p><h4 id="Topicæ³¨å†Œ"><a href="#Topicæ³¨å†Œ" class="headerlink" title="Topicæ³¨å†Œ"></a>Topicæ³¨å†Œ</h4><p>Kafkaä¸­å°†åŒä¸€ä¸ªTopicçš„æ¶ˆæ¯åˆ†ä¸ºå¤šä¸ªåˆ†åŒºå¹¶åˆ†å¸ƒåˆ°å¤šä¸ªBrokerä¸Šï¼Œè¿™äº›åˆ†åŒºä¿¡æ¯å’ŒBrokerçš„å¯¹åº”ä¿¡æ¯ä¹Ÿç”±ZKç»´æŠ¤ï¼Œè®°å½•åœ¨èŠ‚ç‚¹ <code>/brokers/topics</code> ï¼Œå³TopicèŠ‚ç‚¹ã€‚æ¯ä¸ªTopicéƒ½ä¼šå¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹ <code>/brokers/topics/[topic]</code> ã€‚</p><p>BrokeræœåŠ¡å™¨å¯åŠ¨åï¼Œä¼šåˆ°å¯¹åº”çš„TopicèŠ‚ç‚¹ä¸‹æ³¨å†Œè‡ªå·±çš„Broker IDï¼Œå¹¶å†™å…¥é’ˆå¯¹è¯¥Topicçš„åˆ†åŒºæ€»æ•° ã€‚å¦‚ä¸´æ—¶èŠ‚ç‚¹ <code>/brokers/topics/login3-&gt;2</code> è¡¨æ˜Broker IDä¸º3çš„ä¸€å°æœåŠ¡å™¨å¯¹åº”ï¼Œloginè¿™ä¸ªä¸»é¢˜çš„æ¶ˆæ¯æä¾›äº†2ä¸ªåˆ†åŒºè¿›è¡Œæ¶ˆæ¯å­˜å‚¨ã€‚ </p><h4 id="ç”Ÿäº§è€…è´Ÿè½½å‡è¡¡"><a href="#ç”Ÿäº§è€…è´Ÿè½½å‡è¡¡" class="headerlink" title="ç”Ÿäº§è€…è´Ÿè½½å‡è¡¡"></a>ç”Ÿäº§è€…è´Ÿè½½å‡è¡¡</h4><p>å› ä¸ºä¸€ä¸ªTopicä¼šè¿›è¡Œåˆ†åŒºå¹¶åˆ†å¸ƒåˆ°ä¸åŒçš„BrokeræœåŠ¡å™¨ï¼Œæ‰€ä»¥ç”Ÿäº§è€…è¦åˆç†çš„å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„Brokerä¸Šï¼Œå¦‚ä½•è¿›è¡Œç”Ÿäº§è€…çš„è´Ÿè½½å‡è¡¡ï¼Ÿ</p><ul><li><strong>å››å±‚è´Ÿè½½å‡è¡¡ï¼š</strong><ul><li>æ ¹æ®ç”Ÿäº§è€…çš„IPåœ°å€å’Œç«¯å£ä¸ºå™¨ç¡®å®šä¸€ä¸ªç›¸å…³è”çš„Brokerï¼Œä¸€ä¸ªç”Ÿäº§è€…å¯¹åº”ä¸€ä¸ªBrokerï¼Œå…¶æ¶ˆæ¯éƒ½å‘é€ç»™æ­¤Brokerã€‚</li><li>ä¼˜ç‚¹ï¼šæ•´ä½“æ¶æ„ç®€å•ï¼Œæ¯ä¸ªç”Ÿäº§è€…åªéœ€ç»´æŠ¤å’ŒBrokerçš„å•ä¸ªTCPé“¾æ¥ã€‚</li><li>ç¼ºç‚¹ï¼šæ— æ³•åšåˆ°çœŸæ­£çš„è´Ÿè½½å‡è¡¡ï¼Œç”Ÿäº§è€…ä¹Ÿæ— æ³•å®æ—¶æ„ŸçŸ¥åˆ°Brokerçš„æ–°å¢å’Œåˆ é™¤ï¼Œä¹Ÿå°±æ— æ³•åšåˆ°åŠ¨æ€çš„è´Ÿè½½å‡è¡¡ã€‚</li></ul></li><li><strong>ZooKeeperè´Ÿè½½å‡è¡¡ï¼š</strong><ul><li>ç”Ÿäº§è€…é€šè¿‡BrokerèŠ‚ç‚¹çš„å˜åŒ–åŠ¨æ€æ„ŸçŸ¥åˆ°BrokeræœåŠ¡å™¨åˆ—è¡¨çš„å˜æ›´ï¼Œç”Ÿäº§è€…æ³¨å†Œå¯¹â€œBrokerå¢åŠ ä¸å‡å°‘â€ã€â€œTopicçš„æ–°å¢ä¸å‡å°‘â€å’Œâ€œBrokerä¸Topicå…³è”å…³ç³»çš„å˜åŒ–â€ç­‰äº‹ä»¶æ³¨å†ŒWatcherç›‘å¬ã€‚</li><li>å¼€å‘äººå‘˜å¯ä»¥æ§åˆ¶ç”Ÿäº§è€…æ ¹æ®ä¸€å®šè§„åˆ™æ¥è¿›è¡Œæ•°æ®åˆ†åŒºï¼Œè€Œä¸ä»…ä»…æ˜¯éšæœºç®—æ³•ã€‚å³è¯­ä¹‰åˆ†åŒºã€‚</li></ul></li></ul><h4 id="æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡"><a href="#æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡" class="headerlink" title="æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡"></a>æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡</h4><p>æ¯ä¸ªæ¶ˆè´¹è€…åˆ†ç»„éƒ½ä¼šåˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„Group IDï¼Œæ¯ä¸ªæ¶ˆè´¹è€…åˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„Consumer IDï¼Œæ ¼å¼ä¸º <code>Hostname:UUID</code> ã€‚</p><h5 id="ZKè®°å½•æ¶ˆæ¯åˆ†åŒºä¸æ¶ˆè´¹è€…å…³ç³»"><a href="#ZKè®°å½•æ¶ˆæ¯åˆ†åŒºä¸æ¶ˆè´¹è€…å…³ç³»" class="headerlink" title="ZKè®°å½•æ¶ˆæ¯åˆ†åŒºä¸æ¶ˆè´¹è€…å…³ç³»"></a>ZKè®°å½•æ¶ˆæ¯åˆ†åŒºä¸æ¶ˆè´¹è€…å…³ç³»</h5><p>æ¯ä¸ªæ¶ˆæ¯åˆ†åŒºæœ‰ä¸”åªèƒ½åŒäº‹æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆæ¯çš„æ¶ˆè´¹ã€‚æ‰€ä»¥è¦åœ¨ZKä¸Šè®°å½•ä¸‹æ¶ˆæ¯åˆ†åŒºä¸æ¶ˆè´¹è€…ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚å½“æ¶ˆè´¹è€…ç¡®å®šäº†å¯¹ä¸€ä¸ªåˆ†åŒºçš„æ¶ˆè´¹æƒåˆ©ï¼Œè¦å°†å…¶Consumer IDå†™å…¥å¯¹åº”åˆ†åŒºçš„ä¸´æ—¶èŠ‚ç‚¹ä¸Šï¼Œå¦‚ <code>/consumers/[group_id]/owners/[topic]/[broker_id-partition_id]</code> æœ€åå³æ¶ˆæ¯åˆ†åŒºçš„æ ‡è¯†ï¼ŒèŠ‚ç‚¹å†…å®¹å°±æ˜¯æ¶ˆè´¹è¯¥åˆ†åŒºä¸Šæ¶ˆæ¯çš„æ¶ˆè´¹è€…çš„Consumer IDã€‚</p><h5 id="ZKè®°å½•æ¶ˆè´¹è¿›åº¦Offset"><a href="#ZKè®°å½•æ¶ˆè´¹è¿›åº¦Offset" class="headerlink" title="ZKè®°å½•æ¶ˆè´¹è¿›åº¦Offset"></a>ZKè®°å½•æ¶ˆè´¹è¿›åº¦Offset</h5><p>æ¶ˆè´¹è€…å¯¹åˆ†åŒºè¿›è¡Œæ¶ˆè´¹æ—¶ï¼Œè¦å®šæ—¶çš„å°†åˆ†åŒºæ¶ˆæ¯çš„æ¶ˆè´¹è¿›åº¦/Offsetï¼ˆèŠ‚ç‚¹ä¸º <code>/consumers/[group_id]/offsets/[topic]/[broker_id-partition_id]</code> ï¼Œå†…å®¹ä¸ºOffsetå€¼ï¼‰è®°å½•åˆ°ZKä¸Šå»ï¼Œä»¥ä¾¿è¯¥æ¶ˆè´¹è€…é‡å¯æˆ–å…¶ä»–æ¶ˆè´¹è€…é‡æ–°æ¥ç®¡è¯¥æ¶ˆæ¯åˆ†åŒºæ¶ˆè´¹åï¼Œèƒ½å¤Ÿä»ä¹‹å‰çš„è¿›åº¦å¼€å§‹ç»§ç»­æ¶ˆè´¹ã€‚</p><h5 id="æ¶ˆè´¹è€…æ³¨å†Œ"><a href="#æ¶ˆè´¹è€…æ³¨å†Œ" class="headerlink" title="æ¶ˆè´¹è€…æ³¨å†Œ"></a>æ¶ˆè´¹è€…æ³¨å†Œ</h5><p>æ¶ˆè´¹è€…æœåŠ¡å™¨åˆå§‹åŒ–å¯åŠ¨æ—¶åŠ å…¥æ¶ˆè´¹è€…åˆ†ç»„çš„è¿‡ç¨‹ï¼š</p><ol><li><strong>æ³¨å†Œåˆ°æ¶ˆè´¹è€…åˆ†ç»„Groupï¼š</strong><ul><li>æ¶ˆè´¹è€…å¯åŠ¨æ—¶ï¼Œåœ¨ZKæ³¨å†Œè‡ªå·±çš„ä¸´æ—¶èŠ‚ç‚¹ <code>/consumers/[group_id]/ids/[consumer_id]</code> </li><li>å®Œæˆåˆ›å»ºåï¼Œæ¶ˆè´¹è€…å°†è‡ªå·±è®¢é˜…çš„Topicä¿¡æ¯å†™å…¥è¯¥èŠ‚ç‚¹ã€‚</li></ul></li><li><strong>å¯¹Groupä¸­æ¶ˆè´¹è€…çš„å˜åŒ–æ³¨å†Œç›‘å¬ï¼š</strong>æ¯ä¸ªæ¶ˆè´¹è€…ä¼šå…³æ³¨æ‰€å±Groupä¸­æ¶ˆè´¹è€…æœåŠ¡å™¨çš„å˜åŒ–æƒ…å†µï¼Œå¯¹ <code>/consumers/[group_id]/ids</code> èŠ‚ç‚¹æ³¨å†Œå­èŠ‚ç‚¹å˜åŒ–çš„Watcherç›‘å¬ï¼Œå½“æ¶ˆè´¹è€…å‘ç”Ÿå˜åŒ–ï¼Œä¼šè§¦å‘æ¶ˆè´¹è€…çš„è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>å¯¹BrokeræœåŠ¡å™¨çš„å˜åŒ–æ³¨å†Œç›‘å¬ï¼š</strong>æ¶ˆè´¹è€…å¯¹ <code>/broker/ids/[0...N]</code> ä¸­çš„èŠ‚ç‚¹è¿›è¡Œç›‘å¬æ³¨å†Œï¼Œå½“BrokeræœåŠ¡å™¨åˆ—è¡¨å‘ç”Ÿå˜åŒ–ï¼Œä¼šæ ¹æ®å…·ä½“æƒ…å†µå†³å®šæ˜¯å¦éœ€è¦è¿›è¡Œæ¶ˆè´¹è€…çš„è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>è¿›è¡Œæ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡ï¼š</strong>è®©åŒä¸€ä¸ªTopicä¸‹ä¸åŒåˆ†åŒºçš„æ¶ˆæ¯å°½é‡å‡è¡¡çš„å‘—å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå½“ä¸€ä¸ªGroupç»„å†…æ¶ˆè´¹è€…æœåŠ¡å™¨å‘ç”Ÿå˜æ›´ï¼Œæˆ–BrokeræœåŠ¡å™¨å‘ç”Ÿå˜æ›´ä¼šè§¦å‘æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡ã€‚</li></ol><h5 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h5><p>ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†ç»„ä¸­æ¯ä¸ªæ¶ˆè´¹è€…è®°ä¸ºC~1~ï¼ŒC~2~ï¼Œâ€¦ï¼ŒC~i~ ï¼Œâ€¦. ï¼ŒC~G~ ã€‚å¯¹äºæ¶ˆè´¹è€…C~i~å…¶å¯¹åº”çš„æ¶ˆæ¯åˆ†åŒºåˆ†é…ç­–ç•¥ä¸ºï¼š</p><ol><li>è®¾ç½®P~T~ä¸ºæŒ‡å®šTopicæ‰€æœ‰çš„æ¶ˆæ¯åˆ†åŒºã€‚</li><li>è®¾ç½®C~G~ä¸ºåŒä¸€ä¸ªæ¶ˆè´¹è€…åˆ†ç»„ä¸­æ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚</li><li>å¯¹P~T~è¿›è¡Œæ’åºï¼Œä½¿åˆ†å¸ƒåœ¨åŒä¸€ä¸ªBrokeræœåŠ¡å™¨ä¸Šçš„åˆ†åŒºå°½é‡é åœ¨ä¸€èµ·ã€‚</li><li>å¯¹C~G~è¿›è¡Œæ’åºã€‚</li><li>è®¾ç½®iä¸ºC~i~åœ¨C~G~ä¸­ä½ç½®çš„ç´¢å¼•å€¼ï¼ŒåŒäº‹hiè®¾ç½® N = size(P~T~) / size(C~G~) ã€‚</li><li>å°†ç¼–å·ä¸º <code>i*N~(I+1)*N-1</code> çš„æ¶ˆæ¯åˆ†åŒºåˆ†é…ç»™æ¶ˆè´¹è€…C~i~ ã€‚</li><li>é‡å†™æ›´æ–°ZooKeeperä¸Šæ¶ˆæ¯åˆ†åŒºä¸æ¶ˆè´¹è€… C~i~ çš„å…³ç³»ã€‚</li></ol><h2 id="ä¸‰-é˜¿é‡Œå·´å·´çš„åº”ç”¨å®è·µ"><a href="#ä¸‰-é˜¿é‡Œå·´å·´çš„åº”ç”¨å®è·µ" class="headerlink" title="ä¸‰. é˜¿é‡Œå·´å·´çš„åº”ç”¨å®è·µ"></a>ä¸‰. é˜¿é‡Œå·´å·´çš„åº”ç”¨å®è·µ</h2><p>æœªå®Œå¾…ç»­ã€‚</p><h3 id="3-1-æ¶ˆæ¯ä¸­é—´ä»¶-Metamorphosis"><a href="#3-1-æ¶ˆæ¯ä¸­é—´ä»¶-Metamorphosis" class="headerlink" title="3.1 æ¶ˆæ¯ä¸­é—´ä»¶-Metamorphosis"></a>3.1 æ¶ˆæ¯ä¸­é—´ä»¶-Metamorphosis</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010130.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010131.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010132.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010133.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010134.png" alt></p><h3 id="3-2-RPCæœåŠ¡æ¡†æ¶-Dubbo"><a href="#3-2-RPCæœåŠ¡æ¡†æ¶-Dubbo" class="headerlink" title="3.2 RPCæœåŠ¡æ¡†æ¶-Dubbo"></a>3.2 RPCæœåŠ¡æ¡†æ¶-Dubbo</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010135.png" alt></p><h3 id="3-3-åŸºäºMySQL-Binlogçš„å¢é‡è®¢é˜…å’Œæ¶ˆè´¹ç»„ä»¶-Canal"><a href="#3-3-åŸºäºMySQL-Binlogçš„å¢é‡è®¢é˜…å’Œæ¶ˆè´¹ç»„ä»¶-Canal" class="headerlink" title="3.3 åŸºäºMySQL Binlogçš„å¢é‡è®¢é˜…å’Œæ¶ˆè´¹ç»„ä»¶-Canal"></a>3.3 åŸºäºMySQL Binlogçš„å¢é‡è®¢é˜…å’Œæ¶ˆè´¹ç»„ä»¶-Canal</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010136.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010137.png" alt></p><h3 id="3-4-åˆ†å¸ƒå¼æ•°æ®åº“åŒæ­¥ç³»ç»Ÿ-Otter"><a href="#3-4-åˆ†å¸ƒå¼æ•°æ®åº“åŒæ­¥ç³»ç»Ÿ-Otter" class="headerlink" title="3.4 åˆ†å¸ƒå¼æ•°æ®åº“åŒæ­¥ç³»ç»Ÿ-Otter"></a>3.4 åˆ†å¸ƒå¼æ•°æ®åº“åŒæ­¥ç³»ç»Ÿ-Otter</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010138.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010139.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010140.png" alt></p><h3 id="3-5-è½»é‡çº§åˆ†å¸ƒå¼é€šç”¨æœç´¢å¹³å°-ç»ˆæœ"><a href="#3-5-è½»é‡çº§åˆ†å¸ƒå¼é€šç”¨æœç´¢å¹³å°-ç»ˆæœ" class="headerlink" title="3.5 è½»é‡çº§åˆ†å¸ƒå¼é€šç”¨æœç´¢å¹³å°-ç»ˆæœ"></a>3.5 è½»é‡çº§åˆ†å¸ƒå¼é€šç”¨æœç´¢å¹³å°-ç»ˆæœ</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010141.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010142.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010143.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010144.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010145.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010146.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010147.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010148.png" alt></p><h3 id="3-6-å®æ—¶è®¡ç®—å¼•æ“-JStorm"><a href="#3-6-å®æ—¶è®¡ç®—å¼•æ“-JStorm" class="headerlink" title="3.6 å®æ—¶è®¡ç®—å¼•æ“-JStorm"></a>3.6 å®æ—¶è®¡ç®—å¼•æ“-JStorm</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210501/202105010149.png" alt></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹æ¥è‡ªã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šåº”ç”¨åœºæ™¯ï¼ˆæ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Masteré€‰ä¸¾ã€åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é˜Ÿåˆ—ï¼‰ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨ï¼ˆHadoopã€HBaseã€Kafkaï¼‰ï¼Œé˜¿é‡Œå·´å·´åº”ç”¨ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="zookeeper" scheme="http://linyishui.top/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>ZooKeeperï¼ˆä¸‰ï¼‰å¼€æºå®¢æˆ·ç«¯ZkClientå’ŒCurator</title>
    <link href="http://linyishui.top/2021051601.html"/>
    <id>http://linyishui.top/2021051601.html</id>
    <published>2021-05-16T06:35:20.000Z</published>
    <updated>2021-05-19T13:59:32.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ZooKeeperï¼ˆä¸‰ï¼‰å¼€æºå®¢æˆ·ç«¯"><a href="#ZooKeeperï¼ˆä¸‰ï¼‰å¼€æºå®¢æˆ·ç«¯" class="headerlink" title="ZooKeeperï¼ˆä¸‰ï¼‰å¼€æºå®¢æˆ·ç«¯"></a>ZooKeeperï¼ˆä¸‰ï¼‰å¼€æºå®¢æˆ·ç«¯</h1><h2 id="ä¸€-ZkClient"><a href="#ä¸€-ZkClient" class="headerlink" title="ä¸€. ZkClient"></a>ä¸€. ZkClient</h2><p>ZkClientæ˜¯GitHubä¸Šçš„ä¸€ä¸ªå¼€æºçš„ZooKeeperå®¢æˆ·ç«¯ï¼Œå®ƒåœ¨ZKåŸç”ŸAPIæ¥å£ä¸Šè¿›è¡Œäº†åŒ…è£…ï¼ŒåŒæ—¶å†…éƒ¨å®ç°äº†è¯¸å¦‚Sessionè¶…æ—¶é‡è¿ã€Watcheråå¤æ³¨å†Œç­‰åŠŸèƒ½ã€‚</p><h3 id="1-1-å¼•å…¥ä¾èµ–"><a href="#1-1-å¼•å…¥ä¾èµ–" class="headerlink" title="1.1 å¼•å…¥ä¾èµ–"></a>1.1 å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;zookeeper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.sgroschupf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;zkclient.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-åˆ›å»ºä¼šè¯"><a href="#1-2-åˆ›å»ºä¼šè¯" class="headerlink" title="1.2 åˆ›å»ºä¼šè¯"></a>1.2 åˆ›å»ºä¼šè¯</h3><p>æ„é€ å‡½æ•°APIï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ZkClient</span><span class="params">(String serverstring)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ZkClient</span><span class="params">(String zkServers, <span class="keyword">int</span> connectionTimeout)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ZkClient</span><span class="params">(String zkServers, <span class="keyword">int</span> sessionTimeout, <span class="keyword">int</span> connectionTimeout)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ZkClient</span><span class="params">(String zkServers, <span class="keyword">int</span> sessionTimeout, <span class="keyword">int</span> connectionTimeout, ZkSerializer zkSerializer)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ZkClient</span><span class="params">(IZkConnection connection)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ZkClient</span><span class="params">(IZkConnection connection, <span class="keyword">int</span> connectionTimeout)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ZkClient</span><span class="params">(IZkConnection connection, <span class="keyword">int</span> connectionTimeout, ZkSerializer zkSerializer)</span></span>;</span><br></pre></td></tr></table></figure><p>å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>zkServers</td><td>æŒ‡ZooKeeperæœåŠ¡å™¨åˆ—è¡¨ï¼Œç”±è‹±æ–‡çŠ¶æ€é€—å·åˆ†å¼€çš„host:portå­—ç¬¦ä¸²ç»„æˆï¼Œæ¯ä¸€ä¸ªéƒ½ä»£è¡¨ä¸€å°ZooKeeperæœºå™¨ï¼Œä¾‹å¦‚ï¼Œ192.168.1.1:2181,192.168.1.2:2181,192.168.1.3:2181</td></tr><tr><td>sessionTimeout</td><td>ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œé»˜è®¤æ˜¯30000ms</td></tr><tr><td>connectionTimeout</td><td>è¿æ¥åˆ›å»ºè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚æ­¤å‚æ•°è¡¨æ˜å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…è¿˜æ˜¯æ— æ³•å’ŒZooKeeperå»ºç«‹è¿æ¥ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>connection</td><td>IZkConnectionæ¥å£çš„å®ç°ç±»</td></tr><tr><td>zkSerializer</td><td>è‡ªå®šä¹‰åºåˆ—åŒ–å™¨</td></tr></tbody></table><ul><li>ZooKeeperä¼šè¯çš„å»ºç«‹æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹ï¼Œå¼€å‘äººå‘˜éœ€è¦è‡ªå·±æ¥è¿›è¡Œç­‰å¾…å¤„ç†ï¼ŒZkClienté€šè¿‡å†…éƒ¨åŒ…è£…ï¼Œå°†è¿™ä¸ªå¼‚æ­¥çš„ä¼šè¯åˆ›å»ºè¿‡ç¨‹åŒæ­¥åŒ–äº†ï¼Œæ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨ã€‚</li><li>IZkConnectionæ¥å£æ˜¯å¯¹ZooKeeperåŸç”Ÿæ¥å£æœ€ç›´æ¥çš„åŒ…è£…å’Œäº¤äº’å±‚ï¼ŒåŒ…å«äº†å¢åˆ æ”¹æŸ¥ä¸€ç³»åˆ—æ¥å£çš„å®šä¹‰ï¼Œæœ‰ä¸¤ç§é»˜è®¤å®ç° <code>ZkConnection</code> å’Œ <code>InMemoryConnection</code> ã€‚</li><li>ZkClientä¸­å®šä¹‰äº†ZkSerializeræ¥å£å…è®¸ç”¨æˆ·ä¼ å…¥ä¸€ä¸ªåºåˆ—åŒ–å®ç°ï¼Œå¦‚Hessianæˆ–Kryoï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨Javaè‡ªå¸¦çš„åºåˆ—åŒ–æ–¹å¼ã€‚</li><li>ZkClientä¸å†éœ€è¦æä¾›Watcherå‚æ•°ï¼Œå…¶å¼•å…¥äº†Listeneræ¥å®ç°Watcherçš„æ³¨å†Œã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºZKå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Create_Session_Sample</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        ZkClient zkClient = <span class="keyword">new</span> ZkClient(<span class="string">"domain1.book.zookeeper:2181"</span>, <span class="number">5000</span>);</span><br><span class="line">        System.out.println(<span class="string">"ZooKeeper session established."</span>)</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-åˆ›å»ºèŠ‚ç‚¹"><a href="#1-3-åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="1.3 åˆ›å»ºèŠ‚ç‚¹"></a>1.3 åˆ›å»ºèŠ‚ç‚¹</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200140.png" alt></p><p><code>createEphemeral</code> æ¥å£æ˜¯åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼Œ<code>createPersistentSequential</code> åˆ™æ˜¯åˆ›å»ºæŒä¹…é¡ºåºèŠ‚ç‚¹ã€‚</p><p>ZKåŸç”ŸAPIæ— æ³•é€’å½’åˆ›å»ºèŠ‚ç‚¹ï¼Œåªèƒ½åœ¨çˆ¶èŠ‚ç‚¹å­˜åœ¨æ—¶åˆ›å»ºå­èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½è¦æ£€æŸ¥çˆ¶èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚ZkClienté€šè¿‡ <code>createParents</code> å‚æ•°åœ¨å†…éƒ¨å¸®åŠ©æˆ‘ä»¬é€’å½’å»ºç«‹çˆ¶èŠ‚ç‚¹ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200141.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200142.png" alt></p><h3 id="1-4-åˆ é™¤èŠ‚ç‚¹"><a href="#1-4-åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="1.4 åˆ é™¤èŠ‚ç‚¹"></a>1.4 åˆ é™¤èŠ‚ç‚¹</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200143.png" alt></p><p><code>deleteRecursive</code> è‡ªåŠ¨å®Œæˆé€å±‚éå†åˆ é™¤èŠ‚ç‚¹çš„æ“ä½œã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200144.png" alt></p><h3 id="1-5-è¯»å–æ•°æ®"><a href="#1-5-è¯»å–æ•°æ®" class="headerlink" title="1.5 è¯»å–æ•°æ®"></a>1.5 è¯»å–æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;String&gt; <span class="title">getChildren</span><span class="params">(String path)</span></span>;</span><br><span class="line"><span class="comment">// æ³¨å†Œäº‹ä»¶ç›‘å¬</span></span><br><span class="line"><span class="function">List&lt;String&gt; <span class="title">subscribeChildChanges</span><span class="params">(String path, IZkChildListener listener)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IZkChildListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleChildChange</span><span class="params">(String parentPath, List&lt;String&gt; currentChilds)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IZkChildListener å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>parentPath</td><td>å­èŠ‚ç‚¹å˜æ›´é€šçŸ¥å¯¹åº”çš„çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹è·¯å¾„</td></tr><tr><td>currentChilds</td><td>å­èŠ‚ç‚¹çš„ç›¸å¯¹è·¯å¾„åˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œä¼šä¼ å…¥null</td></tr></tbody></table><p>èŠ‚ç‚¹æ³¨å†Œç›‘å¬åä¼šæ”¶åˆ°å¦‚ä¸‹äº‹ä»¶é€šçŸ¥ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200145.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200146.png" alt></p><ul><li>å®¢æˆ·ç«¯å¯ä»¥å¯¹ä¸€ä¸ªä¸å­˜åœ¨çš„èŠ‚ç‚¹è¿›è¡Œå­èŠ‚ç‚¹å˜æ›´çš„ç›‘å¬ã€‚</li><li>ä¸€æ—¦å®¢æˆ·ç«¯å¯¹ä¸€ä¸ªèŠ‚ç‚¹æ³¨å†Œå­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´ç›‘å¬ä¹‹åï¼Œå½“è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨å‘é€å˜æ›´æ—¶ï¼ŒæœåŠ¡ç«¯éƒ½ä¼šé€šçŸ¥å¹¶å°†æœ€æ–°çš„å­èŠ‚ç‚¹åˆ—è¡¨å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>è¯¥èŠ‚ç‚¹æœ¬èº«çš„åˆ›å»ºæˆ–åˆ é™¤ä¹Ÿä¼šé€šçŸ¥åˆ°å®¢æˆ·ç«¯ã€‚</li><li>ZkClientçš„Listenerä¸åŒäºWatcherï¼Œä¸€æ—¦æ³¨å†Œå°±ä¼šä¸€ç›´ç”Ÿæ•ˆã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;T extends Object&gt; <span class="function">T <span class="title">readData</span><span class="params">(String path)</span></span>;</span><br><span class="line">&lt;T extends Object&gt; <span class="function">T <span class="title">readData</span><span class="params">(String path, <span class="keyword">boolean</span> returnNullIfPathNotExists)</span></span>;</span><br><span class="line">&lt;T extends Object&gt; <span class="function">T <span class="title">readData</span><span class="params">(String path, Stat stat)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200147.png" alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ ·é€šè¿‡æ³¨å†ŒListeneræ¥å®ç°ç›‘å¬</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IZkDataListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleChildChange</span><span class="params">(String dataPath, Object data)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleChildDeleted</span><span class="params">(String dataPath)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>dataPath</td><td>äº‹ä»¶é€šçŸ¥å¯¹åº”çš„èŠ‚ç‚¹è·¯å¾„</td></tr><tr><td>data</td><td>æœ€æ–°çš„æ•°æ®å†…å®¹</td></tr></tbody></table><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200148.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200149.png" alt></p><h3 id="1-6-æ›´æ–°æ•°æ®"><a href="#1-6-æ›´æ–°æ•°æ®" class="headerlink" title="1.6 æ›´æ–°æ•°æ®"></a>1.6 æ›´æ–°æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeData</span><span class="params">(String path, Object data)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeData</span><span class="params">(<span class="keyword">final</span> String path, Object data, <span class="keyword">final</span> <span class="keyword">int</span> expectedVersion)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200150.png" alt></p><p>æ£€æµ‹æŒ‡å®šèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">exists</span><span class="params">(<span class="keyword">final</span> String path)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="äºŒ-Curator"><a href="#äºŒ-Curator" class="headerlink" title="äºŒ. Curator"></a>äºŒ. Curator</h2><p>Curatoræ˜¯ç”±Netflixå¼€å‘çš„ä¸€å¥—ZooKeeperå®¢æˆ·ç«¯æ¡†æ¶ï¼Œå’ŒZkClientä¸€æ ·è§£å†³äº†éå¸¸åº•å±‚çš„ç»†èŠ‚å¼€å‘å·¥ä½œï¼ŒåŒ…æ‹¬è¿æ¥é‡è¿ã€åå¤æ³¨å†ŒWatcherå’ŒNodeExistsExceptionå¼‚å¸¸ç­‰ã€‚Curatoråœ¨ZKåŸç”ŸAPIçš„åŸºç¡€ä¸Šè¿›è¡Œäº†åŒ…è£…ï¼Œæä¾›äº†ä¸€å¥—æ˜“ç”¨æ€§å’Œå¯è¯»æ€§æ›´å¼ºçš„Fluenté£æ ¼çš„APIæ¡†æ¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCuratorè¿˜æä¾›äº†ZooKeeperå„ç§åº”ç”¨åœºæ™¯ï¼ˆRecipeï¼Œå¦‚å…±äº«é”æœåŠ¡ã€Masteré€‰ä¸¾æœºåˆ¶å’Œåˆ†å¸ƒå¼è®¡æ•°å™¨ï¼‰çš„æŠ½è±¡å°è£…ã€‚</p><h3 id="2-1-å¼•å…¥ä¾èµ–"><a href="#2-1-å¼•å…¥ä¾èµ–" class="headerlink" title="2.1 å¼•å…¥ä¾èµ–"></a>2.1 å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-åˆ›å»ºä¼šè¯"><a href="#2-2-åˆ›å»ºä¼šè¯" class="headerlink" title="2.2 åˆ›å»ºä¼šè¯"></a>2.2 åˆ›å»ºä¼šè¯</h3><ol><li><p>ä½¿ç”¨ <code>CuratorFrameworkFactory</code> å·¥å‚ç±»çš„ä¸¤ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> CuratorFramework <span class="title">newClient</span><span class="params">(String connectString, RetryPolicy retryPolicy)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> CuratorFramework <span class="title">newClient</span><span class="params">(String connectString, <span class="keyword">int</span> sessionTimeoutMs, <span class="keyword">int</span> connectionTimeoutMs, RetryPolicy retryPolicy)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡è°ƒç”¨ <code>CuratorFramework</code> ä¸­çš„ <code>start()</code> æ–¹æ³•æ¥å¯åŠ¨ä¼šè¯ã€‚</p></li></ol><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200151.png" alt></p><p>Curatoré€šè¿‡æ¥å£ <code>RetryPolicy</code> æ¥è®©ç”¨æˆ·è‡ªå®šä¹‰é‡è¯•ç­–ç•¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">allowRetry</span><span class="params">(<span class="keyword">int</span> retryCount, <span class="keyword">long</span> elapsedTimeMs, RetrySleeper sleeper)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200152.png" alt></p><p>ä½¿ç”¨Curatoråˆ›å»ºä¸€ä¸ªZKå®¢æˆ·ç«¯ä¼šè¯ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200153.png" alt></p><p><code>ExponentialBackoffRetry</code> æ˜¯é»˜è®¤é‡è¯•ç­–ç•¥ä¹‹ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ExponentialBackoffRetry(<span class="keyword">int</span> baseSleepTimeMs, <span class="keyword">int</span> maxRetries);</span><br><span class="line">ExponentialBackoffRetry(<span class="keyword">int</span> baseSleepTimeMs, <span class="keyword">int</span> maxRetries, <span class="keyword">int</span> maxSleepMs);</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200154.png" alt></p><p>ç»™å®šä¸€ä¸ªåˆå§‹sleepæ—¶é—´baseSleepTimeMsï¼Œåœ¨æ­¤åŸºç¡€ä¸Šç»“åˆé‡è¯•æ¬¡æ•°ï¼Œé€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—å‡ºå½“å‰éœ€è¦sleepçš„æ—¶é—´ï¼š</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å½“å‰sleepæ—¶é—´ = baseSleepTimeMs * Math.max(<span class="number">1</span>, random.nextInt(<span class="number">1</span> &lt;&lt; (retryCount + <span class="number">1</span>)))</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Fluenté£æ ¼çš„APIæ¥å£åˆ›å»ºä¼šè¯ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200155.png" alt></p><p>ä½¿ç”¨Curatoråˆ›å»ºå«éš”ç¦»å‘½åç©ºé—´çš„ä¼šè¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ç°ä¸åŒZKä¸šåŠ¡ä¹‹é—´çš„éš”ç¦»ï¼Œéœ€è¦ç»™æ¯ä¸ªä¸šåŠ¡åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œå³æŒ‡å®šä¸€ä¸ªZKæ ¹è·¯å¾„ï¼š</span></span><br><span class="line">    CuratorFrameworkFactory.builder()</span><br><span class="line">                           .connectString(<span class="string">"domain.book.zookeeper:2181"</span>)</span><br><span class="line">                           .sessionTimeoutMs(<span class="number">5000</span>)</span><br><span class="line">                           .retryPolicy(retryPolicy)</span><br><span class="line">                           .namespace(<span class="string">"base"</span>)</span><br><span class="line">                           .build();</span><br></pre></td></tr></table></figure><h3 id="2-3-åˆ›å»ºèŠ‚ç‚¹"><a href="#2-3-åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="2.3 åˆ›å»ºèŠ‚ç‚¹"></a>2.3 åˆ›å»ºèŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CuratorFramework</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CreateBuilder <span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateBuilder</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ProtectACLCreateModePathAndBytesable&lt;String&gt; <span class="title">creatingParentsIfNeeded</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateModable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">withMode</span><span class="params">(CreateMode mode)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PathAndBytesable&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">forPath</span><span class="params">(String path, <span class="keyword">byte</span>[] data)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">forPath</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure><ul><li><p>åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆå§‹å†…å®¹ä¸ºç©º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.create().forPath(path);</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œé™„å¸¦åˆå§‹å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.create().forPath(path, <span class="string">"init"</span>.getBytes());</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆå§‹å†…å®¹ä¸ºç©º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.create().withMode(CreateMode.EPHEMERAL).forPath(path);</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œå¹¶è‡ªåŠ¨é€’å½’åˆ›å»ºçˆ¶èŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.create().creatingParentsIfNeeded().withMode(CreateMode.EPHEMERAL).forPath(path);</span><br></pre></td></tr></table></figure></li></ul><p>ç¤ºä¾‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200156.png" alt></p><h3 id="2-4-åˆ é™¤èŠ‚ç‚¹"><a href="#2-4-åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="2.4 åˆ é™¤èŠ‚ç‚¹"></a>2.4 åˆ é™¤èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CuratorFramework</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DeleteBuilder <span class="title">delete</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// Versionable&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">withVersion</span><span class="params">(<span class="keyword">int</span> version)</span></span>;</span><br><span class="line"><span class="comment">// DeleteBuilder</span></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯æ‰§è¡Œä¸€ä¸ªåˆ é™¤èŠ‚ç‚¹çš„æ“ä½œï¼Œå¯èƒ½ç”±äºç½‘ç»œåŸå› å¯¼è‡´åˆ é™¤å¤±è´¥ï¼Œåœ¨æŸäº›åœºæ™¯ä¸­è¿™ç§å¼‚å¸¸æ˜¯è‡´å‘½çš„ï¼Œæ¯”å¦‚Masteré€‰ä¸¾ã€‚å½“è°ƒç”¨guaranteed()ï¼Œä¼šè®°å½•ä¸‹è¿™æ¬¡å¤±è´¥çš„åˆ é™¤æ“ä½œï¼Œåªè¦å®¢æˆ·ç«¯ä¼šè¯æœ‰æ•ˆï¼Œå°±ä¼šåœ¨åå°åå¤é‡è¯•ç›´åˆ°èŠ‚ç‚¹åˆ é™¤æˆåŠŸ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DeleteBuilderBase <span class="title">guaranteed</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// PathAndBytesable&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">forPath</span><span class="params">(String path, <span class="keyword">byte</span>[] data)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">forPath</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure><ul><li><p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ¥å£åªèƒ½åˆ é™¤å¶å­èŠ‚ç‚¹</span></span><br><span class="line">client.delete().forPath(path);</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶é€’å½’åˆ é™¤å…¶æ‰€æœ‰å­èŠ‚ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.delete().deletingChildrenIfNeeded().forPath(path);</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬è¿›è¡Œåˆ é™¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.delete().withVersion(version).forPath(path);</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¼ºåˆ¶ä¿è¯åˆ é™¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.delete().guaranteed().forPath(path);</span><br></pre></td></tr></table></figure></li></ul><p>ç¤ºä¾‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200157.png" alt></p><h3 id="2-5-è¯»å–æ•°æ®"><a href="#2-5-è¯»å–æ•°æ®" class="headerlink" title="2.5 è¯»å–æ•°æ®"></a>2.5 è¯»å–æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CuratorFramework</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> GetDataBuilder <span class="title">getData</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// Statable&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">storingStatIn</span><span class="params">(Stat stat)</span></span>;</span><br><span class="line"><span class="comment">// Pathable&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">forPath</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure><ul><li><p>è¯»å–ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›å€¼ä¸ºbyte[]</span></span><br><span class="line">client.getData().forPath(path);</span><br></pre></td></tr></table></figure></li><li><p>è¯»å–ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼ŒåŒæ—¶è·å–åˆ°è¯¥èŠ‚ç‚¹çš„statï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Curatoré€šè¿‡ä¼ å…¥ä¸€ä¸ªæ—§çš„statå˜é‡çš„æ–¹å¼æ¥å­˜å‚¨æœåŠ¡ç«¯è¿”å›çš„æœ€æ–°çš„èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">client.getData().storingStatIn(stat).forPath(path);</span><br></pre></td></tr></table></figure></li></ul><p>ç¤ºä¾‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200158.png" alt></p><h3 id="2-6-æ›´æ–°æ•°æ®"><a href="#2-6-æ›´æ–°æ•°æ®" class="headerlink" title="2.6 æ›´æ–°æ•°æ®"></a>2.6 æ›´æ–°æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CuratorFramework</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SetDataBuilder <span class="title">setData</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// Versionable&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">withVersion</span><span class="params">(<span class="keyword">int</span> version)</span></span>;</span><br><span class="line"><span class="comment">// PathAndBytesable&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">forPath</span><span class="params">(String path, <span class="keyword">byte</span>[] data)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">forPath</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure><ul><li><p>æ›´æ–°ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªstatå¯¹è±¡</span></span><br><span class="line">client.setData().forPath(path);</span><br></pre></td></tr></table></figure></li><li><p>æ›´æ–°ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼Œå¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬è¿›è¡Œæ›´æ–°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// withVersionç”¨æ¥å®ç°CASï¼Œversioné€šå¸¸ç”±ä¸€ä¸ªæ—§çš„statå¯¹è±¡è·å–åˆ°</span></span><br><span class="line">client.setData().withVersion(version).forPath(path);</span><br></pre></td></tr></table></figure></li></ul><p>ç¤ºä¾‹ï¼šç¬¬ä¸€æ¬¡ä½¿ç”¨æœ€æ–°çš„statå˜é‡è¿›è¡Œæ›´æ–°æ“ä½œï¼Œç¬¬äºŒæ¬¡åˆ™ä½¿ç”¨äº†è¿‡æœŸçš„statå˜é‡ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200159.png" alt></p><h3 id="2-7-å¼‚æ­¥æ¥å£"><a href="#2-7-å¼‚æ­¥æ¥å£" class="headerlink" title="2.7 å¼‚æ­¥æ¥å£"></a>2.7 å¼‚æ­¥æ¥å£</h3><p>ä»¥ä¸ŠAPIçš†ä¸ºCuratorçš„åŒæ­¥æ¥å£ï¼ŒCuratorå¼•å…¥äº† <code>BackgroundCallback</code> æ¥å£ï¼Œç”¨æ¥å¤„ç†å¼‚æ­¥æ¥å£è°ƒç”¨ä¹‹åæœåŠ¡ç«¯è¿”å›çš„ç»“æœä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BackgroundCallback</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processResult</span><span class="params">(CuratorFramework client, CuratorEvent event)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>client</td><td>å½“å‰å®¢æˆ·ç«¯å®ä¾‹</td></tr><tr><td>event</td><td>æœåŠ¡ç«¯äº‹ä»¶ï¼ŒCuratorEventå®šä¹‰äº†ZKæœåŠ¡ç«¯å‘é€åˆ°å®¢æˆ·ç«¯çš„ä¸€ç³»åˆ—äº‹ä»¶å‚æ•°</td></tr></tbody></table><p>CuratorEventä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li><strong>äº‹ä»¶ç±»å‹ï¼ˆCuratorEventTypeï¼‰ï¼š</strong><code>getType()</code> ä»£è¡¨æœ¬æ¬¡äº‹ä»¶çš„ç±»å‹<ul><li>CREATEï¼š<code>CuratorFramework#create()</code></li><li>DELETEï¼š<code>CuratorFramework#delete()</code></li><li>EXISXTSï¼š<code>CuratorFramework#checkExists()</code></li><li>GET_DATAï¼š<code>CuratorFramework#getData()</code></li><li>SET_DATAï¼š<code>CuratorFramework#setData()</code></li><li>CHILDRENï¼š<code>CuratorFramework#getChildren()</code></li><li>SYNCï¼š<code>CuratorFramework#sync()</code></li><li>GET_ACLï¼š<code>CuratorFramework#getACL()</code></li><li>WATCHEDï¼š<code>Watchable#usingWatcher(Watcher) / Watchable#watched()</code></li><li>CLOSINGï¼šZKå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥æ–­å¼€äº‹ä»¶</li></ul></li><li><strong>å“åº”ç ï¼ˆintï¼‰ï¼š</strong>å®šä¹‰åœ¨<code>org.apache.zookeeper.KeeperException.Code</code> ä¸­ï¼Œå¸¸è§çš„æœ‰ï¼š<ul><li>0ï¼ˆOKï¼‰æ¥å£è°ƒç”¨æˆåŠŸ</li><li>-4ï¼ˆConnectionLossï¼‰å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥æ–­å¼€</li><li>-110ï¼ˆNodeExistsï¼‰æŒ‡å®šèŠ‚ç‚¹å·²å­˜åœ¨</li><li>-112ï¼ˆSessionExpiredï¼‰ä¼šè¯å·²è¿‡æœŸ</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Backgroudable&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">inBackground</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">inBackground</span><span class="params">(Object context)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">inBackground</span><span class="params">(BackgroundCallback callback)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">inBackground</span><span class="params">(BackgroundCallback callback, Object context)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">inBackground</span><span class="params">(BackgroundCallback callback, Executor executor)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">inBackground</span><span class="params">(BackgroundCallback callback, Object context, Executor executor)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ZooKeeperä¸­ï¼Œæ‰€æœ‰å¼‚æ­¥é€šçŸ¥äº‹ä»¶å¤„ç†éƒ½ç”±EventThreadçº¿ç¨‹æ¥å¤„ç†ï¼Œå…¶ä¸²è¡Œå¤„ç†æœºåˆ¶åœ¨ç»å¤§éƒ¨åˆ†åº”ç”¨åœºæ™¯ä¸‹èƒ½å¤Ÿä¿è¯å¯¹äº‹ä»¶å¤„ç†çš„é¡ºåºæ€§ï¼Œä½†ä¹Ÿæœ‰å¼Šç«¯å°±æ˜¯ä¸€æ—¦ç¢°åˆ°ä¸€ä¸ªå¤æ‚çš„å¤„ç†å•å…ƒï¼Œå°±ä¼šæ¶ˆè€—è¿‡é•¿çš„å¤„ç†æ—¶é—´ï¼Œä»è€Œå½±å“åˆ°å¯¹å…¶ä»–äº‹ä»¶çš„å¤„ç†ã€‚å› æ­¤æ¥å£ä¼šè®©ç”¨æˆ·ä¼ å…¥ä¸€ä¸ªExecutorå®ä¾‹ï¼ŒæŠŠå¤æ‚çš„äº‹ä»¶å¤„ç†æ”¾åˆ°ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ± ä¸­ï¼Œå¦‚ <code>Executors.newFixedThreadPool(2)</code> ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200160.png" alt></p><h3 id="2-8-å…¸å‹ä½¿ç”¨åœºæ™¯"><a href="#2-8-å…¸å‹ä½¿ç”¨åœºæ™¯" class="headerlink" title="2.8 å…¸å‹ä½¿ç”¨åœºæ™¯"></a>2.8 å…¸å‹ä½¿ç”¨åœºæ™¯</h3><p>å‚è€ƒæ¡ˆä¾‹éƒ½åœ¨recipesåŒ…ä¸­ï¼Œéœ€è¦å•ç‹¬å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ1ï¼‰äº‹ä»¶ç›‘å¬"><a href="#ï¼ˆ1ï¼‰äº‹ä»¶ç›‘å¬" class="headerlink" title="ï¼ˆ1ï¼‰äº‹ä»¶ç›‘å¬"></a>ï¼ˆ1ï¼‰äº‹ä»¶ç›‘å¬</h4><p>Curatorå¼•å…¥äº†Cacheæ¥å®ç°å¯¹ZKæœåŠ¡ç«¯äº‹ä»¶çš„ç›‘å¬ï¼ŒCacheå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæœ¬åœ°ç¼“å­˜è§†å›¾å’Œè¿œç¨‹ZooKeeperè§†å›¾çš„å¯¹æ¯”è¿‡ç¨‹ï¼ŒåŒæ—¶è‡ªåŠ¨å¤„ç†åå¤ç›‘å¬ã€‚<strong>Cacheåˆ†ä¸ºä¸¤ç§ï¼šèŠ‚ç‚¹ç›‘å¬ï¼ˆNodeCacheï¼‰å’Œå­èŠ‚ç‚¹ç›‘å¬ï¼ˆPathChildrenCacheï¼‰ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeCacheç”¨äºç›‘å¬æŒ‡å®šZKæ•°æ®èŠ‚ç‚¹æœ¬èº«çš„å˜åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NodeCache</span><span class="params">(CuratorFramework client, String path)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NodeCache</span><span class="params">(CuratorFramework client, String path, <span class="keyword">boolean</span> dataIsCompressed)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NodeCacheå®šä¹‰äº†äº‹ä»¶å¤„ç†çš„å›è°ƒæ¥å£NodeCacheListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NodeCacheListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">voidnodeChanged</span><span class="params">()</span> throw Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>client</td><td>Curatorå®¢æˆ·ç«¯å®ä¾‹</td></tr><tr><td>path</td><td>æ•°æ®èŠ‚ç‚¹çš„èŠ‚ç‚¹è·¯å¾„</td></tr><tr><td>dataIsCompressed</td><td>æ˜¯å¦è¿›è¡Œæ•°æ®å‹ç¼©</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š </p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200161.png" alt></p><p><code>start()</code> æœ‰ä¸ªå¸ƒå°”ç±»å‹å‚æ•°ï¼Œé»˜è®¤ä¸ºfalseï¼Œå½“è®¾ç½®ä¸ºtrueæ—¶NodeCacheé¦–æ¬¡å¯åŠ¨ä¼šç«‹å³ä»ZKä¸Šè¯»å–å¯¹åº”èŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼Œå¹¶ä¿å­˜åœ¨Cacheä¸­ã€‚NodeCacheä¸ä»…å¯ä»¥ç”¨äºç›‘å¬æ•°æ®èŠ‚ç‚¹çš„å†…å®¹å˜æ›´ï¼Œä¹Ÿèƒ½ç›‘å¬èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚è‹¥åŸæœ¬èŠ‚ç‚¹ä¸å­˜åœ¨ï¼ŒCacheä¼šåœ¨èŠ‚ç‚¹åˆ›å»ºåè§¦å‘NodeCacheListenerã€‚</p><p><code>PathChildrenCache</code> ç”¨äºç›‘å¬æŒ‡å®šZKæ•°æ®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PathChildrenCache</span><span class="params">(CuratorFramework client, String path, <span class="keyword">boolean</span> cacheData)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PathChildrenCache</span><span class="params">(CuratorFramework client, String path, <span class="keyword">boolean</span> cacheData, ThreadFactory threadFactory)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PathChildrenCache</span><span class="params">(CuratorFramework client, String path, <span class="keyword">boolean</span> dataIsCompressed, ThreadFactory threadFactory)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PathChildrenCache</span><span class="params">(CuratorFramework client, String path, <span class="keyword">boolean</span> dataIsCompressed, <span class="keyword">final</span> ExecutorService executorService)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PathChildrenCache</span><span class="params">(CuratorFramework client, String path, <span class="keyword">boolean</span> dataIsCompressed, <span class="keyword">final</span> CloseableExecutorService executorService)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹ä»¶å¤„ç†çš„å›è°ƒæ¥å£ï¼Œå­èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶å›è°ƒæ–¹æ³•ï¼Œäº‹ä»¶ç±»å‹åŒ…æ‹¬ï¼šæ–°å¢å­èŠ‚ç‚¹ã€æ•°æ®å˜æ›´ã€å­èŠ‚ç‚¹åˆ é™¤ä¸‰ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PathChildrenCacheListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">childEvent</span><span class="params">(CuratorFramework client, PathChildrenCacheEvent event)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200162.png" alt></p><p>ç¤ºä¾‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200163.png" alt></p><h4 id="ï¼ˆ2ï¼‰Masteré€‰ä¸¾"><a href="#ï¼ˆ2ï¼‰Masteré€‰ä¸¾" class="headerlink" title="ï¼ˆ2ï¼‰Masteré€‰ä¸¾"></a>ï¼ˆ2ï¼‰Masteré€‰ä¸¾</h4><p>åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è§åœºæ™¯ï¼šä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œä»…éœ€ä»é›†ç¾¤ä¸­é€‰ä¸¾å‡ºä¸€å°ä»…éœ€å¤„ç†å³å¯ã€‚</p><p>å¤§è‡´æ€è·¯ï¼šé€‰æ‹©ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå¦‚ <code>/master_select</code> ï¼Œå¤šå°æœºå™¨åŒæ—¶å‘è¯¥èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªå­èŠ‚ç‚¹ <code>/master_select/lock</code> æœ€ç»ˆåªæœ‰ä¸€å°æœºå™¨èƒ½åˆ›å»ºæˆåŠŸï¼Œå°±ç›¸å½“äºè¢«é€‰ä¸ºMasterã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200164.png" alt></p><p>ç›‘å¬å™¨ LeaderSelectorListenerAdapter éœ€è¦è‡ªè¡Œå®ç°ï¼ŒCuratorä¼šåœ¨æˆåŠŸè·å–Masteræƒåˆ©åå›è°ƒæ­¤ç›‘å¬å™¨ï¼šæ‰§è¡Œå®Œæ–¹æ³•ä¼šç«‹å³é‡Šæ”¾æƒåˆ©ï¼Œé‡æ–°å¼€å§‹ä¸‹ä¸€è½®é€‰ä¸¾</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200165.png" alt></p><h4 id="ï¼ˆ3ï¼‰åˆ†å¸ƒå¼é”"><a href="#ï¼ˆ3ï¼‰åˆ†å¸ƒå¼é”" class="headerlink" title="ï¼ˆ3ï¼‰åˆ†å¸ƒå¼é”"></a>ï¼ˆ3ï¼‰åˆ†å¸ƒå¼é”</h4><p>ä¸ºäº†ä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒçš„æ•°æ®ä¸€è‡´ï¼Œéœ€è¦åœ¨ç¨‹åºæŸä¸ªè¿è¡ŒèŠ‚ç‚¹è¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼Œæ¯”å¦‚ç”¨æ—¶é—´æˆ³æ¥ç”Ÿæˆæµæ°´å·ï¼Œä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºè¿™ç§å…¸å‹çš„å¹¶å‘é—®é¢˜ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200166.png" alt></p><p>å› ä¸ºæ²¡æœ‰åŒæ­¥å¯¼è‡´äº†ä¸Šè¿°çš„æ•°æ®é‡å¤é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨Curatoræ¥å®ç°åˆ†å¸ƒå¼é”ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200167.png" alt></p><h4 id="ï¼ˆ4ï¼‰åˆ†å¸ƒå¼è®¡æ•°å™¨"><a href="#ï¼ˆ4ï¼‰åˆ†å¸ƒå¼è®¡æ•°å™¨" class="headerlink" title="ï¼ˆ4ï¼‰åˆ†å¸ƒå¼è®¡æ•°å™¨"></a>ï¼ˆ4ï¼‰åˆ†å¸ƒå¼è®¡æ•°å™¨</h4><p>ç»Ÿè®¡ç³»ç»Ÿçš„åœ¨çº¿äººæ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªZKæ•°æ®èŠ‚ç‚¹ä½œä¸ºè®¡æ•°å™¨ï¼Œå¤šä¸ªåº”ç”¨å®ä¾‹åœ¨åˆ†å¸ƒå¼é”çš„æ§åˆ¶ä¸‹ï¼Œé€šè¿‡æ›´æ–°è¯¥æ•°æ®èŠ‚ç‚¹æ¥å®ç°è®¡æ•°ï¼ˆå¯ä»¥ç›´æ¥ä½¿ç”¨å°è£…çš„ DistributedAtomicIntegerï¼‰ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200168.png" alt></p><h4 id="ï¼ˆ5ï¼‰åˆ†å¸ƒå¼Barrier"><a href="#ï¼ˆ5ï¼‰åˆ†å¸ƒå¼Barrier" class="headerlink" title="ï¼ˆ5ï¼‰åˆ†å¸ƒå¼Barrier"></a>ï¼ˆ5ï¼‰åˆ†å¸ƒå¼Barrier</h4><p>Barrieræ˜¯ä¸€ç§ç”¨æ¥æ§åˆ¶å¤šçº¿ç¨‹ä¹‹é—´åŒæ­¥çš„ç»å…¸æ–¹æ³•ï¼ŒJDKè‡ªå¸¦CyclicBarrierå®ç°ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200169.png" alt></p><p>å¤šçº¿ç¨‹åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œéƒ½ä¼šå‡†ç¡®çš„ç­‰å¾…æ‰€æœ‰å…ˆéƒ½å¤„äºå°±ç»ªçŠ¶æ€åæ‰å¼€å§‹åŒæ—¶æ‰§è¡Œå…¶ä»–ä¸šåŠ¡é€»è¾‘ï¼Œä½†åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰å¤šä¸ªJVMï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨Curatoræä¾›çš„DistributedBarrierï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200170.png" alt></p><p>ä¸Šè¿°ä¸ºä¸»çº¿ç¨‹è§¦å‘Barrieré‡Šæ”¾ä¸åŒï¼ŒCuratorè¿˜æä¾›äº†å¦ä¸€ç§çº¿ç¨‹è‡ªå‘çš„è§¦å‘Barrieré‡Šæ”¾ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200171.png" alt></p><h4 id="ï¼ˆ6ï¼‰Curatoræä¾›çš„å·¥å…·"><a href="#ï¼ˆ6ï¼‰Curatoræä¾›çš„å·¥å…·" class="headerlink" title="ï¼ˆ6ï¼‰Curatoræä¾›çš„å·¥å…·"></a>ï¼ˆ6ï¼‰Curatoræä¾›çš„å·¥å…·</h4><p>è¾ƒå¸¸ç”¨çš„æœ‰ ZKPaths å’Œ EnsurePathï¼Œå‰è€…å¯ä»¥æ¥æ„å»ºZNodeè·¯å¾„ã€é€’å½’åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹ç­‰ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200172.png" alt></p><p>åè€…æä¾›äº†ä¸€ç§èƒ½ç¡®ä¿æ•°æ®èŠ‚ç‚¹å­˜åœ¨çš„æœºåˆ¶ï¼Œæœ‰äº›åœºæ™¯æˆ‘ä»¬è¦åšæŸäº›æ“ä½œå¿…é¡»å…ˆè¦ç¡®ä¿èŠ‚ç‚¹å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å°±è¦å…ˆåˆ›å»ºèŠ‚ç‚¹ï¼Œä½†åˆ†å¸ƒå¼ç¯å¢ƒä¸­å¯èƒ½æœ‰å…¶ä»–æœºå™¨ä¹Ÿåœ¨å°è¯•åˆ›å»ºè¯¥èŠ‚ç‚¹ï¼Œå°±å¯¼è‡´æˆ‘ä»¬åˆ›å»ºæ—¶å¾—åˆ°â€œèŠ‚ç‚¹å·²å­˜åœ¨â€çš„å¼‚å¸¸ã€‚</p><p>EnsurePathé‡‡å–äº†é™é»˜çš„èŠ‚ç‚¹åˆ›å»ºæ–¹å¼ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200173.png" alt></p><h4 id="ï¼ˆ7ï¼‰å•å…ƒæµ‹è¯•-TestingServer"><a href="#ï¼ˆ7ï¼‰å•å…ƒæµ‹è¯•-TestingServer" class="headerlink" title="ï¼ˆ7ï¼‰å•å…ƒæµ‹è¯• TestingServer"></a>ï¼ˆ7ï¼‰å•å…ƒæµ‹è¯• TestingServer</h4><p>å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200174.png" alt></p><h4 id="ï¼ˆ8ï¼‰é›†ç¾¤æµ‹è¯•-TestingCluster"><a href="#ï¼ˆ8ï¼‰é›†ç¾¤æµ‹è¯•-TestingCluster" class="headerlink" title="ï¼ˆ8ï¼‰é›†ç¾¤æµ‹è¯• TestingCluster"></a>ï¼ˆ8ï¼‰é›†ç¾¤æµ‹è¯• TestingCluster</h4><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200175.png" alt></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹æ¥è‡ªã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šZkClientçš„APIå’Œä½¿ç”¨ç¤ºä¾‹ï¼ŒCuratorçš„APIå’Œä½¿ç”¨ç¤ºä¾‹ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="zookeeper" scheme="http://linyishui.top/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>ZooKeeperï¼ˆäºŒï¼‰Javaå®¢æˆ·ç«¯API</title>
    <link href="http://linyishui.top/2021051501.html"/>
    <id>http://linyishui.top/2021051501.html</id>
    <published>2021-05-15T04:11:16.000Z</published>
    <updated>2021-05-19T13:55:06.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ZooKeeperï¼ˆäºŒï¼‰Javaå®¢æˆ·ç«¯API"><a href="#ZooKeeperï¼ˆäºŒï¼‰Javaå®¢æˆ·ç«¯API" class="headerlink" title="ZooKeeperï¼ˆäºŒï¼‰Javaå®¢æˆ·ç«¯API"></a>ZooKeeperï¼ˆäºŒï¼‰Javaå®¢æˆ·ç«¯API</h1><h2 id="ä¸€-åˆ›å»ºä¼šè¯"><a href="#ä¸€-åˆ›å»ºä¼šè¯" class="headerlink" title="ä¸€. åˆ›å»ºä¼šè¯"></a>ä¸€. åˆ›å»ºä¼šè¯</h2><p>é€šè¿‡æ„å»ºä¸€ä¸ªZooKeeperå¯¹è±¡æ¥åˆ›å»ºä¼šè¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œæ„é€ å‡½æ•°ä¼šåœ¨å¤„ç†å®Œå®¢æˆ·ç«¯åˆå§‹åŒ–åç«‹å³è¿”å›ï¼Œæ­¤æ—¶ä¼šè¯å¤„äºCONNECTINGçŠ¶æ€ã€‚ä¼šè¯çœŸæ­£åˆ›å»ºå®Œæ¯•åï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªäº‹ä»¶é€šçŸ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ„é€ å‡½æ•°API</span></span><br><span class="line">ZooKeeper(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher);</span><br><span class="line">ZooKeeper(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher, <span class="keyword">boolean</span> canBeReadOnly);</span><br><span class="line">ZooKeeper(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher, <span class="keyword">long</span> sessionId, <span class="keyword">byte</span>[] sessionPasswd);</span><br><span class="line">ZooKeeper(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher, <span class="keyword">long</span> sessionId, <span class="keyword">byte</span>[] sessionPasswd, <span class="keyword">boolean</span> canBeReadOnly);</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200115.png" alt></p><p>å®ä¾‹ä»£ç å¦‚å›¾ï¼šé‡å†™äº†processæ–¹æ³•è´Ÿè´£å¤„ç†æ”¶åˆ°çš„Watcheré€šçŸ¥ï¼Œæ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„SyncConnectedäº‹ä»¶åï¼Œè§£é™¤ä¸»ç¨‹åºåœ¨CountDownLatchä¸Šçš„ç­‰å¾…é˜»å¡ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200116.png" alt></p><p>å¤ç”¨sessionIdï¼Œç»´æŒä¹‹å‰ä¼šè¯ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200117.png" alt></p><h2 id="äºŒ-åˆ›å»ºèŠ‚ç‚¹"><a href="#äºŒ-åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="äºŒ. åˆ›å»ºèŠ‚ç‚¹"></a>äºŒ. åˆ›å»ºèŠ‚ç‚¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="function">String <span class="title">create</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">byte</span> data[], List&lt;ACL&gt; acl, CreateMode createMode)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">create</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">byte</span> data[], List&lt;ACL&gt; acl, CreateMode createMode, StringCallback cb, Object ctx)</span></span>;</span><br></pre></td></tr></table></figure><p>ZooKeeperèŠ‚ç‚¹å†…å®¹åªæ”¯æŒå­—èŠ‚æ•°ç»„ç±»å‹ï¼ˆbyte[]ï¼‰ï¼Œå³ZooKeeperä¸è´Ÿè´£ä¸ºèŠ‚ç‚¹å†…å®¹è¿›è¡Œåºåˆ—åŒ–ï¼Œéœ€è¦å¼€å‘äººå‘˜è‡ªå·±ä½¿ç”¨åºåˆ—åŒ–å·¥å…·æ“ä½œã€‚</p><p>é»˜è®¤ä¸éœ€è¦å…³æ³¨æƒé™å‚æ•°ï¼Œåªéœ€åœ¨aclä¸­ä¼ å…¥ <code>Ids.OPEN_ACL_UNSAFE</code> ï¼Œè¡¨ç¤ºä¸å—æƒé™æ§åˆ¶ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200118.png" alt></p><p>åˆ›å»ºåŒæ­¥èŠ‚ç‚¹ï¼Œåˆ†åˆ«åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹å’Œä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ŒäºŒè€…è¿”å›å€¼ä¸ä¸€æ ·ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200119.png" alt></p><p>åˆ›å»ºå¼‚æ­¥èŠ‚ç‚¹ï¼Œåªéœ€è¦å®ç° <code>AsyncCallback.StringCallback()</code> æ¥å£å³å¯ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200120.png" alt></p><p>AsyncCallbackåŒ…æ‹¬ä¸ƒç§ä¸åŒçš„å›è°ƒæ¥å£ï¼š</p><ul><li>StatCallback</li><li>DataCallback</li><li>ACLCallback</li><li>ChildrenCallback</li><li>Children2Callback</li><li>StringCallback</li><li>VoidCallback</li></ul><p>åŒæ­¥æ¥å£è°ƒç”¨è¿‡ç¨‹éœ€è¦å…³æ³¨æŠ›å‡ºå¼‚å¸¸çš„å¯èƒ½ï¼Œå¼‚æ­¥æ¥å£æœ¬èº«ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç´ æœ‰å¼‚å¸¸éƒ½åœ¨å›è°ƒå‡½æ•°ä¸­é€šè¿‡å“åº”ç ï¼ˆResult Codeï¼‰ä½“ç°ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200121.png" alt></p><h2 id="ä¸‰-åˆ é™¤èŠ‚ç‚¹"><a href="#ä¸‰-åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="ä¸‰. åˆ é™¤èŠ‚ç‚¹"></a>ä¸‰. åˆ é™¤èŠ‚ç‚¹</h2><p>ZooKeeperåªå…è®¸åˆ é™¤å¶å­èŠ‚ç‚¹ï¼Œå³å¦‚æœèŠ‚ç‚¹å­˜åœ¨å­èŠ‚ç‚¹å°±æ— æ³•è¢«ç›´æ¥åˆ é™¤ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">int</span> version)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">int</span> version, VoidCallback cb, Object ctx)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200122.png" alt></p><h2 id="å››-è¯»å–æ•°æ®"><a href="#å››-è¯»å–æ•°æ®" class="headerlink" title="å››. è¯»å–æ•°æ®"></a>å››. è¯»å–æ•°æ®</h2><h3 id="ï¼ˆ1ï¼‰getChildren"><a href="#ï¼ˆ1ï¼‰getChildren" class="headerlink" title="ï¼ˆ1ï¼‰getChildren"></a>ï¼ˆ1ï¼‰getChildren</h3><p>è·å–ä¸€ä¸ªèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;String&gt; <span class="title">getChildren</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;String&gt; <span class="title">getChildren</span><span class="params">(String path, <span class="keyword">boolean</span> watcher)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getChildren</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, ChildrenCallback cb, Object ctx)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getChildren</span><span class="params">(String path, <span class="keyword">boolean</span> watcher, ChildrenCallback cb, Object ctx)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;String&gt; <span class="title">getChildren</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, Stat stat)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;String&gt; <span class="title">getChildren</span><span class="params">(String path, <span class="keyword">boolean</span> watcher, Stat stat)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getChildren</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, Children2Callback cb, Object ctx)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getChildren</span><span class="params">(String path, <span class="keyword">boolean</span> watcher, Children2Callback cb, Object ctx)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200123.png" alt></p><p>å½“æœ‰å­èŠ‚ç‚¹è¢«æ·»åŠ æˆ–åˆ é™¤æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª <code>NodeChildrenChanged(EventType.NodeChildrenChanged)</code> ç±»å‹çš„äº‹ä»¶é€šçŸ¥ã€‚è¦æ³¨æ„è¯¥é€šçŸ¥ä¸åŒ…å«æœ€æ–°çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯å¿…é¡»ä¸»åŠ¨é‡æ–°è·å–ã€‚</p><p>ä½¿ç”¨åŒæ­¥æ¥å£è·å–å­èŠ‚ç‚¹åˆ—è¡¨ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200124.png" alt></p><p>æ³¨æ„ï¼ŒWatcheré€šçŸ¥æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è§¦å‘ä¸€æ¬¡é€šçŸ¥ï¼Œè¯¥Watcherå°±å¤±æ•ˆäº†ï¼Œå› æ­¤å®¢æˆ·ç«¯éœ€è¦åå¤æ³¨å†ŒWatcherã€‚</p><p>ä½¿ç”¨å¼‚æ­¥æ¥å£è·å–å­èŠ‚ç‚¹åˆ—è¡¨ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200125.png" alt></p><p>å¼‚æ­¥æ¥å£ç»å¸¸è¢«åº”ç”¨åœ¨è¿™æ ·çš„ä½¿ç”¨åœºæ™¯ï¼šåº”ç”¨å¯åŠ¨æ—¶è·å–ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œå¦‚â€œæœºå™¨åˆ—è¡¨â€ï¼Œè¿™äº›é…ç½®é€šå¸¸è¾ƒå¤§ï¼Œå¹¶ä¸”ä¸å¸Œæœ›é…ç½®çš„è·å–å½±å“åº”ç”¨çš„ä¸»æµç¨‹ã€‚</p><h3 id="ï¼ˆ2ï¼‰getData"><a href="#ï¼ˆ2ï¼‰getData" class="headerlink" title="ï¼ˆ2ï¼‰getData"></a>ï¼ˆ2ï¼‰getData</h3><p>è·å–ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] getData(<span class="keyword">final</span> String path, Watcher watcher, Stat stat);</span><br><span class="line"></span><br><span class="line"><span class="keyword">byte</span>[] getData(String path, <span class="keyword">boolean</span> watcher, Stat stat);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getData</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, DataCallback cb, Object ctx)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getData</span><span class="params">(String path, <span class="keyword">boolean</span> watcher, DataCallback cb, Object ctx)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200126.png" alt></p><p>å½“èŠ‚ç‚¹çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ï¼ŒZooKeeperæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª <code>NodeDataChanged(EventType.NodeDataChanged)</code> çš„äº‹ä»¶é€šçŸ¥ã€‚èŠ‚ç‚¹çš„æ•°æ®å†…å®¹å’Œæ•°æ®ç‰ˆæœ¬å˜åŒ–éƒ½è¢«çœ‹ä½œæ˜¯èŠ‚ç‚¹çš„å˜åŒ–ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200127.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200128.png" alt></p><h2 id="äº”-æ›´æ–°æ•°æ®"><a href="#äº”-æ›´æ–°æ•°æ®" class="headerlink" title="äº”. æ›´æ–°æ•°æ®"></a>äº”. æ›´æ–°æ•°æ®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Stat <span class="title">setData</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">byte</span> data[], <span class="keyword">int</span> version)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setData</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">byte</span> data[], <span class="keyword">int</span> version, StatCallback cb, Object ctx)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200129.png" alt></p><p><code>getData</code> è¯»å–æ•°æ®æ¥å£å¹¶æœªæä¾›æ ¹æ®æŒ‡å®šæ•°æ®ç‰ˆæœ¬æ¥è·å–æ•°æ®çš„æ¥å£ï¼Œ<code>setData</code> æ­¤å¤„çš„versionç±»ä¼¼äºCASæ¯”è¾ƒå¹¶äº¤æ¢åŸç†ï¼Œå¯¹åº”é¢„æœŸå€¼è¡¨ç¤ºé’ˆå¯¹æ­¤ç‰ˆæœ¬æ›´æ–°ï¼Œè¿™æ ·åœ¨ä¸€ä¸ªå®¢æˆ·ç«¯è¯»å–å¹¶ä¿®æ”¹ä¸­é—´å…¶ä»–å®¢æˆ·ç«¯çš„ä¿®æ”¹ä¼šä½¿è¿™æ¬¡ä¿®æ”¹æ— æ•ˆï¼Œä»è€Œé¿å…å¹¶å‘é—®é¢˜ã€‚</p><p>åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„versionè¿›è¡Œäº†ä¸‰æ¬¡æ›´æ–°æ“ä½œï¼šæ•°æ®ç‰ˆæœ¬ä»0å¼€å§‹ï¼Œ-1éåˆæ³•çš„æ•°æ®ç‰ˆæœ¬ï¼Œè¿™é‡Œç”¨æ¥å‘Šè¯‰æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯è¦åŸºäºæœ€æ–°ç‰ˆæœ¬è¿›è¡Œæ›´æ–°æ“ä½œã€‚ç¬¬ä¸‰æ¬¡æ“ä½œä½¿ç”¨äº†ä¹‹å‰çš„æ•°æ®ç‰ˆæœ¬1æ‰€ä»¥å¯¼è‡´æ›´æ–°å¤±è´¥ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200130.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200131.png" alt></p><h2 id="å…­-æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"><a href="#å…­-æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨" class="headerlink" title="å…­. æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"></a>å…­. æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</h2><p>æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›ä¸€ä¸ªstatå¯¹è±¡ï¼Œå½“èŠ‚ç‚¹è¢«åˆ›å»ºã€è¢«åˆ é™¤æˆ–æ•°æ®è¢«æ›´æ–°ä¼šé€šè¿‡Watcheré€šçŸ¥å®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Stat <span class="title">exists</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Stat <span class="title">exists</span><span class="params">(String path, <span class="keyword">boolean</span> watcher)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exists</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, StatCallback cb, Object ctx)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exists</span><span class="params">(String path, <span class="keyword">boolean</span> watcher, StatCallback cb, Object ctx)</span></span>;</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200132.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200133.png" alt></p><p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå…ˆåè¿›è¡Œäº†å¦‚ä¸‹æ“ä½œï¼š</p><ol><li>é€šè¿‡existsæ¥å£æ£€æµ‹æ˜¯å¦å­˜åœ¨æŒ‡å®šèŠ‚ç‚¹ï¼ŒåŒæ—¶æ³¨å†Œäº†ä¸€ä¸ªWatcherã€‚</li><li>åˆ›å»ºèŠ‚ç‚¹/zk-bookï¼Œæ­¤æ—¶æœåŠ¡ç«¯é©¬ä¸Šä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªäº‹ä»¶é€šçŸ¥ï¼šNodeCreatedã€‚å®¢æˆ·ç«¯æ”¶åˆ°è¯¥äº‹ä»¶é€šçŸ¥åï¼Œå†æ¬¡è°ƒç”¨existsæ¥å£ï¼ŒåŒæ—¶æ³¨å†ŒWatcherã€‚</li><li>æ›´æ–°è¯¥èŠ‚ç‚¹çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒæœåŠ¡ç«¯åˆä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªäº‹ä»¶é€šçŸ¥ï¼šNodeDataChangedã€‚å®¢æˆ·ç«¯æ”¶åˆ°è¯¥äº‹ä»¶é€šçŸ¥åï¼Œç»§ç»­è°ƒç”¨existsæ¥å£ï¼ŒåŒæ—¶æ³¨å†ŒWatcherã€‚</li><li>åˆ›å»ºå­èŠ‚ç‚¹/zk-book/c1ã€‚</li><li>åˆ é™¤å­èŠ‚ç‚¹/zk-book/c1ã€‚</li><li>åˆ é™¤èŠ‚ç‚¹/zk-bookã€‚æ­¤æ—¶å®¢æˆ·ç«¯ä¼šæ”¶åˆ°æœåŠ¡ç«¯çš„äº‹ä»¶é€šçŸ¥ï¼šNodeDeletedã€‚</li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¯ä»¥å¾—çŸ¥ï¼š</p><ul><li>æ— è®ºæŒ‡å®šèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œé€šè¿‡è°ƒç”¨existsæ¥å£éƒ½å¯ä»¥æ³¨å†ŒWatcherã€‚</li><li>existsæ¥å£ä¸­æ³¨å†Œçš„Watcherï¼Œèƒ½å¤Ÿå¯¹èŠ‚ç‚¹åˆ›å»ºã€èŠ‚ç‚¹åˆ é™¤å’ŒèŠ‚ç‚¹æ•°æ®æ›´æ–°äº‹ä»¶è¿›è¡Œç›‘å¬ã€‚</li><li>å¯¹äºæŒ‡å®šèŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„å„ç§å˜åŒ–ï¼Œéƒ½ä¸ä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚</li></ul><h2 id="ä¸ƒ-æƒé™æ§åˆ¶"><a href="#ä¸ƒ-æƒé™æ§åˆ¶" class="headerlink" title="ä¸ƒ. æƒé™æ§åˆ¶"></a>ä¸ƒ. æƒé™æ§åˆ¶</h2><p>é›†ç¾¤æ¨¡å¼ä¸‹çš„ZooKeeperï¼Œä¸åŒçš„åº”ç”¨ä¹‹é—´å¾€å¾€æ˜¯ä¸ä¼šå­˜åœ¨å…±äº«æ•°æ®çš„ä½¿ç”¨åœºæ™¯çš„ï¼Œå› æ­¤éœ€è¦è§£å†³ä¸åŒåº”ç”¨ä¹‹é—´çš„æƒé™é—®é¢˜ã€‚</p><p>é€šè¿‡è®¾ç½®æœåŠ¡ç«¯ä¸Šæ•°æ®èŠ‚ç‚¹çš„ACLï¼Œæ¥æ§åˆ¶å®¢æˆ·ç«¯å¯¹è¯¥èŠ‚ç‚¹çš„è®¿é—®æƒé™ã€‚ZooKeeperæä¾›äº†å¤šç§æƒé™æ§åˆ¶æ¨¡å¼ï¼š</p><ul><li>world</li><li>auth</li><li>digestï¼šä¸»è¦è®²è§£è¯¥æ¨¡å¼</li><li>ip</li><li>super</li></ul><p>å®¢æˆ·ç«¯åœ¨ä¼šè¯åˆ›å»ºåï¼Œè°ƒç”¨ <code>addAuthInfo(String scheme, byte[] auth)</code> æ¥å£è¿›è¡Œæƒé™ä¿¡æ¯çš„è®¾ç½®ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200134.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200135.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200136.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200137.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200139.png" alt></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹æ¥è‡ªã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šåˆ›å»ºä¼šè¯ã€èŠ‚ç‚¹ï¼Œåˆ é™¤èŠ‚ç‚¹ï¼Œè¯»å–ã€æ›´æ–°æ•°æ®ï¼Œæ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œæƒé™æ§åˆ¶ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="zookeeper" scheme="http://linyishui.top/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>ZooKeeperï¼ˆä¸€ï¼‰æ¦‚è¿°å’ŒZABåè®®</title>
    <link href="http://linyishui.top/2021051001.html"/>
    <id>http://linyishui.top/2021051001.html</id>
    <published>2021-05-10T13:27:05.000Z</published>
    <updated>2021-05-19T13:48:38.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ZooKeeperï¼ˆä¸€ï¼‰æ¦‚è¿°å’ŒZABåè®®"><a href="#ZooKeeperï¼ˆä¸€ï¼‰æ¦‚è¿°å’ŒZABåè®®" class="headerlink" title="ZooKeeperï¼ˆä¸€ï¼‰æ¦‚è¿°å’ŒZABåè®®"></a>ZooKeeperï¼ˆä¸€ï¼‰æ¦‚è¿°å’ŒZABåè®®</h1><h2 id="ä¸€-æ¦‚è¿°"><a href="#ä¸€-æ¦‚è¿°" class="headerlink" title="ä¸€. æ¦‚è¿°"></a>ä¸€. æ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯ZooKeeperï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯ZooKeeperï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ZooKeeperï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯ZooKeeperï¼Ÿ</h3><ul><li>Apache ZooKeeper ç”± Apache Hadoop å­é¡¹ç›®å‘å±•è€Œæ¥ã€‚</li><li>ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œç”±é›…è™åˆ›å»ºï¼ŒGoogle Chubby çš„å¼€æºå®ç°ã€‚</li><li>è®¾è®¡ç›®æ ‡æ˜¯å°†é‚£äº›å¤æ‚æ˜“å‡ºé”™çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡å°è£…èµ·æ¥ï¼Œæ„æˆä¸€ä¸ªé«˜æ•ˆå¯é çš„åŸè¯­é›†ï¼Œå¹¶ä»¥ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„æ¥å£æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚</li><li>ZooKeeper ä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›äº†é«˜æ•ˆä¸”å¯é çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œæä¾›äº†è¯¸å¦‚<strong>ç»Ÿä¸€å‘½åæœåŠ¡</strong>ã€<strong>é…ç½®å…³è”</strong>å’Œ<strong>åˆ†å¸ƒå¼é”</strong>ç­‰åˆ†å¸ƒå¼çš„åŸºç¡€æœåŠ¡ã€‚</li><li>ZooKeeperå¹¶æ²¡æœ‰ç›´æ¥é‡‡ç”¨ Paxos ç®—æ³•ï¼Œè€Œæ˜¯ä¸€ç§è¢«ç§°ä¸º ZABï¼ˆZooKeeper Atomic Broadcastï¼‰çš„ä¸€è‡´æ€§åè®®ã€‚</li></ul><p>ZooKeeper æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œåº”ç”¨å¯ä»¥åŸºäºå®ƒå®ç°è¯¸å¦‚<strong>æ•°æ®å‘å¸ƒ/è®¢é˜…</strong>ã€<strong>è´Ÿè½½å‡è¡¡</strong>ã€<strong>å‘½åæœåŠ¡</strong>ã€<strong>åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥</strong>ã€<strong>é›†ç¾¤ç®¡ç†</strong>ã€<strong>Masteré€‰ä¸¾</strong>ã€<strong>åˆ†å¸ƒå¼é”</strong>å’Œ<strong>åˆ†å¸ƒå¼é˜Ÿåˆ—</strong>ç­‰åŠŸèƒ½ã€‚</p><h3 id="1-2-ç‰¹æ€§"><a href="#1-2-ç‰¹æ€§" class="headerlink" title="1.2 ç‰¹æ€§"></a>1.2 ç‰¹æ€§</h3><ul><li><strong>é¡ºåºä¸€è‡´æ€§ï¼š</strong>ä»åŒä¸€å®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œå°†ä¼šä¸¥æ ¼çš„æŒ‰ç…§å‘é€é¡ºåºè¢«åº”ç”¨åˆ°ZooKeeperä¸­ã€‚</li><li><strong>åŸå­æ€§ï¼š</strong>æ‰€æœ‰äº‹åŠ¡è¯·æ±‚çš„å¤„ç†ç»“æœåœ¨æ•´ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¸Šçš„åº”ç”¨æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œè¦ä¹ˆæ•´ä¸ªé›†ç¾¤æ‰€æœ‰æœºå™¨éƒ½æˆåŠŸåº”ç”¨äº†æŸä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰åº”ç”¨ã€‚</li><li><strong>å•ä¸€è§†å›¾ï¼š</strong>æ— è®ºå®¢æˆ·ç«¯è¿æ¥å“ªä¸ªZooKeeperæœåŠ¡å™¨ï¼Œçœ‹åˆ°çš„æœåŠ¡ç«¯æ•°æ®æ¨¡å‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li><li><strong>å¯é æ€§ï¼š</strong>ä¸€æ—¦æœåŠ¡ç«¯æˆåŠŸåº”ç”¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶å®Œæˆå¯¹å®¢æˆ·ç«¯çš„å“åº”ï¼Œäº‹åŠ¡å¼•èµ·çš„æœåŠ¡ç«¯çŠ¶æ€ä¸€ç›´ä¿ç•™åˆ°ä¸‹ä¸ªäº‹åŠ¡è¿›è¡Œå˜æ›´ã€‚</li><li><strong>å®æ—¶æ€§ï¼š</strong>ZooKeeperä»…ä¿è¯åœ¨ä¸€å®šæ—¶é—´æ®µå†…ï¼Œå®¢æˆ·ç«¯æœ€ç»ˆä¸€å®šèƒ½å¤Ÿä»æœåŠ¡ç«¯è¯»å–åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚</li></ul><h3 id="1-3-è®¾è®¡ç›®æ ‡"><a href="#1-3-è®¾è®¡ç›®æ ‡" class="headerlink" title="1.3 è®¾è®¡ç›®æ ‡"></a>1.3 è®¾è®¡ç›®æ ‡</h3><ol><li><strong>ç®€å•çš„æ•°æ®æ¨¡å‹ï¼š</strong>åˆ†å¸ƒå¼ç¨‹åºé€šè¿‡ä¸€ä¸ªå…±äº«çš„ã€æ ‘å‹ç»“æ„çš„åå­—ç©ºé—´æ¥ç›¸äº’åè°ƒ</li><li><strong>å¯ä»¥æ„å»ºé›†ç¾¤ï¼š</strong>ä¸€èˆ¬3~5å°æœºå™¨å¯ä»¥ç»„æˆä¸€ä¸ªå¯ç”¨çš„ZooKeeperé›†ç¾¤ï¼Œæ¯å°æœºå™¨éƒ½ä¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤å½“å‰çš„æœåŠ¡å™¨çŠ¶æ€ï¼Œæœºå™¨ä¹‹é—´äº’ç›¸éƒ½ä¿æŒç€é€šä¿¡ã€‚ZooKeeperå®¢æˆ·ç«¯ä¼šä¸ä»»æ„ä¸€å°æœºå™¨åˆ›å»ºä¸€ä¸ªTCPè¿æ¥ï¼Œä¸€æ—¦è¿æ¥æ–­å¼€ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨è¿æ¥åˆ°å…¶ä»–æœºå™¨ã€‚</li><li><strong>é¡ºåºè®¿é—®ï¼š</strong>ZooKeeperä¸ºå®¢æˆ·ç«¯çš„æ¯ä¸ªæ›´æ–°è¯·æ±‚åˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„é€’å¢ç¼–å·ï¼Œåæ˜ äº†äº‹åŠ¡æ“ä½œçš„å…ˆåé¡ºåºã€‚</li><li><strong>é«˜æ€§èƒ½ï¼š</strong>ZooKeeperå°†å…¨é‡æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥æœåŠ¡äºå®¢æˆ·ç«¯çš„æ‰€æœ‰éäº‹åŠ¡è¯·æ±‚ï¼Œéå¸¸é€‚åˆäºè¯»æ“ä½œä¸ºä¸»çš„åœºæ™¯ã€‚</li></ol><h3 id="1-4-æ ¸å¿ƒæ¦‚å¿µ"><a href="#1-4-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="1.4 æ ¸å¿ƒæ¦‚å¿µ"></a>1.4 æ ¸å¿ƒæ¦‚å¿µ</h3><ul><li><p><strong>é›†ç¾¤è§’è‰²ï¼š</strong></p><ul><li>æœ€å…¸å‹çš„é›†ç¾¤æ¨¡å¼æ˜¯Master/Slaveï¼ˆä¸»å¤‡æ¨¡å¼ï¼‰ï¼Œèƒ½å¤Ÿå¤„ç†æ‰€æœ‰å†™æ“ä½œçš„æ˜¯Masteræœºå™¨ï¼Œæ‰€æœ‰é€šè¿‡å¼‚æ­¥å¤åˆ¶æ–¹å¼è·å–æœ€æ–°æ•°æ®ï¼Œå¹¶æä¾›è¯»æœåŠ¡çš„æœºå™¨æ˜¯Slaveæœºå™¨ã€‚</li><li>ZooKeeperå¹¶æ²¡æœ‰é‡‡ç”¨è¿™ç§æ¨¡å¼ï¼Œè€Œæ˜¯å¼•å…¥äº†æ–°çš„ä¸‰ä¸ªè§’è‰²ï¼š<ul><li><strong>Leaderï¼š</strong>é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨é€šè¿‡é€‰ä¸¾è¿‡ç¨‹é€‰å®šä¸€ä¸ªLeaderï¼Œå…¶ä¸ºå®¢æˆ·ç«¯æä¾›è¯»å’Œå†™æœåŠ¡ã€‚</li><li><strong>Followerï¼š</strong>æä¾›è¯»æœåŠ¡ã€‚</li><li><strong>Observerï¼š</strong>æä¾›è¯»æœåŠ¡ï¼Œä¸å‚ä¸Leaderé€‰ä¸¾è¿‡ç¨‹ï¼Œä¹Ÿä¸å‚ä¸å†™æ“ä½œçš„â€œè¿‡åŠå†™æˆåŠŸâ€ç­–ç•¥ï¼Œå› æ­¤Observerå¯ä»¥åœ¨ä¸å½±å“å†™æ€§èƒ½çš„æƒ…å†µä¸‹æé«˜é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚</li></ul></li></ul></li><li><p><strong>ä¼šè¯ï¼ˆSessionï¼‰ï¼š</strong></p><ul><li>åœ¨ZooKeeperä¸­ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ä¸ªTCPé•¿è¿æ¥ã€‚</li><li>ZooKeeperå¯¹å¤–çš„æœåŠ¡ç«¯å£é»˜è®¤æ˜¯2181ï¼Œå®¢æˆ·ç«¯å¯åŠ¨æ—¶é¦–å…ˆä¼šä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œä»ç¬¬ä¸€æ¬¡è¿æ¥å»ºç«‹å¼€å§‹ï¼Œå®¢æˆ·ç«¯ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå¼€å§‹ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªè¿æ¥è¿›è¡Œå¿ƒè·³æ£€æµ‹ä¸æœåŠ¡å™¨ä¿æŒæœ‰æ•ˆçš„ä¼šè¯ï¼Œä¹Ÿèƒ½å¤Ÿå‘ZooKeeperæœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼ŒåŒæ—¶è¿˜èƒ½é€šè¿‡è¯¥è¿æ¥æ¥æ”¶æœåŠ¡å™¨çš„Watchäº‹ä»¶é€šçŸ¥ã€‚</li><li>sessionTimeoutå€¼ç”¨æ¥è®¾ç½®ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯çš„è¶…æ—¶æ—¶é—´ã€‚å› æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ã€ç½‘ç»œæ•…éšœæˆ–å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥ç­‰å¯¼è‡´çš„è¿æ¥æ–­å¼€ï¼Œåªè¦åœ¨sessionTimeoutè§„å®šæ—¶é—´å†…é‡æ–°è¿ä¸Šä¸€å°æœåŠ¡å™¨ï¼Œä¹‹å‰åˆ›å»ºçš„ä¼šè¯ä»ä¼šæœ‰æ•ˆã€‚</li></ul></li><li><p><strong>æ•°æ®èŠ‚ç‚¹ï¼ˆZNodeï¼‰ï¼š</strong>åˆ†å¸ƒå¼ä¸­èŠ‚ç‚¹å³æ¯å°æœºå™¨ï¼Œåœ¨ZooKeeperä¸­ï¼ŒèŠ‚ç‚¹åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><strong>æœºå™¨èŠ‚ç‚¹ï¼š</strong>æ„æˆé›†ç¾¤çš„æœºå™¨</li><li><strong>æ•°æ®èŠ‚ç‚¹ï¼š</strong>æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®å•å…ƒï¼Œå³ZNodeï¼Œåˆå¯ä»¥åˆ†ä¸º<ul><li><strong>æŒä¹…èŠ‚ç‚¹ï¼š</strong>ä¸€æ—¦æ­¤ZNodeè¢«åˆ›å»ºï¼Œé™¤éä¸»åŠ¨è¿›è¡Œç§»é™¤æ“ä½œï¼Œå¦åˆ™å°†ä¸€ç›´ä¿å­˜ã€‚</li><li><strong>ä¸´æ—¶èŠ‚ç‚¹ï¼š</strong>ç”Ÿå‘½å‘¨æœŸå’Œå®¢æˆ·ç«¯ä¼šè¯ç»‘å®šï¼Œä¸€æ—¦å®¢æˆ·ç«¯ä¼šè¯å¤±æ•ˆï¼Œè¯¥å®¢æˆ·ç«¯åˆ›å»ºçš„æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹éƒ½ä¼šè¢«ç§»é™¤ã€‚</li></ul></li></ul><p>æ•°æ®æ¨¡å‹æ˜¯ä¸€æ£µæ ‘ï¼Œç”±æ–œæ ï¼ˆ<code>/</code>ï¼‰è¿›è¡Œåˆ†å‰²çš„è·¯å¾„ï¼Œå°±æ˜¯ä¸€ä¸ªZNodeï¼Œå¦‚ <code>/foo/path1</code> ã€‚æ¯ä¸ªZNodeä¸Šéƒ½ä¼šä¿å­˜è‡ªå·±çš„æ•°æ®å†…å®¹ï¼Œä»¥åŠä¸€ç³»åˆ—å±æ€§ä¿¡æ¯ã€‚</p><p>ZooKeeperå…è®¸ç”¨æˆ·ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼šSEQUENTIALï¼Œå½“èŠ‚ç‚¹æ ‡è®°æ­¤å±æ€§ï¼Œåœ¨èŠ‚ç‚¹åˆ›å»ºæ—¶ä¼šè‡ªåŠ¨åœ¨èŠ‚ç‚¹ååè¿½åŠ ä¸€ä¸ªç”±çˆ¶èŠ‚ç‚¹ç»´æŠ¤çš„è‡ªå¢æ•´å‹æ•°å­—ã€‚</p></li><li><p><strong>ç‰ˆæœ¬ï¼š</strong>ZooKeeperçš„æ¯ä¸ªZNodeéƒ½ä¼šç»´æŠ¤ä¸€ä¸ªå«åš <strong>Stat</strong> çš„æ•°æ®ç»“æ„ï¼ŒStatä¸­è®°å½•äº†èŠ‚ç‚¹çš„ä¸‰ä¸ªæ•°æ®ç‰ˆæœ¬ï¼š</p><ul><li>versionï¼šå½“å‰ZNodeçš„ç‰ˆæœ¬</li><li>cversionï¼šå½“å‰ZNodeå­èŠ‚ç‚¹çš„ç‰ˆæœ¬</li><li>aversionï¼šå½“å‰ZNodeçš„ACLç‰ˆæœ¬</li></ul></li><li><p><strong>Watcherï¼š</strong>å³äº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº›Watcherï¼Œåœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶è§¦å‘æ—¶ï¼ŒZooKeeperæœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸Šã€‚</p></li><li><p><strong>ACLï¼š</strong>ZooKeeperé‡‡ç”¨ Access Control Lists ç­–ç•¥æ¥è¿›è¡Œæƒé™æ§åˆ¶ï¼Œç±»ä¼¼äºUNIXæ–‡ä»¶ç³»ç»Ÿçš„æƒé™æ§åˆ¶ï¼Œå®šä¹‰äº†5ç§æƒé™ï¼š</p><ul><li><strong>CREATEï¼š</strong>åˆ›å»ºå­èŠ‚ç‚¹çš„æƒé™</li><li><strong>READï¼š</strong>è·å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨çš„æƒé™</li><li><strong>WRITEï¼š</strong>æ›´æ–°èŠ‚ç‚¹æ•°æ®çš„æƒé™</li><li><strong>DELETEï¼š</strong>åˆ é™¤å­èŠ‚ç‚¹çš„æƒé™</li><li><strong>ADMINï¼š</strong>è®¾ç½®èŠ‚ç‚¹ACLçš„æƒé™</li></ul></li></ul><h2 id="äºŒ-ZAB-åè®®"><a href="#äºŒ-ZAB-åè®®" class="headerlink" title="äºŒ. ZAB åè®®"></a>äºŒ. ZAB åè®®</h2><h3 id="2-1-ä»€ä¹ˆæ˜¯ZABåè®®ï¼Ÿ"><a href="#2-1-ä»€ä¹ˆæ˜¯ZABåè®®ï¼Ÿ" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯ZABåè®®ï¼Ÿ"></a>2.1 ä»€ä¹ˆæ˜¯ZABåè®®ï¼Ÿ</h3><p>ZooKeeperå¹¶æ²¡æœ‰å®Œå…¨é‡‡ç”¨ Paxos ç®—æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨äº†ä¸€ä¸ªç§°ä¸º ZooKeeper Atomic Broadcastï¼ˆZABï¼ŒZooKeeper<strong>åŸå­æ¶ˆæ¯å¹¿æ’­åè®®</strong>ï¼‰çš„åè®®æ¥ä½œä¸ºå…¶æ•°æ®ä¸€è‡´æ€§çš„æ ¸å¿ƒç®—æ³•ã€‚</p><p>ZABåè®®æ˜¯ä¸€ç§æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®ï¼Œæœ€åˆåªæ˜¯ä¸ºé›…è™å…¬å¸å†…éƒ¨ä¸€äº›<strong>é«˜ååé‡ã€ä½å»¶è¿Ÿã€å¥å£®ã€ç®€å•</strong>çš„åˆ†å¸ƒå¼ç³»ç»Ÿåœºæ™¯è®¾è®¡çš„ï¼Œå¹¶ä¸åƒPaxosç®—æ³•é‚£æ ·é€šç”¨å’Œå¯æ‰©å±•ã€‚</p><p>åŸºäºè¯¥åè®®ï¼ŒZooKeeperå®ç°äº†ä¸€ç§<strong>ä¸»å¤‡æ¨¡å¼</strong>çš„ç³»ç»Ÿæ¶æ„æ¥ä¿æŒé›†ç¾¤ä¸­å„å‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚ZooKeeperä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„ä¸»è¿›ç¨‹æ¥æ¥æ”¶å¹¶å¤„ç†å®¢æˆ·ç«¯æ‰€æœ‰çš„äº‹åŠ¡è¯·æ±‚ï¼Œé€šè¿‡ZABçš„åŸå­å¹¿æ’­åè®®å°†æœåŠ¡å™¨çš„æ•°æ®çŠ¶æ€ä»¥äº‹åŠ¡Proposalçš„å½¢å¼å¹¿æ’­åˆ°æ‰€æœ‰çš„å‰¯æœ¬è¿›ç¨‹ã€‚è¯¥ä¸»å¤‡æ¨¡å‹ä¿è¯äº†<strong>åŒä¸€æ—¶åˆ»é›†ç¾¤ä¸­åªèƒ½æœ‰ä¸€ä¸ªä¸»è¿›ç¨‹æ¥å¹¿æ’­æœåŠ¡å™¨çš„çŠ¶æ€å˜æ›´</strong>ï¼Œå› æ­¤èƒ½å¤Ÿå¾ˆå¥½çš„å¤„ç†å®¢æˆ·ç«¯å¤§é‡çš„å¹¶å‘è¯·æ±‚ã€‚å¹¶ä¸”<strong>æ”¯æŒåˆ†å¸ƒå¼ç¯å¢ƒä¸­å¯¹äºé¡ºåºçŠ¶æ€çš„éœ€æ±‚</strong>ï¼ˆæœ‰äº›çŠ¶æ€å˜æ›´å¿…é¡»ä¾èµ–äºæ¯”å®ƒæ—©ç”Ÿæˆçš„çŠ¶æ€å˜æ›´ï¼‰ï¼Œä¿è¯äº†ä¸€ä¸ªå…¨å±€çš„å˜æ›´åºåˆ—è¢«é¡ºåºåº”ç”¨ã€‚å› ä¸ºä¸»è¿›ç¨‹éšæ—¶å¯èƒ½å´©æºƒæˆ–é‡å¯ï¼Œè¿˜è¦åšåˆ°ä¸»è¿›ç¨‹æœ‰é—®é¢˜æ—¶ä»èƒ½æ­£å¸¸å·¥ä½œã€‚</p><p>æ‰€æœ‰äº‹åŠ¡è¯·æ±‚å¿…é¡»ç”±ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æœåŠ¡å™¨æ¥åè°ƒå¤„ç†ï¼Œå³LeaderæœåŠ¡å™¨ï¼Œä½™ä¸‹çš„æœåŠ¡å™¨æˆä¸ºFolloweræœåŠ¡å™¨ã€‚LeaderæœåŠ¡å™¨è´Ÿè´£å°†ä¸€ä¸ªå®¢æˆ·ç«¯äº‹åŠ¡è¯·æ±‚è½¬æ¢ä¸ºä¸€ä¸ªäº‹åŠ¡ Proposalï¼ˆæè®®ï¼‰ï¼Œå¹¶å°†è¯¥æè®®åˆ†å‘ç»™é›†ç¾¤ä¸­æ‰€æœ‰çš„FolloweræœåŠ¡å™¨ã€‚ä¹‹åLeaderæœåŠ¡å™¨ç­‰å¾…æ‰€æœ‰FolloweræœåŠ¡å™¨çš„åé¦ˆï¼Œä¸€æ—¦è¶…è¿‡åŠæ•°è¿›è¡Œäº†æ­£ç¡®çš„åé¦ˆï¼ŒLeaderæœåŠ¡å™¨å†æ¬¡å‘æ‰€æœ‰çš„FolloweræœåŠ¡å™¨åˆ†å‘Commitæ¶ˆæ¯ï¼Œè¦æ±‚å°†å‰ä¸€ä¸ªæè®®æäº¤ã€‚</p><h3 id="2-2-åè®®ä»‹ç»"><a href="#2-2-åè®®ä»‹ç»" class="headerlink" title="2.2 åè®®ä»‹ç»"></a>2.2 åè®®ä»‹ç»</h3><p>ZABåè®®åŒ…å«ä¸¤ç§åŸºæœ¬æ¨¡å¼ï¼š</p><ul><li><strong>å´©æºƒæ¢å¤ï¼š</strong><ul><li>å½“æ•´ä¸ªæœåŠ¡æ¡†æ¶åœ¨å¯åŠ¨è¿‡ç¨‹ï¼Œæˆ–æ˜¯LeaderæœåŠ¡å™¨å‡ºç°ç½‘ç»œä¸­æ–­ã€å´©æºƒé€€å‡ºä¸é‡å¯ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼ŒZABè¿›å…¥è¯¥æ¨¡å¼é€‰ä¸¾äº§ç”Ÿæ–°çš„LeaderæœåŠ¡å™¨ã€‚</li><li>é€‰å‡ºæ–°çš„Leaderï¼Œä¸”é›†ç¾¤ä¸­å·²æœ‰è¿‡åŠçš„æœºå™¨ä¸æ–°çš„Leaderå®ŒæˆçŠ¶æ€åŒæ­¥ï¼ˆæŒ‡æ•°æ®åŒæ­¥ï¼Œç”¨æ¥ä¿è¯è¿‡åŠæœºå™¨ä¸Leaderä¿æŒä¸€è‡´ï¼‰ä¹‹åï¼ŒZABé€€å‡ºè¯¥æ¨¡å¼ã€‚</li></ul></li><li><strong>æ¶ˆæ¯å¹¿æ’­ï¼š</strong><ul><li>é›†ç¾¤ä¸­æœ‰è¿‡åŠçš„FolloweræœåŠ¡å™¨å®Œæˆäº†ä¸LeaderæœåŠ¡å™¨çš„çŠ¶æ€åŒæ­¥ï¼ŒæœåŠ¡æ¡†æ¶è¿›å…¥è¯¥æ¨¡å¼ã€‚</li><li>å½“ä¸€å°éµå®ˆZABåè®®çš„æœåŠ¡å™¨å¯åŠ¨å¹¶åŠ å…¥é›†ç¾¤æ—¶ï¼Œè‹¥æ­¤æ—¶å·²å­˜åœ¨LeaderæœåŠ¡å™¨ï¼Œå®ƒä¼šè‡ªè§‰çš„è¿›å…¥æ•°æ®æ¢å¤æ¨¡å¼ï¼šæ‰¾åˆ°Leaderæ‰€åœ¨æœåŠ¡å™¨ï¼Œå¹¶ä¸å…¶è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œç„¶åä¸€èµ·å‚ä¸åˆ°æ¶ˆæ¯å¹¿æ’­æµç¨‹ä¸­ã€‚</li></ul></li></ul><h4 id="ï¼ˆ1ï¼‰æ¶ˆæ¯å¹¿æ’­"><a href="#ï¼ˆ1ï¼‰æ¶ˆæ¯å¹¿æ’­" class="headerlink" title="ï¼ˆ1ï¼‰æ¶ˆæ¯å¹¿æ’­"></a>ï¼ˆ1ï¼‰æ¶ˆæ¯å¹¿æ’­</h4><p>æ¶ˆæ¯å¹¿æ’­çš„è¿‡ç¨‹ç±»ä¼¼äºäºŒé˜¶æ®µæäº¤ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200111.png" alt></p><p>ZABæ²¡æœ‰ä¸­æ–­é€»è¾‘ï¼Œæ‰€ä»¥FolloweræœåŠ¡å™¨åé¦ˆAckåå°±å¯ä»¥æäº¤äº‹åŠ¡Proposalï¼Œè¿™ç§ç®€åŒ–æ¨¡å‹è‡ªç„¶å­˜åœ¨Leaderå•ç‚¹æ•…éšœå¼•èµ·çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚ZABåè®®é€šè¿‡å´©æºƒæ¢å¤æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ•´ä¸ªæ¶ˆæ¯å¹¿æ’­åè®®åŸºäºå…·æœ‰FIFOç‰¹æ€§çš„TCPåè®®æ¥è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œå¾ˆå®¹æ˜“ä¿è¯æ¶ˆæ¯æ¥æ”¶å’Œå‘é€çš„é¡ºåºæ€§ã€‚Leaderä¸ºæ¯ä¸ªäº‹åŠ¡Proposalåˆ†é…ä¸€ä¸ªå…¨å±€å•è°ƒé€’å¢çš„äº‹åŠ¡IDï¼ˆZXIDï¼‰ï¼Œæ¯ä¸ªäº‹åŠ¡æŒ‰ç…§ZXIDçš„å…ˆåé¡ºåºè¿›è¡Œæ’åºå’Œå¤„ç†ã€‚</p><p>LeaderæœåŠ¡å™¨ä¸ºæ¯ä¸ªFolloweræœåŠ¡å™¨å„è‡ªåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå°†éœ€è¦å¹¿æ’­çš„äº‹åŠ¡Proposalä¾æ¬¡æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œæ ¹æ®FIFOçš„ç­–ç•¥è¿›è¡Œæ¶ˆæ¯å‘é€ã€‚æ¯ä¸ªFolloweræœåŠ¡å™¨æ”¶åˆ°äº‹åŠ¡Proposalåï¼Œé¦–å…ˆä»¥äº‹åŠ¡æ—¥å¿—çš„å½¢å¼å†™å…¥åˆ°æœ¬åœ°ç£ç›˜ä¸­ï¼Œåœ¨æˆåŠŸå†™å…¥ååé¦ˆç»™Leaderä¸€ä¸ªAckå“åº”ã€‚æ”¶åˆ°è¶…è¿‡åŠæ•°çš„Ackå“åº”åï¼ŒLeaderä¼šå¹¿æ’­ä¸€ä¸ªCommitæ¶ˆæ¯ç»™æ‰€æœ‰FolloweræœåŠ¡å™¨ä»¥é€šçŸ¥è¿›è¡Œäº‹åŠ¡æäº¤ï¼ŒåŒæ—¶Leaderå®Œæˆè‡ªå·±çš„äº‹åŠ¡æäº¤ã€‚</p><h4 id="ï¼ˆ2ï¼‰å´©æºƒæ¢å¤"><a href="#ï¼ˆ2ï¼‰å´©æºƒæ¢å¤" class="headerlink" title="ï¼ˆ2ï¼‰å´©æºƒæ¢å¤"></a>ï¼ˆ2ï¼‰å´©æºƒæ¢å¤</h4><p>è¿›å…¥å´©æºƒæ¢å¤æ¨¡å¼åï¼Œéœ€è¦é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„LeaderæœåŠ¡å™¨ï¼Œè¿™éœ€è¦ä¸€ä¸ªé«˜æ•ˆä¸”å¯é çš„é€‰ä¸¾ç®—æ³•ï¼Œä¸ä»…éœ€è¦è®©æ–°Leaderè‡ªå·±çŸ¥é“å·²è¢«é€‰ä¸¾ä¸ºLeaderï¼Œè¿˜è¦è®©é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨å¿«é€Ÿæ„ŸçŸ¥åˆ°è¿™ç‚¹ã€‚</p><p><strong>ZABåè®®è¦ç¡®ä¿é‚£äº›å·²ç»åœ¨LeaderæœåŠ¡å™¨ä¸Šæäº¤çš„äº‹åŠ¡æœ€ç»ˆè¢«æ‰€æœ‰æœåŠ¡å™¨æäº¤ã€‚</strong></p><p>å‡è®¾ä¸€ä¸ªäº‹åŠ¡å·²åœ¨LeaderæœåŠ¡å™¨æäº¤ï¼Œä½†åœ¨å°†Commitæ¶ˆæ¯å‘é€ç»™æ‰€æœ‰Followerä¹‹å‰ï¼ŒLeaderæŒ‚æ‰äº†ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200112.png" alt></p><p><strong>ZABåè®®è¦ç¡®ä¿ä¸¢å¼ƒé‚£äº›åªåœ¨LeaderæœåŠ¡å™¨ä¸Šè¢«æå‡ºçš„äº‹åŠ¡ã€‚</strong></p><p>ç›¸åï¼Œåœ¨å´©æºƒæ¢å¤è¿‡ç¨‹ä¸­å‡ºç°ä¸€ä¸ªéœ€è¦è¢«ä¸¢å¼ƒçš„ææ¡ˆï¼Œåœ¨å´©æºƒæ¢å¤ç»“æŸåéœ€è¦è·³è¿‡è¯¥äº‹åŠ¡Proposalï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200113.png" alt></p><p>é’ˆå¯¹ä»¥ä¸Šä¸¤ç‚¹ï¼Œå¦‚æœLeaderé€‰ä¸¾ç®—æ³•èƒ½å¤Ÿä¿è¯æ–°é€‰ä¸¾å‡ºæ¥çš„LeaderæœåŠ¡å™¨æ‹¥æœ‰é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨æœ€é«˜ç¼–å·ï¼ˆZXIDï¼‰çš„äº‹åŠ¡Proposalï¼Œå°±å¯ä»¥ä¿è¯æ–°é€‰ä¸¾å‡ºçš„Leaderä¸€å®šå…·æœ‰æ‰€æœ‰å·²ç»æäº¤çš„ææ¡ˆï¼Œè¿˜å¯ä»¥çœåŒºLeaderæœåŠ¡å™¨æ£€æŸ¥Proposalçš„æäº¤å’Œä¸¢å¼ƒå·¥ä½œè¿™ä¸€æ­¥ã€‚</p><p>å®ŒæˆLeaderé€‰ä¸¾åï¼Œåœ¨æ­£å¼å·¥ä½œå‰ï¼ŒLeaderæœåŠ¡å™¨é¦–å…ˆè¦ç¡®è®¤äº‹åŠ¡æ—¥å¿—ä¸­æ‰€æœ‰çš„Proposalæ˜¯å¦éƒ½å·²ç»è¢«é›†ç¾¤ä¸­è¿‡åŠçš„æœºå™¨æäº¤äº†ï¼Œå³<strong>æ˜¯å¦å®Œæˆæ•°æ®åŒæ­¥</strong>ã€‚</p><ul><li>Leaderä¸ºæ¯ä¸ªFollowerå‡†å¤‡ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå°†æ²¡æœ‰è¢«å„FolloweråŒæ­¥çš„äº‹åŠ¡ä»¥Proposalæ¶ˆæ¯çš„å½¢å¼é€ä¸ªå‘é€ç»™Followerï¼Œå¹¶æ¯ä¸ªéƒ½è·Ÿç€å‘é€ä¸€ä¸ªCommitæ¶ˆæ¯ã€‚</li><li>ç­‰åˆ°æ‰€æœ‰Followeréƒ½å°†å…¶å°šæœªåŒæ­¥çš„äº‹åŠ¡Proposalä»Leaderä¸ŠåŒæ­¥è¿‡æ¥å¹¶æˆåŠŸåº”ç”¨åˆ°æœ¬åœ°æ•°æ®åº“åï¼ŒLeaderå°†è¯¥FolloweråŠ å¦‚åˆ°çœŸæ­£å¯ç”¨çš„Followeråˆ—è¡¨ï¼Œå¹¶å¼€å§‹ä¹‹åæµç¨‹ã€‚</li></ul><p><strong>å¦‚ä½•å¤„ç†éœ€è¦ä¸¢å¼ƒçš„äº‹åŠ¡Proposalï¼Ÿ</strong></p><p>ZXIDæ—¶ä¸€ä¸ª64ä½çš„æ•°å­—ï¼Œä½32ä½å¯ä»¥çœ‹ä½œç®€å•çš„é€’å¢è®¡æ•°å™¨ï¼Œé«˜32ä½åˆ™ä»£è¡¨äº†Leaderå‘¨æœŸepochçš„ç¼–å·ï¼Œæ¯å½“é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªæ–°çš„LeaderæœåŠ¡å™¨ï¼Œå°±ä¼šä»Leaderä¸Šå–å‡ºå…¶æœ¬åœ°æ—¥å¿—ä¸­æœ€å¤§äº‹åŠ¡Proposalçš„ZXIDï¼Œè§£æå‡ºepochå€¼å¹¶åŠ 1ï¼Œå°†æ­¤ç¼–å·ä½œä¸ºæ–°çš„epochï¼Œå¹¶å°†ä½32ä½ç½®0ã€‚</p><p>è¿™æ ·å¯ä»¥åŒºåˆ†å¼€ä¸åŒçš„Leaderå‘¨æœŸå˜åŒ–ï¼Œä»è€Œé¿å…ä¸åŒçš„LeaderæœåŠ¡å™¨é”™è¯¯çš„ä½¿ç”¨ç›¸åŒçš„ZXIDæå‡ºä¸åŒçš„äº‹åŠ¡Proposalã€‚</p><p>å½“ä¸€ä¸ªåŒ…å«äº†ä¸Šä¸ªå‘¨æœŸå°šæœªæäº¤çš„äº‹åŠ¡Proposalçš„æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå…¶è‚¯å®šæ— æ³•æˆä¸ºLeaderã€‚å› ä¸ºå½“å‰é›†ç¾¤ä¸€å®šåŒ…å«ä¸€ä¸ªQuorumé›†åˆï¼Œé›†åˆä¸­çš„æœºå™¨ä¸€å®šåŒ…å«äº†æ›´é«˜epochçš„äº‹åŠ¡Proposalï¼Œå› æ­¤è¯¥æœºå™¨è‚¯å®šéæœ€é«˜ç¼–å·äº‹åŠ¡ã€‚å½“å…¶è¿æ¥ä¸ŠLeaderåï¼ŒLeaderæ ¹æ®è‡ªå·±è®°å½•çš„æœ€åè¢«æäº¤çš„Proposalå¯¹æ¯”ï¼Œå¹¶è¦æ±‚Followerè¿›è¡Œä¸€ä¸ªå›é€€æ“ä½œâ€”å›é€€åˆ°ä¸€ä¸ªç¡®å®å·²ç»è¢«é›†ç¾¤è¿‡åŠæœºå™¨æäº¤çš„æœ€æ–°çš„äº‹åŠ¡Proposalï¼ˆå¦‚ä¸Šå›¾4-4 Server1è¿æ¥åï¼Œä¼šè¢«è¦æ±‚å»é™¤P3ï¼‰ã€‚</p><h3 id="2-3-æ·±å…¥å‰–æ"><a href="#2-3-æ·±å…¥å‰–æ" class="headerlink" title="2.3 æ·±å…¥å‰–æ"></a>2.3 æ·±å…¥å‰–æ</h3><p>æœªå®Œå¾…ç»­â€¦</p><h4 id="ï¼ˆ1ï¼‰-ç³»ç»Ÿæ¨¡å‹"><a href="#ï¼ˆ1ï¼‰-ç³»ç»Ÿæ¨¡å‹" class="headerlink" title="ï¼ˆ1ï¼‰ ç³»ç»Ÿæ¨¡å‹"></a>ï¼ˆ1ï¼‰ ç³»ç»Ÿæ¨¡å‹</h4><h4 id="ï¼ˆ2ï¼‰-é—®é¢˜æè¿°"><a href="#ï¼ˆ2ï¼‰-é—®é¢˜æè¿°" class="headerlink" title="ï¼ˆ2ï¼‰ é—®é¢˜æè¿°"></a>ï¼ˆ2ï¼‰ é—®é¢˜æè¿°</h4><h4 id="ï¼ˆ3ï¼‰-ç®—æ³•æè¿°"><a href="#ï¼ˆ3ï¼‰-ç®—æ³•æè¿°" class="headerlink" title="ï¼ˆ3ï¼‰ ç®—æ³•æè¿°"></a>ï¼ˆ3ï¼‰ ç®—æ³•æè¿°</h4><h4 id="ï¼ˆ4ï¼‰-è¿è¡Œåˆ†æ"><a href="#ï¼ˆ4ï¼‰-è¿è¡Œåˆ†æ" class="headerlink" title="ï¼ˆ4ï¼‰ è¿è¡Œåˆ†æ"></a>ï¼ˆ4ï¼‰ è¿è¡Œåˆ†æ</h4><h3 id="2-4-ZABä¸Paxosç®—æ³•çš„å¼‚åŒ"><a href="#2-4-ZABä¸Paxosç®—æ³•çš„å¼‚åŒ" class="headerlink" title="2.4 ZABä¸Paxosç®—æ³•çš„å¼‚åŒ"></a>2.4 ZABä¸Paxosç®—æ³•çš„å¼‚åŒ</h3><ul><li>äºŒè€…éƒ½å­˜åœ¨ä¸€ä¸ªLeaderè¿›ç¨‹è§’è‰²ï¼Œè´Ÿè´£åè°ƒå¤šä¸ªFollowerè¿›ç¨‹çš„è¿è¡Œã€‚</li><li><p>Leaderè¿›ç¨‹éƒ½ä¼šç­‰å¾…è¶…è¿‡åŠæ•°çš„Followerè¿›ç¨‹æ­£ç¡®åé¦ˆåï¼Œæ‰ä¼šå°†ææ¡ˆæäº¤ã€‚</p></li><li><p>ZABåè®®ä¸­æ ‡è¯†Leaderå‘¨æœŸçš„epochå€¼ï¼ŒPaxosç®—æ³•ä¸­å«Ballotã€‚</p></li></ul><p>äºŒè€…çš„æœ¬è´¨åŒºåˆ«åœ¨äºè®¾è®¡ç›®æ ‡ä¸åŒï¼ŒZABåè®®ç”¨äºæ„å»ºä¸€ä¸ªé«˜å¯ç”¨çš„åˆ†å¸ƒå¼æ•°æ®ä¸»å¤‡ç³»ç»Ÿï¼Œè€ŒPaxosç®—æ³•åˆ™ç”¨äºæ„å»ºä¸€ä¸ªåˆ†å¸ƒå¼çš„ä¸€è‡´æ€§çŠ¶æ€æœºç³»ç»Ÿã€‚</p><h2 id="ä¸‰-ç®€å•ä½¿ç”¨"><a href="#ä¸‰-ç®€å•ä½¿ç”¨" class="headerlink" title="ä¸‰. ç®€å•ä½¿ç”¨"></a>ä¸‰. ç®€å•ä½¿ç”¨</h2><h3 id="3-1-éƒ¨ç½²ä¸è¿è¡Œ"><a href="#3-1-éƒ¨ç½²ä¸è¿è¡Œ" class="headerlink" title="3.1 éƒ¨ç½²ä¸è¿è¡Œ"></a>3.1 éƒ¨ç½²ä¸è¿è¡Œ</h3><p>ZooKeeperä½¿ç”¨Javaè¯­è¨€ç¼–å†™ï¼Œæ‰€ä»¥éœ€è¦1.6ä»¥ä¸Šç‰ˆæœ¬çš„Javaç¯å¢ƒã€‚ZooKeeperåŒ…å«é›†ç¾¤å’Œå•æœºä¸¤ç§è¿è¡Œæ¨¡å¼ã€‚</p><h4 id="ï¼ˆ1ï¼‰éƒ¨ç½²"><a href="#ï¼ˆ1ï¼‰éƒ¨ç½²" class="headerlink" title="ï¼ˆ1ï¼‰éƒ¨ç½²"></a>ï¼ˆ1ï¼‰éƒ¨ç½²</h4><ol><li><p>ä¸‹è½½å®‰è£…åŒ…å¹¶è§£å‹ï¼š<code>http:zookeeper.apache.org/releases.html</code></p></li><li><p>é…ç½®æ–‡ä»¶ <code>zoo.cfg</code> ï¼š</p><p><code>%ZK_HOME%/conf</code> ç›®å½•ä¸‹ <code>zoo_sample.cfg</code> é‡å‘½åä¸º <code>zoo.cfg</code> </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tickTime=2000</span></span><br><span class="line"><span class="string">dataDir=/var/lib/zookeeper/</span></span><br><span class="line"><span class="string">clientPort=2181</span></span><br><span class="line"><span class="string">initLimit=5</span></span><br><span class="line"><span class="string">syncLimit=2</span></span><br><span class="line"><span class="comment"># server.id=host:port:port ç”¨æ¥æ„ŸçŸ¥é›†ç¾¤ç”±å“ªäº›æœºå™¨æ„æˆï¼Œidè¡¨ç¤ºæœºå™¨åºå·ï¼ŒdataDirç›®å½•ä¸‹éœ€è¦æœ‰ä¸€ä¸ªmyidæ–‡ä»¶ï¼Œå†…å®¹ä¸ºä¸€ä¸ªæ•°å­—å¯¹åº”æ­¤id</span></span><br><span class="line"><span class="string">server.1=&lt;IP1&gt;:2888:3888</span></span><br><span class="line"><span class="string">server.2=&lt;IP2&gt;:2888:3888</span></span><br><span class="line"><span class="string">server.3=&lt;IP3&gt;:2888:3888</span></span><br></pre></td></tr></table></figure><ul><li>é›†ç¾¤æ¨¡å¼ä¸‹æ‰€æœ‰cfgæ–‡ä»¶éƒ½åº”æ˜¯ä¸€è‡´çš„ï¼Œæœ€å¥½ä½¿ç”¨ä»£ç ä»“åº“ç®¡ç†èµ·æ¥ã€‚</li><li>idå–å€¼èŒƒå›´ä¸º ï¼š1~255ã€‚</li></ul></li><li><p>åˆ›å»º <code>myid</code> æ–‡ä»¶ï¼Œåœ¨dataDiræŒ‡å®šç›®å½•ä¸‹ï¼Œå†…å®¹ä¸ºæ•°å­—id</p></li><li><p>ä¸ºæ‰€æœ‰æœºå™¨é…ç½®2å’Œ3æ­¥å†…å®¹</p></li><li><p>å¯åŠ¨æœåŠ¡å™¨ï¼šä½¿ç”¨ <code>%ZK_HOME%/bin</code> ç›®å½•ä¸‹çš„ <code>zkServer.sh</code> è„šæœ¬å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sh zkServer.sh start</span></span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: /opt/zookeeper-3.4.3/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯æœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> telnet 127.0.0.1 2181</span></span><br><span class="line">stat</span><br></pre></td></tr></table></figure></li></ol><p>å•æœºæ¨¡å¼ä¸é›†ç¾¤æ¨¡å¼åªæ˜¯åœ¨ <code>zoo.cfg</code> çš„é…ç½®ä¸Šæœ‰äº›å·®å¼‚ï¼Œ<code>server.id</code> åªæœ‰ä¸€é¡¹ <code>server.1</code> ã€‚</p><h4 id="ï¼ˆ2ï¼‰è¿è¡Œå’Œåœæ­¢"><a href="#ï¼ˆ2ï¼‰è¿è¡Œå’Œåœæ­¢" class="headerlink" title="ï¼ˆ2ï¼‰è¿è¡Œå’Œåœæ­¢"></a>ï¼ˆ2ï¼‰è¿è¡Œå’Œåœæ­¢</h4><p>å¯åŠ¨æœåŠ¡ï¼š</p><ul><li>Javaå‘½ä»¤è¡Œï¼šåœ¨ <code>%ZK_HOME%</code> ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ <code>java -cp zookeeper -3.4.3 jar:lib/ slf4j-api-1.6. 1. jar:lib/slf4j- log4j12-1.6.1.jar:lib/log4j-1.2.15.jar:conf org. apache. zookeeper. server.quorum.QuorumPeerMain conf/zoo.cfg</code> æ³¨æ„log4jå’Œslf4jç‰ˆæœ¬</li><li>è‡ªå¸¦çš„å¯åŠ¨è„šæœ¬</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200114.png" alt></p><p>åœæ­¢æœåŠ¡ï¼š<code>sh zkServer.sh stop</code></p><h4 id="ï¼ˆ3ï¼‰å¸¸è§å¼‚å¸¸"><a href="#ï¼ˆ3ï¼‰å¸¸è§å¼‚å¸¸" class="headerlink" title="ï¼ˆ3ï¼‰å¸¸è§å¼‚å¸¸"></a>ï¼ˆ3ï¼‰å¸¸è§å¼‚å¸¸</h4><ul><li><strong>ç«¯å£è¢«å ç”¨ï¼š</strong><code>java.net.BindException: Address already in use</code> å¼‚å¸¸æ˜¯å› ä¸º2181ç«¯å£è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œå…³é—­å¯¹åº”è¿›ç¨‹å¹¶é‡å¯ZKå³å¯ã€‚</li><li><strong>ç£ç›˜æ²¡æœ‰å‰©ä½™ç©ºé—´ï¼š</strong><code>java.io.IOException: No space left on device</code> é‡åˆ°æ­¤å¼‚å¸¸ï¼ŒZKä¼šç«‹å³æ‰§è¡ŒFailoverç­–ç•¥ï¼Œä»è€Œé€€å‡ºè¿›ç¨‹ã€‚æ¸…ç†ç£ç›˜ç©ºé—´ï¼Œä¸ºäº†é¿å…åç»­å†æ¬¡é‡åˆ°æ­¤é—®é¢˜ï¼Œæœ€å¥½åŠ ä¸Šå¯¹ZKæœåŠ¡å™¨ç£ç›˜ä½¿ç”¨çš„ç›‘æ§å’ŒZKæ—¥å¿—çš„è‡ªåŠ¨æ¸…ç†ã€‚</li><li><strong>æ— æ³•æ‰¾åˆ° <code>myid</code> æ–‡ä»¶ï¼š</strong>ç¼ºå°‘æ­¤æ–‡ä»¶ï¼Œåˆ›å»ºå³å¯ã€‚</li><li><strong>é›†ç¾¤ä¸­å…¶ä»–æœºå™¨Leaderé€‰ä¸¾ç«¯å£æœªå¼€ï¼š</strong> <code>Cannot open channel to 2 at election adress /xx.xx.xx.xx:3888</code> è¿™æ˜¯ç”±äºå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å½“å‰æœºå™¨å¯åŠ¨äº†ï¼Œä½†å…¶ä»–æœºå™¨è¿˜æœªå¯åŠ¨å®Œã€‚ZKä½¿ç”¨3888ç«¯å£è¿›è¡ŒLeaderé€‰ä¸¾è¿‡ç¨‹çš„æŠ•ç¥¨é€šä¿¡ã€‚</li></ul><h3 id="3-2-å®¢æˆ·ç«¯è„šæœ¬"><a href="#3-2-å®¢æˆ·ç«¯è„šæœ¬" class="headerlink" title="3.2 å®¢æˆ·ç«¯è„šæœ¬"></a>3.2 å®¢æˆ·ç«¯è„šæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥binç›®å½•ï¼Œç¡®è®¤æ˜¯å¦è¿æ¥ä¸ŠZKæœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sh zkCli.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿æ¥æŒ‡å®šZKæœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sh zkCli.sh -server ip:port</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºä¸€ä¸ªZKèŠ‚ç‚¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sæˆ–eåˆ†åˆ«æŒ‡å®šèŠ‚ç‚¹ç‰¹æ€§é¡ºåºæˆ–ä¸´æ—¶èŠ‚ç‚¹ï¼Œä¸åŠ åˆ™é»˜è®¤ä¸ºæŒä¹…èŠ‚ç‚¹ï¼›aclè¿›è¡Œæƒé™æ§åˆ¶ï¼Œé»˜è®¤ä¸åŠ æ§åˆ¶</span></span><br><span class="line">create [-s] [-e] path data acl</span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨æ ¹èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªå«/zk-bookçš„èŠ‚ç‚¹ï¼Œå†…å®¹ä¸º123</span></span><br><span class="line">create /zk-book 123</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¯»å–</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lsåˆ—å‡ºZKæŒ‡å®šèŠ‚ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">ls path [watch]</span><br><span class="line">ls /</span><br><span class="line"><span class="meta">#</span><span class="bash"> getå‘½ä»¤è·å–æŒ‡å®šèŠ‚ç‚¹çš„æ•°æ®å†…å®¹å’Œå±æ€§ä¿¡æ¯</span></span><br><span class="line">get path [watch]</span><br><span class="line">get /zk-book</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ–°</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ–°æŒ‡å®šèŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼Œversionå‚æ•°æŒ‡å®šæœ¬æ¬¡æ›´æ–°åŸºäºZNodeå“ªä¸ªæ•°æ®ç‰ˆæœ¬è¿›è¡Œ</span></span><br><span class="line">set path data [version]</span><br><span class="line">set /zk-book 456</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤ï¼Œè¦åˆ é™¤èŠ‚ç‚¹ï¼Œå…¶ä¸èƒ½åŒ…å«å­èŠ‚ç‚¹</span></span><br><span class="line">delete path [version]</span><br></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹æ¥è‡ªã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šæ¦‚è¿°ï¼ŒZABåè®®ï¼Œç®€å•ä½¿ç”¨ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="zookeeper" scheme="http://linyishui.top/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <link href="http://linyishui.top/2021042101.html"/>
    <id>http://linyishui.top/2021042101.html</id>
    <published>2021-04-21T13:27:05.000Z</published>
    <updated>2021-05-13T08:27:02.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h1><h2 id="ä¸€-ä»ACIDåˆ°CAP-BASE"><a href="#ä¸€-ä»ACIDåˆ°CAP-BASE" class="headerlink" title="ä¸€. ä»ACIDåˆ°CAP/BASE"></a>ä¸€. ä»ACIDåˆ°CAP/BASE</h2><h3 id="1-1-ACID"><a href="#1-1-ACID" class="headerlink" title="1.1 ACID"></a>1.1 ACID</h3><p>æ•°æ®åº“äº‹åŠ¡å’ŒACIDå¯ä»¥å‚çœ‹ï¼š<a href="2020120801.html">ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸€ï¼‰æ¶æ„å’Œå†å²</a> ä¸­äº‹åŠ¡ç« èŠ‚ã€‚</p><h3 id="1-2-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#1-2-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="1.2 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"></a>1.2 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>åˆ†å¸ƒå¼æ•°æ®åº“ä¸­ï¼Œæ•°æ®åˆ†æ•£åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸­äº‹åŠ¡çš„å‚ä¸è€…ã€æ”¯æŒäº‹åŠ¡çš„æœåŠ¡å™¨ã€èµ„æºæœåŠ¡å™¨ä»¥åŠäº‹åŠ¡ç®¡ç†å™¨å¯èƒ½åˆ†åˆ«ä½äºä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚</p><p>æ€è€ƒå¦‚ä½•å®ç°åˆ†å¸ƒå¼çš„äº‹åŠ¡å¤„ç†ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬è¦æŠŠåˆ†å¸ƒå¼äº‹åŠ¡çœ‹ä½œä¸€ç»„åˆ†å¸ƒå¼çš„æ“ä½œåºåˆ—ï¼Œå³ä¸€ç»„å­äº‹åŠ¡ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿå…·æœ‰ACIDçš„äº‹åŠ¡ç‰¹æ€§ã€‚</p><p>å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¿è¯æ•°æ®çš„ä¸¥æ ¼ä¸€è‡´æ€§æ—¶å¿…ç„¶è¦ç‰ºç‰²æ‰éƒ¨åˆ†ç³»ç»Ÿå¯ç”¨æ€§ã€‚</p><h3 id="1-3-CAP"><a href="#1-3-CAP" class="headerlink" title="1.3 CAP"></a>1.3 CAP</h3><p>CAPç†è®ºï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³<strong>ä¸€è‡´æ€§</strong>ï¼ˆConsistencyï¼‰ã€<strong>å¯ç”¨æ€§</strong>ï¼ˆAvailabilityï¼‰å’Œ<strong>åˆ†åŒºå®¹é”™æ€§</strong>ï¼ˆPartition toleranceï¼‰ï¼Œæœ€å¤šåŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚</p><ul><li>ä¸€è‡´æ€§ï¼šåˆ†å¸ƒå¼ä¸­æŒ‡æ•°æ®åœ¨å¤šä¸ªå‰¯æœ¬é—´èƒ½å¦ä¿æŒä¸€è‡´ã€‚å¯¹ä¸€ä¸ªæ•°æ®æ›´æ–°ä¸”æ‰§è¡ŒæˆåŠŸåï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½è¦èƒ½è¯»åˆ°æœ€æ–°çš„å€¼ã€‚</li><li>å¯ç”¨æ€§ï¼šç³»ç»ŸæœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œç”¨æˆ·çš„æ¯ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½åœ¨<strong>æœ‰é™çš„æ—¶é—´</strong>å†…<strong>è¿”å›ç»“æœ</strong>ã€‚ç³»ç»Ÿå­˜åœ¨ä¸€ä¸ªåˆç†çš„å“åº”æ—¶é—´ï¼Œå¦åˆ™å°±ä¼šä½¿ç”¨æˆ·å¯¹ç³»ç»Ÿå¤±æœ›ã€‚</li><li>åˆ†åŒºå®¹é”™æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœæ—¶ï¼Œä»è¦ä¿è¯å¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200102.png" alt></p><p>å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå› ä¸ºåˆ†å¸ƒå¼å¿…ç„¶è¦æŠŠç»„ä»¶éƒ¨ç½²åˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼Œç½‘ç»œé—®é¢˜å¿…å®šä¼šå‡ºç°ï¼Œæ‰€ä»¥æ¶æ„è®¾è®¡å¸ˆå¾€å¾€éœ€è¦æŠŠç²¾åŠ›èŠ±åœ¨å¦‚ä½•æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´å¯»æ±‚å¹³è¡¡ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200101.png" alt></p><h3 id="1-4-BASEç†è®º"><a href="#1-4-BASEç†è®º" class="headerlink" title="1.4 BASEç†è®º"></a>1.4 BASEç†è®º</h3><p>BASE æ˜¯ <strong>Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ï¼ŒSoft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’Œ Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</strong>ï¼Œæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆStrong consistencyï¼‰ï¼Œæ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹é‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual consistencyï¼‰ã€‚</p><p><strong>åŸºæœ¬å¯ç”¨</strong>ï¼ŒæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥çš„æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä½†è¿™ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ï¼š</p><ul><li><strong>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±</strong>ï¼šå¦‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæœç´¢å¼•æ“è¦åœ¨0.5ç§’å†…è¿”å›ç»™ç”¨æˆ·æŸ¥è¯¢ç»“æœï¼Œä½†ç”±äºæ•…éšœå¯¼è‡´å“åº”æ—¶é—´å¢åŠ åˆ°1åˆ°2ç§’ã€‚</li><li><strong>åŠŸèƒ½ä¸Šçš„æŸå¤±</strong>ï¼šå¦‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…èƒ½åœ¨å•†åŸå¹³å°é¡ºåˆ©å®Œæˆæ¯ä¸€ç¬”è®¢å•ï¼Œä½†åœ¨ä¸€äº›èŠ‚æ—¥è´­ç‰©é«˜å³°ä¸ºäº†ä¿è¯ç³»ç»Ÿç¨³å®šï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½è¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ã€‚</li></ul><p><strong>å¼±çŠ¶æ€</strong>ï¼šä¹Ÿå«è½¯çŠ¶æ€ï¼ŒæŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸å½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å‡ºç°å»¶æ—¶ã€‚</p><p><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚æœ€ç»ˆä¸€è‡´æ€§çš„5ç§å˜ç§ï¼š</p><ul><li><strong>å› æœä¸€è‡´æ€§ï¼ˆCausial consistencyï¼‰ï¼š</strong>è¿›ç¨‹Aåœ¨æ›´æ–°å®ŒæŸä¸ªæ•°æ®åé€šçŸ¥äº†è¿›ç¨‹Bï¼Œè¿›ç¨‹Bèƒ½è¯»å–åˆ°Aæ›´æ–°åçš„æœ€æ–°å€¼ï¼Œå¦‚æœBè¦å¯¹æ•°æ®è¿›è¡Œæ›´æ–°è¦åŸºäºæ­¤æœ€æ–°å€¼ï¼Œå³ä¸èƒ½å‘ç”Ÿä¸¢å¤±æ›´æ–°çš„æƒ…å†µï¼›è€Œä¸æ­¤æ— å…³çš„è¿›ç¨‹Cæ— æ­¤é™åˆ¶ã€‚</li><li><strong>è¯»å·±ä¹‹æ‰€å†™ï¼ˆRead your writesï¼‰ï¼š</strong>è¿›ç¨‹Aæ›´æ–°ä¸€ä¸ªæ•°æ®åï¼Œè‡ªå·±æ€»èƒ½è®¿é—®æ›´æ–°åçš„æœ€æ–°å€¼ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å› æœä¸€è‡´æ€§ã€‚</li><li><strong>ä¼šè¯ä¸€è‡´æ€§ï¼ˆSession consistencyï¼‰ï¼š</strong>ç³»ç»Ÿä¿è¯åœ¨åŒä¸€ä¸ªæœ‰æ•ˆçš„ä¼šè¯ä¸­å®ç°è¯»å·±ä¹‹æ‰€å†™çš„ä¸€è‡´æ€§ã€‚</li><li><strong>å•è°ƒè¯»ä¸€è‡´æ€§ï¼ˆMonotonic read consistencyï¼‰ï¼š</strong>å¦‚æœä¸€ä¸ªè¿›ç¨‹ä»ç³»ç»Ÿä¸­è¯»å‡ºä¸€ä¸ªæ•°æ®åï¼Œç³»ç»Ÿå¯¹äºè¯¥è¿›ç¨‹åç»­çš„ä»»ä½•æ•°æ®è®¿é—®éƒ½ä¸åº”è¯¥è¿”å›æ›´æ—§çš„å€¼ã€‚</li><li><strong>å•è°ƒå†™ä¸€è‡´æ€§ï¼ˆMonotonic write consistencyï¼‰ï¼š</strong>ç³»ç»Ÿä¿è¯æ¥è‡ªåŒä¸€ä¸ªè¿›ç¨‹çš„å†™æ“ä½œè¢«é¡ºåºçš„æ‰§è¡Œã€‚</li></ul><p>ç°ä»£çš„å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå¾€å¾€ä¼šé‡‡ç”¨åŒæ­¥å’Œä¸€æ­¥çš„æ–¹å¼æ¥å®ç°ä¸»å¤‡æ•°æ®å¤åˆ¶æŠ€æœ¯ï¼š</p><ul><li>åŒæ­¥æ–¹å¼ï¼šæ•°æ®çš„å¤åˆ¶è¿‡ç¨‹é€šå¸¸æ˜¯æ›´æ–°äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤åœ¨äº‹åŠ¡å®Œæˆåï¼Œä¸»å¤‡æ•°æ®åº“çš„æ•°æ®å°±ä¼šè¾¾åˆ°ä¸€è‡´ã€‚</li><li>å¼‚æ­¥æ–¹å¼ï¼šå¤‡åº“çš„æ›´æ–°å¾€å¾€å­˜åœ¨å»¶æ—¶ï¼Œå–å†³äºäº‹åŠ¡æ—¥å¿—åœ¨ä¸»å¤‡æ•°æ®åº“ä¹‹é—´ä¼ è¾“çš„æ—¶é—´é•¿çŸ­ï¼Œå¦‚æœæ—¶é—´è¿‡ä¹…æˆ–ä¼ è¾“ä¸­å‡ºç°å¼‚å¸¸å¯¼è‡´æ— æ³•åŠæ—¶å°†äº‹åŠ¡åº”ç”¨åˆ°å¤‡åº“ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul><p>BASEç†è®ºä¸åŒäºä¼ ç»Ÿäº‹åŠ¡ACIDçš„å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œæå‡ºç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…ä¸ä¸€è‡´ï¼Œä½†æœ€ç»ˆè¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€ã€‚</p><h2 id="äºŒ-ä¸€è‡´æ€§åè®®"><a href="#äºŒ-ä¸€è‡´æ€§åè®®" class="headerlink" title="äºŒ. ä¸€è‡´æ€§åè®®"></a>äºŒ. ä¸€è‡´æ€§åè®®</h2><p>æœ‰å¾ˆå¤šçš„ç»å…¸çš„ä¸€è‡´æ€§åè®®å’Œç®—æ³•æ¥è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ï¼Œæœ€è‘—åçš„æœ‰<strong>äºŒé˜¶æ®µæäº¤åè®®</strong>ã€<strong>ä¸‰é˜¶æ®µæäº¤åè®®</strong>å’Œ<strong>Paxosç®—æ³•</strong>ã€‚</p><h3 id="2-1-äºŒé˜¶æ®µæäº¤-2PC"><a href="#2-1-äºŒé˜¶æ®µæäº¤-2PC" class="headerlink" title="2.1 äºŒé˜¶æ®µæäº¤-2PC"></a>2.1 äºŒé˜¶æ®µæäº¤-2PC</h3><p>2PCï¼Œå³äºŒé˜¶æ®µæäº¤ï¼ŒTwo-Phase Commit çš„ç¼©å†™ï¼Œä¸ºäº†ä½¿åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹æ‰€æœ‰çš„èŠ‚ç‚¹åœ¨è¿›è¡Œäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­èƒ½ä¿æŒ<strong>åŸå­æ€§</strong>å’Œ<strong>ä¸€è‡´æ€§</strong>è€Œè®¾è®¡çš„ç®—æ³•ã€‚ç›®å‰å¤§éƒ¨åˆ†å…³ç³»å‹æ•°æ®åº“éƒ½é‡‡ç”¨2PCæ¥å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ã€‚</p><p>æ‰§è¡Œæµç¨‹ï¼š</p><ul><li><strong>é˜¶æ®µä¸€ï¼šæäº¤äº‹åŠ¡è¯·æ±‚</strong>ï¼ˆä¹Ÿå«æŠ•ç¥¨é˜¶æ®µï¼‰<ol><li><strong>äº‹åŠ¡è¯¢é—®ï¼š</strong>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œç­‰å¾…å„å‚ä¸è€…å“åº”ã€‚</li><li><strong>æ‰§è¡Œäº‹åŠ¡ï¼š</strong>å„å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°† <code>Undo</code> å’Œ <code>Redo</code> ä¿¡æ¯è®°å…¥äº‹åŠ¡æ—¥å¿—ã€‚</li><li><strong>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº”ï¼š</strong>å‚ä¸è€…æˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œåé¦ˆç»™åè°ƒè€…Yeså“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡å¯ä»¥æ‰§è¡Œï¼›è‹¥æœªæ‰§è¡ŒæˆåŠŸï¼Œåé¦ˆNoã€‚</li></ol></li><li><strong>é˜¶æ®µäºŒï¼šæ‰§è¡Œäº‹åŠ¡æäº¤</strong>ï¼ˆæ‰€æœ‰å‚ä¸è€…éƒ½åé¦ˆYesï¼Œè¿›è¡Œé˜¶æ®µäºŒï¼‰<ol><li><strong>å‘é€æäº¤è¯·æ±‚ï¼š</strong>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡º <code>Commit</code> è¯·æ±‚ã€‚</li><li><strong>äº‹åŠ¡æäº¤ï¼š</strong>å‚ä¸è€…æ”¶åˆ° <code>Commit</code> è¯·æ±‚ï¼Œæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œåœ¨å®Œæˆæäº¤åé‡Šæ”¾äº‹åŠ¡èµ„æºã€‚</li><li><strong>åé¦ˆäº‹åŠ¡æäº¤ç»“æœï¼š</strong>å‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åï¼Œå‘åè°ƒè€…å‘é€ <code>Ack</code> æ¶ˆæ¯ã€‚</li><li><strong>å®Œæˆäº‹åŠ¡ï¼š</strong>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„ <code>Ack</code> æ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ã€‚</li></ol></li><li><strong>ä¸­æ–­äº‹åŠ¡ï¼š</strong>å½“æŸä¸ªå‚ä¸è€…åé¦ˆäº†Noå“åº”ã€æˆ–ç­‰å¾…æ¥æ”¶æ‰€æœ‰å‚ä¸è€…åé¦ˆè¶…æ—¶ä¹‹åï¼Œæ‰§è¡Œä¸­æ–­äº‹åŠ¡<ol><li><strong>å‘é€å›æ»šè¯·æ±‚ï¼š</strong>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡º <code>Rollback</code> è¯·æ±‚ã€‚</li><li><strong>äº‹åŠ¡å›æ»šï¼š</strong>å‚ä¸è€…æ¥æ”¶åˆ° <code>Rollback</code> è¯·æ±‚åï¼Œåˆ©ç”¨å…¶åœ¨é˜¶æ®µä¸€ä¸­è®°å½•çš„ <code>Undo</code> ä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›æ»šæ“ä½œï¼Œå¹¶é‡Šæ”¾äº‹åŠ¡å ç”¨èµ„æºã€‚</li><li><strong>åé¦ˆäº‹åŠ¡å›æ»šç»“æœï¼š</strong>å‚ä¸è€…å®Œæˆå›æ»šåï¼Œå‘åè°ƒè€…å‘é€ <code>Ack</code> æ¶ˆæ¯ã€‚</li><li><strong>ä¸­æ–­äº‹åŠ¡ï¼š</strong>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ <code>Ack</code> æ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ä¸­æ–­ã€‚</li></ol></li></ul><p>2PCçš„æ ¸å¿ƒæ˜¯æ¯ä¸ªäº‹åŠ¡éƒ½é‡‡ç”¨<strong>å…ˆå°è¯•åæäº¤</strong>çš„å¤„ç†æ–¹å¼ï¼Œå¯ä»¥çœ‹ä½œä¸€ä¸ªå¼ºä¸€è‡´æ€§ç®—æ³•ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200104.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200105.png" alt></p><p>ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šåŸç†ç®€å•ï¼Œå®ç°æ–¹ä¾¿ã€‚</li><li>ç¼ºç‚¹ï¼šåŒæ­¥é˜»å¡ã€å•ç‚¹é—®é¢˜ã€è„‘è£‚ã€å¤ªè¿‡ä¿å®ˆ<ul><li><strong>åŒæ­¥é˜»å¡ï¼š</strong>åœ¨äºŒé˜¶æ®µçš„æäº¤è¿‡ç¨‹ï¼Œæ‰€æœ‰å‚ä¸è¯¥äº‹åŠ¡æ“ä½œçš„é€»è¾‘éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œå„ä¸ªå‚ä¸è€…åœ¨ç­‰å¾…å…¶ä»–å‚ä¸è€…å“åº”çš„è¿‡ç¨‹æ— æ³•è¿›è¡Œå…¶ä»–æ“ä½œã€‚</li><li><strong>å•ç‚¹é—®é¢˜ï¼š</strong>åè°ƒè€…å¤ªè¿‡é‡è¦ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜æ•´ä¸ªæµç¨‹å°±æ— æ³•è¿ä½œï¼Œå¦‚æœæ˜¯åœ¨é˜¶æ®µäºŒå‡ºç°é—®é¢˜ï¼Œæ›´ä¼šå¯¼è‡´å‚ä¸è€…éƒ½å¤„äºé”å®šäº‹åŠ¡èµ„æºçš„çŠ¶æ€ã€‚</li><li><strong>æ•°æ®ä¸ä¸€è‡´ï¼š</strong>åœ¨é˜¶æ®µäºŒæ‰§è¡Œäº‹åŠ¡æäº¤æ—¶ï¼Œå½“åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘ç”ŸCommitè¯·æ±‚åï¼Œå‘ç”Ÿå±€éƒ¨ç½‘ç»œå¼‚å¸¸æˆ–æ˜¯åè°ƒè€…è‡ªèº«æœªå‘é€å®Œå³å´©æºƒï¼Œå¯¼è‡´åªæœ‰éƒ¨åˆ†å‚ä¸è€…æ”¶åˆ°äº†Commitè¯·æ±‚ã€‚æ”¶åˆ°çš„æäº¤äº‹åŠ¡ï¼Œæœªæ”¶åˆ°çš„æ— æ³•æäº¤ï¼Œå‡ºç°æ•°æ®ä¸ä¸€è‡´ç°è±¡ã€‚</li><li><strong>å¤ªè¿‡ä¿å®ˆï¼š</strong>å‚ä¸è€…å‡ºç°æ•…éšœè€Œå¯¼è‡´åè°ƒè€…å§‹ç»ˆæ— æ³•è·å–åˆ°æ‰€æœ‰å“åº”ï¼Œæ­¤æ—¶åªèƒ½ä¾é åè°ƒè€…è‡ªèº«çš„è¶…æ—¶æœºåˆ¶æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­æ–­äº‹åŠ¡ï¼Œæ˜¾å¾—è¿‡äºä¿å®ˆï¼Œæ²¡æœ‰å®Œå–„çš„å®¹é”™æœºåˆ¶ï¼Œå¯¼è‡´ä¸€ä¸ªèŠ‚ç‚¹çš„å¤±è´¥å¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥ã€‚</li></ul></li></ul><h3 id="2-2-ä¸‰é˜¶æ®µæäº¤-3PC"><a href="#2-2-ä¸‰é˜¶æ®µæäº¤-3PC" class="headerlink" title="2.2 ä¸‰é˜¶æ®µæäº¤-3PC"></a>2.2 ä¸‰é˜¶æ®µæäº¤-3PC</h3><p>3PCï¼Œå³ä¸‰é˜¶æ®µæäº¤ï¼ŒThree-Phase Commitçš„ç¼©å†™ï¼Œé’ˆå¯¹2PCçš„ç¼ºé™·è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå°†2PCçš„æäº¤äº‹åŠ¡è¯·æ±‚è¿‡ç¨‹ä¸€åˆ†ä¸º2ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200106.png" alt></p><p>æ‰§è¡Œé˜¶æ®µï¼š</p><ul><li><strong>é˜¶æ®µä¸€ï¼šCanCommit</strong><ol><li><strong>äº‹åŠ¡è¯¢é—®ï¼š</strong>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ä¸€ä¸ªåŒ…å«äº‹åŠ¡å†…å®¹çš„ <code>canCommit</code> è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸è€…å“åº”ã€‚</li><li><strong>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº”ï¼š</strong>å‚ä¸è€…æ¥æ”¶åˆ° <code>canCommit</code> è¯·æ±‚åï¼Œè‹¥åˆ¤æ–­è‡ªå·±å¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡åˆ™åé¦ˆYeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™åé¦ˆNoå“åº”ã€‚</li></ol></li><li><strong>é˜¶æ®µäºŒï¼šPreCommit</strong><ul><li><strong>æ‰§è¡Œäº‹åŠ¡é¢„æäº¤ï¼š</strong>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰Yesåé¦ˆ<ol><li><strong>å‘é€é¢„æäº¤è¯·æ±‚ï¼š</strong>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ä¸€ä¸ªåŒ…å«äº‹åŠ¡å†…å®¹çš„ <code>preCommit</code> è¯·æ±‚ï¼Œå¹¶è¿›å…¥ <code>Prepared</code> é˜¶æ®µã€‚</li><li><strong>äº‹åŠ¡é¢„æäº¤ï¼š</strong>å‚ä¸è€…æ¥æ”¶åˆ° <code>preCommit</code> è¯·æ±‚åï¼Œæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°† <code>Undo</code> å’Œ <code>Redo</code> ä¿¡æ¯è®°å…¥äº‹åŠ¡æ—¥å¿—ã€‚</li><li><strong>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡æ‰§è¡Œçš„å“åº”ï¼š</strong>å‚ä¸è€…æˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œåé¦ˆç»™åè°ƒè€… <code>Ack</code> å“åº”ï¼ŒåŒæ—¶ç­‰å¾…æœ€ç»ˆæŒ‡ä»¤ï¼ˆcommitæˆ–abortï¼‰ã€‚</li></ol></li><li><strong>ä¸­æ–­äº‹åŠ¡ï¼š</strong>ä»»æ„ä¸€ä¸ªå‚ä¸è€…åé¦ˆäº†Noå“åº”ã€æˆ–ç­‰å¾…è¶…æ—¶åä»æœªæ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆå“åº”<ol><li><strong>å‘é€ä¸­æ–­è¯·æ±‚ï¼š</strong>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ <code>abort</code> è¯·æ±‚ã€‚</li><li><strong>ä¸­æ–­äº‹åŠ¡ï¼š</strong>æ— è®ºæ˜¯æ”¶åˆ°åè°ƒè€…çš„ <code>abort</code> è¯·æ±‚ï¼Œæˆ–æ˜¯ç­‰å¾…åè°ƒè€…è¯·æ±‚è¶…æ—¶ï¼Œå‚ä¸è€…éƒ½ä¼šä¸­æ–­äº‹åŠ¡ã€‚</li></ol></li></ul></li><li><strong>é˜¶æ®µä¸‰ï¼šdoCommit</strong><ul><li><strong>æ‰§è¡Œæäº¤ï¼š</strong>åè°ƒè€…å¤„äºæ­£å¸¸çŠ¶æ€ï¼Œä¸”æ”¶åˆ°äº†æ‰€æœ‰å‚ä¸è€…çš„ <code>Ack</code> å“åº”<ol><li><strong>å‘é€æäº¤è¯·æ±‚ï¼š</strong>åè°ƒè€…å°†ä»é¢„æäº¤çŠ¶æ€è½¬æ¢ä¸ºæäº¤çŠ¶æ€ï¼Œå¹¶å‘æ‰€æœ‰å‚ä¸è€…å‘é€ <code>doCommit</code> è¯·æ±‚ã€‚</li><li><strong>äº‹åŠ¡æäº¤ï¼š</strong>å‚ä¸è€…æ”¶åˆ° <code>doCommit</code> è¯·æ±‚ï¼Œæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå®Œæˆæäº¤åé‡Šæ”¾äº‹åŠ¡èµ„æºã€‚</li><li><strong>åé¦ˆäº‹åŠ¡æäº¤ç»“æœï¼š</strong>å‚ä¸è€…å®Œæˆäº‹åŠ¡æäº¤åï¼Œå‘åè°ƒè€…å‘é€ <code>Ack</code> æ¶ˆæ¯ã€‚</li><li><strong>å®Œæˆäº‹åŠ¡ï¼š</strong>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„ <code>Ack</code> æ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ã€‚</li></ol></li><li><strong>ä¸­æ–­äº‹åŠ¡ï¼š</strong>åè°ƒè€…å¤„äºæ­£å¸¸çŠ¶æ€ï¼Œä¸”æœ‰ä»»ä¸€çš„å‚ä¸è€…åé¦ˆäº†Noå“åº”ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶åä»æœªæ”¶åˆ°æ‰€æœ‰å‚ä¸è€…å“åº”<ol><li><strong>å‘é€ä¸­æ–­è¯·æ±‚ï¼š</strong>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ <code>abort</code> è¯·æ±‚ã€‚</li><li><strong>äº‹åŠ¡å›æ»šï¼š</strong>å‚ä¸è€…æ¥æ”¶åˆ° <code>abort</code> è¯·æ±‚åï¼Œåˆ©ç”¨å…¶åœ¨é˜¶æ®µäºŒä¸­è®°å½•çš„ <code>Undo</code> ä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›æ»šæ“ä½œï¼Œå¹¶é‡Šæ”¾äº‹åŠ¡å ç”¨èµ„æºã€‚</li><li><strong>åé¦ˆäº‹åŠ¡å›æ»šç»“æœï¼š</strong>å‚ä¸è€…å®Œæˆå›æ»šåï¼Œå‘åè°ƒè€…å‘é€ <code>Ack</code> æ¶ˆæ¯ã€‚</li><li><strong>ä¸­æ–­äº‹åŠ¡ï¼š</strong>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ <code>Ack</code> æ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ä¸­æ–­ã€‚</li></ol></li></ul></li></ul><p>è¿›å…¥é˜¶æ®µä¸‰åå¯èƒ½ä¼šå‡ºç°ä¸¤ç§æ•…éšœï¼š</p><ul><li>åè°ƒè€…å‡ºç°é—®é¢˜</li><li>åè°ƒè€…å’Œå‚ä¸è€…ä¹‹é—´ç½‘ç»œå‡ºç°æ•…éšœ</li></ul><p>æœ€ç»ˆéƒ½ä¼šå¯¼è‡´å‚ä¸è€…æ— æ³•åŠæ—¶æ”¶åˆ° <code>doCommit</code> è¯·æ±‚æˆ– <code>abort</code> è¯·æ±‚ï¼Œè¿™æ—¶å‚ä¸è€…ä¼šåœ¨ç­‰å¾…è¶…æ—¶åç»§ç»­è¿›è¡Œäº‹åŠ¡æäº¤ã€‚</p><p>ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šç›¸è¾ƒ2PCé™ä½äº†å‚ä¸è€…çš„é˜»å¡èŒƒå›´ï¼Œèƒ½å¤Ÿåœ¨å‡ºç°å•ç‚¹æ•…éšœåè¾¾æˆä¸€è‡´ã€‚</li><li>ç¼ºç‚¹ï¼š3PCåœ¨å»é™¤é˜»å¡çš„åŒæ—¶ä¹Ÿå¸¦æ¥äº†æ–°é—®é¢˜ï¼Œå°±æ˜¯åœ¨å‚ä¸è€…æ”¶åˆ° <code>preCommit</code> è¯·æ±‚åï¼Œå¦‚æœç½‘ç»œå‡ºç°åˆ†åŒºï¼Œè¿™æ—¶åè°ƒè€…æ‰€åœ¨çš„èŠ‚ç‚¹å’Œå‚ä¸è€…æ— æ³•è¿›è¡Œæ­£å¸¸çš„ç½‘ç»œé€šä¿¡ï¼Œè¿™ä¸ªå‚ä¸è€…ä»ä¼šè¿›è¡Œäº‹åŠ¡çš„æäº¤ï¼Œå¯¼è‡´äº†æ•°æ®ä¸ä¸€è‡´æ€§ã€‚</li></ul><h3 id="2-3-Paxos-ç®—æ³•"><a href="#2-3-Paxos-ç®—æ³•" class="headerlink" title="2.3 Paxos ç®—æ³•"></a>2.3 Paxos ç®—æ³•</h3><p>Paxos ç®—æ³•ç”± Leslie Lamport äº1990å¹´æå‡ºçš„ä¸€ç§åŸºäºæ¶ˆæ¯ä¼ é€’ä¸”å…·æœ‰é«˜åº¦å®¹é”™ç‰¹æ€§çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œæ˜¯ç›®å‰å…¬è®¤çš„è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜çš„æœ€æœ‰æ•ˆç®—æ³•ä¹‹ä¸€ã€‚Paxos ç®—æ³•è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘ç”Ÿä»»ä½•çš„æœºå™¨å®•æœºæˆ–ç½‘ç»œå¼‚å¸¸ï¼Œéƒ½ä¸ä¼šç ´åæ•´ä¸ªç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚</p><p>Paxosç®—æ³•æ”¯æŒåˆ†å¸ƒå¼èŠ‚ç‚¹è§’è‰²ä¹‹é—´çš„è½®æ¢ï¼Œé¿å…äº†åˆ†å¸ƒå¼å•ç‚¹çš„å‡ºç°ï¼Œæ—¢è§£å†³äº†æ— é™æœŸç­‰å¾…é—®é¢˜ï¼Œä¹Ÿè§£å†³äº†è„‘è£‚é—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ‹œå åº­å°†å†›é—®é¢˜ï¼š</span><br><span class="line"></span><br><span class="line">æ‹œå åº­å¸å›½æœ‰å¤šæ”¯å†›é˜Ÿï¼Œä¸åŒå†›é˜Ÿçš„å°†å†›ä¹‹é—´éœ€è¦åˆ¶å®šä¸€ä¸ªç»Ÿä¸€çš„è¡ŒåŠ¨è®¡åˆ’ï¼Œä»è€Œåšå‡ºè¿›æ”»æˆ–æ’¤é€€çš„å†³å®šï¼Œå„ä¸ªå°†å†›åœ¨åœ°ç†ä¸Šè¢«åˆ†å‰²å¼€ï¼Œåªèƒ½ä¾é é€šè®¯å‘˜è¿›è¡Œè”ç»œã€‚é€šè®¯å‘˜ä¸­å¯èƒ½å­˜åœ¨å›å¾’ï¼Œå¯ä»¥ä»»æ„çš„ç¯¡æ”¹æ¶ˆæ¯ã€‚</span><br></pre></td></tr></table></figure><p>ç†è®ºä¸Šæ¥è¯´ï¼Œåœ¨å¼‚æ­¥ç³»ç»Ÿå’Œä¸å¯é é€šé“ä¸Šæ¥è¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€æ˜¯ä¸å¯èƒ½çš„ï¼Œå› æ­¤å¾€å¾€å‡è®¾ä¿¡é“æ˜¯å¯é çš„ã€‚ç°å®ä¸­ï¼Œå¤§éƒ¨åˆ†ç³»ç»Ÿéƒ½éƒ¨ç½²åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ï¼Œæ¶ˆæ¯è¢«ç¯¡æ”¹çš„æƒ…å†µæ¯”è¾ƒç½•è§ï¼›ç¡¬ä»¶æˆ–ç½‘ç»œåŸå› å¯¼è‡´çš„æ¶ˆæ¯ä¸å®Œæ•´é—®é¢˜ï¼Œåªéœ€ä¸€å¥—ç®€å•çš„æ ¡éªŒç®—æ³•å³å¯é¿å…ã€‚å› æ­¤å®é™…å·¥ç¨‹å®è·µä¸­ï¼Œå¯ä»¥å‡è®¾ä¸å­˜åœ¨æ‹œå åº­å°†å†›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ ·çš„ç®—æ³•æ¥ä¿è¯ä¸€è‡´æ€§ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¤å¸Œè…Šæœ‰ä¸€ä¸ªå« Paxos çš„å°å²›ï¼Œå²›ä¸Šé‡‡ç”¨è®®ä¼šçš„å½¢å¼æ¥é€šè¿‡æ³•ä»¤ï¼Œè®®å‘˜é—´é€šè¿‡ä¿¡ä½¿è¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’ï¼Œè®®å‘˜æˆ–ä¿¡ä½¿éƒ½æ˜¯å…¼èŒçš„ï¼Œéšæ—¶å¯èƒ½ç¦»å¼€è®®ä¼šå…ï¼Œä¿¡ä½¿å¯èƒ½ä¼šé‡å¤çš„ä¼ é€’æ¶ˆæ¯ï¼Œä¹Ÿå¯èƒ½ä¸€å»ä¸å›ã€‚è®®ä¼šåè®®è¦ä¿è¯åœ¨è¿™ç§æƒ…å†µä¸‹ä»èƒ½æ­£ç¡®çš„äº§ç”Ÿæ³•ä»¤ï¼Œå¹¶ä¸”ä¸å‡ºç°å†²çªã€‚</span><br></pre></td></tr></table></figure><p>Paxosç®—æ³•çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªä¸€è‡´æ€§ç®—æ³•ï¼Œå³ Lamport çš„è®ºæ–‡ The Part-Time Parliament ä¸­æåˆ°çš„ synod ç®—æ³•ã€‚</p><h4 id="2-3-1-é—®é¢˜æè¿°"><a href="#2-3-1-é—®é¢˜æè¿°" class="headerlink" title="2.3.1 é—®é¢˜æè¿°"></a>2.3.1 é—®é¢˜æè¿°</h4><p>å¯¹äºä¸€ä¸ªä¸€è‡´æ€§ç®—æ³•æ¥è¯´è¦ä¿è¯å‡ ç‚¹ï¼š</p><ul><li>åœ¨è¿™äº›è¢«æå‡ºçš„ææ¡ˆä¸­ï¼Œåªæœ‰ä¸€ä¸ªä¼šè¢«é€‰å®šã€‚</li><li>å¦‚æœæ²¡æœ‰ææ¡ˆè¢«æå‡ºï¼Œå°±ä¸ä¼šæœ‰è¢«é€‰å®šçš„ææ¡ˆã€‚</li><li>å½“ä¸€ä¸ªææ¡ˆè¢«é€‰å®šåï¼Œè¿›ç¨‹åº”è¯¥å¯ä»¥è·å–è¢«é€‰å®šçš„ææ¡ˆä¿¡æ¯ã€‚</li></ul><p>ä¸€è‡´æ€§çš„å®‰å…¨æ€§éœ€æ±‚ï¼šï¼ˆPaxosçš„ç›®æ ‡å°±æ˜¯ä¿è¯æœ€ç»ˆæœ‰ä¸€ä¸ªææ¡ˆè¢«é€‰å®šï¼‰</p><ul><li>åªæœ‰è¢«æå‡ºçš„ææ¡ˆæ‰èƒ½è¢«é€‰å®šã€‚</li><li>åªèƒ½æœ‰ä¸€ä¸ªå€¼è¢«é€‰å®šã€‚</li><li>å¦‚æœæŸä¸ªè¿›ç¨‹è®¤ä¸ºæŸä¸ªææ¡ˆè¢«é€‰å®šäº†ï¼Œè¿™ä¸ªææ¡ˆå¿…é¡»æ˜¯çœŸçš„è¢«é€‰å®šçš„é‚£ä¸ªã€‚</li></ul><p>åœ¨è¯¥ä¸€è‡´æ€§ç®—æ³•ä¸­ï¼Œæœ‰ä¸‰ç§å‚ä¸è§’è‰²ï¼šProposerï¼ˆæè®®äººï¼‰ã€Acceptorï¼ˆæ¥æ”¶äººï¼‰å’Œ Learner ï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½å……å½“ä¸åªä¸€ç§è§’è‰²ï¼Œå‡è®¾ä¸åŒå‚ä¸è€…ä¹‹é—´å¯ä»¥é€šè¿‡æ”¶å‘æ¶ˆæ¯æ¥è¿›è¡Œé€šä¿¡ï¼š</p><ul><li>æ¯ä¸ªå‚ä¸è€…ä»¥ä»»æ„çš„é€Ÿåº¦æ‰§è¡Œï¼Œå¯èƒ½ä¼šå› ä¸ºå‡ºé”™è€Œåœæ­¢ï¼Œä¹Ÿå¯èƒ½ä¼šé‡å¯ã€‚å³ä½¿ä¸€ä¸ªææ¡ˆè¢«é€‰å®šåï¼Œæ‰€æœ‰å‚ä¸è€…ä¹Ÿæœ‰å¯èƒ½å¤±è´¥æˆ–é‡å¯ï¼Œå› æ­¤é™¤éå¤±è´¥æˆ–é‡å¯çš„å‚ä¸è€…å¯ä»¥è®°å½•æŸäº›ä¿¡æ¯ï¼Œå¦åˆ™å°†æ— æ³•ç¡®å®šæœ€ç»ˆçš„å€¼ã€‚</li><li>æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ä¸å¯é¢„çŸ¥çš„å»¶è¿Ÿï¼Œä¹Ÿå¯èƒ½ä¼šé‡å¤æˆ–ä¸¢å¤±ï¼Œä½†æ˜¯æ¶ˆæ¯ä¸ä¼šè¢«æŸåï¼Œå³æ¶ˆæ¯å†…å®¹ä¸ä¼šè¢«ç¯¡æ”¹ã€‚</li></ul><h4 id="2-3-2-ææ¡ˆçš„é€‰å®š"><a href="#2-3-2-ææ¡ˆçš„é€‰å®š" class="headerlink" title="2.3.2 ææ¡ˆçš„é€‰å®š"></a>2.3.2 ææ¡ˆçš„é€‰å®š</h4><p>é€‰å®šä¸€ä¸ªå”¯ä¸€ææ¡ˆï¼Œæœ€ç®€å•çš„æ–¹æ¡ˆæ˜¯åªå…è®¸ä¸€ä¸ª Acceptor å­˜åœ¨ï¼ŒProposer åªèƒ½å‘é€ææ¡ˆç»™å®ƒï¼ŒAcceptor é€‰æ‹©å®ƒæ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªææ¡ˆï¼Œè¿™ç§æ–¹æ¡ˆå­˜åœ¨å•ç‚¹æ•…éšœã€‚</p><p>å­˜åœ¨å¤šä¸ª Acceptor ï¼šProposer å‘ä¸€ä¸ª Acceptor é›†åˆå‘é€ææ¡ˆï¼Œé›†åˆä¸­æ¯ä¸ª Acceptor éƒ½å¯èƒ½ä¼šæ‰¹å‡†è¯¥ææ¡ˆï¼Œå½“æœ‰è¶³å¤Ÿå¤šçš„ Acceptor æ‰¹å‡†è¿™ä¸ªææ¡ˆæ—¶ï¼Œå°±å¯ä»¥è®¤ä¸ºå®ƒè¢«é€‰å®šäº†ã€‚</p><h4 id="2-3-3-æ¨å¯¼è¿‡ç¨‹"><a href="#2-3-3-æ¨å¯¼è¿‡ç¨‹" class="headerlink" title="2.3.3 æ¨å¯¼è¿‡ç¨‹"></a>2.3.3 æ¨å¯¼è¿‡ç¨‹</h4><p>éœ€æ±‚ï¼šåœ¨æ²¡æœ‰å¤±è´¥å’Œæ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªææ¡ˆè¢«æå‡ºï¼Œä¹Ÿè¦é€‰å‡ºä¸€ä¸ªææ¡ˆã€‚</p><p>è¿™å°±æ„å‘³ç€<strong>P1ï¼šä¸€ä¸ª Acceptor å¿…é¡»æ‰¹å‡†å®ƒæ”¶åˆ°çš„ç¬¬ä¸€ä¸ªææ¡ˆ</strong>ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ¯ä¸ª Acceptor éƒ½æ‰¹å‡†äº†ç¬¬ä¸€ä¸ªææ¡ˆï¼Œä½†æ²¡æœ‰ä¸€ä¸ªææ¡ˆæ˜¯å¤šæ•°äººæ‰¹å‡†çš„ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200107.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200108.png" alt></p><p>ä¸€ä¸ªææ¡ˆéœ€è¦ç”±åŠæ•°ä»¥ä¸Šçš„ Acceptor æ‰¹å‡†çš„éœ€æ±‚æš—ç¤ºç€<strong>ä¸€ä¸ª Acceptor å¿…é¡»èƒ½å¤Ÿæ‰¹å‡†ä¸æ­¢ä¸€ä¸ªææ¡ˆ</strong>ã€‚</p><p>Paxos ä½¿ç”¨ä¸€ä¸ª<strong>å…¨å±€ç¼–å·</strong>æ¥å”¯ä¸€æ ‡è¯†æ¯ä¸€ä¸ªè¢« Acceptor æ‰¹å‡†çš„ææ¡ˆï¼Œå½“ä¸€ä¸ªå…·æœ‰æŸ Value å€¼çš„ææ¡ˆè¢«åŠæ•°ä»¥ä¸Šçš„ Acceptor æ‰¹å‡†åï¼Œå³è¯¥ Value è¢«é€‰å®šäº†å’Œè¯¥ææ¡ˆè¢«é€‰å®šäº†ã€‚ææ¡ˆå˜æˆäº†ä¸€ä¸ªç”±ç¼–å·å’Œ Value ç»„æˆçš„ç»„åˆä½“ â€œã€ç¼–å·, Valueã€‘â€ã€‚</p><p><strong>P2ï¼šå¦‚æœç¼–å·ä¸ºM~0~ã€Valueå€¼ä¸ºV~0~çš„ææ¡ˆè¢«é€‰å®šäº†ï¼Œé‚£ä¹ˆæ‰€æœ‰æ¯”ç¼–å·M~0~æ›´é«˜çš„ï¼Œä¸”è¢«é€‰å®šçš„ï¼ˆè¢« Acceptor æ‰¹å‡†çš„ï¼‰ææ¡ˆï¼Œå…¶Valueå€¼å¿…é¡»ä¹Ÿæ˜¯V~0~</strong></p><p>é€šä¿¡æ˜¯å¼‚æ­¥çš„ï¼Œä¸€ä¸ªææ¡ˆå¯èƒ½ä¼šåœ¨æŸä¸ª Acceptor è¿˜æœªæ”¶åˆ°ä»»ä½•ææ¡ˆæ—¶å°±è¢«é€‰å®šäº†ï¼Œæ‰€ä»¥ä»éœ€è¦P1æ¥ä¿è¯ææ¡ˆä¼šè¢«é€‰å®šã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200109.png" alt></p><p><strong>P2bï¼šå¦‚æœä¸€ä¸ªææ¡ˆ[M~0~, V~0~]è¢«é€‰å®šåï¼Œé‚£ä¹ˆä¹‹åä»»ä½• Proposer äº§ç”Ÿçš„ç¼–å·æ›´é«˜çš„ææ¡ˆï¼Œå…¶Valueå€¼å¿…é¡»ä¹Ÿæ˜¯V~0~</strong></p><p>å› ä¸ºä¸€ä¸ªææ¡ˆå¿…é¡»åœ¨è¢« Proposer æå‡ºåæ‰èƒ½è¢« Acceptor æ‰¹å‡†ï¼Œæ‰€ä»¥P2båŒ…å«P2ã€‚</p><h4 id="2-3-4-æ•°å­¦å½’çº³æ³•è¯æ˜"><a href="#2-3-4-æ•°å­¦å½’çº³æ³•è¯æ˜" class="headerlink" title="2.3.4 æ•°å­¦å½’çº³æ³•è¯æ˜"></a>2.3.4 æ•°å­¦å½’çº³æ³•è¯æ˜</h4><p>éœ€è¦è¯æ˜ç»“è®ºï¼š<strong>å‡è®¾æŸä¸ªææ¡ˆ[M~0~, V~0~]è¢«é€‰å®šäº†ï¼Œè¯æ˜ä»»ä½•ç¼–å·M~n~&gt;M~0~çš„ææ¡ˆï¼Œå…¶Valueå€¼éƒ½æ˜¯V~0~</strong>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹M~n~è¿›è¡Œç¬¬äºŒæ•°å­¦å½’çº³æ³•è¿›è¡Œè¯æ˜ï¼Œå³è¯æ˜ï¼š<strong>å‡è®¾ç¼–å·åœ¨M~0~åˆ°M~n-1~ä¹‹é—´çš„ææ¡ˆï¼Œå…¶Valueå€¼éƒ½æ˜¯V~0~ï¼Œè¯æ˜ç¼–å·ä¸ºM~n~çš„ææ¡ˆçš„Valueå€¼ä¹Ÿä¸ºV~0~</strong>ã€‚</p><p>å› ä¸ºM~0~çš„ææ¡ˆå·²è¢«é€‰å®šï¼Œæ„å‘³ç€è‚¯å®šå­˜åœ¨ä¸€ä¸ªç”±åŠæ•°ä»¥ä¸Šçš„ Acceptor ç»„æˆçš„é›†åˆCï¼Œéƒ½æ‰¹å‡†äº†ææ¡ˆã€‚<strong>Cä¸­çš„æ¯ä¸ª Acceptor éƒ½æ‰¹å‡†äº†åœ¨M~0~åˆ°M~n-1~èŒƒå›´å†…çš„ææ¡ˆï¼Œå¹¶ä¸”æ¯ä¸ªç¼–å·åœ¨M~0~åˆ°M~n-1~ä¹‹é—´çš„è¢«æ‰¹å‡†çš„ææ¡ˆï¼Œå…¶Valueå€¼éƒ½æ˜¯V~0~</strong>ã€‚</p><p>å› ä¸ºä»»ä½•åŒ…å«åŠæ•°ä»¥ä¸Šçš„ Acceptor ç»„æˆçš„é›†åˆéƒ½è‡³å°‘åŒ…å«ä¸€ä¸ªCçš„æˆå‘˜ï¼Œæ‰€ä»¥å¦‚æœä¿æŒä¸‹é¢P2cçš„ä¸å˜æ€§ï¼Œå¯ä»¥è®¤ä¸ºç¼–å·ä¸ºM~n~çš„ææ¡ˆçš„Valueå€¼ä¹Ÿä¸ºV~0~ã€‚</p><p><strong>P2cï¼šå¯¹äºä»»æ„çš„M~n~å’ŒV~n~ï¼Œå¦‚æœææ¡ˆ[M~n~, V~n~]è¢«æå‡ºï¼Œé‚£ä¹ˆè‚¯å®šå­˜åœ¨ä¸€ä¸ªç”±åŠæ•°ä»¥ä¸Šçš„ Acceptor ç»„å‡ºçš„é›†åˆSï¼Œæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªï¼š</strong></p><ul><li>è¦ä¹ˆï¼ŒSä¸­ä¸å­˜åœ¨ä»»ä½•æ‰¹å‡†è¿‡ç¼–å·å°äºM~n~çš„ææ¡ˆçš„ Acceptorã€‚</li><li>è¦ä¹ˆï¼Œé€‰å–Sä¸­æ‰€æœ‰ Acceptor æ‰¹å‡†çš„ç¼–å·å°äº M~n~ çš„ææ¡ˆï¼Œå…¶ä¸­ç¼–å·æœ€å¤§çš„å“ªä¸ªææ¡ˆå…¶ Value å€¼æ˜¯ V~n~ ã€‚</li></ul><p>P2c=&gt;P2b=&gt;P2ï¼Œé€šè¿‡P2å’ŒP1ä¿è¯ä¸€è‡´æ€§ã€‚</p><p>å‡è®¾ææ¡ˆ[M~0~, V~0~]è¢«é€‰å®šäº†ï¼Œéœ€è¦è¯æ˜åœ¨P2cçš„å‰æä¸‹ï¼Œå¯¹äºæ‰€æœ‰çš„[M~n~, V~n~]ï¼Œå­˜åœ¨ V~n~ = V~0~ ï¼šï¼ˆç¬¬äºŒæ•°å­¦å½’çº³æ³•ï¼‰</p><ol><li>å½“ M~n~ = M~0~ + 1 æ—¶ï¼Œå› ä¸º[M~0~, V~0~]è¢«é€‰å®šäº†ï¼Œä¸€å®šä¼šå­˜åœ¨ä¸€ä¸ª Acceptor çš„å­é›†Sï¼ŒSä¸­çš„ Acceptor å·²æ‰¹å‡†äº†å°äº M~n~ çš„ææ¡ˆï¼Œå› æ­¤ V~n~ åªèƒ½æ˜¯Sä¸­ç¼–å·å°äº  M~n~ ä½†ä¸ºæœ€å¤§ç¼–å·çš„ææ¡ˆã€‚å› ä¸º M~n~ = M~0~ + 1 ï¼Œæ‰€ä»¥ææ¡ˆæ˜¯ [M~0~, V~0~] ï¼›åŒæ—¶ç”±äºSå’Œé€šè¿‡[M~0~, V~0~]çš„é›†åˆéƒ½æ˜¯å¤šæ•°é›†ï¼Œæ‰€ä»¥äºŒè€…ä¸€å®šå­˜åœ¨äº¤é›†ï¼Œè¿™æ · Proposer åœ¨ç¡®å®š V~n~ å–å€¼æ—¶ä¸€å®šä¼šé€‰æ‹© V~0~ ã€‚</li><li>ç¼–å·åœ¨ M~0~ + 1 åˆ° M~n~ - 1 ä¹‹é—´çš„Valueå€¼éƒ½ä¸º V~0~ ï¼Œè¦è¯æ˜ç¼–å·ä¸º M~n~ çš„ææ¡ˆçš„Valueå€¼ä¹Ÿä¸º V~0~ ã€‚æ ¹æ®P1cï¼Œä¸€å®šä¼šå­˜åœ¨ä¸€ä¸ª Acceptor çš„å­é›†Sï¼ŒSä¸­çš„ Acceptor å·²æ‰¹å‡†äº†å°äº M~n~ çš„ææ¡ˆï¼Œé‚£ä¹ˆç¼–å·ä¸º M~n~ çš„ææ¡ˆçš„Valueå€¼åªèƒ½æ˜¯Sä¸­ç¼–å·å°äº M~n~ ä½†ä¸ºæœ€å¤§ç¼–å·çš„ææ¡ˆçš„å€¼ã€‚åªè¦ç¼–å·è½åœ¨ M~0~ + 1 åˆ° M~n~ - 1 ä¹‹é—´ï¼Œé‚£ä¹ˆValueå€¼å°±æ˜¯ V~0~ ï¼›å¦‚æœä¸è½åœ¨åŒºé—´å†…ï¼Œé‚£è‚¯å®šæ˜¯ M~0~ ï¼Œå› ä¸ºSè‚¯å®šä¼šå’Œæ‰¹å‡†[M~0~, V~0~]çš„é›†åˆæœ‰äº¤é›†ï¼Œå¦‚æœç¼–å·ä¸º M~0~ ï¼Œé‚£ä¹ˆå…¶Valueå€¼ä¹Ÿä¸º V~0~ ã€‚</li></ol><h4 id="2-3-5-Proposer-ç”Ÿæˆææ¡ˆ"><a href="#2-3-5-Proposer-ç”Ÿæˆææ¡ˆ" class="headerlink" title="2.3.5 Proposer ç”Ÿæˆææ¡ˆ"></a>2.3.5 Proposer ç”Ÿæˆææ¡ˆ</h4><p>å¯¹äº Proposer æ¥è¯´ï¼Œè·å–å·²ç»è¢«é€šè¿‡çš„ææ¡ˆè¿œæ¯”é¢„æµ‹æœªæ¥å¯èƒ½è¢«é€šè¿‡çš„ææ¡ˆç®€å•ã€‚å› æ­¤ <strong>Proposer åœ¨äº§ç”Ÿä¸€ä¸ªç¼–å·ä¸º M~n~ çš„ææ¡ˆæ—¶ï¼Œå¿…é¡»è¦çŸ¥é“å½“å‰ä¸€ä¸ªå°†è¦æˆ–å·²ç»è¢«åŠæ•°ä»¥ä¸Š Acceptor æ‰¹å‡†çš„ç¼–å·å°äº M~n~ çš„æœ€å¤§ææ¡ˆç¼–å·ã€‚å¹¶ä¸” Proposer ä¼šè¦æ±‚æ‰€æœ‰ Acceptor ä¸å†æ‰¹å‡†ä»»ä½•ç¼–å·å°äº M~n~ çš„ææ¡ˆ</strong>ã€‚  </p><p><strong>ææ¡ˆç”Ÿæˆç®—æ³•</strong>ï¼š</p><ol><li>Proposer é€‰æ‹©ä¸€ä¸ªæ–°çš„ææ¡ˆç¼–å· M~n~ ï¼Œç„¶åå‘æŸä¸ª Acceptor é›†åˆçš„æˆå‘˜å‘é€è¯·æ±‚ï¼ˆå³ç¼–å·ä¸º M~n~ çš„ææ¡ˆçš„ Prepare è¯·æ±‚ï¼‰ï¼Œè¦æ±‚è¯¥é›†åˆä¸­çš„ Acceptor åšå‡ºå¦‚ä¸‹å›åº”ã€‚<ul><li>å‘ Proposer æ‰¿è¯ºï¼Œä¿è¯ä¸å†æ‰¹å‡†ä»»ä½•ç¼–å·å°äº M~n~ çš„ææ¡ˆã€‚</li><li>å¦‚æœ Acceptor å·²ç»æ‰¹å‡†è¿‡ä»»ä½•ææ¡ˆï¼Œé‚£ä¹ˆå…¶å°±å‘ Proposer åé¦ˆå½“å‰è¯¥ Acceptor å·²ç»æ‰¹å‡†çš„ç¼–å·å°äº M~n~ ä½†ä¸ºæœ€å¤§ç¼–å·çš„é‚£ä¸ªææ¡ˆçš„å€¼ã€‚</li></ul></li><li>å¦‚æœ Proposer æ”¶åˆ°äº†æ¥è‡ªåŠæ•°ä»¥ä¸Šçš„ Acceptor çš„å“åº”ç»“æœï¼Œé‚£ä¹ˆå®ƒå¯ä»¥äº§ç”Ÿç¼–å·ä¸º M~n~ ã€Valueå€¼ä¸º V~n~ çš„ææ¡ˆï¼ŒV~n~ æ˜¯æ‰€æœ‰å“åº”ä¸­ç¼–å·æœ€å¤§çš„ææ¡ˆçš„ Value å€¼ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå³åŠæ•°ä»¥ä¸Šéƒ½æœªæ‰¹å‡†è¿‡ä»»ä½•ææ¡ˆï¼Œä¹Ÿå³å“åº”ä¸­ä¸åŒ…å«ä»»ä½•ææ¡ˆï¼Œæ­¤æ—¶ V~n~ å€¼å¯ä»¥ç”± Proposer ä»»æ„é€‰æ‹©ã€‚</li></ol><p>Proposer å‘é€ç»™ Acceptor é€‰å®šçš„ææ¡ˆæœŸæœ›è·å¾—æ‰¹å‡†çš„è¯·æ±‚å«Acceptè¯·æ±‚ã€‚æ¥å—è¯·æ±‚çš„ Acceptor é›†åˆä¸ä¸€å®šæ˜¯ä¹‹å‰å“åº”Prepareè¯·æ±‚çš„é‚£ä¸€ä¸ªã€‚</p><h4 id="2-3-6-Acceptor-æ‰¹å‡†ææ¡ˆ"><a href="#2-3-6-Acceptor-æ‰¹å‡†ææ¡ˆ" class="headerlink" title="2.3.6 Acceptor æ‰¹å‡†ææ¡ˆ"></a>2.3.6 Acceptor æ‰¹å‡†ææ¡ˆ</h4><p>ä¸€ä¸ª Acceptor å¯èƒ½æ¥æ”¶åˆ°ä¸¤ç§æ¥è‡ª Proposer çš„è¯·æ±‚ï¼š</p><ul><li><strong>Prepareè¯·æ±‚ï¼š</strong>Acceptor å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å“åº”ã€‚</li><li><strong>Acceptè¯·æ±‚ï¼š</strong>åœ¨ä¸è¿èƒŒAcceptç°æœ‰æ‰¿è¯ºçš„å‰æä¸‹ï¼Œä»»æ„å“åº”Acceptè¯·æ±‚ã€‚</li></ul><p><strong>P1aï¼šä¸€ä¸ª Acceptor åªè¦å°šæœªå“åº”è¿‡ä»»ä½•ç¼–å·å¤§äº M~n~ çš„Prepareè¯·æ±‚ï¼Œå®ƒå°±å¯ä»¥æ¥å—è¿™ä¸ªç¼–å·ä¸º M~n~ çš„ææ¡ˆã€‚</strong></p><h4 id="2-3-7-ç®—æ³•ä¼˜åŒ–"><a href="#2-3-7-ç®—æ³•ä¼˜åŒ–" class="headerlink" title="2.3.7 ç®—æ³•ä¼˜åŒ–"></a>2.3.7 ç®—æ³•ä¼˜åŒ–</h4><p>å‡è®¾ä¸€ä¸ª Acceptor æ”¶åˆ°äº†ä¸€ä¸ªç¼–å·ä¸º M~n~ çš„Prepareè¯·æ±‚ï¼Œä½†æ­¤æ—¶å®ƒå·²ç»å¯¹å¤§äº M~n~ çš„Prepareè¯·æ±‚åšå‡ºäº†å“åº”ï¼Œå› æ­¤å®ƒè‚¯å®šä¸ä¼šå†æ‰¹å‡†ç¼–å· M~n~ çš„ææ¡ˆï¼Œæ‰€ä»¥ Acceptor æ²¡æœ‰å¿…è¦å¯¹æ­¤è¯·æ±‚åšå‡ºå“åº”ï¼Œå¯ä»¥é€‰æ‹©å¿½ç•¥è¿™ç§Prepareè¯·æ±‚ã€‚åŒç†è¿˜å¯ä»¥å¿½ç•¥å·²ç»æ‰¹å‡†è¿‡çš„ææ¡ˆçš„Prepareè¯·æ±‚ã€‚</p><p>è¿™æ · Acceptor åªéœ€è®°ä½å®ƒå·²ç»æ‰¹å‡†çš„ææ¡ˆçš„æœ€å¤§ç¼–å·å’Œå®ƒå·²ç»åšå‡ºPrepareè¯·æ±‚å“åº”çš„ææ¡ˆçš„æœ€å¤§ç¼–å·ï¼Œä»¥ä¾¿å†å‡ºç°æ•…éšœæˆ–èŠ‚ç‚¹é‡å¯æ—¶ä¹Ÿèƒ½ä¿è¯P2cçš„ä¸å˜æ€§ã€‚</p><p>å¯¹äº Proposer æ¥è¯´ï¼Œåªè¦ä¿è¯ä¸ä¼šäº§ç”Ÿç›¸åŒç¼–å·çš„ææ¡ˆï¼Œå¯ä»¥ä¸¢å¼ƒä»»æ„ææ¡ˆå’Œè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯ã€‚</p><h4 id="2-3-8-ç®—æ³•é™ˆè¿°"><a href="#2-3-8-ç®—æ³•é™ˆè¿°" class="headerlink" title="2.3.8 ç®—æ³•é™ˆè¿°"></a>2.3.8 ç®—æ³•é™ˆè¿°</h4><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªç±»ä¼¼äºŒé˜¶æ®µæäº¤çš„ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼š</p><ul><li>é˜¶æ®µä¸€<ol><li>Proposer é€‰æ‹©ä¸€ä¸ªææ¡ˆç¼–å· M~n~ ï¼Œç„¶åå‘ Acceptor çš„æŸä¸ªè¶…è¿‡åŠæ•°çš„å­é›†æˆå‘˜å‘é€ç¼–å·ä¸º M~n~ çš„Prepareè¯·æ±‚ã€‚</li><li>å¦‚æœä¸€ä¸ª Acceptor æ”¶åˆ°ä¸€ä¸ªç¼–å·ä¸º M~n~ çš„Prepareè¯·æ±‚ï¼Œä¸”ç¼–å· M~n~ å¤§äºå®ƒå·²ç»å“åº”çš„æ‰€æœ‰Prepareè¯·æ±‚çš„ç¼–å·ï¼Œé‚£ä¹ˆå®ƒä¼šå°†å®ƒå·²ç»æ‰¹å‡†è¿‡çš„æœ€å¤§ç¼–å·çš„ææ¡ˆä½œä¸ºå“åº”åé¦ˆç»™ Proposer ï¼ŒåŒæ—¶æ‰¿è¯ºä¸ä¼šå†æ‰¹å‡†å°äºç¼–å· M~n~ çš„ä»»ä½•ææ¡ˆã€‚</li></ol></li><li>é˜¶æ®µäºŒ<ol><li>å¦‚æœ Proposer æ”¶åˆ°æ¥è‡ªåŠæ•°ä»¥ä¸Šçš„ Acceptor å¯¹äºå…¶å‘å‡ºçš„ç¼–å·ä¸º M~n~ çš„Prepareè¯·æ±‚çš„å“åº”ï¼Œå®ƒå°±ä¼šå‘é€ä¸€ä¸ªé’ˆå¯¹[M~n~, V~n~]ææ¡ˆçš„ Accept è¯·æ±‚ç»™ Acceptor ï¼ˆ V~n~ ä¸ºæ”¶åˆ°çš„å“åº”ä¸­ç¼–å·æœ€å¤§çš„ææ¡ˆçš„å€¼ï¼Œè‹¥å“åº”ä¸­ä¸åŒ…å«ææ¡ˆï¼Œå®ƒå¯ä»¥æ˜¯ä»»æ„å€¼ï¼‰ã€‚</li><li>å¦‚æœ Acceptor æ”¶åˆ°æ­¤ Accept è¯·æ±‚ï¼Œåªè¦è¯¥ Acceptor å°šæœªå¯¹ç¼–å·å¤§äº M~n~ çš„Prepareè¯·æ±‚åšå‡ºå“åº”ï¼Œå®ƒå°±å¯ä»¥é€šè¿‡è¿™ä¸ªææ¡ˆã€‚</li></ol></li></ul><h4 id="2-3-9-ææ¡ˆçš„è·å–"><a href="#2-3-9-ææ¡ˆçš„è·å–" class="headerlink" title="2.3.9 ææ¡ˆçš„è·å–"></a>2.3.9 ææ¡ˆçš„è·å–</h4><p>Learner è·å–ææ¡ˆçš„å‡ ç§æ–¹æ¡ˆï¼š</p><ol><li>Learner è·å–ææ¡ˆçš„å‰ææ˜¯æ­¤ææ¡ˆå·²è¢«åŠæ•°ä»¥ä¸Šçš„ Acceptor æ‰¹å‡†ã€‚å› æ­¤æœ€ç®€å•çš„åšæ³•æ˜¯ä¸€æ—¦ Acceptor æ‰¹å‡†äº†ææ¡ˆï¼Œå°±æŠŠå…¶å‘é€ç»™æ‰€æœ‰çš„ Learner ã€‚è¿™ç§åšæ³•ä¼šè®©æ¯ä¸ª Acceptor ä¸æ‰€æœ‰çš„ Learner é€šä¿¡ï¼Œé€šä¿¡æ¬¡æ•°è‡³å°‘ä¸ºäºŒè€…ä¸ªæ•°çš„ä¹˜ç§¯ã€‚</li><li>è®©æ‰€æœ‰çš„ Acceptor å¯¹ææ¡ˆçš„æ‰¹å‡†æƒ…å†µç»Ÿä¸€å‘é€ç»™ä¸€ä¸ª<strong>ä¸»Learner</strong>ï¼Œä¸»Learner è¢«é€šçŸ¥ä¸€ä¸ªææ¡ˆå·²è¢«é€‰å®šåä¼šè´Ÿè´£é€šçŸ¥å…¶ä»– Learner ã€‚æ­¤æ–¹æ¡ˆé€šè¿‡å¤šåŠ ä¸€ä¸ªæ­¥éª¤ï¼Œå¤§å¤§å‡å°‘äº†é€šä¿¡æ¬¡æ•°ï¼Œä½†å¸¦æ¥äº†ä¸»Learnerå¯èƒ½å‘ç”Ÿæ•…éšœè¿™ä¸ªéšæ‚£ã€‚</li><li>é’ˆå¯¹æ–¹æ¡ˆäºŒï¼Œå°†ä¸»Learneræ‰©å¤§ä¸ºç‰¹å®šçš„Learneré›†åˆï¼Œä»è€Œæé«˜å¯é æ€§ã€‚</li></ol><h4 id="2-3-10-é€šè¿‡é€‰å–ä¸»Proposerä¿è¯ç®—æ³•çš„æ´»æ€§"><a href="#2-3-10-é€šè¿‡é€‰å–ä¸»Proposerä¿è¯ç®—æ³•çš„æ´»æ€§" class="headerlink" title="2.3.10 é€šè¿‡é€‰å–ä¸»Proposerä¿è¯ç®—æ³•çš„æ´»æ€§"></a>2.3.10 é€šè¿‡é€‰å–ä¸»Proposerä¿è¯ç®—æ³•çš„æ´»æ€§</h4><p>Paxosç®—æ³•å¯èƒ½ä¼šå‡ºç°å¤šä¸ªProposerç›¸äº’å¯¼è‡´å¯¹æ–¹ææ¡ˆè¯·æ±‚è¢«å¿½ç•¥çš„æ­»å¾ªç¯ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200110.png" alt></p><p>è§£å†³æ–¹æ¡ˆï¼šé€‰å®šä¸€ä¸ªä¸»Proposerï¼Œå¹¶è§„å®šåªæœ‰ä¸»Proposeræ‰èƒ½æå‡ºè®®æ¡ˆã€‚</p><p><strong>åŸºäºBest Efforts 1PCæ¨¡å¼çš„äº‹åŠ¡</strong>ï¼Œå‚è€ƒspring-data-neo4jçš„å®ç°ã€‚é‰´äºBest Efforts 1PCæ¨¡å¼çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œä»¥åŠç›¸å¯¹ç®€å•çš„å®ç°æ–¹å¼ï¼Œå®ƒè¢«å¤§å¤šæ•°çš„shardingæ¡†æ¶å’Œé¡¹ç›®é‡‡ç”¨</p><p><strong>äº‹åŠ¡è¡¥å¿ï¼ˆå¹‚ç­‰å€¼ï¼‰</strong></p><p>å¯¹äºé‚£äº›å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜ï¼Œä½†å¯¹ä¸€è‡´æ€§è¦æ±‚å¹¶ä¸é«˜çš„ç³»ç»Ÿï¼Œå¾€å¾€å¹¶ä¸è‹›æ±‚ç³»ç»Ÿçš„å®æ—¶ä¸€è‡´æ€§ï¼Œåªè¦åœ¨ä¸€ä¸ªå…è®¸çš„æ—¶é—´å‘¨æœŸå†…è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§å³å¯ï¼Œè¿™ä½¿å¾—äº‹åŠ¡è¡¥å¿æœºåˆ¶æˆä¸ºä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆã€‚äº‹åŠ¡è¡¥å¿æœºåˆ¶æœ€åˆè¢«æå‡ºæ˜¯åœ¨â€œé•¿äº‹åŠ¡â€çš„å¤„ç†ä¸­ï¼Œä½†æ˜¯å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿç¡®ä¿ä¸€è‡´æ€§ä¹Ÿæœ‰å¾ˆå¥½çš„å‚è€ƒæ„ä¹‰ã€‚ç¬¼ç»Ÿåœ°è®²ï¼Œä¸äº‹åŠ¡åœ¨æ‰§è¡Œä¸­å‘ç”Ÿé”™è¯¯åç«‹å³å›æ»šçš„æ–¹å¼ä¸åŒï¼Œäº‹åŠ¡è¡¥å¿æ˜¯ä¸€ç§äº‹åæ£€æŸ¥å¹¶è¡¥æ•‘çš„æªæ–½ï¼Œå®ƒåªæœŸæœ›åœ¨ä¸€ä¸ªå®¹è®¸æ—¶é—´å‘¨æœŸå†…å¾—åˆ°æœ€ç»ˆä¸€è‡´çš„ç»“æœå°±å¯ä»¥äº†ã€‚äº‹åŠ¡è¡¥å¿çš„å®ç°ä¸ç³»ç»Ÿä¸šåŠ¡ç´§å¯†ç›¸å…³ï¼Œå¹¶æ²¡æœ‰ä¸€ç§æ ‡å‡†çš„å¤„ç†æ–¹å¼ã€‚ä¸€äº›å¸¸è§çš„å®ç°æ–¹å¼æœ‰ï¼šå¯¹æ•°æ®è¿›è¡Œå¯¹å¸æ£€æŸ¥;åŸºäºæ—¥å¿—è¿›è¡Œæ¯”å¯¹;å®šæœŸåŒæ ‡å‡†æ•°æ®æ¥æºè¿›è¡ŒåŒæ­¥ï¼Œç­‰ç­‰ã€‚</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/24036067" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/24036067</a></p><p>äº‹åŠ¡æ”¯æŒï¼šæˆ‘ä»¬æ˜¯å°†æ•´ä¸ªè®¢å•é¢†åŸŸèšåˆä½“åˆ‡åˆ†ï¼Œç»´åº¦ä¸€è‡´ï¼Œæ‰€ä»¥å¯¹èšåˆä½“çš„äº‹åŠ¡æ˜¯æ”¯æŒçš„ã€‚</p><p>å¤æ‚æŸ¥è¯¢ï¼šå‚ç›´åˆ‡åˆ†åï¼Œå°±è·Ÿjoinè¯´æ‹œæ‹œäº†ï¼›æ°´å¹³åˆ‡åˆ†åï¼ŒæŸ¥è¯¢çš„æ¡ä»¶ä¸€å®šè¦åœ¨åˆ‡åˆ†çš„ç»´åº¦å†…ï¼Œæ¯”å¦‚æŸ¥è¯¢å…·ä½“æŸä¸ªç”¨æˆ·ä¸‹çš„å„ä½è®¢å•ç­‰ï¼›ç¦æ­¢ä¸å¸¦åˆ‡åˆ†çš„ç»´åº¦çš„æŸ¥è¯¢ï¼Œå³ä½¿ä¸­é—´ä»¶å¯ä»¥æ”¯æŒè¿™ç§æŸ¥è¯¢ï¼Œå¯ä»¥åœ¨å†…å­˜ä¸­ç»„è£…ï¼Œä½†æ˜¯è¿™ç§éœ€æ±‚å¾€å¾€ä¸åº”è¯¥åœ¨åœ¨çº¿åº“æŸ¥è¯¢ï¼Œæˆ–è€…å¯ä»¥é€šè¿‡å…¶ä»–æ–¹æ³•è½¬æ¢åˆ°åˆ‡åˆ†çš„ç»´åº¦æ¥å®ç°ã€‚</p></blockquote><p>ä¸€æ—¦æ•°æ®åº“è¢«åˆ‡åˆ†åˆ°å¤šä¸ªç‰©ç†ç»“ç‚¹ä¸Šï¼Œæˆ‘ä»¬å°†ä¸èƒ½å†ä¾èµ–æ•°æ®åº“è‡ªèº«çš„ä¸»é”®ç”Ÿæˆæœºåˆ¶ã€‚ä¸€æ–¹é¢ï¼ŒæŸä¸ªåˆ†åŒºæ•°æ®åº“è‡ªç”Ÿæˆçš„IDæ— æ³•ä¿è¯åœ¨å…¨å±€ä¸Šæ˜¯å”¯ä¸€çš„ï¼›å¦ä¸€æ–¹é¢ï¼Œåº”ç”¨ç¨‹åºåœ¨æ’å…¥æ•°æ®ä¹‹å‰éœ€è¦å…ˆè·å¾—ID,ä»¥ä¾¿è¿›è¡ŒSQLè·¯ç”±ã€‚</p><ol><li>åˆ©ç”¨æ•°æ®åº“è‡ªå¢IDå’ŒUUID</li></ol><p>ä¼˜ç‚¹ï¼šæœ€ç®€å•ã€‚</p><p>ç¼ºç‚¹ï¼šå•ç‚¹é£é™©ã€å•æœºæ€§èƒ½ç“¶é¢ˆã€‚</p><blockquote><p>ä½¿ç”¨UUIDä½œä¸»é”®æ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ç”±äºUUIDéå¸¸çš„é•¿ï¼Œé™¤å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´å¤–ï¼Œæœ€ä¸»è¦çš„é—®é¢˜æ˜¯åœ¨ç´¢å¼•ä¸Šï¼Œåœ¨å»ºç«‹ç´¢å¼•å’ŒåŸºäºç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶éƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚</p></blockquote><ol start="2"><li>ç»“åˆæ•°æ®åº“ç»´æŠ¤ä¸€ä¸ªSequenceè¡¨</li></ol><p>æ­¤æ–¹æ¡ˆçš„æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨æ•°æ®åº“ä¸­å»ºç«‹ä¸€ä¸ªSequenceè¡¨ï¼Œè¡¨çš„ç»“æ„ç±»ä¼¼äºï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TABLE <span class="symbol">`SEQUENCE`</span> (  </span><br><span class="line">    <span class="symbol">`table_name`</span> varchar(<span class="number">18</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line">    <span class="symbol">`nextid`</span> bigint(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (<span class="symbol">`table_name`</span>)  </span><br><span class="line">) ENGINE=InnoDB</span><br></pre></td></tr></table></figure><p>æ¯å½“éœ€è¦ä¸ºæŸä¸ªè¡¨çš„æ–°çºªå½•ç”ŸæˆIDæ—¶å°±ä»Sequenceè¡¨ä¸­å–å‡ºå¯¹åº”è¡¨çš„nextid,å¹¶å°†nextidçš„å€¼åŠ 1åæ›´æ–°åˆ°æ•°æ®åº“ä¸­ä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨ã€‚æ­¤æ–¹æ¡ˆä¹Ÿè¾ƒç®€å•ï¼Œä½†ç¼ºç‚¹åŒæ ·æ˜æ˜¾ï¼šç”±äºæ‰€æœ‰æ’å…¥ä»»ä½•éƒ½éœ€è¦è®¿é—®è¯¥è¡¨ï¼Œè¯¥è¡¨å¾ˆå®¹æ˜“æˆä¸ºç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆï¼ŒåŒæ—¶å®ƒä¹Ÿå­˜åœ¨å•ç‚¹é—®é¢˜ï¼Œä¸€æ—¦è¯¥è¡¨æ•°æ®åº“å¤±æ•ˆï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºå°†æ— æ³•å·¥ä½œã€‚æœ‰äººæå‡ºä½¿ç”¨Master-Slaveè¿›è¡Œä¸»ä»åŒæ­¥ï¼Œä½†è¿™ä¹Ÿåªèƒ½è§£å†³å•ç‚¹é—®é¢˜ï¼Œå¹¶ä¸èƒ½è§£å†³è¯»å†™æ¯”ä¸º1:1çš„è®¿é—®å‹åŠ›é—®é¢˜ã€‚</p><ol start="3"><li>åˆ©ç”¨æ•°æ®åº“é›†ç¾¤å¹¶è®¾ç½®ç›¸åº”çš„æ­¥é•¿ï¼ˆFlickræ–¹æ¡ˆï¼‰</li></ol><p>ä¼˜ç‚¹ï¼šé«˜å¯ç”¨ã€IDè¾ƒç®€æ´ã€‚</p><p>ç¼ºç‚¹ï¼šéœ€è¦å•ç‹¬çš„æ•°æ®åº“é›†ç¾¤ã€‚</p><ol start="4"><li>Twitter Snowflake</li></ol><p>ä¼˜ç‚¹ï¼šé«˜æ€§èƒ½é«˜å¯ç”¨ã€æ˜“æ‹“å±•ã€‚</p><p>ç¼ºç‚¹ï¼šéœ€è¦ç‹¬ç«‹çš„é›†ç¾¤ä»¥åŠZKã€‚</p><blockquote><p><a href="http://blog.sina.com.cn/s/blog_6b7c2e660102vbi2.html" title="Title" target="_blank" rel="noopener">Twitterçš„åˆ†å¸ƒå¼è‡ªå¢IDç®—æ³•Snowflake</a></p><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œéœ€è¦ç”Ÿæˆå…¨å±€UIDçš„åœºåˆè¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œtwitterçš„snowflakeè§£å†³äº†è¿™ç§éœ€æ±‚ï¼Œå®ç°ä¹Ÿè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œé™¤å»é…ç½®ä¿¡æ¯ï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯æ¯«ç§’çº§æ—¶é—´41ä½ æœºå™¨ID 10ä½ æ¯«ç§’å†…åºåˆ—12ä½ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&gt;*</span> <span class="number">10</span><span class="bullet">---0000000000</span> <span class="number">0000000000</span> <span class="number">0000000000</span> <span class="number">0000000000</span> <span class="number">0</span> <span class="meta">---</span> <span class="number">00000</span> <span class="bullet">---00000</span> <span class="bullet">---000000000000</span></span><br><span class="line"><span class="string">&gt;</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>åœ¨ä¸Šé¢çš„å­—ç¬¦ä¸²ä¸­ï¼Œç¬¬ä¸€ä½ä¸ºæœªä½¿ç”¨ï¼ˆå®é™…ä¸Šä¹Ÿå¯ä½œä¸ºlongçš„ç¬¦å·ä½ï¼‰ï¼Œæ¥ä¸‹æ¥çš„41ä½ä¸ºæ¯«ç§’çº§æ—¶é—´ï¼Œç„¶å5ä½datacenteræ ‡è¯†ä½ï¼Œ5ä½æœºå™¨IDï¼ˆå¹¶ä¸ç®—æ ‡è¯†ç¬¦ï¼Œå®é™…æ˜¯ä¸ºçº¿ç¨‹æ ‡è¯†ï¼‰ï¼Œç„¶å12ä½è¯¥æ¯«ç§’å†…çš„å½“å‰æ¯«ç§’å†…çš„è®¡æ•°ï¼ŒåŠ èµ·æ¥åˆšå¥½64ä½ï¼Œä¸ºä¸€ä¸ªLongå‹ã€‚</p><p>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢æ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”ŸIDç¢°æ’ï¼ˆç”±datacenterå’Œæœºå™¨IDä½œåŒºåˆ†ï¼‰ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒé«˜ï¼Œç»æµ‹è¯•ï¼Œsnowflakeæ¯ç§’èƒ½å¤Ÿäº§ç”Ÿ26ä¸‡IDå·¦å³ï¼Œå®Œå…¨æ»¡è¶³éœ€è¦ã€‚</p></blockquote><ol start="5"><li>ä¸€å¤§æ³¢GUIDã€Randomç®—æ³•</li></ol><p>ä¼˜ç‚¹ï¼šç®€å•ã€‚</p><p>ç¼ºç‚¹ï¼šç”ŸæˆIDè¾ƒé•¿ï¼Œæœ‰é‡å¤å‡ ç‡ã€‚</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/24036067" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/24036067</a> åšä¸»å›¢é˜Ÿé‡‡ç”¨çš„ç­–ç•¥æ˜¯ï¼šæ—¶é—´æˆ³+ç”¨æˆ·æ ‡è¯†ç +éšæœºæ•°</p><p>ä¼˜ç‚¹æœ‰ï¼š</p><ul><li><p>æ–¹ä¾¿ã€æˆæœ¬ä½ã€‚</p></li><li><p>åŸºæœ¬æ— é‡å¤çš„å¯èƒ½ã€‚</p></li><li><p>è‡ªå¸¦åˆ†åº“è§„åˆ™ï¼Œè¿™é‡Œçš„ç”¨æˆ·æ ‡è¯†ç å³ä¸ºç”¨æˆ·IDçš„åå››ä½ï¼Œåœ¨æŸ¥è¯¢çš„åœºæ™¯ä¸‹ï¼Œåªéœ€è¦è®¢å•å·å°±å¯ä»¥åŒ¹é…åˆ°ç›¸åº”çš„åº“è¡¨è€Œæ— éœ€ç”¨æˆ·IDï¼Œåªå–å››ä½æ˜¯å¸Œæœ›è®¢</p></li><li><p>å•å·å°½å¯èƒ½çš„çŸ­ä¸€äº›ï¼Œå¹¶ä¸”è¯„ä¼°ä¸‹æ¥å››ä½å·²ç»è¶³å¤Ÿã€‚</p></li><li><p>å¯æ’åºï¼Œå› ä¸ºæ—¶é—´æˆ³åœ¨æœ€å‰é¢ã€‚</p></li></ul><p>å½“ç„¶ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚é•¿åº¦ç¨é•¿ï¼Œæ€§èƒ½è¦æ¯”int/bigintçš„ç¨å·®ç­‰ã€‚</p></blockquote><p><a href="https://www.cnblogs.com/mayundalao/p/11798502.html" target="_blank" rel="noopener">åˆ†å¸ƒå¼äº‹åŠ¡çš„å››ç§è§£å†³æ–¹æ¡ˆ</a></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†äº†åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³çŸ¥è¯†ï¼Œå†…å®¹åŒ…æ‹¬ï¼šACIDåˆ°CAP/BASEï¼Œ2PCäºŒé˜¶æ®µæäº¤ï¼Œ3PCä¸‰é˜¶æ®µæäº¤ï¼ŒPaxosç®—æ³•ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="unfinished" scheme="http://linyishui.top/tags/unfinished/"/>
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="transaction" scheme="http://linyishui.top/tags/transaction/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼é”</title>
    <link href="http://linyishui.top/2021042001.html"/>
    <id>http://linyishui.top/2021042001.html</id>
    <published>2021-04-20T13:26:57.000Z</published>
    <updated>2021-05-13T08:26:16.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å¹‚ç­‰"><a href="#å¹‚ç­‰" class="headerlink" title="å¹‚ç­‰"></a>å¹‚ç­‰</h2><p>æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆå«å¹‚ç­‰ï¼Ÿåœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­ï¼Œå¹‚ç­‰æ˜¯éå¸¸é‡è¦çš„ï¼Œä¹Ÿå°±æ˜¯ç›¸åŒæ¡ä»¶ä¸‹å¯¹ä¸€ä¸ªä¸šåŠ¡çš„æ“ä½œï¼Œä¸ç®¡æ“ä½œå¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·ã€‚</p><p>ä¸ºä»€ä¹ˆè¦æœ‰å¹‚ç­‰è¿™ç§åœºæ™¯ï¼Ÿå› ä¸ºåœ¨å¤§çš„ç³»ç»Ÿä¸­ï¼Œéƒ½æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¦‚ï¼šè®¢å•ä¸šåŠ¡ å’Œ åº“å­˜ä¸šåŠ¡æœ‰å¯èƒ½éƒ½æ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼Œéƒ½æ˜¯å•ç‹¬çš„æœåŠ¡ã€‚ç”¨æˆ·ä¸‹è®¢å•ï¼Œä¼šè°ƒç”¨åˆ°è®¢å•æœåŠ¡å’Œåº“å­˜æœåŠ¡ã€‚</p><p><img src="https://p6-tt.byteimg.com/origin/pgc-image/ee6b8a81617a444fb8bac512ee7d3ebd?from=pc" alt="æµ·é‡è®¢å•äº§ç”Ÿçš„ä¸šåŠ¡é«˜å³°æœŸï¼Œå¦‚ä½•é¿å…æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹ï¼Ÿ"></p><p>å› ä¸ºåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¾ˆæœ‰å¯èƒ½åœ¨è°ƒç”¨åº“å­˜æœåŠ¡æ—¶ï¼Œå› ä¸ºç½‘ç»œç­‰åŸå› ï¼Œè®¢å•æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œä½†å…¶å®åº“å­˜æœåŠ¡å·²ç»å¤„ç†å®Œæˆï¼Œåªæ˜¯è¿”å›ç»™è®¢å•æœåŠ¡å¤„ç†ç»“æœæ—¶å‡ºç°äº†å¼‚å¸¸ã€‚è¿™ä¸ªæ—¶å€™ä¸€èˆ¬ç³»ç»Ÿä¼šä½œè¡¥å¿æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯è®¢å•æœåŠ¡å†æ­¤æ”¾èµ·åº“å­˜æœåŠ¡çš„è°ƒç”¨,åº“å­˜å‡1.</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_goods <span class="keyword">set</span> <span class="built_in">count</span> = <span class="built_in">count</span> <span class="number">-1</span> <span class="keyword">where</span> good_id=<span class="number">2</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å‡ºç°äº†é—®é¢˜ï¼Œå…¶å®ä¸Šä¸€æ¬¡è°ƒç”¨å·²ç»å‡äº†1ï¼Œåªæ˜¯è®¢å•æœåŠ¡æ²¡æœ‰æ”¶åˆ°å¤„ç†ç»“æœã€‚ç°åœ¨åˆè°ƒç”¨ä¸€æ¬¡ï¼Œåˆè¦å‡1ï¼Œè¿™æ ·å°±ä¸ç¬¦åˆä¸šåŠ¡äº†ï¼Œå¤šæ‰£äº†ã€‚</p><p>å¹‚ç­‰è¿™ä¸ªæ¦‚å¿µå°±æ˜¯ï¼Œä¸ç®¡åº“å­˜æœåŠ¡åœ¨ç›¸åŒæ¡ä»¶ä¸‹è°ƒç”¨å‡ æ¬¡ï¼Œå¤„ç†ç»“æœéƒ½ä¸€æ ·ã€‚è¿™æ ·æ‰èƒ½ä¿è¯è¡¥å¿æ–¹æ¡ˆçš„å¯è¡Œæ€§ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="ä¹è§‚é”æ–¹æ¡ˆ"><a href="#ä¹è§‚é”æ–¹æ¡ˆ" class="headerlink" title="ä¹è§‚é”æ–¹æ¡ˆ"></a>ä¹è§‚é”æ–¹æ¡ˆ</h3><p>å€Ÿé‰´æ•°æ®åº“çš„ä¹è§‚é”æœºåˆ¶ï¼Œå¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_goods <span class="keyword">set</span> <span class="keyword">count</span> = <span class="keyword">count</span> <span class="number">-1</span> , <span class="keyword">version</span> = <span class="keyword">version</span> + <span class="number">1</span> <span class="keyword">where</span> good_id=<span class="number">2</span> <span class="keyword">and</span> <span class="keyword">version</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®versionç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯åœ¨æ“ä½œåº“å­˜å‰å…ˆè·å–å½“å‰å•†å“çš„versionç‰ˆæœ¬å·ï¼Œç„¶åæ“ä½œçš„æ—¶å€™å¸¦ä¸Šæ­¤versionå·ã€‚æˆ‘ä»¬æ¢³ç†ä¸‹ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡æ“ä½œåº“å­˜æ—¶ï¼Œå¾—åˆ°versionä¸º1ï¼Œè°ƒç”¨åº“å­˜æœåŠ¡versionå˜æˆäº†2ï¼›ä½†è¿”å›ç»™è®¢å•æœåŠ¡å‡ºç°äº†é—®é¢˜ï¼Œè®¢å•æœåŠ¡åˆä¸€æ¬¡å‘èµ·è°ƒç”¨åº“å­˜æœåŠ¡ï¼Œå½“è®¢å•æœåŠ¡ä¼ å¦‚çš„versionè¿˜æ˜¯1ï¼Œå†æ‰§è¡Œä¸Šé¢çš„sqlè¯­å¥æ—¶ï¼Œå°±ä¸ä¼šæ‰§è¡Œï¼›å› ä¸ºversionå·²ç»å˜ä¸º2äº†ï¼Œwhereæ¡ä»¶å°±ä¸æˆç«‹ã€‚è¿™æ ·å°±ä¿è¯äº†ä¸ç®¡è°ƒç”¨å‡ æ¬¡ï¼Œåªä¼šçœŸæ­£çš„å¤„ç†ä¸€æ¬¡ã€‚</p><h3 id="å”¯ä¸€ID-æŒ‡çº¹ç "><a href="#å”¯ä¸€ID-æŒ‡çº¹ç " class="headerlink" title="å”¯ä¸€ID + æŒ‡çº¹ç "></a>å”¯ä¸€ID + æŒ‡çº¹ç </h3><p>åŸç†å°±æ˜¯åˆ©ç”¨æ•°æ®åº“ä¸»é”®å»é‡ï¼Œä¸šåŠ¡å®Œæˆåæ’å…¥ä¸»é”®æ ‡è¯†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span> t_check <span class="keyword">where</span> <span class="keyword">ID</span>=å”¯ä¸€<span class="keyword">ID</span> + æŒ‡çº¹ç </span><br></pre></td></tr></table></figure><ul><li>å”¯ä¸€IDå°±æ˜¯ä¸šåŠ¡è¡¨çš„å”¯ä¸€çš„ä¸»é”®ï¼Œå¦‚å•†å“ID</li><li>æŒ‡çº¹ç å°±æ˜¯ä¸ºäº†åŒºåˆ«æ¯æ¬¡æ­£å¸¸æ“ä½œçš„ç ï¼Œæ¯æ¬¡æ“ä½œæ—¶ç”ŸæˆæŒ‡çº¹ç ï¼›å¯ä»¥ç”¨æ—¶é—´æˆ³+ä¸šåŠ¡ç¼–å·çš„æ–¹å¼ã€‚</li></ul><p>ä¸Šé¢çš„sqlè¯­å¥ï¼š</p><ul><li>è¿”å›å¦‚æœä¸º0 è¡¨ç¤ºæ²¡æœ‰æ“ä½œè¿‡ï¼Œé‚£ä¸šåŠ¡æ“ä½œåå°±å¯ä»¥insert into t_check(å”¯ä¸€ID+æŒ‡çº¹ç )</li><li>è¿”å›å¦‚æœå¤§äº0 è¡¨ç¤ºæ“ä½œè¿‡ï¼Œå°±ç›´æ¥è¿”å›</li></ul><p>å¥½å¤„ï¼šå®ç°ç®€å•</p><p>åå¤„ï¼šé«˜å¹¶å‘ä¸‹æ•°æ®åº“ç“¶é¢ˆ</p><p>è§£å†³æ–¹æ¡ˆï¼šæ ¹æ®IDè¿›è¡Œåˆ†åº“åˆ†è¡¨è¿›è¡Œç®—æ³•è·¯ç”±</p><h3 id="redisåŸå­æ“ä½œ"><a href="#redisåŸå­æ“ä½œ" class="headerlink" title="redisåŸå­æ“ä½œ"></a>redisåŸå­æ“ä½œ</h3><p>åˆ©ç”¨redisçš„åŸå­æ“ä½œï¼Œåšä¸ªæ“ä½œå®Œæˆçš„æ ‡è®°ã€‚è¿™ä¸ªæ€§èƒ½å°±æ¯”è¾ƒå¥½ã€‚ä½†ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚</p><p>ç¬¬ä¸€ï¼šæˆ‘ä»¬æ˜¯å¦éœ€è¦æŠŠä¸šåŠ¡ç»“æœè¿›è¡Œæ•°æ®è½åº“ï¼Œå¦‚æœè½åº“ï¼Œå…³é”®è§£å†³çš„é—®é¢˜æ—¶æ•°æ®åº“å’Œredisæ“ä½œå¦‚ä½•åšåˆ°åŸå­æ€§ï¼Ÿ</p><blockquote><p>è¿™ä¸ªæ„æ€å°±æ˜¯åº“å­˜å‡1äº†ï¼Œä½†redisè¿›è¡Œæ“ä½œå®Œæˆæ ‡è®°æ—¶ï¼Œå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿä¹Ÿå°±æ˜¯ä¸€å®šè¦ä¿è¯è½åº“å’Œredis è¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥</p></blockquote><p>ç¬¬äºŒï¼šå¦‚æœä¸è¿›è¡Œè½åº“ï¼Œé‚£ä¹ˆéƒ½å­˜å‚¨åˆ°ç¼“å­˜ä¸­ï¼Œå¦‚ä½•è®¾ç½®å®šæ—¶åŒæ­¥ç­–ç•¥ï¼Ÿ</p><blockquote><p>è¿™ä¸ªæ„æ€å°±æ˜¯åº“å­˜å‡1ï¼Œä¸è½åº“ï¼Œç›´æ¥å…ˆæ“ä½œredisæ“ä½œå®Œæˆæ ‡è®°ï¼Œç„¶åç”±å¦å¤–çš„åŒæ­¥æœåŠ¡è¿›è¡Œåº“å­˜è½åº“ï¼Œè¿™ä¸ªå°±æ˜¯å¢åŠ äº†ç³»ç»Ÿå¤æ‚æ€§ï¼Œè€Œä¸”åŒæ­¥ç­–ç•¥å¦‚ä½•è®¾ç½®</p></blockquote><ul><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/zhishixingqiu/%3Fzhihu" target="_blank" rel="noopener">ã€ŠJava 2019 è¶…ç¥ä¹‹è·¯ã€‹</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/Dubbo/good-collection/%3Fzhihu" target="_blank" rel="noopener">ã€ŠDubbo å®ç°åŸç†ä¸æºç è§£æ â€”â€” ç²¾å“åˆé›†ã€‹</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/Spring/good-collection/%3Fzhihu" target="_blank" rel="noopener">ã€ŠSpring å®ç°åŸç†ä¸æºç è§£æ â€”â€” ç²¾å“åˆé›†ã€‹</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/MyBatis/good-collection/%3Fzhihu" target="_blank" rel="noopener">ã€ŠMyBatis å®ç°åŸç†ä¸æºç è§£æ â€”â€” ç²¾å“åˆé›†ã€‹</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/Spring-MVC/good-collection/%3Fzhihu" target="_blank" rel="noopener">ã€ŠSpring MVC å®ç°åŸç†ä¸æºç è§£æ â€”â€” ç²¾å“åˆé›†ã€‹</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/Spring-Boot/good-collection/%3Fzhihu" target="_blank" rel="noopener">ã€ŠSpring Boot å®ç°åŸç†ä¸æºç è§£æ â€”â€” ç²¾å“åˆé›†ã€‹</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/Entity/good-collection/%3Fzhihu" target="_blank" rel="noopener">ã€Šæ•°æ®åº“å®ä½“è®¾è®¡åˆé›†ã€‹</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/Interview/good-collection/%3Fzhihu" target="_blank" rel="noopener">ã€ŠJava é¢è¯•é¢˜ â€”â€” ç²¾å“åˆé›†ã€‹</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.iocoder.cn/Interview/good-collection/%3Fzhihu" target="_blank" rel="noopener">ã€ŠJava å­¦ä¹ æŒ‡å— â€”â€” ç²¾å“åˆé›†ã€‹</a></li></ul><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†äº†åˆ†å¸ƒå¼é”ç›¸å…³çŸ¥è¯†ï¼Œå†…å®¹åŒ…æ‹¬ï¼šç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="lock" scheme="http://linyishui.top/tags/lock/"/>
    
      <category term="unfinished" scheme="http://linyishui.top/tags/unfinished/"/>
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ä¸€è‡´æ€§</title>
    <link href="http://linyishui.top/2021041901.html"/>
    <id>http://linyishui.top/2021041901.html</id>
    <published>2021-04-19T13:26:49.000Z</published>
    <updated>2021-05-13T08:24:46.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="åˆ†å¸ƒå¼ä¸€è‡´æ€§"><a href="#åˆ†å¸ƒå¼ä¸€è‡´æ€§" class="headerlink" title="åˆ†å¸ƒå¼ä¸€è‡´æ€§"></a>åˆ†å¸ƒå¼ä¸€è‡´æ€§</h1><h2 id="ä¸€-å¼•æ–‡"><a href="#ä¸€-å¼•æ–‡" class="headerlink" title="ä¸€. å¼•æ–‡"></a>ä¸€. å¼•æ–‡</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿ</h3><p>å¹¶å‘ï¼šå½“é€»è¾‘æ§åˆ¶æµï¼ˆä¸€æ¬¡ç¨‹åºæ“ä½œï¼Œå¦‚è¯»å–æˆ–æ›´æ–°å†…å­˜å˜é‡çš„å€¼ï¼‰åœ¨æ—¶é—´ä¸Šé‡å ï¼Œé‚£å®ƒå°±æ˜¯å¹¶å‘çš„ã€‚</p><p>ä¸€èˆ¬å¹¶å‘éƒ½ç‰¹æŒ‡æ›´æ–°æ“ä½œçš„å¹¶å‘ï¼Œå³æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°å†…å­˜ä¸­å˜é‡çš„å€¼ã€‚</p><h3 id="1-2-æ•°æ®å¤åˆ¶å»¶æ—¶é—®é¢˜"><a href="#1-2-æ•°æ®å¤åˆ¶å»¶æ—¶é—®é¢˜" class="headerlink" title="1.2 æ•°æ®å¤åˆ¶å»¶æ—¶é—®é¢˜"></a>1.2 æ•°æ®å¤åˆ¶å»¶æ—¶é—®é¢˜</h3><p>æ•°æ®å¤åˆ¶ä¸€èˆ¬ä¼šæœ‰å»¶æ—¶é—®é¢˜ï¼Œå³æ— æ³•åŠæ—¶è¯»å–åˆ°æ›´æ–°åçš„æœ€æ–°æ•°æ®ã€‚</p><h3 id="1-3-åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜"><a href="#1-3-åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="1.3 åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜"></a>1.3 åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸€èˆ¬é‡‡ç”¨æ•°æ®å¤åˆ¶éƒ½æ˜¯åŸºäºä¸¤ç±»éœ€æ±‚ï¼š</p><ul><li>å¢åŠ ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœå¼•èµ·çš„ç³»ç»Ÿä¸å¯ç”¨ï¼›</li><li>æä¾›ç³»ç»Ÿæ•´ä½“æ€§èƒ½ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œè®©åˆ†å¸ƒåœ¨ä¸åŒä½ç½®çš„æ•°æ®å‰¯æœ¬éƒ½ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚</li></ul><p><strong>åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜</strong>ï¼šåœ¨<strong>åˆ†å¸ƒå¼ç¯å¢ƒ</strong>å¼•å…¥<strong>æ•°æ®å¤åˆ¶æœºåˆ¶</strong>åï¼Œä¸åŒæ•°æ®èŠ‚ç‚¹é—´å¯èƒ½å‡ºç°çš„ï¼Œå¹¶æ— æ³•ä¾é åº”ç”¨ç¨‹åºè‡ªèº«è§£å†³çš„<strong>æ•°æ®ä¸ä¸€è‡´æƒ…å†µ</strong>ã€‚</p><p><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šæŒ‡å¯¹ä¸€ä¸ªå‰¯æœ¬æ•°æ®è¿›è¡Œæ›´æ–°çš„åŒæ—¶ï¼Œå¿…é¡»ç¡®ä¿èƒ½å¤Ÿæ›´æ–°å…¶ä»–çš„å‰¯æœ¬ã€‚</p><h3 id="1-4-å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ"><a href="#1-4-å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ" class="headerlink" title="1.4 å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ"></a>1.4 å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</h3><p>æ—¢ç„¶æ˜¯ç”±äºå»¶æ—¶å¼•èµ·çš„é—®é¢˜ï¼Œå¯ä»¥å°†å†™å…¥çš„åŠ¨ä½œé˜»å¡ï¼Œç›´åˆ°æ•°æ®å¤åˆ¶å®Œæˆåï¼Œæ‰å®Œæˆå†™å…¥åŠ¨ä½œã€‚</p><p>è¿™æ ·èƒ½è§£å†³é—®é¢˜ï¼Œä½†å¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼š<strong>å†™å…¥çš„æ€§èƒ½å¾ˆå·®</strong>ã€‚åç»­çš„å†™è¯·æ±‚éƒ½è¦é˜»å¡åœ¨å‰ä¸€ä¸ªè¯·æ±‚çš„å†™æ“ä½œä¸Šï¼Œä¸é€‚ç”¨äºæœ‰å¤§é‡å†™è¯·æ±‚çš„åœºæ™¯ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œä¸å½±å“ç³»ç»Ÿè¿è¡Œçš„æ€§èƒ½é—´åšä¸€ä¸ªæƒè¡¡ï¼Œä»è€Œåˆ’åˆ†å‡º<strong>ä¸€è‡´æ€§çº§åˆ«</strong>ï¼š</p><ul><li>å¼ºä¸€è‡´æ€§ï¼šç³»ç»Ÿå†™å…¥ä»€ä¹ˆï¼Œè¯»å‡ºæ¥å°±æ˜¯ä»€ä¹ˆï¼Œä¼šå¯¹æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ã€‚</li><li>å¼±ä¸€è‡´æ€§ï¼šç³»ç»Ÿå†™å…¥æˆåŠŸåä¸ä¿è¯å¯ä»¥ç«‹åˆ»è¯»åˆ°å†™å…¥çš„å€¼ï¼Œåªå°½å¯èƒ½çš„ä¿è¯åœ¨æŸä¸ªæ—¶é—´çº§åˆ«ï¼ˆå¦‚ç§’çº§åˆ«ï¼‰åï¼Œæ•°æ®èƒ½è¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€ï¼Œç»†åˆ†ï¼š<ul><li>ä¼šè¯ä¸€è‡´æ€§ï¼šåªä¿è¯å¯¹äºå†™å…¥çš„å€¼ï¼Œåœ¨åŒä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯ä¸­å¯ä»¥è¯»å–åˆ°ä¸€è‡´çš„å€¼ï¼Œå…¶ä»–ä¼šè¯ä¸èƒ½ä¿è¯ã€‚</li><li>ç”¨æˆ·ä¸€è‡´æ€§ï¼šåªä¿è¯å¯¹äºå†™å…¥çš„å€¼ï¼Œåœ¨åŒä¸€ä¸ªç”¨æˆ·ä¸­å¯ä»¥è¯»å–åˆ°ä¸€è‡´çš„å€¼ï¼Œå…¶ä»–ç”¨æˆ·ä¸èƒ½ä¿è¯ã€‚</li></ul></li><li>æœ€ç»ˆä¸€è‡´æ€§ï¼šç‰¹æ®Šçš„å¼±ä¸€è‡´æ€§ï¼Œéå¸¸é‡è¦çš„ä¸€ç§ä¸€è‡´æ€§æ¨¡å‹ã€‚</li></ul><p>æ¥ä¸‹æ¥å¼•å…¥å‡ ç§å…¸å‹çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®ï¼Œå­¦ä¹ å®ƒä»¬æ˜¯å¦‚ä½•è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ã€‚</p><p>## </p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šä»Paxosåˆ°Zookeeper-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</p>]]></content>
    
    <summary type="html">
    
      ç®€å•æ•´ç†äº†åˆ†å¸ƒå¼ä¸€è‡´æ€§ç›¸å…³çŸ¥è¯†ï¼Œå†…å®¹åŒ…æ‹¬ï¼šå¼•æ–‡ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="unfinished" scheme="http://linyishui.top/tags/unfinished/"/>
    
      <category term="distributed" scheme="http://linyishui.top/tags/distributed/"/>
    
      <category term="consistency" scheme="http://linyishui.top/tags/consistency/"/>
    
  </entry>
  
  <entry>
    <title>åŠ¨æ€è§„åˆ’ï¼ˆæœªå®Œæˆï¼‰</title>
    <link href="http://linyishui.top/2021031501.html"/>
    <id>http://linyishui.top/2021031501.html</id>
    <published>2021-03-15T13:57:00.000Z</published>
    <updated>2021-05-13T08:21:22.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h1><h2 id="ä¸€-æ¦‚è¿°"><a href="#ä¸€-æ¦‚è¿°" class="headerlink" title="ä¸€. æ¦‚è¿°"></a>ä¸€. æ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’ï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’ï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’ï¼Ÿ</h3><p><strong>åŠ¨æ€è§„åˆ’</strong>ï¼ˆè‹±è¯­ï¼šDynamic Programmingï¼Œç®€ç§°DPï¼‰æ˜¯ä¸€ç§<strong>é€šè¿‡æŠŠåŸé—®é¢˜åˆ†è§£ä¸ºç›¸å¯¹ç®€å•çš„å­é—®é¢˜çš„æ–¹å¼æ±‚è§£å¤æ‚é—®é¢˜çš„æ–¹æ³•</strong>ã€‚å¸¸å¸¸é€‚ç”¨äº<strong>æœ‰é‡å å­é—®é¢˜</strong>å’Œ<strong>æœ€ä¼˜å­ç»“æ„</strong>ï¼ˆOptimal substructureï¼‰æ€§è´¨çš„é—®é¢˜ï¼ŒåŠ¨æ€è§„åˆ’æ–¹æ³•æ‰€è€—æ—¶é—´å¾€å¾€è¿œå°‘äºæœ´ç´ è§£æ³•ã€‚</p><p>åœ¨20ä¸–çºª50å¹´ä»£åˆï¼Œç”±ç¾å›½æ•°å­¦å®¶è´å°”æ›¼ï¼ˆR.Bellmanï¼‰ç­‰äººåœ¨ç ”ç©¶å¤šé˜¶æ®µå†³ç­–è¿‡ç¨‹çš„ä¼˜åŒ–é—®é¢˜æ—¶ï¼Œæå‡ºäº†è‘—åçš„æœ€ä¼˜åŒ–åŸç†ï¼Œä»è€Œåˆ›ç«‹äº†åŠ¨æ€è§„åˆ’ã€‚</p><p>åŠ¨æ€è§„åˆ’èƒŒåçš„åŸºæœ¬æ€æƒ³éå¸¸ç®€å•ã€‚å¤§è‡´ä¸Šï¼Œè‹¥è¦è§£ä¸€ä¸ªç»™å®šé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è§£å…¶ä¸åŒéƒ¨åˆ†ï¼ˆå³å­é—®é¢˜ï¼‰ï¼Œå†æ ¹æ®å­é—®é¢˜çš„è§£ä»¥å¾—å‡ºåŸé—®é¢˜çš„è§£ã€‚</p><p>é€šå¸¸è®¸å¤šå­é—®é¢˜éå¸¸ç›¸ä¼¼ï¼Œä¸ºæ­¤åŠ¨æ€è§„åˆ’æ³•è¯•å›¾ä»…ä»…è§£å†³æ¯ä¸ªå­é—®é¢˜ä¸€æ¬¡ï¼Œä»è€Œå‡å°‘è®¡ç®—é‡ï¼š<strong>ä¸€æ—¦æŸä¸ªç»™å®šå­é—®é¢˜çš„è§£å·²ç»ç®—å‡ºï¼Œåˆ™å°†å…¶è®°å¿†åŒ–å­˜å‚¨ï¼Œä»¥ä¾¿ä¸‹æ¬¡éœ€è¦åŒä¸€ä¸ªå­é—®é¢˜è§£ä¹‹æ—¶ç›´æ¥æŸ¥è¡¨</strong>ã€‚è¿™ç§åšæ³•åœ¨é‡å¤å­é—®é¢˜çš„æ•°ç›®å…³äºè¾“å…¥çš„è§„æ¨¡å‘ˆæŒ‡æ•°å¢é•¿æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="æ¦‚å¿µå¼•å…¥"><a href="#æ¦‚å¿µå¼•å…¥" class="headerlink" title="æ¦‚å¿µå¼•å…¥"></a>æ¦‚å¿µå¼•å…¥</h3><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæœ‰ä¸€ç±»æ´»åŠ¨çš„è¿‡ç¨‹ï¼Œç”±äºå®ƒçš„ç‰¹æ®Šæ€§ï¼Œå¯å°†è¿‡ç¨‹åˆ†æˆè‹¥å¹²ä¸ªäº’ç›¸è”ç³»çš„é˜¶æ®µï¼Œåœ¨å®ƒçš„æ¯ä¸€é˜¶æ®µéƒ½éœ€è¦ä½œå‡ºå†³ç­–ï¼Œä»è€Œä½¿æ•´ä¸ªè¿‡ç¨‹è¾¾åˆ°æœ€å¥½çš„æ´»åŠ¨æ•ˆæœã€‚å› æ­¤å„ä¸ªé˜¶æ®µå†³ç­–çš„é€‰å–ä¸èƒ½ä»»æ„ç¡®å®šï¼Œå®ƒä¾èµ–äºå½“å‰é¢ä¸´çš„çŠ¶æ€ï¼Œåˆå½±å“ä»¥åçš„å‘å±•ã€‚å½“å„ä¸ªé˜¶æ®µå†³ç­–ç¡®å®šåï¼Œå°±ç»„æˆä¸€ä¸ªå†³ç­–åºåˆ—ï¼Œå› è€Œä¹Ÿå°±ç¡®å®šäº†æ•´ä¸ªè¿‡ç¨‹çš„ä¸€æ¡æ´»åŠ¨è·¯çº¿ï¼è¿™ç§æŠŠä¸€ä¸ªé—®é¢˜çœ‹ä½œæ˜¯ä¸€ä¸ªå‰åå…³è”å…·æœ‰é“¾çŠ¶ç»“æ„çš„å¤šé˜¶æ®µè¿‡ç¨‹å°±ç§°ä¸ºå¤šé˜¶æ®µå†³ç­–è¿‡ç¨‹ï¼Œè¿™ç§é—®é¢˜ç§°ä¸ºå¤šé˜¶æ®µå†³ç­–é—®é¢˜ã€‚åœ¨å¤šé˜¶æ®µå†³ç­–é—®é¢˜ä¸­ï¼Œå„ä¸ªé˜¶æ®µé‡‡å–çš„å†³ç­–ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯ä¸æ—¶é—´æœ‰å…³çš„ï¼Œå†³ç­–ä¾èµ–äºå½“å‰çŠ¶æ€ï¼Œåˆéšå³å¼•èµ·çŠ¶æ€çš„è½¬ç§»ï¼Œä¸€ä¸ªå†³ç­–åºåˆ—å°±æ˜¯åœ¨å˜åŒ–çš„çŠ¶æ€ä¸­äº§ç”Ÿå‡ºæ¥çš„ï¼Œæ•…æœ‰â€œåŠ¨æ€â€çš„å«ä¹‰ï¼Œç§°è¿™ç§è§£å†³å¤šé˜¶æ®µå†³ç­–æœ€ä¼˜åŒ–çš„è¿‡ç¨‹ä¸ºåŠ¨æ€è§„åˆ’æ–¹æ³• [4] ã€‚</p><h3 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h3><p>åŠ¨æ€è§„åˆ’ç®—æ³•é€šå¸¸ç”¨äºæ±‚è§£å…·æœ‰æŸç§æœ€ä¼˜æ€§è´¨çš„é—®é¢˜ã€‚åœ¨è¿™ç±»é—®é¢˜ä¸­ï¼Œå¯èƒ½ä¼šæœ‰è®¸å¤šå¯è¡Œè§£ã€‚æ¯ä¸€ä¸ªè§£éƒ½å¯¹åº”äºä¸€ä¸ªå€¼ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°å…·æœ‰<a href="https://baike.baidu.com/item/æœ€ä¼˜å€¼" target="_blank" rel="noopener">æœ€ä¼˜å€¼</a>çš„è§£ã€‚åŠ¨æ€è§„åˆ’ç®—æ³•ä¸<a href="https://baike.baidu.com/item/åˆ†æ²»æ³•" target="_blank" rel="noopener">åˆ†æ²»æ³•</a>ç±»ä¼¼ï¼Œå…¶åŸºæœ¬æ€æƒ³ä¹Ÿæ˜¯å°†å¾…æ±‚è§£é—®é¢˜åˆ†è§£æˆè‹¥å¹²ä¸ªå­é—®é¢˜ï¼Œå…ˆæ±‚è§£å­é—®é¢˜ï¼Œç„¶åä»<a href="https://baike.baidu.com/item/è¿™äº›å­" target="_blank" rel="noopener">è¿™äº›å­</a>é—®é¢˜çš„è§£å¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚ä¸åˆ†æ²»æ³•ä¸åŒçš„æ˜¯ï¼Œé€‚åˆäºç”¨åŠ¨æ€è§„åˆ’æ±‚è§£çš„é—®é¢˜ï¼Œç»åˆ†è§£å¾—åˆ°å­é—®é¢˜å¾€å¾€ä¸æ˜¯äº’ç›¸ç‹¬ç«‹çš„ã€‚è‹¥ç”¨åˆ†æ²»æ³•æ¥è§£è¿™ç±»é—®é¢˜ï¼Œåˆ™åˆ†è§£å¾—åˆ°çš„å­é—®é¢˜æ•°ç›®å¤ªå¤šï¼Œæœ‰äº›å­é—®é¢˜è¢«é‡å¤è®¡ç®—äº†å¾ˆå¤šæ¬¡ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä¿å­˜å·²è§£å†³çš„å­é—®é¢˜çš„ç­”æ¡ˆï¼Œè€Œåœ¨éœ€è¦æ—¶å†æ‰¾å‡ºå·²æ±‚å¾—çš„ç­”æ¡ˆï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¤§é‡çš„é‡å¤è®¡ç®—ï¼ŒèŠ‚çœæ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªè¡¨æ¥è®°å½•æ‰€æœ‰å·²è§£çš„å­é—®é¢˜çš„ç­”æ¡ˆã€‚ä¸ç®¡è¯¥å­é—®é¢˜ä»¥åæ˜¯å¦è¢«ç”¨åˆ°ï¼Œåªè¦å®ƒè¢«è®¡ç®—è¿‡ï¼Œå°±å°†å…¶ç»“æœå¡«å…¥è¡¨ä¸­ã€‚è¿™å°±æ˜¯åŠ¨æ€è§„åˆ’æ³•çš„åŸºæœ¬æ€è·¯ã€‚å…·ä½“çš„åŠ¨æ€è§„åˆ’ç®—æ³•å¤šç§å¤šæ ·ï¼Œä½†å®ƒä»¬å…·æœ‰ç›¸åŒçš„å¡«è¡¨æ ¼å¼ [5] ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><ul><li><strong>å¤šé˜¶æ®µå†³ç­–é—®é¢˜</strong></li></ul><p>å¦‚æœä¸€ç±»æ´»åŠ¨è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºè‹¥å¹²ä¸ªäº’ç›¸è”ç³»çš„é˜¶æ®µï¼Œåœ¨æ¯ä¸€ä¸ªé˜¶æ®µéƒ½éœ€ä½œå‡ºå†³ç­–ï¼ˆé‡‡å–æªæ–½ï¼‰ï¼Œä¸€ä¸ªé˜¶æ®µçš„å†³ç­–ç¡®å®šä»¥åï¼Œå¸¸å¸¸å½±å“åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µçš„å†³ç­–ï¼Œä»è€Œå°±å®Œå…¨ç¡®å®šäº†ä¸€ä¸ªè¿‡ç¨‹çš„æ´»åŠ¨è·¯çº¿ï¼Œåˆ™ç§°å®ƒä¸ºå¤šé˜¶æ®µå†³ç­–é—®é¢˜ [6] ã€‚</p><p>å„ä¸ªé˜¶æ®µçš„å†³ç­–æ„æˆä¸€ä¸ªå†³ç­–åºåˆ—ï¼Œç§°ä¸ºä¸€ä¸ªç­–ç•¥ã€‚æ¯ä¸€ä¸ªé˜¶æ®µéƒ½æœ‰è‹¥å¹²ä¸ªå†³ç­–å¯ä¾›é€‰æ‹©ï¼Œå› è€Œå°±æœ‰è®¸å¤šç­–ç•¥ä¾›æˆ‘ä»¬é€‰å–ï¼Œå¯¹åº”äºä¸€ä¸ªç­–ç•¥å¯ä»¥ç¡®å®šæ´»åŠ¨çš„æ•ˆæœï¼Œè¿™ä¸ªæ•ˆæœå¯ä»¥ç”¨æ•°é‡æ¥ç¡®å®šã€‚ç­–ç•¥ä¸åŒï¼Œæ•ˆæœä¹Ÿä¸åŒï¼Œå¤šé˜¶æ®µå†³ç­–é—®é¢˜ï¼Œå°±æ˜¯è¦åœ¨å¯ä»¥é€‰æ‹©çš„é‚£äº›ç­–ç•¥ä¸­é—´ï¼Œé€‰å–ä¸€ä¸ªæœ€ä¼˜ç­–ç•¥ï¼Œä½¿åœ¨é¢„å®šçš„æ ‡å‡†ä¸‹è¾¾åˆ°æœ€å¥½çš„æ•ˆæœ [6] ã€‚</p><ul><li><strong>åŠ¨æ€è§„åˆ’é—®é¢˜ä¸­çš„æœ¯è¯­</strong></li></ul><p><a href="https://baike.baidu.com/item/é˜¶æ®µ" target="_blank" rel="noopener">é˜¶æ®µ</a>ï¼šæŠŠæ‰€ç»™æ±‚è§£é—®é¢˜çš„è¿‡ç¨‹æ°å½“åœ°åˆ†æˆè‹¥å¹²ä¸ªç›¸äº’è”ç³»çš„é˜¶æ®µï¼Œä»¥ä¾¿äºæ±‚è§£ï¼Œè¿‡ç¨‹ä¸åŒï¼Œé˜¶æ®µæ•°å°±å¯èƒ½ä¸åŒï¼æè¿°é˜¶æ®µçš„å˜é‡ç§°ä¸ºé˜¶æ®µå˜é‡ã€‚åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œé˜¶æ®µå˜é‡æ˜¯ç¦»æ•£çš„ï¼Œç”¨kè¡¨ç¤ºã€‚æ­¤å¤–ï¼Œä¹Ÿæœ‰é˜¶æ®µå˜é‡æ˜¯è¿ç»­çš„æƒ…å½¢ã€‚å¦‚æœè¿‡ç¨‹å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»ä½œå‡ºå†³ç­–ï¼Œä¸”åœ¨ä»»æ„ä¸¤ä¸ªä¸åŒçš„æ—¶åˆ»ä¹‹é—´å…è®¸æœ‰æ— ç©·å¤šä¸ªå†³ç­–æ—¶ï¼Œé˜¶æ®µå˜é‡å°±æ˜¯è¿ç»­çš„ [6] ã€‚</p><p><a href="https://baike.baidu.com/item/çŠ¶æ€" target="_blank" rel="noopener">çŠ¶æ€</a>ï¼šçŠ¶æ€è¡¨ç¤ºæ¯ä¸ªé˜¶æ®µå¼€å§‹é¢ä¸´çš„è‡ªç„¶çŠ¶å†µæˆ–å®¢è§‚æ¡ä»¶ï¼Œå®ƒä¸ä»¥äººä»¬çš„ä¸»è§‚æ„å¿—ä¸ºè½¬ç§»ï¼Œä¹Ÿç§°ä¸ºä¸å¯æ§å› ç´ ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­çŠ¶æ€å°±æ˜¯æŸé˜¶æ®µçš„å‡ºå‘ä½ç½®ï¼Œå®ƒæ—¢æ˜¯è¯¥é˜¶æ®µæŸè·¯çš„èµ·ç‚¹ï¼ŒåŒæ—¶åˆæ˜¯å‰ä¸€é˜¶æ®µæŸæ”¯è·¯çš„ç»ˆç‚¹ [6] ã€‚</p><p><a href="https://baike.baidu.com/item/æ— åæ•ˆæ€§" target="_blank" rel="noopener">æ— åæ•ˆæ€§</a>ï¼šæˆ‘ä»¬è¦æ±‚çŠ¶æ€å…·æœ‰ä¸‹é¢çš„æ€§è´¨ï¼šå¦‚æœç»™å®šæŸä¸€é˜¶æ®µçš„çŠ¶æ€ï¼Œåˆ™åœ¨è¿™ä¸€é˜¶æ®µä»¥åè¿‡ç¨‹çš„å‘å±•ä¸å—è¿™é˜¶æ®µä»¥å‰å„æ®µçŠ¶æ€çš„å½±å“ï¼Œæ‰€æœ‰å„é˜¶æ®µéƒ½ç¡®å®šæ—¶ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¹Ÿå°±ç¡®å®šäº†ã€‚æ¢å¥è¯è¯´ï¼Œè¿‡ç¨‹çš„æ¯ä¸€æ¬¡å®ç°å¯ä»¥ç”¨ä¸€ä¸ªçŠ¶æ€åºåˆ—è¡¨ç¤ºï¼Œåœ¨å‰é¢çš„ä¾‹å­ä¸­æ¯é˜¶æ®µçš„çŠ¶æ€æ˜¯è¯¥çº¿è·¯çš„å§‹ç‚¹ï¼Œç¡®å®šäº†è¿™äº›ç‚¹çš„åºåˆ—ï¼Œæ•´ä¸ªçº¿è·¯ä¹Ÿå°±å®Œå…¨ç¡®å®šã€‚ä»æŸä¸€é˜¶æ®µä»¥åçš„çº¿è·¯å¼€å§‹ï¼Œå½“è¿™æ®µçš„å§‹ç‚¹ç»™å®šæ—¶ï¼Œä¸å—ä»¥å‰çº¿è·¯ï¼ˆæ‰€é€šè¿‡çš„ç‚¹ï¼‰çš„å½±å“ã€‚çŠ¶æ€çš„è¿™ä¸ªæ€§è´¨æ„å‘³ç€è¿‡ç¨‹çš„å†å²åªèƒ½é€šè¿‡å½“å‰çš„çŠ¶æ€å»å½±å“å®ƒçš„æœªæ¥çš„å‘å±•ï¼Œè¿™ä¸ªæ€§è´¨ç§°ä¸ºæ— åæ•ˆæ€§ [6] ã€‚</p><p><a href="https://baike.baidu.com/item/å†³ç­–" target="_blank" rel="noopener">å†³ç­–</a>ï¼šä¸€ä¸ªé˜¶æ®µçš„çŠ¶æ€ç»™å®šä»¥åï¼Œä»è¯¥çŠ¶æ€æ¼”å˜åˆ°ä¸‹ä¸€é˜¶æ®µæŸä¸ªçŠ¶æ€çš„ä¸€ç§é€‰æ‹©ï¼ˆè¡ŒåŠ¨ï¼‰ç§°ä¸ºå†³ç­–ã€‚åœ¨æœ€ä¼˜æ§åˆ¶ä¸­ï¼Œä¹Ÿç§°ä¸ºæ§åˆ¶ã€‚åœ¨è®¸å¤šé—®é¢˜ä¸­ï¼Œå†³ç­–å¯ä»¥è‡ªç„¶è€Œç„¶åœ°è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°æˆ–ä¸€ç»„æ•°ã€‚ä¸åŒçš„å†³ç­–å¯¹åº”ç€ä¸åŒçš„æ•°å€¼ã€‚æè¿°å†³ç­–çš„å˜é‡ç§°<a href="https://baike.baidu.com/item/å†³ç­–å˜é‡" target="_blank" rel="noopener">å†³ç­–å˜é‡</a>ï¼Œå› çŠ¶æ€æ»¡è¶³æ— åæ•ˆæ€§ï¼Œæ•…åœ¨æ¯ä¸ªé˜¶æ®µé€‰æ‹©å†³ç­–æ—¶åªéœ€è€ƒè™‘å½“å‰çš„çŠ¶æ€è€Œæ— é¡»è€ƒè™‘è¿‡ç¨‹çš„å†å² [6] ã€‚</p><p>å†³ç­–å˜é‡çš„èŒƒå›´ç§°ä¸ºå…è®¸å†³ç­–é›†åˆ [6] ã€‚</p><p><a href="https://baike.baidu.com/item/ç­–ç•¥" target="_blank" rel="noopener">ç­–ç•¥</a>ï¼šç”±æ¯ä¸ªé˜¶æ®µçš„å†³ç­–ç»„æˆçš„åºåˆ—ç§°ä¸ºç­–ç•¥ã€‚å¯¹äºæ¯ä¸€ä¸ªå®é™…çš„å¤šé˜¶æ®µå†³ç­–è¿‡ç¨‹ï¼Œå¯ä¾›é€‰å–çš„ç­–ç•¥æœ‰ä¸€å®šçš„èŒƒå›´é™åˆ¶ï¼Œè¿™ä¸ªèŒƒå›´ç§°ä¸ºå…è®¸ç­–ç•¥é›†åˆ [6] ã€‚</p><p>å…è®¸ç­–ç•¥é›†åˆä¸­è¾¾åˆ°æœ€ä¼˜æ•ˆæœçš„ç­–ç•¥ç§°ä¸ºæœ€ä¼˜ç­–ç•¥ [6] ã€‚</p><p>ç»™å®šké˜¶æ®µçŠ¶æ€å˜é‡x(k)çš„å€¼åï¼Œå¦‚æœè¿™ä¸€é˜¶æ®µçš„å†³ç­–å˜é‡ä¸€ç»ç¡®å®šï¼Œç¬¬k+1é˜¶æ®µçš„çŠ¶æ€å˜é‡x(k+1)ä¹Ÿå°±å®Œå…¨ç¡®å®šï¼Œå³x(k+1)çš„å€¼éšx(k)å’Œç¬¬ké˜¶æ®µçš„å†³ç­–u(k)çš„å€¼å˜åŒ–è€Œå˜åŒ–ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™ä¸€å…³ç³»çœ‹æˆ(x(k)ï¼Œu(k))ä¸x(k+1)ç¡®å®šçš„å¯¹åº”å…³ç³»ï¼Œç”¨x(k+1)=Tk(x(k),u(k))è¡¨ç¤ºã€‚è¿™æ˜¯ä»ké˜¶æ®µåˆ°k+1é˜¶æ®µçš„çŠ¶æ€è½¬ç§»è§„å¾‹ï¼Œç§°ä¸ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ [6] ã€‚</p><p>æœ€ä¼˜åŒ–åŸç†ï¼šä½œä¸ºæ•´ä¸ªè¿‡ç¨‹çš„æœ€ä¼˜ç­–ç•¥ï¼Œå®ƒæ»¡è¶³ï¼šç›¸å¯¹å‰é¢å†³ç­–æ‰€å½¢æˆçš„çŠ¶æ€è€Œè¨€ï¼Œä½™ä¸‹çš„å­ç­–ç•¥å¿…ç„¶æ„æˆâ€œæœ€ä¼˜å­ç­–ç•¥â€ [6] ã€‚</p><p>æœ€ä¼˜æ€§åŸç†å®é™…ä¸Šæ˜¯è¦æ±‚é—®é¢˜çš„æœ€ä¼˜ç­–ç•¥çš„å­ç­–ç•¥ä¹Ÿæ˜¯æœ€ä¼˜ [6] ã€‚</p><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><p>å¤šé˜¶æ®µå†³ç­–é—®é¢˜ä¸­ï¼Œå„ä¸ªé˜¶æ®µé‡‡å–çš„<a href="https://baike.baidu.com/item/å†³ç­–" target="_blank" rel="noopener">å†³ç­–</a>ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯ä¸æ—¶é—´æœ‰å…³çš„ï¼Œå†³ç­–ä¾èµ–äºå½“å‰çŠ¶æ€ï¼Œåˆéšå³å¼•èµ·çŠ¶æ€çš„è½¬ç§»ï¼Œä¸€ä¸ªå†³ç­–åºåˆ—å°±æ˜¯åœ¨å˜åŒ–çš„çŠ¶æ€ä¸­äº§ç”Ÿå‡ºæ¥çš„ï¼Œæ•…æœ‰â€œåŠ¨æ€â€çš„å«ä¹‰ï¼Œç§°è¿™ç§è§£å†³å¤šé˜¶æ®µå†³ç­–æœ€ä¼˜åŒ–é—®é¢˜çš„æ–¹æ³•ä¸ºåŠ¨æ€è§„åˆ’æ–¹æ³• [7] ã€‚</p><h3 id="é€‚ç”¨æ¡ä»¶"><a href="#é€‚ç”¨æ¡ä»¶" class="headerlink" title="é€‚ç”¨æ¡ä»¶"></a>é€‚ç”¨æ¡ä»¶</h3><p>ä»»ä½•æ€æƒ³æ–¹æ³•éƒ½æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œè¶…å‡ºäº†ç‰¹å®šæ¡ä»¶ï¼Œå®ƒå°±å¤±å»äº†ä½œç”¨ã€‚åŒæ ·ï¼ŒåŠ¨æ€è§„åˆ’ä¹Ÿå¹¶ä¸æ˜¯ä¸‡èƒ½çš„ã€‚é€‚ç”¨åŠ¨æ€è§„åˆ’çš„é—®é¢˜å¿…é¡»æ»¡è¶³æœ€ä¼˜åŒ–åŸç†å’Œæ— åæ•ˆæ€§ [8] ã€‚</p><ul><li><strong><a href="https://baike.baidu.com/item/æœ€ä¼˜åŒ–åŸç†" target="_blank" rel="noopener">æœ€ä¼˜åŒ–åŸç†</a>**</strong>ï¼ˆæœ€ä¼˜å­ç»“æ„æ€§è´¨ï¼‰**</li></ul><p>æœ€ä¼˜åŒ–åŸç†å¯è¿™æ ·é˜è¿°ï¼šä¸€ä¸ªæœ€ä¼˜åŒ–ç­–ç•¥å…·æœ‰è¿™æ ·çš„æ€§è´¨ï¼Œä¸è®ºè¿‡å»çŠ¶æ€å’Œå†³ç­–å¦‚ä½•ï¼Œå¯¹å‰é¢çš„å†³ç­–æ‰€å½¢æˆçš„çŠ¶æ€è€Œè¨€ï¼Œä½™ä¸‹çš„è¯¸å†³ç­–å¿…é¡»æ„æˆæœ€ä¼˜ç­–ç•¥ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä¸€ä¸ªæœ€ä¼˜åŒ–ç­–ç•¥çš„å­ç­–ç•¥æ€»æ˜¯æœ€ä¼˜çš„ã€‚ä¸€ä¸ªé—®é¢˜æ»¡è¶³æœ€ä¼˜åŒ–åŸç†åˆç§°å…¶å…·æœ‰æœ€ä¼˜å­ç»“æ„æ€§è´¨ [8] ã€‚</p><ul><li><strong><a href="https://baike.baidu.com/item/æ— åæ•ˆæ€§" target="_blank" rel="noopener">æ— åæ•ˆæ€§</a></strong></li></ul><p>å°†å„é˜¶æ®µæŒ‰ç…§ä¸€å®šçš„æ¬¡åºæ’åˆ—å¥½ä¹‹åï¼Œå¯¹äºæŸä¸ªç»™å®šçš„é˜¶æ®µçŠ¶æ€ï¼Œå®ƒä»¥å‰å„é˜¶æ®µçš„çŠ¶æ€æ— æ³•ç›´æ¥å½±å“å®ƒæœªæ¥çš„å†³ç­–ï¼Œè€Œåªèƒ½é€šè¿‡å½“å‰çš„è¿™ä¸ªçŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªçŠ¶æ€éƒ½æ˜¯è¿‡å»å†å²çš„ä¸€ä¸ªå®Œæ•´æ€»ç»“ã€‚è¿™å°±æ˜¯æ— åå‘æ€§ï¼Œåˆç§°ä¸ºæ— åæ•ˆæ€§ [8] ã€‚</p><ul><li><strong>å­é—®é¢˜çš„é‡å æ€§</strong></li></ul><p>åŠ¨æ€è§„åˆ’ç®—æ³•çš„å…³é”®åœ¨äºè§£å†³å†—ä½™ï¼Œè¿™æ˜¯åŠ¨æ€è§„åˆ’ç®—æ³•çš„æ ¹æœ¬ç›®çš„ã€‚åŠ¨æ€è§„åˆ’å®è´¨ä¸Šæ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æŠ€æœ¯ï¼Œå®ƒåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œä¸å¾—ä¸å­˜å‚¨äº§ç”Ÿè¿‡ç¨‹ä¸­çš„å„ç§çŠ¶æ€ï¼Œæ‰€ä»¥å®ƒçš„ç©ºé—´å¤æ‚åº¦è¦å¤§äºå…¶ä»–çš„ç®—æ³•ã€‚é€‰æ‹©åŠ¨æ€è§„åˆ’ç®—æ³•æ˜¯å› ä¸ºåŠ¨æ€è§„åˆ’ç®—æ³•åœ¨ç©ºé—´ä¸Šå¯ä»¥æ‰¿å—ï¼Œè€Œæœç´¢ç®—æ³•åœ¨æ—¶é—´ä¸Šå´æ— æ³•æ‰¿å—ï¼Œæ‰€ä»¥æˆ‘ä»¬èˆç©ºé—´è€Œå–æ—¶é—´</p><h3 id="1-2-ä½¿ç”¨åœºæ™¯"><a href="#1-2-ä½¿ç”¨åœºæ™¯" class="headerlink" title="1.2 ä½¿ç”¨åœºæ™¯"></a>1.2 ä½¿ç”¨åœºæ™¯</h3><p>åŠ¨æ€è§„åˆ’åœ¨æŸ¥æ‰¾æœ‰å¾ˆå¤š<strong>é‡å å­é—®é¢˜</strong>çš„æƒ…å†µçš„æœ€ä¼˜è§£æ—¶æœ‰æ•ˆã€‚å®ƒå°†é—®é¢˜é‡æ–°ç»„åˆæˆå­é—®é¢˜ã€‚ä¸ºäº†é¿å…å¤šæ¬¡è§£å†³è¿™äº›å­é—®é¢˜ï¼Œå®ƒä»¬çš„ç»“æœéƒ½é€æ¸è¢«è®¡ç®—å¹¶è¢«ä¿å­˜ï¼Œä»ç®€å•çš„é—®é¢˜ç›´åˆ°æ•´ä¸ªé—®é¢˜éƒ½è¢«è§£å†³ã€‚å› æ­¤ï¼ŒåŠ¨æ€è§„åˆ’ä¿å­˜é€’å½’æ—¶çš„ç»“æœï¼Œå› è€Œä¸ä¼šåœ¨è§£å†³åŒæ ·çš„é—®é¢˜æ—¶èŠ±è´¹æ—¶é—´ã€‚</p><p>åŠ¨æ€è§„åˆ’åªèƒ½åº”ç”¨äºæœ‰<strong>æœ€ä¼˜å­ç»“æ„</strong>çš„é—®é¢˜ã€‚æœ€ä¼˜å­ç»“æ„çš„æ„æ€æ˜¯å±€éƒ¨æœ€ä¼˜è§£èƒ½å†³å®šå…¨å±€æœ€ä¼˜è§£ï¼ˆå¯¹æœ‰äº›é—®é¢˜è¿™ä¸ªè¦æ±‚å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³ï¼Œæ•…æœ‰æ—¶éœ€è¦å¼•å…¥ä¸€å®šçš„è¿‘ä¼¼ï¼‰ã€‚ç®€å•åœ°è¯´ï¼Œé—®é¢˜èƒ½å¤Ÿåˆ†è§£æˆå­é—®é¢˜æ¥è§£å†³ã€‚</p><p>é€‚ç”¨æƒ…å†µï¼š</p><ul><li><p><strong>æœ€ä¼˜å­ç»“æ„æ€§è´¨</strong>ï¼šå¦‚æœé—®é¢˜çš„æœ€ä¼˜è§£æ‰€åŒ…å«çš„å­é—®é¢˜çš„è§£ä¹Ÿæ˜¯æœ€ä¼˜çš„ï¼Œæˆ‘ä»¬å°±ç§°è¯¥é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„æ€§è´¨ï¼ˆå³æ»¡è¶³æœ€ä¼˜åŒ–åŸç†ï¼‰ã€‚æœ€ä¼˜å­ç»“æ„æ€§è´¨ä¸ºåŠ¨æ€è§„åˆ’ç®—æ³•è§£å†³é—®é¢˜æä¾›äº†é‡è¦çº¿ç´¢ã€‚</p></li><li><p><strong>æ— åæ•ˆæ€§</strong>ï¼šå³å­é—®é¢˜çš„è§£ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸å†æ”¹å˜ï¼Œä¸å—åœ¨è¿™ä¹‹åã€åŒ…å«å®ƒçš„æ›´å¤§çš„é—®é¢˜çš„æ±‚è§£å†³ç­–å½±å“ã€‚</p></li><li><strong>å­é—®é¢˜é‡å æ€§è´¨</strong>ï¼šå­é—®é¢˜é‡å æ€§è´¨æ˜¯æŒ‡åœ¨ç”¨é€’å½’ç®—æ³•è‡ªé¡¶å‘ä¸‹å¯¹é—®é¢˜è¿›è¡Œæ±‚è§£æ—¶ï¼Œæ¯æ¬¡äº§ç”Ÿçš„å­é—®é¢˜å¹¶ä¸æ€»æ˜¯æ–°é—®é¢˜ï¼Œæœ‰äº›å­é—®é¢˜ä¼šè¢«é‡å¤è®¡ç®—å¤šæ¬¡ã€‚åŠ¨æ€è§„åˆ’ç®—æ³•æ­£æ˜¯åˆ©ç”¨äº†è¿™ç§å­é—®é¢˜çš„é‡å æ€§è´¨ï¼Œå¯¹æ¯ä¸€ä¸ªå­é—®é¢˜åªè®¡ç®—ä¸€æ¬¡ï¼Œç„¶åå°†å…¶è®¡ç®—ç»“æœä¿å­˜åœ¨ä¸€ä¸ªè¡¨æ ¼ä¸­ï¼Œå½“å†æ¬¡éœ€è¦è®¡ç®—å·²ç»è®¡ç®—è¿‡çš„å­é—®é¢˜æ—¶ï¼Œåªæ˜¯åœ¨è¡¨æ ¼ä¸­ç®€å•åœ°æŸ¥çœ‹ä¸€ä¸‹ç»“æœï¼Œä»è€Œè·å¾—è¾ƒé«˜çš„æ•ˆç‡ï¼Œé™ä½äº†æ—¶é—´å¤æ‚åº¦ã€‚</li></ul><h3 id="1-3-åŠ¨æ€è§„åˆ’ä¸è®°å¿†åŒ–æœç´¢"><a href="#1-3-åŠ¨æ€è§„åˆ’ä¸è®°å¿†åŒ–æœç´¢" class="headerlink" title="1.3 åŠ¨æ€è§„åˆ’ä¸è®°å¿†åŒ–æœç´¢"></a>1.3 åŠ¨æ€è§„åˆ’ä¸è®°å¿†åŒ–æœç´¢</h3><p><a href="https://www.luogu.com.cn/blog/interestingLSY/memdfs-and-dp" target="_blank" rel="noopener">https://www.luogu.com.cn/blog/interestingLSY/memdfs-and-dp</a></p><h2 id="äºŒ-ç®—æ³•"><a href="#äºŒ-ç®—æ³•" class="headerlink" title="äºŒ. ç®—æ³•"></a>äºŒ. ç®—æ³•</h2><h3 id="2-1-DPçš„ä¸¤ç§å®ç°æ–¹å¼"><a href="#2-1-DPçš„ä¸¤ç§å®ç°æ–¹å¼" class="headerlink" title="2.1 DPçš„ä¸¤ç§å®ç°æ–¹å¼"></a>2.1 DPçš„ä¸¤ç§å®ç°æ–¹å¼</h3><ul><li>é€’å½’å®ç°</li><li>è®°å¿†åŒ–æœç´¢</li></ul><h3 id="2-2-DPå¸¸ç”¨æ¥è§£å†³çš„é—®é¢˜"><a href="#2-2-DPå¸¸ç”¨æ¥è§£å†³çš„é—®é¢˜" class="headerlink" title="2.2 DPå¸¸ç”¨æ¥è§£å†³çš„é—®é¢˜"></a>2.2 DPå¸¸ç”¨æ¥è§£å†³çš„é—®é¢˜</h3><ul><li>åˆ‡å‰²é’¢æ¡é—®é¢˜</li><li>Floydæœ€çŸ­è·¯é—®é¢˜</li><li>æœ€å¤§ä¸ä¸‹é™å­åºåˆ—</li><li>çŸ©é˜µé“¾ä¹˜</li><li>å‡¸å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†</li><li>0-1èƒŒåŒ…</li><li>æœ€é•¿å…¬å…±å­åºåˆ—</li><li>æœ€ä¼˜äºŒåˆ†æœç´¢æ ‘</li></ul><h3 id="2-3-ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„ç®—æ³•"><a href="#2-3-ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„ç®—æ³•" class="headerlink" title="2.3 ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„ç®—æ³•"></a>2.3 ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„ç®—æ³•</h3><ul><li>æœ€é•¿å…¬å…±å­åºåˆ—</li><li>Floyd-Warshallç®—æ³•</li><li>Viterbiç®—æ³•</li><li>æ±‚è§£é©¬å¯å¤«å†³ç­–è¿‡ç¨‹ä¸‹æœ€ä½³ç­–ç•¥</li></ul><h3 id="2-4-å®ç°åŸç†"><a href="#2-4-å®ç°åŸç†" class="headerlink" title="2.4 å®ç°åŸç†"></a>2.4 å®ç°åŸç†</h3><ul><li><strong>åŸºæœ¬æ€æƒ³ï¼š</strong>é—®é¢˜çš„æœ€ä¼˜è§£å¦‚æœå¯ä»¥ç”±å­é—®é¢˜çš„æœ€ä¼˜è§£æ¨å¯¼å¾—åˆ°ï¼Œåˆ™å¯ä»¥å…ˆæ±‚è§£å­é—®é¢˜çš„æœ€ä¼˜è§£ï¼Œåœ¨æ„é€ åŸé—®é¢˜çš„æœ€ä¼˜è§£ï¼›è‹¥å­é—®é¢˜<strong>æœ‰è¾ƒå¤šçš„é‡å¤å‡ºç°</strong>ï¼Œåˆ™å¯ä»¥<strong>è‡ªåº•å‘ä¸Š</strong>ä»æœ€ç»ˆå­é—®é¢˜å‘åŸé—®é¢˜é€æ­¥æ±‚è§£ã€‚</li><li>ä½¿ç”¨æ¡ä»¶ï¼š<strong>å¯åˆ†ä¸ºå¤šä¸ªç›¸å…³å­é—®é¢˜ï¼Œå­é—®é¢˜çš„è§£è¢«é‡å¤ä½¿ç”¨</strong><ul><li>Optimal substructureï¼ˆä¼˜åŒ–å­ç»“æ„ï¼‰ï¼š<ul><li>ä¸€ä¸ªé—®é¢˜çš„ä¼˜åŒ–è§£åŒ…å«äº†å­é—®é¢˜çš„ä¼˜åŒ–è§£</li><li>ç¼©å°å­é—®é¢˜é›†åˆï¼Œåªéœ€é‚£äº›ä¼˜åŒ–é—®é¢˜ä¸­åŒ…å«çš„å­é—®é¢˜ï¼Œé™ä½å®ç°å¤æ‚æ€§</li><li>æˆ‘ä»¬å¯ä»¥è‡ªä¸‹è€Œä¸Šçš„</li></ul></li><li>Subtetiesï¼ˆé‡å å­é—®é¢˜ï¼‰ï¼šåœ¨é—®é¢˜çš„æ±‚è§£è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šå­é—®é¢˜çš„è§£å°†è¢«å¤šæ¬¡ä½¿ç”¨ã€‚</li></ul></li><li>åŠ¨æ€è§„åˆ’ç®—æ³•çš„è®¾è®¡æ­¥éª¤ï¼š<ul><li>åˆ†æä¼˜åŒ–è§£çš„ç»“æ„</li><li>é€’å½’åœ°å®šä¹‰æœ€ä¼˜è§£çš„ä»£ä»·</li><li>è‡ªåº•å‘ä¸Šåœ°è®¡ç®—ä¼˜åŒ–è§£çš„ä»£ä»·ä¿å­˜ä¹‹ï¼Œå¹¶è·å–æ„é€ æœ€ä¼˜è§£çš„ä¿¡æ¯</li><li>æ ¹æ®æ„é€ æœ€ä¼˜è§£çš„ä¿¡æ¯æ„é€ ä¼˜åŒ–è§£</li></ul></li><li>åŠ¨æ€è§„åˆ’ç‰¹ç‚¹ï¼š<ul><li>æŠŠåŸå§‹é—®é¢˜åˆ’åˆ†æˆä¸€ç³»åˆ—å­é—®é¢˜ï¼›</li><li>æ±‚è§£æ¯ä¸ªå­é—®é¢˜ä»…ä¸€æ¬¡ï¼Œå¹¶å°†å…¶ç»“æœä¿å­˜åœ¨ä¸€ä¸ªè¡¨ä¸­ï¼Œä»¥åç”¨åˆ°æ—¶ç›´æ¥å­˜å–ï¼Œä¸é‡å¤è®¡ç®—ï¼ŒèŠ‚çœè®¡ç®—æ—¶é—´</li><li>è‡ªåº•å‘ä¸Šåœ°è®¡ç®—ã€‚</li><li>æ•´ä½“é—®é¢˜æœ€ä¼˜è§£å–å†³äºå­é—®é¢˜çš„æœ€ä¼˜è§£ï¼ˆçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼‰ï¼ˆå°†å­é—®é¢˜ç§°ä¸ºçŠ¶æ€ï¼Œæœ€ç»ˆçŠ¶æ€çš„æ±‚è§£å½’ç»“ä¸ºå…¶ä»–çŠ¶æ€çš„æ±‚è§£ï¼‰</li></ul></li></ul><h2 id="ä¸‰-ç®—æ³•é¢˜"><a href="#ä¸‰-ç®—æ³•é¢˜" class="headerlink" title="ä¸‰. ç®—æ³•é¢˜"></a>ä¸‰. ç®—æ³•é¢˜</h2><p>åŠ¨æ€è§„åˆ’ç­‰ä»·äºè®°å¿†åŒ–æœç´¢ï¼Œå­¦ä¹ æ·±åº¦ä¼˜å…ˆæœç´¢å’Œè®°å¿†åŒ–æœç´¢ï¼Œæ–¹ä¾¿å¿«é€Ÿç†è§£åŠ¨æ€è§„åˆ’</p><p>è§£å†³DPç®—æ³•é—®é¢˜ï¼Œå†™å‡ºè®°å¿†åŒ–æœç´¢çš„é€’å½’å‡½æ•°ï¼Œåˆ—å‡ºæ–¹ç¨‹åï¼Œå¯ä»¥ç”¨æ•°å­¦æ–¹æ³•ï¼Œé­”æ”¹ä¼˜åŒ–ã€‚</p><h3 id="3-1-èƒŒåŒ…é—®é¢˜"><a href="#3-1-èƒŒåŒ…é—®é¢˜" class="headerlink" title="3.1 èƒŒåŒ…é—®é¢˜"></a>3.1 èƒŒåŒ…é—®é¢˜</h3><p>èƒŒåŒ…é—®é¢˜ä½œä¸ºNPå®Œå…¨é—®é¢˜ï¼Œæš‚æ—¶ä¸å­˜åœ¨å¤šé¡¹å¼æ—¶é—´ç®—æ³•ã€‚åŠ¨æ€è§„åˆ’å±äºèƒŒåŒ…é—®é¢˜æ±‚è§£æœ€ä¼˜è§£çš„å¯è¡Œæ–¹æ³•ä¹‹ä¸€ã€‚æ­¤å¤–ï¼Œæ±‚è§£èƒŒåŒ…é—®é¢˜æœ€ä¼˜è§£è¿˜æœ‰æœç´¢æ³•ç­‰ï¼Œè¿‘ä¼¼è§£è¿˜æœ‰è´ªå¿ƒæ³•ç­‰ï¼Œåˆ†æ•°èƒŒåŒ…é—®é¢˜æœ‰æœ€ä¼˜è´ªå¿ƒè§£ç­‰ã€‚ èƒŒåŒ…é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„å’Œé‡å å­é—®é¢˜ã€‚åŠ¨æ€è§„åˆ’ä¸€èˆ¬ç”¨äºæ±‚è§£èƒŒåŒ…é—®é¢˜ä¸­çš„æ•´æ•°èƒŒåŒ…é—®é¢˜ï¼ˆå³æ¯ç§ç‰©å“æ‰€é€‰çš„ä¸ªæ•°å¿…é¡»æ˜¯æ•´æ•°ï¼‰ã€‚ </p><p>è§£æ•´æ•°èƒŒåŒ…é—®é¢˜ï¼š è®¾æœ‰nä»¶ç‰©å“ï¼Œæ¯ä»¶ä»·å€¼è®°ä¸º P~i~ ï¼Œæ¯ä»¶ä½“ç§¯è®°ä¸º V~i~ ï¼Œç”¨ä¸€ä¸ªæœ€å¤§å®¹ç§¯ä¸º V~max~ çš„èƒŒåŒ…ï¼Œæ±‚è£…å…¥ç‰©å“çš„æœ€å¤§ä»·å€¼ã€‚ ç”¨ä¸€ä¸ªæ•°ç»„ f[i,v] è¡¨ç¤ºå–iä»¶å•†å“å¡«å……ä¸€ä¸ªå®¹ç§¯ä¸ºvçš„èƒŒåŒ…çš„æœ€å¤§ä»·å€¼ï¼Œæ˜¾ç„¶é—®é¢˜çš„è§£å°±æ˜¯ f[n,V~max~] ã€‚</p><p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/dd9c97f255a11758a2f19098205661f90cf2fa81" alt="{\displaystyle f[i,v]={\begin{cases}f[i-1,v],v&lt;V_{i}\\\max\{f[i-1,v],f[i-1,v-V_{i}]+P_{i}\},v\geq V_{i}\\0,iv=0\\\end{cases}}}"></p><p>å¯¹äºç‰¹ä¾‹0-1èƒŒåŒ…é—®é¢˜ï¼ˆå³æ¯ä»¶ç‰©å“æœ€å¤šæ”¾1ä»¶ï¼Œå¦åˆ™ä¸æ”¾å…¥ï¼‰çš„é—®é¢˜ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/dd9c97f255a11758a2f19098205661f90cf2fa81" alt="{\displaystyle f[i,v]={\begin{cases}f[i-1,v],v&lt;V_{i}\\\max\{f[i-1,v],f[i-1,v-V_{i}]+P_{i}\},v\geq V_{i}\\0,iv=0\\\end{cases}}}"></p><h3 id="3-2-åˆ‡å‰²é’¢æ¡é—®é¢˜"><a href="#3-2-åˆ‡å‰²é’¢æ¡é—®é¢˜" class="headerlink" title="3.2 åˆ‡å‰²é’¢æ¡é—®é¢˜"></a>3.2 åˆ‡å‰²é’¢æ¡é—®é¢˜</h3><p>ï¼ˆ1ï¼‰å‰‘æŒ‡14-å‰ªç»³å­1</p><p>æ­¤æ¡ˆä¾‹ä¸­åŠ¨æ€è§„åˆ’æ•ˆç‡è¦ä½äºè´ªå¿ƒè§£æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‰ªç»³å­1</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç»™ä½ ä¸€æ ¹é•¿åº¦ä¸º n çš„ç»³å­ï¼Œè¯·æŠŠç»³å­å‰ªæˆæ•´æ•°é•¿åº¦çš„ m æ®µï¼ˆmã€néƒ½æ˜¯æ•´æ•°ï¼Œn&gt;1å¹¶ä¸”m&gt;1ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"> * æ¯æ®µç»³å­çš„é•¿åº¦è®°ä¸º k[0],k[1]...k[m-1] ã€‚</span></span><br><span class="line"><span class="comment"> * è¯·é—® k[0]*k[1]*...*k[m-1] å¯èƒ½çš„æœ€å¤§ä¹˜ç§¯æ˜¯å¤šå°‘ï¼Ÿ</span></span><br><span class="line"><span class="comment"> * ä¾‹å¦‚ï¼Œå½“ç»³å­çš„é•¿åº¦æ˜¯8æ—¶ï¼Œæˆ‘ä»¬æŠŠå®ƒå‰ªæˆé•¿åº¦åˆ†åˆ«ä¸º2ã€3ã€3çš„ä¸‰æ®µï¼Œæ­¤æ—¶å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯æ˜¯18ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 1ï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥: 2</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: 1</span></span><br><span class="line"><span class="comment"> * è§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 2:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥: 10</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: 36</span></span><br><span class="line"><span class="comment"> * è§£é‡Š: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36</span></span><br><span class="line"><span class="comment"> * æç¤ºï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2 &lt;= n &lt;= 58</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Related Topics</span></span><br><span class="line"><span class="comment"> * æ•°å­¦</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jz14CuttingRope1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(cuttingRope(<span class="number">2</span>));</span><br><span class="line">        System.out.println(cuttingRope(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ±‚é•¿åº¦ä¸ºnçš„ç»³å­å‰ªæ‰åçš„æœ€å¤§ä¹˜ç§¯ï¼Œå¯ä»¥ä»å‰é¢æ¯”nå°çš„ç»³å­è½¬ç§»è€Œæ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ç”¨ä¸€ä¸ªdpæ•°ç»„è®°å½•ä»0åˆ°né•¿åº¦çš„ç»³å­å‰ªæ‰åçš„æœ€å¤§ä¹˜ç§¯ï¼Œä¹Ÿå°±æ˜¯dp[i]è¡¨ç¤ºé•¿åº¦ä¸ºiçš„ç»³å­å‰ªæˆmæ®µåçš„æœ€å¤§ä¹˜ç§¯ï¼Œåˆå§‹åŒ–dp[2] = 1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æˆ‘ä»¬å…ˆæŠŠç»³å­å‰ªæ‰ç¬¬ä¸€æ®µï¼ˆé•¿åº¦ä¸ºjï¼‰ï¼Œå¦‚æœåªå‰ªæ‰é•¿åº¦ä¸º1ï¼Œå¯¹æœ€åçš„ä¹˜ç§¯æ— ä»»ä½•å¢ç›Šï¼Œæ‰€ä»¥ä»é•¿åº¦ä¸º2å¼€å§‹å‰ª</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å‰ªäº†ç¬¬ä¸€æ®µåï¼Œå‰©ä¸‹(i - j)é•¿åº¦å¯ä»¥å‰ªä¹Ÿå¯ä»¥ä¸å‰ªã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸å‰ªçš„è¯é•¿åº¦ä¹˜ç§¯å³ä¸ºj * (i - j)ï¼›</span></span><br><span class="line"><span class="comment">     * å¦‚æœå‰ªçš„è¯é•¿åº¦ä¹˜ç§¯å³ä¸ºj * dp[i - j]ã€‚</span></span><br><span class="line"><span class="comment">     * å–ä¸¤è€…æœ€å¤§å€¼max(j * (i - j), j * dp[i - j])</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ç¬¬ä¸€æ®µé•¿åº¦jå¯ä»¥å–çš„åŒºé—´ä¸º[2,i)ï¼Œå¯¹æ‰€æœ‰jä¸åŒçš„æƒ…å†µå–æœ€å¤§å€¼ï¼Œå› æ­¤æœ€ç»ˆdp[i]çš„è½¬ç§»æ–¹ç¨‹ä¸º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * dp[i] = max(dp[i], max(j * (i - j), j * dp[i - j]))</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æœ€åè¿”å›dp[n]å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ—¶é—´å¤æ‚åº¦ï¼šO(n ^ 2)</span></span><br><span class="line"><span class="comment">     * ç©ºé—´å¤æ‚åº¦ï¼šO(n)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cuttingRope</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">3</span>; i &lt; n + <span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">2</span>; j &lt; i; j++)&#123;</span><br><span class="line">                dp[i] = Math.max(dp[i], Math.max(j * (i - j), j * dp[i - j]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è´ªå¿ƒ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ ¸å¿ƒæ€è·¯æ˜¯ï¼šå°½å¯èƒ½æŠŠç»³å­åˆ†æˆé•¿åº¦ä¸º3çš„å°æ®µï¼Œè¿™æ ·ä¹˜ç§¯æœ€å¤§</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ­¥éª¤å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å¦‚æœ n == 2ï¼Œè¿”å›1ï¼Œå¦‚æœ n == 3ï¼Œè¿”å›2ï¼Œä¸¤ä¸ªå¯ä»¥åˆå¹¶æˆnå°äº4çš„æ—¶å€™è¿”å›n - 1</span></span><br><span class="line"><span class="comment">     * å¦‚æœ n == 4ï¼Œè¿”å›4</span></span><br><span class="line"><span class="comment">     * å¦‚æœ n &gt; 4ï¼Œåˆ†æˆå°½å¯èƒ½å¤šçš„é•¿åº¦ä¸º3çš„å°æ®µï¼Œæ¯æ¬¡å¾ªç¯é•¿åº¦nå‡å»3ï¼Œä¹˜ç§¯resä¹˜ä»¥3ï¼›æœ€åè¿”å›æ—¶ä¹˜ä»¥å°äºç­‰äº4çš„æœ€åä¸€å°æ®µ</span></span><br><span class="line"><span class="comment">     * ä»¥ä¸Š2å’Œ3å¯ä»¥åˆå¹¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span></span><br><span class="line"><span class="comment">     * ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cuttingRope1</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> n - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(n &gt; <span class="number">4</span>)&#123;</span><br><span class="line">            res *= <span class="number">3</span>;</span><br><span class="line">            n -= <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res * n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å‰‘æŒ‡14-å‰ªç»³å­2</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‰ªç»³å­2</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç»™ä½ ä¸€æ ¹é•¿åº¦ä¸º n çš„ç»³å­ï¼Œè¯·æŠŠç»³å­å‰ªæˆæ•´æ•°é•¿åº¦çš„ m æ®µï¼ˆmã€néƒ½æ˜¯æ•´æ•°ï¼Œn&gt;1å¹¶ä¸”m&gt;1ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"> * æ¯æ®µç»³å­çš„é•¿åº¦è®°ä¸º k[0],k[1]...k[m - 1] ã€‚</span></span><br><span class="line"><span class="comment"> * è¯·é—® k[0]*k[1]*...*k[m - 1] å¯èƒ½çš„æœ€å¤§ä¹˜ç§¯æ˜¯å¤šå°‘ï¼Ÿ</span></span><br><span class="line"><span class="comment"> * ä¾‹å¦‚ï¼Œå½“ç»³å­çš„é•¿åº¦æ˜¯8æ—¶ï¼Œæˆ‘ä»¬æŠŠå®ƒå‰ªæˆé•¿åº¦åˆ†åˆ«ä¸º2ã€3ã€3çš„ä¸‰æ®µï¼Œæ­¤æ—¶å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯æ˜¯18ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç­”æ¡ˆéœ€è¦å–æ¨¡ 1e9+7ï¼ˆ1000000007ï¼‰ï¼Œå¦‚è®¡ç®—åˆå§‹ç»“æœä¸ºï¼š1000000008ï¼Œè¯·è¿”å› 1ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 1ï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥: 2</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: 1</span></span><br><span class="line"><span class="comment"> * è§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 2:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥: 10</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: 36</span></span><br><span class="line"><span class="comment"> * è§£é‡Š: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æç¤ºï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2 &lt;= n &lt;= 1000</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Related Topics</span></span><br><span class="line"><span class="comment"> * æ•°å­¦</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ä¸å‰ªç»³å­1å”¯ä¸€ä¸åŒåœ¨äºæœ¬é¢˜ç›®æ¶‰åŠ â€œå¤§æ•°è¶Šç•Œæƒ…å†µä¸‹çš„æ±‚ä½™é—®é¢˜â€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jz14CuttingRope2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(cuttingRope(<span class="number">2</span>));</span><br><span class="line">        System.out.println(cuttingRope(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cuttingRope</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> n - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> res = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(n &gt; <span class="number">4</span>)&#123;</span><br><span class="line">            res  = res * <span class="number">3</span> % <span class="number">1000000007</span>;</span><br><span class="line">            n -= <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (res * n % <span class="number">1000000007</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a href="#3-3-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…" class="headerlink" title="3.3 æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"></a>3.3 æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</h3><p>å‰‘æŒ‡19-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åŒ¹é…åŒ…å«'. 'å’Œ'*'çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</span></span><br><span class="line"><span class="comment"> * æ¨¡å¼ä¸­çš„å­—ç¬¦'.'è¡¨ç¤ºä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œ'*'è¡¨ç¤ºå®ƒå‰é¢çš„å­—ç¬¦å¯ä»¥å‡ºç°ä»»æ„æ¬¡ï¼ˆå«0æ¬¡ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> * åœ¨æœ¬é¢˜ä¸­ï¼ŒåŒ¹é…æ˜¯æŒ‡å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦åŒ¹é…æ•´ä¸ªæ¨¡å¼ã€‚</span></span><br><span class="line"><span class="comment"> * ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²"aaa"ä¸æ¨¡å¼"a.a"å’Œ"ab*ac*a"åŒ¹é…ï¼Œä½†ä¸"aa.a"å’Œ"ab*a"å‡ä¸åŒ¹é…ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 1:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥:</span></span><br><span class="line"><span class="comment"> * s = "aa"</span></span><br><span class="line"><span class="comment"> * p = "a"</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: false</span></span><br><span class="line"><span class="comment"> * è§£é‡Š: "a" æ— æ³•åŒ¹é… "aa" æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 2:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥:</span></span><br><span class="line"><span class="comment"> * s = "aa"</span></span><br><span class="line"><span class="comment"> * p = "a*"</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: true</span></span><br><span class="line"><span class="comment"> * è§£é‡Š: å› ä¸º '*' ä»£è¡¨å¯ä»¥åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ , åœ¨è¿™é‡Œå‰é¢çš„å…ƒç´ å°±æ˜¯ 'a'ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸² "aa" å¯è¢«è§†ä¸º 'a' é‡å¤äº†ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 3:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥:</span></span><br><span class="line"><span class="comment"> * s = "ab"</span></span><br><span class="line"><span class="comment"> * p = ".*"</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: true</span></span><br><span class="line"><span class="comment"> * è§£é‡Š: ".*" è¡¨ç¤ºå¯åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªï¼ˆ'*'ï¼‰ä»»æ„å­—ç¬¦ï¼ˆ'.'ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 4:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥:</span></span><br><span class="line"><span class="comment"> * s = "aab"</span></span><br><span class="line"><span class="comment"> * p = "c*a*b"</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: true</span></span><br><span class="line"><span class="comment"> * è§£é‡Š: å› ä¸º '*' è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªï¼Œè¿™é‡Œ 'c' ä¸º 0 ä¸ª, 'a' è¢«é‡å¤ä¸€æ¬¡ã€‚å› æ­¤å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² "aab"ã€‚</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 5:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥:</span></span><br><span class="line"><span class="comment"> * s = "mississippi"</span></span><br><span class="line"><span class="comment"> * p = "mis*is*p*."</span></span><br><span class="line"><span class="comment"> * è¾“å‡º: false</span></span><br><span class="line"><span class="comment"> * s å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ã€‚</span></span><br><span class="line"><span class="comment"> * p å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ä»¥åŠå­—ç¬¦ . å’Œ *ï¼Œæ— è¿ç»­çš„ '*'ã€‚</span></span><br><span class="line"><span class="comment"> * æ³¨æ„ï¼šæœ¬é¢˜ä¸ä¸»ç«™ 10 é¢˜ç›¸åŒï¼šhttps://leetcode-cn.com/problems/regular-expression-matching/</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Related Topics</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jz19IsMatch</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">"aa"</span>;</span><br><span class="line">        String p = <span class="string">"a"</span>;</span><br><span class="line">        System.out.println(isMatch(s, p));</span><br><span class="line"></span><br><span class="line">        s = <span class="string">"aa"</span>;</span><br><span class="line">        p = <span class="string">"a*"</span>;</span><br><span class="line">        System.out.println(isMatch(s, p));</span><br><span class="line"></span><br><span class="line">        s = <span class="string">"ab"</span>;</span><br><span class="line">        p = <span class="string">".*"</span>;</span><br><span class="line">        System.out.println(isMatch(s, p));</span><br><span class="line"></span><br><span class="line">        s = <span class="string">"aab"</span>;</span><br><span class="line">        p = <span class="string">"c*a*b"</span>;</span><br><span class="line">        System.out.println(isMatch(s, p));</span><br><span class="line"></span><br><span class="line">        s = <span class="string">"mississippi"</span>;</span><br><span class="line">        p = <span class="string">"mis*is*p*."</span>;</span><br><span class="line">        System.out.println(isMatch(s, p));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—ç¬¦é.æˆ–*ï¼Œåˆ™ç›´æ¥æ¯”è¾ƒã€‚</span></span><br><span class="line"><span class="comment">     * å­—ç¬¦ä¸º.ï¼Œåˆ™ç›´æ¥åŒ¹é…ï¼Œè·³åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">     * å­—ç¬¦ä¸º*ï¼Œåˆ™æ‰¾åˆ°ä¸‹ä¸€ä¸ªä¸å…¶åŒ¹é…çš„å­—ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMatch</span><span class="params">(String s, String p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = s.length();</span><br><span class="line">        <span class="keyword">int</span> m = p.length();</span><br><span class="line">        <span class="comment">// å­˜æ”¾å·²å¤„ç†ç»“æœ</span></span><br><span class="line">        <span class="keyword">boolean</span>[][] f = <span class="keyword">new</span> <span class="keyword">boolean</span>[n + <span class="number">1</span>][m + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= m; j++) &#123;</span><br><span class="line">                <span class="comment">//åˆ†æˆç©ºæ­£åˆ™å’Œéç©ºæ­£åˆ™ä¸¤ç§</span></span><br><span class="line">                <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;</span><br><span class="line">                    f[i][j] = i == <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//éç©ºæ­£åˆ™åˆ†ä¸ºä¸¤ç§æƒ…å†µ * å’Œ é*</span></span><br><span class="line">                    <span class="keyword">if</span> (p.charAt(j - <span class="number">1</span>) != <span class="string">'*'</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; (s.charAt(i - <span class="number">1</span>) == p.charAt(j - <span class="number">1</span>) || p.charAt(j - <span class="number">1</span>) == <span class="string">'.'</span>)) &#123;</span><br><span class="line">                            f[i][j] = f[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">//ç¢°åˆ° * äº†ï¼Œåˆ†ä¸ºçœ‹å’Œä¸çœ‹ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">                        <span class="comment">//ä¸çœ‹</span></span><br><span class="line">                        <span class="keyword">if</span> (j &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                            f[i][j] |= f[i][j - <span class="number">2</span>];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//çœ‹</span></span><br><span class="line">                        <span class="keyword">if</span> (i &gt;= <span class="number">1</span> &amp;&amp; j &gt;= <span class="number">2</span> &amp;&amp; (s.charAt(i - <span class="number">1</span>) == p.charAt(j - <span class="number">2</span>) || p.charAt(j - <span class="number">2</span>) == <span class="string">'.'</span>)) &#123;</span><br><span class="line">                            f[i][j] |= f[i - <span class="number">1</span>][j];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> f[n][m];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é¢˜æ€è·¯ï¼š</p><p>å‡è®¾ä¸»ä¸²ä¸º Aï¼Œæ¨¡å¼ä¸²ä¸º B ä»æœ€åä¸€æ­¥å‡ºå‘ï¼Œéœ€è¦å…³æ³¨æœ€åè¿›æ¥çš„å­—ç¬¦ã€‚å‡è®¾ A çš„é•¿åº¦ä¸º n ï¼ŒB çš„é•¿åº¦ä¸º m ï¼Œå…³æ³¨æ­£åˆ™è¡¨è¾¾å¼ B çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯è°ï¼Œå®ƒæœ‰ä¸‰ç§å¯èƒ½ï¼Œæ­£å¸¸å­—ç¬¦ã€<code>*</code> å’Œ <code>.</code>ï¼ˆç‚¹ï¼‰ï¼Œé‚£é’ˆå¯¹è¿™ä¸‰ç§æƒ…å†µè®¨è®ºå³å¯ï¼Œå¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœ B çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯æ­£å¸¸å­—ç¬¦ï¼Œé‚£å°±æ˜¯çœ‹ <code>A[n-1]</code> æ˜¯å¦ç­‰äº <code>B[m-1]</code> ï¼Œç›¸ç­‰åˆ™çœ‹ A~0..n-2~ ä¸ B~0..mâˆ’2~ ï¼Œä¸ç­‰åˆ™æ˜¯ä¸èƒ½åŒ¹é…ï¼Œè¿™å°±æ˜¯å­é—®é¢˜ã€‚</li><li>å¦‚æœ B çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ <code>.</code> ï¼Œå®ƒèƒ½åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œç›´æ¥çœ‹ A~0..n-2~ ä¸ B~0..mâˆ’2~ </li><li>å¦‚æœ BB çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ <code>*</code> å®ƒä»£è¡¨ <code>B[m-2]=c</code> å¯ä»¥é‡å¤0æ¬¡æˆ–å¤šæ¬¡ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªæ•´ä½“ c*<ul><li>æƒ…å†µä¸€ï¼š<code>A[n-1]</code> æ˜¯ 0 ä¸ª cï¼ŒB æœ€åä¸¤ä¸ªå­—ç¬¦åºŸäº†ï¼Œèƒ½å¦åŒ¹é…å–å†³äº  A~0..n-1~ ä¸ B~0..mâˆ’3~ æ˜¯å¦åŒ¹é…</li><li>æƒ…å†µäºŒï¼š<code>A[n-1]</code> æ˜¯å¤šä¸ª c ä¸­çš„æœ€åä¸€ä¸ªï¼ˆè¿™ç§æƒ…å†µå¿…é¡» A[n-1]=c æˆ–è€… c=â€™.â€™ï¼‰ï¼Œæ‰€ä»¥ A åŒ¹é…å®Œå¾€å‰æŒªä¸€ä¸ªï¼ŒB ç»§ç»­åŒ¹é…ï¼Œå› ä¸ºå¯ä»¥åŒ¹é…å¤šä¸ªï¼Œç»§ç»­çœ‹ A~0..n-2~ ä¸ B~0..mâˆ’1~ æ˜¯å¦åŒ¹é…ã€‚</li></ul></li></ol><p>è½¬ç§»æ–¹ç¨‹:</p><p><code>f[i][j]</code> ä»£è¡¨ A çš„å‰ i ä¸ªå’Œ B çš„å‰ j ä¸ªèƒ½å¦åŒ¹é…:</p><ul><li>å¯¹äºå‰é¢ä¸¤ä¸ªæƒ…å†µï¼Œå¯ä»¥åˆå¹¶æˆä¸€ç§æƒ…å†µ <code>f[i][j]</code> = <code>f[i-1][j-1]</code> </li><li>å¯¹äºç¬¬ä¸‰ç§æƒ…å†µï¼Œå¯¹äº c* åˆ†ä¸ºçœ‹å’Œä¸çœ‹ä¸¤ç§æƒ…å†µ<ul><li>ä¸çœ‹ï¼šç›´æ¥ç æ‰æ­£åˆ™ä¸²çš„åé¢ä¸¤ä¸ªï¼Œ <code>f[i][j]</code> = <code>f[i][j-2]</code></li><li>çœ‹ï¼šæ­£åˆ™ä¸²ä¸åŠ¨ï¼Œä¸»ä¸²å‰ç§»ä¸€ä¸ªï¼Œ<code>f[i][j]</code> = <code>f[i-1][j]</code></li></ul></li></ul><p>åˆå§‹æ¡ä»¶</p><p>ç‰¹åˆ¤ï¼šéœ€è¦è€ƒè™‘ç©ºä¸²ç©ºæ­£åˆ™</p><ul><li>ç©ºä¸²å’Œç©ºæ­£åˆ™æ˜¯åŒ¹é…çš„ï¼Œ<code>f[0][0]</code> = true</li><li>ç©ºä¸²å’Œéç©ºæ­£åˆ™ï¼Œä¸èƒ½ç›´æ¥å®šä¹‰ true å’Œ falseï¼Œå¿…é¡»è¦è®¡ç®—å‡ºæ¥ã€‚ï¼ˆæ¯”å¦‚A=â€™â€™ ,B=aâˆ—bâˆ—câˆ—ï¼‰</li><li>éç©ºä¸²å’Œç©ºæ­£åˆ™å¿…ä¸åŒ¹é…ï¼Œ<code>f[1][0]</code> =â€¦= <code>f[n][0]</code> =false</li><li>éç©ºä¸²å’Œéç©ºæ­£åˆ™ï¼Œé‚£è‚¯å®šæ˜¯éœ€è¦è®¡ç®—çš„äº†ã€‚</li></ul><p>å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºç©ºæ­£åˆ™å’Œéç©ºæ­£åˆ™ä¸¤ç§ï¼Œç©ºæ­£åˆ™ä¹Ÿæ˜¯æ¯”è¾ƒå¥½å¤„ç†çš„ï¼Œå¯¹éç©ºæ­£åˆ™æˆ‘ä»¬è‚¯å®šéœ€è¦è®¡ç®—ï¼Œéç©ºæ­£åˆ™çš„ä¸‰ç§æƒ…å†µï¼Œå‰é¢ä¸¤ç§å¯ä»¥åˆå¹¶åˆ°ä¸€èµ·è®¨è®ºï¼Œç¬¬ä¸‰ç§æƒ…å†µæ˜¯å•ç‹¬ä¸€ç§ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯åˆ†ä¸ºå½“å‰ä½ç½®æ˜¯ <em> å’Œä¸æ˜¯ </em> ä¸¤ç§æƒ…å†µäº†ã€‚</p><p>å¤æ‚åº¦åˆ†æ</p><p>æ—¶é—´å¤æ‚åº¦ï¼šO(mn)ï¼Œå…¶ä¸­ m å’Œ n åˆ†åˆ«æ˜¯å­—ç¬¦ä¸² s å’Œ p çš„é•¿åº¦ã€‚æˆ‘ä»¬éœ€è¦è®¡ç®—å‡ºæ‰€æœ‰çš„çŠ¶æ€ï¼Œå¹¶ä¸”æ¯ä¸ªçŠ¶æ€åœ¨è¿›è¡Œè½¬ç§»æ—¶çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p><p>ç©ºé—´å¤æ‚åº¦ï¼šO(mn)ï¼Œå³ä¸ºå­˜å‚¨æ‰€æœ‰çŠ¶æ€ä½¿ç”¨çš„ç©ºé—´ã€‚</p><h3 id="3-4-ç¼–å·åŠ¨æ€è§„åˆ’ï¼šæœ€å¤§ä¸ä¸‹é™å­åºåˆ—"><a href="#3-4-ç¼–å·åŠ¨æ€è§„åˆ’ï¼šæœ€å¤§ä¸ä¸‹é™å­åºåˆ—" class="headerlink" title="3.4 ç¼–å·åŠ¨æ€è§„åˆ’ï¼šæœ€å¤§ä¸ä¸‹é™å­åºåˆ—"></a>3.4 ç¼–å·åŠ¨æ€è§„åˆ’ï¼šæœ€å¤§ä¸ä¸‹é™å­åºåˆ—</h3><p>ã€€ã€€æœ¬ç±»çš„çŠ¶æ€æ˜¯åŸºç¡€çš„åŸºç¡€ï¼Œå¤§éƒ¨åˆ†çš„åŠ¨æ€è§„åˆ’éƒ½è¦ç”¨åˆ°å®ƒï¼Œæˆä¸ºä¸€ä¸ªç»´ã€‚</p><ul><li><strong>æœ€é•¿ä¸ä¸‹é™å­åºåˆ—å®šä¹‰ï¼š</strong>ä»åºåˆ—ä¸­é€‰å‡ºè‹¥å¹²ä¸ªæ•°ç»„æˆä¸€ä¸ªæ–°çš„åºåˆ—ï¼Œä¸æ”¹å˜ä»–ä»¬çš„é˜Ÿä¼çš„é¡ºåºï¼Œè¦æ±‚æ–°çš„åºåˆ—é‡Œxiâ‰¤xi+1â‰¤xi+1â€¦..ä¸¾ä¸ªä¾‹å­{4,6,5,7,3}ï¼Œæœ€é•¿ä¸ä¸‹é™å­åºåˆ—å°±æ˜¯{4,6,7}ã€‚</li><li><strong>å­é—®é¢˜çš„è¡¨ç¤ºï¼š</strong>ä»¤dp[i]è¡¨ç¤ºä»¥ç¬¬iä¸ªå…ƒç´ ç»“å°¾çš„å‰iä¸ªå…ƒç´ æ„æˆçš„æœ€é•¿ä¸ä¸‹é™å­åºåˆ—çš„é•¿åº¦</li><li><strong>ä¼˜åŒ–å­ç»“æ„</strong>ï¼šè‹¥æœ€é•¿ä¸ä¸‹é™å­åºåˆ—åŒ…æ‹¬akï¼Œåˆ™å¿…æœ‰ä¸€ä¸ªè§£åŒ…å«a1,a2â€¦ak-1çš„æœ€é•¿ä¸ä¸‹é™å­åºåˆ—ï¼Œdp[i]è¡¨ç¤ºä¸ºå‰iä¸ªå…ƒç´ çš„åºåˆ—çš„æœ€é•¿ä¸ä¸‹é™å­åºåˆ—</li><li><strong>æ–¹ç¨‹</strong>ï¼š <em>dp[i] = max{dp[j] | 0&lt;j&lt;i , ajâ‰¥ai} + 1</em></li><li><strong>ä¼ªä»£ç </strong>ï¼š</li></ul><p>ã€€ã€€ã€€ã€€è¾“å…¥a[1,â€¦,n]ã€€ã€€è¾“å‡ºï¼šæœ€é•¿å­åºåˆ—</p><p> ã€€ã€€ã€€ã€€<img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626142332007-952080845.png" alt="img"></p><p><strong>æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)</strong></p><h3 id="3-5-åˆ’åˆ†åŠ¨æ€è§„åˆ’ï¼šçŸ©é˜µé“¾ä¹˜ã€å‡¸å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†"><a href="#3-5-åˆ’åˆ†åŠ¨æ€è§„åˆ’ï¼šçŸ©é˜µé“¾ä¹˜ã€å‡¸å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†" class="headerlink" title="3.5 åˆ’åˆ†åŠ¨æ€è§„åˆ’ï¼šçŸ©é˜µé“¾ä¹˜ã€å‡¸å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†"></a>3.5 åˆ’åˆ†åŠ¨æ€è§„åˆ’ï¼šçŸ©é˜µé“¾ä¹˜ã€å‡¸å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†</h3><p><strong>ã€çŸ©é˜µé“¾ä¹˜ã€‘</strong></p><ul><li><strong>ä¼˜åŒ–å­ç»“æ„</strong>ï¼šè‹¥è®¡ç®—A1~nçš„ä¼˜åŒ–é¡ºåºåœ¨kå¤„æ–­å¼€çŸ©é˜µé“¾, å³A1~n=A1~k Ã— Ak+1~nï¼Œåˆ™åœ¨A1~nçš„ä¼˜åŒ–é¡ºåºä¸­ï¼Œå¯¹åº”äºå­é—®é¢˜A1~kçš„è§£å¿…é¡»æ˜¯A1-kçš„ä¼˜åŒ–è§£ï¼Œå¯¹åº”äºå­é—®é¢˜Ak+1~nçš„è§£å¿…é¡»æ˜¯Ak+1~nçš„ä¼˜åŒ–è§£</li><li><strong>å­é—®é¢˜é‡å æ€§ï¼š</strong></li></ul><p>ã€€ã€€ã€€ã€€<img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626144646962-1290294296.png" alt="img"></p><ul><li><strong>æ–¹ç¨‹ï¼š</strong></li></ul><p>å‡è®¾ï¼šm[i, j] = è®¡ç®—Ai~jçš„æœ€å°ä¹˜æ³•æ•°ï¼›  A1 â€¦ AkAk+1 â€¦. An æ˜¯ä¼˜åŒ–è§£(kå®é™…ä¸Šæ˜¯ä¸å¯é¢„çŸ¥)</p><p> ã€€<img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626143827583-1699093130.png" alt="img"></p><p>ã€€  <img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626144206832-946860971.png" alt="img"></p><ul><li><strong>ä¼ªä»£ç ï¼š</strong></li></ul><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š&lt;A1, A2, ..., An&gt;, Aiæ˜¯çŸ©é˜µ</span><br><span class="line">è¾“å‡ºï¼šè®¡ç®—A1 x A2 x ... x Ançš„æœ€å°ä»£ä»·æ–¹æ³•</span><br><span class="line"></span><br><span class="line">Matrix-Chain-Order(p)</span><br><span class="line">n=length(p)-<span class="number">1</span>ï¼›</span><br><span class="line"><span class="keyword">FOR</span> i=<span class="number">1</span> <span class="keyword">TO</span> n <span class="keyword">DO</span></span><br><span class="line">    m[i, i]=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">FOR</span> l=<span class="number">2</span> <span class="keyword">TO</span> n <span class="keyword">DO</span> <span class="comment">/* è®¡ç®—åœ°lå¯¹è§’çº¿*/</span></span><br><span class="line">    <span class="keyword">FOR</span> i=<span class="number">1</span> <span class="keyword">TO</span> n-l+<span class="number">1</span> <span class="keyword">DO</span></span><br><span class="line">        j=i+l-<span class="number">1</span>;</span><br><span class="line">        m[i, j]= âˆ;</span><br><span class="line">        <span class="keyword">FOR</span> kâ†i <span class="keyword">To</span> jâ†<span class="number">1</span> <span class="keyword">DO</span> <span class="comment">/* è®¡ç®—m[i,j] */</span></span><br><span class="line">             q=m[i, k]+m[k+<span class="number">1</span>, j]+ <span class="built_in">pi</span>-<span class="number">1</span>pkpj</span><br><span class="line">             <span class="keyword">IF</span> q&lt;m[i, j] <span class="keyword">THEN</span>                  m[i,j]=q; s[i,j]=k;</span><br><span class="line">Return m <span class="built_in">and</span> s.</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Print</span>-Optimal-Parens(s, i, j) <span class="comment">//æ„å»ºæœ€ä¼˜è§£ï¼Œè¾“å‡ºA1-nçš„ä¼˜åŒ–è®¡ç®—é¡ºåº</span></span><br><span class="line"> <span class="keyword">IF</span> j=<span class="built_in">i</span></span><br><span class="line"> THEN <span class="keyword">Print</span> â€œAâ€i;</span><br><span class="line"> <span class="keyword">ELSE</span> <span class="keyword">Print</span> â€œ(â€</span><br><span class="line">     <span class="keyword">Print</span>-Optimal-Parens(s, i, s[i, j])</span><br><span class="line">     <span class="keyword">Print</span>-Optimal-Parens(s, s[i, j]+1, j)</span><br><span class="line">     <span class="keyword">Print</span> â€œ)â€</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><ul><li>ç®—æ³•å¤æ‚åº¦<ul><li>è®¡ç®—ä»£ä»·çš„æ—¶é—´ï¼šä¸‰å±‚å¾ªç¯ O(n3)</li><li>æ„å»ºæœ€ä¼˜è§£çš„æ—¶é—´ï¼š O(n)</li><li><strong>æ€»æ—¶é—´å¤æ‚åº¦ï¼šO(n3)</strong></li></ul></li><li><p>ç©ºé—´å¤æ‚åº¦</p><ul><li>ä½¿ç”¨æ•°ç»„må’Œs</li><li>éœ€è¦<strong>ç©ºé—´O(n3)</strong></li></ul><p><strong>ã€ä¸‰è§’å‰–åˆ†ã€‘</strong></p></li><li><p><strong>ä¼˜åŒ–å­ç»“æ„</strong>ï¼šå°†å¤šè¾¹å½¢Påˆ’åˆ†ä¸ºä¸ç›¸äº¤ä¸‰è§’å½¢çš„å¼¦çš„é›†åˆ</p></li><li><strong>ä¼˜åŒ–é—®é¢˜</strong>:</li></ul><p><img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626150321546-748343160.png" alt="img"></p><ul><li><p><strong>æ–¹ç¨‹</strong>ï¼šè®¾t[i,j] = &lt;vi-1,vi,â€¦..,vj&gt;çš„ä¼˜åŒ–ä¸‰è§’å‰–åˆ†ä»£ä»·</p><p>ã€€<img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626150546681-278989483.png" alt="img"></p></li></ul><h3 id="3-6-æ•°è½´åŠ¨æ€è§„åˆ’ï¼š0-1èƒŒåŒ…"><a href="#3-6-æ•°è½´åŠ¨æ€è§„åˆ’ï¼š0-1èƒŒåŒ…" class="headerlink" title="3.6 æ•°è½´åŠ¨æ€è§„åˆ’ï¼š0-1èƒŒåŒ…"></a>3.6 æ•°è½´åŠ¨æ€è§„åˆ’ï¼š0-1èƒŒåŒ…</h3><p>### </p><ul><li><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šnç§ç‰©å“å’Œä¸€ä¸ªèƒŒåŒ…ï¼Œç‰©å“içš„é‡é‡æ˜¯wiï¼Œä»·å€¼viï¼ŒèƒŒåŒ…å®¹é‡ä¸ºCï¼Œé—®å¦‚ä½•é€‰æ‹©è£…å…¥èƒŒåŒ…çš„ç‰©å“ï¼Œä½¿è£…å…¥èƒŒåŒ…ä¸­çš„ç‰©å“çš„æ€»ä»·å€¼æœ€å¤§ï¼Ÿå¯¹äºæ¯ç§ç‰©å“æ€»èƒ½é€‰æ‹©å®Œå…¨è£…å…¥æˆ–ä¸è£…å…¥ï¼Œä¸€ä¸ªç‰©å“æœ€å¤šè£…å…¥ä¸€æ¬¡ã€‚</li><li><strong>ç­‰ä»·æ•´æ•°è§„åˆ’é—®é¢˜ï¼š</strong></li></ul><p>ã€€ã€€ã€€ã€€<img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626151529727-1771169615.png" alt="img"></p><ul><li><strong>Naiveçš„æ–¹æ³•</strong>ï¼šæ¯ä¸ªç‰©å“åªæœ‰ä¸¤ç§é€‰æ‹©ï¼šä¸è£…æˆ–è£…ï¼Œnä¸ªç‰©å“å…±2nä¸ªè£…å–æ–¹æ¡ˆï¼Œæ¯ä¸ªè£…å–æ–¹æ¡ˆçš„è®¡ç®—ä»£ä»·ä¸ºnï¼Œæ€»è®¡ç®—ä»£ä»·ä¸ºO(n2n)</li><li><p><strong>é—®é¢˜çš„åˆ’åˆ†ï¼š</strong></p><p>ã€€<img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626151725491-1249436922.png" alt="img"></p></li><li><p><strong>å®šä¹‰ä»£ä»·çŸ©é˜µmä¸æ–¹ç¨‹</strong>ï¼š  </p></li><li><ul><li><strong><em>å®šä¹‰m(i, j)\</em> :</strong>èƒŒåŒ…å®¹é‡ä¸ºjï¼Œå¯é€‰ç‰©å“ä¸ºxi,xi+1â€¦xnæ—¶ï¼Œé—®é¢˜çš„æœ€ä¼˜è§£ä»£ä»·æ—¶m[i,j]</li><li><em>m(n, j) = 0,  0</em> â‰¤ <em>j &lt;wn</em></li><li><em>m(n, j) = vn,  j â‰¥**wn</em></li><li><em>m(i, j) = m(i+1, j), ã€€ã€€   0â‰¤</em> <em>j&lt; wi</em></li><li><em>m(i, j) = max{m(i+1, j), m(i+1, j-wi)+vi},   j â‰¥</em> <em>wi</em></li></ul></li><li><p><strong>ä¼˜åŒ–å­ç»“æ„å’Œè‡ªåº•å‘ä¸Šçš„ä»£ä»·</strong></p></li></ul><p>ã€€ã€€<img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626154205161-1543350290.png" alt="img"><img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626154222124-1568769512.png" alt="img"></p><ul><li><strong>ä¼ªä»£ç </strong></li></ul><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><p>è¾“å…¥ï¼šC&gt;0, wi&gt;0, vi&gt;0, 1â‰¤ iâ‰¤n<br>è¾“å‡ºï¼š(x1, x2, â€¦, xn), xiâˆˆ{0, 1}, æ»¡è¶³ âˆ‘1â‰¤iâ‰¤nwi xi â‰¤C, âˆ‘1â‰¤iâ‰¤nvi xi æœ€å¤§</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">For</span> <span class="attribute">j</span>=0 <span class="keyword">To</span> min(wn-1, C) <span class="keyword">Do</span></span><br><span class="line">      m[n, j] = 0;</span><br><span class="line"><span class="keyword">For</span> <span class="attribute">j</span>=wn <span class="keyword">To</span> C <span class="keyword">Do</span></span><br><span class="line">      m[n, j] = vn;</span><br><span class="line"><span class="keyword">For</span> <span class="attribute">i</span>=n-1 <span class="keyword">To</span> 2 <span class="keyword">Do</span></span><br><span class="line">    <span class="keyword">For</span> <span class="attribute">j</span>=0 <span class="keyword">To</span> min(wi -1, C)  <span class="keyword">Do</span></span><br><span class="line">      m[i, j] = m[i+1, j];</span><br><span class="line">    <span class="keyword">For</span> <span class="attribute">j</span>=wi  <span class="keyword">To</span> C   <span class="keyword">Do</span></span><br><span class="line">      m[i, j]=max&#123;m[i+1, j], m[i+1, j-wi]+vi&#125;;</span><br><span class="line"><span class="keyword">If</span>  C&lt;w1  Then  m[1, C]=m[2, C];</span><br><span class="line">      <span class="keyword">Else</span>  m[1, C]=max&#123;m[2, C], m[2, C-w1]+v1&#125;;</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">m</span>(1, C)æ˜¯æœ€ä¼˜è§£ä»£ä»·å€¼ï¼Œç›¸åº”è§£è®¡ç®—å¦‚ä¸‹: <span class="comment">//æ„é€ ä¼˜åŒ–è§£</span></span><br><span class="line">    <span class="keyword">If</span> <span class="built_in">m</span>(1, C) = <span class="built_in">m</span>(2, C)</span><br><span class="line">    Then x1 = 0;</span><br><span class="line">    <span class="keyword">Else</span> x1 = 1;</span><br><span class="line">å¦‚æœx1=0, ç”±<span class="built_in">m</span>(2, C)ç»§ç»­æ„é€ æœ€ä¼˜è§£;</span><br><span class="line">å¦‚æœx1=1, ç”±<span class="built_in">m</span>(2, C-w1)ç»§ç»­æ„é€ æœ€ä¼˜è§£.</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š<ul><li>è®¡ç®—ä»£ä»·çš„æ—¶é—´ä¸ºO(Cn)</li><li>æ„é€ æœ€ä¼˜è§£çš„æ—¶é—´:O(Cn)</li><li><strong>æ€»æ—¶é—´å¤æ‚åº¦ä¸º:O(Cn)</strong></li></ul></li><li>ç©ºé—´å¤æ‚åº¦ï¼š<ul><li><strong>ä½¿ç”¨æ•°ç»„mï¼Œéœ€è¦ç©ºé—´O(Cn)</strong></li></ul></li></ul><h3 id="3-7-å‰ç¼€åŠ¨æ€è§„åˆ’ï¼šæœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰"><a href="#3-7-å‰ç¼€åŠ¨æ€è§„åˆ’ï¼šæœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰" class="headerlink" title="3.7 å‰ç¼€åŠ¨æ€è§„åˆ’ï¼šæœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰"></a>3.7 å‰ç¼€åŠ¨æ€è§„åˆ’ï¼šæœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰</h3><p>### </p><ul><li><strong>é—®é¢˜æè¿°</strong>ï¼šZæ˜¯åºåˆ—Xä¸Yçš„å…¬å…±å­åºåˆ—å¦‚æœZæ˜¯Xçš„å­åºåˆ—ä¹Ÿæ˜¯Yçš„å­åºåˆ—ã€‚</li><li><p><strong>Naiveæ–¹æ³•ï¼š</strong></p><ul><li>æšä¸¾Xçš„æ¯ä¸ªå­åºåˆ—Z</li><li>æ£€æŸ¥Zæ˜¯å¦ä¸ºYçš„å­åºåˆ—</li><li><strong>T(n)=O(n2m)</strong></li></ul></li><li><p><strong>ä¼˜åŒ–å­ç»“æ„ï¼š</strong></p></li><li><ul><li><em>è®¾X=(x1, â€¦, xm)ã€Y=(y1, â€¦, yn)æ˜¯ä¸¤ä¸ªåºåˆ—ï¼Œ LCSXY=(z1, â€¦, zk)æ˜¯Xä¸Yçš„LCSï¼Œæˆ‘ä»¬æœ‰ï¼š</em></li><li><em>å¦‚æœxm=yn, åˆ™zk=xm=yn, LCSXY = LCSXm-1Yn-1 + &lt;xm=yn&gt;,  LCSXm-1Yn-1æ˜¯Xm-1å’ŒYn-1çš„LCS.</em></li><li><em>å¦‚æœxm<strong>â‰ ynï¼Œä¸”zkâ‰ </strong>xmï¼Œåˆ™LCSXYæ˜¯Xm-1å’ŒYçš„LCSï¼Œå³ LCSXY = LCSXm-1Y</em></li><li><em>å¦‚æœxmâ‰ <strong>yn,ä¸”zkâ‰ </strong>yn,åˆ™LCSXYæ˜¯Xä¸Yn-1çš„LCSï¼Œå³ LCSXY = LCSXYn-1</em></li></ul></li></ul><p>ã€€ã€€ã€€ã€€<em><img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626161250797-846687005.png" alt="img"></em></p><ul><li><strong>å­é—®é¢˜é‡å æ€§</strong></li></ul><p><img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626161407046-1649798663.png" alt="img"></p><ul><li><strong>æ–¹ç¨‹ï¼š</strong></li></ul><p>ã€€ã€€ã€€ã€€<strong><img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626161153121-2116602929.png" alt="img"></strong></p><ul><li><strong>è‡ªåº•å‘ä¸Šè®¡ç®—ï¼š</strong></li></ul><p>ã€€ã€€ã€€ã€€<img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626161510812-1390787212.png" alt="img"></p><ul><li><strong>ä¼ªä»£ç </strong></li></ul><p><strong><img src="https://images2018.cnblogs.com/blog/1336655/201806/1336655-20180626164412918-1817122808.png" alt="img"></strong></p><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šX = (x1,x2,...,xm)ï¼ŒY = (y1,y2,...yn)</span><br><span class="line">è¾“å‡ºï¼šZ = Xä¸Yçš„æœ€é•¿å…¬å…±å­åºåˆ—</span><br><span class="line"></span><br><span class="line"><span class="keyword">C</span>[<span class="number">0</span>:m,<span class="number">0</span>:n]: <span class="keyword">C</span>[i,j]æ˜¯Xiä¸Yjçš„LCSçš„é•¿åº¦   B[<span class="number">1</span>:m,<span class="number">1</span>:n]:</span><br><span class="line">B[i,j]æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘è®¡ç®—<span class="keyword">C</span>[i,j]æ—¶æ‰€é€‰æ‹©çš„å­é—®é¢˜çš„ä¼˜åŒ–è§£æ‰€å¯¹åº”çš„<span class="keyword">C</span>è¡¨çš„è¡¨é¡¹</span><br><span class="line"></span><br><span class="line">LCS-length(X, Y)</span><br><span class="line">mâ†length(X)ï¼›nâ†length(Y)ï¼›</span><br><span class="line"><span class="keyword">For</span> iâ†<span class="number">0</span> To m <span class="keyword">Do</span> <span class="keyword">C</span>[i,<span class="number">0</span>]â†<span class="number">0</span>;</span><br><span class="line"><span class="keyword">For</span> jâ†<span class="number">0</span> To n <span class="keyword">Do</span> <span class="keyword">C</span>[<span class="number">0</span>,j]â†<span class="number">0</span>;</span><br><span class="line"><span class="keyword">For</span> iâ†<span class="number">1</span> To m <span class="keyword">Do</span></span><br><span class="line">  <span class="keyword">For</span> jâ†<span class="number">1</span> To n <span class="keyword">Do</span></span><br><span class="line">    <span class="keyword">If</span> xi = yj</span><br><span class="line">    Then <span class="keyword">C</span>[i,j]â†<span class="keyword">C</span>[i<span class="number">-1</span>,j<span class="number">-1</span>]+<span class="number">1</span>ï¼›B[i,j]â†â€œâ†–â€;</span><br><span class="line">      Else <span class="keyword">If</span> <span class="keyword">C</span>[i<span class="number">-1</span>,j]â‰¥<span class="keyword">C</span>[i,j<span class="number">-1</span>] Then</span><br><span class="line">              <span class="keyword">C</span>[i,j]â†<span class="keyword">C</span>[i<span class="number">-1</span>,j]; B[i,j]â†â€œâ†‘â€;</span><br><span class="line">           Else <span class="keyword">C</span>[i,j]â†<span class="keyword">C</span>[i,j<span class="number">-1</span>]; B[i,j]â†â€œâ†â€;</span><br><span class="line"><span class="keyword">Return</span> <span class="keyword">C</span> and B.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Print</span>-LCS(B, X, i, j)</span><br><span class="line">IF i=<span class="number">0</span> or j=<span class="number">0</span> THEN <span class="keyword">Return</span>;</span><br><span class="line">IF B[i, j]=â€œâ†–â€</span><br><span class="line">THEN <span class="keyword">Print</span>-LCS(B, X, i<span class="number">-1</span>, j<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">Print</span> xi;</span><br><span class="line">ELSE <span class="keyword">If</span> B[i, j]=â€œâ†‘â€</span><br><span class="line">    THEN <span class="keyword">Print</span>-LCS(B, X, i<span class="number">-1</span>, j);</span><br><span class="line">    ELSE <span class="keyword">Print</span>-LCS(B, X, i, j<span class="number">-1</span>).</span><br><span class="line"></span><br><span class="line"><span class="keyword">Print</span>-LCS(B, X, length(X), length(Y))</span><br><span class="line">      å¯æ‰“å°å‡ºXä¸Yçš„LCSã€‚</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a>;)</p><ul><li><p>æ—¶é—´å¤æ‚åº¦</p><p>ï¼š</p><ul><li>è®¡ç®—ä»£ä»·çš„æ—¶é—´ï¼šO(mn)</li><li>æ„é€ æœ€ä¼˜è§£çš„æ—¶é—´ï¼šO(m+n)</li><li><strong>æ€»æ—¶é—´å¤æ‚åº¦ä¸ºï¼š O(mn)</strong></li></ul></li><li><p>ç©ºé—´å¤æ‚åº¦</p><p>ï¼š</p><ul><li>ä½¿ç”¨æ•°ç»„Cå’ŒBï¼Œéœ€è¦<strong>ç©ºé—´O(mn)</strong></li></ul></li></ul><h3 id="3-8-æ ‘å½¢åŠ¨æ€è§„åˆ’ï¼šæœ€ä¼˜äºŒåˆ†æœç´¢æ ‘"><a href="#3-8-æ ‘å½¢åŠ¨æ€è§„åˆ’ï¼šæœ€ä¼˜äºŒåˆ†æœç´¢æ ‘" class="headerlink" title="3.8 æ ‘å½¢åŠ¨æ€è§„åˆ’ï¼šæœ€ä¼˜äºŒåˆ†æœç´¢æ ‘"></a>3.8 æ ‘å½¢åŠ¨æ€è§„åˆ’ï¼šæœ€ä¼˜äºŒåˆ†æœç´¢æ ‘</h3><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Š<a href="https://zh.wikipedia.org/zh-hans/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘-åŠ¨æ€è§„åˆ’</a>ã€‹</p><p>ğŸ”— ã€Š<a href="https://www.cnblogs.com/hithongming/p/9229871.html" target="_blank" rel="noopener">ã€ç®—æ³•å¤ä¹ ã€‘åŠ¨æ€è§„åˆ’</a>ã€‹</p><p>ğŸ”— ã€Š<a href="https://www.cnblogs.com/hithongming/p/9229871.html" target="_blank" rel="noopener">å¦‚ä½•ç†è§£åŠ¨æ€è§„åˆ’ï¼Ÿ</a>ã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹åŒ…æ‹¬ï¼šæ¦‚è¿°ï¼Œå®ç°ï¼Œç®—æ³•é¢˜ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="algorithm" scheme="http://linyishui.top/tags/algorithm/"/>
    
      <category term="unfinished" scheme="http://linyishui.top/tags/unfinished/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•å¤ä¹  (ä¸‰) å›¾-æ— å‘å›¾ï¼ˆæœªå®Œæˆï¼‰</title>
    <link href="http://linyishui.top/2021030401.html"/>
    <id>http://linyishui.top/2021030401.html</id>
    <published>2021-03-04T13:36:06.000Z</published>
    <updated>2021-04-20T05:29:50.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ç®—æ³•å¤ä¹ -ä¸‰-å›¾-æ— å‘å›¾"><a href="#ç®—æ³•å¤ä¹ -ä¸‰-å›¾-æ— å‘å›¾" class="headerlink" title="ç®—æ³•å¤ä¹  (ä¸‰) å›¾-æ— å‘å›¾"></a>ç®—æ³•å¤ä¹  (ä¸‰) å›¾-æ— å‘å›¾</h1><h2 id="ä¸€-å›¾"><a href="#ä¸€-å›¾" class="headerlink" title="ä¸€. å›¾"></a>ä¸€. å›¾</h2><h3 id="1-1-åº”ç”¨åœºæ™¯"><a href="#1-1-åº”ç”¨åœºæ™¯" class="headerlink" title="1.1 åº”ç”¨åœºæ™¯"></a>1.1 åº”ç”¨åœºæ™¯</h3><ul><li>åœ°å›¾ã€‚æ­£åœ¨è®¡åˆ’æ—…è¡Œçš„äººä¹Ÿè®¸æƒ³çŸ¥é“â€œä»æ™®ç½—ç»´ç™»æ–¯åˆ°æ™®æ—æ–¯é¡¿çš„æœ€çŸ­è·¯çº¿â€ã€‚å¯¹æœ€çŸ­è·¯å¾„ä¸Šç»å†è¿‡äº¤é€šå µå¡çš„æ—…è¡Œè€…å¯èƒ½ä¼šé—®ï¼šâ€œä»æ™®ç½—ç»´ç™»æ–¯åˆ°æ™®æ—æ–¯é¡¿çš„å“ªæ¡è·¯çº¿æœ€å¿«ï¼Ÿâ€è¦å›ç­”è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬éƒ½è¦å¤„ç†æœ‰å…³ç»“ç‚¹ï¼ˆåå­—è·¯å£ï¼‰ä¹‹é—´å¤šæ¡è¿æ¥ï¼ˆå…¬è·¯ï¼‰çš„ä¿¡æ¯ã€‚</li><li>ç½‘é¡µä¿¡æ¯ã€‚å½“æˆ‘ä»¬åœ¨æµè§ˆç½‘é¡µæ—¶ï¼Œé¡µé¢ä¸Šéƒ½ä¼šåŒ…å«å…¶ä»–ç½‘é¡µçš„å¼•ç”¨ï¼ˆé“¾æ¥ï¼‰ã€‚é€šè¿‡å•å‡»é“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªé¡µé¢è·³åˆ°å¦ä¸€ä¸ªé¡µé¢ã€‚æ•´ä¸ªäº’è”ç½‘å°±æ˜¯ä¸€å¼ å›¾ï¼Œç»“ç‚¹æ˜¯ç½‘é¡µï¼Œè¿æ¥å°±æ˜¯è¶…é“¾æ¥ã€‚å›¾ç®—æ³•æ˜¯å¸®åŠ©æˆ‘ä»¬åœ¨ç½‘ç»œä¸Šå®šä½ä¿¡æ¯çš„æœç´¢å¼•æ“çš„å…³é”®ç»„ä»¶ã€‚</li><li>ç”µè·¯ã€‚åœ¨ä¸€å—ç”µè·¯æ¿ä¸Šï¼Œæ™¶ä½“ç®¡ã€ç”µé˜»ã€ç”µå®¹ç­‰å„ç§å…ƒä»¶æ˜¯ç²¾å¯†è¿æ¥åœ¨ä¸€èµ·çš„ã€‚æˆ‘ä»¬ä½¿ç”¨è®¡ç®—æœºæ¥æ§åˆ¶åˆ¶é€ ç”µè·¯æ¿çš„æœºå™¨å¹¶æ£€æŸ¥ç”µè·¯æ¿çš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚æˆ‘ä»¬æ—¢è¦æ£€æŸ¥çŸ­è·¯è¿™ç±»ç®€å•é—®é¢˜ï¼Œä¹Ÿè¦æ£€æŸ¥è¿™å¹…ç”µè·¯å›¾ä¸­çš„å¯¼çº¿åœ¨èš€åˆ»åˆ°èŠ¯ç‰‡ä¸Šæ—¶æ˜¯å¦ä¼šå‡ºç°äº¤å‰ç­‰å¤æ‚é—®é¢˜ã€‚ç¬¬ä¸€ç±»é—®é¢˜çš„ç­”æ¡ˆä»…å–å†³äºè¿æ¥ï¼ˆå¯¼çº¿ï¼‰çš„å±æ€§ï¼Œè€Œç¬¬äºŒä¸ªé—®é¢˜åˆ™ä¼šæ¶‰åŠå¯¼çº¿ã€å„ç§å…ƒä»¶<br>ä»¥åŠèŠ¯ç‰‡çš„ç‰©ç†ç‰¹æ€§ç­‰è¯¦ç»†ä¿¡æ¯ã€‚</li><li>ä»»åŠ¡è°ƒåº¦ã€‚å•†å“çš„ç”Ÿäº§è¿‡ç¨‹åŒ…å«äº†è®¸å¤šå·¥åºä»¥åŠä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶ä¼šå†³å®šæŸäº›ä»»åŠ¡çš„å…ˆåæ¬¡åºã€‚å¦‚ä½•å®‰æ’æ‰èƒ½åœ¨æ»¡è¶³é™åˆ¶æ¡ä»¶çš„æƒ…å†µä¸‹ç”¨æœ€å°‘çš„æ—¶é—´å®Œæˆè¿™äº›ç”Ÿäº§å·¥åºå‘¢ï¼Ÿ<br>å•†ä¸šäº¤æ˜“ã€‚é›¶å”®å•†å’Œé‡‘èæœºæ„éƒ½ä¼šè·Ÿè¸ªå¸‚åœºä¸­çš„ä¹°å–ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œä¸€æ¡è¿æ¥å¯ä»¥è¡¨ç¤ºç°é‡‘å’Œå•†å“åœ¨ä¹°æ–¹å’Œå–æ–¹ä¹‹é—´çš„è½¬ç§»ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œç†è§£å›¾çš„è¿æ¥ç»“æ„åŸç†å¯èƒ½æœ‰åŠ©äºå¢å¼ºäººä»¬å¯¹å¸‚åœºçš„ç†è§£ã€‚</li><li>é…å¯¹ã€‚å­¦ç”Ÿå¯ä»¥ç”³è¯·åŠ å…¥å„ç§æœºæ„ï¼Œä¾‹å¦‚ç¤¾äº¤ä¿±ä¹éƒ¨ã€å¤§å­¦æˆ–æ˜¯åŒ»å­¦é™¢ç­‰ã€‚è¿™é‡Œç»“ç‚¹å°±å¯¹åº”å­¦ç”Ÿå’Œæœºæ„ï¼Œè€Œè¿æ¥åˆ™å¯¹åº”é€’äº¤çš„ç”³è¯·ã€‚æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ç”³è¯·è€…ä¸ä»–ä»¬æ„Ÿå…´è¶£çš„ç©ºä½ä¹‹é—´é…å¯¹çš„æ–¹æ³•ã€‚</li><li>è®¡ç®—æœºç½‘ç»œã€‚è®¡ç®—æœºç½‘ç»œæ˜¯ç”±èƒ½å¤Ÿå‘é€ã€è½¬å‘å’Œæ¥æ”¶å„ç§æ¶ˆæ¯çš„ç«™ç‚¹äº’ç›¸è¿æ¥ç»„æˆçš„ã€‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯è¿™ç§äº’è”ç»“æ„çš„æ€§è´¨ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›ç½‘ç»œä¸­çš„çº¿è·¯å’Œäº¤æ¢è®¾å¤‡èƒ½å¤Ÿé«˜æ•ˆç‡åœ°å¤„ç†ç½‘ç»œæµé‡ã€‚</li><li>è½¯ä»¶ã€‚ç¼–è¯‘å™¨ä¼šä½¿ç”¨å›¾æ¥è¡¨ç¤ºå¤§å‹è½¯ä»¶ç³»ç»Ÿä¸­å„ä¸ªæ¨¡å—ä¹‹é—´çš„å…³ç³»ã€‚å›¾ä¸­çš„ç»“ç‚¹å³æ„æˆæ•´ä¸ªç³»ç»Ÿçš„å„ç§ç±»å’Œæ¨¡å—ï¼Œè¿æ¥åˆ™ä¸ºç±»çš„æ–¹æ³•ä¹‹é—´çš„å¯èƒ½è°ƒç”¨å…³ç³»ï¼ˆé™æ€åˆ†æï¼‰ï¼Œæˆ–æ˜¯ç³»ç»Ÿè¿è¡Œæ—¶çš„å®é™…è°ƒç”¨å…³ç³»ï¼ˆåŠ¨æ€åˆ†æï¼‰ã€‚æˆ‘ä»¬éœ€è¦åˆ†æè¿™å¹…å›¾æ¥å†³å®šå¦‚ä½•ä»¥æœ€ä¼˜çš„æ–¹å¼ä¸ºç¨‹åºåˆ†é…èµ„æºã€‚</li><li>ç¤¾äº¤ç½‘ç»œã€‚å½“ä½ åœ¨ä½¿ç”¨ç¤¾äº¤ç½‘ç«™æ—¶ï¼Œä¼šå’Œä½ çš„æœ‹å‹ä¹‹é—´å»ºç«‹èµ·æ˜ç¡®çš„å…³ç³»ã€‚è¿™é‡Œï¼Œç»“ç‚¹å¯¹åº”äººè€Œè¿æ¥åˆ™è”ç³»ç€ä½ å’Œä½ çš„æœ‹å‹æˆ–æ˜¯å…³æ³¨è€…ã€‚åˆ†æè¿™äº›ç¤¾äº¤ç½‘ç»œçš„æ€§è´¨æ˜¯å½“å‰å›¾ç®—æ³•çš„ä¸€ä¸ªé‡è¦åº”ç”¨ã€‚å¯¹å®ƒæ„Ÿå…´è¶£çš„ä¸æ­¢æ˜¯ç¤¾äº¤ç½‘ç»œçš„å…¬å¸ï¼Œè¿˜åŒ…æ‹¬æ”¿æ²»ã€å¤–äº¤ã€å¨±ä¹ã€æ•™è‚²ã€å¸‚åœºç­‰è®¸å¤šå…¶ä»–æœºæ„ã€‚</li></ul><table><thead><tr><th>åº”ç”¨</th><th>ç»“ç‚¹</th><th>è¿æ¥</th></tr></thead><tbody><tr><td>åœ°å›¾</td><td>åå­—è·¯å£</td><td>å…¬è·¯</td></tr><tr><td>ç½‘ç»œå†…å®¹</td><td>ç½‘é¡µ</td><td>è¶…é“¾æ¥</td></tr><tr><td>ç”µè·¯</td><td>å…ƒå™¨ä»¶</td><td>å¯¼çº¿</td></tr><tr><td>ä»»åŠ¡è°ƒåº¦</td><td>ä»»åŠ¡</td><td>é™åˆ¶æ¡ä»¶</td></tr><tr><td>å•†ä¸šäº¤æ˜“</td><td>å®¢æˆ·</td><td>äº¤æ˜“</td></tr><tr><td>é…å¯¹</td><td>å­¦ç”Ÿ</td><td>ç”³è¯·</td></tr><tr><td>è®¡ç®—æœºç½‘ç»œ</td><td>ç½‘ç«™</td><td>ç‰©ç†è¿æ¥</td></tr><tr><td>è½¯ä»¶</td><td>æ–¹æ³•</td><td>è°ƒç”¨å…³ç³»</td></tr><tr><td>ç¤¾äº¤ç½‘ç»œ</td><td>äºº</td><td>å‹è°Šå…³ç³»</td></tr></tbody></table><h3 id="1-2-å¸¸ç”¨æœ¯è¯­"><a href="#1-2-å¸¸ç”¨æœ¯è¯­" class="headerlink" title="1.2 å¸¸ç”¨æœ¯è¯­"></a>1.2 å¸¸ç”¨æœ¯è¯­</h3><ul><li>æŸä¸ªé¡¶ç‚¹çš„åº¦æ•°å³ä¸ºä¾é™„äºå®ƒçš„è¾¹çš„æ€»æ•°ã€‚</li><li>å­å›¾æ˜¯ç”±ä¸€å¹…å›¾çš„æ‰€æœ‰è¾¹çš„ä¸€ä¸ªå­é›†ï¼ˆä»¥åŠå®ƒä»¬æ‰€ä¾é™„çš„æ‰€æœ‰é¡¶ç‚¹ï¼‰ç»„æˆçš„å›¾ã€‚è®¸å¤šè®¡ç®—é—®é¢˜éƒ½éœ€è¦è¯†åˆ«å„ç§ç±»å‹çš„å­å›¾ï¼Œç‰¹åˆ«æ˜¯ç”±èƒ½å¤Ÿé¡ºåºè¿æ¥ä¸€ç³»åˆ—é¡¶ç‚¹çš„è¾¹æ‰€ç»„æˆçš„å­å›¾ã€‚</li><li>è·¯å¾„æ˜¯ç”±è¾¹é¡ºåºè¿æ¥çš„ä¸€ç³»åˆ—é¡¶ç‚¹ã€‚</li><li>ç®€å•è·¯å¾„æ˜¯ä¸€æ¡æ²¡æœ‰é‡å¤é¡¶ç‚¹çš„è·¯å¾„ã€‚ç¯æ˜¯ä¸€æ¡è‡³å°‘å«æœ‰ä¸€æ¡è¾¹ä¸”èµ·ç‚¹å’Œç»ˆç‚¹ç›¸åŒçš„è·¯å¾„ã€‚</li><li>ç®€å•ç¯æ˜¯ä¸€æ¡ï¼ˆé™¤äº†èµ·ç‚¹å’Œç»ˆç‚¹å¿…é¡»ç›¸åŒä¹‹å¤–ï¼‰ä¸å«æœ‰é‡å¤é¡¶ç‚¹å’Œè¾¹çš„ç¯ã€‚</li><li>è·¯å¾„æˆ–è€…ç¯çš„é•¿åº¦ä¸ºå…¶ä¸­æ‰€åŒ…å«çš„è¾¹æ•°ã€‚</li><li>å½“ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´å­˜åœ¨ä¸€æ¡è¿æ¥åŒæ–¹çš„è·¯å¾„æ—¶ï¼Œæˆ‘ä»¬ç§°ä¸€ä¸ªé¡¶ç‚¹å’Œå¦ä¸€ä¸ªé¡¶ç‚¹æ˜¯è¿é€šçš„ã€‚</li><li>å¦‚æœä»ä»»æ„ä¸€ä¸ªé¡¶ç‚¹éƒ½å­˜åœ¨ä¸€æ¡è·¯å¾„åˆ°è¾¾å¦ä¸€ä¸ªä»»æ„é¡¶ç‚¹ï¼Œæˆ‘ä»¬ç§°è¿™å¹…å›¾æ˜¯<strong>è¿é€šå›¾</strong>ã€‚ä¸€å¹…éè¿é€šçš„å›¾ç”±è‹¥å¹²è¿é€šçš„éƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬éƒ½æ˜¯å…¶æå¤§è¿é€šå­å›¾ã€‚</li><li>æ— ç¯å›¾æ˜¯ä¸€ç§ä¸åŒ…å«ç¯çš„å›¾ã€‚</li><li>å›¾çš„å¯†åº¦æ˜¯æŒ‡å·²ç»è¿æ¥çš„é¡¶ç‚¹å¯¹å æ‰€æœ‰å¯èƒ½è¢«è¿æ¥çš„é¡¶ç‚¹å¯¹çš„æ¯”ä¾‹ã€‚åœ¨ç¨€ç–å›¾ä¸­ï¼Œè¢«è¿æ¥çš„é¡¶ç‚¹å¯¹å¾ˆå°‘ï¼›è€Œåœ¨ç¨ å¯†å›¾ä¸­ï¼Œåªæœ‰å°‘éƒ¨åˆ†é¡¶ç‚¹å¯¹ä¹‹é—´æ²¡æœ‰è¾¹è¿æ¥ã€‚</li><li>äºŒåˆ†å›¾æ˜¯ä¸€ç§èƒ½å¤Ÿå°†æ‰€æœ‰ç»“ç‚¹åˆ†ä¸ºä¸¤éƒ¨åˆ†çš„å›¾ï¼Œå…¶ä¸­å›¾çš„æ¯æ¡è¾¹æ‰€è¿æ¥çš„ä¸¤ä¸ªé¡¶ç‚¹éƒ½åˆ†åˆ«å±äºä¸åŒçš„éƒ¨åˆ†ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010113.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010116.png" alt></p><h3 id="1-3-å›¾ä¸æ ‘çš„å…³ç³»"><a href="#1-3-å›¾ä¸æ ‘çš„å…³ç³»" class="headerlink" title="1.3 å›¾ä¸æ ‘çš„å…³ç³»"></a>1.3 å›¾ä¸æ ‘çš„å…³ç³»</h3><p>æ ‘æ˜¯ä¸€å¹…æ— ç¯è¿é€šå›¾ã€‚äº’ä¸ç›¸è¿çš„æ ‘ç»„æˆçš„é›†åˆç§°ä¸ºæ£®æ—ã€‚è¿é€šå›¾çš„ç”Ÿæˆæ ‘æ˜¯å®ƒçš„ä¸€å¹…å­å›¾ï¼Œå®ƒå«æœ‰å›¾ä¸­çš„æ‰€æœ‰é¡¶ç‚¹ä¸”æ˜¯ä¸€æ£µæ ‘ã€‚å›¾çš„ç”Ÿæˆæ ‘æ£®æ—æ˜¯å®ƒçš„æ‰€æœ‰è¿é€šå­å›¾çš„ç”Ÿæˆæ ‘çš„é›†åˆã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010114.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010115.png" alt></p><p>å½“ä¸”ä»…å½“ä¸€å¹…å«æœ‰Vä¸ªç»“ç‚¹çš„å›¾æ»¡è¶³ä¸‹åˆ— 5 ä¸ªæ¡ä»¶ä¹‹ä¸€æ—¶ï¼Œå®ƒå°±æ˜¯ä¸€æ£µæ ‘ï¼š</p><ul><li>Gæœ‰V-1æ¡è¾¹ä¸”ä¸å«æœ‰ç¯ï¼›</li><li>Gæœ‰V-1æ¡è¾¹ä¸”æ˜¯è¿é€šçš„ï¼›</li><li>Gæ˜¯è¿é€šçš„ï¼Œä½†åˆ é™¤ä»»æ„ä¸€æ¡è¾¹éƒ½ä¼šä½¿å®ƒä¸å†è¿é€šï¼›</li><li>Gæ˜¯æ— ç¯å›¾ï¼Œä½†æ·»åŠ ä»»æ„ä¸€æ¡è¾¹éƒ½ä¼šäº§ç”Ÿä¸€æ¡ç¯ï¼›</li><li>Gä¸­çš„ä»»æ„ä¸€å¯¹é¡¶ç‚¹ä¹‹é—´ä»…å­˜åœ¨ä¸€æ¡ç®€å•è·¯å¾„ã€‚</li></ul><h3 id="1-4-å››ç§å›¾æ¨¡å‹"><a href="#1-4-å››ç§å›¾æ¨¡å‹" class="headerlink" title="1.4 å››ç§å›¾æ¨¡å‹"></a>1.4 å››ç§å›¾æ¨¡å‹</h3><p>4 ç§æœ€é‡è¦çš„å›¾æ¨¡å‹ï¼š</p><ul><li>æ— å‘å›¾ï¼ˆç®€å•è¿æ¥ï¼‰</li><li>æœ‰å‘å›¾ï¼ˆè¿æ¥æœ‰æ–¹å‘æ€§ï¼‰</li><li>åŠ æƒå›¾ï¼ˆè¿æ¥å¸¦æœ‰æƒå€¼ï¼‰</li><li>åŠ æƒæœ‰å‘å›¾ï¼ˆè¿æ¥æ—¢æœ‰æ–¹å‘æ€§åˆå¸¦æœ‰æƒå€¼ï¼‰</li></ul><h2 id="äºŒ-æ— å‘å›¾"><a href="#äºŒ-æ— å‘å›¾" class="headerlink" title="äºŒ. æ— å‘å›¾"></a>äºŒ. æ— å‘å›¾</h2><h4 id="ï¼ˆ1ï¼‰æ¦‚å¿µ"><a href="#ï¼ˆ1ï¼‰æ¦‚å¿µ" class="headerlink" title="ï¼ˆ1ï¼‰æ¦‚å¿µ"></a>ï¼ˆ1ï¼‰æ¦‚å¿µ</h4><p>å®šä¹‰ï¼šå›¾æ˜¯ç”±ä¸€ç»„é¡¶ç‚¹å’Œä¸€ç»„èƒ½å¤Ÿå°†ä¸¤ä¸ªé¡¶ç‚¹ç›¸è¿çš„è¾¹ç»„æˆçš„ã€‚</p><p>ä¸€èˆ¬ä½¿ç”¨ 0 è‡³ V-1 æ¥è¡¨ç¤ºä¸€å¼ å«æœ‰ V ä¸ªé¡¶ç‚¹çš„å›¾ä¸­çš„å„ä¸ªé¡¶<br>ç‚¹ã€‚ç”¨ v-w çš„è®°æ³•æ¥è¡¨ç¤ºè¿æ¥ v å’Œ w çš„è¾¹ï¼Œw-v æ˜¯è¿™æ¡è¾¹çš„å¦ä¸€ç§è¡¨ç¤ºæ–¹æ³•ã€‚</p><p>ç»˜åˆ¶å‡ºçš„å›¾æœ‰æ—¶ä¼šè¯¯å¯¼æˆ‘ä»¬ï¼Œå› ä¸ºå›¾çš„å®šä¹‰å’Œç»˜å‡ºçš„å›¾åƒæ˜¯æ— å…³çš„ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010111.png" alt></p><p>ç‰¹æ®Šçš„å›¾ã€‚æˆ‘ä»¬çš„å®šä¹‰å…è®¸å‡ºç°ä¸¤ç§ç®€å•è€Œç‰¹æ®Šçš„æƒ…å†µï¼š</p><ul><li>è‡ªç¯ï¼Œå³ä¸€æ¡è¿æ¥ä¸€ä¸ªé¡¶ç‚¹å’Œå…¶è‡ªèº«çš„è¾¹ï¼›</li><li>è¿æ¥åŒä¸€å¯¹é¡¶ç‚¹çš„ä¸¤æ¡è¾¹ç§°ä¸ºå¹³è¡Œè¾¹ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010112.png" alt></p><p>æ•°å­¦å®¶å¸¸å¸¸å°†å«æœ‰å¹³è¡Œè¾¹çš„å›¾ç§°ä¸ºå¤šé‡å›¾ï¼Œè€Œå°†æ²¡æœ‰å¹³è¡Œè¾¹æˆ–è‡ªç¯çš„å›¾ç§°ä¸ºç®€å•å›¾ã€‚åç»­ä¸ä¼šå‡ºç°è¿™ç§ç‰¹æ®Šæƒ…å†µï¼Œæ‰€ä»¥ç”¨ä¸¤ä¸ªé¡¶ç‚¹å°±å¯ä»¥æŒ‡ä»£ä¸€æ¡è¾¹äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bag</span>&lt;<span class="title">Item</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">Item</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Node first; <span class="comment">// é“¾è¡¨çš„é¦–ç»“ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        Item item;</span><br><span class="line">        Node next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Item item)</span> </span>&#123; <span class="comment">// å’ŒStack çš„push() æ–¹æ³•å®Œå…¨ç›¸åŒ</span></span><br><span class="line">        Node oldfirst = first;</span><br><span class="line">        first = <span class="keyword">new</span> Node();</span><br><span class="line">        first.item = item;</span><br><span class="line">        first.next = oldfirst;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;Item&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ListIterator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ListIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Item</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Node current = first;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> current != <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Item <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Item item = current.item;</span><br><span class="line">            current = current.next;</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Graph</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> V; <span class="comment">// é¡¶ç‚¹æ•°ç›®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> E; <span class="comment">// è¾¹çš„æ•°ç›®</span></span><br><span class="line">    <span class="keyword">private</span> Bag&lt;Integer&gt;[] adj; <span class="comment">// é‚»æ¥è¡¨ï¼šæ•°ç»„+é“¾è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graph</span><span class="params">(<span class="keyword">int</span> V)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.V = V;</span><br><span class="line">        <span class="keyword">this</span>.E = <span class="number">0</span>;</span><br><span class="line">        adj = (Bag&lt;Integer&gt;[]) <span class="keyword">new</span> Bag[V]; <span class="comment">// åˆ›å»ºé‚»æ¥è¡¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">0</span>; v &lt; V; v++) <span class="comment">// å°†æ‰€æœ‰é“¾è¡¨åˆå§‹åŒ–ä¸ºç©º</span></span><br><span class="line">            adj[v] = <span class="keyword">new</span> Bag&lt;Integer&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graph</span><span class="params">(In in)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(in.readInt()); <span class="comment">// è¯»å–Vå¹¶å°†å›¾åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">int</span> E = in.readInt(); <span class="comment">// è¯»å–E</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; E; i++) &#123; <span class="comment">// æ·»åŠ ä¸€æ¡è¾¹</span></span><br><span class="line">            <span class="keyword">int</span> v = in.readInt(); <span class="comment">// è¯»å–ä¸€ä¸ªé¡¶ç‚¹</span></span><br><span class="line">            <span class="keyword">int</span> w = in.readInt(); <span class="comment">// è¯»å–å¦ä¸€ä¸ªé¡¶ç‚¹</span></span><br><span class="line">            addEdge(v, w); <span class="comment">// æ·»åŠ ä¸€æ¡è¿æ¥å®ƒä»¬çš„è¾¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">V</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> V;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">E</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> E;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        adj[v].add(w); <span class="comment">// å°†wæ·»åŠ åˆ°vçš„é“¾è¡¨ä¸­</span></span><br><span class="line">        adj[w].add(v); <span class="comment">// å°†væ·»åŠ åˆ°wçš„é“¾è¡¨ä¸­</span></span><br><span class="line">        E++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterable&lt;Integer&gt; <span class="title">adj</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> adj[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰-æ·±åº¦ä¼˜å…ˆæœç´¢"><a href="#ä¸‰-æ·±åº¦ä¼˜å…ˆæœç´¢" class="headerlink" title="ä¸‰. æ·±åº¦ä¼˜å…ˆæœç´¢"></a>ä¸‰. æ·±åº¦ä¼˜å…ˆæœç´¢</h2><h3 id="3-1-ä»€ä¹ˆæ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Ÿ"><a href="#3-1-ä»€ä¹ˆæ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Ÿ" class="headerlink" title="3.1 ä»€ä¹ˆæ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Ÿ"></a>3.1 ä»€ä¹ˆæ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Ÿ</h3><p><strong>æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•</strong>ï¼ˆè‹±è¯­ï¼šDepth-First-Searchï¼ŒDFSï¼‰æ˜¯ä¸€ç§ç”¨äºéå†æˆ–æœç´¢æ ‘æˆ–å›¾çš„é€’å½’ç®—æ³•ï¼Œå®ƒä¼šæ²¿ç€å›¾çš„è¾¹å¯»æ‰¾å’Œèµ·ç‚¹è¿é€šçš„æ‰€æœ‰é¡¶ç‚¹ã€‚è¿™ä¸ªç®—æ³•ä¼šå°½å¯èƒ½æ·±çš„æœç´¢æ ‘çš„åˆ†æ”¯ã€‚å½“èŠ‚ç‚¹vçš„æ‰€åœ¨è¾¹éƒ½å·±è¢«æ¢å¯»è¿‡ï¼Œæœç´¢å°†å›æº¯åˆ°å‘ç°èŠ‚ç‚¹vçš„é‚£æ¡è¾¹çš„èµ·å§‹èŠ‚ç‚¹ã€‚è¿™ä¸€è¿‡ç¨‹ä¸€ç›´è¿›è¡Œåˆ°å·²å‘ç°ä»æºèŠ‚ç‚¹å¯è¾¾çš„æ‰€æœ‰èŠ‚ç‚¹ä¸ºæ­¢ã€‚å¦‚æœè¿˜å­˜åœ¨æœªè¢«å‘ç°çš„èŠ‚ç‚¹ï¼Œåˆ™é€‰æ‹©å…¶ä¸­ä¸€ä¸ªä½œä¸ºæºèŠ‚ç‚¹å¹¶é‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œæ•´ä¸ªè¿›ç¨‹åå¤è¿›è¡Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®ä¸ºæ­¢ã€‚</p><p>æ·±åº¦ä¼˜å…ˆæœç´¢æ˜¯å›¾è®ºä¸­çš„ç»å…¸ç®—æ³•ï¼Œåˆ©ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•å¯ä»¥äº§ç”Ÿç›®æ ‡å›¾çš„æ‹“æ‰‘æ’åºï¼Œåˆ©ç”¨æ‹“æ‰‘æ’åºè¡¨å¯ä»¥æ–¹ä¾¿çš„è§£å†³å¾ˆå¤šç›¸å…³çš„å›¾è®ºé—®é¢˜ï¼Œå¦‚æ— æƒæœ€é•¿è·¯å¾„é—®é¢˜ç­‰ç­‰ã€‚è¿™ç§ç®—æ³•ä¸ä¼šæ ¹æ®å›¾çš„ç»“æ„ç­‰ä¿¡æ¯è°ƒæ•´æ‰§è¡Œç­–ç•¥æ¥æºè¯·æ±‚ã€‚</p><h3 id="3-2-è¿·å®«é—®é¢˜å’Œ-Tremaux-æœç´¢"><a href="#3-2-è¿·å®«é—®é¢˜å’Œ-Tremaux-æœç´¢" class="headerlink" title="3.2 è¿·å®«é—®é¢˜å’Œ Tremaux æœç´¢"></a>3.2 è¿·å®«é—®é¢˜å’Œ Tremaux æœç´¢</h3><p>æ€è€ƒå›¾çš„æœç´¢è¿‡ç¨‹çš„ä¸€ç§æœ‰ç›Šçš„æ–¹æ³•æ˜¯ï¼Œè€ƒè™‘å¦ä¸€ä¸ªå’Œå®ƒç­‰ä»·çš„é—®é¢˜ï¼šåœ¨ä¸€ä¸ªç”±å„ç§é€šé“å’Œè·¯å£ç»„æˆçš„è¿·å®«ä¸­æ‰¾åˆ°å‡ºè·¯ã€‚æœ‰äº›è¿·å®«çš„è§„åˆ™å¾ˆç®€å•ï¼Œä½†å¤§å¤šæ•°è¿·å®«åˆ™éœ€è¦å¾ˆå¤æ‚çš„ç­–ç•¥æ‰è¡Œã€‚</p><p>ç”¨è¿·å®«ä»£æ›¿å›¾ã€é€šé“ä»£æ›¿è¾¹ã€è·¯å£ä»£æ›¿é¡¶ç‚¹ä»…ä»…åªæ˜¯ä¸€äº›æ–‡å­—æ¸¸æˆï¼Œä½†å°±ç›®å‰æ¥è¯´ï¼Œè¿™ä¹ˆåšå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç›´è§‚åœ°è®¤è¯†é—®é¢˜ï¼Œå‚è§ä¸‹å›¾ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010102.png" alt></p><p>æ¢ç´¢è¿·å®«è€Œä¸è¿·è·¯çš„ä¸€ç§å¤è€åŠæ³•ï¼ˆè‡³å°‘å¯ä»¥è¿½æº¯åˆ°å¿’ä¿®æ–¯å’Œç±³è¯ºé™¶çš„ä¼ è¯´ï¼‰å«åš <strong>Tremaux æœç´¢</strong>ï¼Œå‚è§ä¸‹å›¾ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010103.png" alt></p><p>è¦æ¢ç´¢è¿·å®«ä¸­çš„æ‰€æœ‰é€šé“ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ul><li>é€‰æ‹©ä¸€æ¡æ²¡æœ‰æ ‡è®°è¿‡çš„é€šé“ï¼Œåœ¨ä½ èµ°è¿‡çš„è·¯ä¸Šé“ºä¸€æ¡ç»³å­ï¼›</li><li>æ ‡è®°æ‰€æœ‰ä½ ç¬¬ä¸€æ¬¡è·¯è¿‡çš„è·¯å£å’Œé€šé“ï¼›</li><li>å½“æ¥åˆ°ä¸€ä¸ªæ ‡è®°è¿‡çš„è·¯å£æ—¶ï¼ˆç”¨ç»³å­ï¼‰å›é€€åˆ°ä¸Šä¸ªè·¯å£ï¼›</li><li>å½“å›é€€åˆ°çš„è·¯å£å·²æ²¡æœ‰å¯èµ°çš„é€šé“æ—¶ç»§ç»­å›é€€ã€‚</li></ul><p>ç»³å­å¯ä»¥ä¿è¯ä½ æ€»èƒ½æ‰¾åˆ°ä¸€æ¡å‡ºè·¯ï¼Œæ ‡è®°åˆ™èƒ½ä¿è¯ä½ ä¸ä¼šä¸¤æ¬¡ç»è¿‡åŒä¸€æ¡é€šé“æˆ–è€…åŒä¸€ä¸ªè·¯å£ã€‚è¦çŸ¥é“æ˜¯å¦å®Œå…¨æ¢ç´¢äº†æ•´ä¸ªè¿·å®«éœ€è¦çš„è¯æ˜æ›´å¤æ‚ï¼Œåªæœ‰ç”¨å›¾æœç´¢æ‰èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†é—®é¢˜ã€‚</p><p>Tremaux æœç´¢å¾ˆç›´æ¥ï¼Œä½†å®ƒä¸å®Œå…¨æœç´¢ä¸€å¼ å›¾ä»ç„¶ç¨æœ‰ä¸åŒï¼Œå› æ­¤æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹å›¾çš„æœç´¢æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepthFirstSearch</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span>[] marked;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DepthFirstSearch</span><span class="params">(Graph G, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        marked = <span class="keyword">new</span> <span class="keyword">boolean</span>[G.V()];</span><br><span class="line">        dfs(G, s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(Graph G, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        marked[v] = <span class="keyword">true</span>;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> w : G.adj(v))</span><br><span class="line">            <span class="keyword">if</span> (!marked[w]) dfs(G, w);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">marked</span><span class="params">(<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> marked[w];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-ç®—æ³•æè¿°"><a href="#3-3-ç®—æ³•æè¿°" class="headerlink" title="3.3 ç®—æ³•æè¿°"></a>3.3 ç®—æ³•æè¿°</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010104.png" alt></p><p>æœç´¢è¿é€šå›¾çš„ç»å…¸é€’å½’ç®—æ³•<strong>æ·±åº¦ä¼˜å…ˆæœç´¢</strong>ï¼ˆéå†æ‰€æœ‰çš„é¡¶ç‚¹å’Œè¾¹ï¼‰å’Œ Tremaux æœç´¢ç±»ä¼¼ã€‚è¦æœç´¢ä¸€å¹…å›¾ï¼Œåªéœ€ç”¨ä¸€ä¸ªé€’å½’æ–¹æ³•æ¥éå†æ‰€æœ‰é¡¶ç‚¹ã€‚<strong>æ·±åº¦ä¼˜å…ˆæœç´¢æ ‡è®°ä¸èµ·ç‚¹è¿é€šçš„æ‰€æœ‰é¡¶ç‚¹æ‰€éœ€çš„æ—¶é—´å’Œé¡¶ç‚¹çš„åº¦æ•°ä¹‹å’Œæˆæ­£æ¯”</strong>ã€‚</p><p>åœ¨è®¿é—®å…¶ä¸­ä¸€ä¸ªé¡¶ç‚¹æ—¶ï¼š</p><ul><li>å°†å®ƒæ ‡è®°ä¸ºå·²è®¿é—®ï¼›</li><li>é€’å½’åœ°è®¿é—®å®ƒçš„æ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°è¿‡çš„é‚»å±…é¡¶ç‚¹ã€‚</li></ul><p>å®ƒä½¿ç”¨ä¸€ä¸ª boolean æ•°ç»„æ¥è®°å½•å’Œèµ·ç‚¹è¿é€šçš„æ‰€æœ‰é¡¶ç‚¹ã€‚é€’å½’æ–¹æ³•ä¼šæ ‡è®°ç»™å®šçš„é¡¶ç‚¹å¹¶è°ƒç”¨è‡ªå·±æ¥è®¿é—®è¯¥é¡¶ç‚¹çš„ç›¸é‚»é¡¶ç‚¹åˆ—è¡¨ä¸­æ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°è¿‡çš„é¡¶ç‚¹ã€‚å¦‚æœå›¾æ˜¯è¿é€šçš„ï¼Œæ¯ä¸ªé‚»æ¥é“¾è¡¨ä¸­çš„å…ƒç´ éƒ½ä¼šè¢«æ£€æŸ¥åˆ°ã€‚</p><p>ç®—æ³•éå†è¾¹å’Œè®¿é—®é¡¶ç‚¹çš„é¡ºåºä¸å›¾çš„è¡¨ç¤ºæ˜¯æœ‰å…³çš„ï¼Œè€Œä¸åªæ˜¯ä¸å›¾çš„ç»“æ„æˆ–æ˜¯ç®—æ³•æœ‰å…³ã€‚å› ä¸ºæ·±åº¦ä¼˜å…ˆæœç´¢åªä¼šè®¿é—®å’Œèµ·ç‚¹è¿é€šçš„é¡¶ç‚¹ï¼Œä½¿ç”¨ä¸‹å›¾æ‰€ç¤ºçš„ä¸€å¹…å°å‹è¿é€šå›¾ä¸ºä¾‹ï¼Œä¸€å¹…è¿é€šçš„æ— å‘å›¾ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010105.png" alt></p><ul><li>åœ¨ç¤ºä¾‹ä¸­ï¼Œé¡¶ç‚¹ 2 æ˜¯é¡¶ç‚¹ 0 ä¹‹åç¬¬ä¸€ä¸ªè¢«è®¿é—®çš„é¡¶ç‚¹ï¼Œå› ä¸ºå®ƒæ­£å¥½æ˜¯ 0 çš„é‚»æ¥è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</li><li>æ·±åº¦ä¼˜å…ˆæœç´¢ä¸­æ¯æ¡è¾¹éƒ½ä¼šè¢«è®¿é—®ä¸¤æ¬¡ï¼Œä¸”åœ¨ç¬¬äºŒæ¬¡æ—¶æ€»ä¼šå‘ç°è¿™ä¸ªé¡¶ç‚¹å·²ç»è¢«æ ‡è®°è¿‡ã€‚è¿™æ„å‘³ç€æ·±åº¦ä¼˜å…ˆæœç´¢çš„è½¨è¿¹å¯èƒ½ä¼šæ¯”ä½ æƒ³è±¡çš„é•¿ä¸€å€ï¼ç¤ºä¾‹å›¾ä»…å«æœ‰ 8 æ¡è¾¹ï¼Œä½†éœ€è¦è¿½è¸ªç®—æ³•åœ¨é‚»æ¥è¡¨çš„ 16 ä¸ªå…ƒç´ ä¸Šçš„æ“ä½œã€‚</li></ul><p>ä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯ç¤ºä¾‹ä¸­æ¯ä¸ªé¡¶ç‚¹è¢«æ ‡è®°åç®—æ³•ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼Œèµ·ç‚¹ä¸ºé¡¶ç‚¹ 0ã€‚ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢çš„è½¨è¿¹ï¼Œå¯»æ‰¾æ‰€æœ‰å’Œé¡¶ç‚¹ 0 è¿é€šçš„é¡¶ç‚¹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010106.png" alt></p><p>æŸ¥æ‰¾å¼€å§‹äºæ„é€ å‡½æ•°è°ƒç”¨é€’å½’çš„ <code>dfs()</code> æ¥æ ‡è®°å’Œè®¿é—®é¡¶ç‚¹0ï¼Œåç»­å¤„ç†å¦‚ä¸‹æ‰€è¿°ï¼š</p><ul><li>å› ä¸ºé¡¶ç‚¹ 2 æ˜¯ 0 çš„é‚»æ¥è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸”æ²¡æœ‰è¢«æ ‡è®°è¿‡ï¼Œ<code>dfs()</code> é€’å½’è°ƒç”¨è‡ªå·±æ¥æ ‡è®°å¹¶è®¿é—®é¡¶ç‚¹ 2ï¼ˆæ•ˆæœæ˜¯ç³»ç»Ÿä¼šå°†é¡¶ç‚¹ 0 å’Œ 0 çš„é‚»æ¥è¡¨çš„å½“å‰ä½ç½®å‹å…¥æ ˆä¸­ï¼‰ã€‚</li><li>ç°åœ¨ï¼Œé¡¶ç‚¹ 0 æ˜¯ 2 çš„é‚»æ¥è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸”å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œå› æ­¤ <code>dfs()</code> è·³è¿‡äº†å®ƒã€‚æ¥ä¸‹æ¥ï¼Œé¡¶ç‚¹ 1 æ˜¯ 2 çš„é‚»æ¥è¡¨çš„ç¬¬äºŒä¸ªå…ƒç´ ä¸”æ²¡æœ‰è¢«æ ‡è®°ï¼Œ<code>dfs()</code> é€’å½’è°ƒç”¨è‡ªå·±æ¥æ ‡è®°å¹¶è®¿é—®é¡¶ç‚¹ 1ã€‚</li><li>å¯¹é¡¶ç‚¹ 1 çš„è®¿é—®å’Œå‰é¢æœ‰æ‰€ä¸åŒï¼šå› ä¸ºå®ƒçš„é‚»æ¥è¡¨ä¸­çš„æ‰€æœ‰é¡¶ç‚¹ï¼ˆ0 å’Œ 2ï¼‰éƒ½å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œå› æ­¤ä¸éœ€è¦å†è¿›è¡Œé€’å½’ï¼Œæ–¹æ³•ä» <code>dfs(1)</code> ä¸­è¿”å›ã€‚ä¸‹ä¸€æ¡è¢«æ£€æŸ¥çš„è¾¹æ˜¯ 2-3ï¼ˆåœ¨ 2 çš„é‚»æ¥è¡¨ä¸­é¡¶ç‚¹ 1 ä¹‹åçš„é¡¶ç‚¹æ˜¯ 3ï¼‰ï¼Œå› æ­¤ <code>dfs()</code> é€’å½’è°ƒç”¨è‡ªå·±æ¥æ ‡è®°å¹¶è®¿é—®é¡¶ç‚¹3ã€‚</li><li>é¡¶ç‚¹ 5 æ˜¯ 3 çš„é‚»æ¥è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸”æ²¡æœ‰è¢«æ ‡è®°ï¼Œå› æ­¤ <code>dfs()</code> é€’å½’è°ƒç”¨è‡ªå·±æ¥æ ‡è®°å¹¶è®¿é—®é¡¶ç‚¹ 5ã€‚</li><li>é¡¶ç‚¹ 5 çš„é‚»æ¥è¡¨ä¸­çš„æ‰€æœ‰é¡¶ç‚¹ï¼ˆ3 å’Œ 0ï¼‰éƒ½å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œå› æ­¤ä¸éœ€è¦å†è¿›è¡Œé€’å½’ã€‚</li><li>é¡¶ç‚¹ 4 æ˜¯ 3 çš„é‚»æ¥è¡¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä¸”æ²¡æœ‰è¢«æ ‡è®°è¿‡ï¼Œå› æ­¤ <code>dfs()</code> é€’å½’è°ƒç”¨è‡ªå·±æ¥æ ‡è®°å¹¶è®¿é—®é¡¶ç‚¹ 4ã€‚è¿™æ˜¯æœ€åä¸€ä¸ªéœ€è¦è¢«æ ‡è®°çš„é¡¶ç‚¹ã€‚</li><li>åœ¨é¡¶ç‚¹ 4 è¢«æ ‡è®°äº†ä¹‹åï¼Œ<code>dfs()</code> ä¼šæ£€æŸ¥å®ƒçš„é‚»æ¥è¡¨ï¼Œç„¶åå†æ£€æŸ¥ 3 çš„é‚»æ¥è¡¨ï¼Œç„¶åæ˜¯ 2 çš„é‚»æ¥è¡¨ï¼Œç„¶åæ˜¯ 0 çš„ï¼Œæœ€åå‘ç°ä¸éœ€è¦å†è¿›è¡Œä»»ä½•é€’å½’è°ƒç”¨ï¼Œå› ä¸ºæ‰€æœ‰çš„é¡¶ç‚¹éƒ½å·²ç»è¢«æ ‡è®°è¿‡äº†ã€‚</li></ul><h3 id="3-4-ä½¿ç”¨åœºæ™¯"><a href="#3-4-ä½¿ç”¨åœºæ™¯" class="headerlink" title="3.4 ä½¿ç”¨åœºæ™¯"></a>3.4 ä½¿ç”¨åœºæ™¯</h3><ul><li><strong>è¿é€šæ€§é—®é¢˜</strong> / <strong>è·¯å¾„æ£€æµ‹é—®é¢˜</strong> ï¼šæ¯”å¦‚ç»™å®šä¸€å¹…å›¾ï¼Œå›ç­”â€œä¸¤ä¸ªç»™å®šçš„é¡¶ç‚¹æ˜¯å¦è¿é€šï¼Ÿâ€æˆ–è€…â€œå›¾ä¸­æœ‰å¤šå°‘ä¸ªè¿é€šå­å›¾ï¼Ÿâ€ç­‰ç±»ä¼¼é—®é¢˜ã€‚é—®é¢˜â€œä¸¤ä¸ªç»™å®šçš„é¡¶ç‚¹æ˜¯å¦è¿é€šï¼Ÿâ€ç­‰ä»·äºâ€œä¸¤ä¸ªç»™å®šçš„é¡¶ç‚¹ä¹‹é—´æ˜¯å¦å­˜åœ¨ä¸€æ¡è·¯å¾„ï¼Ÿâ€</li><li><strong>å•ç‚¹è·¯å¾„</strong>ï¼šç»™å®šä¸€å¹…å›¾å’Œä¸€ä¸ªèµ·ç‚¹ sï¼Œå›ç­”â€œä» s åˆ°ç»™å®šç›®çš„é¡¶ç‚¹ v æ˜¯å¦å­˜åœ¨ä¸€æ¡è·¯å¾„ï¼Ÿå¦‚æœæœ‰ï¼Œæ‰¾å‡ºè¿™æ¡è·¯å¾„ã€‚â€ç­‰ç±»ä¼¼é—®é¢˜ã€‚</li></ul><p>æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ä¹‹æ‰€ä»¥æä¸ºç®€å•ï¼Œæ˜¯å› ä¸ºå®ƒæ‰€åŸºäºçš„æ¦‚å¿µä¸ºäººæ‰€ç†ŸçŸ¥å¹¶ä¸”éå¸¸å®¹æ˜“å®ç°ã€‚äº‹å®ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªæ—¢å°å·§è€Œåˆå¼ºå¤§çš„ç®—æ³•ï¼Œç ”ç©¶äººå‘˜ç”¨å®ƒè§£å†³äº†æ— æ•°å›°éš¾çš„é—®é¢˜ã€‚ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜åªæ˜¯æˆ‘ä»¬å°†è¦ç ”ç©¶çš„è®¸å¤šé—®é¢˜çš„å¼€å§‹ã€‚</p><h3 id="3-5-ç®—æ³•é¢˜"><a href="#3-5-ç®—æ³•é¢˜" class="headerlink" title="3.5 ç®—æ³•é¢˜"></a>3.5 ç®—æ³•é¢˜</h3><p>å‰‘æŒ‡ç¬¬12é¢˜-çŸ©é˜µä¸­çš„è·¯å¾„ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çŸ©é˜µä¸­çš„è·¯å¾„</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è¯·è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­åœ¨ä¸€ä¸ªçŸ©é˜µä¸­æ˜¯å¦å­˜åœ¨ä¸€æ¡åŒ…å«æŸå­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦çš„è·¯å¾„ã€‚</span></span><br><span class="line"><span class="comment"> * è·¯å¾„å¯ä»¥ä»çŸ©é˜µä¸­çš„ä»»æ„ä¸€æ ¼å¼€å§‹ï¼Œæ¯ä¸€æ­¥å¯ä»¥åœ¨çŸ©é˜µä¸­å‘å·¦ã€å³ã€ä¸Šã€ä¸‹ç§»åŠ¨ä¸€æ ¼ã€‚</span></span><br><span class="line"><span class="comment"> * å¦‚æœä¸€æ¡è·¯å¾„ç»è¿‡äº†çŸ©é˜µçš„æŸä¸€æ ¼ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„ä¸èƒ½å†æ¬¡è¿›å…¥è¯¥æ ¼å­ã€‚</span></span><br><span class="line"><span class="comment"> * ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„3Ã—4çš„çŸ©é˜µä¸­åŒ…å«ä¸€æ¡å­—ç¬¦ä¸²â€œbfceâ€çš„è·¯å¾„ï¼ˆè·¯å¾„ä¸­çš„å­—æ¯ç”¨åŠ ç²—æ ‡å‡ºï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * [["a","b","c","e"],</span></span><br><span class="line"><span class="comment"> * ["s","f","c","s"],</span></span><br><span class="line"><span class="comment"> * ["a","d","e","e"]]</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ä½†çŸ©é˜µä¸­ä¸åŒ…å«å­—ç¬¦ä¸²â€œabfbâ€çš„è·¯å¾„ï¼Œå› ä¸ºå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦bå æ®äº†çŸ©é˜µä¸­çš„ç¬¬ä¸€è¡Œç¬¬äºŒä¸ªæ ¼å­ä¹‹åï¼Œè·¯å¾„ä¸èƒ½å†æ¬¡è¿›å…¥è¿™ä¸ªæ ¼å­ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 1ï¼š</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è¾“å…¥ï¼šboard = [["A","B","C","E"],["S","F","C","S"],["A","D","E","E"]], word = "ABCCED"</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºï¼štrue</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 2ï¼š</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è¾“å…¥ï¼šboard = [["a","b"],["c","d"]], word = "abcd"</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºï¼šfalse</span></span><br><span class="line"><span class="comment"> * æç¤ºï¼š</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 1 &lt;= board.length &lt;= 200</span></span><br><span class="line"><span class="comment"> * 1 &lt;= board[i].length &lt;= 200</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Related Topics</span></span><br><span class="line"><span class="comment"> * æ·±åº¦ä¼˜å…ˆæœç´¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jz12Exist</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[][] board = &#123;</span><br><span class="line">                &#123;<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'E'</span>&#125;,</span><br><span class="line">                &#123;<span class="string">'S'</span>, <span class="string">'F'</span>, <span class="string">'C'</span>, <span class="string">'S'</span>&#125;,</span><br><span class="line">                &#123;<span class="string">'A'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        String word = <span class="string">"ABCCED"</span>;</span><br><span class="line">        System.out.println(exist(board, word));</span><br><span class="line">        <span class="keyword">char</span>[][] board1 = &#123;&#123;<span class="string">'a'</span>, <span class="string">'b'</span>&#125;, &#123;<span class="string">'c'</span>, <span class="string">'d'</span>&#125;&#125;;</span><br><span class="line">        String word1 = <span class="string">"abcd"</span>;</span><br><span class="line">        System.out.println(exist(board1, word1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¶é—´å¤æ‚åº¦ O(3^K * M * N) ï¼š</span></span><br><span class="line"><span class="comment">     *      æœ€å·®æƒ…å†µä¸‹ï¼Œéœ€è¦éå†çŸ©é˜µä¸­é•¿åº¦ä¸º K å­—ç¬¦ä¸²çš„æ‰€æœ‰æ–¹æ¡ˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(3^K)ï¼›</span></span><br><span class="line"><span class="comment">     *      çŸ©é˜µä¸­å…±æœ‰ MN ä¸ªèµ·ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(MN) ã€‚</span></span><br><span class="line"><span class="comment">     *      æ–¹æ¡ˆæ•°è®¡ç®—ï¼š è®¾å­—ç¬¦ä¸²é•¿åº¦ä¸º K ï¼Œæœç´¢ä¸­æ¯ä¸ªå­—ç¬¦æœ‰ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘å¯ä»¥é€‰æ‹©ï¼Œèˆå¼ƒå›å¤´ï¼ˆä¸Šä¸ªå­—ç¬¦ï¼‰çš„æ–¹å‘ï¼Œå‰©ä¸‹ 3 ç§é€‰æ‹©ï¼Œå› æ­¤æ–¹æ¡ˆæ•°çš„å¤æ‚åº¦ä¸º O(3^K) ã€‚</span></span><br><span class="line"><span class="comment">     * ç©ºé—´å¤æ‚åº¦ O(K) ï¼š</span></span><br><span class="line"><span class="comment">     *      æœç´¢è¿‡ç¨‹ä¸­çš„é€’å½’æ·±åº¦ä¸è¶…è¿‡ K ï¼Œå› æ­¤ç³»ç»Ÿå› å‡½æ•°è°ƒç”¨ç´¯è®¡ä½¿ç”¨çš„æ ˆç©ºé—´å ç”¨ O(K)</span></span><br><span class="line"><span class="comment">     *      ï¼ˆå› ä¸ºå‡½æ•°è¿”å›åï¼Œç³»ç»Ÿè°ƒç”¨çš„æ ˆç©ºé—´ä¼šé‡Šæ”¾ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">     *      æœ€åæƒ…å†µä¸‹ K = MN ï¼Œé€’å½’æ·±åº¦ä¸º MN ï¼Œæ­¤æ—¶ç³»ç»Ÿæ ˆä½¿ç”¨ O(MN) çš„é¢å¤–ç©ºé—´ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">exist</span><span class="params">(<span class="keyword">char</span>[][] board, String word)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] words = word.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dfs(board, words, i, j, <span class="number">0</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·±åº¦ä¼˜å…ˆæœç´¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> board äºŒç»´çŸ©é˜µ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> word å•è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i æ¨ªåæ ‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> j çºµåæ ‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> k å•è¯åæ ‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦å‘½ä¸­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">dfs</span><span class="params">(<span class="keyword">char</span>[][] board, <span class="keyword">char</span>[] word, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æœªå‘½ä¸­ï¼šæ¨ªçºµåæ ‡è¶Šç•Œï¼ŒçŸ©é˜µå¯¹åº”ä½ç½®å…ƒç´ ä¸ç­‰äºå•è¯å¯¹åº”ä½ç½®å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> (i &gt;= board.length || i &lt; <span class="number">0</span> || j &gt;= board[<span class="number">0</span>].length || j &lt; <span class="number">0</span> || board[i][j] != word[k]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å•è¯éå†ç»“æŸï¼Œå…¨éƒ¨å‘½ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (k == word.length - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ‡è®°è¡¨ç¤ºå·²è®¿é—®è¿‡</span></span><br><span class="line">        board[i][j] = <span class="string">'\0'</span>;</span><br><span class="line">        <span class="comment">// é€’å½’è®¿é—®ç›¸é‚»çŸ©é˜µå…ƒç´ </span></span><br><span class="line">        <span class="keyword">boolean</span> res = dfs(board, word, i + <span class="number">1</span>, j, k + <span class="number">1</span>) || dfs(board, word, i - <span class="number">1</span>, j, k + <span class="number">1</span>) ||</span><br><span class="line">                dfs(board, word, i, j + <span class="number">1</span>, k + <span class="number">1</span>) || dfs(board, word, i, j - <span class="number">1</span>, k + <span class="number">1</span>);</span><br><span class="line">        board[i][j] = word[k];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰‘æŒ‡ç¬¬13é¢˜-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ°ä¸Šæœ‰ä¸€ä¸ªmè¡Œnåˆ—çš„æ–¹æ ¼ï¼Œä»åæ ‡ [0,0] åˆ°åæ ‡ [m-1,n-1] ã€‚</span></span><br><span class="line"><span class="comment"> * ä¸€ä¸ªæœºå™¨äººä»åæ ‡ [0, 0] çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œå®ƒæ¯æ¬¡å¯ä»¥å‘å·¦ã€å³ã€ä¸Šã€ä¸‹ç§»åŠ¨ä¸€æ ¼ï¼ˆä¸èƒ½ç§»åŠ¨åˆ°æ–¹æ ¼å¤–ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"> * ä¹Ÿä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äºkçš„æ ¼å­ã€‚</span></span><br><span class="line"><span class="comment"> * ä¾‹å¦‚ï¼Œå½“kä¸º18æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ [35, 37] ï¼Œå› ä¸º3+5+3+7=18ã€‚</span></span><br><span class="line"><span class="comment"> * ä½†å®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ [35, 38]ï¼Œå› ä¸º3+5+3+8=19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿåˆ°è¾¾å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 1ï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥ï¼šm = 2, n = 3, k = 1</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºï¼š3</span></span><br><span class="line"><span class="comment"> * ç¤ºä¾‹ 2ï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¾“å…¥ï¼šm = 3, n = 1, k = 0</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºï¼š1</span></span><br><span class="line"><span class="comment"> * æç¤ºï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1 &lt;= n,m &lt;= 100</span></span><br><span class="line"><span class="comment"> * 0 &lt;= k &lt;= 20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jz13MovingCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">2</span>, n = <span class="number">3</span>, k = <span class="number">1</span>;</span><br><span class="line">        System.out.println(movingCount(m, n , k));</span><br><span class="line">        m = <span class="number">3</span>;</span><br><span class="line">        n = <span class="number">1</span>;</span><br><span class="line">        k = <span class="number">0</span>;</span><br><span class="line">        System.out.println(movingCount(m, n , k));</span><br><span class="line">        m = <span class="number">16</span>;</span><br><span class="line">        n = <span class="number">8</span>;</span><br><span class="line">        k = <span class="number">4</span>;</span><br><span class="line">        System.out.println(movingCount(m, n , k));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·±åº¦ä¼˜å…ˆæœç´¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ—¶é—´å¤æ‚åº¦ï¼šO(mn)ï¼Œå…¶ä¸­ m ä¸ºæ–¹æ ¼çš„è¡Œæ•°ï¼Œ n ä¸ºæ–¹æ ¼çš„åˆ—æ•°ã€‚</span></span><br><span class="line"><span class="comment">     * ä¸€å…±æœ‰ O(mn) ä¸ªçŠ¶æ€éœ€è¦è®¡ç®—ï¼Œæ¯ä¸ªçŠ¶æ€é€’æ¨è®¡ç®—çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ‰€ä»¥æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(mn)ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ç©ºé—´å¤æ‚åº¦ï¼šO(mn)ï¼Œå…¶ä¸­ m ä¸ºæ–¹æ ¼çš„è¡Œæ•°ï¼Œn ä¸ºæ–¹æ ¼çš„åˆ—æ•°ã€‚æˆ‘ä»¬éœ€è¦ O(mn) å¤§å°çš„ç»“æ„æ¥è®°å½•æ¯ä¸ªä½ç½®æ˜¯å¦å¯è¾¾ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">movingCount</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span>[][] visited = <span class="keyword">new</span> <span class="keyword">boolean</span>[m][n];</span><br><span class="line">        <span class="keyword">return</span> dfs(<span class="number">0</span>, <span class="number">0</span>, m, n, k, visited);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">int</span> k, <span class="keyword">boolean</span>[][] visited)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i &gt;= m || j &gt;= n || k &lt; getSum(i) + getSum(j) || visited[i][j]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[i][j] = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + dfs(i + <span class="number">1</span>, j, m, n, k, visited) + dfs(i, j + <span class="number">1</span>, m, n, k, visited);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSum</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = a % <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> tmp = a / <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">while</span>(tmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum += tmp % <span class="number">10</span>;</span><br><span class="line">            tmp /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››-å¯»æ‰¾è·¯å¾„"><a href="#å››-å¯»æ‰¾è·¯å¾„" class="headerlink" title="å››. å¯»æ‰¾è·¯å¾„"></a>å››. å¯»æ‰¾è·¯å¾„</h2><h3 id="4-1-è·¯å¾„API"><a href="#4-1-è·¯å¾„API" class="headerlink" title="4.1 è·¯å¾„API"></a>4.1 è·¯å¾„API</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010107.png" alt></p><p>æµ‹è¯•ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Graph G = <span class="keyword">new</span> Graph(<span class="keyword">new</span> In(args[<span class="number">0</span>]));</span><br><span class="line">    <span class="keyword">int</span> s = Integer.parseInt(args[<span class="number">1</span>]);</span><br><span class="line">    Paths search = <span class="keyword">new</span> Paths(G, s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">0</span>; v &lt; G.V(); v++) &#123;</span><br><span class="line">        StdOut.print(s + <span class="string">" to "</span> + v + <span class="string">": "</span>);</span><br><span class="line">        <span class="keyword">if</span> (search.hasPathTo(v))</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x : search.pathTo(v))</span><br><span class="line">                <span class="keyword">if</span> (x == s) StdOut.print(x);</span><br><span class="line">                <span class="keyword">else</span> StdOut.print(<span class="string">"-"</span> + x);</span><br><span class="line">        StdOut.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-å®ç°"><a href="#4-2-å®ç°" class="headerlink" title="4.2 å®ç°"></a>4.2 å®ç°</h3><p>DepthFirstPathsä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢æŸ¥æ‰¾å›¾ä¸­çš„è·¯å¾„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢æŸ¥æ‰¾å›¾ä¸­çš„è·¯å¾„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepthFirstPaths</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨æ­¤é¡¶ç‚¹ä¸Šæ˜¯å¦è°ƒç”¨è¿‡ dfs()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span>[] marked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»èµ·ç‚¹åˆ°ä¸€ä¸ªé¡¶ç‚¹çš„å·²çŸ¥è·¯å¾„ä¸Šçš„æœ€åä¸€ä¸ªé¡¶ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] edgeTo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èµ·ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> s;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨ G ä¸­æ‰¾å‡ºæ‰€æœ‰èµ·ç‚¹ä¸º s çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DepthFirstPaths</span><span class="params">(Graph G, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        marked = <span class="keyword">new</span> <span class="keyword">boolean</span>[G.V()];</span><br><span class="line">        edgeTo = <span class="keyword">new</span> <span class="keyword">int</span>[G.V()];</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">        dfs(G, s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(Graph G, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        marked[v] = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> w : G.adj(v)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!marked[w]) &#123;</span><br><span class="line">                edgeTo[w] = v;</span><br><span class="line">                dfs(G, w);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦å­˜åœ¨ä» s åˆ° v çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPathTo</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> marked[v];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * s åˆ° v çš„è·¯å¾„ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterable&lt;Integer&gt; <span class="title">pathTo</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!hasPathTo(v)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;Integer&gt; path = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = v; x != s; x = edgeTo[x]) &#123;</span><br><span class="line">            path.push(x);</span><br><span class="line">        &#125;</span><br><span class="line">        path.push(s);</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¡ç®—è½¨è¿¹å¦‚ä¸‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010109.png" alt></p><p>ä¸ºäº†ä¿å­˜åˆ°è¾¾æ¯ä¸ªé¡¶ç‚¹çš„å·²çŸ¥è·¯å¾„ï¼Œè¿™æ®µä»£ç ä½¿ç”¨äº†ä¸€ä¸ªä»¥é¡¶ç‚¹ç¼–å·ä¸ºç´¢å¼•çš„æ•°ç»„ edgeTo[]ï¼ŒedgeTo[w]=v è¡¨ç¤º v-w æ˜¯ç¬¬ä¸€æ¬¡è®¿é—® w æ—¶ç»è¿‡çš„è¾¹ã€‚edgeTo[] æ•°ç»„æ˜¯ä¸€æ£µç”¨çˆ¶é“¾æ¥è¡¨ç¤ºçš„ä»¥ s ä¸ºæ ¹ä¸”å«æœ‰æ‰€æœ‰ä¸ s è¿é€šçš„é¡¶ç‚¹çš„æ ‘ã€‚</p><p>ä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯ç¤ºä¾‹ä¸­æ¯ä¸ªé¡¶ç‚¹è¢«æ ‡è®°å edgeTo[] çš„å†…å®¹ï¼Œèµ·ç‚¹ä¸ºé¡¶ç‚¹ 0ã€‚marked[] å’Œ adj[] çš„å†…å®¹ä¸  DepthFirstSearch çš„è½¨è¿¹ç›¸åŒï¼Œé€’å½’è°ƒç”¨å’Œè¾¹æ£€æŸ¥çš„è¯¦ç»†æè¿°ä¹Ÿå®Œå…¨ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚æ·±åº¦ä¼˜å…ˆæœç´¢å‘ edgeTo[] æ•°ç»„ä¸­é¡ºåºæ·»åŠ äº† 0-2ã€2-1ã€2-3ã€3-5 å’Œ 3-4ã€‚è¿™äº›è¾¹æ„æˆäº†ä¸€æ£µä»¥èµ·ç‚¹ä¸ºæ ¹ç»“ç‚¹çš„æ ‘å¹¶æä¾›äº† pathTo() æ–¹æ³•æ‰€éœ€çš„ä¿¡æ¯ï¼Œä½¿å¾—è°ƒç”¨è€…å¯ä»¥æŒ‰ç…§å‰æ–‡æ‰€è¿°çš„æ–¹æ³•æ‰¾åˆ°ä» 0 åˆ°é¡¶ç‚¹ 1ã€2ã€3ã€4ã€5 çš„è·¯å¾„ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210301/202103010110.png" alt></p><h2 id="äº”-å¹¿åº¦ä¼˜å…ˆæœç´¢"><a href="#äº”-å¹¿åº¦ä¼˜å…ˆæœç´¢" class="headerlink" title="äº”. å¹¿åº¦ä¼˜å…ˆæœç´¢"></a>äº”. å¹¿åº¦ä¼˜å…ˆæœç´¢</h2><h3 id="5-1-ä»€ä¹ˆæ˜¯å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Ÿ"><a href="#5-1-ä»€ä¹ˆæ˜¯å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Ÿ" class="headerlink" title="5.1 ä»€ä¹ˆæ˜¯å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Ÿ"></a>5.1 ä»€ä¹ˆæ˜¯å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Ÿ</h3><p>å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆBreadth-First Searchï¼ŒBFSï¼‰</p><p>å•ç‚¹æœ€çŸ­è·¯å¾„ã€‚ç»™å®šä¸€å¹…å›¾å’Œä¸€ä¸ªèµ·ç‚¹ sï¼Œå›ç­”â€œä» s åˆ°ç»™å®šç›®çš„é¡¶ç‚¹ v æ˜¯å¦å­˜åœ¨ä¸€æ¡è·¯å¾„ï¼Ÿå¦‚æœæœ‰ï¼Œæ‰¾å‡ºå…¶ä¸­æœ€çŸ­çš„é‚£æ¡ï¼ˆæ‰€å«è¾¹æ•°æœ€å°‘ï¼‰ã€‚â€ç­‰ç±»ä¼¼é—®é¢˜ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„ç»å…¸æ–¹æ³•å«åšå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFS)ã€‚æ·±åº¦ä¼˜å…ˆæœç´¢åœ¨è¿™ä¸ªé—®é¢˜ä¸Šæ²¡æœ‰ä»€ä¹ˆä½œä¸ºï¼Œå› ä¸ºå®ƒéå†æ•´ä¸ªå›¾çš„é¡ºåºå’Œæ‰¾å‡ºæœ€çŸ­è·¯å¾„çš„ç›®æ ‡æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢æ­£æ˜¯ä¸ºäº†è¿™ä¸ªç›®æ ‡æ‰å‡ºç°çš„ã€‚</p><p>è¦æ‰¾åˆ°ä» s åˆ° v çš„æœ€çŸ­è·¯å¾„ï¼Œä» s å¼€å§‹ï¼Œåœ¨æ‰€æœ‰ç”±ä¸€æ¡è¾¹å°±å¯ä»¥åˆ°è¾¾çš„é¡¶ç‚¹ä¸­å¯»æ‰¾ vï¼Œå¦‚æœæ‰¾ä¸åˆ°æˆ‘ä»¬å°±ç»§ç»­åœ¨ä¸ s è·ç¦»ä¸¤æ¡è¾¹çš„æ‰€æœ‰é¡¶ç‚¹ä¸­æŸ¥æ‰¾vï¼Œå¦‚æ­¤ä¸€ç›´è¿›è¡Œã€‚æ·±åº¦ä¼˜å…ˆæœç´¢å°±å¥½åƒæ˜¯ä¸€ä¸ªäººåœ¨èµ°è¿·å®«ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢åˆ™å¥½åƒæ˜¯ä¸€ç»„äººåœ¨ä¸€èµ·æœå„ä¸ªæ–¹å‘èµ°è¿™åº§è¿·å®«ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„ç»³å­ã€‚å½“å‡ºç°æ–°çš„å‰è·¯æ—¶ï¼Œå¯ä»¥å‡è®¾ä¸€ä¸ªæ¢ç´¢è€…å¯ä»¥åˆ†è£‚ä¸ºæ›´å¤šçš„äººæ¥æœç´¢å®ƒä»¬ï¼Œå½“ä¸¤ä¸ªæ¢ç´¢è€…ç›¸é‡æ—¶ï¼Œä¼šåˆäºŒä¸ºä¸€ï¼ˆå¹¶ç»§ç»­ä½¿ç”¨å…ˆåˆ°è¾¾è€…çš„ç»³å­ï¼‰ï¼Œå‚è§ä¸‹å›¾-å¹¿åº¦ä¼˜å…ˆçš„è¿·å®«æœç´¢ã€‚</p><p><img src="C:\Users\hspcadmin\Desktop\æ–‡æ¡£\202104120101.png" alt></p><h3 id="5-2-ç®—æ³•æè¿°"><a href="#5-2-ç®—æ³•æè¿°" class="headerlink" title="5.2 ç®—æ³•æè¿°"></a>5.2 ç®—æ³•æè¿°</h3><p>åœ¨æ·±åº¦ä¼˜å…ˆæœç´¢ä¸­ï¼Œæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªå¯ä»¥ä¸‹å‹çš„æ ˆï¼ˆè¿™æ˜¯ç”±ç³»ç»Ÿç®¡ç†çš„ï¼Œä»¥æ”¯æŒé€’å½’æœç´¢æ–¹æ³•ï¼‰ã€‚ä½¿ç”¨ LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰çš„è§„åˆ™æ¥æè¿°å‹æ ˆå’Œèµ°è¿·å®«æ—¶å…ˆæ¢ç´¢ç›¸é‚»çš„é€šé“ç±»ä¼¼ã€‚ä»æœ‰å¾…æœç´¢çš„é€šé“ä¸­é€‰æ‹©æœ€æ™šé‡åˆ°è¿‡çš„é‚£æ¡ã€‚åœ¨å¹¿åº¦ä¼˜å…ˆæœç´¢ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§ä¸èµ·ç‚¹çš„è·ç¦»çš„é¡ºåºæ¥éå†æ‰€æœ‰é¡¶ç‚¹ï¼Œçœ‹èµ·æ¥è¿™ç§é¡ºåºå¾ˆå®¹æ˜“å®ç°ï¼šä½¿ç”¨ï¼ˆFIFOï¼Œå…ˆè¿›å…ˆå‡ºï¼‰é˜Ÿåˆ—æ¥ä»£æ›¿æ ˆï¼ˆLIFOï¼Œåè¿›å…ˆå‡ºï¼‰å³å¯ã€‚æˆ‘ä»¬å°†ä»æœ‰å¾…æœç´¢çš„é€šé“ä¸­é€‰æ‹©æœ€æ—©é‡åˆ°çš„é‚£æ¡ã€‚</p><p>ç®—æ³• 4.2 å®ç°äº†å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ã€‚å®ƒä½¿ç”¨äº†ä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜æ‰€æœ‰å·²ç»è¢«æ ‡è®°è¿‡ä½†å…¶é‚»æ¥è¡¨è¿˜æœªè¢«æ£€æŸ¥è¿‡çš„é¡¶ç‚¹ã€‚å…ˆå°†èµ·ç‚¹åŠ å…¥é˜Ÿåˆ—ï¼Œç„¶åé‡å¤ä»¥ä¸‹æ­¥éª¤ç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºï¼š</p><ul><li>å–é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªé¡¶ç‚¹ v å¹¶æ ‡è®°å®ƒï¼›</li><li>å°†ä¸ v ç›¸é‚»çš„æ‰€æœ‰æœªè¢«æ ‡è®°è¿‡çš„é¡¶ç‚¹åŠ å…¥é˜Ÿåˆ—ã€‚</li></ul><p><img src="C:\Users\hspcadmin\Desktop\æ–‡æ¡£\202104120102.png" alt></p><p>æ­¥éª¤ï¼š</p><p><img src="C:\Users\hspcadmin\Desktop\æ–‡æ¡£\202104120103.png" alt></p><ul><li>ä»é˜Ÿåˆ—ä¸­åˆ å»é¡¶ç‚¹ 0 å¹¶å°†å®ƒçš„ç›¸é‚»é¡¶ç‚¹ 2ã€1 å’Œ 5 åŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œæ ‡è®°å®ƒä»¬å¹¶åˆ†åˆ«å°†å®ƒä»¬åœ¨ <code>edgeTo[]</code> ä¸­çš„å€¼è®¾ä¸º 0ã€‚</li><li>ä»é˜Ÿåˆ—ä¸­åˆ å»é¡¶ç‚¹ 2 å¹¶æ£€æŸ¥å®ƒçš„ç›¸é‚»é¡¶ç‚¹ 0 å’Œ 1ï¼Œå‘ç°ä¸¤è€…éƒ½å·²ç»è¢«æ ‡è®°ã€‚å°†ç›¸é‚»çš„é¡¶ç‚¹ 3 å’Œ 4 åŠ å…¥é˜Ÿåˆ—ï¼Œæ ‡è®°å®ƒä»¬å¹¶åˆ†åˆ«å°†å®ƒä»¬åœ¨ <code>edgeTo[]</code> ä¸­çš„å€¼è®¾ä¸º 2ã€‚</li><li>ä»é˜Ÿåˆ—ä¸­åˆ å»é¡¶ç‚¹ 1 å¹¶æ£€æŸ¥å®ƒçš„ç›¸é‚»é¡¶ç‚¹ 0 å’Œ 2ï¼Œå‘ç°å®ƒä»¬éƒ½å·²ç»è¢«æ ‡è®°äº†ã€‚</li><li>ä»é˜Ÿåˆ—ä¸­åˆ å»é¡¶ç‚¹ 5 å¹¶æ£€æŸ¥å®ƒçš„ç›¸é‚»é¡¶ç‚¹ 3 å’Œ 0ï¼Œå‘ç°å®ƒä»¬éƒ½å·²ç»è¢«æ ‡è®°äº†ã€‚</li><li>ä»é˜Ÿåˆ—ä¸­åˆ å»é¡¶ç‚¹ 3 å¹¶æ£€æŸ¥å®ƒçš„ç›¸é‚»é¡¶ç‚¹ 5ã€4 å’Œ 2ï¼Œå‘ç°å®ƒä»¬éƒ½å·²ç»è¢«æ ‡è®°äº†ã€‚</li><li>ä»é˜Ÿåˆ—ä¸­åˆ å»é¡¶ç‚¹ 4 å¹¶æ£€æŸ¥å®ƒçš„ç›¸é‚»é¡¶ç‚¹ 3 å’Œ 2ï¼Œå‘ç°å®ƒä»¬éƒ½å·²ç»è¢«æ ‡è®°äº†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢æŸ¥æ‰¾å›¾ä¸­çš„è·¯å¾„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BreadthFirstPaths</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ°è¾¾è¯¥é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„æ˜¯å¦å·²çŸ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span>[] marked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ°è¾¾è¯¥é¡¶ç‚¹çš„å·²çŸ¥è·¯å¾„ä¸Šçš„æœ€åä¸€ä¸ªé¡¶ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] edgeTo;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èµ·ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> s;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BreadthFirstPaths</span><span class="params">(Graph G, <span class="keyword">int</span> s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        marked = <span class="keyword">new</span> <span class="keyword">boolean</span>[G.V()];</span><br><span class="line">        edgeTo = <span class="keyword">new</span> <span class="keyword">int</span>[G.V()];</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">        bfs(G, s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(Graph G, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        Queue&lt;Integer&gt; queue = <span class="keyword">new</span> Queue&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ ‡è®°èµ·ç‚¹</span></span><br><span class="line">        marked[s] = <span class="keyword">true</span>; </span><br><span class="line">        <span class="comment">// å°†å®ƒåŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">        queue.enqueue(s); </span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// ä»é˜Ÿåˆ—ä¸­åˆ å»ä¸‹ä¸€é¡¶ç‚¹</span></span><br><span class="line">            <span class="keyword">int</span> v = queue.dequeue(); </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> w : G.adj(v)) &#123;</span><br><span class="line">                <span class="comment">// å¯¹äºæ¯ä¸ªæœªè¢«æ ‡è®°çš„ç›¸é‚»é¡¶ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (!marked[w]) &#123;</span><br><span class="line">                    <span class="comment">// ä¿å­˜æœ€çŸ­è·¯å¾„çš„æœ€åä¸€æ¡è¾¹</span></span><br><span class="line">                    edgeTo[w] = v; </span><br><span class="line">                    <span class="comment">// æ ‡è®°å®ƒï¼Œå› ä¸ºæœ€çŸ­è·¯å¾„å·²çŸ¥</span></span><br><span class="line">                    marked[w] = <span class="keyword">true</span>; </span><br><span class="line">                    <span class="comment">// å¹¶å°†å®ƒæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">                    queue.enqueue(w); </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPathTo</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123; <span class="keyword">return</span> marked[v]; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterable&lt;Integer&gt; <span class="title">pathTo</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!hasPathTo(v)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;Integer&gt; path = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = v; x != s; x = edgeTo[x]) &#123;</span><br><span class="line">            path.push(x);</span><br><span class="line">        &#125;</span><br><span class="line">        path.push(s);</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-ä½¿ç”¨åœºæ™¯"><a href="#5-3-ä½¿ç”¨åœºæ™¯" class="headerlink" title="5.3 ä½¿ç”¨åœºæ™¯"></a>5.3 ä½¿ç”¨åœºæ™¯</h3><h2 id="å…­-è¿é€šåˆ†é‡"><a href="#å…­-è¿é€šåˆ†é‡" class="headerlink" title="å…­. è¿é€šåˆ†é‡"></a>å…­. è¿é€šåˆ†é‡</h2><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šç®—æ³•-ç¬¬4ç‰ˆã€‹</p>]]></content>
    
    <summary type="html">
    
      å†…å®¹ä¸»è¦æ¥è‡ªã€Šç®—æ³•-ç¬¬4ç‰ˆã€‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šå›¾ï¼Œæ— å‘å›¾ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œå¯»æ‰¾è·¯å¾„ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="algorithm" scheme="http://linyishui.top/tags/algorithm/"/>
    
      <category term="unfinished" scheme="http://linyishui.top/tags/unfinished/"/>
    
      <category term="graph" scheme="http://linyishui.top/tags/graph/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå…­ï¼‰é«˜çº§ç‰¹æ€§</title>
    <link href="http://linyishui.top/2021020101.html"/>
    <id>http://linyishui.top/2021020101.html</id>
    <published>2021-02-01T13:16:33.000Z</published>
    <updated>2021-03-03T13:23:44.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå…­ï¼‰é«˜çº§ç‰¹æ€§"><a href="#ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå…­ï¼‰é«˜çº§ç‰¹æ€§" class="headerlink" title="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå…­ï¼‰é«˜çº§ç‰¹æ€§"></a>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå…­ï¼‰é«˜çº§ç‰¹æ€§</h1><h2 id="ä¸€-åˆ†åŒºè¡¨"><a href="#ä¸€-åˆ†åŒºè¡¨" class="headerlink" title="ä¸€. åˆ†åŒºè¡¨"></a>ä¸€. åˆ†åŒºè¡¨</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯åˆ†åŒºè¡¨ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯åˆ†åŒºè¡¨ï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯åˆ†åŒºè¡¨ï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯åˆ†åŒºè¡¨ï¼Ÿ</h3><p>åˆ†åŒºè¡¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘è¡¨ï¼Œåº•å±‚ç”±å¤šä¸ªç‰©ç†å­è¡¨ç»„æˆã€‚ä¸€ç»„åº•å±‚è¡¨çš„å¥æŸ„å¯¹è±¡çš„å°è£…ï¼Œå¯¹åˆ†åŒºè¡¨çš„è¯·æ±‚é€šè¿‡å¥æŸ„å¯¹è±¡è½¬æ¢ä¸ºå¯¹å­˜å‚¨å¼•æ“çš„æ¥å£è°ƒç”¨ã€‚</p><p>MySQLç´¢å¼•æ ¹æ®åˆ†åŒºçš„å­è¡¨å®šä¹‰ï¼Œæ²¡æœ‰å…¨å±€ç´¢å¼•ï¼Œä¸èƒ½åƒOracleé‚£æ ·æŒ‡å®šç´¢å¼•å’Œè¡¨æ˜¯å¦åˆ†åŒºã€‚</p><p>åˆ›å»ºè¡¨æ—¶ä½¿ç”¨ PARTITION BY å­å¥å®šä¹‰æ¯ä¸ªåˆ†åŒºå­˜æ”¾çš„æ•°æ®ã€‚æ¯æ¬¡æŸ¥è¯¢æ—¶ä¼˜åŒ–å™¨æ ¹æ®åˆ†åŒºå®šä¹‰è¿‡æ»¤æ‰å…¶å®ƒåˆ†åŒºï¼Œä½¿æŸ¥è¯¢åªé¡»æ‰«æåŒ…å«æ•°æ®çš„åˆ†åŒºã€‚</p><h3 id="1-2-ä½¿ç”¨åœºæ™¯"><a href="#1-2-ä½¿ç”¨åœºæ™¯" class="headerlink" title="1.2 ä½¿ç”¨åœºæ™¯"></a>1.2 ä½¿ç”¨åœºæ™¯</h3><ul><li>æ— æ³•å…¨éƒ¨æ”¾å…¥å†…å­˜çš„å¤§è¡¨ï¼Œæˆ–æ˜¯å¤§éƒ¨åˆ†å†å²æ•°æ®ã€åªæœ‰å°‘é‡çƒ­ç‚¹æ•°æ®ã€‚</li><li>åˆ†åŒºè¡¨çš„æ•°æ®æ˜“äºç»´æŠ¤ï¼Œæ‰¹é‡åˆ é™¤å¤§é‡æ•°æ®å¯ä»¥ç›´æ¥æ¸…é™¤æ•´ä¸ªåˆ†åŒºï¼›è¿˜å¯ä»¥å¯¹ä¸€ä¸ªåˆ†åŒºè¿›è¡Œä¼˜åŒ–ã€æ£€æŸ¥ã€ä¿®å¤ç­‰æ“ä½œã€‚</li><li>åˆ†åŒºè¡¨çš„æ•°æ®å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†è®¾å¤‡ä¸Šã€‚</li><li>ä½¿ç”¨åˆ†åŒºè¡¨å¯ä»¥é¿å…ä¸€äº›ç‰¹æ®Šç“¶é¢ˆï¼Œå¦‚InnoDBçš„å•ä¸ªç´¢å¼•çš„äº’æ–¥è®¿é—®ã€ext3æ–‡ä»¶ç³»ç»Ÿçš„inodeé”ç«äº‰ç­‰ã€‚</li><li>å¯ä»¥å¤‡ä»½å’Œæ¢å¤ç‹¬ç«‹çš„åˆ†åŒºï¼Œåœ¨å¤§æ•°æ®é›†çš„åœºæ™¯æœ‰å¾ˆå¥½çš„æ•ˆæœã€‚</li></ul><h3 id="1-3-ä½¿ç”¨é™åˆ¶"><a href="#1-3-ä½¿ç”¨é™åˆ¶" class="headerlink" title="1.3 ä½¿ç”¨é™åˆ¶"></a>1.3 ä½¿ç”¨é™åˆ¶</h3><ul><li>ä¸€ä¸ªè¡¨æœ€å¤šæœ‰1024ä¸ªåˆ†åŒºã€‚</li><li>MySQL 5.1ä¸­åˆ†åŒºè¡¨è¾¾å¼å¿…é¡»è¿”å›æ•´æ•°ï¼ŒMySQL 5.5çš„æŸäº›åœºæ™¯å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ—è¿›è¡Œåˆ†åŒºã€‚</li><li>è‹¥åˆ†åŒºå­—æ®µä¸­æœ‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„åˆ—ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¸»é”®åˆ—å’Œå”¯ä¸€ç´¢å¼•åˆ—éƒ½å¿…é¡»åŒ…å«è¿›æ¥ã€‚</li><li>åˆ†åŒºè¡¨æ— æ³•ä½¿ç”¨å¤–é”®çº¦æŸã€‚</li></ul><h3 id="1-4-å®ç°åŸç†"><a href="#1-4-å®ç°åŸç†" class="headerlink" title="1.4 å®ç°åŸç†"></a>1.4 å®ç°åŸç†</h3><p>åˆ†åŒºè¡¨ç”±å¤šä¸ªç›¸å…³åº•å±‚è¡¨å®ç°ï¼Œåº•å±‚è¡¨ç”±å¥æŸ„å¯¹è±¡è¡¨ç¤ºï¼Œå­˜å‚¨å¼•æ“ç®¡ç†åˆ†åŒºçš„å„ä¸ªåº•å±‚è¡¨ä¸æ™®é€šè¡¨ç›¸åŒï¼Œåˆ†åŒºè¡¨çš„ç´¢å¼•åªæ˜¯åœ¨å„ä¸ªåº•å±‚è¡¨ä¸Šå„è‡ªåŠ ä¸Šä¸€ä¸ªå®Œå…¨ç›¸åŒçš„ç´¢å¼•ã€‚</p><p>å‡ ç§æ“ä½œçš„é€»è¾‘ï¼šè™½ç„¶éƒ½è¦é”ä½æ‰€æœ‰åº•å±‚è¡¨ï¼Œä½†å…¶å®åªæ˜¯è¡Œçº§é”</p><ul><li>SELECT æŸ¥è¯¢ï¼šæŸ¥è¯¢ä¸€ä¸ªåˆ†åŒºè¡¨æ—¶ï¼Œåˆ†åŒºå±‚å…ˆæ‰“å¼€å¹¶é”ä½æ‰€æœ‰çš„åº•å±‚è¡¨ï¼Œä¼˜åŒ–å™¨å…ˆåˆ¤æ–­æ˜¯å¦å¯ä»¥è¿‡æ»¤éƒ¨åˆ†åˆ†åŒºï¼Œç„¶åè°ƒç”¨å¯¹åº”å­˜å‚¨å¼•æ“æ¥å£è®¿é—®å„ä¸ªåˆ†åŒºçš„æ•°æ®ã€‚</li><li>INSERT æ“ä½œï¼šå†™å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œåˆ†åŒºå±‚å…ˆæ‰“å¼€å¹¶é”ä½æ‰€æœ‰çš„åº•å±‚è¡¨ï¼Œç„¶åç¡®å®šåœ¨å“ªä¸ªåˆ†åŒºæ¥æ”¶è¿™æ¡è®°å½•ï¼Œå¹¶æŠŠè®°å½•å†™å…¥åº•å±‚è¡¨ã€‚</li><li>DELETE æ“ä½œï¼šåˆ é™¤ä¸€æ¡è®°å½•æ—¶ï¼Œåˆ†åŒºå±‚å…ˆæ‰“å¼€å¹¶é”ä½æ‰€æœ‰åº•å±‚è¡¨ï¼Œç„¶åç¡®å®šæ•°æ®å¯¹åº”çš„åˆ†åŒºï¼Œæœ€åå¯¹ç›¸åº”åº•å±‚è¡¨è¿›è¡Œåˆ é™¤æ“ä½œã€‚</li><li>UPDATE æ“ä½œï¼šæ›´æ–°ä¸€æ¡è®°å½•æ—¶ï¼Œåˆ†åŒºå±‚å…ˆæ‰“å¼€å¹¶é”ä½æ‰€æœ‰åº•å±‚è¡¨ï¼ŒMySQLè¦å…ˆç¡®å®šæ›´æ–°çš„è®°å½•åœ¨å“ªä¸ªåˆ†åŒºï¼Œç„¶åå–å‡ºæ•°æ®å¹¶æ›´æ–°ï¼Œå†åˆ¤æ–­æ›´æ–°åçš„æ•°æ®åº”è¯¥æ”¾åœ¨å“ªä¸ªåˆ†åŒºï¼Œæœ€åå¯¹åº•å±‚è¡¨è¿›è¡Œå†™å…¥æ“ä½œï¼Œå¹¶å¯¹åŸæ•°æ®æ‰€åœ¨åº•å±‚è¡¨è¿›è¡Œåˆ é™¤æ“ä½œã€‚</li></ul><h3 id="1-5-åˆ†åŒºè¡¨çš„ç±»å‹"><a href="#1-5-åˆ†åŒºè¡¨çš„ç±»å‹" class="headerlink" title="1.5 åˆ†åŒºè¡¨çš„ç±»å‹"></a>1.5 åˆ†åŒºè¡¨çš„ç±»å‹</h3><p>åˆ†åŒºè¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨å„ç§å‡½æ•°ï¼Œä½†è¿”å›å€¼ä¸€å®šè¦æ˜¯ä¸€ä¸ªç¡®å®šçš„æ•´æ•°ï¼Œä¸”ä¸èƒ½æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼ˆæ¡ˆä¾‹ä½¿ç”¨YEARå‡½æ•°æ ¹æ®æ—¶é—´è¿›è¡Œåˆ†åŒºï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sqles (</span><br><span class="line">order_date DATETIME <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="comment">--other columns</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(<span class="keyword">YEAR</span>(order_date)) (</span><br><span class="line"><span class="keyword">PARTITION</span> p_2010 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2010</span>),</span><br><span class="line"><span class="keyword">PARTITION</span> p_2011 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2011</span>),</span><br><span class="line"><span class="keyword">PARTITION</span> p_2012 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2012</span>),</span><br><span class="line"><span class="keyword">PARTITION</span> p_catchall <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> MAXVALUE</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>MySQLæ”¯æŒé”®å€¼ã€å“ˆå¸Œå’Œåˆ—è¡¨åˆ†åŒºï¼Œä»¥åŠä½¿ç”¨ RANGE COLUMNS ç±»å‹çš„åˆ†åŒºã€‚</p><p>ç³»ç»Ÿé€šè¿‡å­åˆ†åŒºå¯é™ä½ç´¢å¼•çš„äº’æ–¥è®¿é—®ç«äº‰ã€‚æœ€è¿‘ä¸€å¹´çš„åˆ†åŒºæ•°æ®ä¼šè¢«é¢‘ç¹è®¿é—®ï¼Œå¯¼è‡´å¤§é‡çš„äº’æ–¥é‡çš„ç«äº‰ã€‚ä½¿ç”¨å“ˆå¸Œå­åˆ†åŒºå¯ä»¥å°†æ•°æ®åˆ‡æˆå¤šä¸ªå°ç‰‡ï¼Œå¤§å¤§é™ä½äº’æ–¥é‡çš„ç«äº‰é—®é¢˜ã€‚</p><h3 id="1-6-åˆç†ä½¿ç”¨åˆ†åŒºè¡¨"><a href="#1-6-åˆç†ä½¿ç”¨åˆ†åŒºè¡¨" class="headerlink" title="1.6 åˆç†ä½¿ç”¨åˆ†åŒºè¡¨"></a>1.6 åˆç†ä½¿ç”¨åˆ†åŒºè¡¨</h3><p>å‡è®¾ä¸€ä¸ªéœ€æ±‚ï¼šéœ€è¦ä»ä¸€ä¸ªå¤§è¡¨ä¸­æŸ¥å‡ºä¸€æ®µæ—¶é—´çš„è®°å½•ï¼Œè¡¨ä¸­åŒ…å«å¤šå¹´çš„å†å²æ•°æ®ï¼ŒæŒ‰ç…§æ—¶é—´æ’åºã€‚ä»…ä»…å‡ ä¸ªæœˆçš„æ•°æ®å¯èƒ½ä¼šæœ‰ä¸Šäº¿æˆ–åäº¿æ¡è®°å½•ã€‚</p><p>é¦–å…ˆä¸èƒ½æ¯æ¬¡æŸ¥è¯¢æ—¶æ‰«æå…¨è¡¨ï¼Œå¹¶ä¸”è€ƒè™‘ç´¢å¼•åœ¨ç©ºé—´å’Œç»´æŠ¤ä¸Šçš„æ¶ˆè€—ä¹Ÿä¸èƒ½ä½¿ç”¨ï¼ˆå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„ç¢ç‰‡ï¼Œå¯¼è‡´ä¸€ä¸ªæŸ¥è¯¢æœ‰æˆåƒä¸Šä¸‡çš„éšæœºI/Oï¼‰ã€‚</p><p>åªèƒ½<strong>è®©æ‰€æœ‰çš„æŸ¥è¯¢åªåœ¨æ•°æ®è¡¨ä¸Šåšé¡ºåºæ‰«æ</strong>ï¼Œæˆ–è€…<strong>å°†æ•°æ®è¡¨å’Œç´¢å¼•éƒ½ç¼“å­˜åœ¨å†…å­˜ä¸­</strong>ã€‚</p><p><strong>æ•°æ®é‡å¤§æ—¶ï¼Œé™¤éæ˜¯ç´¢å¼•è¦†ç›–æŸ¥è¯¢ï¼Œå¦åˆ™B-Treeç´¢å¼•æ— æ³•èµ·ä½œç”¨äº†ï¼Œæ•°æ®åº“æœåŠ¡å™¨éœ€è¦æ ¹æ®ç´¢å¼•æ‰«æçš„ç»“æœå›è¡¨ï¼ŒæŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œè‹¥æ•°æ®é‡å·¨å¤§ï¼Œè¿™å°†äº§ç”Ÿå¤§é‡éšæœºI/Oï¼Œå¯¼è‡´å“åº”æ—¶é—´è¿‡é•¿ï¼Œå¹¶ä¸”ç´¢å¼•çš„ç»´æŠ¤ä»£ä»·ä¹Ÿå¾ˆé«˜</strong>ã€‚</p><p>åˆ†åŒºå¯ä»¥çœ‹ä½œåˆå§‹å½¢æ€çš„ç´¢å¼•ï¼Œä»¥éå¸¸å°çš„ä»£ä»·å®šä½åˆ°æ•°æ®åœ¨å“ªä¸€ç‰‡åŒºåŸŸï¼Œåœ¨åŒºåŸŸå†…å¯ä»¥åšé¡ºåºæ‰«æã€å¯ä»¥å»ºç´¢å¼•ã€å¯ä»¥å°†æ•°æ®ç¼“å­˜åˆ°å†…å­˜ã€‚åˆ†åŒºæ— éœ€é¢å¤–çš„æ•°æ®ç»“æ„è®°å½•æ¯ä¸ªåˆ†åŒºæœ‰å“ªäº›æ•°æ®ï¼ˆå› ä¸ºä¸éœ€è¦ç²¾ç¡®å®šä½æ•°æ®ä½ç½®ï¼‰ã€‚</p><p>ä¿è¯å¤§æ•°æ®é‡å¯æ‰©å±•æ€§çš„ç­–ç•¥ï¼š</p><ul><li><strong>å…¨é‡æ‰«ææ•°æ®ï¼Œä¸è¦ä»»ä½•ç´¢å¼•</strong>ï¼šåªè¦èƒ½ç”¨WHEREæ¡ä»¶å°†éœ€è¦çš„æ•°æ®é™åˆ¶åœ¨å°‘æ•°åˆ†åŒºä¸­ï¼Œæ•ˆç‡æ˜¯å¾ˆé«˜çš„ï¼Œéœ€è¦ä¸€äº›ç®€å•è¿ç®—ä¿è¯å“åº”æ—¶é—´èƒ½å¤Ÿæ»¡è¶³è¦æ±‚ï¼Œæ­¤ç­–ç•¥é€‚ç”¨äºæ­£å¸¸æ–¹å¼è®¿é—®å¤§é‡æ•°æ®æ—¶ã€‚</li><li><strong>ç´¢å¼•æ•°æ®ï¼Œå¹¶åˆ†ç¦»çƒ­ç‚¹</strong>ï¼šå½“æ•°æ®æœ‰æ˜æ˜¾çš„çƒ­ç‚¹ï¼Œæ­¤å¤–çš„æ•°æ®å¾ˆå°‘ä¼šè¢«è®¿é—®åˆ°ï¼Œå¯ä»¥å°†è¿™éƒ¨åˆ†çƒ­ç‚¹æ•°æ®å•ç‹¬æ”¾åœ¨ä¸€ä¸ªåˆ†åŒºï¼Œä»è€Œæœ‰æœºä¼šå…¨éƒ¨ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œä½¿æŸ¥è¯¢åªç”¨è®¿é—®ä¸€ä¸ªå¾ˆå°çš„åˆ†åŒºè¡¨ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„ä½¿ç”¨ç´¢å¼•å’Œç¼“å­˜ã€‚</li></ul><h3 id="1-7-å¸¸è§é—®é¢˜"><a href="#1-7-å¸¸è§é—®é¢˜" class="headerlink" title="1.7 å¸¸è§é—®é¢˜"></a>1.7 å¸¸è§é—®é¢˜</h3><p>ä¸Šè¿°ä¸¤ç§åˆ†åŒºç­–ç•¥éƒ½åŸºäºæŸ¥è¯¢èƒ½å¤Ÿè¿‡æ»¤åˆ°é¢å¤–åˆ†åŒºã€åˆ†åŒºæœ¬èº«å¹¶ä¸ä¼šå¸¦æ¥é¢å¤–çš„ä»£ä»·ï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸‹è¿™ä¸¤ç§å‡è®¾ä¼šæœ‰é—®é¢˜ï¼š</p><ul><li><strong>NULLå€¼ä½¿åˆ†åŒºè¿‡æ»¤æ— æ•ˆ</strong>ï¼š<ul><li>æ‰€æœ‰çš„NULLå€¼æˆ–éæ³•å€¼ä¼šè¢«å­˜æ”¾åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒºï¼›æ‰€ä»¥å¦‚æŸ¥è¯¢ <code>WHERE order_date BETWEEN &#39;2012-01-01&#39; AND &#39;2012-01-31&#39;</code> ä¼šæ£€æŸ¥2012åˆ†åŒºå’Œç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œå› ä¸ºYEARå‡½æ•°åœ¨æ¥æ”¶éæ³•å€¼æ—¶å¯èƒ½ä¼šè¿”å›NULLã€‚</li><li>å½“ç¬¬ä¸€ä¸ªåˆ†åŒºç‰¹åˆ«å¤§æ—¶ï¼Œä»£ä»·ä¼šå¾ˆé«˜ï¼Œå°¤å…¶æ˜¯ç­–ç•¥<strong>å…¨é‡æ‰«ææ•°æ®ï¼Œä¸è¦ä»»ä½•ç´¢å¼•</strong>ï¼›ä¸ºäº†é¿å…æ­¤çŠ¶å†µï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸ç”¨çš„ç¬¬ä¸€åˆ†åŒºï¼Œé€šè¿‡ <code>PARTITION p_nulls VALUES LESS THAN(0)</code> æ¥åˆ›å»ºï¼Œè¿™æ ·å¦‚æœæ’å…¥çš„æ•°æ®éƒ½æ˜¯æœ‰æ•ˆçš„æƒ…å†µä¸‹ç¬¬ä¸€åˆ†åŒºæ˜¯ç©ºçš„ï¼Œå³ä½¿éœ€è¦æ£€æµ‹ç¬¬ä¸€åˆ†åŒºä¹Ÿä¸ä¼šæœ‰å¤ªé«˜ä»£ä»·ã€‚</li></ul></li><li><strong>åˆ†åŒºåˆ—å’Œç´¢å¼•åˆ—ä¸åŒ¹é…</strong>ï¼šäºŒè€…ä¸åŒ¹é…ä¼šå¯¼è‡´æŸ¥è¯¢æ— æ³•è¿›è¡Œåˆ†åŒºè¿‡æ»¤ï¼Œæ¯”å¦‚åœ¨åˆ—aä¸Šå®šä¹‰äº†ç´¢å¼•ï¼Œåœ¨åˆ—bä¸Šè¿›è¡Œåˆ†åŒºï¼Œè¿™æ ·æ¯ä¸ªåˆ†åŒºéƒ½æœ‰ç‹¬ç«‹çš„ç´¢å¼•ï¼Œæ‰€ä»¥æ‰«æåˆ—bä¸Šçš„ç´¢å¼•éœ€è¦æ‰«ææ¯ä¸ªåˆ†åŒºå¯¹åº”çš„ç´¢å¼•ï¼Œè™½ç„¶æ‰«æé€Ÿåº¦å¹¶ä¸æ˜¯ç‰¹åˆ«æ…¢ï¼Œä½†è¿˜æ˜¯åº”è¯¥å°½é‡é¿å…å»ºç«‹å’Œåˆ†åŒºåˆ—ä¸åŒ¹é…çš„ç´¢å¼•ï¼Œé™¤éæŸ¥è¯¢ä¸­è¿˜åŒæ—¶åŒ…å«äº†å¯ä»¥è¿‡æ»¤åˆ†åŒºçš„æ¡ä»¶ã€‚</li><li><strong>é€‰æ‹©åˆ†åŒºçš„æˆæœ¬å¯èƒ½å¾ˆé«˜</strong>ï¼šä¸åŒçš„åˆ†åŒºç±»å‹å®ç°æ–¹å¼ä¸åŒï¼Œæ€§èƒ½ä¹Ÿä¸åŒï¼›èŒƒå›´åˆ†åŒºåœ¨åˆ¤æ–­è®°å½•æ•°æ®å±äºå“ªä¸€åˆ†åŒºçš„æˆæœ¬å¾ˆé«˜ï¼Œå› ä¸ºæœåŠ¡å™¨è¦æ‰«ææ‰€æœ‰çš„åˆ†åŒºå®šä¹‰çš„åˆ—è¡¨ï¼Œè¿™æ ·çš„çº¿æ€§æœç´¢ä¼šéšåˆ†åŒºæ•°å¢å¤šæˆæœ¬å˜é«˜ã€‚å¯¹äºé”®åˆ†åŒºæˆ–å“ˆå¸Œåˆ†åŒºåˆ™æ²¡æœ‰æ­¤é—®é¢˜ï¼Œ100ä¸ªå·¦å³çš„åˆ†åŒºæ•°ä¸ä¼šæœ‰é—®é¢˜ã€‚</li><li><strong>æ‰“å¼€å¹¶é”ä½æ‰€æœ‰åº•å±‚è¡¨çš„æˆæœ¬å¯èƒ½å¾ˆé«˜</strong>ï¼šæ­¤æ“ä½œå‘ç”Ÿäºåˆ†åŒºè¿‡æ»¤ä¹‹å‰ï¼Œæ— æ³•é€šè¿‡åˆ†åŒºè¿‡æ»¤é™ä½å¼€é”€ï¼Œå¯¹äºä¸€äº›æœ¬æ¥å¾ˆå¿«çš„æ“ä½œï¼Œå¦‚æ ¹æ®ä¸»é”®æŸ¥è¯¢å•è¡Œï¼Œä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ï¼›å¯ä»¥é€šè¿‡æ‰¹é‡æ“ä½œçš„æ–¹å¼æ¥é™ä½å•ä¸ªå¼€é”€ï¼Œå¦‚æ‰¹é‡æ’å…¥æˆ– LOAD DATA INFILEã€ä¸€æ¬¡åˆ é™¤å¤šè¡Œæ•°æ®ç­‰ï¼ŒåŒæ—¶éœ€è¦é™åˆ¶åˆ†åŒºçš„ä¸ªæ•°ã€‚</li><li><strong>ç»´æŠ¤åˆ†åŒºçš„æˆæœ¬å¯èƒ½å¾ˆé«˜</strong>ï¼šæ–°å¢æˆ–åˆ é™¤åˆ†åŒºç­‰æ“ä½œå¾ˆå¿«ï¼ˆä¸åŒ…æ‹¬åˆ é™¤å¤§åˆ†åŒºï¼‰ï¼Œè€Œé‡ç»„åˆ†åŒºï¼ˆå…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶åˆ†åŒºï¼Œç„¶åå°†æ•°æ®å¤åˆ¶åˆ°å…¶ä¸­ï¼Œæœ€ååˆ é™¤åŸåˆ†åŒºï¼‰æˆ–ç±»ä¼¼ALTERè¯­å¥çš„æ“ä½œéœ€è¦å¤åˆ¶æ•°æ®ã€‚</li></ul><p>ä½¿ç”¨åˆ†åŒºè¡¨çš„é™åˆ¶ï¼š</p><ul><li>æ‰€æœ‰åˆ†åŒºè¦ä½¿ç”¨ç›¸åŒçš„å­˜å‚¨å¼•æ“ï¼›</li><li>åˆ†åŒºå¯ä»¥ä½¿ç”¨çš„å‡½æ•°æˆ–è¡¨è¾¾å¼å—é™ï¼›</li><li>ä¸€äº›å­˜å‚¨å¼•æ“ä¸æ”¯æŒåˆ†åŒºæˆ–æœ‰æ›´å¤šé™åˆ¶ï¼›</li></ul><h3 id="1-8-ä¼˜åŒ–æŸ¥è¯¢"><a href="#1-8-ä¼˜åŒ–æŸ¥è¯¢" class="headerlink" title="1.8 ä¼˜åŒ–æŸ¥è¯¢"></a>1.8 ä¼˜åŒ–æŸ¥è¯¢</h3><p>åˆ†åŒºè¿™ç§ç²—ç²’åº¦ç´¢å¼•å¯ä»¥è®©æŸ¥è¯¢æ‰«ææ›´å°‘çš„æ•°æ®ï¼Œå¯¹äºè®¿é—®åˆ†åŒºè¡¨æ¥è¯´ï¼Œé‡è¦çš„ä¸€ç‚¹æ˜¯WHEREæ¡ä»¶ä¸­åŠ å…¥åˆ†åŒºåˆ—ï¼Œå³ä½¿çœ‹èµ·æ¥å¾ˆå¤šä½™ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ä½¿ä¼˜åŒ–å™¨è¿‡æ»¤æ‰æ— éœ€è®¿é—®çš„åˆ†åŒºã€‚</p><p>é€šè¿‡EXPLAIN PARTITIONè§‚å¯Ÿä¼˜åŒ–å™¨æ˜¯å¦æ‰§è¡Œäº†åˆ†åŒºè¿‡æ»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯MySQLåªèƒ½åœ¨ä½¿ç”¨åˆ†åŒºå‡½æ•°çš„åˆ—æœ¬èº«è¿›è¡Œæ¯”è¾ƒæ—¶æ‰èƒ½è¿‡æ»¤åˆ†åŒºï¼Œè€Œä¸èƒ½æ ¹æ®è¡¨è¾¾å¼çš„å€¼å»è¿‡æ»¤åˆ†åŒºï¼š<strong>æŸ¥è¯¢æ—¶åªèƒ½é€šè¿‡åˆ—æ¥è¿‡æ»¤åˆ†åŒº</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--æ— æ³•è¿‡æ»¤åˆ†åŒºï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sales_by_day <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(<span class="keyword">day</span>) = <span class="number">2010</span></span><br><span class="line"><span class="comment">--å¯ä»¥è¿‡æ»¤åˆ†åŒºï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sales_by_day <span class="keyword">WHERE</span> <span class="keyword">day</span> <span class="keyword">BETWEEN</span> <span class="string">'2010-01-01'</span> <span class="keyword">AND</span> <span class="string">'2010-12-31'</span></span><br></pre></td></tr></table></figure><h3 id="1-9-åˆå¹¶è¡¨"><a href="#1-9-åˆå¹¶è¡¨" class="headerlink" title="1.9 åˆå¹¶è¡¨"></a>1.9 åˆå¹¶è¡¨</h3><p>åˆå¹¶è¡¨ï¼ˆMerge Tableï¼‰æ˜¯ç®€å•ç‰ˆçš„åˆ†åŒºå®ç°ï¼Œåˆ†åŒºè¡¨æ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”¨æˆ·æ— æ³•è®¿é—®åº•å±‚çš„å„ä¸ªåˆ†åŒºï¼Œä½†ç”¨æˆ·å¯ä»¥å•ç‹¬è®¿é—®åˆå¹¶è¡¨çš„å„ä¸ªå­è¡¨ã€‚</p><p>åˆ†åŒºè¡¨ä¸ä¼˜åŒ–å™¨æ›´ç´§å¯†ç»“åˆï¼Œè€Œåˆå¹¶è¡¨åˆ™æ˜¯è¦è¢«æ·˜æ±°çš„æŠ€æœ¯ã€‚</p><p>åç»­çœç•¥ã€‚</p><h2 id="äºŒ-è§†å›¾"><a href="#äºŒ-è§†å›¾" class="headerlink" title="äºŒ. è§†å›¾"></a>äºŒ. è§†å›¾</h2><h3 id="2-1-ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ"><a href="#2-1-ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ"></a>2.1 ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ</h3><ul><li>è§†å›¾åœ¨MySQL 5.0ç‰ˆæœ¬å¼•å…¥ï¼›</li><li>æœ¬èº«æ˜¯è™šæ‹Ÿè¡¨ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œè®¿é—®è§†å›¾æ—¶ä»å®ä½“è¡¨è·å–æ•°æ®ï¼›</li><li>è§†å›¾ä¸è¡¨åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ï¼Œä¸èƒ½å¯¹è§†å›¾åˆ›å»ºè§¦å‘å™¨ï¼›</li></ul><h3 id="2-2-è§†å›¾çš„ä¸¤ç§å®ç°ç®—æ³•"><a href="#2-2-è§†å›¾çš„ä¸¤ç§å®ç°ç®—æ³•" class="headerlink" title="2.2 è§†å›¾çš„ä¸¤ç§å®ç°ç®—æ³•"></a>2.2 è§†å›¾çš„ä¸¤ç§å®ç°ç®—æ³•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> Oceania <span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Country <span class="keyword">WHERE</span> Continent = <span class="string">'Oceania'</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>;</span><br><span class="line"><span class="keyword">SELECT</span> code, <span class="keyword">name</span> <span class="keyword">FROM</span> Oceania <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Australia'</span>;</span><br></pre></td></tr></table></figure><p>è§†å›¾çš„ä¸¤ç§å®ç°ï¼š</p><ul><li><p><strong>ä¸´æ—¶è¡¨ç®—æ³•</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLE</span> TMP_Oceania <span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Country <span class="keyword">WHERE</span> Continent = <span class="string">'Oceania'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> code, <span class="keyword">name</span> <span class="keyword">FROM</span> TMP_Oceania <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Australia'</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆå¹¶ç®—æ³•</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> code, <span class="keyword">name</span> <span class="keyword">FROM</span> Country <span class="keyword">WHERE</span> Continent = <span class="string">'Oceania'</span> <span class="keyword">AND</span> <span class="keyword">name</span> = <span class="string">'Australia'</span>;</span><br></pre></td></tr></table></figure></li></ul><p>å¯ä»¥åœ¨ <code>EXPLAIN EXTENDED</code> åä½¿ç”¨ <code>SHOW WARNINGS</code> æŸ¥çœ‹ä½¿ç”¨è§†å›¾çš„æŸ¥è¯¢é‡å†™åçš„ç»“æœï¼Œä¸´æ—¶è¡¨ç®—æ³•å®ç°çš„è§†å›¾ä¼šæ˜¾ç¤ºä¸ºæ´¾ç”Ÿè¡¨ï¼ˆDERIVEDï¼‰ï¼š<code>EXPLAIN SELECT * FROM View</code> ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210201/202102010101.png" alt></p><p>åªè¦æ— æ³•åœ¨åŸè¡¨è®°å½•å’Œè§†å›¾è®°å½•å»ºç«‹ä¸€å¯¹ä¸€æ˜ å°„çš„åœºæ™¯éƒ½æ— æ³•ä½¿ç”¨ä¸´æ—¶è¡¨ç®—æ³•å®ç°è§†å›¾ï¼Œå¦‚ GROUP BYï¼ŒDISTINCTï¼Œèšåˆå‡½æ•°ï¼ŒUNIONï¼Œå­æŸ¥è¯¢ç­‰ã€‚</p><h3 id="2-3-å¯æ›´æ–°è§†å›¾"><a href="#2-3-å¯æ›´æ–°è§†å›¾" class="headerlink" title="2.3 å¯æ›´æ–°è§†å›¾"></a>2.3 å¯æ›´æ–°è§†å›¾</h3><p>å¯æ›´æ–°è§†å›¾å°±æ˜¯èƒ½å¤Ÿé€šè¿‡æ›´æ–°è§†å›¾æ¥æ›´æ–°è§†å›¾æ¶‰åŠçš„è¡¨ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Oceania <span class="keyword">SET</span> Population = Population * <span class="number">1.1</span> <span class="keyword">WHERE</span> <span class="keyword">Name</span> = <span class="string">'Australia'</span>;</span><br></pre></td></tr></table></figure><p>è§†å›¾å®šä¹‰åŒ…å« GROUP BYï¼Œèšåˆå‡½æ•°ï¼ŒUNIONç­‰æƒ…å†µä¸èƒ½æ›´æ–°ç›¸å…³è¡¨ï¼Œæ‰€æœ‰ä½¿ç”¨ä¸´æ—¶è¡¨ç®—æ³•å®ç°çš„è§†å›¾ä¸èƒ½æ›´æ–°ï¼Œè¢«æ›´æ–°çš„åˆ—å¿…é¡»æ¥è‡ªåŒä¸€å¼ è¡¨ã€‚</p><p><code>CHECK OPTION</code> è¡¨ç¤ºä»»ä½•é€šè¿‡è§†å›¾æ›´æ–°çš„è¡Œï¼Œéƒ½å¿…é¡»ç¬¦åˆè§†å›¾æœ¬èº«çš„WHEREæ¡ä»¶å®šä¹‰ï¼Œä¸èƒ½æ›´æ–°è§†å›¾å®šä¹‰åˆ—å¤–çš„åˆ—ã€‚</p><h3 id="2-4-è§†å›¾å¯¹æ€§èƒ½çš„å½±å“"><a href="#2-4-è§†å›¾å¯¹æ€§èƒ½çš„å½±å“" class="headerlink" title="2.4 è§†å›¾å¯¹æ€§èƒ½çš„å½±å“"></a>2.4 è§†å›¾å¯¹æ€§èƒ½çš„å½±å“</h3><p>è§†å›¾åœ¨æŸäº›åœºæ™¯ä¹Ÿå¯ä»¥å¸®åŠ©æé«˜æ€§èƒ½ï¼Œ</p><ul><li><p>é‡æ„Schemaæ—¶ä½¿ç”¨è§†å›¾ï¼Œä¿®æ”¹è¡¨ç»“æ„æ—¶ä¸ä¼šå½±å“åº”ç”¨è¿è¡Œï¼›</p></li><li><p>ä½¿ç”¨è§†å›¾å®ç°åŸºäºåˆ—çš„æƒé™æ§åˆ¶ï¼Œä¸éœ€è¦çœŸæ­£çš„åœ¨ç³»ç»Ÿåˆ›å»ºæƒé™ï¼Œæ²¡æœ‰é¢å¤–å¼€é”€ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> XX <span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> XXX;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> public.* <span class="keyword">TO</span> public_user;</span><br></pre></td></tr></table></figure></li><li><p>è§†å›¾å¹¶æ²¡æœ‰çœ‹èµ·æ¥é‚£æ ·ç®€å•ï¼Œä½¿ç”¨è§†å›¾æç¤ºæ€§èƒ½éœ€è¦åšæ¯”è¾ƒè¯¦ç»†çš„æµ‹è¯•ï¼Œä¸´æ—¶è¡¨ç®—æ³•å®ç°çš„è§†å›¾åœ¨å¾ˆå¤šåœºæ™¯ä¸‹æ€§èƒ½å¾ˆç³Ÿç³•ï¼Œåˆå¹¶ç®—æ³•å®ç°çš„è§†å›¾ä¹Ÿä¼šæœ‰é¢å¤–å¼€é”€ï¼Œå¹¶ä¸”è§†å›¾çš„æ€§èƒ½å¾ˆéš¾é¢„æµ‹ã€‚</p></li></ul><h3 id="2-5-ä½¿ç”¨è§†å›¾çš„ä¸€äº›é™åˆ¶"><a href="#2-5-ä½¿ç”¨è§†å›¾çš„ä¸€äº›é™åˆ¶" class="headerlink" title="2.5 ä½¿ç”¨è§†å›¾çš„ä¸€äº›é™åˆ¶"></a>2.5 ä½¿ç”¨è§†å›¾çš„ä¸€äº›é™åˆ¶</h3><ul><li>MySQLä¸æ”¯æŒç‰©åŒ–è§†å›¾ï¼ŒæŒ‡å°†è§†å›¾ç»“æœæ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªå¯ä»¥æŸ¥çœ‹çš„è¡¨ï¼Œå¹¶å®šæ—¶ä»åŸå§‹è¡¨åˆ·æ–°æ•°æ®åˆ°è¿™ä¸ªè¡¨ï¼›</li><li>MySQLè§†å›¾ä¸æ”¯æŒåˆ›å»ºç´¢å¼•ï¼Œä½†å¯ä»¥ä½¿ç”¨ç¼“å­˜è¡¨æˆ–æ±‡æ€»è¡¨æ¨¡æ‹Ÿç‰©åŒ–è§†å›¾å’Œç´¢å¼•ï¼›</li><li>MySQLä¸ä¼šä¿å­˜è§†å›¾å®šä¹‰çš„åŸå§‹SQLè¯­å¥ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨è§†å›¾çš„ <code>.frm</code> æ–‡ä»¶æœ€åä¸€è¡Œè·å–ä¿¡æ¯2ï¼Œå¦‚æœæœ‰FILEæƒé™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨SQLè¯­å¥çš„ <code>LOAD_FILE()</code> è¯»å– <code>.frm</code> çš„è§†å›¾åˆ›å»ºä¿¡æ¯ï¼Œå†å¤„ç†æ‰è½¬ä¹‰å­—ç¬¦ç­‰ã€‚</li></ul><h2 id="ä¸‰-å¤–é”®çº¦æŸ"><a href="#ä¸‰-å¤–é”®çº¦æŸ" class="headerlink" title="ä¸‰. å¤–é”®çº¦æŸ"></a>ä¸‰. å¤–é”®çº¦æŸ</h2><p>InnoDBå¼•æ“æ”¯æŒå¤–é”®ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¦‚æœæƒ³ç¡®ä¿ä¸¤ä¸ªè¡¨å§‹ç»ˆæœ‰ä¸€è‡´æ€§çš„æ•°æ®ï¼Œä½¿ç”¨å¤–é”®æ¯”åœ¨åº”ç”¨ä¸­ä¿è¯ä¸€è‡´æ€§è¦é«˜æ•ˆçš„å¤šï¼Œçº§è”æ›´æ–°å’Œåˆ é™¤ä¹Ÿè¦æ›´å¿«ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>InnoDBå¼ºåˆ¶å¤–é”®ä½¿ç”¨ç´¢å¼•ï¼Œå½“å¤–é”®åˆ—çš„é€‰æ‹©æ€§å¾ˆä½ï¼Œä¼šå¯¼è‡´ä¸€ä¸ªéå¸¸å¤§ä¸”é€‰æ‹©æ€§å¾ˆä½çš„ç´¢å¼•ï¼Œä¸”è¯¥ç´¢å¼•é™¤äº†åšå¤–é”®é™åˆ¶æ²¡æœ‰å…¶ä»–ä½œç”¨ã€‚</li><li>ä½¿ç”¨å¤–é”®éœ€è¦æˆæœ¬ï¼Œæ¯æ¬¡ä¿®æ”¹æ•°æ®æ—¶éƒ½è¦åœ¨å¦ä¸€å¼ è¡¨ä¸­å¤šæ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢æ“ä½œã€‚</li><li>æŸ¥è¯¢éœ€è¦é¢å¤–è®¿é—®ä¸€äº›è¡¨ï¼Œæ„å‘³ç€éœ€è¦é¢å¤–çš„é”ã€‚è‹¥å‘å­è¡¨å†™å…¥ä¸€æ¡è®°å½•ï¼Œå¤–é”®çº¦æŸä½¿InnoDBæ£€æŸ¥çˆ¶è¡¨ä¸­å¯¹åº”çš„è®°å½•è¿›è¡ŒåŠ é”æ“ä½œï¼Œç¡®ä¿è¯¥è®°å½•ä¸ä¼šåœ¨äº‹åŠ¡å®Œæˆæ—¶è¢«åˆ é™¤ï¼Œä¼šå¯¼è‡´é¢å¤–çš„é”ç­‰å¾…ï¼Œç”šè‡³å¯¼è‡´ä¸€äº›éš¾ä»¥æ’æŸ¥çš„æ­»é”ã€‚</li></ul><p>å¯ä»¥ä½¿ç”¨è§¦å‘å™¨æ¥ä»£æ›¿å¤–é”®ï¼Œå½“å¤–é”®åªæ˜¯ç”¨ä½œæ•°å€¼çº¦æŸã€‚å¦‚æœåªæ˜¯æŠŠå¤–é”®åšçº¦æŸï¼Œåœ¨åº”ç”¨å±‚å®ç°ä¼šæ›´å¥½ï¼Œå› ä¸ºå¤–é”®ä¼šå¸¦æ¥å¤§é‡çš„é¢å¤–æ¶ˆè€—ï¼Œå¾ˆå¤šè¿‡å¾€çš„ç»éªŒå‘Šè¯‰æˆ‘ä»¬åœ¨åˆ é™¤å¤–é”®æ—¶æ€§èƒ½ä¼šæœ‰å¤§å¹…æå‡ã€‚</p><h2 id="å››-åœ¨MySQLå†…éƒ¨å­˜å‚¨ä»£ç "><a href="#å››-åœ¨MySQLå†…éƒ¨å­˜å‚¨ä»£ç " class="headerlink" title="å››. åœ¨MySQLå†…éƒ¨å­˜å‚¨ä»£ç "></a>å››. åœ¨MySQLå†…éƒ¨å­˜å‚¨ä»£ç </h2><h3 id="4-1-å­˜å‚¨ä»£ç çš„æ–¹å¼"><a href="#4-1-å­˜å‚¨ä»£ç çš„æ–¹å¼" class="headerlink" title="4.1 å­˜å‚¨ä»£ç çš„æ–¹å¼"></a>4.1 å­˜å‚¨ä»£ç çš„æ–¹å¼</h3><p>ä¸»è¦åŒºåˆ«åœ¨äºæ‰§è¡Œçš„ä¸Šä¸‹æ–‡â€”è¾“å…¥å’Œè¾“å‡º</p><ul><li>è§¦å‘å™¨</li><li>å­˜å‚¨è¿‡ç¨‹ï¼šå¯ä»¥æ¥æ”¶å‚æ•°è¿”å›å€¼</li><li>å‡½æ•°ï¼šå¯ä»¥æ¥æ”¶å‚æ•°è¿”å›å€¼</li><li>å®šæ—¶ä»»åŠ¡ / äº‹ä»¶</li></ul><h3 id="4-2-å­˜å‚¨ä»£ç çš„ä¼˜ç¼ºç‚¹"><a href="#4-2-å­˜å‚¨ä»£ç çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="4.2 å­˜å‚¨ä»£ç çš„ä¼˜ç¼ºç‚¹"></a>4.2 å­˜å‚¨ä»£ç çš„ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p><ul><li>æœåŠ¡å™¨å†…éƒ¨æ‰§è¡Œï¼Œç¦»æ•°æ®æœ€è¿‘ï¼Œå¯ä»¥èŠ‚çœå¸¦å®½å’Œç½‘ç»œå»¶è¿Ÿï¼›</li><li>è¿™æ˜¯ä¸€ç§ä»£ç é‡ç”¨ï¼Œæ–¹ä¾¿ç»Ÿä¸€ä¸šåŠ¡è§„åˆ™ï¼Œä¿è¯æŸäº›è¡Œä¸ºæ€»æ˜¯ä¸€è‡´ï¼Œæ‰€ä»¥ä¹Ÿå¸¦æ¥äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼›</li><li>ç®€åŒ–ä»£ç çš„ç»´æŠ¤å’Œç‰ˆæœ¬æ›´æ–°ï¼›</li><li>å¸®åŠ©æå‡å®‰å…¨æ€§ï¼Œæä¾›äº†æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ï¼Œåº”ç”¨å¯ä»¥é€šè¿‡å­˜å‚¨è¿‡ç¨‹çš„æ¥å£è®¿é—®æ²¡æœ‰æƒé™çš„è¡¨ï¼›</li><li>æœåŠ¡å™¨ç«¯å¯ä»¥ç¼“å­˜å­˜å‚¨è¿‡ç¨‹çš„æ‰§è¡Œè®¡åˆ’ï¼Œé™ä½äº†éœ€è¦åå¤è°ƒç”¨çš„è¿‡ç¨‹çš„æ¶ˆè€—ï¼›</li><li>åœ¨æœåŠ¡å™¨ç«¯éƒ¨ç½²ï¼Œå¤‡ä»½å’Œç»´æŠ¤éƒ½åœ¨æœåŠ¡å™¨ç«¯å®Œæˆï¼›</li><li>å¯ä»¥åœ¨åº”ç”¨å¼€å‘å’Œæ•°æ®åº“å¼€å‘é—´æ›´å¥½çš„åˆ†å·¥ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>MySQLæ²¡æœ‰æä¾›å¥½ç”¨çš„å¼€å‘å’Œè°ƒè¯•å·¥å…·ï¼Œç¼–å†™å­˜å‚¨ä»£ç éš¾åº¦è¾ƒé«˜ï¼›</li><li>å­˜å‚¨ä»£ç ç›¸æ¯”åº”ç”¨ä»£ç æ•ˆç‡è¦å·®ä¸€äº›ï¼Œå¾ˆéš¾å®ç°å¤æ‚é€»è¾‘ï¼›</li><li>å­˜å‚¨ä»£ç å¯èƒ½ä¼šå¸¦æ¥é¢å¤–çš„å¤æ‚æ€§ï¼ŒåŸæœ¬åªéœ€éƒ¨ç½²åº”ç”¨ä»£ç å’Œåº“è¡¨ç»“æ„å˜æ›´ï¼Œè¿˜éœ€è¦é¢å¤–éƒ¨ç½²å†…éƒ¨å­˜å‚¨ä»£ç ï¼›</li><li>éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¼šå¸¦æ¥å®‰å…¨éšæ‚£ï¼Œåªè¦ç ´è§£æ•°æ®åº“å°±å°†åŠŸèƒ½å’Œæ•°æ®å…¨éƒ¨è·å–ï¼›</li><li>å­˜å‚¨è¿‡ç¨‹ç»™æ•°æ®åº“æœåŠ¡å™¨å¸¦æ¥é¢å¤–çš„å‹åŠ›ï¼Œæ•°æ®åº“æœåŠ¡å™¨çš„æ‰©å±•æ€§è¦è¿œå·®äºåº”ç”¨æœåŠ¡å™¨ã€‚</li><li>æ— æ³•æ§åˆ¶å­˜å‚¨ç¨‹åºçš„èµ„æºæ¶ˆè€—ï¼Œå¯èƒ½ä¸€ä¸ªé”™è¯¯å°±æŠŠæœåŠ¡å™¨æ‹–æ­»ã€‚</li><li>å­˜å‚¨ä»£ç çš„å®ç°æœ‰å¾ˆå¤šé™åˆ¶ï¼Œè°ƒè¯•ä¹Ÿå¾ˆå›°éš¾ï¼Œéš¾ä»¥å®šä½é—®é¢˜ã€‚</li><li>ä¸åŸºäºè¯­å¥çš„äºŒè¿›åˆ¶æ—¥å¿—å¤åˆ¶åˆä½œçš„ä¸å¥½ã€‚</li></ul><h3 id="4-3-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#4-3-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="4.3 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>4.3 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h3><p>ä¼˜åŒ–å™¨å¯¹å­˜å‚¨ä»£ç çš„é™åˆ¶ï¼š</p><ul><li>ä¼˜åŒ–å™¨æ— æ³•ä½¿ç”¨å…³é”®å­—DETERMINISTICæ¥ä¼˜åŒ–å•ä¸ªæŸ¥è¯¢ä¸­å¤šæ¬¡è°ƒç”¨å­˜å‚¨å‡½æ•°çš„æƒ…å†µã€‚</li><li>ä¼˜åŒ–å™¨æ— æ³•è¯„ä¼°å­˜å‚¨å‡½æ•°çš„æ‰§è¡Œæˆæœ¬ã€‚</li><li>æ¯ä¸ªè¿æ¥éƒ½æœ‰ç‹¬ç«‹çš„å­˜å‚¨è¿‡ç¨‹çš„æ‰§è¡Œè®¡åˆ’ç¼“å­˜ï¼Œå¦‚æœæœ‰å¤šä¸ªè¿æ¥éœ€è¦è°ƒç”¨åŒä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œå°±ä¼šæµªè´¹ç©ºé—´æ¥åå¤ç¼“å­˜åŒæ ·çš„æ‰§è¡Œè®¡åˆ’ï¼ˆè¿æ¥æ± æˆ–æŒä¹…åŒ–è¿æ¥ä¼šé€ æˆç¼“å­˜æ›´é•¿çš„ç”Ÿå‘½å‘¨æœŸï¼‰ã€‚</li><li>å­˜å‚¨è¿‡ç¨‹å’Œå¤åˆ¶æ˜¯ä¸€å¯¹è¯¡å¼‚çš„ç»„åˆï¼Œæœ€å¥½ä¸è¦å¤åˆ¶å¯¹å­˜å‚¨ç¨‹åºçš„è°ƒç”¨ï¼Œç›´æ¥å¤åˆ¶å…¶æ”¹å˜çš„æ•°æ®ã€‚MySQL 5.1 åå¼•å…¥è¡Œå¤åˆ¶ã€‚</li></ul><h3 id="4-4-è§¦å‘å™¨"><a href="#4-4-è§¦å‘å™¨" class="headerlink" title="4.4 è§¦å‘å™¨"></a>4.4 è§¦å‘å™¨</h3><h4 id="4-4-1-ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿ"><a href="#4-4-1-ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿ" class="headerlink" title="4.4.1 ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿ"></a>4.4.1 ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿ</h4><ul><li>è§¦å‘å™¨å¯ä»¥è®©ä½ åœ¨æ‰§è¡Œ INSERTã€UPDATEæˆ–DELETEæ—¶ï¼Œæ‰§è¡Œä¸€äº›ç‰¹å®šçš„æ“ä½œã€‚</li><li>å¯ä»¥æŒ‡å®šæ˜¯åœ¨SQLè¯­å¥å‰æˆ–åè§¦å‘ï¼Œè§¦å‘å™¨æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼Œä½†å¯ä»¥è¯»å–æˆ–æ”¹å˜è§¦å‘SQLè¯­å¥æ‰€å½±å“çš„æ•°æ®ã€‚</li><li>ä½¿ç”¨è§¦å‘å™¨å¯ä»¥å‡å°‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œç®€åŒ–åº”ç”¨é€»è¾‘ï¼Œä¸€å®šç¨‹åº¦ä¸Šæé«˜æ€§èƒ½ã€‚</li></ul><h4 id="4-4-2-ä½¿ç”¨æ³¨æ„"><a href="#4-4-2-ä½¿ç”¨æ³¨æ„" class="headerlink" title="4.4.2 ä½¿ç”¨æ³¨æ„"></a>4.4.2 ä½¿ç”¨æ³¨æ„</h4><ul><li>å¯¹æ¯ä¸ªè¡¨çš„æ¯ä¸ªäº‹ä»¶ï¼Œæœ€å¤šåªèƒ½å®šä¹‰ä¸€ä¸ªè§¦å‘å™¨ï¼ˆå¦‚ä¸èƒ½å†AFTER INSERTä¸Šå®šä¹‰ä¸¤ä¸ªè§¦å‘å™¨ï¼‰ã€‚</li><li>MySQLåªæ”¯æŒåŸºäºè¡Œçš„è§¦å‘ï¼Œå³è§¦å‘å™¨å§‹ç»ˆé’ˆå¯¹ä¸€æ¡è®°å½•ï¼Œè€Œä¸æ˜¯é’ˆå¯¹æ•´ä¸ªSQLè¯­å¥ï¼Œå½“æ•°æ®é›†å˜å¾—å¾ˆå¤§æ—¶ï¼Œæ•ˆç‡ä¼šå¾ˆä½ã€‚</li><li>è§¦å‘å™¨ä¼šæ©ç›–æœåŠ¡å™¨èƒŒåå¾ˆå¤šå·¥ä½œï¼Œè€Œè§¦å‘å™¨çš„é—®é¢˜å¾ˆéš¾æ’æŸ¥ã€‚</li><li>è§¦å‘å™¨å¯èƒ½ä¼šå¯¼è‡´æ­»é”å’Œé”ç­‰å¾…ï¼Œè§¦å‘å™¨æ‰§è¡Œå¤±è´¥ä¼šå¯¼è‡´SQLä¹Ÿå¤±è´¥ï¼Œä½†ä¸ä¼šæœ‰ç›´æ¥æ˜ç¡®çš„æç¤ºã€‚</li><li>è§¦å‘å™¨åœ¨InnoDBè¡¨ä¸Šæ˜¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆçš„ï¼Œæ‰§è¡Œæ“ä½œæ˜¯åŸå­çš„ï¼ŒåŸå­æ“ä½œå’Œè§¦å‘å™¨æ“ä½œä¼šåŒæ—¶å¤±è´¥æˆ–æˆåŠŸã€‚</li><li>åœ¨InnoDBä¸Šä½¿ç”¨è§¦å‘å™¨å»æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§è¦å°å¿ƒMVCCï¼Œå¯èƒ½ä¼šå¾—åˆ°é”™è¯¯ç»“æœã€‚</li></ul><h3 id="4-5-äº‹ä»¶"><a href="#4-5-äº‹ä»¶" class="headerlink" title="4.5 äº‹ä»¶"></a>4.5 äº‹ä»¶</h3><ul><li>MySQL 5.1 å¼•å…¥äº‹ä»¶ä½œä¸ºä¸€ç§æ–°çš„å­˜å‚¨ä»£ç çš„æ–¹å¼ï¼ŒMySQLå†…éƒ¨å®ç°çš„ç±»ä¼¼äºLinuxçš„å®šæ—¶ä»»åŠ¡ã€‚</li><li>æŒ‡å®šMySQLåœ¨æŸä¸ªæ—¶é—´æ‰§è¡Œä¸€æ®µSQLä»£ç ï¼Œæˆ–è€…æ¯éš”ä¸€ä¸ªæ—¶é—´é—´éš”ã€‚å…¶ä¸­å¤æ‚çš„SQLå°è£…åœ¨ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œäº‹ä»¶æ‰§è¡Œæ—¶åªéœ€åšä¸€ä¸ªç®€å•çš„è°ƒç”¨ã€‚</li><li>äº‹ä»¶åœ¨ä¸€ä¸ªç‹¬ç«‹äº‹ä»¶è°ƒåº¦çº¿ç¨‹ä¸­è¢«åˆå§‹åŒ–ï¼Œè¯¥çº¿ç¨‹å’Œå¤„ç†è¿æ¥çš„çº¿ç¨‹æ²¡æœ‰å…³ç³»ï¼Œå®ƒä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•è¿”å›å€¼ã€‚å¯ä»¥åœ¨MySQLçš„æ—¥å¿—ä¸­çœ‹åˆ°å‘½ä»¤çš„æ‰§è¡Œæ—¥å¿—ï¼Œåœ¨è¡¨ INFORMATION_SCHEMA.EVENTS ä¸­çœ‹åˆ°å„ä¸ªäº‹ä»¶çŠ¶æ€ã€‚</li><li>äº‹ä»¶å®ç°æœºåˆ¶æœ¬èº«å¼€é”€ä¸å¤§ï¼Œä½†äº‹ä»¶éœ€è¦æ‰§è¡ŒSQLï¼Œè¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼›äº‹ä»¶å’Œå…¶ä»–å­˜å‚¨ç¨‹åºä¸€æ ·ï¼Œåœ¨å’ŒåŸºäºè¯­å¥çš„å¤åˆ¶ä¸€èµ·å·¥ä½œæ—¶å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚</li><li>å®šæ—¶äº‹ä»¶å¯èƒ½ä¼šæ‰§è¡Œå¾ˆä¹…ï¼Œå‰ä¸€ä¸ªäº‹ä»¶æœªæ‰§è¡Œå®Œï¼Œåä¸€ä¸ªäº‹ä»¶å¼€å§‹æ‰§è¡Œï¼Œå¼€å‘è¦è‡ªå·±å¤„ç†è¿™ç§æƒ…å†µä¸‹çš„å¹¶å‘ï¼ˆå¯ä»¥ä½¿ç”¨ <code>GET_LOCK()</code> ç¡®ä¿å½“å‰æ€»æ˜¯åªæœ‰ä¸€ä¸ªäº‹ä»¶åœ¨æ‰§è¡Œ-åŠ é”ï¼‰ã€‚</li><li>é€šè¿‡ <code>SET GLOBAL event_scheduler := 1;</code> è®¾ç½®äº‹ä»¶è°ƒåº¦çº¿ç¨‹ï¼Œè®¾ç½®åæ­¤çº¿ç¨‹æ‰§è¡Œå„ä¸ªç”¨æˆ·æŒ‡å®šçš„äº‹ä»¶ä¸­çš„å„æ®µSQLä»£ç ã€‚</li><li>äº‹ä»¶è°ƒåº¦æœ¬èº«æ˜¯ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼ŒMySQLåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ç”¨äºäº‹ä»¶æ‰§è¡Œï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯äº‹ä»¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼ŒçŠ¶æ€æ€»ä¸º Connect ã€‚</li></ul><h2 id="äº”-æ¸¸æ ‡"><a href="#äº”-æ¸¸æ ‡" class="headerlink" title="äº”. æ¸¸æ ‡"></a>äº”. æ¸¸æ ‡</h2><p>æš‚ç•¥ã€‚</p><h2 id="å…­-ç»‘å®šå˜é‡"><a href="#å…­-ç»‘å®šå˜é‡" class="headerlink" title="å…­. ç»‘å®šå˜é‡"></a>å…­. ç»‘å®šå˜é‡</h2><h3 id="6-1-ä»€ä¹ˆæ˜¯ç»‘å®šå˜é‡ï¼Ÿ"><a href="#6-1-ä»€ä¹ˆæ˜¯ç»‘å®šå˜é‡ï¼Ÿ" class="headerlink" title="6.1 ä»€ä¹ˆæ˜¯ç»‘å®šå˜é‡ï¼Ÿ"></a>6.1 ä»€ä¹ˆæ˜¯ç»‘å®šå˜é‡ï¼Ÿ</h3><ul><li><p>MySQL 4.1 ç‰ˆæœ¬å¼•å…¥ç»‘å®šå˜é‡ï¼ˆprepared statementï¼‰ï¼Œç”¨äºæé«˜å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚</p></li><li><p>æµç¨‹ï¼šåˆ›å»ºä¸€ä¸ªç»‘å®šå˜é‡çš„SQLæ—¶ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªSQLè¯­å¥çš„åŸå‹ï¼›æœåŠ¡ç«¯æ”¶åˆ°åï¼Œè§£æå¹¶å­˜å‚¨è¿™ä¸ªSQLè¯­å¥çš„éƒ¨åˆ†æ‰§è¡Œè®¡åˆ’ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªSQLè¯­å¥å¤„ç†å¥æŸ„ï¼Œä»¥åæ¯æ¬¡æ‰§è¡Œæ­¤ç±»æŸ¥è¯¢ï¼Œå®¢æˆ·ç«¯éƒ½æŒ‡å®šä½¿ç”¨è¿™ä¸ªå¥æŸ„ã€‚</p></li><li><p>è¯­æ³•ï¼šç”¨é—®å·æ ‡è®°å¯ä»¥æ¥æ”¶å‚æ•°çš„ä½ç½®ï¼Œé€šè¿‡å‘æœåŠ¡å™¨ç«¯å‘é€å„ä¸ªé—®å·çš„å–å€¼å’Œè¿™ä¸ªSQLçš„å¥æŸ„æ¥æ‰§è¡ŒæŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb1(col1, col2, col3) <span class="keyword">VALUES</span> (?, ?, ?);</span><br></pre></td></tr></table></figure></li></ul><h3 id="6-2-ç»‘å®šå˜é‡ä¸ºä½•èƒ½æé«˜æ€§èƒ½ï¼Ÿ"><a href="#6-2-ç»‘å®šå˜é‡ä¸ºä½•èƒ½æé«˜æ€§èƒ½ï¼Ÿ" class="headerlink" title="6.2 ç»‘å®šå˜é‡ä¸ºä½•èƒ½æé«˜æ€§èƒ½ï¼Ÿ"></a>6.2 ç»‘å®šå˜é‡ä¸ºä½•èƒ½æé«˜æ€§èƒ½ï¼Ÿ</h3><ul><li>åœ¨æœåŠ¡å™¨ç«¯åªéœ€è§£æä¸€æ¬¡SQLè¯­å¥ã€‚</li><li>åœ¨æœåŠ¡å™¨ç«¯æŸäº›ä¼˜åŒ–å™¨çš„å·¥ä½œåªéœ€æ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºä¼šç¼“å­˜ä¸€éƒ¨åˆ†æ‰§è¡Œè®¡åˆ’ã€‚</li><li>ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼åªå‘é€å‚æ•°å’Œå¥æŸ„ï¼Œæ¯”æ¯æ¬¡éƒ½å‘é€ASCIIç æ–‡æœ¬æ•ˆç‡è¦é«˜ï¼Œæ¯”å¦‚ä¸€ä¸ªäºŒè¿›åˆ¶çš„æ—¥æœŸåªéœ€ä¸‰ä¸ªå­—èŠ‚ï¼Œè€Œåè€…åˆ™éœ€è¦åä¸ªå­—èŠ‚ï¼›å¯ä»¥åˆ†å—ä¼ è¾“ï¼Œè€Œæ— éœ€ä¸€æ¬¡æ€§ä¼ è¾“ï¼›è¿˜èŠ‚çœäº†å°†æ•°æ®ä»åŸå§‹æ ¼å¼è½¬ä¸ºæ–‡æœ¬æ ¼å¼çš„å¼€é”€ã€‚</li><li>åªä¼ è¾“å‚æ•°ï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¯­å¥ï¼Œç½‘ç»œå¼€é”€é™ä½ã€‚</li><li>MySQLç›´æ¥å°†å‚æ•°å­˜å‚¨åˆ°ç¼“å­˜ï¼Œä¸éœ€è¦åœ¨å†…å­˜ä¸­å¤šæ¬¡å¤åˆ¶ã€‚</li></ul><h3 id="6-3-ä¼˜åŒ–"><a href="#6-3-ä¼˜åŒ–" class="headerlink" title="6.3 ä¼˜åŒ–"></a>6.3 ä¼˜åŒ–</h3><p>æ¯”å¦‚å½“æ‰§è¡Œè®¡åˆ’éœ€è¦æ ¹æ®ä¼ å…¥çš„å‚æ•°è®¡ç®—æ—¶ï¼ŒMySQLæ— æ³•ç¼“å­˜è¿™éƒ¨åˆ†è®¡åˆ’ã€‚</p><p>æ ¹æ®ä¼˜åŒ–å™¨å·¥ä½œé˜¶æ®µï¼Œåˆ’åˆ†ä¸‰ç±»ä¼˜åŒ–ï¼š</p><ol><li><strong>å‡†å¤‡é˜¶æ®µ</strong>ï¼šæœåŠ¡å™¨è§£æSQLè¯­å¥ï¼Œç§»é™¤ä¸å¯èƒ½æ¡ä»¶ï¼Œå¹¶ä¸”é‡å†™å­æŸ¥è¯¢ã€‚</li><li><strong>ç¬¬ä¸€æ¬¡æ‰§è¡Œ</strong>ï¼šæœåŠ¡å™¨å…ˆç®€åŒ–åµŒå¥—å¾ªç¯çš„å…³è”ï¼Œå¹¶å°†å¤–å…³è”è½¬æ¢æˆå†…å…³è”ã€‚</li><li><strong>æ¯æ¬¡SQLè¯­å¥æ‰§è¡Œ</strong>ï¼š<ul><li>è¿‡æ»¤åˆ†åŒº</li><li>å°½é‡ç§»é™¤ <code>COUNT()</code> ã€<code>MIN()</code> å’Œ <code>MAX()</code> </li><li>ç§»é™¤å¸¸æ•°è¡¨è¾¾å¼</li><li>åšå¿…è¦çš„ç­‰å€¼ä¼ æ’­</li><li>åˆ†æå’Œä¼˜åŒ– ref ã€range å’Œç´¢å¼•ä¼˜åŒ–ç­‰è®¿é—®æ•°æ®çš„æ–¹æ³•</li><li>ä¼˜åŒ–å…³è”é¡ºåº</li></ul></li></ol><h3 id="6-4-SQLæ¥å£çš„ç»‘å®šå˜é‡"><a href="#6-4-SQLæ¥å£çš„ç»‘å®šå˜é‡" class="headerlink" title="6.4 SQLæ¥å£çš„ç»‘å®šå˜é‡"></a>6.4 SQLæ¥å£çš„ç»‘å®šå˜é‡</h3><p>MySQL åœ¨ 4.1 ç‰ˆæœ¬ä¸­æ”¯æŒäº†SQLæ¥å£çš„ç»‘å®šå˜é‡ï¼Œä¸éœ€è¦ä½¿ç”¨äºŒè¿›åˆ¶ä¼ è¾“åè®®ä¹Ÿå¯ä»¥ç›´æ¥ä»¥SQLçš„æ–¹å¼ä½¿ç”¨ç»‘å®šå˜é‡ã€‚</p><p>æœåŠ¡å™¨ä¼šå°†SQLè¯­å¥ç¿»è¯‘ï¼Œæ— éœ€ä½¿ç”¨äºŒè¿›åˆ¶åè®®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @<span class="keyword">sql</span> := <span class="string">'SELECT actor_id, first_name, last_name FROM actor WHERE first_name = ?'</span>;</span><br><span class="line"><span class="keyword">PREPARE</span> stmt_fetch_actor <span class="keyword">FROM</span> @<span class="keyword">sql</span></span><br><span class="line"><span class="keyword">SET</span> @actor_name := <span class="string">'Penelope'</span></span><br><span class="line"><span class="keyword">EXECUTE</span> stmt_fetch_actor <span class="keyword">USING</span> @actor_name;</span><br><span class="line">DEALLOATE <span class="keyword">PREPARE</span> stmt_fetch_actor;</span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•çš„ä¸»è¦ç”¨é€”æ˜¯åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œå¯ä»¥çµæ´»çš„æ‹¼æ¥å­—ç¬¦ä¸²ç­‰å‚æ•°æ„å»ºSQLè¯­å¥ï¼Œé™¤æ­¤å¤–ç›¸æ¯”äºŒè¿›åˆ¶åè®®å°±æ²¡ä»€ä¹ˆä¼˜åŠ¿äº†ã€‚</p><p>ä½¿ç”¨é™åˆ¶ï¼š</p><ul><li>ç»‘å®šå˜é‡æ˜¯ä¼šè¯çº§åˆ«ï¼Œè¿æ¥ä¹‹é—´ä¸èƒ½å…±ç”¨ç»‘å®šå˜é‡å¥æŸ„ã€‚ä¸€æ—¦è¿æ¥æ–­å¼€ï¼ŒåŸæ¥çš„å¥æŸ„ä¹Ÿä¸èƒ½ä½¿ç”¨ï¼Œä½¿ç”¨è¿æ¥æ± å’ŒæŒä¹…åŒ–è¿æ¥å¯ä»¥ç¼“è§£æ­¤é—®é¢˜ã€‚</li><li>MySQL 5.1 ä¹‹å‰ç‰ˆæœ¬ï¼Œç»‘å®šå˜é‡çš„SQLä¸èƒ½ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚</li><li>åªæ‰§è¡Œä¸€æ¬¡çš„SQLï¼Œä½¿ç”¨ç»‘å®šå˜é‡ä¼šå¤šä¸€æ¬¡é¢å¤–çš„å‡†å¤‡é˜¶æ®µæ¶ˆè€—ï¼Œå’Œä¸€æ¬¡é¢å¤–çš„ç½‘ç»œå¼€é”€ã€‚</li><li>ä¸èƒ½åœ¨å­˜å‚¨å‡½æ•°ä¸­ä½¿ç”¨ã€‚</li><li>æœªé‡Šæ”¾çš„ç»‘å®šå˜é‡èµ„æºå®¹æ˜“é€ æˆèµ„æºæ³„éœ²ï¼Œå¯¹æ‰€æœ‰çº¿ç¨‹é€ æˆå½±å“ã€‚</li><li>å¦‚BEGINç­‰æ“ä½œæ— æ³•åœ¨ç»‘å®šå˜é‡ä¸­å®Œæˆã€‚</li></ul><h3 id="6-5-ä¸‰ç§ç»‘å®šå˜é‡çš„åŒºåˆ«"><a href="#6-5-ä¸‰ç§ç»‘å®šå˜é‡çš„åŒºåˆ«" class="headerlink" title="6.5 ä¸‰ç§ç»‘å®šå˜é‡çš„åŒºåˆ«"></a>6.5 ä¸‰ç§ç»‘å®šå˜é‡çš„åŒºåˆ«</h3><ul><li><strong>å®¢æˆ·ç«¯æ¨¡æ‹Ÿçš„ç»‘å®šå˜é‡</strong>ï¼šæ¥æ”¶ä¸€ä¸ªå¸¦å‚æ•°çš„SQLï¼Œå°†æŒ‡å®šçš„å€¼å¸¦å…¥ï¼Œæœ€åå°†å®Œæ•´çš„æŸ¥è¯¢å‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚</li><li><strong>æœåŠ¡ç«¯çš„ç»‘å®šå˜é‡</strong>ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ç‰¹æ®Šçš„äºŒè¿›åˆ¶åè®®å°†å¸¦å‚æ•°çš„å­—ç¬¦ä¸²å‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼Œç„¶åä½¿ç”¨äºŒè¿›åˆ¶åè®®å°†å…·ä½“çš„å‚æ•°å€¼å‘é€ç»™æœåŠ¡å™¨ç«¯å¹¶æ‰§è¡Œã€‚</li><li><strong>SQLæ¥å£çš„ç»‘å®šå˜é‡</strong>ï¼šå®¢æˆ·ç«¯å…ˆå‘é€ä¸€ä¸ªå¸¦å‚æ•°çš„å­—ç¬¦ä¸²åˆ°æœåŠ¡å™¨ï¼Œç±»ä¼¼äºä½¿ç”¨PREPAREçš„SQLè¯­å¥ï¼Œç„¶åå‘é€è®¾ç½®å‚æ•°çš„SQLï¼Œæœ€åä½¿ç”¨EXECUTEæ¥æ‰§è¡ŒSQLï¼Œä½¿ç”¨æ™®é€šçš„æ–‡æœ¬ä¼ è¾“åè®®ã€‚</li></ul><h2 id="ä¸ƒ-ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°"><a href="#ä¸ƒ-ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°" class="headerlink" title="ä¸ƒ. ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°"></a>ä¸ƒ. ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</h2><p>æš‚ç•¥ã€‚</p><h2 id="å…«-æ’ä»¶"><a href="#å…«-æ’ä»¶" class="headerlink" title="å…«. æ’ä»¶"></a>å…«. æ’ä»¶</h2><p>æš‚ç•¥ã€‚</p><h2 id="ä¹-å­—ç¬¦é›†å’Œæ ¡å¯¹"><a href="#ä¹-å­—ç¬¦é›†å’Œæ ¡å¯¹" class="headerlink" title="ä¹. å­—ç¬¦é›†å’Œæ ¡å¯¹"></a>ä¹. å­—ç¬¦é›†å’Œæ ¡å¯¹</h2><p>æš‚ç•¥ã€‚</p><h2 id="å-å…¨æ–‡ç´¢å¼•"><a href="#å-å…¨æ–‡ç´¢å¼•" class="headerlink" title="å. å…¨æ–‡ç´¢å¼•"></a>å. å…¨æ–‡ç´¢å¼•</h2><h3 id="10-1-ä»€ä¹ˆæ˜¯å…¨æ–‡ç´¢å¼•ï¼Ÿ"><a href="#10-1-ä»€ä¹ˆæ˜¯å…¨æ–‡ç´¢å¼•ï¼Ÿ" class="headerlink" title="10.1 ä»€ä¹ˆæ˜¯å…¨æ–‡ç´¢å¼•ï¼Ÿ"></a>10.1 ä»€ä¹ˆæ˜¯å…¨æ–‡ç´¢å¼•ï¼Ÿ</h3><ul><li><strong>åœºæ™¯</strong>ï¼šå¦‚æœæƒ³è¦é€šè¿‡å…³é”®å­—çš„åŒ¹é…æ¥è¿›è¡ŒæŸ¥è¯¢è¿‡æ»¤ï¼Œéœ€è¦åŸºäºç›¸ä¼¼åº¦çš„æŸ¥è¯¢è€Œä¸æ˜¯ç²¾ç¡®çš„æ•°æ®æ¯”è¾ƒï¼Œå…¨æ–‡ç´¢å¼•ä¸“ä¸ºæ­¤åœºæ™¯è®¾è®¡ã€‚</li><li><strong>æ”¯æŒ</strong>ï¼šå„ç§å­—ç¬¦ä¸²å†…å®¹çš„æœç´¢ï¼ŒåŒ…æ‹¬CHARã€VARCHARå’ŒTEXTç±»å‹ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æœç´¢å’Œå¸ƒå°”æœç´¢ã€‚</li><li>äº’è”ç½‘æœç´¢å¼•æ“æŠ€æœ¯å’Œå…¨æ–‡ç´¢å¼•åŸºæœ¬åŸç†ç›¸åŒã€‚</li></ul><h3 id="10-2-è‡ªç„¶è¯­è¨€çš„å…¨æ–‡ç´¢å¼•"><a href="#10-2-è‡ªç„¶è¯­è¨€çš„å…¨æ–‡ç´¢å¼•" class="headerlink" title="10.2 è‡ªç„¶è¯­è¨€çš„å…¨æ–‡ç´¢å¼•"></a>10.2 è‡ªç„¶è¯­è¨€çš„å…¨æ–‡ç´¢å¼•</h3><p>è¯¥å¼•æ“ä¼šè®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡å’ŒæŸ¥è¯¢çš„ç›¸å…³åº¦ï¼Œç›¸å…³åº¦åŸºäºåŒ¹é…çš„å…³é”®è¯ä¸ªæ•°ï¼Œä»¥åŠå…³é”®è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚å‡ºç°æ¬¡æ•°è¶Šå°‘çš„è¯è¯­ï¼ŒåŒ¹é…æ—¶çš„ç›¸å…³åº¦å°±è¶Šé«˜ï¼Œå¸¸è§çš„è¯è¯­å°†ä¸ä¼šæœç´¢ï¼ˆè¶…è¿‡50%çš„è®°å½•éƒ½å‡ºç°ï¼‰ï¼Œå³ä½¿ä¸åœ¨åœç”¨è¯åˆ—è¡¨ä¸­å‡ºç°ã€‚</p><p>å¯ä»¥æ ¹æ®WHEREå­å¥ä¸­çš„MATCH AGAINSTæ¥åŒºåˆ†æŸ¥è¯¢æ˜¯å¦ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> film_text;</span><br><span class="line"><span class="comment">--index_typeä¸ºFULLTEXTï¼Œå‡è®¾ä¸¤ä¸ªå­—æ®µtitle, descriptionå»ºç«‹äº†å…¨æ–‡ç´¢å¼•</span></span><br><span class="line"><span class="keyword">select</span> film_id, title, <span class="keyword">RIGHT</span>(description, <span class="number">25</span>), <span class="keyword">MATCH</span>(title, description) AGAINST(<span class="string">'factory casualties'</span>) <span class="keyword">AS</span> relevance </span><br><span class="line"><span class="keyword">FROM</span> film_text</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(title, description) AGAINST(<span class="string">'factory casualties'</span>);</span><br><span class="line"><span class="comment">--MySQLå°†æœç´¢è¯è¯­åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å…³é”®è¯è¿›è¡Œæœç´¢ï¼Œå‡½æ•°MATCH()ä¼šè¿”å›å…³é”®è¯åŒ¹é…çš„ç›¸å…³åº¦</span></span><br></pre></td></tr></table></figure><p>åœ¨MATCHå‡½æ•°ä¸­æŒ‡å®šçš„åˆ—å¿…é¡»å’Œå…¨æ–‡ç´¢å¼•æŒ‡å®šçš„åˆ—ç›¸åŒï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼Œå› ä¸ºå…¨æ–‡ç´¢å¼•ä¸ä¼šè®°å½•å…³é”®å­—æ¥è‡ªå“ªä¸€åˆ—ã€‚ä¹Ÿæ„å‘³ç€æ— æ³•ä½¿ç”¨å…¨æ–‡ç´¢å¼•æ¥æŸ¥è¯¢æŸä¸ªå…³é”®å­—æ˜¯å¦åœ¨æŸä¸€åˆ—ä¸­å­˜åœ¨ã€‚</p><h3 id="10-3-å¸ƒå°”å…¨æ–‡ç´¢å¼•"><a href="#10-3-å¸ƒå°”å…¨æ–‡ç´¢å¼•" class="headerlink" title="10.3 å¸ƒå°”å…¨æ–‡ç´¢å¼•"></a>10.3 å¸ƒå°”å…¨æ–‡ç´¢å¼•</h3><p>ç”¨æˆ·å¯ä»¥åœ¨å¸ƒå°”æœç´¢çš„æŸ¥è¯¢ä¸­è‡ªå®šä¹‰æŸä¸ªè¢«æœç´¢è¯è¯­çš„ç›¸å…³æ€§ï¼Œé€šè¿‡åœç”¨è¯åˆ—è¡¨è¿‡æ»¤æ‰â€œå™ªå£°â€è¯ï¼Œè¦æ±‚æœç´¢å…³é”®è¯é•¿åº¦éœ€è¦å¤§äº <code>ft_min_word_len</code> ä¸”å°äº <code>ft_max_word_len</code> ï¼Œæœç´¢ç»“æœæœªç»æ’åºã€‚</p><p>é€šè¿‡<strong>å‰ç¼€ä¿®é¥°ç¬¦</strong>æ¥å®šåˆ¶å¸ƒå°”æœç´¢ï¼š</p><ul><li>dinosaurï¼šåŒ…å«dinosaurçš„è¡Œrankå€¼æ›´é«˜</li><li>~dinosaurï¼šåŒ…å«dinosaurçš„è¡Œrankå€¼æ›´ä½</li><li>+dinosaurï¼šè¡Œè®°å½•å¿…é¡»åŒ…å«dinosaur</li><li>-dinosaurï¼šè¡Œè®°å½•ä¸å¯ä»¥åŒ…å«dinosaur</li><li>dino*ï¼šåŒ…å«ä»¥dinoå¼€å¤´çš„å•è¯çš„è¡Œrankå€¼æ›´é«˜</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--æŸ¥è¯¢å¿…é¡»åŒæ—¶åŒ…å«factoryå’Œcasualties</span></span><br><span class="line"><span class="keyword">SELECT</span> film_id, title, <span class="keyword">RIGHT</span>(description, <span class="number">25</span>)</span><br><span class="line"><span class="keyword">FROM</span> film_text</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(title, description)</span><br><span class="line">AGAINST(<span class="string">'+factory +casualties'</span> <span class="keyword">IN</span> <span class="built_in">BOOLEAN</span> <span class="keyword">MODE</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--æŸ¥è¯¢ä¸­ä½¿ç”¨æ‹¬å·è¿›è¡ŒçŸ­è¯­æœç´¢</span></span><br><span class="line"><span class="keyword">SELECT</span> film_id, title, <span class="keyword">RIGHT</span>(description, <span class="number">25</span>)</span><br><span class="line"><span class="keyword">FROM</span> film_text</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(title, description)</span><br><span class="line">AGAINST(<span class="string">'"spirited casualties"'</span> <span class="keyword">IN</span> <span class="built_in">BOOLEAN</span> <span class="keyword">MODE</span>);</span><br></pre></td></tr></table></figure><p>çŸ­è¯­æœç´¢è¾ƒæ…¢ï¼Œå› ä¸ºå•ä½¿ç”¨å…¨æ–‡ç´¢å¼•æ— æ³•åˆ¤æ–­æ˜¯å¦ç²¾ç¡®åŒ¹é…åˆ°çŸ­è¯­ï¼Œé€šå¸¸è¿˜è¦æŸ¥è¯¢åŸæ–‡ç¡®å®šè®°å½•æ˜¯å¦åŒ…å«å®Œæ•´çš„çŸ­è¯­ï¼Œå› ä¸ºéœ€è¦å›è¡¨è¿‡æ»¤ï¼Œæ‰€ä»¥æ•ˆç‡ä¸é«˜ã€‚</p><h3 id="10-4-ä½¿ç”¨é™åˆ¶"><a href="#10-4-ä½¿ç”¨é™åˆ¶" class="headerlink" title="10.4 ä½¿ç”¨é™åˆ¶"></a>10.4 ä½¿ç”¨é™åˆ¶</h3><ul><li>å…¨æ–‡ç´¢å¼•åªèƒ½é€šè¿‡è¯é¢‘æ¥åˆ¤æ–­ç›¸å…³æ€§ï¼Œç´¢å¼•ä¸ä¼šè®°å½•ç´¢å¼•è¯åœ¨å­—ç¬¦ä¸²çš„ä½ç½®ã€‚</li><li>å…¨æ–‡ç´¢å¼•åªæœ‰å…¨éƒ¨åœ¨å†…å­˜ä¸­æ—¶æ‰æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œä½¿ç”¨ç²¾ç¡®çŸ­è¯­æœç´¢æ—¶ï¼Œéœ€è¦æ•°æ®å’Œç´¢å¼•éƒ½åœ¨å†…å­˜ä¸­ã€‚</li><li>å…¨æ–‡ç´¢å¼•ç›¸æ¯”å…¶ä»–ç´¢å¼•åœ¨ INSERTã€UPDATE å’Œ DELETE æ“ä½œçš„ä»£ä»·éƒ½å¾ˆå¤§ï¼š<ul><li>ä¿®æ”¹æ–‡æœ¬ä¸­çš„100ä¸ªå•è¯ï¼Œéœ€è¦100æ¬¡ç´¢å¼•æ“ä½œï¼Œè€Œä¸æ˜¯ä¸€æ¬¡ã€‚</li><li>ä¸€èˆ¬æƒ…å†µï¼Œåˆ—é•¿åº¦ä¸ä¼šå½±å“å…¶ä»–ç´¢å¼•ç±»å‹ï¼Œä½†å¯¹äºå…¨æ–‡ç´¢å¼•ï¼Œä¸ªä½æ•°å•è¯æ–‡æœ¬å’Œ10000ä¸ªå•è¯çš„æ–‡æœ¬ï¼Œæ€§èƒ½å¯èƒ½ç›¸å·®å‡ ä¸ªæ•°é‡çº§ã€‚</li><li>å…¨æ–‡ç´¢å¼•æœ‰æ›´å¤šç¢ç‰‡ï¼Œå¯èƒ½éœ€è¦åšæ›´å¤šçš„ <code>OPTIMIZE TABLE</code> æ“ä½œã€‚</li></ul></li><li>å…¨æ–‡ç´¢å¼•å½±å“ä¼˜åŒ–å™¨ï¼š<ul><li>æŸ¥è¯¢ä¸­ä½¿ç”¨äº† <code>MATCH AGAINST</code> å­å¥ï¼Œå¯¹åº”åˆ—æœ‰å¯ç”¨çš„å…¨æ–‡ç´¢å¼•ï¼Œè¿™ç§æƒ…å†µä¸€å®šä¼šä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼Œå³ä½¿å¯èƒ½æœ‰æ€§èƒ½æ›´å¥½çš„å…¶ä»–ç´¢å¼•ã€‚</li><li>å…¨æ–‡ç´¢å¼•åªèƒ½ç”¨ä½œå…¨æ–‡æœç´¢åŒ¹é…ï¼Œä»»ä½•å…¶ä»–æ“ä½œï¼Œå¦‚WHEREæ¡ä»¶æ¯”è¾ƒï¼Œéƒ½éœ€è¦åœ¨MySQLå®Œæˆå…¨æ–‡æœç´¢è¿”å›è®°å½•åæ‰èƒ½è¿›è¡Œï¼Œæ™®é€šç´¢å¼•å¯ä»¥åœ¨å¤„ç†WHEREæ¡ä»¶æ—¶ä¸€æ¬¡åˆ¤æ–­å¤šä¸ªæ¯”è¾ƒè¡¨è¾¾å¼ã€‚</li><li>å…¨æ–‡ç´¢å¼•ä¸å­˜å‚¨ç´¢å¼•åˆ—çš„å®é™…å€¼ï¼Œç´¢å¼•ä¸èƒ½ç”¨ä½œç´¢å¼•è¦†ç›–æ‰«æã€‚</li><li>é™¤äº†ç›¸å…³æ€§æ’åºï¼Œå…¨æ–‡ç´¢å¼•ä¸èƒ½ç”¨äºå…¶ä»–æ’åºã€‚</li></ul></li></ul><h2 id="åä¸€-åˆ†å¸ƒå¼ï¼ˆXAï¼‰äº‹åŠ¡"><a href="#åä¸€-åˆ†å¸ƒå¼ï¼ˆXAï¼‰äº‹åŠ¡" class="headerlink" title="åä¸€. åˆ†å¸ƒå¼ï¼ˆXAï¼‰äº‹åŠ¡"></a>åä¸€. åˆ†å¸ƒå¼ï¼ˆXAï¼‰äº‹åŠ¡</h2><h3 id="11-1-MySQLä¸­çš„XAäº‹åŠ¡"><a href="#11-1-MySQLä¸­çš„XAäº‹åŠ¡" class="headerlink" title="11.1 MySQLä¸­çš„XAäº‹åŠ¡"></a>11.1 MySQLä¸­çš„XAäº‹åŠ¡</h3><p>å­˜å‚¨å¼•æ“çš„äº‹åŠ¡ç‰¹æ€§èƒ½ä¿è¯åœ¨å­˜å‚¨å¼•æ“çº§åˆ«å®ç°ACIDï¼Œåˆ†å¸ƒå¼äº‹åŠ¡åˆ™å¯ä»¥æ‰©å±•åˆ°æ•°æ®åº“å±‚é¢ï¼Œä»¥åŠå¤šä¸ªæ•°æ®åº“ä¹‹é—´ã€‚é€šè¿‡<strong>ä¸¤é˜¶æ®µæäº¤</strong>æ¥å®ç°ã€‚</p><p>MySQL åœ¨ 5.0 ç‰ˆæœ¬æ”¯æŒ XA äº‹åŠ¡ï¼ŒXAäº‹åŠ¡éœ€è¦æœ‰ä¸€ä¸ªäº‹åŠ¡åè°ƒå™¨æ¥ä¿è¯æ‰€æœ‰çš„äº‹åŠ¡å‚ä¸è€…éƒ½å®Œæˆäº†å‡†å¤‡å·¥ä½œï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰ï¼›å¦‚æœåè°ƒå™¨æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…éƒ½å‡†å¤‡å¥½çš„æ¶ˆæ¯ï¼Œå°±ä¼šå‘Šè¯‰äº‹åŠ¡å¯ä»¥æäº¤äº†ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰ã€‚MySQLåœ¨ XA äº‹åŠ¡ä¸­çš„è§’è‰²æ˜¯å‚ä¸è€…è€Œä¸æ˜¯åè°ƒè€…ã€‚</p><h3 id="11-2-å†…éƒ¨XAäº‹åŠ¡"><a href="#11-2-å†…éƒ¨XAäº‹åŠ¡" class="headerlink" title="11.2 å†…éƒ¨XAäº‹åŠ¡"></a>11.2 å†…éƒ¨XAäº‹åŠ¡</h3><h4 id="ï¼ˆ1ï¼‰äºŒè¿›åˆ¶æ—¥å¿—åœ¨ä½¿ç”¨XAäº‹åŠ¡"><a href="#ï¼ˆ1ï¼‰äºŒè¿›åˆ¶æ—¥å¿—åœ¨ä½¿ç”¨XAäº‹åŠ¡" class="headerlink" title="ï¼ˆ1ï¼‰äºŒè¿›åˆ¶æ—¥å¿—åœ¨ä½¿ç”¨XAäº‹åŠ¡"></a>ï¼ˆ1ï¼‰äºŒè¿›åˆ¶æ—¥å¿—åœ¨ä½¿ç”¨XAäº‹åŠ¡</h4><p>MySQLæœ¬èº«çš„æ’ä»¶å¼æ¶æ„å¯¼è‡´å…¶å†…éƒ¨éœ€è¦ä½¿ç”¨XAäº‹åŠ¡ã€‚MySQLä¸­å„ä¸ªå­˜å‚¨å¼•æ“ç›¸äº’ç‹¬ç«‹ï¼Œæ— æ³•æ„ŸçŸ¥å¯¹æ–¹çš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸€ä¸ªè·¨å­˜å‚¨å¼•æ“çš„äº‹åŠ¡éœ€è¦ä¸€ä¸ªå¤–éƒ¨çš„åè°ƒè€…ï¼Œå¦åˆ™æ— æ³•æ»¡è¶³ACIDã€‚</p><p>å­˜å‚¨å¼•æ“æäº¤çš„åŒæ—¶ï¼Œéœ€è¦å°†æäº¤ä¿¡æ¯å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¯ä»¥æŠŠäºŒè¿›åˆ¶æ—¥å¿—æ“ä½œçœ‹ä½œä¸€ä¸ªç‹¬ç«‹çš„å­˜å‚¨å¼•æ“ã€‚</p><h4 id="ï¼ˆ2ï¼‰XAäº‹åŠ¡å½±å“æ€§èƒ½"><a href="#ï¼ˆ2ï¼‰XAäº‹åŠ¡å½±å“æ€§èƒ½" class="headerlink" title="ï¼ˆ2ï¼‰XAäº‹åŠ¡å½±å“æ€§èƒ½"></a>ï¼ˆ2ï¼‰XAäº‹åŠ¡å½±å“æ€§èƒ½</h4><p>XAäº‹åŠ¡å¯¼è‡´MySQLæ€§èƒ½å¤§å¹…ä¸‹é™ï¼Œç›´æ¥ç ´åäº†MySQLå†…éƒ¨çš„æ‰¹é‡æäº¤ï¼ˆä¸€ç§é€šè¿‡å•ç£ç›˜I/Oæ“ä½œå®Œæˆå¤šä¸ªäº‹åŠ¡æäº¤çš„æŠ€æœ¯ï¼Œå·²æœ‰å¤šç§è§£å†³æ–¹æ¡ˆï¼‰ï¼Œä½¿å¾—MySQLä¸å¾—ä¸è¿›è¡Œå¤šæ¬¡é¢å¤–çš„ <code>fsync()</code> è°ƒç”¨ã€‚</p><p>ä¸€ä¸ªäº‹åŠ¡è‹¥æ˜¯å¼€å¯äº†äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¸ä»…éœ€è¦å¯¹äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼ŒInnoDBäº‹åŠ¡æ—¥å¿—è¿˜éœ€è¦ä¸¤æ¬¡æ—¥å¿—æŒä¹…åŒ–æ“ä½œã€‚å³<strong>äºŒè¿›åˆ¶æ—¥å¿—å®‰å…¨çš„äº‹åŠ¡å®ç°éœ€è¦è‡³å°‘ä¸‰æ¬¡ <code>fsync()</code> æ“ä½œã€‚</strong></p><h4 id="ï¼ˆ3ï¼‰é…ç½®é¡¹"><a href="#ï¼ˆ3ï¼‰é…ç½®é¡¹" class="headerlink" title="ï¼ˆ3ï¼‰é…ç½®é¡¹"></a>ï¼ˆ3ï¼‰é…ç½®é¡¹</h4><p>å¯ä»¥é€šè¿‡å°† <code>innodb_support_xa</code> è®¾ç½®ä¸º0 å…³é—­äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆå¤åˆ¶éœ€è¦äºŒè¿›åˆ¶æ—¥å¿—å’ŒXAäº‹åŠ¡çš„æ”¯æŒï¼Œæ‰€ä»¥æ­¤è®¾ç½®ä¹Ÿä¼šä½¿å¤åˆ¶æ— æ³•ä½¿ç”¨ï¼‰ã€‚</p><p>å°† <code>sync_binlog</code> è®¾ç½®ä¸º1ï¼Œä¿è¯å­˜å‚¨å¼•æ“å’ŒäºŒè¿›åˆ¶æ—¥å¿—æ˜¯çœŸæ­£åŒæ­¥çš„ã€‚å¦åˆ™äº‹åŠ¡æäº¤äº†äºŒè¿›åˆ¶æ—¥å¿—å´å¯èƒ½æœªâ€œæäº¤â€åˆ°ç£ç›˜ã€‚</p><h3 id="11-3-å¤–éƒ¨XAäº‹åŠ¡"><a href="#11-3-å¤–éƒ¨XAäº‹åŠ¡" class="headerlink" title="11.3 å¤–éƒ¨XAäº‹åŠ¡"></a>11.3 å¤–éƒ¨XAäº‹åŠ¡</h3><p>MySQLèƒ½å¤Ÿä½œä¸ºå‚ä¸è€…å®Œæˆä¸€ä¸ªå¤–éƒ¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†å…¶å¯¹XAåè®®çš„æ”¯æŒè¿˜ä¸å®Œæ•´ï¼Œå¦‚å½“å‰ç‰ˆæœ¬è¿˜ä¸æ”¯æŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šä¸ªè¿æ¥å¯ä»¥åšå…³è”ã€‚</p><p>å› ä¸ºé€šä¿¡å»¶è¿Ÿå’Œå‚ä¸è€…æœ¬èº«å¯èƒ½å¤±è´¥ï¼Œå¤–éƒ¨XAäº‹åŠ¡ä¼šæ¯”å†…éƒ¨çš„æ¶ˆè€—æ›´å¤§ã€‚å¯¹äºç½‘ç»œç¯å¢ƒä¸ç¨³å®šæˆ–ç”¨æˆ·é•¿æ—¶é—´ç­‰å¾…è€Œä¸æäº¤ï¼Œéœ€è¦é¿å…ä½¿ç”¨XAäº‹åŠ¡ï¼Œå®ƒä¼šå½±å“æ‰€æœ‰å‚ä¸è€…ã€‚</p><p>XAäº‹åŠ¡æ˜¯ä¸€ç§åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´åŒæ­¥æ•°æ®çš„æ–¹æ³•ï¼Œä¸èƒ½ä½¿ç”¨MySQLæœ¬èº«çš„å¤åˆ¶ï¼Œä»¥åŠæ€§èƒ½éç“¶é¢ˆæ—¶å¯ä»¥å°è¯•ä½¿ç”¨ã€‚</p><h2 id="åäºŒ-æŸ¥è¯¢ç¼“å­˜"><a href="#åäºŒ-æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="åäºŒ. æŸ¥è¯¢ç¼“å­˜"></a>åäºŒ. æŸ¥è¯¢ç¼“å­˜</h2><h3 id="12-1-ä»€ä¹ˆæ˜¯æŸ¥è¯¢ç¼“å­˜ï¼Ÿ"><a href="#12-1-ä»€ä¹ˆæ˜¯æŸ¥è¯¢ç¼“å­˜ï¼Ÿ" class="headerlink" title="12.1 ä»€ä¹ˆæ˜¯æŸ¥è¯¢ç¼“å­˜ï¼Ÿ"></a>12.1 ä»€ä¹ˆæ˜¯æŸ¥è¯¢ç¼“å­˜ï¼Ÿ</h3><p>MySQLå¯ä»¥ç¼“å­˜æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Œç›¸åŒç±»å‹çš„SQLå¯ä»¥è·³è¿‡SQLçš„è§£æå’Œæ‰§è¡Œè®¡åˆ’ç”Ÿæˆé˜¶æ®µï¼›æŸ¥è¯¢ç¼“å­˜æ˜¯å¦ä¸€ç§ç¼“å­˜ç±»å‹ï¼Œç¼“å­˜å®Œæ•´çš„SELECTç»“æœã€‚</p><p>å‘½ä¸­æŸ¥è¯¢ç¼“å­˜åä¼šç›´æ¥è¿”å›ç»“æœï¼Œè·³è¿‡äº†è§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œé˜¶æ®µã€‚</p><p>æŸ¥è¯¢ç¼“å­˜ç³»ç»Ÿä¼šè·Ÿè¸ªæŸ¥è¯¢æ¶‰åŠçš„æ¯å¼ è¡¨ï¼Œå½“è¡¨å‘ç”Ÿå˜åŒ–ä¼šå¯¼è‡´ç›¸å…³çš„ç¼“å­˜æ•°æ®å¤±æ•ˆï¼›è™½ç„¶çœ‹èµ·æ¥è¿™ç§å®ç°æ¯”è¾ƒä½æ•ˆç‡ï¼Œå› ä¸ºè¡¨å˜åŒ–æ—¶æœªå¿…ä¼šå¯¼è‡´æ•°æ®æŸ¥è¯¢ç»“æœæœ‰å˜æ›´ï¼Œä½†è¿™æ ·çš„å®ç°ä»£ä»·å¾ˆå°ã€‚</p><p>æŸ¥è¯¢ç¼“å­˜å¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ã€‚</p><h3 id="12-2-è°¨æ…ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜"><a href="#12-2-è°¨æ…ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="12.2 è°¨æ…ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜"></a>12.2 è°¨æ…ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜</h3><p>æŸ¥è¯¢ç¼“å­˜æ˜¯ä¸€ä¸ªå½±å“æœåŠ¡å™¨æ‰©å±•æ€§çš„å› ç´ ï¼Œå¯èƒ½ä¼šå˜æˆæ•´ä¸ªæœåŠ¡å™¨çš„èµ„æºç«äº‰ç‚¹ï¼Œåœ¨å¤šæ ¸æœåŠ¡å™¨ä¸Šç”šè‡³å¯èƒ½å¯¼è‡´æœåŠ¡å™¨åƒµæ­»ã€‚é»˜è®¤å»ºè®®å…³é—­æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœåˆ¤æ–­æŸ¥è¯¢ç¼“å­˜å¾ˆæœ‰ä½œç”¨ï¼Œä¹Ÿåº”è¯¥åªé…ç½®ä¸€ä¸ªè¾ƒå°çš„æŸ¥è¯¢ç¼“å­˜ç©ºé—´ï¼ˆå¦‚å‡ åå…†ï¼‰ã€‚</p><h3 id="12-3-MySQLå¦‚ä½•åˆ¤æ–­ç¼“å­˜å‘½ä¸­ï¼Ÿ"><a href="#12-3-MySQLå¦‚ä½•åˆ¤æ–­ç¼“å­˜å‘½ä¸­ï¼Ÿ" class="headerlink" title="12.3 MySQLå¦‚ä½•åˆ¤æ–­ç¼“å­˜å‘½ä¸­ï¼Ÿ"></a>12.3 MySQLå¦‚ä½•åˆ¤æ–­ç¼“å­˜å‘½ä¸­ï¼Ÿ</h3><p>ç¼“å­˜å­˜æ”¾åœ¨ä¸€ä¸ªå¼•ç”¨è¡¨ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªå“ˆå¸Œå€¼å¼•ç”¨ï¼Œå“ˆå¸Œå€¼åŒ…æ‹¬æŸ¥è¯¢æœ¬èº«ã€å½“å‰è¦æŸ¥è¯¢çš„æ•°æ®åº“ã€å®¢æˆ·ç«¯åè®®çš„ç‰ˆæœ¬ç­‰ä¸€äº›å…¶ä»–å¯èƒ½ä¼šå½±å“è¿”å›ç»“æœçš„ä¿¡æ¯ã€‚</p><p>å½“åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­æ—¶ï¼ŒMySQLä¸ä¼šè§£æã€æ­£è§„åŒ–æˆ–å‚æ•°åŒ–æŸ¥è¯¢è¯­å¥ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨SQLè¯­å¥å’Œå…¶ä»–æ”¶åˆ°çš„åŸå§‹ä¿¡æ¯æ¥åˆ¤æ–­ã€‚<strong>ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒï¼Œå¦‚ç©ºæ ¼ã€æ³¨é‡Šç­‰éƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸å‘½ä¸­</strong>ã€‚</p><p>å½“æŸ¥è¯¢è¯­å¥ä¸­æœ‰ä¸€äº›ä¸ç¡®å®šçš„æ•°æ®æ—¶ï¼Œä¸ä¼šè¢«ç¼“å­˜ã€‚å¦‚å‡½æ•° <code>NOW()</code> æˆ– <code>CURRENT_DATE()</code> çš„æŸ¥è¯¢ä¸ä¼šè¢«ç¼“å­˜ï¼Œä»¥åŠ <code>CURRENT_USER</code> æˆ– <code>CONNECTION_ID()</code> ã€‚æ€»ç»“ï¼Œ<strong>æŸ¥è¯¢åŒ…å«ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€å­˜å‚¨å‡½æ•°ã€ç”¨æˆ·å˜é‡ã€ä¸´æ—¶è¡¨ã€mysqlåº“çš„ç³»ç»Ÿè¡¨ï¼Œæˆ–ä»»ä½•åŒ…å«åˆ—çº§åˆ«æƒé™çš„è¡¨ï¼Œéƒ½ä¸ä¼šè¢«ç¼“å­˜</strong>ã€‚</p><p>MySQLå¹¶ä¸è§£æSQLï¼Œå®ƒå¦‚ä½•çŸ¥é“æŸ¥è¯¢ä¸­å«æœ‰ä¸ç¡®å®šçš„å‡½æ•°ï¼ŸMySQLé€šè¿‡ä¸€ä¸ªå¤§å°å†™ä¸æ•æ„Ÿçš„æ£€æŸ¥ç¡®è®¤SQLè¯­å¥æ˜¯å¦ä»¥SELå¼€å¤´ã€‚æŸ¥è¯¢ç¼“å­˜æ˜¯åœ¨å®Œæ•´çš„SELECTè¯­å¥åŸºç¡€ä¹‹ä¸Šï¼Œåªæœ‰åœ¨åˆšæ”¶åˆ°SQLè¯­å¥æ—¶æ£€æŸ¥ï¼Œæ‰€ä»¥å­æŸ¥è¯¢å’Œå­˜å‚¨è¿‡ç¨‹éƒ½æ— æ³•ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚</p><h3 id="12-4-ä½¿ç”¨é™åˆ¶"><a href="#12-4-ä½¿ç”¨é™åˆ¶" class="headerlink" title="12.4 ä½¿ç”¨é™åˆ¶"></a>12.4 ä½¿ç”¨é™åˆ¶</h3><ul><li>å¼€å¯æŸ¥è¯¢ç¼“å­˜ä¼šå¯¹è¯»å†™æ“ä½œéƒ½å¸¦æ¥é¢å¤–çš„æ¶ˆè€—ï¼š<ul><li>è¯»æŸ¥è¯¢åœ¨å¼€å§‹å‰è¦æ£€æŸ¥æ˜¯å¦å‘½ä¸­ç¼“å­˜ï¼›</li><li>è¯»æŸ¥è¯¢å¯ä»¥è¢«ç¼“å­˜ï¼Œåœ¨æ‰§è¡Œå®Œæˆåï¼ŒMySQLæ£€æŸ¥è¿˜æœªè¢«ç¼“å­˜ï¼Œä¼šå°†ç»“æœå­˜å…¥æŸ¥è¯¢ç¼“å­˜ï¼›</li><li>å‘æŸä¸ªè¡¨å†™å…¥æ•°æ®æ—¶ï¼ŒMySQLè¦å°†ç›¸å…³ç¼“å­˜è®¾ç½®å¤±æ•ˆã€‚å¦‚æœæŸ¥è¯¢ç¼“å­˜å¾ˆå¤§æˆ–è€…ç¢ç‰‡å¾ˆå¤š</li></ul></li><li>å¯¹æŸ¥è¯¢ç¼“å­˜æ“ä½œæ˜¯ä¸€ä¸ªåŠ é”æ’ä»–æ“ä½œã€‚</li><li>äº‹åŠ¡ä¸­ä¿®æ”¹æŸè¡¨ä¼šä½¿å¯¹åº”æŸ¥è¯¢ç¼“å­˜éƒ½è®¾ç½®å¤±æ•ˆï¼Œä½†InnoDBçš„å¤šç‰ˆæœ¬ç‰¹æ€§ä¼šæš‚æ—¶å°†è¿™ä¸ªä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡å±è”½ï¼Œæ­¤äº‹åŠ¡æäº¤å‰ï¼Œè¿™ä¸ªè¡¨çš„ç›¸å…³æŸ¥è¯¢æ— æ³•è¢«ç¼“å­˜ï¼Œåªèƒ½åœ¨äº‹åŠ¡æäº¤åæ‰è¢«ç¼“å­˜ã€‚å› æ­¤ï¼Œé•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡ä¼šå¤§å¤§é™ä½æŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚</li><li>æŸ¥è¯¢ç¼“å­˜å¯èƒ½ä¼šä½¿ç”¨å¤§é‡çš„å†…å­˜ï¼Œå¹¶ä¸”å› ä¸ºæ“ä½œé ä¸€ä¸ªå…¨å±€é”ä¿æŠ¤ï¼Œæ‰€æœ‰éœ€è¦åšè¯¥æ“ä½œçš„æŸ¥è¯¢éƒ½è¦ç­‰å¾…è¿™ä¸ªé”ã€‚</li></ul><h3 id="12-5-æŸ¥è¯¢ç¼“å­˜å¦‚ä½•ä½¿ç”¨å†…å­˜"><a href="#12-5-æŸ¥è¯¢ç¼“å­˜å¦‚ä½•ä½¿ç”¨å†…å­˜" class="headerlink" title="12.5 æŸ¥è¯¢ç¼“å­˜å¦‚ä½•ä½¿ç”¨å†…å­˜"></a>12.5 æŸ¥è¯¢ç¼“å­˜å¦‚ä½•ä½¿ç”¨å†…å­˜</h3><p>æŸ¥è¯¢ç¼“å­˜å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚é™¤äº†æŸ¥è¯¢ç»“æœï¼Œè¿˜è¦å­˜æ”¾ä¸€äº›ç»´æŠ¤ç›¸å…³çš„æ•°æ®ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼šï¼ˆå¤§æ¦‚éœ€è¦40KBçš„å†…å­˜èµ„æºï¼‰</p><ul><li>ç¡®å®šå“ªäº›å†…å­˜ç›®å‰å¯ç”¨ï¼›</li><li>å“ªäº›å·²ç»ç”¨æ‰ï¼›</li><li>å“ªäº›ç”¨æ¥å­˜å‚¨æ•°æ®è¡¨å’ŒæŸ¥è¯¢ç»“æœä¹‹å‰çš„æ˜ å°„ï¼›</li><li>å“ªäº›ç”¨æ¥å­˜å‚¨æ•°æ®è¡¨å’ŒæŸ¥è¯¢ç»“æœä¹‹å‰çš„æ˜ å°„ï¼›</li><li>å“ªäº›ç”¨æ¥å­˜å‚¨æŸ¥è¯¢å­—ç¬¦ä¸²å’ŒæŸ¥è¯¢ç»“æœã€‚</li></ul><p>MySQLç”¨äºæŸ¥è¯¢ç¼“å­˜çš„å†…å­˜è¢«åˆ†ä¸ºä¸€ä¸ªä¸ªçš„æ•°æ®å—ï¼Œæ•°æ®å—æ˜¯å˜é•¿çš„ã€‚æ¯ä¸ªæ•°æ®å—å­˜å‚¨äº†è‡ªå·±çš„ç±»å‹ã€å¤§å°å’Œæ•°æ®æœ¬èº«ï¼Œè¿˜å¤–åŠ æŒ‡å‘å‰ä¸€ä¸ªå’Œåä¸€ä¸ªæ•°æ®å—çš„æŒ‡é’ˆã€‚</p><p>æ•°æ®å—ç±»å‹ï¼šä¸åŒå­˜å‚¨å—åœ¨å†…å­˜ä½¿ç”¨ä¸Šæ²¡æœ‰ä¸åŒ</p><ul><li>å­˜å‚¨æŸ¥è¯¢ç»“æœ</li><li>å­˜å‚¨æŸ¥è¯¢å’Œæ•°æ®è¡¨çš„æ˜ å°„</li><li>å­˜å‚¨æŸ¥è¯¢æ–‡æœ¬</li></ul><p>ä½¿ç”¨æµç¨‹ï¼š</p><ul><li>æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå…ˆåˆå§‹åŒ–æŸ¥è¯¢ç¼“å­˜éœ€è¦çš„å†…å­˜ï¼Œå†…å­˜æ± åˆå§‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç©ºé—²å—ã€‚ç©ºé—²å—çš„å¤§å°å°±æ˜¯æ‰€é…ç½®æŸ¥è¯¢ç¼“å­˜å¤§å°å†å‡å»ç”¨äºç»´æŠ¤å…ƒæ•°æ®çš„æ•°æ®ç»“æ„æ‰€æ¶ˆè€—çš„ç©ºé—´ã€‚</li><li>å½“æœ‰æŸ¥è¯¢ç»“æœéœ€è¦ç¼“å­˜æ—¶ï¼ŒMySQLå…ˆä»å¤§çš„ç©ºé—´å—ä¸­ç”³è¯·ä¸€ä¸ªæ•°æ®å—ç”¨äºå­˜å‚¨ç»“æœã€‚è¿™ä¸ªæ•°æ®å—éœ€è¦å¤§äºé…ç½® <code>query_cache_min_res_unit</code> ï¼Œå³ä½¿æŸ¥è¯¢ç»“æœè¿œè¿œå°äºæ­¤ã€‚å› ä¸ºéœ€è¦åœ¨æŸ¥è¯¢å¼€å§‹è¿”å›ç»“æœçš„æ—¶å€™å°±åˆ†é…ç©ºé—´ï¼Œæ­¤æ—¶æ˜¯æ— æ³•é¢„çŸ¥æŸ¥è¯¢ç»“æœæœ‰å¤šå¤§ï¼ŒMySQLæ— æ³•ä¸ºæ¯ä¸ªæŸ¥è¯¢ç»“æœç²¾ç¡®åˆ†é…ç©ºé—´ã€‚</li></ul><p>åˆ†é…å†…å­˜å—æ“ä½œå¾ˆæ…¢ï¼Œéœ€è¦å…ˆé”ä½ç©ºé—´å—ï¼Œç„¶åæ‰¾åˆ°åˆé€‚å¤§å°çš„æ•°æ®å—ã€‚å½“éœ€è¦ç¼“å­˜ä¸€ä¸ªæŸ¥è¯¢ç»“æœæ—¶ï¼ŒMySQLå…ˆé€‰æ‹©ä¸€ä¸ªå°½å¯èƒ½å°çš„å†…å­˜å—ï¼Œç„¶åå°†ç»“æœå­˜å…¥å…¶ä¸­ã€‚å¦‚æœæ•°æ®å—å…¨éƒ¨ç”¨å®Œï¼Œä½†ä»æœ‰æ•°æ®éœ€è¦å­˜å‚¨ï¼ŒMySQLä¼šç”³è¯·ä¸€å—æ–°æ•°æ®å—ï¼ˆå°½é‡å°ï¼‰ã€‚æŸ¥è¯¢å®Œæˆåæœ‰å‰©ä½™ä¼šè¢«é‡Šæ”¾ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210201/202102010102.png" alt></p><p>ä¸Šè¿°åˆ†é…å†…å­˜å—å¹¶éæŒ‡<strong>é€šè¿‡å‡½æ•° <code>malloc()</code> å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜</strong>ï¼Œæ­¤æ“ä½œåªåœ¨åˆæ¬¡åˆ›å»ºæŸ¥è¯¢ç¼“å­˜æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚æŒ‡çš„æ˜¯åœ¨ç©ºé—²å—åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„å†…å­˜å—ï¼Œæˆ–è€…ä»æ­£åœ¨ä½¿ç”¨çš„ã€å¾…æ·˜æ±°çš„å†…å­˜å—ä¸­å›æ”¶å†ä½¿ç”¨ï¼ˆMySQLè‡ªå·±ç®¡ç†å†…å­˜ï¼‰ã€‚</p><p>å‡è®¾å¹³å‡æŸ¥è¯¢ç»“æœå¾ˆå°ï¼ŒæœåŠ¡å™¨åœ¨å¹¶å‘åœ°å‘ä¸åŒçš„ä¸¤ä¸ªè¿æ¥è¿”å›ç»“æœï¼Œè¿”å›ç»“æœåMySQLå›æ”¶å‰©ä½™æ•°æ®å—ç©ºé—´æ—¶ä¼šå‘ç°ï¼Œå›æ”¶çš„æ•°æ®å—å°äº <code>query_cache_min_res_unit</code> ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥åœ¨åç»­çš„å†…å­˜å—ä¸­åˆ†é…ä½¿ç”¨ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210201/202102010103.png" alt></p><h3 id="12-6-é€‚ç”¨åœºæ™¯"><a href="#12-6-é€‚ç”¨åœºæ™¯" class="headerlink" title="12.6 é€‚ç”¨åœºæ™¯"></a>12.6 é€‚ç”¨åœºæ™¯</h3><p>ç†è®ºä¸Šå¯ä»¥é€šè¿‡å¯¹æ¯”æ‰“å¼€å’Œå…³é—­æŸ¥è¯¢ç¼“å­˜çš„ç³»ç»Ÿæ•ˆç‡æ¥åˆ¤æ–­ï¼šå…³é—­æŸ¥è¯¢ç¼“å­˜æ—¶ï¼Œæ¯ä¸ªæŸ¥è¯¢éƒ½éœ€è¦å®Œæ•´çš„æ‰§è¡Œï¼Œæ¯æ¬¡å†™æ“ä½œæ‰§è¡Œå®Œæˆåç«‹åˆ»è¿”å›ï¼›æ‰“å¼€æŸ¥è¯¢ç¼“å­˜æ—¶ï¼Œæ¯æ¬¡è¯»è¯·æ±‚å…ˆæ£€æŸ¥ç¼“å­˜æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœå‘½ä¸­åˆ™ç«‹åˆ»è¿”å›ï¼Œå¦åˆ™å°±å®Œæ•´åœ°æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ¯æ¬¡å†™æ“ä½œåˆ™éœ€è¦æ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰éœ€è¦å¤±æ•ˆçš„ç¼“å­˜ï¼Œç„¶åå†è¿”å›ã€‚</p><p>å¯¹äºä¸€äº›éœ€è¦æ¶ˆè€—å¤§é‡èµ„æºçš„æŸ¥è¯¢é€šå¸¸éƒ½é€‚åˆä½¿ç”¨ç¼“å­˜ï¼Œå¦‚æ±‡æ€»è®¡ç®—æŸ¥è¯¢ <code>COUNT()</code> ï¼›è¾ƒä¸ºå¤æ‚çš„SELECTè¯­å¥ï¼Œå¦‚å¤šè¡¨JOINåè¿˜éœ€è¦åšæ’åºå’Œåˆ†é¡µï¼Œæ­¤ç±»æŸ¥è¯¢æ¯æ¬¡æ‰§è¡Œæ¶ˆè€—éƒ½å¾ˆå¤§ï¼Œä½†è¿”å›ç»“æœé›†å¾ˆå°ï¼Œéå¸¸é€‚åˆæŸ¥è¯¢ç¼“å­˜ï¼ˆUPDATEã€DELETE å’Œ INSERT æ“ä½œè¦å æ¯”å°ï¼‰ã€‚</p><p>ä¸€ä¸ªåˆ¤æ–­æŸ¥è¯¢ç¼“å­˜æ˜¯å¦æœ‰æ•ˆçš„ç›´æ¥æ•°æ®æ˜¯å‘½ä¸­ç‡ï¼Œå³ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜è¿”å›ç»“æœå æ€»æŸ¥è¯¢çš„æ¯”ç‡ã€‚å½“MySQLæ¥æ”¶åˆ°ä¸€ä¸ªSELECTæŸ¥è¯¢æ—¶ï¼Œè¦ä¹ˆå¢åŠ  <code>Qcache_hits</code> çš„å€¼ï¼Œè¦ä¹ˆå¢åŠ  <code>Com_select</code> çš„å€¼ã€‚è®¡ç®—æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ï¼š <code>Qcache_hits / ( Qcache_hits + Com_select )</code> ã€‚å‘½ä¸­ç‡å¤šå¤§æ‰åˆé€‚å¾ˆéš¾åˆ¤æ–­ï¼Œæœ‰æ—¶å³ä½¿å¾ˆä½çš„å‘½ä¸­ç‡å¯¹äºæ€§èƒ½æå‡ä¹Ÿæœ‰å¥½å¤„ã€‚</p><p>ç¼“å­˜æœªå‘½ä¸­çš„å‡ ç§å¯èƒ½ï¼š</p><ul><li>æŸ¥è¯¢è¯­å¥æ— æ³•è¢«ç¼“å­˜ï¼Œå¦‚åŒ…å«ä¸ç¡®å®šçš„å‡½æ•°ã€æŸ¥è¯¢ç»“æœå¤ªå¤§è€Œæ— æ³•ç¼“å­˜ï¼Œéƒ½ä¼šå¯¼è‡´çŠ¶æ€å€¼ <code>Qcache_not_cached</code> å¢åŠ ã€‚</li><li>MySQLä»æœªå¤„ç†è¿™ä¸ªæŸ¥è¯¢ï¼Œæ‰€ä»¥ç»“æœä¹Ÿä¸æ›¾è¢«ç¼“å­˜è¿‡ã€‚</li><li>è™½ç„¶ç¼“å­˜äº†ç»“æœï¼Œä½†ç”±äºæŸ¥è¯¢ç¼“å­˜çš„å†…å­˜ç”¨å®Œï¼Œéœ€è¦å°†æŸäº›ç¼“å­˜ç§»é™¤ï¼›æˆ–æ˜¯æ•°æ®è¡¨è¢«ä¿®æ”¹å¯¼è‡´ç¼“å­˜å¤±æ•ˆã€‚</li><li>å¤§é‡ç¼“å­˜æœªå‘½ä¸­ï¼Œä½†å®é™…ä¸Šç»å¤§æ•°æŸ¥è¯¢éƒ½ç¼“å­˜äº†ï¼š<ul><li>æŸ¥è¯¢ç¼“å­˜è¿˜æœªå®Œæˆé¢„çƒ­ï¼›</li><li>æŸ¥è¯¢è¯­å¥ä¹‹å‰ä»æœªæ‰§è¡Œï¼Œè‹¥åº”ç”¨ä¸ä¼šé‡å¤æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼Œå³ä½¿å®Œæˆé¢„çƒ­ä»ä¼šæœ‰å¾ˆå¤šç¼“å­˜æœªå‘½ä¸­ï¼›</li><li>ç¼“å­˜å¤±æ•ˆæ“ä½œè¿‡å¤šã€‚</li></ul></li></ul><p>å‡ ç§æ£€æŸ¥æ–¹æ¡ˆï¼š</p><ul><li>é€šè¿‡å‚æ•° <code>Com_*</code> æ¥æŸ¥çœ‹æ•°æ®ä¿®æ”¹çš„æƒ…å†µï¼ŒåŒ…æ‹¬ Com_updateï¼ŒCom_deleteç­‰ã€‚</li><li>é€šè¿‡ <code>Qcache_lowmem_prunes</code> æ¥æŸ¥çœ‹æœ‰å¤šå°‘æ¬¡å¤±æ•ˆæ˜¯ç”±äºå†…å­˜ä¸è¶³å¯¼è‡´çš„ã€‚</li><li>é€šè¿‡æŸ¥çœ‹ <code>Com_select</code> å’Œ <code>Qcache_inserts</code> çš„ç›¸å¯¹å€¼æ¥æŸ¥çœ‹æ˜¯å¦ç¼“å­˜ç»“æœæœªè¢«å…¶ä»–SELECTè¯­å¥ä½¿ç”¨ã€‚å¦‚æœæ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯ç¼“å­˜æœªå‘½ä¸­ï¼Œç„¶åéœ€è¦å°†æŸ¥è¯¢ç»“æœæ”¾åˆ°ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆäºŒè€…å€¼åº”è¯¥ç›¸å½“ï¼Œæ‰€ä»¥æœŸæœ›çš„æƒ…å†µåº”è¯¥æ˜¯ <code>Qcache_inserts</code> è¿œè¿œå°äº <code>Com_select</code> ã€‚</li><li>æ›´ç›´è§‚çš„æ–¹æ¡ˆï¼šå‘½ä¸­å’Œå†™å…¥çš„æ¯”ç‡ï¼Œå³ <code>Qcache_hits</code> å’Œ <code>Qcache_inserts</code> çš„æ¯”å€¼ï¼Œå½“ç»“æœå¤§äº3 : 1æ—¶ä¸€èˆ¬è¡¨ç¤ºç¼“å­˜æ˜¯æœ‰æ•ˆçš„ï¼Œæœ€å¥½æ˜¯èƒ½è¾¾åˆ°10 : 1ã€‚</li></ul><h3 id="12-7-é…ç½®å’Œç»´æŠ¤"><a href="#12-7-é…ç½®å’Œç»´æŠ¤" class="headerlink" title="12.7 é…ç½®å’Œç»´æŠ¤"></a>12.7 é…ç½®å’Œç»´æŠ¤</h3><p>é…ç½®å‚æ•°ï¼š</p><ul><li>query_cache_typeï¼šæ˜¯å¦æ‰“å¼€æŸ¥è¯¢ç¼“å­˜ï¼Œæœ‰ OFFã€ONæˆ–DEMANDï¼ŒDEMANDè¡¨ç¤ºåªæœ‰åœ¨æŸ¥è¯¢è¯­å¥ä¸­æ˜ç¡®å†™æ˜SQL_CACHEçš„è¯­å¥æ‰æ”¾å…¥æŸ¥è¯¢ç¼“å­˜ã€‚</li><li>query_cache_sizeï¼šæŸ¥è¯¢ç¼“å­˜ä½¿ç”¨çš„æ€»å†…å­˜ç©ºé—´ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œå¿…é¡»æ˜¯1024çš„æ•´æ•°å€ã€‚</li><li>query_cache_min_res_unitï¼šåœ¨æŸ¥è¯¢ç¼“å­˜ä¸­åˆ†é…å†…å­˜å—æ—¶çš„æœ€å°å•ä½ã€‚</li><li>query_cache_limitï¼šMySQLèƒ½ç¼“å­˜çš„æœ€å¤§æŸ¥è¯¢ç»“æœï¼Œè¶…è¿‡æ­¤å€¼ä¸ä¼šè¢«ç¼“å­˜ï¼Œåªæœ‰ç»“æœå…¨éƒ¨è¿”å›æ—¶æ‰èƒ½çŸ¥é“æ˜¯å¦è¶…å‡ºé™åˆ¶ã€‚</li><li>query_cache_wlock_invalidateï¼šæŸä¸ªè¡¨è¢«å…¶ä»–è¿æ¥é”ä½ï¼Œæ˜¯å¦ä¾ç„¶å¯ä»¥ä»æŸ¥è¯¢ç¼“å­˜ä¸­è¿”å›ç»“æœã€‚</li></ul><p>å¦‚ä½•å‡å°‘ç¢ç‰‡ï¼šæš‚ç•¥ã€‚</p><p>æä¾›æŸ¥è¯¢ç¼“å­˜çš„ä½¿ç”¨ç‡ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210201/202102010104.png" alt></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šé«˜æ€§èƒ½MySQLã€‹</p>]]></content>
    
    <summary type="html">
    
      ã€Šé«˜æ€§èƒ½MySQLã€‹è¯»ä¹¦ç¬”è®°ï¼Œå†…å®¹ï¼šåˆ†åŒºè¡¨ï¼Œè§†å›¾ï¼Œå¤–é”®çº¦æŸï¼Œå†…éƒ¨å­˜å‚¨ä»£ç ï¼Œæ¸¸æ ‡ï¼Œç»‘å®šå˜é‡ï¼Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œå…¨æ–‡ç´¢å¼•ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒæŸ¥è¯¢ç¼“å­˜ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäº”ï¼‰æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</title>
    <link href="http://linyishui.top/2020122901.html"/>
    <id>http://linyishui.top/2020122901.html</id>
    <published>2020-12-29T12:13:34.000Z</published>
    <updated>2021-03-03T13:14:02.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäº”ï¼‰æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"><a href="#ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäº”ï¼‰æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäº”ï¼‰æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–"></a>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäº”ï¼‰æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</h1><p>æŸ¥è¯¢ä¼˜åŒ–ã€ç´¢å¼•ä¼˜åŒ–ã€åº“è¡¨ç»“æ„ä¼˜åŒ–éœ€è¦é½å¤´å¹¶è¿›ã€‚</p><h2 id="ä¸€-ä¸ºä»€ä¹ˆæŸ¥è¯¢é€Ÿåº¦ä¼šæ…¢"><a href="#ä¸€-ä¸ºä»€ä¹ˆæŸ¥è¯¢é€Ÿåº¦ä¼šæ…¢" class="headerlink" title="ä¸€. ä¸ºä»€ä¹ˆæŸ¥è¯¢é€Ÿåº¦ä¼šæ…¢"></a>ä¸€. ä¸ºä»€ä¹ˆæŸ¥è¯¢é€Ÿåº¦ä¼šæ…¢</h2><p>æŸ¥è¯¢æ˜¯ä¸€é¡¹ä»»åŠ¡ï¼Œç”±ä¸€ç³»åˆ—å­ä»»åŠ¡ç»„æˆï¼Œæ¯ä¸ªå­ä»»åŠ¡éƒ½è¦æ¶ˆè€—ä¸€å®šæ—¶é—´ï¼Œä¼˜åŒ–æŸ¥è¯¢å°±æ˜¯è¦ä¹ˆæ¶ˆé™¤ä¸€éƒ¨åˆ†å­ä»»åŠ¡ã€è¦ä¹ˆå‡å°‘å­ä»»åŠ¡çš„æ‰§è¡Œæ¬¡æ•°ã€è¦ä¹ˆæä¾›å­ä»»åŠ¡çš„æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>æŸ¥è¯¢çš„ç”Ÿå‘½å‘¨æœŸå¤§è‡´åŒ…æ‹¬ï¼šä»å®¢æˆ·ç«¯ã€åˆ°æœåŠ¡å™¨ã€æœåŠ¡å™¨è¿›è¡Œè§£æã€ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€æ‰§è¡Œã€è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚å…¶ä¸­æ‰§è¡Œæ˜¯æœ€é‡è¦çš„é˜¶æ®µï¼ŒåŒ…æ‹¬å¤§é‡æ£€ç´¢æ•°æ®åˆ°å­˜å‚¨å¼•æ“ä»¥åŠåç»­æ•°æ®å¤„ç†ï¼Œå¦‚æ’åºã€åˆ†ç»„ç­‰ã€‚</p><p>æŸ¥è¯¢ä¼šåœ¨å¦‚ç½‘ç»œã€CPUè®¡ç®—ã€ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯å’Œæ‰§è¡Œè®¡åˆ’ã€é”ç­‰å¾…ï¼ˆäº’æ–¥ç­‰å¾…ï¼‰ç­‰æ“ä½œä¸ŠèŠ±è´¹æ—¶é—´ã€‚æ…¢æŸ¥è¯¢æ™®ééƒ½ä¼šå­˜åœ¨å¦‚æ“ä½œè¢«é¢å¤–çš„é‡å¤æ‰§è¡Œäº†å¤šæ¬¡ã€æŸäº›æ“ä½œæ‰§è¡Œçš„å¤ªæ…¢ç­‰é—®é¢˜ã€‚</p><h2 id="äºŒ-ä¼˜åŒ–æ•°æ®è®¿é—®"><a href="#äºŒ-ä¼˜åŒ–æ•°æ®è®¿é—®" class="headerlink" title="äºŒ. ä¼˜åŒ–æ•°æ®è®¿é—®"></a>äºŒ. ä¼˜åŒ–æ•°æ®è®¿é—®</h2><p>å¤§éƒ¨åˆ†æ€§èƒ½ä½ä¸‹çš„æŸ¥è¯¢éƒ½å¯ä»¥é€šè¿‡å‡å°‘è®¿é—®çš„æ•°æ®é‡æ¥ä¼˜åŒ–ï¼š</p><ol><li>æ£€æŸ¥æ˜¯å¦è®¿é—®äº†å¤ªå¤šçš„è¡Œæˆ–åˆ—ï¼›</li><li>ç¡®è®¤MySQLæœåŠ¡å™¨å±‚æ˜¯å¦åœ¨åˆ†æå¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®è¡Œã€‚</li></ol><h3 id="2-1-æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®"><a href="#2-1-æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®" class="headerlink" title="2.1 æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®"></a>2.1 æ˜¯å¦å‘æ•°æ®åº“è¯·æ±‚äº†ä¸éœ€è¦çš„æ•°æ®</h3><ul><li><strong>æŸ¥è¯¢ä¸éœ€è¦çš„è®°å½•</strong>ï¼šæ¯”å¦‚æŸ¥è¯¢å¤§é‡æ•°æ®åï¼Œå†ä»…æ˜¾ç¤ºå‰é¢Nè¡Œã€‚æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯æŸ¥è¯¢åŠ LIMITã€‚</li><li><strong>å¤šè¡¨å…³è”æ—¶è¿”å›å…¨éƒ¨åˆ—</strong>ï¼šæ¯”å¦‚ SELECT <em> FROM A JOIN B JOIN C ï¼Œå®é™…ä¸Šä»…éœ€è¦Aè¡¨çš„åˆ—ï¼Œæ”¹ä¸º SELECT A.</em> æœ€å¥½æ˜ç¡®æŒ‡å®šæ¯ä¸ªè¿”å›åˆ—ã€‚</li><li><strong>æ€»æ˜¯å–å‡ºå…¨éƒ¨åˆ—</strong>ï¼šæ¯æ¬¡ä½¿ç”¨ <code>SELECT *</code> æ—¶éƒ½è¦ä»”ç»†æ€è€ƒæ˜¯å¦éœ€è¦å…¨éƒ¨åˆ—ï¼Œæœ‰æ—¶DBAä¼šç¦æ­¢ç±»ä¼¼å†™æ³•ã€‚</li><li><strong>é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®</strong>ï¼šæ¯”å¦‚ç”¨æˆ·è¯„è®ºæ—¶è¦è·å–å¤´åƒURLï¼Œå¯ä»¥è€ƒè™‘ç¼“å­˜è¿™ç±»æ•°æ®ï¼Œé¿å…æ¯æ¬¡éƒ½è¦é‡å¤æŸ¥è¯¢ã€‚</li></ul><h3 id="2-2-æ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•"><a href="#2-2-æ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•" class="headerlink" title="2.2 æ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•"></a>2.2 æ˜¯å¦åœ¨æ‰«æé¢å¤–çš„è®°å½•</h3><p>è¡¡é‡æŸ¥è¯¢å¼€é”€çš„ä¸‰ä¸ªæŒ‡æ ‡ï¼šæ…¢æŸ¥è¯¢æ—¥å¿—åŒ…å«è¿™ä¸‰é¡¹å†…å®¹</p><ul><li><strong>å“åº”æ—¶é—´</strong>ï¼šæœåŠ¡æ—¶é—´+æ’é˜Ÿæ—¶é—´ï¼Œä½†å®é™…æµ‹é‡å¾€å¾€æ— æ³•åŒºåˆ†äºŒè€…ï¼›</li><li><strong>æ‰«æçš„è¡Œæ•°</strong>ï¼šEXPLAINçš„typeåˆ—ååº”äº†è®¿é—®ç±»å‹ï¼Œå¦‚å…¨è¡¨æ‰«æã€ç´¢å¼•æ‰«æã€èŒƒå›´æ‰«æã€å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ã€å¸¸æ•°å¼•ç”¨ç­‰ï¼Œé€Ÿåº¦ç”±æ…¢è‡³å¿«ï¼Œæ‰«æè¡Œæ•°ç”±å¤šåˆ°å°‘ï¼›è®¿é—®ç±»å‹ä¸å¤Ÿåˆé€‚æ—¶ï¼Œæœ€å¥½åˆ›å»ºä¸€ä¸ªåˆé€‚çš„ç´¢å¼•ï¼›<strong>MySQLä¸ä¼šè¿”å›çœŸå®çš„æ‰«æè¡Œæ•°ï¼Œåªä¼šå‘ŠçŸ¥ç”Ÿæˆç»“æœæ—¶ä¸€å…±æ‰«æäº†å¤šå°‘è¡Œï¼Œä½†å¯èƒ½å¤§éƒ¨åˆ†è¡Œæ˜¯è¢«WHEREæ¡ä»¶è¿‡æ»¤</strong>ï¼›</li><li><strong>è¿”å›çš„è¡Œæ•°</strong>ï¼šæ‰«æçš„è¡Œæ•°å’Œè¿”å›è¡Œæ•°çš„æ¯”å€¼é€šå¸¸åº”è¯¥å¾ˆå°ï¼Œä»‹äº1:1å’Œ1:10ä¹‹é—´ï¼Œå½“ç„¶æœ‰æ—¶ä¹Ÿä¼šå¾ˆå¤§ï¼ˆæ¯”å¦‚åˆ†ç»„ç»Ÿè®¡æŸ¥è¯¢ï¼‰ã€‚</li></ul><p>EXPLAINçš„ Using where è¡¨ç¤ºMySQLå°†é€šè¿‡WHEREæ¡ä»¶ç­›é€‰å­˜å‚¨å¼•æ“è¿”å›çš„è®°å½•ï¼ŒMySQLåº”ç”¨Whereæ¡ä»¶æœ‰ä¸‰ç§æ–¹å¼ï¼Œç”±å¥½åˆ°åä¾æ¬¡æ˜¯ï¼š</p><ol><li>åœ¨ç´¢å¼•ä¸­ä½¿ç”¨WHEREæ¡ä»¶æ¥è¿‡æ»¤ä¸åŒ¹é…çš„è®°å½•ï¼Œåœ¨å­˜å‚¨å¼•æ“å±‚å®Œæˆã€‚</li><li>ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼ˆExtraåˆ—å‡ºç°Using indexï¼‰è¿”å›è®°å½•ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è¿‡æ»¤ä¸éœ€è¦çš„è®°å½•å¹¶è¿”å›å‘½ä¸­çš„ç»“æœï¼Œåœ¨æœåŠ¡å™¨å±‚å®Œæˆï¼Œä½†æ— éœ€å›è¡¨æŸ¥è¯¢è®°å½•ã€‚</li><li>ä»æ•°æ®è¡¨è¿”å›æ•°æ®ï¼Œè¿‡æ»¤ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼ˆExtraåˆ—å‡ºç°Using whereï¼‰ï¼Œåœ¨æœåŠ¡å™¨å±‚å®Œæˆï¼Œéœ€è¦å…ˆä»æ•°æ®è¡¨è¯»å‡ºè®°å½•ç„¶åè¿‡æ»¤ã€‚</li></ol><p>æ‰«æè¡Œæ•°è¿œè¿œå¤§äºè¿”å›è¡Œæ•°ï¼Œéœ€è¦ä¼˜åŒ–ï¼š</p><ul><li>ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æã€‚</li><li>æ”¹å˜åº“è¡¨ç»“æ„ï¼Œå¦‚ä½¿ç”¨å•ç‹¬çš„æ±‡æ€»è¡¨ã€‚</li><li>é‡å†™å¤æ‚æŸ¥è¯¢ï¼Œè®©MySQLä¼˜åŒ–å™¨å¯ä»¥ä»¥æ›´ä¼˜åŒ–çš„æ–¹å¼æ‰§è¡Œã€‚</li></ul><h3 id="2-3-é‡æ„æŸ¥è¯¢çš„æ–¹å¼"><a href="#2-3-é‡æ„æŸ¥è¯¢çš„æ–¹å¼" class="headerlink" title="2.3 é‡æ„æŸ¥è¯¢çš„æ–¹å¼"></a>2.3 é‡æ„æŸ¥è¯¢çš„æ–¹å¼</h3><h4 id="2-3-1-åˆ¤æ–­ä¸€ä¸ªå¤æ‚æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•æŸ¥è¯¢"><a href="#2-3-1-åˆ¤æ–­ä¸€ä¸ªå¤æ‚æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•æŸ¥è¯¢" class="headerlink" title="2.3.1 åˆ¤æ–­ä¸€ä¸ªå¤æ‚æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•æŸ¥è¯¢"></a>2.3.1 åˆ¤æ–­ä¸€ä¸ªå¤æ‚æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•æŸ¥è¯¢</h4><p>è®¾è®¡æŸ¥è¯¢æ—¶éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šæ˜¯å¦éœ€è¦å°†ä¸€ä¸ªå¤æ‚æŸ¥è¯¢æ‹†åˆ†ä¸ºå¤šä¸ªç®€å•æŸ¥è¯¢ï¼Ÿæˆ‘ä»¬æ™®éä¼šé€‰æ‹©è®©æ•°æ®åº“å°½å¯èƒ½çš„å®Œæˆæ›´å¤šçš„å·¥ä½œï¼Œå› ä¸ºä¸‹æ„è¯†ä¼šè®¤ä¸ºç½‘ç»œé€šä¿¡ã€æŸ¥è¯¢è§£æå’Œä¼˜åŒ–æ˜¯ä¸€ä»¶ä»£ä»·å¾ˆé«˜çš„äº‹æƒ…ã€‚</p><p>ä½†å¯¹äºMySQLæ¥è¯´ï¼Œè¿™ç§å¸¸è¯†æ˜¯ä¸å‡†ç¡®çš„ï¼š</p><ol><li>MySQLçš„è¿æ¥å’Œæ–­å¼€éƒ½å¾ˆè½»é‡ï¼›</li><li>ç°ä»£ç½‘ç»œé€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œæ— è®ºæ˜¯å¸¦å®½è¿˜æ˜¯å»¶è¿Ÿï¼›</li><li>MySQLæ¯ç§’èƒ½åœ¨å†…å­˜æ‰«æä¸Šç™¾ä¸‡è¡Œæ•°æ®ï¼Œç›¸æ¯”ä¸‹å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯è¦æ…¢å¾ˆå¤šï¼Œå…¶ä»–æ¡ä»¶ä¸å˜çš„æƒ…å†µä¸‹è¶Šå°‘æŸ¥è¯¢æ˜¯æ›´å¥½ï¼›</li><li>ä¸€äº›æƒ…å†µä¸‹åˆ‡ä¸ºå°æŸ¥è¯¢èƒ½å‡å°‘å·¥ä½œé‡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¸¦æ¥æ•´ä½“æ€§èƒ½çš„æå‡ï¼Œå°äº‹åŠ¡ç»å¸¸èƒ½æ›´é«˜æ•ˆï¼Œå¹¶ä¸”è‹¥ä¸­é—´æš‚åœä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå¯ä»¥æŠŠä¸€æ¬¡æ€§çš„å‹åŠ›åˆ†æ•£åˆ°å¤§çš„æ—¶é—´æ®µï¼Œé™ä½å¯¹æœåŠ¡å™¨çš„å½±å“å’Œé”çš„æŒæœ‰æ—¶é—´ã€‚</li></ol><h4 id="2-3-2-åˆ‡åˆ†æŸ¥è¯¢"><a href="#2-3-2-åˆ‡åˆ†æŸ¥è¯¢" class="headerlink" title="2.3.2 åˆ‡åˆ†æŸ¥è¯¢"></a>2.3.2 åˆ‡åˆ†æŸ¥è¯¢</h4><p>æœ€å¸¸è§çš„æ¡ˆä¾‹ï¼Œæ¯”å¦‚è¦<strong>å®šæœŸæ¸…é™¤å¤§é‡æ•°æ®</strong>ï¼Œå¦‚æœä¸€ä¸ªè¯­å¥ä¸€æ¬¡å®Œæˆå¯èƒ½ä¼šé”ä½å¾ˆå¤šæ•°æ®ã€å æ»¡æ•´ä¸ªäº‹åŠ¡æ—¥å¿—ã€æ¶ˆè€—è¿‡å¤šç³»ç»Ÿèµ„æºã€é˜»å¡å¾ˆå¤šå°ä½†é‡è¦çš„æŸ¥è¯¢ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯ä¸€ä¸‡è¡Œåˆ é™¤ä¸€æ¬¡</span></span><br><span class="line">rows_affected = <span class="number">0</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">rows_affected = do_query(<span class="string">"DELETE FROM messages WHERE created &lt; DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000"</span>)</span><br><span class="line">&#125; <span class="keyword">while</span> rows_affected &gt; <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="2-3-3-åˆ†è§£å…³è”æŸ¥è¯¢"><a href="#2-3-3-åˆ†è§£å…³è”æŸ¥è¯¢" class="headerlink" title="2.3.3 åˆ†è§£å…³è”æŸ¥è¯¢"></a>2.3.3 åˆ†è§£å…³è”æŸ¥è¯¢</h4><p><strong>å¯¹æ¯ä¸ªè¡¨è¿›è¡Œä¸€æ¬¡å•è¡¨æŸ¥è¯¢ï¼Œåœ¨åº”ç”¨å±‚å¯¹ç»“æœè¿›è¡Œå…³è”</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--å…³è”æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> tag</span><br><span class="line"><span class="keyword">JOIN</span> tag_post</span><br><span class="line"><span class="keyword">ON</span> tag_post.tag_id = tag.tag_id</span><br><span class="line"><span class="keyword">JOIN</span> post</span><br><span class="line"><span class="keyword">ON</span> tag_post.post_id = post.post_id</span><br><span class="line"><span class="keyword">WHERE</span> tag.tag = <span class="string">'mysql'</span>;</span><br><span class="line"><span class="comment">--åˆ†è§£ä¸ºä¸‰æ¬¡å•è¡¨æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tag <span class="keyword">WHERE</span> tag = <span class="string">'mysql'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tag_post <span class="keyword">WHERE</span> tag_id = <span class="number">1234</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> post <span class="keyword">WHERE</span> post_id <span class="keyword">IN</span> (<span class="number">123</span>,<span class="number">456</span>,<span class="number">567</span>,<span class="number">9098</span>,<span class="number">8904</span>);</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>è®©ç¼“å­˜æ•ˆç‡æ›´é«˜ï¼Œå•è¡¨ç»“æœæ–¹ä¾¿è¿›è¡Œç¼“å­˜ï¼Œå·²ç¼“å­˜çš„æ•°æ®ä¸‹æ¬¡å°±å¯ä»¥è·³è¿‡ï¼›å…³è”çš„è¡¨å‘ç”Ÿå˜åŒ–ä¼šä½¿MySQLæŸ¥è¯¢ç¼“å­˜å¤±æ•ˆï¼›</li><li>æŸ¥è¯¢åˆ†è§£åå¯ä»¥å‡å°‘é”çš„ç«äº‰ï¼›</li><li>åº”ç”¨å±‚åšå…³è”æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œæ–¹ä¾¿é«˜æ€§èƒ½å’Œå¯æ‰©å±•ï¼›</li><li>æŸ¥è¯¢æ•ˆç‡æœ¬èº«ä¹Ÿæœ‰æå‡ï¼Œä¸Šè¿°ä¾‹å­ä½¿ç”¨ <code>IN()</code> ä»£æ›¿å…³è”æŸ¥è¯¢å¯ä»¥ä½¿MySQLæŒ‰ç…§IDé¡ºåºæŸ¥è¯¢ï¼Œè¦æ¯”éšæœºå…³è”é«˜æ•ˆã€‚</li><li>å‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ï¼Œåœ¨åº”ç”¨å±‚åšå…³è”æ„å‘³ç€æŸæ¡è®°å½•åªéœ€æŸ¥è¯¢ä¸€æ¬¡ï¼Œè€Œåœ¨æ•°æ®åº“å…³è”æŸ¥è¯¢å¯èƒ½éœ€è¦é‡å¤çš„è®¿é—®ä¸€éƒ¨åˆ†æ•°æ®ã€‚</li></ul><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>åº”ç”¨æ–¹ä¾¿ç¼“å­˜å•ä¸ªæŸ¥è¯¢çš„ç»“æœæ—¶ï¼›</li><li>å¯ä»¥å°†æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒçš„MySQLæœåŠ¡å™¨æ—¶ï¼›</li><li>èƒ½å¤Ÿä½¿ç”¨ <code>IN()</code> ä»£æ›¿å…³è”æŸ¥è¯¢æ—¶ï¼›</li><li>å½“æŸ¥è¯¢ä¸­ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®è¡¨æ—¶ã€‚</li></ul><h2 id="ä¸‰-æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€"><a href="#ä¸‰-æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€" class="headerlink" title="ä¸‰. æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€"></a>ä¸‰. æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€</h2><h3 id="3-1-ä¸€ä¸ªæŸ¥è¯¢åœ¨MySQLä¸­çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#3-1-ä¸€ä¸ªæŸ¥è¯¢åœ¨MySQLä¸­çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="3.1 ä¸€ä¸ªæŸ¥è¯¢åœ¨MySQLä¸­çš„æ‰§è¡Œè¿‡ç¨‹"></a>3.1 ä¸€ä¸ªæŸ¥è¯¢åœ¨MySQLä¸­çš„æ‰§è¡Œè¿‡ç¨‹</h3><p>MySQLæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢çš„è¿‡ç¨‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012280108.png" alt></p><ol><li>å®¢æˆ·ç«¯å‘é€ä¸€æ¡æŸ¥è¯¢ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨å…ˆæ£€æŸ¥ç¼“å­˜ï¼Œè‹¥å‘½ä¸­ç¼“å­˜å°±ç«‹å³è¿”å›ç»“æœã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</li><li>æœåŠ¡å™¨è¿›è¡ŒSQLè§£æã€é¢„å¤„ç†ï¼Œå†ç”±ä¼˜åŒ–å™¨ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ã€‚</li><li>æ ¹æ®æ‰§è¡Œè®¡åˆ’è°ƒç”¨å­˜å‚¨å¼•æ“çš„APIæ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚</li><li>å°†ç»“æœè¿”å›å®¢æˆ·ç«¯ã€‚</li></ol><h3 id="3-2-MySQL-å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡åè®®"><a href="#3-2-MySQL-å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡åè®®" class="headerlink" title="3.2 MySQL å®¢æˆ·ç«¯ / æœåŠ¡å™¨é€šä¿¡åè®®"></a>3.2 MySQL å®¢æˆ·ç«¯ / æœåŠ¡å™¨é€šä¿¡åè®®</h3><p>MySQL å®¢æˆ·ç«¯ / æœåŠ¡å™¨é€šä¿¡åè®®æ˜¯<strong>åŠåŒå·¥åè®®</strong>ï¼Œå³è¦ä¹ˆæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€è¦ä¹ˆå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œä¸¤ä¸ªåŠ¨ä½œä¸èƒ½åŒæ—¶å‘ç”Ÿã€‚</p><p>ä¼˜ç‚¹æ˜¯é€šä¿¡ç®€å•å¿«é€Ÿï¼Œç¼ºç‚¹æ˜¯æ— æ³•è¿›è¡Œæµé‡æ§åˆ¶ã€‚ä¸€æ–¹ä¸€æ—¦å¼€å§‹å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹åªèƒ½æ¥æ”¶å®Œæ•´æ¶ˆæ¯åæ‰èƒ½è¿›è¡Œå“åº”ã€‚ä¸€æ–¹ä¸èƒ½ä½¿å¦ä¸€æ–¹åœæ­¢ï¼ŒMySQLä¸€èˆ¬è¦ç­‰æ‰€æœ‰æ•°æ®éƒ½å‘é€ç»™å®¢æˆ·ç«¯åæ‰èƒ½é‡Šæ”¾æŸ¥è¯¢æ‰€å ç”¨çš„èµ„æºï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ç¼“å­˜æ•°æ®å¯ä»¥å‡è½»æœåŠ¡å™¨å‹åŠ›ï¼Œè®©æŸ¥è¯¢å°½å¿«ç»“æŸæ—©ç‚¹é‡Šæ”¾èµ„æºã€‚</p><p>æŸ¥çœ‹MySQLè¿æ¥/çº¿ç¨‹çš„çŠ¶æ€ï¼š<code>SHOW FULL PROCESSLIST</code> </p><ul><li>Sleepï¼šçº¿ç¨‹æ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ–°çš„è¯·æ±‚ã€‚</li><li>Queryï¼šçº¿ç¨‹æ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢æˆ–æ­£åœ¨å°†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>Lockedï¼šåœ¨MySQLæœåŠ¡å™¨å±‚ï¼Œè¯¥çº¿ç¨‹æ­£åœ¨ç­‰å¾…è¡¨é”ï¼›å­˜å‚¨å¼•æ“çº§åˆ«çš„é”ï¼ˆå¦‚è¡Œé”ï¼‰ä¸ä¼šä½“ç°åœ¨çº¿ç¨‹çŠ¶æ€ã€‚</li><li>Analyzing and statisticsï¼šçº¿ç¨‹æ­£åœ¨æ”¶é›†å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶ç”ŸæˆæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚</li><li>Copying to tmp table [on disk]ï¼šçº¿ç¨‹æ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†ç»“æœé›†éƒ½å¤åˆ¶åˆ°ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œä¸€èˆ¬æ˜¯åœ¨åšGROUP BYæ“ä½œã€æ–‡ä»¶æ’åºã€UNIONæ“ä½œç­‰ï¼›on diskè¡¨ç¤ºæ­£åœ¨å°†ä¸€ä¸ªå†…å­˜è¡¨æ”¾åˆ°ç£ç›˜ã€‚</li><li>Sorting resultï¼šçº¿ç¨‹æ­£åœ¨å¯¹ç»“æœé›†è¿›è¡Œæ’åºã€‚</li><li>Sending dataï¼šçº¿ç¨‹å¯èƒ½åœ¨å¤šä¸ªçŠ¶æ€é—´ä¼ é€æ•°æ®ã€æˆ–è€…ç”Ÿæˆç»“æœé›†ã€æˆ–è€…åœ¨å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®ã€‚</li></ul><h3 id="3-3-æŸ¥è¯¢ä¼˜åŒ–å¤„ç†"><a href="#3-3-æŸ¥è¯¢ä¼˜åŒ–å¤„ç†" class="headerlink" title="3.3 æŸ¥è¯¢ä¼˜åŒ–å¤„ç†"></a>3.3 æŸ¥è¯¢ä¼˜åŒ–å¤„ç†</h3><p>æŸ¥è¯¢çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¸‹ä¸€æ­¥æ˜¯<strong>å°†ä¸€ä¸ªSQLè½¬æ¢ä¸ºä¸€ä¸ªæ‰§è¡Œè®¡åˆ’</strong>ï¼ŒMySQLæŒ‰ç…§æ‰§è¡Œè®¡åˆ’å’Œå­˜å‚¨å¼•æ“äº¤äº’ï¼š</p><ul><li><strong>è§£æSQL</strong>ï¼šMySQLé€šè¿‡å…³é”®å­—å°†SQLè¯­å¥è¿›è¡Œè§£æï¼Œç”Ÿæˆä¸€æ£µè§£ææ ‘ï¼Œé€šè¿‡MySQLè¯­æ³•è§„åˆ™è¿›è¡ŒéªŒè¯å’Œè§£ææŸ¥è¯¢ï¼ˆå¦‚å…³é”®å­—æ˜¯å¦æ­£ç¡®ã€é¡ºåºæ˜¯å¦æ­£ç¡®ã€å¼•å·å‰åæ˜¯å¦åŒ¹é…ï¼‰ã€‚</li><li><strong>é¢„å¤„ç†</strong>ï¼šæ ¹æ®ä¸€äº›MySQLè§„åˆ™è¿›ä¸€æ­¥æ£€æŸ¥è§£ææ ‘æ˜¯å¦åˆæ³•ï¼ˆæ•°æ®è¡¨å’Œåˆ—æ˜¯å¦å­˜åœ¨ã€åå­—æˆ–åˆ«åæ˜¯å¦æœ‰æ­§ä¹‰ï¼‰ï¼ŒéªŒè¯æƒé™ã€‚</li><li><strong>ä¼˜åŒ–SQLæ‰§è¡Œè®¡åˆ’</strong></li></ul><p><strong>æŸ¥è¯¢ä¼˜åŒ–å™¨</strong>ï¼šMySQLä½¿ç”¨åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ï¼Œé¢„æµ‹ä¸€ä¸ªæŸ¥è¯¢ä½¿ç”¨æŸç§æ‰§è¡Œè®¡åˆ’æ—¶çš„æˆæœ¬å¹¶é€‰æ‹©æœ€å°çš„ä¸€ä¸ªã€‚</p><p>å¯¼è‡´ä¼˜åŒ–å™¨é€‰æ‹©é”™è¯¯æ‰§è¡Œè®¡åˆ’çš„åŸå› ï¼š</p><ul><li>ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®ï¼Œè¯„ä¼°æˆæœ¬ä¾èµ–å­˜å‚¨å¼•æ“æä¾›çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæœ‰æ—¶ä¿¡æ¯çš„åå·®ä¼šå¾ˆå¤§ï¼Œå¦‚MVCCæ¶æ„å¹¶ä¸ç»´æŠ¤æ•°æ®è¡¨è¡Œæ•°çš„ç²¾ç¡®ç»Ÿè®¡ã€‚</li><li>æ‰§è¡Œè®¡åˆ’çš„æˆæœ¬ä¼°ç®—å¹¶ä¸ç­‰ä»·äºå®é™…æ‰§è¡Œçš„æˆæœ¬ï¼Œå¦‚è¯»å–çš„é¡µé¢å¯èƒ½åœ¨å†…å­˜æˆ–ç£ç›˜ï¼Œå…·ä½“è¦å¤šå°‘æ¬¡ç‰©ç†I/Oæ— æ³•å¾—çŸ¥ã€‚</li><li>MySQLçš„æœ€ä¼˜å¹¶ä¸ä¸€å®šæ˜¯æœ€å¿«çš„æ‰§è¡Œæ–¹å¼ï¼Œåªæ˜¯åŸºäºæˆæœ¬æ¨¡å‹çš„æœ€ä¼˜è®¡åˆ’ã€‚</li><li>MySQLå¹¶ä¸è€ƒè™‘å…¶ä»–å¹¶å‘æ‰§è¡Œçš„æŸ¥è¯¢ã€‚</li><li>MySQLå¹¶ä¸è€ƒè™‘ä¸å—æ§åˆ¶çš„æ“ä½œçš„æˆæœ¬ï¼Œå¦‚å­˜å‚¨è¿‡ç¨‹æˆ–è‡ªå®šä¹‰å‡½æ•°ã€‚</li><li>æœ‰äº›ç‰¹æ®Šæƒ…å†µå¹¶ä¸åŸºäºæˆæœ¬é€‰æ‹©ä¼˜åŒ–ï¼Œå¦‚å…¨æ–‡æœç´¢çš„ <code>MATCH()</code> å­å¥ï¼Œå­˜åœ¨å…¨æ–‡ç´¢å¼•å°±ä¼šä½¿ç”¨ï¼Œå³ä½¿æœ‰æ—¶åˆ«çš„ç´¢å¼•å’ŒWHEREæ¡ä»¶ä¼šæ›´å¿«ã€‚</li></ul><p>ä¼˜åŒ–å™¨çš„ä¼˜åŒ–ç­–ç•¥ï¼š</p><ul><li>é™æ€ä¼˜åŒ–ï¼šç›´æ¥å¯¹è§£ææ ‘è¿›è¡Œåˆ†æï¼Œå¹¶å®Œæˆä¼˜åŒ–ã€‚</li><li>åŠ¨æ€ä¼˜åŒ–ï¼šä¸æŸ¥è¯¢çš„ä¸Šä¸‹æ–‡æˆ–å…¶ä»–å› ç´ æœ‰å…³ï¼Œå¦‚WHEREæ¡ä»¶å–å€¼ã€ç´¢å¼•ä¸­æ¡ç›®å¯¹åº”çš„æ•°æ®è¡Œæ•°ç­‰ï¼Œéœ€è¦æ¯æ¬¡æŸ¥è¯¢æ—¶é‡æ–°è¯„ä¼°ã€‚</li></ul><p>èƒ½å¤Ÿä¼˜åŒ–çš„ç±»å‹ï¼š</p><ul><li>é‡æ–°å®šä¹‰å…³è”è¡¨çš„é¡ºåº</li><li>å°†å¤–è¿æ¥è½¬åŒ–ä¸ºå†…è¿æ¥</li><li>ä½¿ç”¨ç­‰ä»·å˜æ¢è§„åˆ™</li><li>ä¼˜åŒ– <code>COUNT()</code> ã€<code>MIN()</code> å’Œ <code>MAX()</code> ï¼Œæ‰¾åˆ°æŸä¸€åˆ—æœ€å°å€¼åªéœ€æŸ¥è¯¢å¯¹åº”B-Treeç´¢å¼•æœ€å·¦ç«¯çš„è®°å½•ï¼Œä½¿ç”¨æ­¤ç±»ä¼˜åŒ–åœ¨EXPLAINä¸­ä¼šå‡ºç° <code>Select tables optimized away</code> è¡¨ç¤ºä¼˜åŒ–å™¨ä»æ‰§è¡Œè®¡åˆ’ä¸­ç§»é™¤è¯¥è¡¨ï¼Œç”¨ä¸€ä¸ªå¸¸æ•°å–ä»£ã€‚</li><li>é¢„ä¼°å¹¶è½¬åŒ–ä¸ºå¸¸æ•°è¡¨è¾¾å¼</li><li>è¦†ç›–ç´¢å¼•æ‰«æ</li><li>å­æŸ¥è¯¢ä¼˜åŒ–</li><li>æå‰ç»ˆæ­¢æŸ¥è¯¢</li><li>ç­‰å€¼ä¼ æ’­</li><li>åˆ—è¡¨ <code>IN()</code> çš„æ¯”è¾ƒ</li></ul><h3 id="3-4-MySQLå¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢"><a href="#3-4-MySQLå¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢" class="headerlink" title="3.4 MySQLå¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢"></a>3.4 MySQLå¦‚ä½•æ‰§è¡Œå…³è”æŸ¥è¯¢</h3><h4 id="3-4-1-MySQLä¸­çš„å…³è”æŸ¥è¯¢"><a href="#3-4-1-MySQLä¸­çš„å…³è”æŸ¥è¯¢" class="headerlink" title="3.4.1 MySQLä¸­çš„å…³è”æŸ¥è¯¢"></a>3.4.1 MySQLä¸­çš„å…³è”æŸ¥è¯¢</h4><p>MySQLä¸­æ¯ä¸ªæŸ¥è¯¢éƒ½æ˜¯ä¸€æ¬¡å…³è”ã€‚æ¯”å¦‚å¯¹äºUNIONæŸ¥è¯¢ï¼ŒMySQLå…ˆå°†ä¸€ç³»åˆ—å•ä¸ªæŸ¥è¯¢çš„ç»“æœæ”¾åœ¨ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œç„¶åå†é‡æ–°è¯»å‡ºä¸´æ—¶è¡¨æ•°æ®å®ŒæˆUNIONæŸ¥è¯¢ã€‚</p><p>MySQLä¸­å…³è”æŸ¥è¯¢æµç¨‹ï¼š</p><ul><li>MySQLå¯¹ä»»ä½•å…³è”éƒ½æ‰§è¡ŒåµŒå¥—å¾ªç¯å…³è”æ“ä½œï¼Œå³MySQLå…ˆåœ¨ä¸€ä¸ªè¡¨ä¸­å¾ªç¯å–å‡ºå•æ¡æ•°æ®ï¼Œç„¶åå†åµŒå¥—å¾ªç¯åˆ°ä¸‹ä¸€ä¸ªè¡¨ä¸­å¯»æ‰¾åŒ¹é…çš„è¡Œï¼Œä¾æ¬¡ä¸‹å»ç›´åˆ°æ‰¾åˆ°æ‰€æœ‰è¡¨ä¸­åŒ¹é…çš„è¡Œä¸ºæ­¢ã€‚</li><li>ç„¶åæ ¹æ®å„ä¸ªè¡¨åŒ¹é…çš„è¡Œï¼Œè¿”å›æŸ¥è¯¢ä¸­éœ€è¦çš„å„ä¸ªåˆ—ã€‚</li><li>MySQLä¼šå°è¯•åœ¨æœ€åä¸€ä¸ªå…³è”è¡¨ä¸­æ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„è¡Œï¼Œå¦‚æœæœ€åä¸€ä¸ªå…³è”è¡¨æ— æ³•æ‰¾åˆ°æ›´å¤šçš„è¡Œï¼Œè¿”å›åˆ°ä¸Šä¸€å±‚å…³è”è¡¨ç»§ç»­æŸ¥æ‰¾æ›´å¤šåŒ¹é…çš„è®°å½•ï¼Œä¾æ¬¡è¿­ä»£æ‰§è¡Œã€‚</li></ul><p>å…³è”æ“ä½œ1å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tab1.col1, tab2.col2</span><br><span class="line"><span class="keyword">FROM</span> tab1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tab2 <span class="keyword">USING</span>(col3)</span><br><span class="line"><span class="keyword">WHERE</span> tab1.col1 <span class="keyword">IN</span>(<span class="number">5</span>, <span class="number">6</span>);</span><br></pre></td></tr></table></figure><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101030101.png" alt></p><p>å…³è”æ“ä½œ2å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tab1.col1, tab2.col2</span><br><span class="line"><span class="keyword">FROM</span> tab1 <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> tab2 <span class="keyword">USING</span>(col3)</span><br><span class="line"><span class="keyword">WHERE</span> tab1.col1 <span class="keyword">IN</span>(<span class="number">5</span>, <span class="number">6</span>);</span><br></pre></td></tr></table></figure><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101030102.png" alt></p><p>å…³è”æ“ä½œ1çš„å†…è¿æ¥ä½¿ç”¨æ³³é“å›¾è¡¨ç¤ºï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101030103.png" alt></p><h4 id="3-4-2-æ‰§è¡Œè®¡åˆ’"><a href="#3-4-2-æ‰§è¡Œè®¡åˆ’" class="headerlink" title="3.4.2 æ‰§è¡Œè®¡åˆ’"></a>3.4.2 æ‰§è¡Œè®¡åˆ’</h4><p>MySQLå¹¶ä¸åƒå…¶ä»–å…³ç³»å‹æ•°æ®åº“é‚£æ ·ç”ŸæˆæŸ¥è¯¢å­—èŠ‚ç æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼Œè€Œæ˜¯<strong>ç”ŸæˆæŸ¥è¯¢çš„ä¸€æ£µæŒ‡ä»¤æ ‘</strong>ï¼Œæœ€ç»ˆçš„æ‰§è¡Œè®¡åˆ’åŒ…å«äº†é‡æ„æŸ¥è¯¢çš„å…¨éƒ¨ä¿¡æ¯ã€‚</p><p>å¯¹æŸä¸ªæŸ¥è¯¢æ‰§è¡Œ <code>EXPLAIN EXTENDED</code> ï¼Œç„¶åå†æ‰§è¡Œ <code>SHOW WARNINGS</code> å¯ä»¥çœ‹åˆ°é‡æ„å‡ºçš„æŸ¥è¯¢ã€‚</p><p>ä»»æ„å¤šè¡¨æŸ¥è¯¢éƒ½å¯ä»¥ä½¿ç”¨ä¸€æ£µæ ‘è¡¨ç¤ºï¼Œå¦‚ä¸‹å›¾ä¸ºä¸€ä¸ªå››è¡¨å…³è”æ“ä½œï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101030104.png" alt></p><p>ä¸Šå›¾è¿™ç§å¹³è¡¡æ ‘å¹¶éMySQLæ‰§è¡ŒæŸ¥è¯¢çš„æ–¹å¼ï¼ŒMySQLæ€»æ˜¯ä»ä¸€ä¸ªè¡¨å¼€å§‹åµŒå¥—å¾ªç¯ã€å›æº¯å®Œæˆæ‰€æœ‰è¡¨å…³è”ï¼Œæ‰€ä»¥æ˜¯ä¸‹å›¾è¿™ç§<strong>å·¦ä¾§æ·±åº¦ä¼˜å…ˆæ ‘</strong>ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101030105.png" alt></p><h4 id="3-4-3-å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨"><a href="#3-4-3-å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨" class="headerlink" title="3.4.3 å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨"></a>3.4.3 å…³è”æŸ¥è¯¢ä¼˜åŒ–å™¨</h4><p>å…³è”æŸ¥è¯¢ä¼˜åŒ–æ˜¯ä¼˜åŒ–å™¨æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå†³å®šå¤šä¸ªè¡¨å…³è”çš„é¡ºåºã€‚ä¼˜åŒ–å™¨é€šè¿‡è¯„ä¼°ä¸åŒé¡ºåºçš„æˆæœ¬é€‰æ‹©ä¸€ä¸ªä»£ä»·æœ€å°çš„å…³è”é¡ºåºã€‚</p><p>æœ‰æ—¶ä¼˜åŒ–å™¨é€‰æ‹©çš„å¹¶éä¸€å®šæ˜¯æœ€ä¼˜é¡ºåºï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ <code>STRAIGHT_JOIN</code> å…³é”®å­—é‡å†™æŸ¥è¯¢ï¼Œè®©ä¼˜åŒ–å™¨æŒ‰æŒ‡å®šé¡ºåºæ‰§è¡Œï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¼˜åŒ–å™¨çš„åˆ¤æ–­è¦æ¯”å¼€å‘è€…ç²¾å‡†ã€‚</p><p>ä¼˜åŒ–å™¨å¦‚ä½•è®¡ç®—æˆæœ¬ï¼š</p><ul><li>ä¸€èˆ¬ä¼šéå†æ¯ä¸ªè¡¨é€ä¸ªåšåµŒå¥—å¾ªç¯è®¡ç®—æ¯ä¸€æ£µæ‰§è¡Œè®¡åˆ’æ ‘çš„æˆæœ¬ã€‚</li><li>ä½†å¦‚æœæœ‰è¶…è¿‡Nä¸ªè¡¨å…³è”ï¼Œéœ€è¦æ£€æŸ¥Nçš„é˜¶ä¹˜ç§å…³è”é¡ºåºï¼›æ¯”å¦‚N=10æ—¶å°±æœ‰3628800ç§å…³è”é¡ºåºï¼Œè¿‡å¤šçš„å¯èƒ½å¯¼è‡´ä¼˜åŒ–å™¨ä¸å¯èƒ½é€ä¸€è¯„ä¼°æ¯ç§é¡ºåºçš„æˆæœ¬ï¼›</li><li>å½“æœç´¢ç©ºé—´ç‰¹åˆ«å¤§æ—¶ï¼Œä¼˜åŒ–å™¨é€‰æ‹©è´ªå©ªæœç´¢æ–¹å¼ï¼Œè€Œéé€ä¸ªè¯„ä¼°ã€‚</li></ul><h3 id="3-5-æ’åºä¼˜åŒ–"><a href="#3-5-æ’åºä¼˜åŒ–" class="headerlink" title="3.5 æ’åºä¼˜åŒ–"></a>3.5 æ’åºä¼˜åŒ–</h3><ul><li>æ— è®ºæ€æ ·ï¼Œæ’åºéƒ½æ˜¯ä¸€ä¸ªæˆæœ¬å¾ˆé«˜çš„æ“ä½œï¼Œåœ¨ä¸èƒ½ä½¿ç”¨ç´¢å¼•æ’åºæ—¶ï¼Œæ•°æ®é‡å°çš„æ’åºä¼šåœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œæ•°æ®é‡å¤§æ—¶éœ€è¦ä½¿ç”¨ç£ç›˜ï¼›</li><li>åˆ¤æ–­æ¡ä»¶æ˜¯éœ€è¦æ’åºçš„æ•°æ®é‡æ˜¯å¦å°äº<strong>æ’åºç¼“å†²åŒº</strong>ï¼›</li><li>å†…å­˜ä¸­ç›´æ¥ä½¿ç”¨å¿«é€Ÿæ’åºï¼›å†…å­˜ä¸å¤Ÿæ’åºï¼Œå…ˆå°†æ•°æ®åˆ†å—ï¼Œæ¯ä¸ªå—è¿›è¡Œå¿«é€Ÿæ’åºï¼Œç»“æœå­˜æ”¾åœ¨ç£ç›˜ï¼Œç„¶åå°†æ’å¥½åºçš„å„ä¸ªå—åˆå¹¶ï¼Œå¹¶è¿”å›æœ€ç»ˆç»“æœã€‚</li><li>åœ¨å…³è”æŸ¥è¯¢æ—¶å¦‚æœéœ€è¦æ’åºï¼ŒMySQLåˆ†ä¸¤ç§æƒ…å†µæ¥å¤„ç†ï¼š<ul><li>ORDER BY å­å¥ä¸­æ‰€æœ‰åˆ—éƒ½æ¥è‡ªäºå…³è”çš„ç¬¬ä¸€ä¸ªè¡¨ï¼ŒMySQLåœ¨å¤„ç†ç¬¬ä¸€ä¸ªè¡¨æ—¶å°±è¿›è¡Œæ–‡ä»¶æ’åºï¼Œè¿™ç§æƒ…å†µEXPLAIN çš„ Extra å­—æ®µä¼šæœ‰ <code>Using filesort</code> ï¼›</li><li>å…¶ä»–æƒ…å†µä¸‹ï¼ŒMySQLéƒ½ä¼šå°†å…³è”çš„ç»“æœæ”¾åˆ°ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œç„¶ååœ¨æ‰€æœ‰çš„å…³è”ç»“æŸåå†è¿›è¡Œæ–‡ä»¶æ’åºï¼Œè¿™ç§æƒ…å†µEXPLAIN çš„ Extra å­—æ®µä¼šæœ‰ <code>Using temporary; Using filesort</code> ï¼›æŸ¥è¯¢ä¸­æœ‰LIMITä¼šåœ¨æ’åºååº”ç”¨ï¼ŒMySQL 5.6 ç‰ˆæœ¬åï¼Œå½“åªéœ€è¿”å›éƒ¨åˆ†æ’åºç»“æœæ—¶ä¸ä¼šå¯¹æ‰€æœ‰ç»“æœè¿›è¡Œæ’åºã€‚</li></ul></li></ul><h2 id="å››-æŸ¥è¯¢ä¼˜åŒ–å™¨"><a href="#å››-æŸ¥è¯¢ä¼˜åŒ–å™¨" class="headerlink" title="å››. æŸ¥è¯¢ä¼˜åŒ–å™¨"></a>å››. æŸ¥è¯¢ä¼˜åŒ–å™¨</h2><h3 id="4-1-æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§"><a href="#4-1-æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§" class="headerlink" title="4.1 æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§"></a>4.1 æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å±€é™æ€§</h3><h4 id="4-1-1-å…³è”å­æŸ¥è¯¢"><a href="#4-1-1-å…³è”å­æŸ¥è¯¢" class="headerlink" title="4.1.1 å…³è”å­æŸ¥è¯¢"></a>4.1.1 å…³è”å­æŸ¥è¯¢</h4><p>MySQLå­æŸ¥è¯¢ååˆ†ç³Ÿç³•ï¼Œç‰¹åˆ«æ˜¯WHEREæ¡ä»¶åŒ…å« <code>IN()</code> çš„å­æŸ¥è¯¢è¯­å¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> film </span><br><span class="line"><span class="keyword">WHERE</span> film_id <span class="keyword">IN</span>(</span><br><span class="line"><span class="keyword">SELECT</span> film_id <span class="keyword">FROM</span> film_actor <span class="keyword">WHERE</span> actor_id = <span class="number">1</span>);</span><br><span class="line"><span class="comment">--MySQLä¼šå…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œè¿”å›æ‰€æœ‰actor_id = 1çš„film_idï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šè®¤ä¸ºä¼šå¦‚ä¸‹æ‰§è¡Œï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> film </span><br><span class="line"><span class="keyword">WHERE</span> film_id <span class="keyword">IN</span>(XXX, XXX, ......, XXX);</span><br><span class="line"><span class="comment">--ä½†å®é™…ä¸Šï¼ŒMySQLä¼šå°†å¤–å±‚è¡¨å‹åˆ°å­æŸ¥è¯¢ä¸­ï¼Œå› ä¸ºå®ƒè®¤ä¸ºè¿™æ ·å¯ä»¥æ›´å¿«çš„æ‰¾åˆ°æ•°æ®è¡Œï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> film </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span>(</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> film_actor <span class="keyword">WHERE</span> actor_id = <span class="number">1</span> <span class="keyword">AND</span> film.film_id = film_actor.film_id);</span><br></pre></td></tr></table></figure><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101030106.png" alt></p><p>MySQLé€‰æ‹©å…ˆå¯¹fileè¡¨è¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ ¹æ®è¿”å›çš„film_idé€ä¸ªæ‰§è¡Œå­æŸ¥è¯¢ï¼Œå½“æ•°æ®é‡å¤§æ—¶è¿™ç§æ‰§è¡Œæ€§èƒ½ä¼šå¾ˆç³Ÿç³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¹å†™æŸ¥è¯¢å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ä½¿ç”¨å†…è¿æ¥ä»£æ›¿INå­æŸ¥è¯¢ï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> film.* <span class="keyword">FROM</span> film </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> film_actor <span class="keyword">USING</span>(film_id)</span><br><span class="line"><span class="keyword">WHERE</span> actor_id = <span class="number">1</span>;</span><br><span class="line"><span class="comment">--ä½¿ç”¨å‡½æ•°GROUP_CONCATæ‹¼æ¥ä¸€ä¸ªé€—å·åˆ†éš”çš„åˆ—è¡¨ï¼š</span></span><br><span class="line">ï¼ˆçœç•¥ï¼‰</span><br></pre></td></tr></table></figure><h4 id="4-1-2-UNIONå–LIMITæ—¶å†…å¤–å±‚ä¼˜åŒ–"><a href="#4-1-2-UNIONå–LIMITæ—¶å†…å¤–å±‚ä¼˜åŒ–" class="headerlink" title="4.1.2 UNIONå–LIMITæ—¶å†…å¤–å±‚ä¼˜åŒ–"></a>4.1.2 UNIONå–LIMITæ—¶å†…å¤–å±‚ä¼˜åŒ–</h4><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å¯¹UNIONçš„ç»“æœé›†åªè·å–å‰Næ¡è®°å½•ï¼Œå¯ä»¥åœ¨æ¯ä¸ªå­å¥ä¸­æ·»åŠ LIMITï¼Œä¸ºäº†ä¿è¯è·å–æ­£ç¡®çš„é¡ºåºï¼Œéœ€è¦åœ¨å¤–å±‚å†å¢åŠ ä¸€ä¸ªå…¨å±€çš„ ORDER BY å’Œ LIMIT æ“ä½œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> a,b <span class="keyword">FROM</span> xx1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> a)</span><br><span class="line"><span class="keyword">UNION</span> ALL</span><br><span class="line">(<span class="keyword">SELECT</span> a,b <span class="keyword">FROM</span> xx2 <span class="keyword">ORDER</span> <span class="keyword">BY</span> a)</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">20</span></span><br><span class="line"><span class="comment">-- æ”¹å†™ä¸º</span></span><br><span class="line">(<span class="keyword">SELECT</span> a,b <span class="keyword">FROM</span> xx1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> a <span class="keyword">LIMIT</span> <span class="number">20</span>)</span><br><span class="line"><span class="keyword">UNION</span> ALL</span><br><span class="line">(<span class="keyword">SELECT</span> a,b <span class="keyword">FROM</span> xx2 <span class="keyword">ORDER</span> <span class="keyword">BY</span> a <span class="keyword">LIMIT</span> <span class="number">20</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure><h4 id="4-1-3-ç´¢å¼•åˆå¹¶ä¼˜åŒ–"><a href="#4-1-3-ç´¢å¼•åˆå¹¶ä¼˜åŒ–" class="headerlink" title="4.1.3 ç´¢å¼•åˆå¹¶ä¼˜åŒ–"></a>4.1.3 ç´¢å¼•åˆå¹¶ä¼˜åŒ–</h4><p>WHEREå­å¥åŒ…å«å¤šä¸ªå¤æ‚æ¡ä»¶æ—¶ï¼ŒMySQLå¯ä»¥è®¿é—®å•ä¸ªè¡¨çš„å¤šä¸ªç´¢å¼•ä»¥åˆå¹¶å’Œäº¤å‰è¿‡æ»¤çš„æ–¹å¼æ¥å®šä½éœ€è¦æŸ¥æ‰¾çš„è¡Œã€‚</p><h4 id="4-1-4-ç­‰å€¼ä¼ é€’"><a href="#4-1-4-ç­‰å€¼ä¼ é€’" class="headerlink" title="4.1.4 ç­‰å€¼ä¼ é€’"></a>4.1.4 ç­‰å€¼ä¼ é€’</h4><p>å¦‚ä¸€ä¸ªéå¸¸å¤§çš„ <code>IN()</code> åˆ—è¡¨ï¼Œä¼˜åŒ–å™¨å‘ç°æœ‰WHEREã€ONæˆ–USINGçš„å­å¥ï¼Œå°†è¿™ä¸ªåˆ—è¡¨çš„å€¼å’Œå¦å¤–ä¸€ä¸ªè¡¨çš„æŸä¸ªåˆ—å…³è”ã€‚ä¼˜åŒ–å™¨ä¼šå°†åˆ—è¡¨éƒ½å¤åˆ¶åº”ç”¨åˆ°å…³è”çš„å„ä¸ªè¡¨ä¸­ï¼Œåˆ—è¡¨ç‰¹åˆ«å¤§ä¼šå¯¼è‡´æ— æ³•é«˜æ•ˆçš„ä»è¡¨ä¸­è¿‡æ»¤è®°å½•ã€‚</p><h4 id="4-1-5-å¹¶è¡Œæ‰§è¡Œ"><a href="#4-1-5-å¹¶è¡Œæ‰§è¡Œ" class="headerlink" title="4.1.5 å¹¶è¡Œæ‰§è¡Œ"></a>4.1.5 å¹¶è¡Œæ‰§è¡Œ</h4><p>MySQLæ— æ³•åˆ©ç”¨å¤šæ ¸æ¥å¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢ã€‚</p><h4 id="4-1-6-å“ˆå¸Œå…³è”"><a href="#4-1-6-å“ˆå¸Œå…³è”" class="headerlink" title="4.1.6 å“ˆå¸Œå…³è”"></a>4.1.6 å“ˆå¸Œå…³è”</h4><p>MySQLåªæ”¯æŒåµŒå¥—å¾ªç¯å…³è”ï¼Œåªèƒ½é€šè¿‡å»ºç«‹å“ˆå¸Œç´¢å¼•æ¥å˜ç›¸çš„å®ç°å“ˆå¸Œå…³è”</p><h4 id="4-1-7-æ¾æ•£ç´¢å¼•æ‰«æ"><a href="#4-1-7-æ¾æ•£ç´¢å¼•æ‰«æ" class="headerlink" title="4.1.7 æ¾æ•£ç´¢å¼•æ‰«æ"></a>4.1.7 æ¾æ•£ç´¢å¼•æ‰«æ</h4><p>MySQLä¸æ”¯æŒæ¾æ•£ç´¢å¼•æ‰«æï¼Œæ— æ³•æŒ‰ç…§ä¸è¿ç»­çš„æ–¹å¼æ‰«æä¸€ä¸ªç´¢å¼•ã€‚å‡è®¾æœ‰ç´¢å¼• <code>(A,B)</code> æŸ¥è¯¢ <code>SELECT ... FROM TB WHERE B BETWEEN 2 AND 3</code> å› ä¸ºç´¢å¼•å‰å¯¼å­—æ®µæ˜¯Aï¼Œä½†æŸ¥è¯¢åªæŒ‡å®šäº†Bï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œåªèƒ½å…¨è¡¨æ‰«æã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101210101.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101210102.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210101/202101210103.png" alt></p><h4 id="4-1-8-æœ€å¤§å€¼å’Œæœ€å°å€¼ä¼˜åŒ–"><a href="#4-1-8-æœ€å¤§å€¼å’Œæœ€å°å€¼ä¼˜åŒ–" class="headerlink" title="4.1.8 æœ€å¤§å€¼å’Œæœ€å°å€¼ä¼˜åŒ–"></a>4.1.8 æœ€å¤§å€¼å’Œæœ€å°å€¼ä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(actor_id) <span class="keyword">FROM</span> actor <span class="keyword">WHERE</span> first_name = <span class="string">'XX'</span>;</span><br><span class="line"><span class="comment">--å› ä¸ºfirst_nameå¹¶æ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥MySQLä¼šè¿›è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œé€šè¿‡SHOW STATUSç¡®è®¤</span></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">STATUS</span>;</span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">STATUS</span>;</span><br><span class="line"><span class="comment">--ä¼˜åŒ–ï¼šä½¿ç”¨LIMITé‡å†™</span></span><br><span class="line"><span class="keyword">SELECT</span> actor_id <span class="keyword">FROM</span> actor <span class="keyword">USE</span> <span class="keyword">INDEX</span>(PRIMARY) <span class="keyword">WHERE</span> first_name = <span class="string">'XX'</span> <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><h3 id="4-2-æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º"><a href="#4-2-æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º" class="headerlink" title="4.2 æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º"></a>4.2 æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æç¤º</h3><p>æš‚ç•¥ã€‚</p><h3 id="4-3-ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢"><a href="#4-3-ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢" class="headerlink" title="4.3 ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢"></a>4.3 ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢</h3><h4 id="4-3-1-ä¼˜åŒ–COUNT"><a href="#4-3-1-ä¼˜åŒ–COUNT" class="headerlink" title="4.3.1 ä¼˜åŒ–COUNT()"></a>4.3.1 ä¼˜åŒ–COUNT()</h4><p>COUNT(*) ç»Ÿè®¡ç»“æœé›†çš„è¡Œæ•°ï¼ŒCOUNT(row) ç»Ÿè®¡æŸä¸ªåˆ—å€¼çš„æ•°é‡ï¼ŒäºŒè€…å«ä¹‰ä¸åŒã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ä¸€ä¸ªæŸ¥è¯¢ç»Ÿè®¡ä¸åŒé¢œè‰²</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(<span class="keyword">IF</span>(color = <span class="string">'blue'</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">AS</span> blue, <span class="keyword">SUM</span>(<span class="keyword">IF</span>(color = <span class="string">'red'</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">AS</span> red <span class="keyword">FROM</span> items;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(color = <span class="string">'blue'</span> <span class="keyword">OR</span> <span class="literal">NULL</span>) <span class="keyword">AS</span> blue, <span class="keyword">COUNT</span>(color = <span class="string">'red'</span> <span class="keyword">OR</span> <span class="literal">NULL</span>) <span class="keyword">AS</span> red <span class="keyword">FROM</span> items;</span><br></pre></td></tr></table></figure><p>ä¸éœ€è¦ç²¾ç¡®å€¼æ—¶å¯ä»¥ä½¿ç”¨è¿‘ä¼¼å€¼ä»£æ›¿ï¼Œæ¯”å¦‚EXPLAINçš„ä¼°ç®—è¡Œæ•°ã€‚</p><p>COUNT() ä¸€èˆ¬éƒ½éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®è¡Œæ‰èƒ½è·å¾—ç²¾ç¡®çš„ç»“æœï¼Œåªèƒ½åŠ ç´¢å¼•è¦†ç›–æ‰«æï¼Œå¦‚æœè¿™æ ·è¿˜ä¸èƒ½è§£å†³æ€§èƒ½é—®é¢˜ï¼Œåªèƒ½è€ƒè™‘ä¿®æ”¹åº”ç”¨çš„æ¶æ„ï¼Œæ¯”å¦‚å¢åŠ æ±‡æ€»è¡¨ / ç¼“å­˜ç³»ç»Ÿç­‰ã€‚</p><h4 id="4-3-2-ä¼˜åŒ–å…³è”æŸ¥è¯¢"><a href="#4-3-2-ä¼˜åŒ–å…³è”æŸ¥è¯¢" class="headerlink" title="4.3.2 ä¼˜åŒ–å…³è”æŸ¥è¯¢"></a>4.3.2 ä¼˜åŒ–å…³è”æŸ¥è¯¢</h4><ul><li>ç¡®ä¿ONæˆ–USINGå­å¥çš„åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œåˆ›å»ºç´¢å¼•æ—¶è¦è€ƒè™‘å…³è”çš„é¡ºåºï¼Œå½“è¡¨Aå’ŒBç”¨åˆ—cå…³è”ï¼Œè‹¥ä¼˜åŒ–å™¨çš„å…³è”é¡ºåºçš„Bã€Aï¼Œé‚£ä¹ˆBè¡¨å°±ä¸éœ€è¦åˆ›å»ºç´¢å¼•ï¼Œ<strong>ä¸€èˆ¬å…³è”åªéœ€åœ¨å…³è”é¡ºåºçš„ç¬¬äºŒå¼ è¡¨å¯¹åº”åˆ—ä¸Šåˆ›å»ºç´¢å¼•</strong>ã€‚</li><li>ç¡®ä¿ä»»ä½•çš„GROUP BYå’ŒORDER BYä¸­çš„è¡¨è¾¾å¼åªæ¶‰åŠåˆ°ä¸€ä¸ªè¡¨ä¸­çš„åˆ—ï¼Œè¿™æ ·MySQLæ‰æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚</li><li>å‡çº§MySQLæ—¶æ³¨æ„å…³è”è¯­æ³•ã€è¿ç®—ç¬¦ä¼˜å…ˆçº§ç­‰å…¶ä»–å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–çš„åœ°æ–¹ï¼Œæ™®é€šå…³è”å¯èƒ½ä¼šå˜æˆç¬›å¡å°”ç§¯ï¼Œä¸åŒç±»å‹çš„å…³è”å¯èƒ½ä¼šç”Ÿæˆä¸åŒçš„ç»“æœã€‚</li></ul><h4 id="4-3-3-ä¼˜åŒ–å­æŸ¥è¯¢"><a href="#4-3-3-ä¼˜åŒ–å­æŸ¥è¯¢" class="headerlink" title="4.3.3 ä¼˜åŒ–å­æŸ¥è¯¢"></a>4.3.3 ä¼˜åŒ–å­æŸ¥è¯¢</h4><p>å°½å¯èƒ½ç”¨å…³è”æŸ¥è¯¢ä»£æ›¿å­æŸ¥è¯¢ã€‚</p><h4 id="4-3-4-ä¼˜åŒ–GROUP-BYå’ŒDISTINCT"><a href="#4-3-4-ä¼˜åŒ–GROUP-BYå’ŒDISTINCT" class="headerlink" title="4.3.4 ä¼˜åŒ–GROUP BYå’ŒDISTINCT"></a>4.3.4 ä¼˜åŒ–GROUP BYå’ŒDISTINCT</h4><p>MySQLä¼˜åŒ–å™¨ä¼šåœ¨å†…éƒ¨å¤„ç†æ—¶ç›¸äº’è½¬æ¢è¿™ä¸¤ç±»æŸ¥è¯¢ï¼Œä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–ï¼›è‹¥ç´¢å¼•æ— æ³•ä½¿ç”¨ï¼ŒGROUP BY ä¼šä½¿ç”¨<strong>ä¸´æ—¶è¡¨</strong>æˆ–<strong>æ–‡ä»¶æ’åº</strong>æ¥åšåˆ†ç»„ã€‚</p><p>å¯¹å…³è”æŸ¥è¯¢åšåˆ†ç»„ï¼Œå¹¶ä¸”æŒ‰ç…§æŸ¥æ‰¾è¡¨ä¸­çš„æŸä¸ªåˆ—è¿›è¡Œåˆ†ç»„ï¼Œé‡‡ç”¨æŸ¥æ‰¾è¡¨çš„æ ‡è¯†åˆ—æ•ˆç‡ä¼šè¾ƒé«˜ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--æ•ˆç‡å·®</span></span><br><span class="line"><span class="keyword">SELECT</span> actor.first_name,actor.last_name, <span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> film_actor</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> actor <span class="keyword">USING</span>(actor_id)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> actor.first_name,actor.last_name</span><br><span class="line"><span class="comment">--æ•ˆç‡é«˜</span></span><br><span class="line"><span class="keyword">SELECT</span> actor.first_name,actor.last_name, <span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> film_actor</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> actor <span class="keyword">USING</span>(actor_id)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> actor.actor_id</span><br><span class="line"><span class="comment">--è¿™ç§å†™æ³•åªæ˜¯åœ¨å§“åå’Œactor_idç›´æ¥å…³è”çš„æƒ…å†µä¸‹å¯ä»¥è¿™æ ·ç”¨ï¼Œä¸”æœ‰ä¸€äº›é—®é¢˜</span></span><br></pre></td></tr></table></figure><h4 id="4-3-5-ä¼˜åŒ–LIMITåˆ†é¡µ"><a href="#4-3-5-ä¼˜åŒ–LIMITåˆ†é¡µ" class="headerlink" title="4.3.5 ä¼˜åŒ–LIMITåˆ†é¡µ"></a>4.3.5 ä¼˜åŒ–LIMITåˆ†é¡µ</h4><p>åˆ†é¡µæ“ä½œï¼šä½¿ç”¨LIMITåŠ åç§»é‡å®ç°ï¼ŒåŠ ä¸Šåˆé€‚çš„ORDER BYå­å¥ã€‚</p><p>åç§»é‡éå¸¸å¤§æ—¶ï¼Œæ¯”å¦‚ LIMIT 10000,20 åªè¿”å›20æ¡æ•°æ®æŠ›å¼ƒå‰é¢10000æ¡è®°å½•ã€‚ä¼˜åŒ–è¦ä¹ˆåœ¨é¡µé¢ä¸­é™åˆ¶åˆ†é¡µçš„æ•°é‡ï¼Œè¦ä¹ˆä¼˜åŒ–å¤§åç§»é‡çš„æ€§èƒ½ã€‚</p><ul><li><p><strong>å»¶è¿Ÿå…³è”</strong>ï¼šæœ€ç®€å•å°±æ˜¯ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼Œè€Œä¸æ˜¯è¿”å›æ‰€æœ‰åˆ—ã€‚ç„¶åæ ¹æ®éœ€è¦å†åšä¸€æ¬¡å…³è”æ“ä½œè¿”å›æ‰€æœ‰åˆ—ï¼Œè¿™ç§æ”¹æ³•å¯¹äºåç§»é‡å¤§çš„æƒ…å†µæ•ˆç‡æå‡æ¯”è¾ƒé«˜ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> film_id,description <span class="keyword">FROM</span> film <span class="keyword">ORDER</span> <span class="keyword">BY</span> title <span class="keyword">LIMIT</span> <span class="number">50</span>,<span class="number">5</span>;</span><br><span class="line"><span class="comment">--ä¼˜åŒ–ä¸ºï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> film.film_id, film.description </span><br><span class="line"><span class="keyword">FROM</span> film</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span>(<span class="keyword">SELECT</span> film_id <span class="keyword">FROM</span> film <span class="keyword">ORDER</span> <span class="keyword">BY</span> title <span class="keyword">LIMIT</span> <span class="number">50</span>,<span class="number">5</span>) <span class="keyword">AS</span> lim <span class="keyword">USING</span>(film_id)</span><br></pre></td></tr></table></figure></li><li><p>LIMITå¯ä»¥è½¬æ¢ä¸ºå·²çŸ¥ä½ç½®çš„æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ä¸Šè¿°æŸ¥è¯¢å¯æ”¹ä¸ºï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> film_id, description </span><br><span class="line"><span class="keyword">FROM</span> film</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">position</span> <span class="keyword">BETWEEN</span> <span class="number">50</span> <span class="keyword">TO</span> <span class="number">54</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">position</span>;</span><br></pre></td></tr></table></figure></li><li><p>LIMITæŸ¥è¯¢ä¸»è¦é—®é¢˜æ˜¯OFFSETä¼šå¯¼è‡´MySQLæ‰«æå¤§é‡ä¸éœ€è¦çš„è¡Œå¹¶ä¸”ä¸¢å¼ƒæ‰ï¼Œå¯ä»¥è®°å½•ä¸Šæ¬¡å–æ•°æ®çš„ä½ç½®ï¼Œä¸‹æ¬¡ç›´æ¥ä»è¯¥ä½ç½®å¼€å§‹æ‰«æï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œè¿”å›ä¸»é”®ä¸º16049åˆ°16030çš„ç§Ÿå€Ÿè®°å½•</span></span><br><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> rental</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> rental_id <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">20</span>;</span><br><span class="line"><span class="comment">--ä¸‹æ¬¡æŸ¥è¯¢ç›´æ¥ä»16030å¼€å§‹</span></span><br><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> rental</span><br><span class="line"><span class="keyword">WHERE</span> rental_id &lt; <span class="number">16030</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> rental_id <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-3-6-ä¼˜åŒ–-SQL-CALC-FOUND-ROWS"><a href="#4-3-6-ä¼˜åŒ–-SQL-CALC-FOUND-ROWS" class="headerlink" title="4.3.6 ä¼˜åŒ– SQL_CALC_FOUND_ROWS"></a>4.3.6 ä¼˜åŒ– SQL_CALC_FOUND_ROWS</h4><p>åˆ†é¡µçš„ä¸€ä¸ªå¸¸ç”¨æŠ€å·§æ˜¯<strong>åœ¨LIMITè¯­å¥ä¸­åŠ ä¸ŠSQL_CALC_FOUND_ROWSæç¤º</strong>ï¼Œä»è€Œè·å¾—å»æ‰LIMITä»¥åæ»¡è¶³æ¡ä»¶çš„è¡Œæ•°ï¼Œä½œä¸ºåˆ†é¡µçš„æ€»æ•°ï¼Œå¥½åƒæ˜¯MySQLé¢„æµ‹åˆ°äº†æ€»è¡Œæ•°ï¼Œä½†å®é™…ä¸ŠMySQLéœ€è¦æ‰«ææ‰«ææ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œæ¥å¾—åˆ°è¡Œæ•°ã€‚</p><p>æ‰€ä»¥æ·»åŠ æ­¤æç¤ºåï¼Œä¸ç®¡æ˜¯å¦éœ€è¦ï¼ŒMySQLéƒ½ä¼šæ‰«ææ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œè€Œä¸æ˜¯æ»¡è¶³LIMITçš„è¡Œæ•°åå°±ç»ˆæ­¢æ‰«æã€‚</p><h4 id="4-3-7-ä¼˜åŒ–-UNION-æŸ¥è¯¢"><a href="#4-3-7-ä¼˜åŒ–-UNION-æŸ¥è¯¢" class="headerlink" title="4.3.7 ä¼˜åŒ– UNION æŸ¥è¯¢"></a>4.3.7 ä¼˜åŒ– UNION æŸ¥è¯¢</h4><p>MySQLæ€»æ˜¯ä¼šé€šè¿‡åˆ›å»ºå¹¶å¡«å……ä¸´æ—¶è¡¨çš„æ–¹å¼æ¥æ‰§è¡Œ UNION æŸ¥è¯¢ï¼Œæ‰€ä»¥å¯¼è‡´å¾ˆå¤šä¼˜åŒ–ç­–ç•¥å—é™ï¼ˆç»å¸¸è¦æ‰‹å·¥å°†WHEREï¼ŒLIMITï¼ŒORDER BYæ”¾åˆ°UNIONå­æŸ¥è¯¢ä¸­ä»¥ä¾¿ä¼˜åŒ–å™¨ä¼˜åŒ–ï¼‰ã€‚</p><p>é™¤éå¿…é¡»è¦æœåŠ¡å™¨æ¶ˆé™¤é‡å¤çš„è¡Œï¼Œå¦åˆ™ä¸€å®šè¦ä½¿ç”¨UNION ALLï¼Œæ²¡æœ‰ALLæ—¶MySQLä¼šç»™ä¸´æ—¶è¡¨å¢åŠ DISTINCTé€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´æ•´ä¸ªä¸´æ—¶è¡¨åšå”¯ä¸€æ€§æ£€æŸ¥ï¼Œè¿™æ ·çš„ä»£ä»·éå¸¸é«˜ã€‚</p><h4 id="4-3-8-é™æ€æŸ¥è¯¢åˆ†æ"><a href="#4-3-8-é™æ€æŸ¥è¯¢åˆ†æ" class="headerlink" title="4.3.8 é™æ€æŸ¥è¯¢åˆ†æ"></a>4.3.8 é™æ€æŸ¥è¯¢åˆ†æ</h4><p>Percona Toolkitä¸­çš„pt-query-advisorèƒ½å¤Ÿè§£ææŸ¥è¯¢æ—¥å¿—ï¼Œåˆ†ææŸ¥è¯¢æ¨¡å¼ï¼Œç»™å‡ºæ‰€æœ‰å¯èƒ½å­˜åœ¨æ½œåœ¨é—®é¢˜çš„æŸ¥è¯¢ï¼Œå¹¶ç»™å‡ºè¶³å¤Ÿè¯¦ç»†çš„å»ºè®®ã€‚</p><h4 id="4-3-9-ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡"><a href="#4-3-9-ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡" class="headerlink" title="4.3.9 ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡"></a>4.3.9 ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</h4><p>æš‚ç•¥ã€‚</p><h3 id="4-4-æ¡ˆä¾‹"><a href="#4-4-æ¡ˆä¾‹" class="headerlink" title="4.4 æ¡ˆä¾‹"></a>4.4 æ¡ˆä¾‹</h3><h3 id="4-4-1-æ„å»ºä¸€ä¸ªé˜Ÿåˆ—è¡¨"><a href="#4-4-1-æ„å»ºä¸€ä¸ªé˜Ÿåˆ—è¡¨" class="headerlink" title="4.4.1 æ„å»ºä¸€ä¸ªé˜Ÿåˆ—è¡¨"></a>4.4.1 æ„å»ºä¸€ä¸ªé˜Ÿåˆ—è¡¨</h3><ul><li><p>ä¸€ä¸ªè¡¨åŒ…å«å¤šç§ç±»å‹çš„è®°å½•ï¼šæœªå¤„ç†çš„è®°å½•ã€å·²å¤„ç†è®°å½•ã€æ­£åœ¨å¤„ç†è®°å½•ã€‚</p></li><li><p>ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹åœ¨è¡¨ä¸­æŸ¥æ‰¾æœªå¤„ç†çš„è®°å½•ï¼Œç„¶åæ ‡è®°ä¸ºæ­£åœ¨å¤„ç†ï¼Œå¤„ç†å®Œæˆåå†æ›´æ–°ä¸ºå·²å¤„ç†çŠ¶æ€ã€‚</p></li><li><p>ä¸åˆç†çš„åœ°æ–¹ï¼š</p><ul><li>éšç€é˜Ÿåˆ—è¡¨è¶Šæ¥è¶Šå¤§å’Œç´¢å¼•æ·±åº¦çš„å¢åŠ ï¼Œæ‰¾åˆ°æœªå¤„ç†è®°å½•çš„é€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼›å¯ä»¥å°†é˜Ÿåˆ—è¡¨æ‹†åˆ†ä¸ºå·²å¤„ç†å’Œæœªå¤„ç†ä¸¤éƒ¨åˆ†æ¥ä¼˜åŒ–ã€‚</li><li>å¤„ç†è¿‡ç¨‹ä¸€èˆ¬åŒ…æ‹¬ä¸¤æ­¥ï¼šæ‰¾åˆ°æœªå¤„ç†è®°å½•ï¼Œç„¶ååŠ é”ã€‚å‰è€…å¢åŠ æœåŠ¡å™¨å‹åŠ›ï¼ŒåŠ é”åˆ™è®©å„ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹å¢åŠ ç«äº‰ã€‚</li></ul></li><li><p>å¦‚ä½•è®©æ¶ˆè´¹è€…æ ‡è®°æ­£åœ¨å¤„ç†çš„è®°å½•ï¼Œè€Œä¸ä½¿å¤šä¸ªæ¶ˆè´¹è€…é‡å¤å¤„ç†åŒä¸€è®°å½•ï¼Ÿ</p><ul><li><p>ä»»ä½•æƒ…å†µéƒ½åº”é¿å…ä½¿ç”¨ SELECT FOR UPDATE ï¼Œä¼šå¯¼è‡´å¤§é‡äº‹åŠ¡é˜»å¡å¹¶ç­‰å¾…ï¼›</p></li><li><p>ç”¨ä¸€ä¸ªå±æ€§åˆ—æ ‡è¯†æ­£åœ¨å¤„ç†è®°å½•çš„è¿æ¥IDã€‚</p></li><li><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="comment">--æŸ¥æ‰¾æœªæœ‰çº¿ç¨‹å¤„ç†ä¸”çŠ¶æ€ä¸ºå¾…å‘é€çš„è®°å½•ID</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> unsent_emails</span><br><span class="line"><span class="keyword">WHERE</span> owner = <span class="number">0</span> </span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">status</span> = <span class="string">'unsent'</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">10</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">--resultï¼š123ï¼Œ456ï¼Œ789</span></span><br><span class="line"><span class="comment">--æ›´æ–°è¿™äº›è®°å½•çŠ¶æ€ï¼Œå¹¶ä¸”å°†è¿æ¥IDå†™å…¥owner</span></span><br><span class="line"><span class="keyword">UPDATE</span> unsent_emails</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">status</span> = <span class="string">'claimed'</span>, owner = CONNECTION_ID()</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span>(<span class="number">123</span>, <span class="number">456</span>, <span class="number">789</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šè¿°SELECTèµ°äº†ç´¢å¼•ï¼Œä½†FOR UPDATEé”ä¼šä½¿å…¶ä»–æŸ¥è¯¢é˜»å¡ï¼Œå¯ä»¥æ”¹è¿›å¦‚ä¸‹ï¼ˆæ— éœ€ç”¨SELECTæŸ¥è¯¢å“ªäº›è®°å½•è¿˜æœªè¢«å¤„ç†ï¼Œå¯ä»¥ç”¨æ¥æ”¹å†™æ‰€æœ‰çš„SELECT FOR UPDATEï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> AUTOCOMMIT = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">UPDATE</span> unsent_emails</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">status</span> = <span class="string">'claimed'</span>, owner = CONNECTION_ID()</span><br><span class="line"><span class="keyword">WHERE</span> owner = <span class="number">0</span> </span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">status</span> = <span class="string">'unsent'</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> unsent_emails</span><br><span class="line"><span class="keyword">WHERE</span> owner = CONNECTION_ID()</span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">status</span> = <span class="string">'claimed'</span>;</span><br><span class="line"><span class="comment">--resultï¼š123ï¼Œ456ï¼Œ789</span></span><br><span class="line"><span class="comment">--æ›´æ–°è¿™äº›è®°å½•çŠ¶æ€ï¼Œå¹¶ä¸”å°†è¿æ¥IDå†™å…¥owner</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>åŸºç¡€åŸåˆ™ï¼š</p><ul><li>é™¤éä¸å¾—å·²ï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨è½®è¯¢ã€‚</li><li>å°½é‡ç”¨UPDATEä»£æ›¿ SELECT FOR UPDATEï¼Œäº‹åŠ¡æäº¤è¶Šå¿«ï¼ŒæŒæœ‰é”çš„æ—¶é—´å°±è¶ŠçŸ­ï¼Œå¯ä»¥å¤§å¤§å‡å°‘ç«äº‰å’ŒåŠ é€Ÿä¸²è¡Œæ‰§è¡Œæ•ˆç‡ã€‚</li><li>å°†å·²ç»å¤„ç†å®Œæˆå’Œæœªå¤„ç†æ•°æ®åˆ†å¼€ï¼Œä¿è¯æ•°æ®é›†è¶³å¤Ÿå°ã€‚</li><li>æ— æ³•ä¼˜åŒ–çš„æŸ¥è¯¢å°è¯•ç”¨ä¸åŒç­–ç•¥æ¥å®ç°ç›¸åŒç›®çš„ã€‚</li><li>ä»»åŠ¡é˜Ÿåˆ—æœ€å¥½èƒ½ä»æ•°æ®åº“ç§»é™¤ï¼Œä½¿ç”¨Redisã€memcachedã€Q4Må¼•æ“ç­‰æ–¹æ¡ˆã€‚</li></ul></li></ul><h3 id="4-4-2-è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»"><a href="#4-4-2-è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»" class="headerlink" title="4.4.2 è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»"></a>4.4.2 è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»</h3><p>æ„Ÿè§‰ä¸æ˜¯å¸¸ç”¨çš„åœºæ™¯ï¼Œæš‚ç•¥ã€‚</p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šé«˜æ€§èƒ½MySQLã€‹</p>]]></content>
    
    <summary type="html">
    
      ã€Šé«˜æ€§èƒ½MySQLã€‹è¯»ä¹¦ç¬”è®°ï¼Œå†…å®¹ï¼šä¸ºä»€ä¹ˆæŸ¥è¯¢é€Ÿåº¦ä¼šæ…¢ï¼Œä¼˜åŒ–æ•°æ®è®¿é—®ï¼ŒæŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå››ï¼‰åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•</title>
    <link href="http://linyishui.top/2020122501.html"/>
    <id>http://linyishui.top/2020122501.html</id>
    <published>2020-12-25T12:14:26.000Z</published>
    <updated>2020-12-29T12:30:52.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå››ï¼‰åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•"><a href="#ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå››ï¼‰åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•" class="headerlink" title="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå››ï¼‰åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•"></a>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆå››ï¼‰åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•</h1><h2 id="ä¸€-æ¦‚è¿°"><a href="#ä¸€-æ¦‚è¿°" class="headerlink" title="ä¸€. æ¦‚è¿°"></a>ä¸€. æ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h3><p>ç´¢å¼•å°±åƒæ˜¯ä¹¦çš„ç›®å½•ï¼Œåœ¨MySQLä¸­ï¼Œå­˜å‚¨å¼•æ“å…ˆåœ¨ç´¢å¼•ä¸­æ‰¾åˆ°å¯¹åº”å€¼ï¼Œç„¶åæ ¹æ®åŒ¹é…çš„ç´¢å¼•è®°å½•æ‰¾åˆ°å¯¹åº”çš„æ•°æ®è¡Œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name <span class="keyword">FROM</span> XXX <span class="keyword">WHERE</span> actor_id = <span class="number">5</span>;</span><br><span class="line"><span class="comment">--è‹¥actor_idåˆ—ä¸Šæœ‰åˆ›å»ºç´¢å¼•ï¼ŒMySQLå…ˆåœ¨ç´¢å¼•ä¸ŠæŒ‰å€¼æŸ¥æ‰¾ï¼Œç„¶åè¿”å›æ‰€æœ‰åŒ…å«å€¼å¾—æ•°æ®è¡Œ</span></span><br></pre></td></tr></table></figure><p><strong>MySQLåªèƒ½é«˜æ•ˆçš„ä½¿ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€åˆ—ï¼Œç´¢å¼•ä¸­åˆ—çš„é¡ºåºå¾ˆé‡è¦</strong>ã€‚</p><h3 id="1-2-ç´¢å¼•çš„ç±»å‹"><a href="#1-2-ç´¢å¼•çš„ç±»å‹" class="headerlink" title="1.2 ç´¢å¼•çš„ç±»å‹"></a>1.2 ç´¢å¼•çš„ç±»å‹</h3><h4 id="1-2-1-B-Tree-ç´¢å¼•"><a href="#1-2-1-B-Tree-ç´¢å¼•" class="headerlink" title="1.2.1 B-Tree ç´¢å¼•"></a>1.2.1 B-Tree ç´¢å¼•</h4><p>è™½ç„¶å«B-Treeç´¢å¼•ï¼Œä½†å­˜å‚¨å¼•æ“å¯èƒ½ä½¿ç”¨ä¸åŒçš„å­˜å‚¨ç»“æ„ï¼Œæ¯”å¦‚InnoDBä½¿ç”¨çš„æ˜¯ B+Treeã€NDBé›†ç¾¤ä½¿ç”¨çš„æ˜¯ T-Tree ã€‚MyISAMä½¿ç”¨å‰ç¼€å‹ç¼©æŠ€æœ¯ä½¿å¾—ç´¢å¼•æ›´å°ï¼ŒInnoDBåˆ™æŒ‰åŸæ•°æ®æ ¼å¼å­˜å‚¨ï¼›MyISAMç´¢å¼•é€šè¿‡æ•°æ®çš„ç‰©ç†ä½ç½®å¼•ç”¨è¢«ç´¢å¼•çš„è¡Œï¼ŒInnoDBåˆ™æ ¹æ®ä¸»é”®å¼•ç”¨è¢«ç´¢å¼•çš„è¡Œã€‚</p><p>B-Treeç´¢å¼•ä¸­æ‰€æœ‰å€¼æŒ‰é¡ºåºå­˜å‚¨ï¼Œæ¯ä¸ªå¶å­é¡µåˆ°æ ¹çš„è·ç¦»ç›¸åŒï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012280101.png" alt></p><p>å­˜å‚¨å¼•æ“ä»ç´¢å¼•çš„æ ¹èŠ‚ç‚¹å¼€å§‹æœç´¢ï¼Œæ ¹èŠ‚ç‚¹çš„æ§½ä¸­å­˜æ”¾äº†æŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆå‘ä¸‹å±‚æŸ¥æ‰¾ï¼Œé€šè¿‡æ¯”è¾ƒèŠ‚ç‚¹é¡µå’Œè¦æŸ¥æ‰¾çš„å€¼å¤§å°å¯ä»¥æ‰¾åˆ°åˆé€‚çš„æŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆæŒ‡å‘è¢«ç´¢å¼•çš„æ•°æ®ã€‚è¿™ç§é¡ºåºå­˜å‚¨å¾ˆé€‚åˆèŒƒå›´æŸ¥è¯¢ã€‚</p><p>å¯¹äºPeopleè¡¨æœ‰ç´¢å¼•åŒ…å«last_nameã€first_nameå’Œdobï¼Œç´¢å¼•ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012280102.png" alt></p><p>B-Tree ç´¢å¼•é€‚ç”¨äº<strong>å…¨é”®å€¼ã€é”®å€¼èŒƒå›´æˆ–é”®å‰ç¼€æŸ¥æ‰¾</strong>ï¼Œé”®å‰ç¼€æŸ¥æ‰¾åªé€‚ç”¨æœ€å·¦å‰ç¼€ï¼š</p><ul><li><strong>å…¨å€¼åŒ¹é…</strong>ï¼šå’Œç´¢å¼•ä¸­æ‰€æœ‰åˆ—åŒ¹é…ï¼Œå¦‚æŸ¥è¯¢å« Cuba Allenã€å‡ºç”ŸäºXXXå¹´çš„äººã€‚</li><li><strong>åŒ¹é…æœ€å·¦å‰ç¼€</strong>ï¼šåªåŒ¹é…ç´¢å¼•ç¬¬ä¸€åˆ—ï¼Œå¦‚æŸ¥è¯¢æ‰€æœ‰å§“Allençš„äººã€‚</li><li><strong>åŒ¹é…åˆ—å‰ç¼€</strong>ï¼šåªåŒ¹é…åˆ—å€¼çš„å¼€å¤´éƒ¨åˆ†ï¼Œå¦‚æŸ¥è¯¢æ‰€æœ‰Jå¼€å¤´å§“çš„äººã€‚</li><li><strong>åŒ¹é…èŒƒå›´å€¼</strong>ï¼šåŒ¹é…åˆ—å€¼å¾—æŸä¸ªèŒƒå›´ï¼Œå¦‚æŸ¥è¯¢æ‰€æœ‰å§“Allenä¸Barryä¹‹é—´çš„äººã€‚</li><li><strong>ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ—</strong>ï¼šç¬¬ä¸€åˆ—å…¨åŒ¹é…ï¼Œç¬¬äºŒåˆ—èŒƒå›´åŒ¹é…ï¼Œå¦‚æŸ¥è¯¢æ‰€æœ‰å§“Allenï¼Œåä»¥Kå¼€å¤´çš„äººã€‚</li><li><strong>åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢</strong>ï¼šå³æŸ¥è¯¢åªéœ€è®¿é—®ç´¢å¼•ï¼Œæ— é¡»è®¿é—®æ•°æ®è¡Œï¼Œå³<strong>è¦†ç›–ç´¢å¼•</strong>ã€‚</li></ul><p>B-Treeç´¢å¼•æ”¯æŒçš„æŸ¥è¯¢åŒæ ·å¯ä»¥æ”¯æŒ ORDER BY æ“ä½œã€‚</p><p>é™åˆ¶ï¼š</p><ul><li>éæœ€å·¦åˆ—å¼€å§‹æ— æ³•å‘½ä¸­ç´¢å¼•ï¼›</li><li>ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ï¼›</li><li>æŸ¥è¯¢ä¸­è‹¥æœ‰æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™å…¶å³è¾¹æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥æ‰¾ã€‚</li></ul><p>å³ä»å·¦åˆ°å³ä¾æ¬¡æ‰«æç´¢å¼•åˆ—ï¼Œåˆ°é‡åˆ°ç¬¬ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;=, &gt;,&lt;, &lt;=, between â€¦.. and â€¦.ï¼‰å°±åœæ­¢æ‰«æã€‚</p><h4 id="1-2-2-å“ˆå¸Œç´¢å¼•"><a href="#1-2-2-å“ˆå¸Œç´¢å¼•" class="headerlink" title="1.2.2 å“ˆå¸Œç´¢å¼•"></a>1.2.2 å“ˆå¸Œç´¢å¼•</h4><ul><li>Memoryå’ŒNDBå­˜å‚¨å¼•æ“æ”¯æŒï¼ŒåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆã€‚</li><li>InnoDBæœ‰ä¸€ä¸ªç‰¹æ®Šçš„è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œåœ¨æŸäº›ç´¢å¼•å€¼ä½¿ç”¨éå¸¸é¢‘ç¹æ—¶ï¼Œä¼šåœ¨å†…å­˜ä¸­åŸºäºB-Treeç´¢å¼•å†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œä»è€ŒåŠ å¿«æŸ¥æ‰¾é€Ÿåº¦ã€‚</li><li>æ¯è¡Œæ•°æ®ä¼šè®¡ç®—å¾—åˆ°ä¸€ä¸ªå“ˆå¸Œç ï¼Œå­˜æ”¾åœ¨å“ˆå¸Œç´¢å¼•ä¸­ï¼ŒåŒæ—¶åœ¨å“ˆå¸Œè¡¨ä¸­ä¿å­˜æŒ‡å‘æ¯ä¸ªæ•°æ®è¡Œçš„æŒ‡é’ˆã€‚</li><li>å“ˆå¸Œç´¢å¼•åªåŒ…å«å“ˆå¸Œå€¼å’Œè¡ŒæŒ‡é’ˆï¼Œä¸å­˜å‚¨å­—æ®µå€¼ï¼Œæ‰€ä»¥ä¸èƒ½åƒB-Treeç´¢å¼•é‚£æ ·é¿å…è¯»å–è¡Œï¼Œä½†ä¸€èˆ¬è¯»è¡Œé€Ÿåº¦å¾ˆå¿«ã€‚</li><li>ä¸æŒ‰ç´¢å¼•å€¼é¡ºåºå­˜å‚¨ï¼Œæ— æ³•ç”¨äºæ’åºã€‚</li><li>ä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•åˆ—åŒ¹é…æŸ¥æ‰¾ã€‚</li><li>åªæ”¯æŒç­‰å€¼æ¯”è¾ƒæŸ¥è¯¢ï¼Œä¸æ”¯æŒä»»ä½•èŒƒå›´æŸ¥è¯¢ã€‚</li><li>å“ˆå¸Œå†²çªéœ€è¦éå†é“¾è¡¨æ‰€æœ‰è¡ŒæŒ‡é’ˆï¼Œæ‰€ä»¥ä¼šå½±å“æ€§èƒ½ã€‚</li></ul><h4 id="1-2-3-ç©ºé—´æ•°æ®ç´¢å¼•ï¼ˆR-Treeï¼‰"><a href="#1-2-3-ç©ºé—´æ•°æ®ç´¢å¼•ï¼ˆR-Treeï¼‰" class="headerlink" title="1.2.3 ç©ºé—´æ•°æ®ç´¢å¼•ï¼ˆR-Treeï¼‰"></a>1.2.3 ç©ºé—´æ•°æ®ç´¢å¼•ï¼ˆR-Treeï¼‰</h4><ul><li>MyISAMæ”¯æŒç©ºé—´ç´¢å¼•ï¼Œç”¨æ¥å­˜å‚¨åœ°ç†ä½ç½®ã€‚</li></ul><h4 id="1-2-4-å…¨æ–‡ç´¢å¼•"><a href="#1-2-4-å…¨æ–‡ç´¢å¼•" class="headerlink" title="1.2.4 å…¨æ–‡ç´¢å¼•"></a>1.2.4 å…¨æ–‡ç´¢å¼•</h4><ul><li>å…¨æ–‡ç´¢å¼•ç±»ä¼¼äºæœç´¢å¼•æ“ï¼ŒæŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒç´¢å¼•çš„å€¼ã€‚</li><li>é€‚ç”¨äº MATCH AGAINST æ“ä½œï¼Œè€Œä¸æ˜¯æ™®é€šçš„ WHERE æ¡ä»¶æ“ä½œã€‚</li></ul><h3 id="1-3-ç´¢å¼•çš„ä¼˜ç‚¹"><a href="#1-3-ç´¢å¼•çš„ä¼˜ç‚¹" class="headerlink" title="1.3 ç´¢å¼•çš„ä¼˜ç‚¹"></a>1.3 ç´¢å¼•çš„ä¼˜ç‚¹</h3><ul><li>æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>é¿å…æ’åºå’Œä¸´æ—¶è¡¨ï¼šB-Treeç´¢å¼•å¯ä»¥ç”¨äº ORDER BY å’Œ GROUP BY æ“ä½œã€‚</li><li>å‡å°‘äº†éœ€è¦æ‰«æçš„æ•°æ®é‡ï¼šæŸäº›æƒ…å†µåªä½¿ç”¨ç´¢å¼•å°±å¯ä»¥å®ŒæˆæŸ¥è¯¢ã€‚</li><li>å°†éšæœºI/Oå˜ä¸ºé¡ºåºI/Oã€‚</li></ul><p>ç´¢å¼•éé“¶å¼¹ï¼Œåªæœ‰åœ¨ç´¢å¼•èƒ½å¤§å¤§æé«˜æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå¤§äºå…¶å¸¦æ¥çš„é¢å¤–å·¥ä½œæ—¶ï¼Œæ‰æ˜¯æœ‰æ•ˆçš„ï¼Œå¯¹äºç‰¹åˆ«å°çš„è¡¨å…¨è¡¨æŸ¥è¯¢å¯èƒ½ä¼šæ›´é«˜æ•ˆï¼Œè€Œç‰¹åˆ«å¤§çš„è¡¨åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼•çš„ä»£ä»·å¯èƒ½è¿‡äºé«˜æ˜‚ã€‚</p><h2 id="äºŒ-é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥"><a href="#äºŒ-é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥" class="headerlink" title="äºŒ. é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥"></a>äºŒ. é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥</h2><h3 id="2-1-ç‹¬ç«‹çš„åˆ—"><a href="#2-1-ç‹¬ç«‹çš„åˆ—" class="headerlink" title="2.1 ç‹¬ç«‹çš„åˆ—"></a>2.1 ç‹¬ç«‹çš„åˆ—</h3><p><strong>ç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°</strong>ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> actor_id <span class="keyword">FROM</span> XXX <span class="keyword">WHERE</span> actor_id + <span class="number">1</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> XXX <span class="keyword">WHERE</span> <span class="keyword">TO_DAYS</span>(<span class="keyword">CURRENT_DATE</span>) - <span class="keyword">TO_DAYS</span>(date_col) &lt;= <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="2-2-å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§"><a href="#2-2-å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§" class="headerlink" title="2.2 å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§"></a>2.2 å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§</h3><p>å½“éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦åˆ—æ—¶ï¼ˆç‰¹åˆ«æ˜¯BLOBã€TEXTæˆ–å¾ˆé•¿çš„VARCHARåªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼‰ï¼Œå¯ä»¥é€‰æ‹©æ¨¡æ‹Ÿå“ˆå¸Œç´¢å¼•ï¼Œä¹Ÿå¯ä»¥åªç´¢å¼•å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ã€‚</p><p>æˆ‘ä»¬éœ€è¦é€‰æ‹©è¶³å¤Ÿé•¿çš„å‰ç¼€ä¿è¯æœ‰è¾ƒé«˜çš„é€‰æ‹©æ€§ï¼Œå¯ä»¥é€šè¿‡çœŸå®æ•°æ®ç»Ÿè®¡å‰ç¼€é•¿åº¦ä¸ºå¤šå°‘æ—¶æœ€åˆé€‚ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--åˆ›å»ºå‰ç¼€ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> XXX <span class="keyword">ADD</span> <span class="keyword">KEY</span> (city(<span class="number">7</span>));</span><br></pre></td></tr></table></figure><p>å‰ç¼€ç´¢å¼•æ— æ³•ç”¨äº ORDER BY å’Œ GROUP BYï¼Œä¹Ÿæ— æ³•åšè¦†ç›–æ‰«æã€‚</p><h3 id="2-3-å¤šåˆ—ç´¢å¼•"><a href="#2-3-å¤šåˆ—ç´¢å¼•" class="headerlink" title="2.3 å¤šåˆ—ç´¢å¼•"></a>2.3 å¤šåˆ—ç´¢å¼•</h3><p>ä¸ºå¤šåˆ—çš„æ¯ä¸ªåˆ—åˆ›å»ºå•ç‹¬çš„ç´¢å¼•ä¸€èˆ¬ä¸èƒ½æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œæœ€å¥½æƒ…å†µä¸‹ä¹Ÿå¯èƒ½ä¸æœ€ä¼˜ç´¢å¼•çš„æ•ˆç‡å·®å‡ ä¸ªæ•°é‡çº§ã€‚</p><p>åœ¨EXPLAINä¸­çœ‹åˆ°ç´¢å¼•åˆå¹¶ï¼ˆindex_mergeï¼‰å¤§éƒ¨åˆ†æƒ…å†µè¯´æ˜ç´¢å¼•æ„å»ºçš„å¾ˆç³Ÿç³•ï¼Œæœ‰æ—¶ç”šè‡³ä¸å¦‚ç›´æ¥æ”¹å†™ä¸ºUNIONçš„æ–¹å¼ã€‚</p><h3 id="2-4-é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº"><a href="#2-4-é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº" class="headerlink" title="2.4 é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº"></a>2.4 é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº</h3><p>ä¸€ä¸ªå¤šåˆ—çš„B-Treeç´¢å¼•ä¼šæŒ‰ç…§æœ€å·¦åˆ—æ’åºï¼Œç„¶åæ˜¯ç¬¬äºŒåˆ—ã€ç¬¬ä¸‰åˆ—ç­‰ç­‰ã€‚<strong>åœ¨ä¸è€ƒè™‘æ’åºå’Œåˆ†ç»„æ—¶ï¼Œå°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—ï¼ˆæ ¹æ®æ¡ä»¶å‘½ä¸­æ¡æ•°æœ€å°‘ï¼‰æ”¾åˆ°ç´¢å¼•çš„æœ€å‰åˆ—</strong>ã€‚</p><p>æ¡ˆä¾‹ï¼š</p><ol><li><p>æ…¢æŸ¥è¯¢SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> threadId) <span class="keyword">AS</span> COUNT_VALUE</span><br><span class="line"><span class="keyword">FROM</span> Message</span><br><span class="line"><span class="keyword">WHERE</span> (groupId = <span class="number">10137</span>) <span class="keyword">AND</span> (userId = <span class="number">1288826</span>) <span class="keyword">AND</span> (anonymous = <span class="number">0</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">priority</span> <span class="keyword">DESC</span>, modifiedDate <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œè®¡åˆ’ï¼šçœ‹ä¼¼é€‰æ‹©äº†ç´¢å¼• <code>(groupId, userId)</code> å¾ˆåˆç†</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">idï¼š<span class="number">1</span></span><br><span class="line">select_typeï¼šSIMPLE</span><br><span class="line"><span class="keyword">table</span>ï¼šMessage</span><br><span class="line"><span class="keyword">type</span>ï¼š<span class="keyword">ref</span></span><br><span class="line">keyï¼šix_groupId_userId</span><br><span class="line">key_lenï¼š<span class="number">18</span></span><br><span class="line"><span class="keyword">ref</span>: <span class="keyword">const</span>,<span class="keyword">const</span></span><br><span class="line">rowsï¼š<span class="number">1251162</span></span><br><span class="line">Extraï¼šUsing where</span><br></pre></td></tr></table></figure></li><li><p>é€‰æ‹©æ€§åˆ†æï¼šæ¡ä»¶å‡ ä¹å‘½ä¸­æ‰€æœ‰è¡Œï¼Œå³ç´¢å¼•æ²¡èµ·åˆ°ä»€ä¹ˆç”¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),              <span class="comment">--4142217</span></span><br><span class="line">       <span class="keyword">SUM</span>(groupId = <span class="number">10137</span>),  <span class="comment">--4092654</span></span><br><span class="line">       <span class="keyword">SUM</span>(userId = <span class="number">1288826</span>), <span class="comment">--1288496</span></span><br><span class="line">       <span class="keyword">SUM</span>(anonymous = <span class="number">0</span>)     <span class="comment">--4141934</span></span><br><span class="line"><span class="keyword">FROM</span> Message</span><br></pre></td></tr></table></figure></li><li><p>è§£å†³æ–¹æ¡ˆæ˜¯ä¿®æ”¹åº”ç”¨ä»£ç ï¼ŒåŒºåˆ†è¿™éƒ¨åˆ†å¼‚å¸¸æ•°æ®ã€‚</p></li></ol><h3 id="2-5-èšç°‡ç´¢å¼•"><a href="#2-5-èšç°‡ç´¢å¼•" class="headerlink" title="2.5 èšç°‡ç´¢å¼•"></a>2.5 èšç°‡ç´¢å¼•</h3><p>èšç°‡ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ï¼ŒInnoDBçš„èšç°‡ç´¢å¼•å®é™…ä¸Šåœ¨åŒä¸€ç»“æ„ä¸­ä¿å­˜äº†B-Treeç´¢å¼•å’Œæ•°æ®è¡Œã€‚èšç°‡è¡¨ç¤ºæ•°æ®è¡Œå’Œç›¸é‚»çš„é”®å€¼ç´§å‡‘çš„å­˜å‚¨åœ¨ä¸€èµ·ï¼Œå½“è¡¨å­˜åœ¨èšç°‡ç´¢å¼•æ—¶ï¼Œå…¶æ•°æ®è¡Œå®é™…å­˜æ”¾åœ¨ç´¢å¼•çš„å¶å­é¡µï¼ˆleaf pageï¼‰ä¸­ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œå¶å­é¡µåŒ…å«äº†è¡Œçš„å…¨éƒ¨æ•°æ®ï¼Œè€ŒèŠ‚ç‚¹é¡µåªåŒ…å«ç´¢å¼•åˆ—ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012280103.png" alt></p><p>InnoDBé€šè¿‡ä¸»é”®èšé›†æ•°æ®ï¼Œè‹¥æ²¡æœ‰æŒ‡å®šä¸»é”®ï¼ŒInnoDBä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿ï¼Œæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•åˆ™ä¼šéšå¼çš„å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ã€‚InnoDBåªèšé›†åŒä¸€ä¸ªé¡µé¢çš„è®°å½•ï¼ŒéåŒä¸€é¡µå³ä½¿ç›¸é‚»é”®å€¼ä¹Ÿå¯èƒ½ç›¸è·ç”šè¿œã€‚</p><p>èšé›†çš„ä¼˜ç‚¹ï¼š</p><ul><li>å°†ç›¸å…³çš„æ•°æ®ä¿å­˜åœ¨ä¸€èµ·ï¼Œå‡å°‘ç£ç›˜I/Oæ“ä½œï¼›</li><li>æ•°æ®è®¿é—®æ›´å¿«ï¼Œå› ä¸ºç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB-Treeã€‚</li><li>ä½¿ç”¨è¦†ç›–ç´¢å¼•æ‰«æçš„æŸ¥è¯¢å¯ä»¥ç›´æ¥ä½¿ç”¨é¡µèŠ‚ç‚¹çš„ä¸»é”®å€¼ã€‚</li></ul><p>èšé›†çš„ç¼ºç‚¹ï¼š</p><ul><li>è‹¥æ•°æ®å­˜æ”¾åœ¨å†…å­˜ï¼Œè®¿é—®é¡ºåºå°±æ²¡é‚£ä¹ˆé‡è¦ï¼Œèšç°‡ç´¢å¼•å¯¹äºI/Oçš„æå‡å°±ä¸æ˜æ˜¾äº†ã€‚</li><li>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåºï¼Œæœ€å¿«æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåºæ’å…¥ï¼Œè‹¥éæ­¤é¡ºåºæœ€å¥½åŠ è½½å®Œæˆåé€šè¿‡ OPTIMIZE TABLE é‡æ–°ç»„ç»‡ä¸€ä¸‹è¡¨ã€‚</li><li>æ›´æ–°èšç°‡ç´¢å¼•çš„ä»£ä»·é«˜æ˜‚ï¼Œä¼šå¼ºåˆ¶InnoDBå°†æ¯ä¸ªè¢«æ›´æ–°çš„è¡Œç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚</li><li>åŸºäºèšç°‡ç´¢å¼•çš„è¡¨åœ¨æ’å…¥æ–°è¡Œã€æˆ–ä¸»é”®æ›´æ–°å¯¼è‡´éœ€è¦ç§»åŠ¨è¡Œæ—¶ï¼Œä¼šé¢ä¸´é¡µåˆ†è£‚é—®é¢˜ã€‚è¡Œéœ€è¦æ’å…¥åˆ°æŸä¸ªå·²æ»¡çš„é¡µä¸­ï¼Œå­˜å‚¨å¼•æ“è¦æŠŠé¡µåˆ†è£‚æˆä¸¤ä¸ªé¡µæ¥å®¹çº³æ–°è¡Œã€‚</li><li>å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æå˜æ…¢ï¼Œç‰¹åˆ«æ˜¯è¡Œæ¯”è¾ƒç¨€ç–æˆ–é¡µåˆ†è£‚å¯¼è‡´æ•°æ®å­˜å‚¨ä¸è¿ç»­çš„æ—¶å€™ã€‚</li><li>äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰è¦æ¯”æƒ³è±¡çš„å¤§ï¼Œå› ä¸ºå¶å­èŠ‚ç‚¹åŒ…å«äº†å¼•ç”¨è¡Œçš„ä¸»é”®åˆ—ã€‚</li><li>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡ã€‚å› ä¸ºäºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¿å­˜çš„ä¸æ˜¯è¡Œçš„ç‰©ç†ä½ç½®ï¼Œè€Œæ˜¯è¡Œçš„ä¸»é”®å€¼ã€‚åœ¨æ‰¾åˆ°äºŒçº§ç´¢å¼•è·å¾—ä¸»é”®å€¼åï¼Œä»éœ€è¦å»èšç°‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„è¡Œã€‚æ‰€ä»¥InnoDBå¼•å…¥è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•å‡å°‘è¿™æ ·çš„é‡å¤å·¥ä½œã€‚</li></ul><p>èšç°‡ç´¢å¼•çš„æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸»é”®å€¼ã€äº‹åŠ¡IDã€ç”¨äºäº‹åŠ¡å’ŒMVCCçš„å›æ»šæŒ‡é’ˆä»¥åŠæ‰€æœ‰çš„å‰©ä½™åˆ—ã€‚è‹¥ä¸»é”®æ˜¯ä¸€ä¸ªåˆ—å‰ç¼€ç´¢å¼•ï¼ŒInnoDBä¹Ÿä¼šåŒ…å«å®Œæ•´çš„ä¸»é”®åˆ—å’Œå‰©ä¸‹çš„å…¶ä»–åˆ—ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012280104.png" alt></p><p>AUTO_INCREMENT è‡ªå¢åˆ—ä¿è¯æ•°æ®è¡Œæ˜¯æŒ‰é¡ºåºå†™å…¥ï¼Œä»æ€§èƒ½è€ƒè™‘ä½¿ç”¨UUIDä½œä¸ºèšç°‡ç´¢å¼•ä¼šå¾ˆç³Ÿç³•ï¼Œæ’å…¥å˜å¾—å®Œå…¨éšæœºã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012280105.png" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012280106.png" alt></p><h3 id="2-6-è¦†ç›–ç´¢å¼•"><a href="#2-6-è¦†ç›–ç´¢å¼•" class="headerlink" title="2.6 è¦†ç›–ç´¢å¼•"></a>2.6 è¦†ç›–ç´¢å¼•</h3><p>è®¾è®¡ç´¢å¼•æ—¶ä¸ä»…ä»…è¦è€ƒè™‘WHEREæ¡ä»¶éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯èƒ½ç›´æ¥é€šè¿‡ç´¢å¼•è·å–åˆ—æ•°æ®çš„æƒ…å†µã€‚<strong>å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œå¯ä»¥è¢«ç§°ä¸ºè¦†ç›–ç´¢å¼•</strong>ã€‚åªæœ‰B-Treeç´¢å¼•å¯ä»¥ä½œä¸ºè¦†ç›–ç´¢å¼•ã€‚åœ¨EXPLAINçš„Extraå¯¹åº” <code>Using index</code> ä¿¡æ¯ã€‚</p><p>InnoDBçš„äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«ä¸»é”®çš„å€¼ï¼Œæ‰€ä»¥å³ä½¿æœ¬èº«æ²¡æœ‰åŒ…å«ä¸»é”®ï¼ŒäºŒçº§ç´¢å¼•ä¹Ÿå¯ä»¥é¢å¤–ç”¨äºå¯¹ä¸»é”®åšè¦†ç›–æŸ¥è¯¢ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å‡å°‘æ•°æ®è®¿é—®é‡ï¼›</li><li>ç´¢å¼•è‡³å°‘åœ¨å•ä¸ªé¡µå†…æ˜¯æŒ‰åˆ—å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥èŒƒå›´æŸ¥è¯¢ç›¸æ¯”éšæœºè¯»å–çš„I/Oå°‘å¾ˆå¤šã€‚</li><li>ç”±äºèšç°‡ç´¢å¼•çš„åŸå› ï¼Œè¦†ç›–ç´¢å¼•å¯¹InnoDBç‰¹åˆ«æœ‰ç”¨ã€‚InnoDBçš„äºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜äº†è¡Œçš„ä¸»é”®å€¼ï¼Œè‹¥äºŒçº§ä¸»é”®å¯ä»¥è¦†ç›–æŸ¥è¯¢ï¼Œå°±å¯ä»¥é¿å…å¯¹ä¸»é”®ç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ã€‚</li></ul><p>å…¨å­—æ®µæ¨¡ç³ŠæŸ¥è¯¢ä¼˜åŒ–ï¼š<strong>å»¶è¿Ÿå…³è”</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> actor = <span class="string">'SEAN CARREY'</span></span><br><span class="line">                                 <span class="keyword">AND</span> title <span class="keyword">like</span> <span class="string">'%APOLLO%'</span>;</span><br><span class="line"><span class="comment">--typeï¼šref</span></span><br><span class="line"><span class="comment">--possible_keysï¼šACTOR,IX_PROD_ACTOR</span></span><br><span class="line"><span class="comment">--keyï¼šACTOR</span></span><br><span class="line"><span class="comment">--key_lenï¼š52</span></span><br><span class="line"><span class="comment">--Extraï¼šUsing where</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--æŸ¥è¯¢é€‰æ‹©äº†è¡¨çš„æ‰€æœ‰åˆ—ï¼Œè€Œæ²¡æœ‰ç´¢å¼•è¦†ç›–äº†è¿™ä¹ˆå¤šåˆ—ï¼Œä½†WHEREæ¡ä»¶actorå‘½ä¸­äº†ç´¢å¼•ï¼ŒMySQLä¸èƒ½å†ç´¢å¼•ä¸­æ‰§è¡ŒLIKEæ“ä½œ</span></span><br><span class="line"><span class="comment">--ä¼˜åŒ–æ–¹æ¡ˆï¼šåˆ›å»ºç´¢å¼•(artist,title,prod_id)</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> products </span><br><span class="line"><span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> prod_id <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> actor = <span class="string">'SEAN CARREY'</span></span><br><span class="line">                                     <span class="keyword">AND</span> title <span class="keyword">like</span> <span class="string">'%APOLLO%'</span>;) AS T1 ON (t1.prod_id=products.prod_id)</span><br><span class="line"><span class="comment">--1.select_type: PRIMARY</span></span><br><span class="line"><span class="comment">--2.select_type: PRIMARY</span></span><br><span class="line"><span class="comment">--3.select_type: DERIVED</span></span><br><span class="line"><span class="comment">--3.type: ref</span></span><br><span class="line"><span class="comment">--3.key: ACTOR_2</span></span><br><span class="line"><span class="comment">--3.Extra: Using where; Using index</span></span><br></pre></td></tr></table></figure><h3 id="2-7-ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"><a href="#2-7-ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº" class="headerlink" title="2.7 ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº"></a>2.7 ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº</h3><p>ä¸¤ç§æ–¹å¼ç”Ÿæˆæœ‰åºç»“æœï¼š</p><ol><li>æ’åºæ“ä½œï¼›</li><li>æŒ‰ç´¢å¼•é¡ºåºæ‰«æã€‚EXPLAINå¾—åˆ°typeå€¼ä¸ºindexã€‚</li></ol><p>åªæ‰«æç´¢å¼•æœ¬èº«å¾ˆå¿«ï¼Œä½†å¦‚æœä¸èƒ½è¦†ç›–æ‰€æœ‰åˆ—ï¼Œå°±éœ€è¦å›è¡¨æŸ¥è¯¢ä¸€æ¬¡ï¼Œè€Œå›è¡¨æŸ¥è¯¢åŸºæœ¬æ˜¯éšæœºI/Oï¼Œç›¸æ¯”é¡ºåºåœ°å…¨è¡¨æ‰«æè¦æ…¢ã€‚</p><p>åªæœ‰ç´¢å¼•é¡ºåºå’Œ ORDER BY æ“ä½œé¡ºåºä¸€æ ·æ—¶ï¼Œæ‰å¯ä»¥ä½œä¸ºæ’åºç»“æœã€‚</p><h3 id="2-8-å‹ç¼©ç´¢å¼•"><a href="#2-8-å‹ç¼©ç´¢å¼•" class="headerlink" title="2.8 å‹ç¼©ç´¢å¼•"></a>2.8 å‹ç¼©ç´¢å¼•</h3><p>MyISAMä½¿ç”¨å‰ç¼€å‹ç¼©æ¥å‡å°ç´¢å¼•çš„å¤§å°ï¼Œæ¯”å¦‚ç´¢å¼•å—ç¬¬ä¸€ä¸ªå€¼æ˜¯â€œperformâ€ï¼Œç¬¬äºŒä¸ªå€¼æ˜¯â€œperformanceâ€ï¼Œå‹ç¼©åç¬¬äºŒä¸ªå€¼æ˜¯â€œ7,anceâ€ï¼Œå‡å°‘ç©ºé—´çš„ä»£ä»·æ˜¯æŸäº›æ“ä½œä¼šæ›´æ…¢ï¼Œå› ä¸ºå‰åçš„ä¾èµ–æ€§æ‰€ä»¥æ— æ³•ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚</p><h3 id="2-9-å†—ä½™å’Œé‡å¤ç´¢å¼•"><a href="#2-9-å†—ä½™å’Œé‡å¤ç´¢å¼•" class="headerlink" title="2.9 å†—ä½™å’Œé‡å¤ç´¢å¼•"></a>2.9 å†—ä½™å’Œé‡å¤ç´¢å¼•</h3><ul><li><strong>äº§ç”Ÿå†—ä½™å’Œé‡å¤ç´¢å¼•çš„åŸå› </strong>ï¼š<ul><li>MySQLå…è®¸åœ¨ç›¸åŒåˆ—ä¸Šåˆ›å»ºå¤šä¸ªç´¢å¼•ï¼Œä½†éœ€è¦å•ç‹¬ç»´æŠ¤é‡å¤çš„ç´¢å¼•ï¼Œä¸”ä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–æŸ¥è¯¢æ—¶ä¹Ÿè¦é€ä¸ªè€ƒè™‘ã€‚</li><li>é‡å¤ç´¢å¼•å¯èƒ½ä¼šå› ä¸ºä¸€äº›å¤±è¯¯æ„å»ºå‡ºæ¥ï¼Œå¦‚è‹¥å‘ç°åº”ç§»é™¤ã€‚è¡¨ä¸­ç´¢å¼•è¶Šå¤šä¼šå¯¼è‡´INSERTã€UPDATEã€DELETEé€Ÿåº¦è¶Šæ…¢</li></ul></li><li><strong>åŒºåˆ†å†—ä½™ç´¢å¼•</strong>ï¼š(A)æ˜¯(A,B)çš„å†—ä½™ç´¢å¼•ï¼Œä½†(B,A)æˆ–(B)åˆ™ä¸æ˜¯å†—ä½™ç´¢å¼•ã€‚å°½é‡æ‰©å±•æ—§ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•ï¼Œæœ‰æ—¶ä¹Ÿä¼šéœ€è¦å†—ä½™ç´¢å¼•ï¼Œå› ä¸ºæ‰©å±•å·²æœ‰ç´¢å¼•å¯èƒ½ä¼šå¯¼è‡´å…¶å˜å¾—å¤ªå¤§ï¼Œä»è€Œå½±å“å…¶ä»–ä½¿ç”¨è¯¥ç´¢å¼•çš„æŸ¥è¯¢ã€‚</li><li><strong>å¦‚ä½•æ‰¾åˆ°å†—ä½™å’Œé‡å¤ç´¢å¼•</strong>ï¼š<ul><li>å¯ä»¥é€šè¿‡è‡ªå·±ç¼–å†™æŸ¥è¯¢è®¿é—® INFORMATION_SCHEMA è¡¨ï¼›</li><li>æˆ–æ˜¯é€šè¿‡å¦‚ Shlomi Noach çš„ common_schema ä»¥åŠ Percona Tookit çš„ pt-duplicate-key-checker ç­‰å·¥å…·æ‰¾å‡ºå†—ä½™å’Œé‡å¤çš„ç´¢å¼•å¹¶åˆ é™¤ã€‚</li></ul></li></ul><h3 id="2-10-ç´¢å¼•å’Œé”"><a href="#2-10-ç´¢å¼•å’Œé”" class="headerlink" title="2.10 ç´¢å¼•å’Œé”"></a>2.10 ç´¢å¼•å’Œé”</h3><p>ç´¢å¼•å¯ä»¥ä½¿æŸ¥è¯¢é”å®šæ›´å°‘çš„è¡Œï¼ŒInnoDBåªæœ‰åœ¨è®¿é—®è¡Œæ—¶æ‰ä¼šå¯¹å…¶åŠ é”ï¼Œç´¢å¼•å¯ä»¥å‡å°‘è®¿é—®çš„è¡Œæ•°ï¼Œéœ€è¦å­˜å‚¨å¼•æ“èƒ½å¤Ÿè¿‡æ»¤æ‰ä¸éœ€è¦çš„è¡Œã€‚</p><p>æŸ¥è¯¢åªè¿”å›2~4ä¹‹é—´çš„è¡Œï¼Œä½†å´è·å–äº†1åˆ°4ä¹‹é—´è¡Œçš„æ’å®ƒé”ï¼Œå› ä¸ºMySQLä¸ºæŸ¥è¯¢é€‰æ‹©çš„æ‰§è¡Œè®¡åˆ’æ˜¯ç´¢å¼•èŒƒå›´æ‰«æã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> AUTOCOMMIT=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> actor_id </span><br><span class="line"><span class="keyword">FROM</span> XXX </span><br><span class="line"><span class="keyword">WHERE</span> actor_id &lt; <span class="number">5</span></span><br><span class="line">  <span class="keyword">AND</span> actor_id &lt;&gt; <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>å­˜å‚¨å¼•æ“ä»ç´¢å¼•å¼€å¤´è·å–æ»¡è¶³ <code>actor_id &lt; 5</code> çš„è®°å½•ï¼Œå¹¶ä¸çŸ¥é“å¯ä»¥è¿‡æ»¤ç¬¬ä¸€è¡Œè®°å½•ï¼Œ<code>Using where</code> è¡¨ç¤ºMySQLæœåŠ¡å™¨å°†å­˜å‚¨å¼•æ“è¿”å›è¡Œä»¥åå†åº”ç”¨è¿‡æ»¤æ¡ä»¶ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> actor_id </span><br><span class="line"><span class="keyword">FROM</span> XXX </span><br><span class="line"><span class="keyword">WHERE</span> actor_id &lt; <span class="number">5</span></span><br><span class="line">  <span class="keyword">AND</span> actor_id &lt;&gt; <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">--type: range</span></span><br><span class="line"><span class="comment">--key: PRIMARY</span></span><br><span class="line"><span class="comment">--Extra: Using where; Using index</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä¿è¯ç¬¬ä¸€ä¸ªè¿æ¥æ‰“å¼€ï¼Œå†å¼€å¯ç¬¬äºŒä¸ªè¿æ¥æŸ¥è¯¢ç¬¬ä¸€è¡Œè®°å½•ï¼Œæ­¤æŸ¥è¯¢ä¼šè¢«æŒ‚èµ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> actor_id </span><br><span class="line"><span class="keyword">FROM</span> XXX </span><br><span class="line"><span class="keyword">WHERE</span> actor_id = <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>InnoDBåœ¨äºŒçº§ç´¢å¼•ä¸Šä½¿ç”¨å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼Œä½†è®¿é—®ä¸»é”®ç´¢å¼•éœ€è¦æ’å®ƒé”ï¼ˆå†™é”ï¼‰ï¼Œä»è€Œæ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œä½¿SELECT FOR UPDATE æ¯” LOCK IN SHARE MODE æˆ–éé”å®šæŸ¥è¯¢è¦æ…¢å¾ˆå¤šã€‚</p><h3 id="2-11-å®ç”¨æŠ€å·§"><a href="#2-11-å®ç”¨æŠ€å·§" class="headerlink" title="2.11 å®ç”¨æŠ€å·§"></a>2.11 å®ç”¨æŠ€å·§</h3><ul><li>å®é™…åˆ›å»ºç´¢å¼•æ—¶ç»å¸¸ä¼šå°†ä¸€äº›é€‰æ‹©æ€§ä¸é«˜ä½†é¢‘ç¹ä½¿ç”¨çš„åˆ—ä½œä¸ºç´¢å¼•å‰ç¼€åˆ—ï¼Œå¦‚æ€§åˆ«SEXï¼Œå³ä½¿æŸäº›æŸ¥è¯¢ä¸éœ€è¦è¿™äº›åˆ—ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Š <code>SEX IN(&#39;m&#39;,&#39;f&#39;)</code> æ¥åŒ¹é…ç´¢å¼•ï¼ˆä»…ä½¿ç”¨åˆ—è¡¨å€¼ä¸å¤šæ—¶ï¼‰ã€‚</li><li>ä¸€äº›å¸¸ç”¨äºèŒƒå›´æŸ¥è¯¢çš„åˆ—å°½é‡æ”¾åœ¨ç»„åˆç´¢å¼•çš„æœ€åï¼Œæ¯”å¦‚æ—¥æœŸã€å¹´çºªç­‰ï¼Œå› ä¸ºåŒ¹é…ç´¢å¼•ä¼šåœ¨ç¬¬ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ç»ˆæ­¢ï¼Œå½“ç„¶ä¸€äº›æƒ…å†µä¹Ÿå¯ä»¥ç”¨INæ¥ä»£æ›¿èŒƒå›´æŸ¥è¯¢ã€‚</li><li>é€šè¿‡æ‰§è¡Œ <code>OPTIMIZE TABLE</code> æˆ–è€…å¯¼å‡ºå†å¯¼å…¥çš„æ–¹å¼é‡æ–°æ•´ç†æ•°æ®ï¼Œè¿™æ ·å¯ä»¥æ¶ˆé™¤ç´¢å¼•å’Œæ•°æ®çš„ç¢ç‰‡åŒ–ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012280107.png" alt></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šé«˜æ€§èƒ½MySQLã€‹</p>]]></content>
    
    <summary type="html">
    
      ã€Šé«˜æ€§èƒ½MySQLã€‹è¯»ä¹¦ç¬”è®°ï¼Œå†…å®¹ï¼šç´¢å¼•æ¦‚è¿°ï¼Œå¸¸è§ç´¢å¼•ç±»å‹ï¼Œç´¢å¼•ä¼˜ç¼ºç‚¹ï¼Œé«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥åŒ…æ‹¬å‰ç¼€ç´¢å¼•ã€ç»„åˆç´¢å¼•ã€èšç°‡ç´¢å¼•ã€è¦†ç›–ç´¢å¼•ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸‰ï¼‰Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–</title>
    <link href="http://linyishui.top/2020122001.html"/>
    <id>http://linyishui.top/2020122001.html</id>
    <published>2020-12-20T12:14:19.000Z</published>
    <updated>2020-12-29T12:29:28.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸‰ï¼‰Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–"><a href="#ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸‰ï¼‰Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–" class="headerlink" title="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸‰ï¼‰Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–"></a>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸‰ï¼‰Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–</h1><h2 id="ä¸€-é€‰æ‹©ä¼˜åŒ–çš„æ•°æ®ç±»å‹"><a href="#ä¸€-é€‰æ‹©ä¼˜åŒ–çš„æ•°æ®ç±»å‹" class="headerlink" title="ä¸€. é€‰æ‹©ä¼˜åŒ–çš„æ•°æ®ç±»å‹"></a>ä¸€. é€‰æ‹©ä¼˜åŒ–çš„æ•°æ®ç±»å‹</h2><ul><li>å°½é‡ä½¿ç”¨èƒ½æ­£ç¡®å­˜å‚¨æ•°æ®çš„æœ€å°æ•°æ®ç±»å‹ï¼›</li><li>æ•´å‹æ¯”å­—ç¬¦ä¸²æ“ä½œä»£ä»·æ›´ä½ï¼Œå­—ç¬¦æ¯”è¾ƒçš„å­—ç¬¦é›†å’Œæ ¡å¯¹è§„åˆ™æ›´å¤æ‚ï¼Œå¦‚æ—¶é—´ç­‰åº”è¯¥ç”¨æ•°å­—å­˜å‚¨ï¼›</li><li>å°½é‡é¿å…NULLï¼Œå¯ä¸ºNULLçš„åˆ—éœ€è¦æ›´å¤šçš„ç©ºé—´ï¼Œç´¢å¼•æ„å»ºæ›´å¤æ‚ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºç´¢å¼•çš„åˆ—å°½é‡æ˜¯NOT NULLï¼›</li><li>ç›¸åŒç±»å‹çš„æ•°æ®ï¼Œä½†é•¿åº¦èŒƒå›´ä¸åŒã€ç²¾åº¦ä¸åŒã€éœ€è¦çš„ç‰©ç†ç©ºé—´ä¹Ÿä¸åŒï¼Œä¾‹å¦‚ DATETIME å’Œ TIMESTAMP éƒ½å­˜å‚¨æ—¶é—´å’Œæ—¥æœŸï¼Œç²¾ç¡®åˆ°ç§’ï¼ŒTIMESTAMPåªä¼šç”¨DATETIMEä¸€åŠçš„ç©ºé—´</li><li>MySQLçš„æ•°å­—ç±»å‹åˆ†æ•´æ•°ç±»å‹å’Œå®æ•°ç±»å‹ï¼Œå…¶ä¸­ DECIMAL æ”¯æŒé«˜ç²¾åº¦è®¡ç®—ï¼Œå¦‚ DECIMAL(18, 9) å°æ•°ç‚¹ä¸¤è¾¹å°†å„å­˜9ä¸ªæ•°å­—ï¼Œå°æ•°ç‚¹å ä¸€ä¸ªå­—èŠ‚ï¼Œæ€»å…±å 9ä¸ªå­—èŠ‚ã€‚å†…éƒ¨æµ®ç‚¹è®¡ç®—ç»Ÿä¸€ä½¿ç”¨ DOUBLE ï¼ŒDECIMAL åªæ˜¯å­˜å‚¨ç±»å‹ã€‚DECIMAL ä¼šéœ€è¦é¢å¤–çš„ç©ºé—´å’Œè®¡ç®—å¼€é”€</li><li>å­—ç¬¦ä¸²ç±»å‹ï¼š<ul><li>VARCHARï¼šå¯å˜é•¿å­—ç¬¦ä¸²ï¼Œä»…ä½¿ç”¨å¿…è¦ç©ºé—´ï¼ˆé™¤éROW_FORMAT=FIXEDï¼‰ï¼Œä½¿ç”¨ä¸€ä¸ªæˆ–ä¸¤ä¸ªå­—èŠ‚å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦ã€‚æ²¡æœ‰é“¶å¼¹ï¼ŒèŠ‚çœç©ºé—´çš„å¸¦æ¥çš„æ˜¯UPDATEéœ€è¦é¢å¤–çš„å¼€é”€ï¼ˆé¡µå·²æ»¡InnoDBä¼šåˆ†è£‚é¡µä½¿æ–°è¡Œå¯ä»¥æ”¾å…¥é¡µå†…ï¼‰</li><li>CHARï¼šå®šé•¿å­—ç¬¦ä¸²ï¼Œæ ¹æ®å®šä¹‰çš„é•¿åº¦åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ã€‚é€‚åˆå­˜å‚¨å®šé•¿æˆ–ç»å¸¸ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºå®šé•¿ç±»å‹ä¸å®¹æ˜“äº§ç”Ÿç¢ç‰‡ï¼›çŸ­åˆ—å¦‚CHAR(1)åªéœ€ä¸€ä¸ªå­—èŠ‚ï¼Œè€ŒVARCHAR(2)éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå­—èŠ‚å­˜æ”¾é•¿åº¦ã€‚</li></ul></li><li>BLOBå’ŒTEXTï¼šåˆ†åˆ«é‡‡ç”¨äºŒè¿›åˆ¶å’Œå­—ç¬¦ä¸²å­˜å‚¨è¾ƒå¤§æ•°æ®ã€‚<ul><li>ä¸åŒç±»å‹å®¶æ—ï¼šTINYBLOBã€SMALLBLOB / BLOBã€MEDIUMBLOBã€LONGBLOB å’Œ TINYTEXTã€SMALLTEXT / TEXTã€MEDIUMTEXTã€LONGTEXT</li><li>å½“æ•°æ®è¾ƒå¤§æ—¶ï¼ŒMySQLä¼šä½¿ç”¨å¤–éƒ¨åŒºåŸŸå­˜æ”¾å€¼ï¼Œè¡Œå†…éœ€è¦ä¸ºæ¯ä¸ªå€¼æ”¾1~4ä¸ªå­—èŠ‚çš„æŒ‡é’ˆã€‚</li><li>æ’åºæ—¶åªä¼šå¯¹å‰ <code>max_sort_length</code> ä¸ªå­—èŠ‚æ’åºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>ORDER BY SUSTRING(column, length)</code> ã€‚</li></ul></li><li>æ—¥æœŸå’Œæ—¶é—´ç±»å‹ï¼š<ul><li>DATETIMEï¼š1001å¹´åˆ°9999å¹´ï¼Œç²¾åº¦ä¸ºç§’ï¼Œæ ¼å¼ä¸ºYYYYMMDDHHMMSSçš„æ•´æ•°ï¼Œä¸æ—¶åŒºæ— å…³ï¼Œå ç”¨8ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œæ—¶é—´å€¼çš„æ˜¾å¼ä¼šå› ä¸ºæ—¶åŒºä¸åŒè€Œä¸åŒã€‚</li><li>TIMESTAMPï¼š1970å¹´åˆ°2038å¹´ï¼Œä¿å­˜ä»1970å¹´1æœˆ1æ—¥åˆå¤œä»¥æ¥çš„ç§’æ•°ï¼ˆæ ¼æ—å°¼æ²»æ—¶é—´ï¼‰ï¼Œåªä½¿ç”¨4ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œæ—¶é—´å€¼çš„æ˜¾å¼ä¼šå› ä¸ºæ—¶åŒºä¸åŒè€Œä¸åŒã€‚</li></ul></li><li>ä½æ•°æ®ç±»å‹ï¼š<ul><li>BITï¼šæ—§ç‰ˆæœ¬BITç­‰ä»·äºTINYINTï¼ŒBIT(1)å­˜æ”¾ä¸€ä¸ªä½ï¼Œæœ€å¤§ä¸º64ä½ã€‚BITå±äºå­—ç¬¦ä¸²ç±»å‹ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</li><li>SET</li></ul></li><li>ç‰¹æ®Šç±»å‹ï¼š<ul><li>ä½äºç§’ç²¾åº¦çš„æ—¶é—´æˆ³</li><li>IPv4åœ°å€ï¼Œç»å¸¸ç”¨ VARCHAR(15) å­˜æ”¾IPåœ°å€ï¼Œå®é™…ä¸Šæœ¬è´¨æ˜¯32ä½æ— ç¬¦å·æ•´æ•°ï¼Œå°æ•°ç‚¹åªæ˜¯æ–¹ä¾¿é˜…è¯»ï¼Œä½¿ç”¨æ— ç¬¦å·æ•´æ•°å­˜æ”¾ï¼ŒMySQLè¿˜æä¾›äº† <code>INET_ATON()</code> å’Œ <code>INET_NTOA()</code> æ¥åœ¨äºŒè€…é—´è½¬æ¢ã€‚ </li></ul></li></ul><h2 id="äºŒ-é€‰æ‹©åˆé€‚çš„æ ‡è¯†åˆ—"><a href="#äºŒ-é€‰æ‹©åˆé€‚çš„æ ‡è¯†åˆ—" class="headerlink" title="äºŒ. é€‰æ‹©åˆé€‚çš„æ ‡è¯†åˆ—"></a>äºŒ. é€‰æ‹©åˆé€‚çš„æ ‡è¯†åˆ—</h2><p>æ ‡è¯†åˆ—è¦å¸¸ç”¨äºæ¯”è¾ƒï¼ˆå¦‚å…³è”æ“ä½œï¼‰ã€ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€å¤–é”®ç­‰ã€‚ä¸åŒè¡¨çš„ç›¸åŒæ ‡è¯†åˆ—è¦ä¿æŒæ•°æ®ç±»å‹ä¸€è‡´ï¼Œå¹¶ä¸”åœ¨é€‰æ‹©æ•°æ®ç±»å‹æ—¶è€ƒè™‘MySQLå¦‚ä½•æ‰§è¡Œè®¡ç®—å’Œæ¯”è¾ƒï¼ˆå¦‚ENUMå’ŒSETä½¿ç”¨æ•´æ•°å­˜å‚¨ï¼Œæ¯”è¾ƒæ—¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼‰ã€‚</p><ul><li><strong>æ•´æ•°ç±»å‹</strong>ï¼šæœ€é€‚åˆçš„æ ‡è¯†åˆ—ç±»å‹ï¼Œæ•ˆç‡é«˜å¹¶ä¸”å¯ä»¥ AUTO_INCREMENT ã€‚</li><li><strong>ENUMå’ŒSETç±»å‹</strong>ï¼šç³Ÿç³•çš„é€‰æ‹©ã€‚</li><li><strong>å­—ç¬¦ä¸²ç±»å‹</strong>ï¼šæ¶ˆè€—ç©ºé—´ï¼Œå¹¶ä¸”æ•ˆç‡å·®äºæ•°å­—ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ä¼šä»»æ„åˆ†å¸ƒåœ¨å¾ˆå¤§çš„ç©ºé—´å†…ï¼Œå¯¼è‡´INSERTæˆ–SELECTæ‰§è¡Œå¾ˆæ…¢ã€‚å­˜å‚¨UUIDåº”è¯¥å»æ‰ <code>-</code> ï¼Œç›´æ¥ç”¨ <code>UNHEX()</code> å‡½æ•°è½¬æ¢ä¸º16å­—èŠ‚æ•°å­—å­˜æ”¾åœ¨ BINARY(16) åˆ—ä¸­ï¼Œæ£€ç´¢æ—¶ä½¿ç”¨ <code>HEX()</code> æ ¼å¼åŒ–ä¸ºåå…­è¿›åˆ¶æ ¼å¼ã€‚<ul><li>æ’å…¥å€¼éšæœºå†™åˆ°ç´¢å¼•çš„ä¸åŒä½ç½®ï¼Œä½¿INSERTå˜æ…¢ï¼Œä¼šå¯¼è‡´é¡µåˆ†è£‚ã€ç£ç›˜éšæœºè®¿é—®ã€å¯¹äºèšç°‡å­˜å‚¨å¼•æ“äº§ç”Ÿèšç°‡ç´¢å¼•ç¢ç‰‡ã€‚</li><li>é€»è¾‘ä¸Šç›¸é‚»çš„è¡Œåˆ†å¸ƒåœ¨ç£ç›˜å’Œå†…å­˜çš„ä¸åŒåœ°æ–¹ï¼Œä½¿SELECTå˜æ…¢ã€‚</li><li>éšæœºå€¼å¯¼è‡´ç¼“å­˜èµ–ä»¥å·¥ä½œçš„è®¿é—®å±€éƒ¨æ€§åŸç†å¤±æ•ˆï¼Œæ•´ä¸ªæ•°æ®é›†éƒ½ä¸€æ ·â€œçƒ­â€ï¼Œç¼“å­˜å¸¦æ¥çš„å¥½å¤„å°±æ¶ˆå¤±äº†ã€‚</li></ul></li></ul><h2 id="ä¸‰-å¸¸è§è®¾è®¡é™·é˜±"><a href="#ä¸‰-å¸¸è§è®¾è®¡é™·é˜±" class="headerlink" title="ä¸‰. å¸¸è§è®¾è®¡é™·é˜±"></a>ä¸‰. å¸¸è§è®¾è®¡é™·é˜±</h2><ol><li><strong>å¤ªå¤šçš„åˆ—</strong>ï¼šMySQLå­˜å‚¨å¼•æ“APIå·¥ä½œæ—¶éœ€è¦åœ¨æœåŠ¡å™¨å±‚å’Œå­˜å‚¨å¼•æ“å±‚ä¹‹é—´é€šè¿‡è¡Œç¼“å†²æ ¼å¼æ‹·è´æ•°æ®ï¼Œåœ¨æœåŠ¡å™¨å±‚å°†ç¼“å†²è½¬ç ä¸ºå„ä¸ªåˆ—ï¼Œå°†ç¼–ç åçš„å†…å®¹è½¬ç ä¸ºå„ä¸ªè¡Œçš„æ•°æ®æ ¼å¼æ“ä½œä»£ä»·è¾ƒé«˜ï¼Œæ‰€ä»¥å°½é‡é¿å…ä¸Šåƒä¸ªå±æ€§è¿™ç§æç«¯æƒ…å†µã€‚</li><li><strong>å¤ªå¤šçš„å…³è”</strong>ï¼šæœŸæœ›æŸ¥è¯¢èƒ½å¤Ÿå¿«é€Ÿçš„æ‰§è¡Œä¸”å¹¶å‘æ€§å¥½ï¼Œå•ä¸ªæŸ¥è¯¢ä¸è¦è¶…è¿‡12ä¸ªè¡¨å…³è”ã€‚</li><li><strong>é¿å…æ»¥ç”¨æšä¸¾</strong>ï¼šä¿®æ”¹æšä¸¾ä¸­å€¼ä¼šè¿›è¡Œä¸€æ¬¡ ALTER TABLE æ“ä½œã€‚</li></ol><h2 id="å››-èŒƒå¼å’ŒåèŒƒå¼"><a href="#å››-èŒƒå¼å’ŒåèŒƒå¼" class="headerlink" title="å››. èŒƒå¼å’ŒåèŒƒå¼"></a>å››. èŒƒå¼å’ŒåèŒƒå¼</h2><p>èŒƒå¼åŒ–çš„æ•°æ®åº“ä¸­ï¼Œäº‹å®æ•°æ®ä»…å‡ºç°ä¸€æ¬¡ï¼›åèŒƒå¼åŒ–çš„æ•°æ®åº“ä¸­ï¼Œä¿¡æ¯æ˜¯å†—ä½™çš„ã€‚</p><p>èŒƒå¼çš„ä¼˜ç‚¹ï¼š</p><ul><li>æ›´æ–°æ“ä½œæ›´å¿«ï¼›</li><li>å¾ˆå°‘æœ‰é‡å¤æ•°æ®ï¼Œéœ€è¦ä¿®æ”¹çš„æ•°æ®æ›´å°‘ï¼›</li><li>è¡¨ç©ºé—´æ›´å°ï¼Œåœ¨å†…å­˜ä¸­æ‰§è¡Œæ›´å¿«ï¼›</li><li>å¾ˆå°‘æœ‰å¤šä½™æ•°æ®ï¼Œæ‰€ä»¥æ›´å°‘éœ€è¦ DISTINCT æˆ– GROUP BY è¯­å¥ã€‚</li></ul><p>èŒƒå¼çš„ç¼ºç‚¹ï¼š</p><ul><li>å¸¸å¸¸éœ€è¦å…³è”ï¼Œä¸ä½†ä»£ä»·æ˜‚è´µï¼Œä¹Ÿå¯èƒ½ä½¿ç´¢å¼•ç­–ç•¥æ— æ•ˆã€‚</li></ul><p>åèŒƒå¼çš„ä¼˜ç‚¹ï¼š</p><ul><li>æ•°æ®éƒ½åœ¨ä¸€å¼ è¡¨ï¼Œæ‰€ä»¥å¾ˆå°‘å…³è”ï¼›</li><li>å…¨è¡¨æ‰«æåŸºæœ¬æ˜¯é¡ºåºI/Oï¼Œä¸éœ€è¦å…³è”è¡¨é¿å…äº†éšæœºI/Oï¼›</li><li>å¯ä»¥æ„å»ºæœ‰æ•ˆçš„ç´¢å¼•ç­–ç•¥ï¼›</li></ul><p>çœŸå®çš„å¼€å‘ä¸­å¾ˆå°‘ä¼šæç«¯çš„éµå¾ªèŒƒå¼æˆ–åèŒƒå¼ï¼Œè€Œæ˜¯æ··ç”¨äºŒè€…ï¼›å¸¸è§å¦‚<strong>å¤åˆ¶</strong>æˆ–<strong>ç¼“å­˜</strong>ï¼Œåœ¨ä¸åŒçš„è¡¨å­˜å‚¨ç›¸åŒçš„åˆ—ï¼Œå†—ä½™çš„å­—æ®µå¾€å¾€æœ‰å…¶æ„ä¹‰ï¼Œæ¯”å¦‚æ’åºéœ€æ±‚ã€é¿å…å…³è”ã€é¿å…å¤šæ¬¡æŸ¥è¯¢ç­‰ç­‰ã€‚</p><h2 id="äº”-ç¼“å­˜è¡¨å’Œæ±‡æ€»è¡¨"><a href="#äº”-ç¼“å­˜è¡¨å’Œæ±‡æ€»è¡¨" class="headerlink" title="äº”. ç¼“å­˜è¡¨å’Œæ±‡æ€»è¡¨"></a>äº”. ç¼“å­˜è¡¨å’Œæ±‡æ€»è¡¨</h2><p>è™½ç„¶å†—ä½™æ•°æ®èƒ½å¤Ÿå¾ˆå¥½çš„æå‡æ€§èƒ½ï¼Œä½†æœ‰æ—¶è¿˜æ˜¯éœ€è¦åˆ›å»ºä¸€å¼ å®Œå…¨ç‹¬ç«‹çš„æ±‡æ€»è¡¨æˆ–ç¼“å­˜è¡¨ã€‚</p><p>ä¸€èˆ¬ç¼“å­˜è¡¨ç”¨æ¥å­˜æ”¾é‚£äº›å¯ä»¥ç®€å•è·å–ä½†è·å–é€Ÿåº¦è¾ƒæ…¢çš„æ•°æ®ï¼ˆé€»è¾‘ä¸Šå†—ä½™çš„æ•°æ®ï¼‰ï¼›æ±‡æ€»è¡¨åˆ™å­˜æ”¾ä½¿ç”¨ GROUP BY è¯­å¥èšåˆçš„æ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘ç«™éœ€è¦è®¡ç®—ä¹‹å‰24å°æ—¶å‘é€çš„æ¶ˆæ¯æ•°ï¼Œå¯ä»¥æ¯å°æ—¶ç”Ÿæˆä¸€å¼ æ±‡æ€»è¡¨ï¼ˆRedisåº”è¯¥æ˜¯æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼‰ï¼Œè¿™æ ·æ¯”å®æ—¶ç»´æŠ¤è®¡æ•°å™¨è¦é«˜æ•ˆçš„å¤šï¼Œä½†å¹¶ä¸ç²¾ç¡®ã€‚è¿™ç§æ–¹æ¡ˆè¦è¿œè¿œå¿«äºç»Ÿè®¡messageä¸­æ‰€æœ‰è¡Œï¼Œå®æ—¶è®¡ç®—ç»Ÿè®¡å€¼éœ€è¦æ‰«æè¡¨ä¸­çš„å¤§éƒ¨åˆ†æ•°æ®ï¼Œéœ€è¦çš„ç´¢å¼•ä¹Ÿä¸€èˆ¬ä¼šå½±å“åˆ°UPDATEæ“ä½œï¼ˆæ‰€ä»¥ä¸€èˆ¬ä¸å¸Œæœ›åˆ›å»ºè¿™ç±»ç´¢å¼•ï¼‰ã€‚</p><p>ç¼“å­˜è¡¨å¯ä»¥é‡‡ç”¨ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œæ¯”å¦‚ä¸»è¡¨æ˜¯InnoDBï¼Œç¼“å­˜è¡¨åˆ™ä½¿ç”¨MyISAMï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°æ›´å°çš„ç´¢å¼•å ç”¨ç©ºé—´ï¼Œå¹¶ä¸”å¯ä»¥åšå…¨æ–‡æœç´¢ã€‚</p><p>ä½¿ç”¨ç¼“å­˜è¡¨å’Œæ±‡æ€»è¡¨éœ€è¦å†³å®šæ˜¯å®æ—¶ç»´æŠ¤æ•°æ®è¿˜æ˜¯å®šæœŸé‡å»ºï¼Œé‡å»ºéœ€è¦ä¿è¯æ•°æ®åœ¨æ“ä½œæ—¶ä¾ç„¶å¯ç”¨ï¼Œæ‰€ä»¥éœ€è¦â€œå½±å­è¡¨â€å®ç°ï¼Œå³æ ¹æ®çœŸå®è¡¨åˆ›å»ºä¸€å¼ å½±å­è¡¨ï¼Œå®Œæˆå»ºè¡¨åï¼Œé€šè¿‡ä¸€ä¸ªåŸå­æ€§çš„é‡å‘½åæ“ä½œåˆ‡æ¢å½±å­è¡¨å’ŒåŸè¡¨ã€‚</p><p><strong>æ›´å¿«çš„è¯»ï¼Œæ›´æ…¢çš„å†™</strong>ï¼Œä¸ºäº†å¢åŠ è¯»æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œä¼šç»å¸¸å»ºä¸€äº›é¢å¤–ç´¢å¼•ã€å¢åŠ å†—ä½™åˆ—ï¼Œç”šè‡³åˆ›å»ºç¼“å­˜è¡¨å’Œæ±‡æ€»è¡¨ã€‚è¿™äº›éƒ½ä¼šå¯¼è‡´å†™æŸ¥è¯¢å˜æ…¢ï¼Œå¼€å‘éš¾åº¦æå‡ï¼Œä½†èƒ½æ˜¾è‘—æé«˜è¯»æ“ä½œçš„æ€§èƒ½ã€‚</p><h2 id="å…­-æé«˜-ALTER-TABLE-æ“ä½œçš„é€Ÿåº¦"><a href="#å…­-æé«˜-ALTER-TABLE-æ“ä½œçš„é€Ÿåº¦" class="headerlink" title="å…­. æé«˜ ALTER TABLE æ“ä½œçš„é€Ÿåº¦"></a>å…­. æé«˜ ALTER TABLE æ“ä½œçš„é€Ÿåº¦</h2><p>ALTER TABLE å¯¹äºå¤§è¡¨ä¼šæ‰§è¡Œå¾ˆæ…¢ï¼Œå¤§éƒ¨åˆ†ä¿®æ”¹è¡¨æ“ä½œä¼šæŒ‰æ–°ç»“æ„åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºè¡¨ï¼Œä»æ—§è¡¨æŸ¥å‡ºæ‰€æœ‰æ•°æ®æ’å…¥æ–°è¡¨ï¼Œæœ€ååˆ é™¤æ—§è¡¨ã€‚<strong>å¤§éƒ¨åˆ† ALTER TABLE æ“ä½œä¼šå¯¼è‡´MySQLæœåŠ¡ä¸­æ–­</strong>ã€‚ </p><p>å¸¸è§„åœºæ™¯çš„æŠ€å·§ï¼š</p><ul><li>å…ˆåœ¨ä¸€å°ä¸æä¾›æœåŠ¡çš„æœºå™¨ä¸Šæ‰§è¡Œ ALTER TABLE æ“ä½œï¼Œç„¶åå’Œæä¾›æœåŠ¡çš„ä¸»åº“åˆ‡æ¢ï¼›</li><li>â€œå½±å­æ‹·è´â€ï¼Œç”¨è¦æ±‚çš„è¡¨ç»“æ„åˆ›å»ºä¸€å¼ å’ŒåŸè¡¨æ— å…³çš„æ–°è¡¨ï¼Œç„¶åé€šè¿‡<strong>é‡å‘½å</strong>å’Œ<strong>åˆ è¡¨</strong>æ“ä½œäº¤æ¢ä¸¤å¼ è¡¨ã€‚</li></ul><p>ä¸æ˜¯æ‰€æœ‰ ALTER TABLE æ“ä½œéƒ½è¦é‡å»ºè¡¨ï¼Œå¦‚ä¸‹ä¿®æ”¹å­—æ®µé»˜è®¤å€¼ï¼Œå‰è€…åˆ›å»ºæ–°è¡¨ï¼Œåè€…ç›´æ¥ä¿®æ”¹ <code>.frm</code> æ–‡ä»¶ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> XXX</span><br><span class="line"><span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> xxx TINYINT(<span class="number">3</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">5</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> XXX</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> xxx <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure><h3 id="6-1-åªä¿®æ”¹-frm-æ–‡ä»¶ï¼Œä¸é‡å»ºè¡¨"><a href="#6-1-åªä¿®æ”¹-frm-æ–‡ä»¶ï¼Œä¸é‡å»ºè¡¨" class="headerlink" title="6.1 åªä¿®æ”¹ .frm æ–‡ä»¶ï¼Œä¸é‡å»ºè¡¨"></a>6.1 åªä¿®æ”¹ .frm æ–‡ä»¶ï¼Œä¸é‡å»ºè¡¨</h3><p>åªä¿®æ”¹ .frm æ–‡ä»¶è¦è¿œè¿œå¿«äºé‡å»ºè¡¨ï¼Œè€ŒMySQLæœ‰æ—¶ä¼šåœ¨æ²¡å¿…è¦é‡å»ºè¡¨çš„æ—¶å€™ä»å»é‡å»ºã€‚æ¯”å¦‚ç§»é™¤ä¸€ä¸ªåˆ—çš„ AUTO_INCREMENT å±æ€§ï¼›å¢åŠ ã€ç§»é™¤ã€ä¿®æ”¹ENUMå’ŒSETå¸¸é‡ã€‚</p><p>è¿™ç±»æƒ…å†µå¯ä»¥åˆ›å»ºæ–°çš„ <code>.frm</code> æ–‡ä»¶ï¼Œæ›¿æ¢æ—§çš„ï¼š</p><ol><li>åˆ›å»ºä¸€å¼ æœ‰ç›¸åŒç»“æ„çš„ç©ºè¡¨ï¼Œè¿›è¡Œéœ€è¦çš„ä¿®æ”¹ï¼›</li><li>æ‰§è¡Œ <code>FLUSH TABLES WITH READ LOCK</code> ï¼Œä¼šå…³é—­æ‰€æœ‰æ­£åœ¨ä½¿ç”¨çš„è¡¨ï¼Œä¸”ç¦æ­¢ä»»ä½•è¡¨è¢«æ‰“å¼€ï¼›</li><li>äº¤æ¢ <code>.frm</code> æ–‡ä»¶ï¼›</li><li>æ‰§è¡Œ <code>UNLOCK TABLES</code> é‡Šæ”¾ç¬¬äºŒæ­¥çš„è¯»é”ã€‚</li></ol><h3 id="6-2-å¿«é€Ÿåˆ›å»º-MyISAM-ç´¢å¼•"><a href="#6-2-å¿«é€Ÿåˆ›å»º-MyISAM-ç´¢å¼•" class="headerlink" title="6.2 å¿«é€Ÿåˆ›å»º MyISAM ç´¢å¼•"></a>6.2 å¿«é€Ÿåˆ›å»º MyISAM ç´¢å¼•</h3><p>å…ˆç¦ç”¨ç´¢å¼•ã€è½½å…¥æ•°æ®ï¼Œç„¶åé‡æ–°å¯ç”¨ç´¢å¼•ï¼šå› ä¸ºæ„å»ºç´¢å¼•çš„å·¥ä½œè¢«å»¶è¿Ÿåˆ°æ•°æ®å®Œå…¨è½½å…¥åï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åˆ©ç”¨æ’åºæ¥åˆ›å»ºç´¢å¼•ï¼Œç›¸æ¯”ä¼šå¿«å¾ˆå¤šï¼Œå¹¶ä¸”ä½¿ç´¢å¼•æ ‘çš„ç¢ç‰‡æ›´å°‘ã€æ›´ç´§å‡‘ï¼ˆåªå¯¹éå”¯ä¸€ç´¢å¼•æœ‰æ•ˆï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> XXX <span class="keyword">DISABLE</span> <span class="keyword">KEYS</span>;</span><br><span class="line"><span class="comment">--LOAD THE DATA</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> XXX <span class="keyword">ENABLE</span> <span class="keyword">KEYS</span>;</span><br></pre></td></tr></table></figure><p>InnoDBä¹Ÿå¯ä»¥å…ˆåˆ é™¤æ‰€æœ‰çš„éå”¯ä¸€ç´¢å¼•ï¼Œç„¶åå¢åŠ æ–°çš„åˆ—ï¼Œæœ€åé‡æ–°åˆ›å»ºåˆ é™¤æ‰çš„ç´¢å¼•ã€‚</p><p>æ“ä½œæ­¥éª¤ï¼š</p><ol><li>ç”¨éœ€è¦çš„è¡¨ç»“æ„åˆ›å»ºä¸€å¼ æ–°è¡¨ï¼Œä½†ä¸åŒ…å«ç´¢å¼•ï¼›</li><li>è½½å…¥æ•°æ®åˆ°è¡¨ä¸­ä»¥æ„å»º <code>.MYD</code> æ–‡ä»¶ï¼›</li><li>æŒ‰ç…§éœ€è¦çš„ç»“æ„åˆ›å»ºå¦ä¸€å¼ ç©ºè¡¨ï¼Œå¹¶åŒ…å«ç´¢å¼•ï¼Œåˆ›å»ºå‡º <code>.frm</code> å’Œ <code>.MYI</code> æ–‡ä»¶ï¼›</li><li>è·å–è¯»é”å¹¶åˆ·æ–°è¡¨ï¼›</li><li>é‡å‘½åç¬¬äºŒå¼ è¡¨çš„ <code>.frm</code> å’Œ <code>.MYI</code> æ–‡ä»¶ï¼Œä½¿MySQLè®¤ä¸ºæ˜¯ç¬¬ä¸€å¼ è¡¨çš„æ–‡ä»¶ï¼›</li><li>é‡Šæ”¾è¯»é”ï¼›</li><li>ä½¿ç”¨ <code>REPAIR TABLE</code> é‡å»ºè¡¨çš„ç´¢å¼•ï¼Œæ­¤æ“ä½œé€šè¿‡æ’åºæ¥æ„å»ºæ‰€æœ‰ç´¢å¼•ï¼ŒåŒ…æ‹¬å”¯ä¸€ç´¢å¼•ã€‚</li></ol><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šé«˜æ€§èƒ½MySQLã€‹</p>]]></content>
    
    <summary type="html">
    
      ã€Šé«˜æ€§èƒ½MySQLã€‹è¯»ä¹¦ç¬”è®°ï¼Œå†…å®¹ï¼šæ•°æ®ç±»å‹ä¼˜åŒ–ï¼Œé€‰æ‹©åˆé€‚çš„æ ‡è¯†åˆ—ï¼Œå¸¸è§Schemaè®¾è®¡é™·é˜±ï¼ŒèŒƒå¼ä¸åèŒƒå¼ï¼Œç¼“å­˜è¡¨å’Œæ±‡æ€»è¡¨ï¼Œæé«˜ALTER TABLEæ“ä½œçš„é€Ÿåº¦ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäºŒï¼‰åŸºå‡†æµ‹è¯•å’ŒæœåŠ¡å™¨æ€§èƒ½å‰–æ</title>
    <link href="http://linyishui.top/2020121701.html"/>
    <id>http://linyishui.top/2020121701.html</id>
    <published>2020-12-17T12:12:06.000Z</published>
    <updated>2020-12-29T12:27:12.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäºŒï¼‰åŸºå‡†æµ‹è¯•å’ŒæœåŠ¡å™¨æ€§èƒ½å‰–æ"><a href="#ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäºŒï¼‰åŸºå‡†æµ‹è¯•å’ŒæœåŠ¡å™¨æ€§èƒ½å‰–æ" class="headerlink" title="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäºŒï¼‰åŸºå‡†æµ‹è¯•å’ŒæœåŠ¡å™¨æ€§èƒ½å‰–æ"></a>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆäºŒï¼‰åŸºå‡†æµ‹è¯•å’ŒæœåŠ¡å™¨æ€§èƒ½å‰–æ</h1><h2 id="ä¸€-æ¦‚è¿°"><a href="#ä¸€-æ¦‚è¿°" class="headerlink" title="ä¸€. æ¦‚è¿°"></a>ä¸€. æ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯åŸºå‡†æµ‹è¯•ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯åŸºå‡†æµ‹è¯•ï¼Ÿ" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯åŸºå‡†æµ‹è¯•ï¼Ÿ"></a>1.1 ä»€ä¹ˆæ˜¯åŸºå‡†æµ‹è¯•ï¼Ÿ</h3><p>åŸºå‡†æµ‹è¯•æ˜¯é’ˆå¯¹ç³»ç»Ÿè®¾è®¡çš„ä¸€ç§å‹åŠ›æµ‹è¯•ï¼Œé€šå¸¸æ˜¯ä¸ºäº†æŒæ¡ç³»ç»Ÿçš„è¡Œä¸ºæˆ–é‡ç°æŸä¸ªç³»ç»ŸçŠ¶æ€ã€åšæ–°ç¡¬ä»¶çš„å¯é æ€§æµ‹è¯•ç­‰ã€‚</p><h3 id="1-2-ä¸ºä»€ä¹ˆéœ€è¦åŸºå‡†æµ‹è¯•ï¼Ÿ"><a href="#1-2-ä¸ºä»€ä¹ˆéœ€è¦åŸºå‡†æµ‹è¯•ï¼Ÿ" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆéœ€è¦åŸºå‡†æµ‹è¯•ï¼Ÿ"></a>1.2 ä¸ºä»€ä¹ˆéœ€è¦åŸºå‡†æµ‹è¯•ï¼Ÿ</h3><p>åŸºå‡†æµ‹è¯•æ˜¯å”¯ä¸€æ–¹ä¾¿æœ‰æ•ˆçš„ã€å¯ä»¥å­¦ä¹ ç³»ç»Ÿåœ¨ç»™å®šçš„å·¥ä½œè´Ÿè½½ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆçš„æ–¹æ³•ã€‚è§‚å¯Ÿç³»ç»Ÿåœ¨ä¸åŒå‹åŠ›ä¸‹çš„è¡Œä¸ºã€è¯„ä¼°ç³»ç»Ÿçš„å®¹é‡ã€è§‚å¯Ÿç³»ç»Ÿå¦‚ä½•å¤„ç†ä¸åŒçš„æ•°æ®ã€‚</p><h2 id="äºŒ-åŸºå‡†æµ‹è¯•çš„ç­–ç•¥"><a href="#äºŒ-åŸºå‡†æµ‹è¯•çš„ç­–ç•¥" class="headerlink" title="äºŒ. åŸºå‡†æµ‹è¯•çš„ç­–ç•¥"></a>äºŒ. åŸºå‡†æµ‹è¯•çš„ç­–ç•¥</h2><p>ä¸¤ç§ä¸»è¦ç­–ç•¥ï¼š</p><ul><li>é›†æˆå¼ï¼šé’ˆå¯¹æ•´ä¸ªç³»ç»Ÿçš„æ•´ä½“æµ‹è¯•ï¼›</li><li>å•ç»„ä»¶å¼ï¼šå•ç‹¬æµ‹è¯•MySQLã€‚</li></ul><p>ä¸€èˆ¬å»ºè®®åšé›†æˆå¼æµ‹è¯•ï¼Œå°‘æ•°å¦‚éœ€è¦æ¯”è¾ƒä¸åŒçš„schemaæˆ–æŸ¥è¯¢çš„æ€§èƒ½ã€é’ˆå¯¹æŸä¸ªå…·ä½“é—®é¢˜çš„æµ‹è¯•ã€é¿å…è¿‡é•¿çš„åŸºå‡†æµ‹è¯•æ¥æ£€æµ‹æŸäº›è°ƒæ•´çš„æ•ˆæœï¼Œå¯ä»¥è€ƒè™‘åªæµ‹è¯•MySQLã€‚å¦‚æœä½¿ç”¨çš„æ˜¯çœŸå®æ•°æ®ï¼Œé‚£ä¹ˆåªæµ‹è¯•MySQLä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p><h3 id="2-1-æµ‹è¯•æŒ‡æ ‡"><a href="#2-1-æµ‹è¯•æŒ‡æ ‡" class="headerlink" title="2.1 æµ‹è¯•æŒ‡æ ‡"></a>2.1 æµ‹è¯•æŒ‡æ ‡</h3><ul><li><strong>ååé‡</strong>ï¼šå•ä½æ—¶é—´å†…å¤„ç†çš„äº‹åŠ¡æ•°ï¼Œå•ä½ä¸ºæ¯ç§’äº‹åŠ¡æ•°TPSã€‚</li><li><strong>å“åº”æ—¶é—´æˆ–è€…å»¶è¿Ÿ</strong>ï¼šä»»åŠ¡æ‰€éœ€çš„æ•´ä½“æ—¶é—´ï¼Œé€šå¸¸ä½¿ç”¨ç™¾åˆ†æ¯”å“åº”æ—¶é—´ï¼Œå¦‚95%çš„å“åº”æ—¶é—´éƒ½æ˜¯5æ¯«ç§’ã€‚</li><li><strong>å¹¶å‘æ€§</strong>ï¼šåŒæ—¶å·¥ä½œçš„å¹¶å‘æ“ä½œ / çº¿ç¨‹æ•° / è¿æ¥æ•°ï¼Œå½“å¹¶å‘æ€§å¢åŠ æ—¶ï¼Œè¦å…³æ³¨ååé‡æ˜¯å¦ä¸‹é™ï¼Œå“åº”æ—¶é—´æ˜¯å¦å˜é•¿ã€‚å¯ä»¥é€šè¿‡ sysbench æŒ‡å®šå¤šä¸ªçº¿ç¨‹ï¼Œè®°å½•MySQLæ•°æ®åº“çš„ Threads_running çŠ¶æ€å€¼ã€‚</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šç»™ç³»ç»Ÿå¢åŠ ä¸€å€çš„èµ„æºï¼Œç†æƒ³æƒ…å†µä¸‹å¯ä»¥è·å¾—ä¸¤å€çš„ç»“æœã€‚</li></ul><h2 id="ä¸‰-åŸºå‡†æµ‹è¯•å·¥å…·"><a href="#ä¸‰-åŸºå‡†æµ‹è¯•å·¥å…·" class="headerlink" title="ä¸‰. åŸºå‡†æµ‹è¯•å·¥å…·"></a>ä¸‰. åŸºå‡†æµ‹è¯•å·¥å…·</h2><p>é›†æˆå¼æµ‹è¯•å·¥å…·ï¼š</p><ul><li>abï¼šApache HTPPæœåŠ¡å™¨åŸºå‡†æµ‹è¯•å·¥å…·ï¼Œæµ‹è¯•HTTPæœåŠ¡å™¨æ¯ç§’æœ€å¤šå¯ä»¥å¤„ç†å¤šå°‘è¯·æ±‚ï¼Œåªèƒ½é’ˆå¯¹å•ä¸ªURLè¿›è¡Œå°½å¯èƒ½å¿«çš„å‹åŠ›æµ‹è¯•ã€‚</li><li>http_loadï¼šå¯ä»¥é€šè¿‡è¾“å…¥æ–‡ä»¶æä¾›å¤šä¸ªURLéšæœºé€‰æ‹©è¿›è¡Œæµ‹è¯•ã€‚</li><li>JMeterï¼šJavaå¼€å‘çš„æµ‹è¯•å·¥å…·ï¼Œé™¤äº†Webä¹Ÿå¯ä»¥æµ‹è¯•FTPæˆ–JDBCç­‰ã€‚</li></ul><p>å•ç»„ä»¶å¼æµ‹è¯•å·¥å…·ï¼š</p><ul><li>mysqlslapï¼šMySQL 5.1å‘è¡ŒåŒ…æä¾›ï¼Œæ¨¡æ‹ŸæœåŠ¡å™¨çš„è´Ÿè½½ï¼Œè¾“å‡ºè®¡æ—¶ä¿¡æ¯ã€‚</li><li>MySQL Benchmark Suiteï¼ˆsql-benchï¼‰ï¼šMySQLå‘è¡ŒåŒ…æä¾›çš„åŸºå‡†æµ‹è¯•å¥—ä»¶ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æœåŠ¡å™¨æ‰§è¡ŒæŸ¥è¯¢çš„é€Ÿåº¦ã€‚å¯ä»¥ç”¨äºæ¯”è¾ƒä¸åŒå­˜å‚¨å¼•æ“æˆ–ä¸åŒé…ç½®çš„æ€§èƒ½æµ‹è¯•ï¼Œä¹Ÿå¯ä»¥æ¯”è¾ƒä¸¤ä¸ªæœåŠ¡å™¨çš„æ€»ä½“æ€§èƒ½ã€‚å•çº¿ç¨‹ä¸”ä¸²è¡Œæ‰§è¡Œï¼Œåªèƒ½æ¯”è¾ƒå•CPUæœåŠ¡å™¨çš„æ€§èƒ½å·®åˆ«ã€‚</li><li>Super Smackï¼šæä¾›å‹åŠ›æµ‹è¯•å’Œè´Ÿè½½ç”Ÿæˆï¼Œå¯ä»¥æ¨¡æ‹Ÿå¤šç”¨æˆ·è®¿é—®ï¼ŒåŠ è½½æµ‹è¯•æ•°æ®åˆ°æ•°æ®åº“ï¼Œæ”¯æŒä½¿ç”¨éšæœºæ•°æ®å¡«å……æµ‹è¯•è¡¨ã€‚</li><li>Database Test Suiteï¼šOSDLå¼€æºå®éªŒå®¤å¼€å‘ã€‚</li><li>sysbenchï¼šå¤šçº¿ç¨‹ç³»ç»Ÿå‹æµ‹å·¥å…·ï¼Œæ”¯æŒLuaè„šæœ¬è¯­è¨€ï¼Œå…¨èƒ½æµ‹è¯•å·¥å…·ï¼Œæ”¯æŒMySQLã€æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶æµ‹è¯•ã€‚</li></ul><h2 id="å››-æ€§èƒ½å‰–ææ¦‚è¿°"><a href="#å››-æ€§èƒ½å‰–ææ¦‚è¿°" class="headerlink" title="å››. æ€§èƒ½å‰–ææ¦‚è¿°"></a>å››. æ€§èƒ½å‰–ææ¦‚è¿°</h2><h3 id="4-1-å¸¸è§åœºæ™¯"><a href="#4-1-å¸¸è§åœºæ™¯" class="headerlink" title="4.1 å¸¸è§åœºæ™¯"></a>4.1 å¸¸è§åœºæ™¯</h3><p>å¸¸è§æ€§èƒ½ç›¸å…³çš„æœåŠ¡è¯·æ±‚ï¼š</p><ul><li>å¦‚ä½•ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦è¾¾åˆ°äº†æ€§èƒ½æœ€ä½³çŠ¶æ€ï¼Ÿ</li><li>åˆ†ææŸæ¡è¯­å¥ä¸ºä»€ä¹ˆæ‰§è¡Œçš„ä¸å¤Ÿå¿«ï¼Ÿ</li><li>è¯Šæ–­â€œåœé¡¿â€ï¼Œâ€œå †ç§¯â€æˆ–â€œå¡æ­»â€çš„æŸäº›é—´æ­‡æ€§ç–‘éš¾æ•…éšœï¼Ÿ</li></ul><h3 id="4-2-æ€§èƒ½å‰–æçš„æ ‡å‡†"><a href="#4-2-æ€§èƒ½å‰–æçš„æ ‡å‡†" class="headerlink" title="4.2 æ€§èƒ½å‰–æçš„æ ‡å‡†"></a>4.2 æ€§èƒ½å‰–æçš„æ ‡å‡†</h3><p>å®šä¹‰ä¸€ä¸ªæ€§èƒ½çš„æ ‡å‡†ï¼šå®ŒæˆæŸä»¶ä»»åŠ¡çš„æ‰€éœ€æ—¶é—´åº¦é‡ï¼Œä¹Ÿå°±æ˜¯<strong>å“åº”æ—¶é—´</strong>ã€‚å¯¹äºæ•°æ®åº“æ¥è¯´å°±æ˜¯æŸ¥è¯¢çš„å“åº”æ—¶é—´ï¼Œä¸ç®¡æ˜¯DDLè¿˜æ˜¯DMLéƒ½ç”¨æŸ¥è¯¢æ¥æ³›æŒ‡ã€‚ä¼˜åŒ–å°±æ˜¯åœ¨ä¸€å®šçš„å·¥ä½œè´Ÿè½½ä¸‹å°½å¯èƒ½åœ°é™ä½å“åº”æ—¶é—´ã€‚</p><p>æ— æ³•æµ‹è¯•å°±æ— æ³•æœ‰æ•ˆåœ°ä¼˜åŒ–ï¼Œé¦–å…ˆåº”è¯¥æµ‹é‡æŸ¥è¯¢æ—¶é—´èŠ±åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œè¦å‡†ç¡®æµ‹é‡éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p><ul><li>ä¸è¦åœ¨é”™è¯¯çš„æ—¶é—´å¯åŠ¨å’Œåœæ­¢æµ‹é‡ï¼›</li><li>æµ‹é‡çš„æ˜¯ç›®æ ‡æ´»åŠ¨æœ¬èº«ï¼Œè€Œä¸æ˜¯èšåˆåçš„ä¿¡æ¯ã€‚</li></ul><p>å¦‚æµ‹é‡æ…¢æŸ¥è¯¢æ—¶å»æ’æŸ¥æ•´ä¸ªæœåŠ¡å™¨æ¥åˆ¤æ–­é—®é¢˜å‡ºå¤„ï¼Œæµ‹é‡åº”è¯¥ä»æ…¢æŸ¥è¯¢å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´ï¼Œè€Œä¸æ˜¯æŸ¥è¯¢ä¹‹å‰æˆ–ä¹‹åçš„æ—¶é—´ã€‚</p><p>æŸ¥è¯¢æ—¶é—´åŒ…æ‹¬ï¼š</p><ul><li>æ‰§è¡Œæ—¶é—´ï¼šåªéœ€æµ‹é‡å®šä½ä¸åŒçš„å­ä»»åŠ¡èŠ±è´¹çš„æ—¶é—´ï¼Œä¼˜åŒ–å»æ‰ä¸€äº›å­ä»»åŠ¡ã€é™ä½ä¸€äº›å­ä»»åŠ¡æ‰§è¡Œé¢‘ç‡ã€æé«˜å­ä»»åŠ¡æ‰§è¡Œæ•ˆç‡ã€‚</li><li>ç­‰å¾…æ—¶é—´ï¼šå¯èƒ½å› ä¸ºå…¶ä»–ç³»ç»Ÿé—´æ¥å½±å“ï¼Œä»»åŠ¡é—´ä¹Ÿå¯èƒ½å› ä¸ºç«äº‰ç£ç›˜æˆ–CPUèµ„æºè€Œç›¸äº’å½±å“ï¼Œ</li></ul><p>é€šè¿‡æ€§èƒ½å‰–æå¯ä»¥åˆ†æå®šä½æ˜¯å“ªäº›å­ä»»åŠ¡æ˜¯ä¼˜åŒ–çš„ç›®æ ‡ã€‚</p><h2 id="äº”-å¦‚ä½•è¿›è¡Œæ€§èƒ½å‰–æ"><a href="#äº”-å¦‚ä½•è¿›è¡Œæ€§èƒ½å‰–æ" class="headerlink" title="äº”. å¦‚ä½•è¿›è¡Œæ€§èƒ½å‰–æ"></a>äº”. å¦‚ä½•è¿›è¡Œæ€§èƒ½å‰–æ</h2><h3 id="5-1-æ€§èƒ½å‰–ææ­¥éª¤"><a href="#5-1-æ€§èƒ½å‰–ææ­¥éª¤" class="headerlink" title="5.1 æ€§èƒ½å‰–ææ­¥éª¤"></a>5.1 æ€§èƒ½å‰–ææ­¥éª¤</h3><p>æ€§èƒ½å‰–æåŒ…æ‹¬ä¸¤æ­¥ï¼š</p><ul><li>æµ‹é‡ä»»åŠ¡æ‰€èŠ±è´¹çš„æ—¶é—´ï¼›</li><li>å¯¹ç»“æœè¿›è¡Œç»Ÿè®¡å’Œæ’åºï¼ŒæŠŠé‡è¦çš„ä»»åŠ¡æ’åœ¨å‰é¢ã€‚</li></ul><h3 id="5-2-æ€§èƒ½å‰–æçš„è¾“å‡ºä¿¡æ¯"><a href="#5-2-æ€§èƒ½å‰–æçš„è¾“å‡ºä¿¡æ¯" class="headerlink" title="5.2 æ€§èƒ½å‰–æçš„è¾“å‡ºä¿¡æ¯"></a>5.2 æ€§èƒ½å‰–æçš„è¾“å‡ºä¿¡æ¯</h3><p>æ€§èƒ½å‰–æå·¥å…·é€šå¸¸éƒ½æ˜¯è®¡æ—¶å™¨ï¼Œè®°å½•ä»»åŠ¡çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012010102.png" alt></p><p>æ€§èƒ½å‰–æéœ€è¦ç³»ç»Ÿå¯æµ‹é‡åŒ–ï¼Œç³»ç»Ÿéœ€è¦æœ‰ä¸€äº›æµ‹é‡ç‚¹å¯ä»¥æ•è·å¹¶æ”¶é›†æ•°æ®ï¼ŒMySQLç›´åˆ°ç‰ˆæœ¬5.5æ‰é¦–æ¬¡æä¾›Performance Schema åŒ…å«ä¸€äº›åŸºäºæ—¶é—´çš„å¯æµ‹é‡ç‚¹ï¼Œåœ¨æ­¤ä¹‹å‰åªèƒ½æ”¶é›†åˆ°è®°å½•æ´»åŠ¨å‘ç”Ÿæ¬¡æ•°çš„ show status è®¡æ•°å™¨ã€‚è€Œ Percona Server å¯ä»¥æä¾›æ›´å¤šæ›´è¯¦ç»†çš„æŸ¥è¯¢çº§åˆ«æµ‹é‡ç‚¹ã€‚</p><p>æ€§èƒ½å‰–æè¾“å‡ºçš„æ’åã€æ€»è®¡ã€å¹³å‡å€¼ä¹‹å¤–ç¼ºå¤±çš„ä¿¡æ¯ï¼š</p><ul><li>å€¼å¾—ä¼˜åŒ–çš„æŸ¥è¯¢ï¼šæ€§èƒ½å‰–æä¸ä¼šè‡ªåŠ¨ç»™å‡ºéœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢ï¼Œæ€»å“åº”æ—¶é—´å æ¯”å°çš„æŸ¥è¯¢ä¸å€¼å¾—ä¼˜åŒ–ï¼Œä¼˜åŒ–æˆæœ¬å¤§äºæ”¶ç›Šçš„æŸ¥è¯¢ä¸å€¼å¾—ä¼˜åŒ–ã€‚</li><li>å¼‚å¸¸æƒ…å†µï¼šæœ‰äº›æŸ¥è¯¢è™½ç„¶æ‰§è¡Œé¢‘ç‡ä¸é«˜ï¼Œä½†æ¯æ¬¡æ‰§è¡Œéƒ½å¾ˆæ…¢ã€‚</li><li>æœªçŸ¥çš„æœªçŸ¥ï¼šä¸¢å¤±æ—¶é—´-ä»»åŠ¡çš„æ€»æ—¶é—´å’Œæµ‹é‡å¾—åˆ°çš„æ—¶é—´ä¹‹å·®ï¼Œå¦‚CPUæ—¶é—´ä¸º10ç§’ï¼Œå‰–æå¾—åˆ°ä»»åŠ¡æ—¶é—´ä¸º9.7ç§’ï¼Œå­˜åœ¨300æ¯«ç§’çš„ä¸¢å¤±æ—¶é—´ã€‚å¯èƒ½ä¼šå¿½ç•¥æŸäº›é‡è¦ä¿¡æ¯ã€‚</li><li>è¢«éšè—çš„ç»†èŠ‚ï¼šåªåˆ†æå¹³å‡å€¼ä¼šå¿½ç•¥åˆ°ä¸€äº›æƒ…å†µï¼Œå¦‚åŒ»é™¢åªçœ‹æ‰€æœ‰ç—…äººçš„å¹³å‡ä½“æ¸©ï¼Œå¯ä»¥è¾“å‡ºæ›´å¤šå“åº”æ—¶é—´çš„ä¿¡æ¯ï¼Œå¦‚ç›´æ–¹å›¾ã€ç™¾åˆ†æ¯”ã€æ ‡å‡†å·®ã€åå·®æŒ‡æ•°ç­‰ã€‚</li></ul><h2 id="å…­-å‰–æMySQLæŸ¥è¯¢"><a href="#å…­-å‰–æMySQLæŸ¥è¯¢" class="headerlink" title="å…­. å‰–æMySQLæŸ¥è¯¢"></a>å…­. å‰–æMySQLæŸ¥è¯¢</h2><h3 id="6-1-æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#6-1-æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="6.1 æ…¢æŸ¥è¯¢æ—¥å¿—"></a>6.1 æ…¢æŸ¥è¯¢æ—¥å¿—</h3><h4 id="ï¼ˆ1ï¼‰ç›¸å…³å‚æ•°"><a href="#ï¼ˆ1ï¼‰ç›¸å…³å‚æ•°" class="headerlink" title="ï¼ˆ1ï¼‰ç›¸å…³å‚æ•°"></a>ï¼ˆ1ï¼‰ç›¸å…³å‚æ•°</h4><ol><li>slow_query_log ï¼šæ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œ1è¡¨ç¤ºå¼€å¯ï¼Œ0è¡¨ç¤ºå…³é—­ã€‚</li><li>log-slow-queries ï¼šæ—§ç‰ˆï¼ˆ5.6ä»¥ä¸‹ç‰ˆæœ¬ï¼‰MySQLæ•°æ®åº“æ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨è·¯å¾„ã€‚å¯ä»¥ä¸è®¾ç½®è¯¥å‚æ•°ï¼Œç³»ç»Ÿåˆ™ä¼šé»˜è®¤ç»™ä¸€ä¸ªç¼ºçœçš„æ–‡ä»¶host_name-slow.log</li><li>slow-query-log-fileï¼šæ–°ç‰ˆï¼ˆ5.6åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰MySQLæ•°æ®åº“æ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨è·¯å¾„ã€‚å¯ä»¥ä¸è®¾ç½®è¯¥å‚æ•°ï¼Œç³»ç»Ÿåˆ™ä¼šé»˜è®¤ç»™ä¸€ä¸ªç¼ºçœçš„æ–‡ä»¶host_name-slow.log</li><li>long_query_time ï¼šæ…¢æŸ¥è¯¢æ—¶é—´è®¾ç½®ï¼Œå½“æŸ¥è¯¢æ—¶é—´å¤šäºè®¾å®šçš„æ—¶é—´å€¼æ—¶ï¼Œè®°å½•æ—¥å¿—ã€‚</li></ol><h4 id="ï¼ˆ2ï¼‰æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®"><a href="#ï¼ˆ2ï¼‰æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®" class="headerlink" title="ï¼ˆ2ï¼‰æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®"></a>ï¼ˆ2ï¼‰æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®</h4><p>é»˜è®¤æƒ…å†µä¸‹slow_query_logçš„å€¼ä¸ºOFFï¼Œè¡¨ç¤ºæ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ç¦ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®slow_query_logçš„å€¼æ¥å¼€å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ol><li><p>æŸ¥è¯¢æ…¢æ—¥å¿—æ˜¯å¦å¼€å¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--OFF ä¸ºå…³é—­ ONä¸ºå¼€å¯</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%slow_query_log%'</span>;</span><br></pre></td></tr></table></figure></li><li><p>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log=<span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šä½¿ç”¨set global slowquerylog=1å¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—åªå¯¹å½“å‰æ•°æ®åº“ç”Ÿæ•ˆï¼ŒMySQLé‡å¯ååˆ™ä¼šå¤±æ•ˆã€‚å¦‚æœè¦æ°¸ä¹…ç”Ÿæ•ˆï¼Œå°±å¿…é¡»ä¿®æ”¹é…ç½®æ–‡ä»¶my.cnfï¼ˆå…¶å®ƒç³»ç»Ÿå˜é‡ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰</strong></p></li><li><p>æ°¸ä¹…å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š</p><p>ä¿®æ”¹my.cnfæ–‡ä»¶ï¼Œå¢åŠ æˆ–ä¿®æ”¹å‚æ•°slow_query_log å’Œslow_query_log_fileåï¼Œç„¶åé‡å¯MySQLæœåŠ¡å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slow_query_log =1</span><br><span class="line">slow_query_log_file=/usr/local/mysql/data/localhost-slow.log</span><br></pre></td></tr></table></figure></li></ol><h4 id="ï¼ˆ3ï¼‰æ…¢æŸ¥è¯¢æ—¶é—´è®¾ç½®"><a href="#ï¼ˆ3ï¼‰æ…¢æŸ¥è¯¢æ—¶é—´è®¾ç½®" class="headerlink" title="ï¼ˆ3ï¼‰æ…¢æŸ¥è¯¢æ—¶é—´è®¾ç½®"></a>ï¼ˆ3ï¼‰æ…¢æŸ¥è¯¢æ—¶é—´è®¾ç½®</h4><p>è¿™ä¸ªæ˜¯ç”±å‚æ•° long_query_time æ§åˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ long_query_time çš„å€¼ä¸º10ç§’ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥åœ¨my.cnfå‚æ•°é‡Œé¢ä¿®æ”¹ã€‚</p><ol><li><p>æŸ¥è¯¢æ…¢æ—¥å¿—æ—¶é—´è®¾ç½®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'long_query_time'</span>;</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—æ—¶é—´ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> long_query_time=<span class="number">5</span>;</span><br></pre></td></tr></table></figure></li></ol><h3 id="6-2-å‰–ææœåŠ¡å™¨è´Ÿè½½"><a href="#6-2-å‰–ææœåŠ¡å™¨è´Ÿè½½" class="headerlink" title="6.2 å‰–ææœåŠ¡å™¨è´Ÿè½½"></a>6.2 å‰–ææœåŠ¡å™¨è´Ÿè½½</h3><p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨<strong>æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ï¼Œæ˜¯MySQLå¼€é”€æœ€ä½ã€ç²¾åº¦æœ€é«˜çš„æµ‹é‡æŸ¥è¯¢å·¥å…·ï¼Œä½¿ç”¨æ—¶åªéœ€æ³¨æ„ç£ç›˜ç©ºé—´å¼€é”€ï¼ŒMySQL 5.1 ç‰ˆæœ¬åå¯ä»¥é€šè¿‡ <code>long_query_time</code> ä¸º 0 æ¥æ•è·æ‰€æœ‰çš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„å“åº”æ—¶é—´å¯ä»¥åšåˆ°å¾®ç§’çº§ã€‚</p><p>Percona Server çš„æ…¢æŸ¥è¯¢æ—¥å¿—ç›¸æ¯”MySQLä¼šè®°å½•æ›´å¤šä¿¡æ¯ï¼Œå¦‚æ‰§è¡Œè®¡åˆ’ã€é”ã€I/Oæ´»åŠ¨ç­‰ã€‚</p><p>å¯ä»¥åœ¨ä¸šåŠ¡é«˜å³°æœŸå¼€å¯ä¸€ä¸ªå°æ—¶çš„è®°å½•æŸ¥è¯¢ï¼Œé¦–å…ˆç”Ÿæˆä¸€ä¸ªå‰–ææŠ¥å‘Šï¼Œéœ€è¦ä¸€ä¸ªé€‚åˆçš„å‰–æå·¥å…·ï¼Œå¦‚ <code>pt-query-digest</code> åˆ†æ tcpdumpã€‚</p><h3 id="6-3-å‰–æå•æ¡æŸ¥è¯¢"><a href="#6-3-å‰–æå•æ¡æŸ¥è¯¢" class="headerlink" title="6.3 å‰–æå•æ¡æŸ¥è¯¢"></a>6.3 å‰–æå•æ¡æŸ¥è¯¢</h3><p>å®šä½åˆ°éœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢è¯­å¥åï¼Œ</p><ul><li><p>SHOW PROFILEï¼š</p><ul><li><p>ä½œç”¨ï¼šä¼šæµ‹é‡æ‰€æœ‰æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„è¯­å¥ï¼Œè®°å½•è€—è´¹æ—¶é—´å’Œæ‰§è¡ŒçŠ¶æ€å˜æ›´ç›¸å…³çš„æ•°æ®ã€‚</p></li><li><p>å¼€å¯ï¼š<code>SET profiling = 1;</code> </p></li><li><p>ä½¿ç”¨ï¼š<code>SHOW PROFILES</code> å’Œ <code>SHOW PROFILE FOR QUERY 1;</code> ç»“æœæŒ‰ç…§æ‰§è¡Œé¡ºåºæ’åºï¼Œè€Œä¸æ˜¯èŠ±è´¹æ—¶é—´ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @query_id = <span class="number">252</span>;</span><br><span class="line"><span class="keyword">SELECT</span> STATE, <span class="keyword">SUM</span>(<span class="keyword">DURATION</span>) <span class="keyword">AS</span> Total_R,</span><br><span class="line"> <span class="keyword">ROUND</span>(</span><br><span class="line"><span class="number">100</span> * <span class="keyword">SUM</span>(<span class="keyword">DURATION</span>) /</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">SUM</span>(<span class="keyword">DURATION</span>)</span><br><span class="line"> <span class="keyword">FROM</span> information_schema.PROFILING</span><br><span class="line"> <span class="keyword">WHERE</span> QUERY_ID = @query_id), <span class="number">2</span></span><br><span class="line"> ) <span class="keyword">AS</span> Pct_R, </span><br><span class="line"> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> Calls,</span><br><span class="line"> <span class="keyword">SUM</span>(<span class="keyword">DURATION</span>) / <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> <span class="string">"R/Call"</span></span><br><span class="line"><span class="keyword">FROM</span> information_schema.PROFILING</span><br><span class="line"><span class="keyword">WHERE</span> QUERY_ID = @query_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> STATE</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Total_R <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure></li><li><p>æ’åºåå¯ä»¥æ˜æ˜¾çš„æ‰¾åˆ°æŸ¥è¯¢çš„è€—æ—¶æ­¥éª¤ï¼Œæ‰¾åˆ°å…¶ä¸­å€¼å¾—ä¼˜åŒ–çš„éƒ¨åˆ†å»ä¼˜åŒ–ã€‚</p></li></ul></li><li><p>SHOW STATUSï¼š</p><ul><li><p>ä½œç”¨ï¼šè¿”å›ä¸€äº›è®¡æ•°å™¨ï¼Œæœ‰æœåŠ¡å™¨çº§åˆ«å’Œå•ä¸ªè¿æ¥ä¼šè¯çº§åˆ«çš„è®¡æ•°å™¨ï¼Œå¦‚ <code>Queries</code> åœ¨ä¼šè¯å¼€å§‹å‰ä¸º0ï¼Œæ¯æäº¤ä¸€æ¡æŸ¥è¯¢å¢åŠ 1ã€‚</p></li><li><p>ä½¿ç”¨ï¼š<code>SHOW GLOBAL STATUS</code> æŸ¥çœ‹æœåŠ¡å™¨çº§åˆ«çš„æ¬¡æ•°ç»Ÿè®¡ã€‚<code>SHOW STATUS</code> åŒ…å«ä¸¤ç§çº§åˆ«çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--é‡ç½®è®¡æ•°å™¨</span></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">STATUS</span>;</span><br><span class="line"><span class="comment">--æ‰§è¡ŒSQL</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tv_tallymaster_bak <span class="keyword">where</span> book_id <span class="keyword">in</span> (<span class="string">'100199100'</span>,<span class="string">'100200000'</span>);</span><br><span class="line"><span class="comment">--æŸ¥çœ‹æŒ‡å®šè®¡æ•°å™¨ç»“æœ</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">STATUS</span> <span class="keyword">WHERE</span> Variable_name <span class="keyword">LIKE</span> <span class="string">'Handler%'</span> <span class="keyword">OR</span> Variable_name <span class="keyword">LIKE</span> <span class="string">'Created%'</span></span><br><span class="line"><span class="comment">-- Created_tmp_tables è¡¨ç¤ºä½¿ç”¨ä¸´æ—¶è¡¨æ•°ç›®</span></span><br><span class="line"><span class="comment">-- Created_tmp_disk_tables ç£ç›˜ä¸´æ—¶è¡¨</span></span><br><span class="line"><span class="comment">-- Handler_read_rnd_next æ²¡æœ‰ç”¨åˆ°ç´¢å¼•çš„è¯»æ“ä½œ</span></span><br></pre></td></tr></table></figure></li><li><p>åªèƒ½æ˜¾ç¤ºæŸç§æ´»åŠ¨çš„é¢‘ç¹ç¨‹åº¦ï¼ˆå¦‚è¯»ç´¢å¼•ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°æŒ‡å…¨å±€çº§åˆ«çš„æ“ä½œæ—¶é—´ï¼ˆInnodb_row_lock_timeï¼‰ã€‚</p></li><li><p>æ¯”è¾ƒæœ‰ç”¨çš„è®¡æ•°å™¨ï¼š</p><ul><li>å¥æŸ„è®¡æ•°å™¨ï¼ˆhandler counterï¼‰</li><li>ä¸´æ—¶æ–‡ä»¶</li><li>è¡¨è®¡æ•°å™¨</li></ul></li><li><p>SHOW STATUS æœ¬èº«ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œé€šè¿‡å¥æŸ„æ“ä½œè®¿é—®æ­¤è¡¨ï¼Œä¼šå½±å“è®¡æ•°å™¨æ•°å­—ã€‚</p></li><li><p>EXPLAIN æœ‰ç±»ä¼¼çš„ç»“æœï¼Œä½†åŸºäºç»Ÿè®¡ï¼›SHOW STATUS çš„ç»“æœåŸºäºæµ‹é‡ã€‚</p></li></ul></li><li><p>æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ¡ç›®ï¼š</p><ul><li>ä½¿ç”¨ Percona Server å¾—åˆ°æ›´è¯¦ç»†æœ‰ç”¨çš„ä¿¡æ¯ã€‚</li><li><code>pt-query-digest</code> æ ‡é¢˜ä¸€èˆ¬ä¼šæ‰“å°å‡ºå­—èŠ‚åç§»å€¼ï¼ˆ3214ï¼‰ï¼Œä½¿ç”¨tailæŒ‡ä»¤ç›´æ¥è·³è½¬åˆ°å¯¹åº”éƒ¨åˆ†ï¼š<code>tail -c +3214 /path/to/query.log | head -n100</code></li></ul></li><li><p>ä½¿ç”¨ <code>Performance Schema</code> </p></li></ul><h3 id="6-4-è¯Šæ–­é—´æ­‡æ€§é—®é¢˜"><a href="#6-4-è¯Šæ–­é—´æ­‡æ€§é—®é¢˜" class="headerlink" title="6.4 è¯Šæ–­é—´æ­‡æ€§é—®é¢˜"></a>6.4 è¯Šæ–­é—´æ­‡æ€§é—®é¢˜</h3><p>ä¾‹å¦‚ä¸€ä¸ªç®€å•æŸ¥è¯¢ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨å¾ˆå¿«ï¼Œä½†æœ‰å‡ æ¬¡ä¸åˆç†çš„æ‰§è¡Œäº†å¾ˆä¹…ã€‚æ‰‹å·¥æ‰§è¡Œä¸€éï¼Œéå¸¸å¿«ï¼›ç„¶åç”¨EXPLAINæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œä¹Ÿæ­£ç¡®çš„ä½¿ç”¨äº†ç´¢å¼•ã€‚ä¿®æ”¹WHEREæ¡ä»¶çš„å€¼ï¼Œæ’é™¤ç¼“å­˜å‘½ä¸­çš„å¯èƒ½æ€§ã€‚</p><p>æ…¢æŸ¥è¯¢æ—¥å¿—æ²¡æœ‰æ‰§è¡Œè®¡åˆ’æˆ–è¯¦ç»†çš„æ—¶é—´ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯ç³»ç»Ÿæœ‰å…¶ä»–ä¸œè¥¿æ¶ˆè€—äº†èµ„æºï¼Œæ¯”å¦‚æ­£åœ¨å¤‡ä»½ï¼Œæˆ–æ˜¯æŸç§ç±»å‹çš„é”æˆ–äº‰ç”¨é˜»å¡äº†æŸ¥è¯¢è¿›åº¦ã€‚</p><p>å°½é‡é¿å…è¯•é”™çš„è¯Šæ–­æ–¹å¼ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ¡ˆä¾‹ï¼ŒæŸäº›æ˜¯æ•°æ®åº“é—®é¢˜ï¼Œä½†ä¹Ÿæœ‰çš„ä¸æ˜¯ï¼š</p><ul><li>åº”ç”¨é€šè¿‡ curl ä»ä¸€ä¸ªè¿è¡Œå¾ˆæ…¢çš„å¤–éƒ¨æœåŠ¡è·å–æ±‡ç‡æŠ¥ä»·çš„æ•°æ®ã€‚</li><li>memcached ç¼“å­˜ä¸­ä¸€äº›é‡è¦æ¡ç›®è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚è½åˆ°MySQLé‡æ–°ç”Ÿæˆç¼“å­˜æ¡ç›®ã€‚</li><li>DNSæŸ¥è¯¢å¶å°”æœ‰è¶…æ—¶ç°è±¡ã€‚</li><li>å¯èƒ½ç”±äºäº’æ–¥é”äº‰ç”¨ï¼Œæˆ–è€…å†…éƒ¨åˆ é™¤æŸ¥è¯¢ç¼“å­˜çš„ç®—æ³•æ•ˆç‡å¤ªä½çš„ç¼˜æ•…ï¼ŒMySQLçš„æŸ¥è¯¢ç¼“å­˜æœ‰æ—¶å€™ä¼šå¯¼è‡´æœåŠ¡æœ‰çŸ­æš‚çš„åœé¡¿ã€‚</li><li>å½“å¹¶å‘åº¦è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼ŒInnoDBçš„æ‰©å±•æ€§é™åˆ¶å¯¼è‡´æŸ¥è¯¢è®¡åˆ’çš„ä¼˜åŒ–éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚</li></ul><p>åªèƒ½åœ¨é—®é¢˜å‘ç”Ÿçš„åœ°æ–¹é€šè¿‡è§‚å¯Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶å°½å¯èƒ½çš„æµ‹é‡å‡ºæ•°æ®ï¼Œæ‰èƒ½é¿å…åœ¨æ²¡é—®é¢˜çš„åœ°æ–¹è€—è´¹ç²¾åŠ›ã€‚</p><ul><li><p><strong>ç¡®è®¤å•æ¡æŸ¥è¯¢é—®é¢˜è¿˜æ˜¯æœåŠ¡å™¨é—®é¢˜</strong>ï¼š</p><ul><li><p>æœåŠ¡å™¨æ•´ä½“æ²¡é—®é¢˜ï¼Œåªæ˜¯æŸæ¡æŸ¥è¯¢æ…¢ï¼Œå¯ä»¥å°†æ³¨æ„åŠ›æ”¾åœ¨è¿™æ¡ç‰¹å®šçš„æŸ¥è¯¢ä¸Šé¢ã€‚</p></li><li><p>åˆ¤æ–­æ–¹æ³•ï¼š</p><ul><li><p>ä½¿ç”¨ <code>SHOW GLOBAL STATUS</code> ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ¯ç§’æ•è·ä¸€æ¬¡SHOW GLOBAL STATUSçš„æ•°æ®ï¼Œè¾“å‡ºç»™awkè®¡ç®—å¹¶è¾“å‡ºæ¯ç§’çš„æŸ¥è¯¢æ•°ã€Threads_connectedå’ŒThreads_runningè¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢çš„çº¿ç¨‹æ•°ã€‚</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mysqladmin ext -i1 | awk <span class="string">'/Queries/&#123;q=$4-qp;qp=$4&#125; /Threads_connected/&#123;tc=$4&#125; /Threads_running/&#123;printf "%5d %5d %5d\n", q, tc, $4&#125;'</span></span></span><br></pre></td></tr></table></figure><p>æ¯ç§’æŸ¥è¯¢æ•°ä¸€èˆ¬ä¼šä¸‹è·Œï¼Œå…¶ä»–ä¸¤ä¸ªè‡³å°‘ä¼šå‡ºç°ä¸€ä¸ªå°–åˆºã€‚å¯èƒ½æ˜¯æœåŠ¡å™¨å†…éƒ¨ç¢°åˆ°äº†æŸç§ç“¶é¢ˆï¼Œå¯¼è‡´æ–°æŸ¥è¯¢åœ¨å¼€å§‹æ‰§è¡Œå‰å› ä¸ºè¦è·å–è€æŸ¥è¯¢æ­£åœ¨ç­‰å¾…çš„é”è€Œé€ æˆå †ç§¯ï¼ˆä¸€èˆ¬ä¹Ÿä¼šå¯¼è‡´åç«¯æœåŠ¡å™¨å‡ºç°æ’é˜Ÿï¼‰ï¼›ä¹Ÿå¯èƒ½æ˜¯æœåŠ¡åŒºçªç„¶æ”¶åˆ°å¤§é‡æŸ¥è¯¢è¯·æ±‚ï¼Œæ¯”å¦‚å‰ç«¯memcachedçªç„¶å¤±æ•ˆå¯¼è‡´çš„æŸ¥è¯¢é£æš´ã€‚</p></li><li><p>ä½¿ç”¨ <code>SHOW PROCESSLIST</code> ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡ä¸åœæ•è·SHOW PROCESSLISTçš„è¾“å‡ºï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰å¤§é‡ç°åœºå¤„äºä¸æ­£å¸¸çŠ¶æ€æˆ–æœ‰ä¸æ­£å¸¸çš„ç‰¹å¾ï¼Œå¦‚statisticsçŠ¶æ€ä¸€èˆ¬æœåŠ¡å™¨åœ¨æŸ¥è¯¢ä¼˜åŒ–é˜¶æ®µç¡®å®šè¡¨å…³è”é¡ºåºâ€”éå¸¸å¿«ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¸åº”é•¿æ—¶é—´å¤„ä¸æ­¤çŠ¶æ€</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> \Gå‚ç›´è¾“å‡ºç»“æœï¼Œæ–¹ä¾¿ä½¿ç”¨ sort|uniq|sort è®¡ç®—æŸä¸€åˆ—å€¼å‡ºç°æ¬¡æ•°ï¼Œä¸€èˆ¬Stateåˆ—ä¼šå¾ˆæœ‰ç”¨</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mysql -e <span class="string">'SHOW PROCESSLIST\G'</span> | grep State: | sort | uniq -c | sort -rn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¤§é‡çº¿ç¨‹å¤„äºfreeing itemsè¯´æ˜å‡ºç°äº†å¤§é‡æœ‰é—®é¢˜æŸ¥è¯¢</span></span><br></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥ç›´æ¥æŸ¥è¯¢è¡¨ï¼š<code>SELECT * FROM information_schema.PROCESSLIST</code></li><li>ä½¿ç”¨ innotop å·¥å…·ã€‚</li></ul></li><li><p>ä½¿ç”¨æŸ¥è¯¢æ—¥å¿—ï¼š</p><ul><li>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå¹¶åœ¨å…¨å±€çº§åˆ«è®¾ç½® <code>long_query_time=0</code> ï¼Œç¡®è®¤æ‰€æœ‰è¿æ¥éƒ½é‡‡ç”¨äº†æ–°è®¾ç½®ï¼Œå¯èƒ½éœ€è¦é‡ç½®æ‰€æœ‰è¿æ¥ï¼Œæˆ–æ˜¯ä½¿ç”¨ Percona Serverã€‚</li><li>ä¹Ÿå¯ä»¥é€šè¿‡ tcpdump å’Œ pt-query-digest å·¥å…·æ›¿ä»£ã€‚</li><li>æ‰¾åˆ°ååé‡çªç„¶ä¸‹é™æ—¶é—´æ®µçš„æ—¥å¿—ï¼Œä¸€èˆ¬æ˜¯ååé‡ä¸‹é™åç¬¬ä¸€ä¸ªå®Œæˆçš„æŸ¥è¯¢ã€‚</li></ul></li></ul></li></ul></li><li><p><strong>æ•è·è¯Šæ–­æ•°æ®</strong>ï¼š</p><ul><li><p>è¾…åŠ©å·¥å…·ï¼š</p><ul><li>ä¸€ä¸ªå¯é ä¸”å®æ—¶çš„è§¦å‘å™¨ï¼›</li><li>ä¸€ä¸ªæ”¶é›†è¯Šæ–­æ•°æ®çš„å·¥å…·ã€‚</li></ul></li><li><p>æ‰¾åˆ°èƒ½å’Œæ­£å¸¸æ—¶çš„é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒçš„æŒ‡æ ‡ï¼Œå¦‚æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€å¤„äºâ€œfreeing itemsâ€çŠ¶æ€çš„çº¿ç¨‹æ•°é‡ç­‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mysql -e <span class="string">'SHOW PROCESSLIST/G'</span> | grep -c <span class="string">"State: freeing items"</span></span></span><br></pre></td></tr></table></figure></li><li><p>Percona Toolkit çš„ pt-stalk å¯ä»¥åœ¨è§¦å‘æ¡ä»¶æ—¶æ”¶é›†æ•°æ®ã€‚</p></li><li><p>éœ€è¦æ”¶é›†çš„æ•°æ®ï¼šç³»ç»ŸçŠ¶æ€ã€CPUåˆ©ç”¨ç‡ã€ç£ç›˜ä½¿ç”¨ç‡å’Œå¯ç”¨ç©ºé—´ã€psçš„è¾“å‡ºé‡‡æ ·ã€å†…å­˜ä½¿ç”¨ç‡ã€MySQLçš„å‡ ä¸ªSHOW STATUS / SHOW PROCESSLIST / SHOW INNODB STATUS</p></li></ul></li></ul><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šé«˜æ€§èƒ½MySQLã€‹</p>]]></content>
    
    <summary type="html">
    
      ã€Šé«˜æ€§èƒ½MySQLã€‹è¯»ä¹¦ç¬”è®°ï¼Œå†…å®¹ï¼šåŸºå‡†æµ‹è¯•å’ŒæœåŠ¡å™¨æ€§èƒ½å‰–æï¼ŒMySQLæŸ¥è¯¢å‰–æç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸€ï¼‰æ¶æ„å’Œå†å²</title>
    <link href="http://linyishui.top/2020120801.html"/>
    <id>http://linyishui.top/2020120801.html</id>
    <published>2020-12-08T12:03:19.000Z</published>
    <updated>2021-05-12T12:57:16.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸€ï¼‰æ¶æ„å’Œå†å²"><a href="#ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸€ï¼‰æ¶æ„å’Œå†å²" class="headerlink" title="ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸€ï¼‰æ¶æ„å’Œå†å²"></a>ã€Šé«˜æ€§èƒ½MySQLã€‹ï¼ˆä¸€ï¼‰æ¶æ„å’Œå†å²</h1><p>MySQLçš„å­˜å‚¨å¼•æ“æ¶æ„å°†<strong>æŸ¥è¯¢å¤„ç†</strong>åŠå…¶ä»–<strong>ç³»ç»Ÿä»»åŠ¡</strong>å’Œ<strong>æ•°æ®çš„å­˜å‚¨/æå–</strong>ç›¸åˆ†ç¦»ã€‚ä»è€Œå¯ä»¥åœ¨ä½¿ç”¨æ—¶æ ¹æ®æ€§èƒ½ã€ç‰¹æ€§ç­‰éœ€æ±‚æ¥é€‰æ‹©æ•°æ®å­˜å‚¨çš„æ–¹å¼ã€‚</p><h2 id="ä¸€-MySQLé€»è¾‘æ¶æ„"><a href="#ä¸€-MySQLé€»è¾‘æ¶æ„" class="headerlink" title="ä¸€. MySQLé€»è¾‘æ¶æ„"></a>ä¸€. MySQLé€»è¾‘æ¶æ„</h2><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201201/202012010101.png" alt></p><ul><li>ç¬¬ä¸€å±‚ï¼šè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€å®‰å…¨ç­‰ç­‰ã€‚</li><li>ç¬¬äºŒå±‚ï¼šæŸ¥è¯¢è§£æã€åˆ†æã€ä¼˜åŒ–ã€ç¼“å­˜ä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼Œè¿˜æœ‰æ‰€æœ‰çš„è·¨å­˜å‚¨å¼•æ“çš„å®ç°ï¼šå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ã€‚</li><li>ç¬¬ä¸‰å±‚ï¼šå­˜å‚¨å¼•æ“ï¼ŒæœåŠ¡å™¨é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ï¼ŒåŒ…æ‹¬å‡ åä¸ªåº•å±‚å‡½æ•°ï¼Œå¦‚â€œå¼€å§‹ä¸€ä¸ªäº‹åŠ¡â€ã€â€œæ ¹æ®ä¸»é”®æå–ä¸€è¡Œè®°å½•â€ã€‚å­˜å‚¨å¼•æ“ä¸ä¼šè§£æSQLï¼ˆInnodbä¼šè§£æå¤–é”®ï¼Œå› ä¸ºMySQLæœåŠ¡å™¨æœ¬èº«æ²¡æœ‰å®ç°æ­¤åŠŸèƒ½ï¼‰ï¼Œå­˜å‚¨å¼•æ“åªä¼šç®€å•çš„å“åº”ä¸Šå±‚æœåŠ¡å™¨çš„è¯·æ±‚ã€‚</li></ul><h3 id="1-1-è¿æ¥ä¸å®‰å…¨"><a href="#1-1-è¿æ¥ä¸å®‰å…¨" class="headerlink" title="1.1 è¿æ¥ä¸å®‰å…¨"></a>1.1 è¿æ¥ä¸å®‰å…¨</h3><p>æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥å¯¹åº”æœåŠ¡å™¨è¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿æ¥çš„æ‰€æœ‰æŸ¥è¯¢éƒ½åœ¨æ­¤çº¿ç¨‹ä¸­è¿›è¡Œï¼ŒæœåŠ¡å™¨ä¼šè´Ÿè´£ç¼“å­˜çº¿ç¨‹è€Œä¸å¿…æ¯æ¬¡éƒ½åˆ›å»ºæ–°çº¿ç¨‹ï¼ŒMySQL 5.5åæ”¯æŒçº¿ç¨‹æ± æ¥æ”¯æŒå¤§é‡è¿æ¥ã€‚</p><p>è®¤è¯åŸºäºç”¨æˆ·åã€åŸå§‹ä¸»æœºä¿¡æ¯å’Œå¯†ç ã€‚ä½¿ç”¨å®‰å…¨å¥—æ¥å­—SSLçš„æ–¹å¼è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨X5.09è¯ä¹¦è®¤è¯ã€‚è¿æ¥æˆåŠŸåä¼šç»§ç»­éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”è¯·æ±‚çš„æƒé™ã€‚</p><h3 id="1-2-ä¼˜åŒ–ä¸æ‰§è¡Œ"><a href="#1-2-ä¼˜åŒ–ä¸æ‰§è¡Œ" class="headerlink" title="1.2 ä¼˜åŒ–ä¸æ‰§è¡Œ"></a>1.2 ä¼˜åŒ–ä¸æ‰§è¡Œ</h3><p>MySQLä¼šè§£ææŸ¥è¯¢ï¼Œå¹¶åˆ›å»ºå†…éƒ¨æ•°æ®ç»“æ„-è§£ææ ‘ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå„ç§ä¼˜åŒ–ï¼ŒåŒ…æ‹¬é‡å†™æŸ¥è¯¢ã€å†³å®šè¡¨çš„è¯»å†™é¡ºåºã€é€‰æ‹©åˆé€‚çš„ç´¢å¼•ç­‰ã€‚</p><ul><li>å¯ä»¥é€šè¿‡ç‰¹æ®Šå…³é”®å­— <strong>hint</strong> æç¤ºä¼˜åŒ–å™¨ï¼Œå½±å“å…¶å†³ç­–è¿‡ç¨‹ï¼›</li><li>å¯ä»¥é€šè¿‡ <strong>explain</strong> è¯·æ±‚ä¼˜åŒ–å™¨è§£é‡Šä¼˜åŒ–è¿‡ç¨‹çš„å„ä¸ªå› ç´ ï¼Œä»è€Œäº†è§£åˆ°æœåŠ¡çš„ä¼˜åŒ–å†³ç­–ï¼Œä¾¿äºç”¨æˆ·é‡æ„æŸ¥è¯¢å’Œschemaã€ä¿®æ”¹ç›¸å…³é…ç½®ã€‚</li></ul><p>å¯¹äºå¦‚ SELECT è¯­å¥ï¼Œåœ¨è§£ææŸ¥è¯¢å‰ä¼šæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œè‹¥æœ‰ç›¸åº”æŸ¥è¯¢å°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœã€‚ </p><h2 id="äºŒ-å¹¶å‘æ§åˆ¶"><a href="#äºŒ-å¹¶å‘æ§åˆ¶" class="headerlink" title="äºŒ. å¹¶å‘æ§åˆ¶"></a>äºŒ. å¹¶å‘æ§åˆ¶</h2><p>MySQLåœ¨ä¸¤ä¸ªå±‚æ§åˆ¶å¹¶å‘ï¼šæœåŠ¡å™¨å±‚å’Œå­˜å‚¨å¼•æ“å±‚ã€‚</p><h3 id="2-1-è¯»å†™é”"><a href="#2-1-è¯»å†™é”" class="headerlink" title="2.1 è¯»å†™é”"></a>2.1 è¯»å†™é”</h3><p>å¹¶å‘è¯»æ•°æ®ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†å½“ä¸€ä¸ªç”¨æˆ·è¯»å–æ•°æ®ï¼Œå¦å¤–ä¸€ä¸ªç”¨æˆ·åˆ é™¤æ•°æ®æ—¶ï¼Œå¯èƒ½è¯»å–ä¼šæŠ¥é”™ï¼Œä¹Ÿå¯èƒ½è¯»åˆ°äº†ä¸ä¸€è‡´çš„æ•°æ®ã€‚</p><p>é€šè¿‡å®ç°å…±äº«é”ï¼ˆshared lockï¼‰å’Œæ’å®ƒé”ï¼ˆexclusive lockï¼‰ï¼Œä¹Ÿå«è¯»é”å’Œå†™é”ï¼Œè¿™ä¸¤ç§é”ç»„æˆçš„é”ç³»ç»Ÿæ¥è§£å†³é—®é¢˜ã€‚å†™é”ä¼šé˜»å¡å…¶ä»–å†™é”å’Œè¯»é”ï¼Œ</p><h3 id="2-2-é”ç²’åº¦"><a href="#2-2-é”ç²’åº¦" class="headerlink" title="2.2 é”ç²’åº¦"></a>2.2 é”ç²’åº¦</h3><p>ä¸ºäº†æé«˜å…±äº«èµ„æºçš„å¹¶å‘æ€§ï¼Œå‡å°‘é”å®šçš„å¯¹è±¡ï¼Œé¿å…é”ä½æ‰€æœ‰èµ„æºã€‚ä½†é”çš„æ‰€æœ‰æ“ä½œï¼Œå¦‚è·å–é”ã€æ£€æŸ¥æ˜¯å¦é”å·²é‡Šæ”¾ã€é‡Šæ”¾é”ç­‰éƒ½ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚<strong>é”ç­–ç•¥å°±æ˜¯åœ¨é”çš„å¼€é”€å’Œæ•°æ®çš„å®‰å…¨æ€§ä¹‹é—´å¯»æ‰¾å¹³è¡¡</strong>ã€‚</p><ul><li><strong>è¡¨é”</strong>ï¼š<ul><li>è¡¨é”æ˜¯å¼€é”€æœ€å°çš„é”ï¼Œä¼šé”å®šæ•´å¼ è¡¨ï¼Œå†™æ“ä½œæ—¶ä¼šé˜»å¡å…¶ä»–è¯»å†™æ“ä½œï¼Œå†™é”æœªè¢«æŒæœ‰æ—¶å…¶ä»–ç”¨æˆ·æ‰èƒ½è·å–è¯»é”ï¼Œè¯»é”é—´ä¸ç›¸äº’é˜»å¡ã€‚</li><li>å†™é”çš„ä¼˜å…ˆçº§æ¯”è¯»é”è¦é«˜ï¼Œæ‰€ä»¥å†™è¯·æ±‚å¯èƒ½ä¼šè¢«æ’å…¥åˆ°è¯»è¯·æ±‚å‰ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå¿½ç•¥å­˜å‚¨å¼•æ“çš„è¡¨é”å®ç°ä¸ºå¦‚ <code>ALTER TABLE</code> ä¹‹ç±»çš„è¯­å¥åŠ è¡¨é”ã€‚</li></ul></li><li><strong>è¡Œé”</strong>ï¼š<ul><li>è¡Œé”å¯ä»¥æä¾›æ›´å¥½çš„å¹¶å‘æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æœ€å¤§çš„é”å¼€é”€ã€‚è¡Œé”ç”±å­˜å‚¨å¼•æ“å®ç°ï¼ˆInnoDBå’ŒXtraDBç­‰ï¼‰</li></ul></li></ul><h3 id="2-3-é”ç±»å‹"><a href="#2-3-é”ç±»å‹" class="headerlink" title="2.3 é”ç±»å‹"></a>2.3 é”ç±»å‹</h3><p>MySQLåŒ…æ‹¬å¦‚ä¸‹é”ç±»å‹ï¼š</p><ul><li><p><strong>è¯»å†™é”</strong>ï¼šåŒJavaä¸€æ ·ï¼Œå†™é”æŒæœ‰æ—¶å…¶ä»–äº‹åŠ¡ä¸èƒ½è·å–ä»»ä½•é”ï¼Œè¯»é”æŒæœ‰æ—¶å…¶ä»–äº‹åŠ¡å¯ä»¥è·å–è¯»é”ï¼Œä½†ä¸èƒ½è·å–å†™é”ã€‚</p><ul><li><strong>äº’æ–¥é”</strong>ï¼šç®€ç§°Xé”ï¼Œåˆå«å†™é”ã€‚</li><li><strong>å…±äº«é”</strong>ï¼šç®€ç§°Sé”ï¼Œåˆå«è¯»é”ã€‚</li></ul></li><li><p><strong>æ„å‘é”</strong>ï¼šæ›´å®¹æ˜“çš„æ”¯æŒå¤šç²’åº¦çš„å°é”ï¼Œåœ¨åŒæ—¶å­˜åœ¨è¡Œçº§é”å’Œè¡¨çº§é”çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡æƒ³è¦å¯¹è¡¨åŠ é”ï¼Œè¦é¦–å…ˆåˆ†åˆ«æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–äº‹åŠ¡åŠ è¡¨é”æˆ–è¡Œé”ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦å¯¹æ¯ä¸€è¡Œéƒ½è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œè¿™ç›¸å½“è€—æ—¶ã€‚</p><p><strong>æ„å‘é”åœ¨ X/S é”ä¹‹ä¸Šå¼•å…¥äº† IX/ISï¼ŒäºŒè€…éƒ½æ˜¯è¡¨é”ï¼Œè§„å®šäº‹åŠ¡è·å–æŸè¡Œçš„Xæˆ–Sé”å‰è¦å…ˆè·å–IXæˆ–ISé”</strong>ã€‚è¿™æ ·å½“äº‹åŠ¡æƒ³å¯¹è¡¨åŠ å†™é”æ—¶åªéœ€æ£€æµ‹æ˜¯å¦æœ‰å…¶ä»–äº‹åŠ¡å¯¹è¡¨åŠ äº† X/IX/S/IS é”ï¼Œåªéœ€åšä¸€æ¬¡æ£€æµ‹ã€‚ï¼ˆ<strong>ä»»æ„ IS/IX é”ä¹‹é—´éƒ½æ˜¯å…¼å®¹çš„ï¼Œå› ä¸ºå®ƒä»¬åªè¡¨ç¤ºæƒ³è¦å¯¹è¡¨åŠ é”ï¼Œè€Œä¸æ˜¯çœŸæ­£åŠ é”</strong>ï¼‰</p><ul><li><strong>æ„å‘å…±äº«é”</strong>ï¼ˆIS Lockï¼‰ï¼šäº‹åŠ¡æƒ³è¦è·å¾—ä¸€å¼ è¡¨ä¸­æŸå‡ è¡Œçš„å…±äº«é”ï¼›</li><li><strong>æ„å‘æ’ä»–é”</strong>ï¼ˆIX Lockï¼‰ï¼šäº‹åŠ¡æƒ³è¦è·å¾—ä¸€å¼ è¡¨ä¸­æŸå‡ è¡Œçš„æ’ä»–é”ï¼›</li><li><strong>æ’å…¥æ„å‘é”</strong>ï¼ˆInsert Intention Lockï¼‰ï¼šæ’å…¥æ„å‘é”æ˜¯é—´éš™é”çš„ä¸€ç§ï¼Œä¸“é—¨é’ˆå¯¹insertæ“ä½œçš„ã€‚å³å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€ä¸ªç´¢å¼•ã€åŒä¸€ä¸ªèŒƒå›´åŒºé—´å†…æ’å…¥è®°å½•æ—¶ï¼Œå¦‚æœæ’å…¥çš„ä½ç½®ä¸å†²çªï¼Œåˆ™ä¸ä¼šé˜»å¡å½¼æ­¤</li></ul></li><li><p><strong>è‡ªå¢é”</strong>ï¼ˆAuto-inc Locksï¼‰ï¼šè‡ªå¢é”æ˜¯ä¸€ç§ç‰¹æ®Šçš„<strong>è¡¨çº§åˆ«é”</strong>ï¼Œä¸“é—¨é’ˆå¯¹äº‹åŠ¡æ’å…¥ AUTO-INCREMENT ç±»å‹çš„åˆ—ã€‚å³ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å¾€è¡¨ä¸­æ’å…¥è®°å½•æ—¶ï¼Œå…¶ä»–äº‹åŠ¡çš„æ’å…¥å¿…é¡»ç­‰å¾…ï¼Œä»¥ä¾¿ç¬¬1ä¸ªäº‹åŠ¡æ’å…¥çš„è¡Œå¾—åˆ°çš„ä¸»é”®å€¼æ˜¯è¿ç»­çš„ã€‚</p></li><li><p><strong>è®°å½•é”</strong>ï¼ˆRecord Locksï¼‰ï¼š</p><ul><li>è®°å½•é”æ˜¯çš„å•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ï¼Œä¼šé˜»å¡å…¶ä»–äº‹åŠ¡å¯¹å…¶æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼›</li><li><code>locks rec but not gap</code> ã€‚</li></ul></li><li><p><strong>é—´éš™é”</strong>ï¼ˆGap Lockï¼‰ï¼šé—´éš™é”é”å®šè®°å½•çš„ä¸€ä¸ªé—´éš”ï¼Œä½†ä¸åŒ…å«è®°å½•æœ¬èº«ã€‚</p></li><li><p><strong>ä¸´é”®é”</strong>ï¼ˆNext-Key Lockï¼‰ï¼š</p><ul><li><code>Next-Key Lock = Gap Lock + Record Lock</code> ä¸´å»ºé”æ˜¯è®°å½•é”ä¸é—´éš™é”çš„ç»„åˆï¼Œå³ï¼šæ—¢åŒ…å«ç´¢å¼•è®°å½•ï¼ŒåˆåŒ…å«ç´¢å¼•åŒºé—´ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³å¹»è¯»ã€‚</li></ul></li></ul><p>æ€»ç»“ï¼š</p><ul><li>è¡¨é”ï¼šæ„å‘é”ï¼Œè‡ªå¢é”ã€‚</li><li>è¡Œé”ï¼šè¯»å†™é”ï¼Œè®°å½•é”ï¼Œé—´éš™é”ï¼Œä¸´é”®é”ã€‚</li></ul><h2 id="ä¸‰-äº‹åŠ¡"><a href="#ä¸‰-äº‹åŠ¡" class="headerlink" title="ä¸‰. äº‹åŠ¡"></a>ä¸‰. äº‹åŠ¡</h2><h3 id="3-1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"><a href="#3-1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="3.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"></a>3.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</h3><p>äº‹åŠ¡æ˜¯<strong>ä¸€ç»„åŸå­æ€§çš„SQLæŸ¥è¯¢</strong>ï¼Œä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œå•å…ƒã€‚å…¨éƒ¨è¯­å¥èƒ½å¤Ÿè¢«æ•°æ®åº“å¼•æ“æˆåŠŸåº”ç”¨ï¼Œåˆ™æ‰§è¡Œè¯¥ç»„æŸ¥è¯¢ï¼›æœ‰ä»»ä¸€è¯­å¥æ— æ³•æ‰§è¡Œï¼Œäº‹åŠ¡çš„æ‰€æœ‰è¯­å¥éƒ½ä¸ä¼šæ‰§è¡Œã€‚<strong>è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥</strong>ã€‚</p><h3 id="3-2-ACID"><a href="#3-2-ACID" class="headerlink" title="3.2 ACID"></a>3.2 ACID</h3><ul><li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>ï¼šäº‹åŠ¡ä½œä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“è¢«æ‰§è¡Œï¼ŒåŒ…å«åœ¨å…¶ä¸­çš„å¯¹æ•°æ®åº“çš„æ“ä½œè¦ä¹ˆ<strong>å…¨éƒ¨è¢«æ‰§è¡Œ</strong>ï¼Œè¦ä¹ˆ<strong>å…¨éƒ¨ä¸æ‰§è¡Œ</strong>ã€‚</li><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šäº‹åŠ¡åº”ç¡®ä¿æ•°æ®åº“çš„çŠ¶æ€ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚ä¸€è‡´çŠ¶æ€çš„å«ä¹‰æ˜¯æ•°æ®åº“ä¸­çš„æ•°æ®åº”æ»¡è¶³å®Œæ•´æ€§çº¦æŸã€‚æ•°æ®åº“å‘ç”Ÿæ•…éšœå¯¼è‡´äº‹åŠ¡ä¸­æ–­ï¼Œæœªå®Œæˆçš„ä¿®æ”¹ä¸èƒ½å†™å…¥ç‰©ç†æ•°æ®åº“ã€‚</li><li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨æœ€ç»ˆæäº¤å‰åº”è¯¥å¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ï¼Œåœ¨å¹¶å‘æ“ä½œç›¸åŒæ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ç‹¬ç«‹çš„æ•°æ®ç©ºé—´ï¼›å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œã€‚</li><li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong>ï¼šå·²è¢«æäº¤çš„äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹åº”è¯¥æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚ç³»ç»Ÿå‘ç”Ÿå¥”æºƒå¯ä»¥ç”¨é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰è¿›è¡Œæ¢å¤ï¼Œä»è€Œå®ç°æŒä¹…æ€§ã€‚</li></ul><p>äº‹åŠ¡æ‰€å¸¦æ¥çš„å®‰å…¨æ€§ä¹Ÿéœ€è¦é¢å¤–çš„å·¥ä½œå’Œå¼€é”€ï¼Œè€ŒMySQLçš„å­˜å‚¨å¼•æ“æ¶æ„å¯ä»¥æ”¯æŒç”¨æˆ·æ ¹æ®ä¸šåŠ¡æ˜¯å¦éœ€è¦äº‹åŠ¡é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚</p><h3 id="3-3-éš”ç¦»çº§åˆ«"><a href="#3-3-éš”ç¦»çº§åˆ«" class="headerlink" title="3.3 éš”ç¦»çº§åˆ«"></a>3.3 éš”ç¦»çº§åˆ«</h3><ol><li><strong>è¯»æœªæäº¤</strong>ï¼ˆREAD UNCOMMITTEDï¼‰ï¼š<ul><li>äº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚</li><li>ä¼š<strong>å¯¼è‡´è„è¯»</strong>ï¼ˆè¯»åˆ°æœªæäº¤çš„æ•°æ®ï¼‰ï¼Œæ€§èƒ½ä¹Ÿå¹¶æœªæ¯”å…¶å®ƒçº§åˆ«å¥½å¾ˆå¤šã€‚</li></ul></li><li><strong>è¯»å·²æäº¤</strong>ï¼ˆREAD COMMITTEDï¼‰ï¼š <ul><li>ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æäº¤ä¹‹å‰å¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</li><li>ä¹Ÿå«ä¸å¯é‡å¤è¯»ï¼Œå› ä¸ºä¸¤æ¬¡æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢å¯èƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœã€‚</li><li>å¤§éƒ¨åˆ†æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ŒMySQLå› ä¸ºå†å²é—ç•™é—®é¢˜ï¼Œé»˜è®¤éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ã€‚</li></ul></li><li><strong>å¯é‡å¤è¯»</strong>ï¼ˆREPEATABLE READï¼‰ï¼š<ul><li>ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</li><li>ä¸å¯é‡å¤è¯»åœ¨åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–å¯èƒ½ä¼šè¯»åˆ°ä¸åŒçš„æ•°æ®ç»“æœï¼Œå¯é‡å¤è¯»åˆ™ä¿è¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­åªä¼šè¯»åˆ°ç›¸åŒç»“æœ</li></ul></li><li><strong>å¯ä¸²è¡ŒåŒ–</strong>ï¼ˆSERIALIZABLEï¼‰ï¼šå¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œè¿™æ ·å¤šä¸ªäº‹åŠ¡äº’ä¸å¹²æ‰°ï¼Œä¸ä¼šå‡ºç°å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚</li></ol><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th style="text-align:center">è„è¯»</th><th style="text-align:center">ä¸å¯é‡å¤è¯»</th><th style="text-align:center">å¹»è¯»</th><th style="text-align:center">åŠ é”è¯»</th></tr></thead><tbody><tr><td>READ UNCOMMITTED</td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td><td style="text-align:center">No</td></tr><tr><td>READ COMMITTED</td><td style="text-align:center">No</td><td style="text-align:center">Yes</td><td style="text-align:center">Yes</td><td style="text-align:center">No</td></tr><tr><td>REPEATABLE READ</td><td style="text-align:center">No</td><td style="text-align:center">No</td><td style="text-align:center">Yes</td><td style="text-align:center">No</td></tr><tr><td>SERIALIZABLE</td><td style="text-align:center">No</td><td style="text-align:center">No</td><td style="text-align:center">No</td><td style="text-align:center">Yes</td></tr></tbody></table><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20210401/202104200103.png" alt></p><h4 id="ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆMySQLé»˜è®¤æ˜¯å¯é‡å¤è¯»ï¼Ÿ"><a href="#ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆMySQLé»˜è®¤æ˜¯å¯é‡å¤è¯»ï¼Ÿ" class="headerlink" title="ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆMySQLé»˜è®¤æ˜¯å¯é‡å¤è¯»ï¼Ÿ"></a>ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆMySQLé»˜è®¤æ˜¯å¯é‡å¤è¯»ï¼Ÿ</h4><p>MySqlçš„å†å²ç‰ˆæœ¬ä¸­ï¼Œä¸»ä»å¤åˆ¶åŸºäºbinlogï¼ˆè®°å½•æ•°æ®åº“ä¿®æ”¹çš„æ–‡ä»¶ï¼‰ï¼Œå½“æ—¶binlogåªæœ‰ <strong>statement</strong> è¿™ç§æ¨¡å¼ï¼ˆè®°å½•ä¿®æ”¹SQLè¯­å¥ï¼‰ï¼Œåæ¥è¿˜æœ‰<strong>row</strong>ï¼ˆè®°å½•æ¯è¡Œæ•°æ®å˜æ›´ï¼‰å’Œ <strong>mixed</strong>ï¼ˆå‰ä¸¤ç§æ¨¡å¼æ··åˆï¼‰æ€»å…±ä¸‰ç§æ¨¡å¼ã€‚</p><p><strong>statement</strong>æ¨¡å¼åœ¨<strong>è¯»å·²æäº¤</strong>ä¸‹è¿›è¡Œä¸»ä»å¤åˆ¶æœ‰BUGï¼Œåœ¨masterä¸Šæ‰§è¡Œçš„é¡ºåºä¸ºå…ˆåˆ åæ’ï¼Œè€Œbinlogçš„è®°å½•é¡ºåºä¸ºå…ˆæ’ååˆ ï¼Œæ‰€ä»¥slaveåŒæ­¥binlogåå¯¼è‡´æ‰§è¡Œé¡ºåºå’Œmasterä¸ä¸€è‡´ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li>è°ƒæ•´éš”ç¦»çº§åˆ«ä¸º<strong>å¯é‡å¤è¯»</strong>ã€‚</li><li>æ›´æ–°æ¨¡å¼ä¸º<strong>row</strong>ï¼ˆ5.1ç‰ˆæœ¬åå¼•å…¥ï¼‰ã€‚</li></ol><h4 id="ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆé€‰æ‹©è¯»å·²æäº¤ï¼Ÿ"><a href="#ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆé€‰æ‹©è¯»å·²æäº¤ï¼Ÿ" class="headerlink" title="ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆé€‰æ‹©è¯»å·²æäº¤ï¼Ÿ"></a>ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆé€‰æ‹©è¯»å·²æäº¤ï¼Ÿ</h4><p>é¦–å…ˆæ’é™¤<strong>è¯»æœªæäº¤</strong>å’Œ<strong>å¯ä¸²è¡ŒåŒ–</strong>ï¼Œå‰è€…ä¼šå‡ºç°è„è¯»ï¼Œåè€…æ¯æ¬¡è¯»æ“ä½œéƒ½è¦åŠ é”ã€‚</p><p>é€‰è¯»å·²æäº¤/ä¸å¯é‡å¤è¯»çš„åŸå› ï¼š</p><ol><li><strong>å¯é‡å¤è¯»ä¸‹ï¼Œå­˜åœ¨é—´éš™é”</strong>ï¼ˆå°é”ç´¢å¼•è®°å½•ä¸­çš„é—´éš”ï¼‰å¯¼è‡´æ­»é”æ¦‚ç‡å¢åŠ ï¼šå¦‚ <code>SELECT * FROM test WHERE id BETWEEN 5 AND 7</code> ï¼Œè¡¨ä¸­æœ‰idï¼ˆ1ï¼Œ5ï¼Œ7ï¼Œ10ï¼‰ï¼Œæ‰€ä»¥å­˜åœ¨5ä¸ªé—´éš™ï¼Œä¸Šè¿°sqlä¼šé”ä½(5,7]å’Œ(7,10]è¿™ä¸¤ä¸ªåŒºé—´ï¼Œå¯¼è‡´åŒºé—´æ— æ³•æ’å…¥æ•°æ®ã€‚è€Œ<strong>è¯»å·²æäº¤ä¸å­˜åœ¨é—´éš™é”</strong>ã€‚</li><li><strong>å¯é‡å¤è¯»ä¸‹ï¼Œæ¡ä»¶æœªå‘½ä¸­ç´¢å¼•ä¼šé”è¡¨</strong>ï¼Œè€Œ<strong>è¯»å·²æäº¤ï¼Œåªä¼šé”è¡Œ</strong>ã€‚</li><li><strong>è¯»å·²æäº¤ï¼Œå› ä¸ºåŠä¸€è‡´æ€§è¯»çš„ç‰¹æ€§ä¼šå¢åŠ updateæ“ä½œçš„å¹¶å‘æ€§</strong>ã€‚ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œupdateæ“ä½œï¼Œä½†å°šæœªæäº¤ï¼Œå¦ä¸€äº‹åŠ¡è·å–é”æ—¶å‘ç°å·²å ç”¨ï¼ŒInnoDBå¼€å¯åŠä¸€è‡´æ€§è¯»è¿”å›æœ€æ–°çš„å·²æäº¤ç‰ˆæœ¬ï¼ŒMySqlä¼šé‡æ–°å‘èµ·ä¸€æ¬¡è¯»æ“ä½œï¼Œæ­¤æ—¶å¯ä»¥è¯»åˆ°æ­¤è¡Œçš„æœ€æ–°ç‰ˆæœ¬å¹¶åŠ é”ï¼Œè€Œå¯é‡å¤è¯»è¿™æ—¶äº‹åŠ¡åªèƒ½ç­‰å¾…å‰ä¸€äº‹åŠ¡æäº¤ã€‚</li><li><strong>ä¸å¯é‡å¤è¯»é—®é¢˜å¯ä»¥æ¥å—</strong>ï¼Œå·²ç»æäº¤äº†æ•°æ®ï¼Œå³ä½¿ä¸ä¸€æ ·é€šå¸¸ä¹Ÿä¸ä¼šé€ æˆé—®é¢˜ã€‚</li></ol><h3 id="3-4-å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"><a href="#3-4-å¹¶å‘ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="3.4 å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"></a>3.4 å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</h3><p>åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œäº‹åŠ¡çš„éš”ç¦»æ€§å¾ˆéš¾ä¿è¯ï¼Œæ‰€ä»¥æœ‰å‡ ç§å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ï¼š</p><ol><li><strong>ä¿®æ”¹ä¸¢å¤±</strong>ï¼šå³ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°èƒŒå¦ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°æ›¿æ¢ã€‚</li><li><strong>è¯»è„æ•°æ®</strong>ï¼šæŒ‡å½“å‰äº‹åŠ¡è¯»åˆ°å¦å¤–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚</li><li><strong>ä¸å¯é‡å¤è¯»</strong>ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®é›†åˆï¼Œåœ¨æ­¤æœŸé—´å¦å¤–äº‹åŠ¡ä¹Ÿè®¿é—®äº†æ­¤é›†åˆå¹¶åšå‡ºä¿®æ”¹ï¼Œå¯¼è‡´å‰ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–æ•°æ®ä¸ä¸€è‡´ã€‚</li><li><strong>å¹»å½±è¯»</strong>ï¼šæœ¬è´¨ä¹Ÿæ˜¯ä¸å¯é‡å¤è¯»ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼Œå¦ä¸€äº‹åŠ¡åœ¨æ­¤èŒƒå›´æ’å…¥æ–°æ•°æ®ï¼Œå¯¼è‡´å‰ä¸ªäº‹åŠ¡å†æ¬¡è¯»å–ç»“æœä¸ä¸€è‡´ã€‚<strong>åŒºåˆ«åœ¨è¦é¿å…å¹»è¯»éœ€è¦é”æ•´å¼ è¡¨ï¼Œè€Œé¿å…ä¸å¯é‡å¤è¯»åªéœ€é”ä½è¡Œå³å¯</strong>ã€‚</li></ol><p>é€šè¿‡é”æœºåˆ¶æ¥è§£å†³æ­¤é—®é¢˜ï¼ŒMySqlæä¾›äº†å¯¹åº”çš„å°é”æœºåˆ¶æ¥å®ç°ï¼Œ<strong>é€šè¿‡ä¸‰çº§å°é”åè®®æ¥å¤„ç†å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</strong>ã€‚</p><h3 id="3-5-å°é”åè®®"><a href="#3-5-å°é”åè®®" class="headerlink" title="3.5 å°é”åè®®"></a>3.5 å°é”åè®®</h3><ul><li><strong>ä¸‰çº§å°é”åè®®</strong>ï¼š<ul><li>ä¸€çº§ï¼š<strong>äº‹åŠ¡ T è¦ä¿®æ”¹æ•°æ® A æ—¶å¿…é¡»åŠ å†™é”ï¼Œç›´åˆ° T ç»“æŸæ‰é‡Šæ”¾é”</strong>ã€‚å¯ä»¥è§£å†³ä¿®æ”¹ä¸¢å¤±é—®é¢˜ï¼Œå› ä¸ºä¸èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆäº‹åŠ¡çš„ä¿®æ”¹å°±ä¸ä¼šè¢«è¦†ç›–ã€‚</li><li>äºŒçº§ï¼š<strong>åœ¨ä¸€çº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ® A æ—¶å¿…é¡»åŠ è¯»é”ï¼Œè¯»å–å®Œé©¬ä¸Šé‡Šæ”¾è¯»é”</strong>ã€‚å¯ä»¥è§£å†³è¯»è„æ•°æ®é—®é¢˜ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªäº‹åŠ¡åœ¨å¯¹æ•°æ® A è¿›è¡Œä¿®æ”¹ï¼Œæ ¹æ® 1 çº§å°é”åè®®ï¼Œä¼šåŠ  X é”ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†åŠ  S é”äº†ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šè¯»å…¥æ•°æ®ã€‚</li><li>ä¸‰çº§ï¼š<strong>åœ¨äºŒçº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ® A æ—¶å¿…é¡»åŠ è¯»é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸäº†æ‰èƒ½é‡Šæ”¾è¯»é”</strong>ã€‚å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå› ä¸ºè¯» A æ—¶ï¼Œå…¶å®ƒäº‹åŠ¡ä¸èƒ½å¯¹ A åŠ  X é”ï¼Œä»è€Œé¿å…äº†åœ¨è¯»çš„æœŸé—´æ•°æ®å‘ç”Ÿæ”¹å˜ã€‚</li></ul></li><li><strong>ä¸¤æ®µå°é”åè®®</strong>ï¼š<strong>åŠ é”å’Œè§£é”åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µè¿›è¡Œ</strong>ã€‚</li></ul><h3 id="3-6-æ­»é”"><a href="#3-6-æ­»é”" class="headerlink" title="3.6 æ­»é”"></a>3.6 æ­»é”</h3><ul><li>æ­»é”æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€èµ„æºä¸Šç›¸äº’å ç”¨ï¼Œå¹¶è¯·æ±‚é”å®šå¯¹æ–¹å ç”¨çš„èµ„æºï¼Œä»è€Œå¯¼è‡´æ¶æ€§å¾ªç¯çš„ç°è±¡ã€‚</li><li>InnoDBæœ‰æ­»é”æ£€æµ‹å’Œæ­»é”è¶…æ—¶æœºåˆ¶ï¼Œå¤„ç†æ­»é”æ—¶ä¼šå°†æŒæœ‰æœ€å°‘è¡Œçº§æ’ä»–é”çš„äº‹åŠ¡è¿›è¡Œå›æ»šã€‚</li><li>æ­»é”å¯èƒ½æ˜¯å› ä¸ºçœŸæ­£çš„æ•°æ®å†²çªï¼Œæœ‰æ—¶å¯èƒ½å®Œå…¨æ˜¯ç”±äºå­˜å‚¨å¼•æ“çš„å®ç°æ–¹å¼å¯¼è‡´çš„ã€‚</li><li>åº”ç”¨ç¨‹åºéœ€è¦è€ƒè™‘å¦‚ä½•å¤„ç†æ­»é”ï¼Œå¤§éƒ¨åˆ†æƒ…å†µåªéœ€é‡æ–°æ‰§è¡Œå› æ­»é”å›æ»šçš„äº‹åŠ¡å³å¯ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--æŸ¥çœ‹æ•°æ®åº“éš”ç¦»çº§åˆ«</span></span><br><span class="line"><span class="keyword">select</span> @@tx_isolation;</span><br><span class="line"><span class="keyword">select</span> @@global.tx_isolation,@@tx_isolation;</span><br><span class="line"></span><br><span class="line"><span class="comment">--æŸ¥çœ‹innodbçŠ¶æ€ï¼Œæ‰“å°æ­»é”æ—¥å¿—ï¼ŒNaviCatå¤åˆ¶å‡ºå»çœ‹</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engine</span> <span class="keyword">innodb</span> <span class="keyword">status</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--è®¾ç½®éš”ç¦»çº§åˆ«</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> XXX;</span><br><span class="line"><span class="comment">--åªæ”¹å˜å½“å‰ä¼šè¯çš„éš”ç¦»çº§åˆ«</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">READ</span> COMMITED;</span><br></pre></td></tr></table></figure><h3 id="3-7-äº‹åŠ¡æ—¥å¿—"><a href="#3-7-äº‹åŠ¡æ—¥å¿—" class="headerlink" title="3.7 äº‹åŠ¡æ—¥å¿—"></a>3.7 äº‹åŠ¡æ—¥å¿—</h3><p>äº‹åŠ¡æ—¥å¿—ç”¨æ¥æé«˜äº‹åŠ¡çš„æ‰§è¡Œæ•ˆç‡ï¼Œå­˜å‚¨å¼•æ“åœ¨ä¿®æ”¹è¡¨çš„æ•°æ®æ—¶åªéœ€ä¿®æ”¹å†…å­˜æ‹·è´ï¼Œå†æŠŠä¿®æ”¹è¡Œä¸ºè®°å½•åœ¨æŒä¹…çš„ç¡¬ç›˜ä¸Šçš„äº‹åŠ¡æ—¥å¿—ä¸­ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½æŠŠä¿®æ”¹çš„æ•°æ®æŒä¹…åˆ°ç¡¬ç›˜ã€‚</p><p>äº‹åŠ¡æ—¥å¿—é€šè¿‡è¿½åŠ çš„æ–¹å¼ï¼Œæ“ä½œæ˜¯ç£ç›˜å°å—åŒºåŸŸä¸Šçš„é¡ºåºI/Oï¼Œè¦æ¯”éšæœºI/Oå¿«å¾—å¤šã€‚æ‰€ä»¥æ¯æ¬¡ä¿®æ”¹æ•°æ®éœ€è¦<strong>å†™ä¸¤æ¬¡ç£ç›˜</strong>ã€‚</p><h3 id="3-8-å­˜å‚¨å¼•æ“ä¸äº‹åŠ¡"><a href="#3-8-å­˜å‚¨å¼•æ“ä¸äº‹åŠ¡" class="headerlink" title="3.8 å­˜å‚¨å¼•æ“ä¸äº‹åŠ¡"></a>3.8 å­˜å‚¨å¼•æ“ä¸äº‹åŠ¡</h3><p>MySQLæœ‰å¾ˆå¤šæ”¯æŒäº‹åŠ¡çš„å­˜å‚¨å¼•æ“ï¼Œå¦‚InnoDBã€NDB Clusterã€XtraDBå’ŒPBXTç­‰ã€‚</p><h4 id="ï¼ˆ1ï¼‰è‡ªåŠ¨æäº¤ï¼ˆAUTO-COMMITï¼‰"><a href="#ï¼ˆ1ï¼‰è‡ªåŠ¨æäº¤ï¼ˆAUTO-COMMITï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰è‡ªåŠ¨æäº¤ï¼ˆAUTO COMMITï¼‰"></a>ï¼ˆ1ï¼‰è‡ªåŠ¨æäº¤ï¼ˆAUTO COMMITï¼‰</h4><p>MySQLé»˜è®¤é‡‡ç”¨è‡ªåŠ¨æäº¤æ¨¡å¼ã€‚æ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šè¢«å½“åšä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œæäº¤æ“ä½œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'AUTOCOMMIT'</span></span><br><span class="line"></span><br><span class="line">Variable_name<span class="keyword">Value</span></span><br><span class="line">autocommit    <span class="keyword">ON</span></span><br><span class="line"><span class="comment">--1å¯ç”¨0ç¦ç”¨</span></span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰ä¸­æ¶‰åŠå¤§é‡æ•°æ®æ”¹å˜çš„æ“ä½œï¼ˆå¦‚Alter Tableã€Lock Tablesï¼‰ä¼šå¼ºåˆ¶æ‰§è¡ŒCOMMITæäº¤å½“å‰æ´»åŠ¨äº‹åŠ¡ã€‚</p><h4 id="ï¼ˆ2ï¼‰åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“"><a href="#ï¼ˆ2ï¼‰åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“" class="headerlink" title="ï¼ˆ2ï¼‰åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“"></a>ï¼ˆ2ï¼‰åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“</h4><p>äº‹åŠ¡ç”±å­˜å‚¨å¼•æ“å®ç°ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ä½¿ç”¨å¤šç§å­˜å‚¨å¼•æ“ä¸å¯é ï¼Œå¦‚æœåœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨äº†å¤šä¸ªåŒ…æ‹¬äº‹åŠ¡å‹å’Œéäº‹åŠ¡å‹å­˜å‚¨å¼•æ“çš„è¡¨ï¼Œæ­£å¸¸æäº¤ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†éœ€è¦å›æ»šæ—¶éäº‹åŠ¡å‹çš„è¡¨æ— æ³•æ’¤é”€å˜æ›´ã€‚è€Œä¸”ä»…ä»…åœ¨å›æ»šæ—¶æç¤ºä¸€ä¸ªè­¦å‘Šï¼Œå…¶ä½™æƒ…å†µä¸ä¼šæœ‰æç¤ºã€‚</p><h4 id="ï¼ˆ3ï¼‰éšå¼å’Œæ˜¾å¼é”å®š"><a href="#ï¼ˆ3ï¼‰éšå¼å’Œæ˜¾å¼é”å®š" class="headerlink" title="ï¼ˆ3ï¼‰éšå¼å’Œæ˜¾å¼é”å®š"></a>ï¼ˆ3ï¼‰éšå¼å’Œæ˜¾å¼é”å®š</h4><ul><li><p>éšå¼é”å®šï¼šInnoDBé‡‡ç”¨<strong>ä¸¤é˜¶æ®µé”å®šåè®®</strong>ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥éšæ—¶é”å®šï¼Œä½†åªæœ‰äº‹åŠ¡æäº¤æˆ–å›æ»šæ—¶æ‰ä¼šé‡Šæ”¾ï¼Œå¹¶ä¸”æ˜¯åŒä¸€æ—¶åˆ»é‡Šæ”¾ã€‚InnoDBæ ¹æ®éš”ç¦»çº§åˆ«åœ¨éœ€è¦æ—¶è‡ªåŠ¨åŠ é”ã€‚</p></li><li><p>æ˜¾å¼é”å®šï¼šé€šè¿‡ç‰¹ç‚¹è¯­å¥è¿›è¡Œé”å®šã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">LOCK</span> <span class="keyword">IN</span> <span class="keyword">SHARE</span> <span class="keyword">MODE</span></span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span></span><br></pre></td></tr></table></figure><p><code>LOCK TABLES</code> å’Œ <code>UNLOCK TABLES</code> ç”±æœåŠ¡å™¨å±‚å®ç°ï¼Œä¸å­˜å‚¨å¼•æ“æ— å…³ï¼Œä¸èƒ½ç”¨æ¥ä»£æ›¿äº‹åŠ¡ã€‚</p></li></ul><h2 id="å››-å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC"><a href="#å››-å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC" class="headerlink" title="å››. å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC"></a>å››. å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC</h2><h3 id="4-1-ä»€ä¹ˆæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Ÿ"><a href="#4-1-ä»€ä¹ˆæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Ÿ" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Ÿ"></a>4.1 ä»€ä¹ˆæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Ÿ</h3><p>å¤§éƒ¨åˆ†äº‹åŠ¡å‹å­˜å‚¨å¼•æ“å®ç°çš„éƒ½ä¸æ˜¯ç®€å•çš„è¡Œçº§é”ï¼Œä¸€èˆ¬éƒ½åŒæ—¶å®ç°äº†å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCCï¼Œ<strong>è¯¥æœºåˆ¶å¯ä»¥åœ¨å¾ˆå¤šæƒ…å†µä¸‹é¿å…åŠ é”æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥é™ä½å¼€é”€ï¼Œä¸€èˆ¬éƒ½ä¼šå®ç°éé˜»å¡çš„è¯»æ“ä½œå’Œåªé”å®šå¿…è¦è¡Œçš„å†™æ“ä½œ</strong>ã€‚</p><p>MVCCå®ç°æœºåˆ¶å„ä¸ç›¸åŒï¼š</p><ul><li>ä¹è§‚å¹¶å‘æ§åˆ¶</li><li>æ‚²è§‚å¹¶å‘æ§åˆ¶</li></ul><p><strong>MVCCåªå…¼å®¹äº REPEATABLE READ å’Œ READ COMMITED è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«ï¼Œè€Œ READ UNCOMMITED æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®è¡Œè€Œä¸æ˜¯ç¬¦åˆå½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®è¡Œï¼ŒSERIALIZABLE åˆ™ä¼šå¯¹æ‰€æœ‰è¯»å–çš„è¡ŒåŠ é”</strong>ã€‚</p><h3 id="4-2-å¦‚ä½•å®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Ÿ"><a href="#4-2-å¦‚ä½•å®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Ÿ" class="headerlink" title="4.2 å¦‚ä½•å®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Ÿ"></a>4.2 å¦‚ä½•å®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Ÿ</h3><p><strong>é€šè¿‡ä¿å­˜æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ¥å®ç°</strong>ã€‚</p><p>InnoDBé€šè¿‡åœ¨æ¯è¡Œè®°å½•åé¢ä¿å­˜ä¸¤ä¸ªéšè—çš„åˆ—ï¼Œä¸€ä¸ªä¿å­˜äº†è¡Œçš„åˆ›å»ºæ—¶é—´ï¼Œä¸€ä¸ªä¿å­˜è¡Œçš„è¿‡æœŸæ—¶é—´ï¼ˆå®é™…å­˜å‚¨çš„éæ—¶é—´è€Œæ˜¯ç³»ç»Ÿç‰ˆæœ¬å·ï¼‰ã€‚æ¯å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œç‰ˆæœ¬å·éƒ½ä¼šè‡ªåŠ¨é€’å¢ï¼Œäº‹åŠ¡å¼€å§‹æ—¶åˆ»çš„ç‰ˆæœ¬å·ä½œä¸ºäº‹åŠ¡çš„ç‰ˆæœ¬å·ä¸æŸ¥è¯¢åˆ°çš„æ¯è¡Œè®°å½•è¿›è¡Œæ¯”è¾ƒã€‚</p><p>åœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ï¼š</p><ul><li>SELECTï¼šæ ¹æ®ä¸¤ä¸ªæ¡ä»¶æ£€æŸ¥æ¯è¡Œè®°å½•ï¼Œç¬¦åˆæ‰ä½œä¸ºæŸ¥è¯¢ç»“æœè¿”å›ã€‚<ul><li>åªæŸ¥æ‰¾ç‰ˆæœ¬æ—©äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®è¡Œï¼Œç¡®ä¿äº‹åŠ¡è¯»å–çš„è¡Œæ˜¯äº‹åŠ¡å¼€å§‹å‰å­˜åœ¨æˆ–è‡ªå·±ä¿®æ”¹è¿‡çš„ã€‚</li><li>è¡Œçš„åˆ é™¤ç‰ˆæœ¬è¦ä¹ˆæœªå®šä¹‰ï¼Œè¦ä¹ˆå¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œç¡®ä¿äº‹åŠ¡è¯»å–åˆ°çš„è¡Œåœ¨äº‹åŠ¡å¼€å§‹å‰æœªè¢«åˆ é™¤ã€‚</li></ul></li><li>INSERTï¼šä¸ºæ–°æ’å…¥çš„æ¯ä¸€è¡Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸º<strong>è¡Œç‰ˆæœ¬å·</strong>ã€‚</li><li>DELETEï¼šä¸ºåˆ é™¤çš„æ¯ä¸€è¡Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸º<strong>è¡Œåˆ é™¤æ ‡è¯†</strong>ã€‚</li><li>UPDATEï¼šæ’å…¥ä¸€è¡Œæ–°çºªå½•ï¼Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸º<strong>è¡Œç‰ˆæœ¬å·</strong>ï¼ŒåŒæ—¶ä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·åˆ°åŸæ¥çš„è¡Œä½œä¸º<strong>è¡Œåˆ é™¤æ ‡è¯†</strong>ã€‚</li></ul><p>é€šè¿‡è¿™ä¸¤ä¸ªç‰ˆæœ¬å·å¯ä»¥ä½¿å¤§éƒ¨åˆ†è¯»æ“ä½œéƒ½ä¸éœ€åŠ é”ï¼ˆä¹è§‚ï¼‰ï¼Œä»¥å°‘é‡çš„é¢å¤–å­˜å‚¨ç©ºé—´å’Œæ£€æŸ¥ç»´æŠ¤å·¥ä½œæ¢å–å¥½çš„æ€§èƒ½ã€‚</p><h2 id="äº”-å­˜å‚¨å¼•æ“"><a href="#äº”-å­˜å‚¨å¼•æ“" class="headerlink" title="äº”. å­˜å‚¨å¼•æ“"></a>äº”. å­˜å‚¨å¼•æ“</h2><p>æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ŒMySQLå°†æ¯ä¸ªæ•°æ®åº“ä¿å­˜ä¸ºæ•°æ®ç›®å½•ä¸‹çš„ä¸€ä¸ªå­ç›®å½•ã€‚åˆ›å»ºè¡¨æ—¶åœ¨æ•°æ®åº“å­ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå’Œè¡¨åŒåçš„ <code>.frm</code> æ–‡ä»¶ä¿å­˜è¡¨çš„å®šä¹‰ã€‚è¡¨çš„å®šä¹‰ç»Ÿä¸€åœ¨æœåŠ¡å±‚å¤„ç†ï¼Œæ•°æ®å’Œç´¢å¼•åˆ™åœ¨ä¸åŒçš„å­˜å‚¨å¼•æ“ä¸­ä¿å­˜æ–¹å¼ä¸åŒã€‚</p><p>æ­£å› ä¸ºä½¿ç”¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•æ–‡ä»¶ï¼Œæ‰€ä»¥MySQLå¤§å°å†™æ•æ„Ÿå’Œå¹³å°ç›¸å…³ï¼ŒWindowsä¸­ä¸æ•æ„Ÿï¼Œè€Œç±»Unixä¸­åˆ™æ•æ„Ÿã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--æŸ¥çœ‹è¡¨ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> <span class="keyword">STATUS</span> <span class="keyword">LIKE</span> <span class="string">'è¡¨å'</span></span><br></pre></td></tr></table></figure><p>è¿”å›å­—æ®µï¼š</p><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>Name</td><td>è¡¨å</td><td>version</td></tr><tr><td>Engine</td><td>å­˜å‚¨å¼•æ“ç±»å‹</td><td>InnoDB</td></tr><tr><td>Version</td><td></td><td>10</td></tr><tr><td>Row_format</td><td>è¡Œæ ¼å¼ï¼š<br>-Dynamicçš„è¡Œé•¿åº¦å¯å˜ï¼Œä¸€èˆ¬ä¼šæœ‰å¦‚VARCHARæˆ–BLOBè¿™ç§å¯å˜é•¿å­—æ®µ<br>-Fixedçš„è¡Œé•¿åº¦å›ºå®šï¼ŒåªåŒ…å«å¦‚CHARä½•INTEGERè¿™ç§å›ºå®šé•¿åº¦å­—æ®µ<br>-Compressedåªåœ¨å‹ç¼©è¡¨å­˜åœ¨<br>â€¦.</td><td>Compact</td></tr><tr><td>Rows</td><td>è¡¨çš„è¡Œæ•°ï¼Œå¯¹äºInnoDBæ˜¯ä¼°è®¡å€¼ï¼ŒMyISAMåˆ™æ˜¯ç²¾ç¡®å€¼</td><td>25</td></tr><tr><td>Avg_row_length</td><td>å¹³å‡æ¯è¡ŒåŒ…å«çš„å­—èŠ‚æ•°</td><td>655</td></tr><tr><td>Data_length</td><td>è¡¨æ•°æ®çš„å¤§å°ï¼Œå•ä½å­—èŠ‚</td><td>16384</td></tr><tr><td>Max_data_length</td><td>è¡¨æ•°æ®çš„æœ€å¤§å®¹é‡</td><td>0</td></tr><tr><td>Index_length</td><td>ç´¢å¼•å¤§å°</td><td>16384</td></tr><tr><td>Data_free</td><td>è¡¨ç¤ºå·²åˆ†é…ä½†ç›®å‰æ²¡æœ‰ä½¿ç”¨çš„ç©ºé—´ã€‚åŒ…æ‹¬å·²åˆ é™¤çš„è¡Œä»¥åŠåç»­å¯ä»¥è¢«Insertåˆ©ç”¨çš„ç©ºé—´</td><td>0</td></tr><tr><td>Auto_increment</td><td>ä¸‹ä¸€ä¸ªè‡ªå¢çš„å€¼</td><td></td></tr><tr><td>Create_time</td><td>è¡¨çš„åˆ›å»ºæ—¶é—´</td><td>2020-12-02 13:04:02</td></tr><tr><td>Update_time</td><td>è¡¨æ•°æ®çš„æœ€åä¿®æ”¹æ—¶é—´</td><td></td></tr><tr><td>Check_time</td><td>ä½¿ç”¨CHECK TABLEå‘½ä»¤æˆ–myisamchkç­‰å·¥å…·æœ€åä¸€æ¬¡æ£€æŸ¥è¡¨çš„æ—¶é—´</td><td></td></tr><tr><td>Collation</td><td>è¡¨çš„é»˜è®¤å­—ç¬¦é›†å’Œå­—ç¬¦åˆ—æ’åºè§„åˆ™</td><td>gbk_chinese_ci</td></tr><tr><td>Checksum</td><td>å¯ç”¨æ—¶ä¿å­˜æ•´ä¸ªè¡¨çš„å®æ—¶æ ¡éªŒå’Œ</td><td></td></tr><tr><td>Create_options</td><td>åˆ›å»ºè¡¨æ—¶æŒ‡å®šçš„å…¶ä»–é€‰é¡¹</td><td></td></tr><tr><td>Comment</td><td>é¢å¤–ä¿¡æ¯ï¼ŒInnoDBè¡¨ç©ºé—´çš„å‰©ä½™ç©ºé—´ä¿¡æ¯ï¼Œè§†å›¾VIEWæ–‡æœ¬ç­‰</td></tr></tbody></table><h3 id="5-1-InnoDB"><a href="#5-1-InnoDB" class="headerlink" title="5.1 InnoDB"></a>5.1 InnoDB</h3><p>MySQLé»˜è®¤çš„äº‹åŠ¡å‹å­˜å‚¨å¼•æ“ï¼Œè®¾è®¡ç”¨æ¥æ‰§è¡Œå¤§é‡<strong>çŸ­æœŸäº‹åŠ¡</strong>ï¼ŒçŸ­æœŸäº‹åŠ¡å¾ˆå°‘å›æ»šã€‚</p><p>MySQL 5.1åï¼Œæ–°çš„InnoDB pluginæä¾›å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œå¦‚åˆ©ç”¨æ’åºåˆ›å»ºç´¢å¼•ã€åˆ é™¤æˆ–å¢åŠ ç´¢å¼•æ—¶ä¸éœ€è¦å¤åˆ¶å…¨è¡¨æ•°æ®ã€æ–°çš„æ”¯æŒå‹ç¼©çš„å­˜å‚¨æ ¼å¼ã€æ–°çš„å¤§å‹åˆ—å€¼å¦‚BLOBçš„å­˜å‚¨æ–¹å¼ã€ä»¥åŠæ–‡ä»¶æ ¼å¼ç®¡ç†ç­‰ã€‚</p><p>InnoDBï¼š</p><ul><li>æ•°æ®å­˜å‚¨åœ¨<strong>è¡¨ç©ºé—´</strong>ï¼ˆtablespaceï¼‰ä¸­ï¼Œç”±ä¸€ç³»åˆ—æ•°æ®æ–‡ä»¶ç»„æˆï¼ŒInnoDBå¯ä»¥å°†æ¯ä¸ªè¡¨çš„æ•°æ®å’Œç´¢å¼•å­˜æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚</li><li>é‡‡ç”¨MVCCæ¥æ”¯æŒé«˜å¹¶å‘ï¼Œå®ç°äº†å››ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤æ˜¯<strong>å¯é‡å¤è¯»</strong>ï¼ˆREPEATABLE READï¼‰ï¼Œ<strong>é€šè¿‡é—´éš™é”ç­–ç•¥é˜²æ­¢å¹»è¯»å‡ºç°</strong>ï¼Œé—´éš™é”ä½¿InnoDBä¸ä»…é”è¡Œï¼Œè¿˜æœªé”å®šç´¢å¼•ä¸­çš„é—´éš™ä»¥é˜²æ­¢å¹»å½±è¡Œçš„æ’å…¥ã€‚</li><li>è¡¨åŸºäº<strong>èšç°‡ç´¢å¼•</strong>å»ºç«‹ï¼Œä¸»é”®æŸ¥è¯¢æœ‰å¾ˆå¥½çš„æ€§èƒ½ï¼Œä½†å…¶äºŒçº§ç´¢å¼•ï¼ˆéä¸»é”®ç´¢å¼•ï¼‰å¿…é¡»åŒ…å«ä¸»é”®åˆ—ï¼Œè‹¥ä¸»é”®åˆ—å¾ˆå¤§ä¼šå¯¼è‡´æ‰€æœ‰ç´¢å¼•éƒ½å¾ˆå¤§ï¼ˆä¸»é”®åº”å°½é‡å°ä¸€äº›ï¼‰ã€‚</li><li>å†…éƒ¨ä¼˜åŒ–ï¼šä»ç£ç›˜è¯»å–æ•°æ®æ—¶é‡‡ç”¨äº†<strong>å¯é¢„æµ‹æ€§é¢„è¯»</strong>ã€è‡ªåŠ¨åœ¨å†…å­˜ä¸­åˆ›å»ºhashç´¢å¼•ä»¥åŠ é€Ÿè¯»æ“ä½œçš„<strong>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</strong>ã€èƒ½å¤ŸåŠ é€Ÿæ’å…¥æ“ä½œçš„<strong>æ’å…¥ç¼“å†²åŒº</strong>ç­‰ã€‚</li><li>InnoDBæ”¯æŒçƒ­å¤‡ä»½ï¼Œå¦‚ MySQL Enterprise Backupã€XtraBackupéƒ½å¯ä»¥å®ç°ã€‚</li></ul><h3 id="5-2-MyISAM"><a href="#5-2-MyISAM" class="headerlink" title="5.2 MyISAM"></a>5.2 MyISAM</h3><p>æ”¯æŒå¦‚å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°ç­‰ï¼Œä½†ä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚å¯¹äºåªè¯»æ•°æ®æˆ–å°è¡¨ä¸”å¯ä»¥æ¥å—ä¿®å¤æ“ä½œçš„åœºæ™¯ä»å¯ä»¥ç»§ç»­ä½¿ç”¨è¯¥å¼•æ“ã€‚</p><p>MyISAMï¼š</p><ul><li><strong>å­˜å‚¨</strong>ï¼šè¡¨å­˜å‚¨åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼šæ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶ï¼Œåˆ†åˆ«ä»¥ <code>.MYD</code> å’Œ <code>.MYI</code> ä¸ºæ‰©å±•åã€‚</li><li><strong>åŠ é”ä¸å¹¶å‘</strong>ï¼šå¯¹æ•´å¼ è¡¨åŠ é”ï¼Œä¸èƒ½é’ˆå¯¹è¡Œï¼›è¯»å–æ—¶å¯¹æ‰€æœ‰éœ€è¦çš„è¡¨åŠ å…±äº«é”ï¼Œå†™å…¥æ—¶åˆ™åŠ æ’å®ƒé”ï¼Œä½†å…è®¸è¡¨è¯»å–æ—¶å‘è¡¨ä¸­æ’å…¥æ–°çºªå½•ï¼ˆ<strong>å…è®¸å¹¶å‘æ’å…¥</strong>ï¼‰ã€‚</li><li><strong>ä¿®å¤</strong>ï¼šå¯ä»¥æ‰‹å·¥æˆ–è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥å’Œä¿®å¤æ“ä½œï¼Œä¿®å¤æ“ä½œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±è€Œä¸”æ‰§è¡Œé€Ÿåº¦å¾ˆæ…¢ã€‚<ul><li><code>CHECK TABLE mytable</code> æ£€æŸ¥è¡¨é”™è¯¯ã€‚</li><li><code>REPAIR TABLE mytable</code> ä¿®å¤é”™è¯¯ã€‚</li><li><code>myisamchk</code> å‘½ä»¤è¡Œå·¥å…·ã€‚</li></ul></li><li><strong>ç´¢å¼•</strong>ï¼šå³ä½¿æ˜¯BLOBå’ŒTEXTç­‰é•¿å­—æ®µï¼Œä¹Ÿå¯ä»¥åŸºäºå‰500ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ã€‚æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼ŒåŸºäºåˆ†è¯åˆ›å»ºçš„ç´¢å¼•ï¼Œå¯ä»¥æ”¯æŒå¤æ‚æŸ¥è¯¢ã€‚</li><li><strong>å»¶è¿Ÿæ›´æ–°ç´¢å¼•é”®</strong>ï¼šåˆ›å»ºè¡¨æ—¶ï¼Œè‹¥æŒ‡å®šäº† <code>DELAY_KEY_WRITE</code> é€‰é¡¹ï¼Œåœ¨æ¯æ¬¡ä¿®æ”¹æ‰§è¡ŒæˆåŠŸåä¸ä¼šé©¬ä¸ŠæŠŠä¿®æ”¹çš„ç´¢å¼•æ•°æ®å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å†™å…¥å†…å­˜çš„é”®ç¼“å†²åŒºï¼Œåªæœ‰æ¸…ç†é”®ç¼“å†²åŒºæˆ–å…³é—­è¡¨æ—¶æ‰å†™å…¥ç£ç›˜ï¼›è¿™ç§æ–¹å¼å¯ä»¥æå¤§çš„æå‡å†™å…¥æ€§èƒ½ï¼Œä½†åœ¨å´©æºƒæ—¶ä¼šé€ æˆç´¢å¼•æŸåï¼Œéœ€è¦è¿›è¡Œä¿®å¤ã€‚</li><li><strong>å‹ç¼©è¡¨</strong>ï¼šä½¿ç”¨ <code>myisampack</code> å°†è¡¨å‹ç¼©ï¼ˆæ‰“åŒ…packï¼‰ï¼Œå‹ç¼©çŠ¶æ€ä¸å…è®¸ä¿®æ”¹ï¼Œå¯ä»¥æå¤§çš„å‡å°‘ç£ç›˜ç©ºé—´å ç”¨ï¼Œå‹ç¼©è¡¨æ”¯æŒç´¢å¼•ï¼Œä½†ç´¢å¼•ä¹Ÿæ˜¯åªè¯»çš„ã€‚</li><li><strong>æ€§èƒ½</strong>ï¼šæ•°æ®ä»¥ç´§å¯†æ ¼å¼å­˜å‚¨ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹æ€§èƒ½å¾ˆå¥½ã€‚ä¸»è¦é—®é¢˜æ˜¯è¡¨é”ï¼Œå®¹æ˜“å¯¼è‡´æŸ¥è¯¢å¤„äº Locked çŠ¶æ€ã€‚</li></ul><h3 id="5-3-MySQLå†…å»ºå…¶ä»–å­˜å‚¨å¼•æ“"><a href="#5-3-MySQLå†…å»ºå…¶ä»–å­˜å‚¨å¼•æ“" class="headerlink" title="5.3 MySQLå†…å»ºå…¶ä»–å­˜å‚¨å¼•æ“"></a>5.3 MySQLå†…å»ºå…¶ä»–å­˜å‚¨å¼•æ“</h3><ul><li><p><strong>Archiveå¼•æ“</strong>ï¼š</p><ul><li>åªæ”¯æŒINSERTå’ŒSELECTæ“ä½œã€‚</li><li><strong>é«˜é€Ÿæ’å…¥å’Œå‹ç¼©</strong>ï¼šæ’å…¥ç¼“å­˜æ‰€æœ‰çš„å†™ï¼Œåˆ©ç”¨zliå¯¹æ’å…¥çš„è¡Œè¿›è¡Œå‹ç¼©ï¼Œæ¯”MyISAMæ›´å°‘çš„ç£ç›˜I/Oã€‚</li><li>æ¯æ¬¡æŸ¥è¯¢éƒ½è¦æ‰§è¡Œå…¨è¡¨æ‰«æï¼Œé€‚åˆæ—¥å¿—å’Œæ•°æ®é‡‡é›†ç±»åº”ç”¨ã€‚</li><li>æ”¯æŒè¡Œçº§é”å’Œä¸“ç”¨ç¼“å†²åŒºï¼Œå¯ä»¥å®ç°é«˜å¹¶å‘çš„æ’å…¥ã€‚</li><li>æŸ¥è¯¢åœ¨è¿”å›å‰ä¼šé˜»æ­¢å…¶ä»–æŸ¥è¯¢æ‰§è¡Œä»¥ä¿è¯ä¸€è‡´æ€§è¯»ã€‚</li></ul></li><li><p><strong>Blackholeå¼•æ“</strong>ï¼šä¸ä¿å­˜ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨ä¼šè®°å½•Blackholeè¡¨çš„æ—¥å¿—ï¼Œå¯ä»¥ç”¨äºå¤åˆ¶æ•°æ®åˆ°å¤‡åº“æˆ–è®°å½•æ—¥å¿—ã€‚</p></li><li><p><strong>CSVå¼•æ“</strong>ï¼šå°†CSVæ–‡ä»¶å½“åšMySQLè¡¨æ¥å¤„ç†ï¼Œä¸æ”¯æŒç´¢å¼•ã€‚å¯ä»¥ä½œä¸ºä¸€ç§æ•°æ®äº¤æ¢çš„æœºåˆ¶ã€‚</p></li><li><p><strong>Federatedå¼•æ“</strong>ï¼šè®¿é—®å…¶ä»–MySQLæœåŠ¡å™¨çš„ä¸€ä¸ªä»£ç†ï¼Œåˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶å°†æŸ¥è¯¢ä¼ è¾“åˆ°è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œï¼Œç„¶åæå–æˆ–å‘é€éœ€è¦çš„æ•°æ®ã€‚å¸‚åœºåŒ–è®¾è®¡ï¼Œç»å¸¸æœ‰é—®é¢˜ï¼Œé»˜è®¤ç¦ç”¨ã€‚</p></li><li><p><strong>Memoryå¼•æ“</strong>ï¼šæ‰€æœ‰æ•°æ®éƒ½å­˜åœ¨å†…å­˜ï¼Œä¸éœ€è¦ç£ç›˜I/Oï¼Œè¡¨ç»“æ„é‡å¯åä»èƒ½ä¿ç•™ï¼Œä½†æ•°æ®ä¼šä¸¢å¤±ï¼Œæ¯”MyISAMè¦å¿«ä¸€ä¸ªæ•°é‡çº§ã€‚</p><ul><li>æ”¯æŒHashç´¢å¼•ï¼Œåªæ”¯æŒè¡¨çº§é”ï¼Œä¸æ”¯æŒBLOBæˆ–TEXTç±»å‹ï¼Œä¸”è¡Œé•¿åº¦å›ºå®šï¼Œå³ä½¿æŒ‡å®šVARCHARå®é™…å­˜å‚¨æ—¶ä¹Ÿä¼šè½¬æ¢æˆCHARã€‚</li><li>MySQLæ‰§è¡ŒæŸ¥è¯¢æ—¶å¦‚æœéœ€è¦ä¸´æ—¶è¡¨æ¥ä¿å­˜ä¸­é—´ç»“æœï¼Œå†…éƒ¨å°±æ˜¯ä½¿ç”¨Memoryè¡¨ï¼Œå¦‚æœç»“æœå¤ªå¤§è¶…è¿‡å†…å­˜è¡¨é™åˆ¶æˆ–å«æœ‰BLOBå’ŒTEXTå­—æ®µï¼Œä¼šè½¬æ¢ä¸ºMyISAMè¡¨ã€‚</li></ul><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>æŸ¥æ‰¾æˆ–æ˜ å°„è¡¨ã€‚</li><li>ç¼“å­˜å‘¨æœŸæ€§èšåˆæ•°æ®çš„ç»“æœã€‚</li><li>ä¿å­˜æ•°æ®åˆ†æä¸­äº§ç”Ÿçš„ä¸­é—´æ•°æ®ã€‚</li></ul></li><li><p><strong>Mergeå¼•æ“</strong>ï¼šç”±å¤šä¸ªMyISAMè¡¨åˆå¹¶æˆçš„è™šæ‹Ÿè¡¨ï¼Œå¼•å…¥åˆ†åŒºåŠŸèƒ½åå·²è¢«åºŸå¼ƒã€‚</p></li><li><p><strong>NDBå¼•æ“</strong>ï¼šMySQLæœåŠ¡å™¨ã€NDBé›†ç¾¤å­˜å‚¨å¼•æ“ï¼Œä»¥åŠåˆ†å¸ƒå¼çš„ã€share-nothingçš„ã€å®¹ç¾çš„ã€é«˜å¯ç”¨çš„NDBæ•°æ®åº“çš„ç»„åˆè¢«ç§°ä¸ºMySQLé›†ç¾¤ã€‚</p></li></ul><h3 id="5-4-ç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“"><a href="#5-4-ç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“" class="headerlink" title="5.4 ç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“"></a>5.4 ç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“</h3><ul><li><strong>OLTPç±»å¼•æ“</strong>ï¼š<ul><li>Perconaçš„XtraDBå­˜å‚¨å¼•æ“åŸºäºInnoDBæ”¹è¿›ï¼Œå¯ä»¥ä½œä¸ºInnoDBå¼•æ“çš„æ›¿ä»£å“</li><li>PBXTï¼Œæ”¯æŒACIDäº‹åŠ¡å’ŒMVCCç­‰ã€‚</li><li>TokuDBï¼Œä½¿ç”¨ä¸€ç§å«åˆ†å½¢æ ‘çš„ç´¢å¼•æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ç§å¤§æ•°æ®å­˜å‚¨å¼•æ“ï¼Œæ‹¥æœ‰å¾ˆé«˜çš„å‹ç¼©æ¯”ã€‚</li><li>RethinkDBï¼Œé‡‡ç”¨åªèƒ½è¿½åŠ çš„å†™æ—¶å¤åˆ¶Bæ ‘ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚</li></ul></li><li><strong>é¢å‘åˆ—çš„å¼•æ“</strong>ï¼šMySQLé»˜è®¤é¢å‘è¡Œï¼Œæ¯è¡Œæ•°æ®ä¸€èµ·å­˜å‚¨ï¼ŒæŸ¥è¯¢ä¹Ÿä»¥è¡Œä¸ºå•ä½å¤„ç†ã€‚å¤§æ•°æ®é‡æ—¶é¢å‘åˆ—çš„æ–¹å¼å¯ä»¥ä¼ è¾“æ›´å°‘çš„æ•°æ®ï¼Œå‹ç¼©æ•ˆç‡ä¹Ÿæ›´å¥½ã€‚</li><li><strong>ç¤¾åŒºå¼•æ“</strong>ï¼šå¦‚Ariaã€Groongaã€OQGraphã€Q4Mã€SphinxSEã€Spiderã€VPForMySQLç­‰ã€‚</li></ul><h3 id="5-5-å¦‚ä½•é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“"><a href="#5-5-å¦‚ä½•é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“" class="headerlink" title="5.5 å¦‚ä½•é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“"></a>5.5 å¦‚ä½•é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“</h3><p>å¤§éƒ¨åˆ†æƒ…å†µé€‰æ‹©InnoDBï¼Œé™¤ééœ€è¦ç”¨åˆ°InnoDBä¸å…·å¤‡çš„ç‰¹æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰æ›¿ä»£æ–¹æ¡ˆï¼Œå¦åˆ™è¯·å°½é‡é€‰æ‹©InnoDBå¼•æ“ã€‚</p><p>å°½é‡ä¸è¦æ··åˆä½¿ç”¨å¤šç§å­˜å‚¨å¼•æ“ï¼Œä¼šå¸¦æ¥ä¸€ç³»åˆ—å¤æ‚å’Œé¢„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚</p><h3 id="5-6-è½¬æ¢è¡¨çš„å­˜å‚¨å¼•æ“"><a href="#5-6-è½¬æ¢è¡¨çš„å­˜å‚¨å¼•æ“" class="headerlink" title="5.6 è½¬æ¢è¡¨çš„å­˜å‚¨å¼•æ“"></a>5.6 è½¬æ¢è¡¨çš„å­˜å‚¨å¼•æ“</h3><ul><li><p><code>ALTER TABLE</code> ï¼š<code>ALTER TABLE mytable ENGINE = InnoDB;</code> éœ€è¦æ‰§è¡Œè¾ƒé•¿æ—¶é—´ï¼ŒMySQLä¼šæŒ‰è¡Œå°†æ•°æ®ä»åŸè¡¨å¤åˆ¶åˆ°ä¸€å¼ æ–°è¡¨ï¼Œå¤åˆ¶æœŸé—´å¯èƒ½ä¼šæ¶ˆè€—ç³»ç»Ÿæ‰€æœ‰I/Oèƒ½åŠ›ï¼ŒåŒæ—¶å¯¹åŸè¡¨åŠ ä¸Šè¯»é”ã€‚æ³¨æ„ï¼Œå³ä½¿åç»­å†æ¢å¤åŸå¼•æ“ï¼Œä¹Ÿä¼šä¸¢å¤±å¦‚å¤–é”®ç­‰å’Œå¼•æ“ç›¸å…³çš„ç‰¹æ€§ã€‚</p></li><li><p><strong>å¯¼å‡ºä¸å¯¼å…¥</strong>ï¼šä½¿ç”¨ <code>mysqldump</code> å·¥å…·å°†æ•°æ®å¯¼å‡ºåˆ°æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶ä¸­ CREATE TABLE è¯­å¥çš„å­˜å‚¨å¼•æ“é€‰é¡¹ï¼Œæ³¨æ„ä¿®æ”¹è¡¨åï¼ˆé¿å…é‡å¤ï¼‰ï¼Œå·¥å…·é»˜è®¤ä¼šåœ¨ CREATE TABLE è¯­å¥å‰åŠ ä¸Š DROP TABLE å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p></li><li><p><strong>åˆ›å»ºä¸æŸ¥è¯¢</strong>ï¼šç»¼åˆå‰ä¸¤ç§æ–¹æ³•ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨å¼•æ“çš„è¡¨ï¼Œç„¶ååˆ©ç”¨ <code>INSERT...SELECT</code> è¯­å¥æ¥å¯¼å…¥æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> innodb_table <span class="keyword">LIKE</span> myisam_table;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> innodb_table <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> innodb_table <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myisam_table;</span><br></pre></td></tr></table></figure><p>æ•°æ®é‡å¤§æ—¶å¯ä»¥è€ƒè™‘åˆ†æ‰¹å¤„ç†ï¼Œé’ˆå¯¹æ¯ä¸€æ®µæ•°æ®æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œé¿å…å¤§äº‹åŠ¡äº§ç”Ÿè¿‡å¤šçš„undoã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> innodb_table <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myisam_table</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">BETWEEN</span> x <span class="keyword">AND</span> y;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰å¿…è¦ï¼Œå¯ä»¥åœ¨æ‰§è¡Œæ—¶å¯¹åŸè¡¨åŠ é”ï¼Œä»¥ç¡®ä¿æ–°è¡¨å’ŒåŸè¡¨æ•°æ®ä¸€è‡´ã€‚</p><p>Percona Toolkitæä¾›äº† pt-online-schema-change å·¥å…·æ–¹ä¾¿ç®€å•å®‰å…¨çš„æ‰§è¡Œä¸Šè¿°è¿‡ç¨‹ã€‚</p></li></ul><h2 id="å…­-æ—¶é—´çº¿-Timeline"><a href="#å…­-æ—¶é—´çº¿-Timeline" class="headerlink" title="å…­. æ—¶é—´çº¿-Timeline"></a>å…­. æ—¶é—´çº¿-Timeline</h2><ul><li>ç‰ˆæœ¬  3.23 2001</li><li>ç‰ˆæœ¬  4.0   2003</li><li>ç‰ˆæœ¬  4.1   2005</li><li>ç‰ˆæœ¬  5.0   2006</li><li>ç‰ˆæœ¬  5.1   2008</li><li>ç‰ˆæœ¬  5.5   2010 ï¼šOracleæ”¶è´­ï¼ŒInnoDBæˆä¸ºé»˜è®¤å­˜å‚¨å¼•æ“ã€‚</li><li>ç‰ˆæœ¬  5.6   </li><li>â€¦.</li></ul><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šé«˜æ€§èƒ½MySQLã€‹</p>]]></content>
    
    <summary type="html">
    
      ã€Šé«˜æ€§èƒ½MySQLã€‹è¯»ä¹¦ç¬”è®°ï¼Œå†…å®¹ï¼šMySQLé€»è¾‘æ¶æ„ï¼Œå¹¶å‘æ§åˆ¶ï¼Œäº‹åŠ¡ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå­˜å‚¨å¼•æ“ï¼Œæ—¶é—´çº¿ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="mysql" scheme="http://linyishui.top/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰è¿›ç¨‹é—´é€šä¿¡</title>
    <link href="http://linyishui.top/2020112801.html"/>
    <id>http://linyishui.top/2020112801.html</id>
    <published>2020-11-28T15:28:34.000Z</published>
    <updated>2020-12-17T14:07:24.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="è¿›ç¨‹é—´é€šä¿¡"><a href="#è¿›ç¨‹é—´é€šä¿¡" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡"></a>è¿›ç¨‹é—´é€šä¿¡</h1><h2 id="ä¸€-æ¦‚è¿°"><a href="#ä¸€-æ¦‚è¿°" class="headerlink" title="ä¸€. æ¦‚è¿°"></a>ä¸€. æ¦‚è¿°</h2><h3 id="1-1-å¾®æœåŠ¡æ¶æ„ä¸­è¦é¢‘ç¹ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡"><a href="#1-1-å¾®æœåŠ¡æ¶æ„ä¸­è¦é¢‘ç¹ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡" class="headerlink" title="1.1 å¾®æœåŠ¡æ¶æ„ä¸­è¦é¢‘ç¹ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡"></a>1.1 å¾®æœåŠ¡æ¶æ„ä¸­è¦é¢‘ç¹ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡</h3><p>FIGOæœ‰ä¸€ä¸ªREST APIä¾›ç§»åŠ¨ç«¯å’ŒWebç«¯ä½¿ç”¨ï¼Œè¿˜ä½¿ç”¨äº†ä¸€äº›äº‘æœåŠ¡å¦‚Twilioæ¶ˆæ¯æœåŠ¡å’ŒStripeæ”¯ä»˜æœåŠ¡ï¼Œä½†åœ¨å•ä½“åº”ç”¨å†…æ˜¯è¯­è¨€çº§æ–¹æ³•æˆ–å‡½æ•°ç›¸äº’è°ƒç”¨ï¼Œé™¤äº†å¼€å‘APIå’Œé›†æˆäº‘æœåŠ¡ä¸ä¼šè€ƒè™‘<strong>è¿›ç¨‹é—´é€šä¿¡</strong>ï¼ˆIPCï¼‰ã€‚</p><p>å¾®æœåŠ¡æ¶æ„ä¸­å„ä¸ªæœåŠ¡å®ä¾‹é€šå¸¸æ˜¯åœ¨å¤šå°æœºå™¨ä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡è¿›è¡Œäº¤äº’ã€‚é€‰æ‹©åˆé€‚çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶æ˜¯ä¸€ä¸ªé‡è¦çš„æ¶æ„å†³ç­–ï¼Œé™¤äº†å½±å“åº”ç”¨çš„å¯ç”¨æ€§ï¼Œç”šè‡³è¿˜ä¸äº‹åŠ¡ç®¡ç†äº’ç›¸å½±å“ã€‚<strong>ç†æƒ³çš„å¾®æœåŠ¡æ¶æ„åº”è¯¥åœ¨å†…éƒ¨ç”±æ¾æ•£è€¦åˆçš„è‹¥å¹²æœåŠ¡ç»„æˆï¼ŒæœåŠ¡é—´ä½¿ç”¨å¼‚æ­¥æ¶ˆæ¯ç›¸äº’é€šä¿¡</strong>ã€‚</p><h3 id="1-2-å¸¸è§è¿›ç¨‹é—´é€šä¿¡æŠ€æœ¯"><a href="#1-2-å¸¸è§è¿›ç¨‹é—´é€šä¿¡æŠ€æœ¯" class="headerlink" title="1.2 å¸¸è§è¿›ç¨‹é—´é€šä¿¡æŠ€æœ¯"></a>1.2 å¸¸è§è¿›ç¨‹é—´é€šä¿¡æŠ€æœ¯</h3><p>è¿›ç¨‹é—´é€šä¿¡æŠ€æœ¯æœ‰å¾ˆå¤šï¼š</p><ul><li>åŸºäºåŒæ­¥è¯·æ±‚ / å“åº”çš„é€šä¿¡æœºåˆ¶ï¼šå¦‚ HTTP REST æˆ– gRPCï¼ŒRESTï¼ˆJSONï¼‰ä¸»è¦ç”¨äºæœåŠ¡ä¸å¤–éƒ¨å…¶ä»–åº”ç”¨ç¨‹åºçš„é€šä¿¡ã€‚</li><li>å¼‚æ­¥çš„åŸºäºæ¶ˆæ¯çš„é€šä¿¡æœºåˆ¶ï¼šå¦‚ AMQP æˆ– STOMPã€‚</li></ul><p>æ¶ˆæ¯æ ¼å¼ä¹Ÿæœ‰ï¼š</p><ul><li>åŸºäºæ–‡æœ¬çš„ JSON æˆ– XMLï¼Œæœ‰å¯è¯»æ€§ã€‚</li><li>åŸºäºäºŒè¿›åˆ¶çš„ Avro æˆ– Protocol Buffers æ ¼å¼ï¼Œæ›´åŠ é«˜æ•ˆã€‚</li></ul><h3 id="1-3-äº¤äº’æ–¹å¼"><a href="#1-3-äº¤äº’æ–¹å¼" class="headerlink" title="1.3 äº¤äº’æ–¹å¼"></a>1.3 äº¤äº’æ–¹å¼</h3><p>é€‰æ‹©è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶è¦å…ˆè€ƒè™‘æœåŠ¡ä¸å…¶å®¢æˆ·ç«¯çš„äº¤äº’æ–¹å¼ï¼Œä»è€Œå¯ä»¥ä¸“æ³¨äºéœ€æ±‚è€Œä¸æ˜¯å•çº¯æŠ€æœ¯å±‚é¢çš„è€ƒé‡ï¼Œäº¤äº’æ–¹å¼çš„é€‰æ‹©ä¼šå½±å“å¯ç”¨æ€§å’Œåç»­çš„é›†æˆæµ‹è¯•ç­–ç•¥ã€‚</p><p>äº¤äº’æ–¹å¼å…³æ³¨ä¸¤ä¸ªç»´åº¦ï¼š</p><ul><li>æ˜ å°„å…³ç³»ï¼š<ul><li><strong>ä¸€å¯¹ä¸€</strong>ï¼šæ¯ä¸ªå®¢æˆ·ç«¯ç”±ä¸€ä¸ªæœåŠ¡å®ä¾‹æ¥å¤„ç†ã€‚</li><li><strong>ä¸€å¯¹å¤š</strong>ï¼šæ¯ä¸ªå®¢æˆ·ç«¯ç”±å¤šä¸ªæœåŠ¡å®ä¾‹æ¥å¤„ç†ã€‚</li></ul></li><li>åŒæ­¥å¼‚æ­¥ï¼š<ul><li><strong>åŒæ­¥æ¨¡å¼</strong>ï¼šå®¢æˆ·ç«¯è¯·æ±‚éœ€è¦æœåŠ¡ç«¯å®æ—¶å“åº”ï¼Œå®¢æˆ·ç«¯ç­‰å¾…å“åº”æ—¶å¯èƒ½å¯¼è‡´é˜»å¡ã€‚</li><li><strong>å¼‚æ­¥æ¨¡å¼</strong>ï¼šå®¢æˆ·ç«¯è¯·æ±‚ä¸ä¼šé˜»å¡è¿›ç¨‹ï¼ŒæœåŠ¡ç«¯å“åº”å¯ä»¥éå®æ—¶ã€‚</li></ul></li></ul><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">ä¸€å¯¹ä¸€</th><th style="text-align:center">ä¸€å¯¹å¤š</th></tr></thead><tbody><tr><td style="text-align:center">åŒæ­¥æ¨¡å¼</td><td style="text-align:center">è¯·æ±‚/å“åº”</td><td style="text-align:center">æ— </td></tr><tr><td style="text-align:center">å¼‚æ­¥æ¨¡å¼</td><td style="text-align:center">å¼‚æ­¥è¯·æ±‚/å“åº”<br>å•å‘é€šçŸ¥</td><td style="text-align:center">å‘å¸ƒ/è®¢é˜…<br>å‘å¸ƒ/å¼‚æ­¥å“åº”</td></tr></tbody></table><ul><li>ä¸€å¯¹ä¸€çš„äº¤äº’æ–¹å¼ï¼š<ul><li><strong>è¯·æ±‚/å“åº”</strong>ï¼šä¸€ä¸ªå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼Œç­‰å¾…å“åº”ï¼›å®¢æˆ·ç«¯æœŸæœ›æœåŠ¡ç«¯å¾ˆå¿«å‘é€å“åº”ã€‚åœ¨ä¸€ä¸ªåŸºäºçº¿ç¨‹çš„åº”ç”¨ä¸­ï¼Œç­‰å¾…è¿‡ç¨‹å¯èƒ½é€ æˆçº¿ç¨‹é˜»å¡ï¼Œè¿™ç§æ–¹å¼ä¼šå¯¼è‡´æœåŠ¡ç´§è€¦åˆã€‚</li><li><strong>å¼‚æ­¥è¯·æ±‚/å“åº”</strong>ï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¼‚æ­¥å“åº”è¯·æ±‚ã€‚å®¢æˆ·ç«¯ç­‰å¾…æ—¶ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œè€ŒæœåŠ¡ç«¯å“åº”ä¹Ÿä¸ä¸€å®šä¼šé©¬ä¸Šè¿”å›ã€‚</li><li><strong>å•å‘é€šçŸ¥</strong>ï¼šå®¢æˆ·ç«¯è¯·æ±‚å‘é€åˆ°æœåŠ¡ç«¯ï¼Œä½†ä¸æœŸæœ›æœåŠ¡ç«¯åšå‡ºä»»ä½•å“åº”ã€‚</li></ul></li><li>ä¸€å¯¹å¤šçš„äº¤äº’æ–¹å¼ï¼š<ul><li><strong>å‘å¸ƒ/è®¢é˜…</strong>ï¼šå®¢æˆ·ç«¯å‘å¸ƒé€šçŸ¥æ¶ˆæ¯ï¼Œè¢«é›¶ä¸ªæˆ–å¤šä¸ªæ„Ÿå…´è¶£çš„æœåŠ¡è®¢é˜…ã€‚</li><li><strong>å‘å¸ƒ/å¼‚æ­¥å“åº”</strong>ï¼šå®¢æˆ·ç«¯å‘å¸ƒè¯·æ±‚æ¶ˆæ¯ï¼Œç„¶åç­‰å¾…ä»æ„Ÿå…´è¶£çš„æœåŠ¡å‘å›çš„å“åº”ã€‚</li></ul></li></ul><p>æ³¨æ„ï¼šåº•å±‚çš„è¿›ç¨‹é—´é€šä¿¡æŠ€æœ¯å¹¶ä¸ä¼šå½±å“æ‰€é€‰æ‹©çš„äº¤äº’æ–¹å¼ï¼Œå¯ä»¥æ˜¯RESTæˆ–æ¶ˆæ¯æœºåˆ¶ï¼Œä½†é€‰æ‹©åŒæ­¥è¯·æ±‚/å“åº”æ–¹å¼éƒ½ä¼šä½¿å®¢æˆ·ç«¯ç­‰å¾…å“åº”ã€‚</p><h3 id="1-4-å®šä¹‰API"><a href="#1-4-å®šä¹‰API" class="headerlink" title="1.4 å®šä¹‰API"></a>1.4 å®šä¹‰API</h3><p>è®¾è®¡è‰¯å¥½çš„æ¥å£åœ¨æš´æ¼æœ‰ç”¨åŠŸèƒ½çš„åŒæ—¶éšè—å®ç°ç»†èŠ‚ï¼Œå®ç°å¯ä»¥è¢«ä¿®æ”¹ï¼Œä½†æ¥å£å°½é‡ä¿æŒä¸å˜ä»¥ä¸å¯¹å®¢æˆ·ç«¯äº§ç”Ÿå½±å“ã€‚</p><p>Javaæ˜¯é™æ€ç±»å‹ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚æœæ¥å£ä¸å®¢æˆ·ç«¯ä¸å…¼å®¹ï¼Œåº”ç”¨ç¨‹åºä¼šæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚å¾®æœåŠ¡æ¶æ„çš„æŒ‘æˆ˜æ˜¯ï¼šæ²¡æœ‰ä¸€ä¸ªç®€å•çš„ç¼–ç¨‹è¯­è¨€ç»“æ„å¯ä»¥ç”¨æ¥æ„é€ å’Œå®šä¹‰æœåŠ¡çš„APIã€‚è‹¥ä½¿ç”¨ä¸å…¼å®¹çš„APIéƒ¨ç½²æ–°ç‰ˆæœ¬çš„æœåŠ¡ï¼Œç¼–è¯‘é˜¶æ®µä¸ä¼šå‡ºé”™ï¼Œä½†ä¼šå¯¼è‡´è¿è¡Œæ—¶æ•…éšœã€‚</p><p>ä½¿ç”¨<strong>æ¥å£å®šä¹‰è¯­è¨€</strong>ï¼ˆIDLï¼‰ç²¾ç¡®å®šä¹‰æœåŠ¡çš„APIå¾ˆé‡è¦ï¼ŒAPIä¼˜å…ˆè®¾è®¡ï¼Œè¿­ä»£å‡ è½®APIå®šä¹‰åå†å¼€å§‹å…·ä½“çš„æœåŠ¡å®ç°ç¼–ç¨‹ã€‚</p><ul><li>ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶ï¼ŒAPIç”±æ¶ˆæ¯é€šé“ã€æ¶ˆæ¯ç±»å‹å’Œæ¶ˆæ¯æ ¼å¼ç»„æˆã€‚</li><li>ä½¿ç”¨HTTPï¼ŒAPIç”±URLã€HTTPåŠ¨è¯ä»¥åŠè¯·æ±‚å’Œå“åº”æ ¼å¼ç»„æˆã€‚</li></ul><h3 id="1-5-APIæ¼”åŒ–"><a href="#1-5-APIæ¼”åŒ–" class="headerlink" title="1.5 APIæ¼”åŒ–"></a>1.5 APIæ¼”åŒ–</h3><p>å¾®æœåŠ¡ä¸­APIçš„ä½¿ç”¨è€…å¾ˆæœ‰å¯èƒ½æ˜¯å¦å¤–çš„å¼€å‘å›¢é˜Ÿæˆ–ç»„ç»‡å¤–çš„äººï¼Œä¸èƒ½å¤Ÿè¦æ±‚å®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯APIç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œç°ä»£åº”ç”¨ç¨‹åºæœ‰ç€æé«˜çš„å¯ç”¨æ€§è¦æ±‚ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨æ»šåŠ¨å‡çº§çš„æ–¹å¼æ¥æ›´æ–°æœåŠ¡ï¼Œæ‰€ä»¥ä¸€ä¸ªæœåŠ¡çš„æ–°ç‰ˆæœ¬å’Œæ—§ç‰ˆæœ¬è‚¯å®šä¼šå…±å­˜ã€‚</p><ul><li><p><strong>è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šæ˜¯ä¸€ç»„è§„åˆ™ï¼Œç”¨äºæŒ‡å®šå¦‚ä½•ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œå¹¶ä¸”ä»¥æ­£ç¡®çš„æ–¹å¼é€’å¢ç‰ˆæœ¬å·ã€‚</p><p>ç‰ˆæœ¬å·ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>MAJORï¼šå¯¹APIè¿›è¡Œä¸å…¼å®¹çš„æ›´æ”¹æ—¶ã€‚</li><li>MINORï¼šå¯¹APIè¿›è¡Œå‘åå…¼å®¹çš„å¢å¼ºæ—¶ã€‚</li><li>PATCHï¼šè¿›è¡Œå‘åå…¼å®¹çš„é”™è¯¯ä¿®å¤æ—¶ã€‚</li></ul><p>å¦‚ä½¿ç”¨REST APIæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸»è¦ç‰ˆæœ¬ä½œä¸ºURLè·¯å¾„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶çš„æœåŠ¡ï¼Œå¯ä»¥åœ¨å‘å¸ƒçš„æ¶ˆæ¯ä¸­åŒ…å«ç‰ˆæœ¬å·ã€‚</p></li><li><p><strong>è¿›è¡Œæ¬¡è¦å¹¶ä¸”å‘åå…¼å®¹çš„æ”¹å˜</strong>ï¼šå‘åå…¼å®¹æ˜¯å¯¹APIçš„é™„åŠ æ›´æ”¹æˆ–åŠŸèƒ½å¢å¼ºã€‚</p><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åº”è¯¥éµå®ˆå¥å£®æ€§åŸåˆ™ï¼ŒæœåŠ¡ä¸ºç¼ºå°‘çš„è¯·æ±‚å±æ€§æä¾›é»˜è®¤å€¼ï¼Œå®¢æˆ·ç«¯å¿½ç•¥é¢å¤–çš„å“åº”å±æ€§ã€‚</li></ul></li><li><p><strong>è¿›è¡Œä¸»è¦å¹¶ä¸”ä¸å‘åå…¼å®¹çš„æ”¹å˜</strong>ï¼šå› ä¸ºæ— æ³•å¼ºåˆ¶å®¢æˆ·ç«¯å‡çº§ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸€æ®µæ—¶é—´å†…åŒæ—¶æ”¯æŒæ–°æ—§ç‰ˆæœ¬çš„APIã€‚</p><ul><li>ä½¿ç”¨åŸºäºHTTPçš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå¦‚RESTï¼Œå¯ä»¥åœ¨URLä¸­åµŒå…¥ä¸»è¦ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬1å¯¹åº” <code>/v1/...</code> å’Œ ç‰ˆæœ¬2å¯¹åº” <code>/v2/...</code> ä¸ºå‰ç¼€ã€‚</li></ul></li></ul><h3 id="1-6-æ¶ˆæ¯æ ¼å¼"><a href="#1-6-æ¶ˆæ¯æ ¼å¼" class="headerlink" title="1.6 æ¶ˆæ¯æ ¼å¼"></a>1.6 æ¶ˆæ¯æ ¼å¼</h3><ul><li>åŸºäºæ–‡æœ¬ï¼šæ¶ˆæ¯è¿‡åº¦å†—é•¿ï¼Œè§£ææ–‡æœ¬å¼•å…¥äº†é¢å¤–å¼€é”€ã€‚<ul><li>XMLï¼šç›¸æ¯”JSONæ›´é•¿ã€‚</li><li>JSON</li></ul></li><li>åŸºäºäºŒè¿›åˆ¶ï¼šæä¾›äº†ä¸€ä¸ªå¼ºç±»å‹å®šä¹‰çš„IDLï¼ˆæ¥å£æè¿°æ–‡ä»¶ï¼‰ï¼Œç”¨äºå®šä¹‰æ¶ˆæ¯çš„æ ¼å¼ã€‚ç¼–è¯‘å™¨è‡ªåŠ¨æ ¹æ®æ ¼å¼ç”Ÿæˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç ã€‚<ul><li>Protocol Buffersï¼šä½¿ç”¨tagged fieldsï¼Œå¸¦æ ‡è®°çš„å­—æ®µã€‚</li><li>Avroï¼šå…¶æ¶ˆè´¹è€…åœ¨è§£ææ¶ˆæ¯å‰è¦çŸ¥é“æ ¼å¼ã€‚</li></ul></li></ul><h2 id="äºŒ-åŸºäºåŒæ­¥è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¨¡å¼çš„é€šä¿¡"><a href="#äºŒ-åŸºäºåŒæ­¥è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¨¡å¼çš„é€šä¿¡" class="headerlink" title="äºŒ. åŸºäºåŒæ­¥è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¨¡å¼çš„é€šä¿¡"></a>äºŒ. åŸºäºåŒæ­¥è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¨¡å¼çš„é€šä¿¡</h2><p>åŸºäºåŒæ­¥è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPIï¼‰çš„é€šä¿¡æœºåˆ¶ä¸­ï¼Œå®¢æˆ·ç«¯å‡å®šæ¶ˆæ¯å°†åŠæ—¶åˆ°è¾¾ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010131.jpg" alt></p><p>ä»£ç†æ¥å£é€šå¸¸å°è£…åº•å±‚é€šä¿¡åè®®ï¼Œå¯ä»¥é€‰å¦‚RESTä½•gRPCç­‰ã€‚</p><h3 id="2-1-REST"><a href="#2-1-REST" class="headerlink" title="2.1 REST"></a>2.1 REST</h3><h4 id="2-1-1-RESTfulé£æ ¼"><a href="#2-1-1-RESTfulé£æ ¼" class="headerlink" title="2.1.1 RESTfulé£æ ¼"></a>2.1.1 RESTfulé£æ ¼</h4><p>RESTæ˜¯ä¸€ç§æ€»æ˜¯ä½¿ç”¨HTTPåè®®çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ¶æ„çº¦æŸï¼Œå¼ºè°ƒç»„ä»¶äº¤äº’çš„å¯æ‰©å±•æ€§ã€æ¥å£çš„é€šç”¨æ€§ã€ç»„ä»¶çš„ç‹¬ç«‹éƒ¨ç½²ï¼Œä»¥åŠé‚£äº›èƒ½å‡å°‘äº¤äº’å»¶è¿Ÿçš„ä¸­é—´ä»¶ï¼Œå…¶å¼ºåŒ–äº†å®‰å…¨æ€§ä¹Ÿèƒ½å°è£…é—ç•™ç³»ç»Ÿã€‚</p><p>RESTä½¿ç”¨<strong>èµ„æº</strong>è¡¨ç¤ºå•ä¸ªä¸šåŠ¡å¯¹è±¡ï¼Œä½¿ç”¨<strong>HTTPåŠ¨è¯</strong>æ¥æ“ä½œèµ„æºï¼Œä½¿ç”¨<strong>URL</strong>å¼•ç”¨èµ„æºã€‚</p><ul><li>GETè·å–èµ„æº</li><li>POSTåˆ›å»ºèµ„æº</li><li>PUTæ›´æ–°èµ„æº</li><li>DELETEåˆ é™¤èµ„æº</li></ul><h4 id="2-1-2-æˆç†Ÿåº¦æ¨¡å‹"><a href="#2-1-2-æˆç†Ÿåº¦æ¨¡å‹" class="headerlink" title="2.1.2 æˆç†Ÿåº¦æ¨¡å‹"></a>2.1.2 æˆç†Ÿåº¦æ¨¡å‹</h4><ul><li>Level 0ï¼šå®¢æˆ·ç«¯åªæ˜¯å‘æœåŠ¡ç«¯ç‚¹å‘èµ·HTTP POSTè¯·æ±‚ï¼Œè¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚æ¯ä¸ªè¯·æ±‚æŒ‡æ˜äº†éœ€è¦æ‰§è¡Œçš„æ“ä½œã€é’ˆå¯¹çš„ç›®æ ‡å’Œå¿…è¦çš„å‚æ•°ã€‚</li><li>Level 1ï¼šè¯¥å±‚çº§å¼•å…¥èµ„æºçš„æ¦‚å¿µï¼Œå®¢æˆ·ç«¯éœ€è¦å‘å‡ºæŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œå’ŒåŒ…å«ä»»ä½•å‚æ•°çš„POSTè¯·æ±‚ã€‚</li><li>Level 2ï¼šä½¿ç”¨HTTPåŠ¨è¯æ¥æ‰§è¡Œæ“ä½œï¼Œè¯·æ±‚æŸ¥è¯¢å‚æ•°å’Œä¸»ä½“æŒ‡å®šæ“ä½œçš„å‚æ•°ï¼Œè¿™èƒ½å¤Ÿè®©æœåŠ¡å€ŸåŠ©WebåŸºç¡€è®¾æ–½æœåŠ¡ï¼Œå¦‚é€šè¿‡CDNç¼“å­˜GETè¯·æ±‚ã€‚</li><li>Level 3ï¼šåŸºäºHATEOASï¼ˆHypertext As The Engine Of Application Stateï¼‰åŸåˆ™è®¾è®¡ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯ç”±GETè¯·æ±‚è¿”å›çš„èµ„æºä¿¡æ¯ä¸­åŒ…å«é“¾æ¥ï¼Œé“¾æ¥èƒ½å¤Ÿæ‰§è¡Œè¯¥èµ„æºå…è®¸çš„æ“ä½œã€‚å¦‚å®¢æˆ·ç«¯é€šè¿‡è®¢å•èµ„æºåŒ…å«çš„é“¾æ¥å–æ¶ˆæŸä¸€è®¢å•æˆ–è·å–è¯¥è®¢å•è¯¦æƒ…ã€‚ä¼˜ç‚¹åŒ…æ‹¬æ— éœ€åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å†™å…¥ç¡¬é“¾æ¥çš„URLï¼Œå› ä¸ºèµ„æºåŒ…æ‹¬å…è®¸æ“ä½œçš„é“¾æ¥ï¼Œå®¢æˆ·ç«¯æ— éœ€çŒœæµ‹åœ¨å½“å‰çŠ¶æ€åº”æ‰§è¡Œä½•æ“ä½œã€‚</li></ul><h4 id="2-1-3-éœ€è¦è§£å†³çš„é—®é¢˜"><a href="#2-1-3-éœ€è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="2.1.3 éœ€è¦è§£å†³çš„é—®é¢˜"></a>2.1.3 éœ€è¦è§£å†³çš„é—®é¢˜</h4><ul><li>åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­è·å–å¤šä¸ªèµ„æºï¼š<ul><li>APIå…è®¸è·å–èµ„æºæ—¶æ£€ç´¢ç›¸å…³èµ„æºï¼Œå¦‚ <code>GET/orders/order-id-1345?expand=consumer</code> æ£€ç´¢orderå’Œconsumerã€‚ä½†å¯¹äºå¤æ‚çš„åœºæ™¯ä¸å¤ªé€‚ç”¨ã€‚</li><li>GraphQL å’Œ Netflix Falcor å®ç°äº†é«˜æ•ˆçš„æ•°æ®è·å–ã€‚</li></ul></li><li>æŠŠæ“ä½œæ˜ å°„ä¸ºHTTPåŠ¨è¯ï¼šæœ‰å¯èƒ½æœ‰å¤šç§æ›´æ–°æ“ä½œï¼Œå¦‚å–æ¶ˆæˆ–ä¿®æ”¹è®¢å•ã€‚<ul><li>ä½¿ç”¨å­èµ„æºï¼Œå¦‚ <code>POST/orders/{orderId}/cancel</code> å’Œ <code>POST/orders/{orderId}/revise</code>  ç«¯ç‚¹ã€‚</li><li>å°†åŠ¨è¯æŒ‡å®šä¸ºURLçš„æŸ¥è¯¢å‚æ•°ã€‚</li><li>æ­¤ä¸¤ç§è§£å†³æ–¹æ¡ˆéƒ½æœ‰äº›è¿èƒŒäº†RESTfulçš„è¦æ±‚ã€‚</li></ul></li></ul><h4 id="2-1-4-ä¼˜ç¼ºç‚¹"><a href="#2-1-4-ä¼˜ç¼ºç‚¹" class="headerlink" title="2.1.4 ä¼˜ç¼ºç‚¹"></a>2.1.4 ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç®€å•ç›´è§‚</li><li>å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰©å±•ï¼ˆå¦‚Postmanæ’ä»¶ï¼‰æˆ– curl ä¹‹ç±»çš„å‘½ä»¤è¡Œæ¥æµ‹è¯•HTTP API</li><li>ç›´æ¥æ”¯æŒè¯·æ±‚ / å“åº”æ–¹å¼çš„é€šä¿¡</li><li>HTTPå¯¹é˜²ç«å¢™å‹å¥½</li><li>ä¸éœ€è¦ä¸­é—´ä»£ç†ï¼Œç®€åŒ–äº†ç³»ç»Ÿæ¶æ„</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>åªæ”¯æŒè¯·æ±‚ / å“åº”æ–¹å¼çš„é€šä¿¡</li><li>å¯èƒ½å¯¼è‡´å¯ç”¨æ€§é™ä½ã€‚ç”±äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç›´æ¥é€šä¿¡ï¼Œè€Œæœªé€šè¿‡ä»£ç†ç¼“å†²æ¶ˆæ¯ï¼ŒäºŒè€…åœ¨è°ƒç”¨æœŸé—´éƒ½è¦ä¿æŒåœ¨çº¿ã€‚</li><li>å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æœåŠ¡å®ä¾‹çš„ä½ç½®-URLï¼Œä½†ç°ä»£åº”ç”¨è¦æ±‚å®¢æˆ·ç«¯å¿…é¡»ä½¿ç”¨<strong>æœåŠ¡å‘ç°æœºåˆ¶</strong>æ¥å®šä½æœåŠ¡å®ä¾‹ã€‚</li><li>åœ¨å•ä¸ªè¯·æ±‚ä¸­è·å–å¤šä¸ªèµ„æºå…·æœ‰æŒ‘æˆ˜æ€§ã€‚</li><li>å¾ˆéš¾å°†å¤šä¸ªæ›´æ–°æ“ä½œæ˜ å°„ä¸ºHTTPåŠ¨è¯ã€‚</li></ul><h3 id="2-2-gRPC"><a href="#2-2-gRPC" class="headerlink" title="2.2 gRPC"></a>2.2 gRPC</h3><p>gRPCæ˜¯ä¸€ä¸ªç”¨äºç¼–å†™è·¨è¯­è¨€å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ¡†æ¶ï¼Œæ˜¯ä¸€ç§åŸºäºäºŒè¿›åˆ¶æ¶ˆæ¯çš„åè®®ï¼Œæ‰€ä»¥å¿…é¡»é‡‡ç”¨APIä¼˜å…ˆçš„æœåŠ¡è®¾è®¡æ–¹æ³•ã€‚</p><p>å¯ä»¥ä½¿ç”¨Protocol Bufferçš„IDLå®šä¹‰gRPCçš„APIï¼Œæ˜¯è°·æ­Œå…¬å¸ç”¨äºåºåˆ—åŒ–ç»“æ„åŒ–æ•°æ®çš„ä¸€å¥—è¯­è¨€ä¸­ç«‹æœºåˆ¶ï¼Œä½¿ç”¨Protocol Bufferç¼–è¯‘å™¨ç”Ÿæˆå®¢æˆ·ç«¯çš„<strong>æ¡©</strong>ï¼ˆsubï¼Œä¹Ÿå«å­˜æ ¹ï¼‰å’ŒæœåŠ¡å™¨<strong>éª¨æ¶</strong>ï¼ˆskeletonï¼‰ï¼Œæ”¯æŒå¦‚Javaã€C#ã€Node.js å’Œ Golangç­‰ã€‚<strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨ HTTP/2 ä»¥Protocol Bufferæ ¼å¼äº¤æ¢äºŒè¿›åˆ¶æ¶ˆæ¯</strong>ã€‚</p><p>gRPC API ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å’Œè¯·æ±‚/å“åº”æ¶ˆæ¯å®šä¹‰ç»„æˆã€‚æœåŠ¡å®šä¹‰ç±»ä¼¼äºJavaæ¥å£ï¼Œæ˜¯å¼ºç±»å‹æ–¹æ³•çš„é›†åˆï¼Œæ”¯æŒè¯·æ±‚/å“åº”RPCå’Œæµå¼RPCã€‚æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨æ¶ˆæ¯æµå›å¤å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯æµã€‚</p><p>Protocol Buffersæ˜¯ä¸€ç§é«˜æ•ˆçš„äºŒè¿›åˆ¶æ¶ˆæ¯æ ¼å¼ï¼Œæ¶ˆæ¯çš„æ¯ä¸ªå­—æ®µéƒ½æœ‰ç¼–å·å’Œä¸€ä¸ªç±»å‹ä»£ç ï¼›æ¶ˆæ¯æ¥æ”¶æ–¹å¯ä»¥æå–æ‰€éœ€å­—æ®µï¼Œè·³è¿‡æ— æ³•è¯†åˆ«çš„å­—æ®µã€‚å› æ­¤ç‰¹æ€§gRPC APIå¯ä»¥ä¿æŒå‘åå…¼å®¹çš„åŒæ—¶è¿›è¡Œå˜æ›´ã€‚</p><p>å¦‚OrderServiceçš„gRPC APIå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CreateOrderRequestå’ŒCreateOrderReplyæ˜¯å…·æœ‰ç±»å‹çš„æ¶ˆæ¯</span></span><br><span class="line">service OrderService &#123;</span><br><span class="line">    <span class="function">rpc <span class="title">createOrder</span><span class="params">(CreateOrderRequest)</span> <span class="title">returns</span> <span class="params">(CreateOrderReply)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function">rpc <span class="title">cancelOrder</span><span class="params">(CancelOrderRequest)</span> <span class="title">returns</span> <span class="params">(CancelOrderReply)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function">rpc <span class="title">reviseOrder</span><span class="params">(ReviseOrderRequest)</span> <span class="title">returns</span> <span class="params">(ReviseOrderReply)</span> </span>&#123;&#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message CreateOrderRequest &#123;</span><br><span class="line">    int64 restaurantId = <span class="number">1</span>;</span><br><span class="line">    int64 consumerId = <span class="number">2</span>;</span><br><span class="line">    repeated LineItem lineItems = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message LineItem &#123;</span><br><span class="line">    string menuItemId = <span class="number">1</span>;</span><br><span class="line">    int32 quantity = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message CreateOrderReply &#123;</span><br><span class="line">    int64 orderId = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>è®¾è®¡å…·æœ‰å¤æ‚æ›´æ–°æ“ä½œçš„APIå¾ˆç®€å•</li><li>å…·æœ‰é«˜æ•ˆã€ç´§å‡‘çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯äº¤æ¢å¤§é‡æ¶ˆæ¯æ—¶</li><li>æ”¯æŒåœ¨è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å’Œæ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä½¿ç”¨åŒå‘æµå¼æ¶ˆæ¯æ–¹å¼</li><li>å®ç°äº†å®¢æˆ·ç«¯å’Œå„ç§è¯­è¨€ç¼–å†™çš„æœåŠ¡ç«¯ä¹‹é—´çš„äº’æ“ä½œæ€§</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸åŸºäºREST/JSONçš„APIæœºåˆ¶ç›¸æ¯”ï¼ŒJavaScriptå®¢æˆ·ç«¯ä½¿ç”¨åŸºäºgRPCçš„APIéœ€è¦åšæ›´å¤šå·¥ä½œ</li><li>æ—§å¼é˜²ç«å¢™å¯èƒ½ä¸æ”¯æŒHTTP/2</li></ul><h3 id="2-3-ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼å¤„ç†å±€éƒ¨æ•…éšœ"><a href="#2-3-ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼å¤„ç†å±€éƒ¨æ•…éšœ" class="headerlink" title="2.3 ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼å¤„ç†å±€éƒ¨æ•…éšœ"></a>2.3 ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼å¤„ç†å±€éƒ¨æ•…éšœ</h3><p>æœåŠ¡é—´é€šä¿¡æ€»æ˜¯æ— æ³•é¿å…ä¼šé‡åˆ°å±€éƒ¨æ•…éšœï¼Œå¯ä»¥é€šè¿‡æ–­è·¯å™¨æ¨¡å¼æ¥åº”å¯¹æ•…éšœã€‚</p><p>æ–­è·¯å™¨æ¨¡å¼ï¼š<strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„ä»£ç†ï¼Œåœ¨è¿ç»­å¤±è´¥æ¬¡æ•°è¶…è¿‡æŒ‡å®šé˜ˆå€¼åçš„ä¸€æ®µæ—¶é—´å†…ï¼Œè¿™ä¸ªä»£ç†ä¼šç«‹å³æ‹’ç»å…¶ä»–è°ƒç”¨</strong>ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010132.jpg" alt></p><p>OrderServiceProxyä¼šæ— é™æœŸé˜»å¡ï¼Œç­‰å¾…å“åº”ï¼Œåœ¨å¸¦æ¥ç³Ÿç³•ä½“éªŒçš„åŒæ—¶ï¼Œæ¶ˆè€—å¦‚çº¿ç¨‹ç­‰å®è´µèµ„æºï¼Œæœ€ç»ˆAPI Gateway å°†è€—å°½èµ„æºæ— æ³•å¤„ç†è¯·æ±‚ï¼Œæ•´ä¸ªAPIéƒ½ä¸å¯ç”¨ã€‚</p><p>è§£å†³æ­¤é—®é¢˜ï¼š</p><ul><li><p><strong>å¼€å‘å¯é çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ä»£ç†</strong>ï¼šå¦‚ Netflix Hystrix ç­‰å¼€æºåº“ã€‚</p><p>å½“æœåŠ¡åŒæ­¥è°ƒç”¨ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œéœ€è¦ä¿è¯ï¼š</p><ul><li><strong>ç½‘ç»œè¶…æ—¶</strong>ï¼šç­‰å¾…è¯·æ±‚çš„å“åº”æ—¶ï¼Œä¸è¦æ— é™é˜»å¡ï¼Œè®¾å®šä¸€ä¸ªè¶…æ—¶ï¼Œä¿è¯ä¸ä¼šä¸€ç›´åœ¨æ— å“åº”çš„è¯·æ±‚ä¸Šæµªè´¹èµ„æºã€‚</li><li><strong>é™åˆ¶å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚çš„æ•°é‡</strong>ï¼šå¯¹ç‰¹å®šè¯·æ±‚æœåŠ¡è®¾ç½®ä¸Šé™ï¼Œè¾¾åˆ°ä¸Šé™åæ–°çš„è¯·æ±‚ä¼šç«‹å³å¤±è´¥ã€‚</li><li><strong>æ–­è·¯å™¨æ¨¡å¼</strong>ï¼šç›‘æ§å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚çš„æˆåŠŸå’Œå¤±è´¥æ•°ç›®ï¼Œå¤±è´¥æ¯”ä¾‹è¶…è¿‡é˜ˆå€¼ï¼Œå¯åŠ¨æ–­è·¯å™¨ï¼Œè®©åç»­è°ƒç”¨ç«‹å³å¤±æ•ˆã€‚å¤§é‡çš„è¯·æ±‚å¤±è´¥è¡¨ç¤ºè¢«è°ƒæœåŠ¡ä¸å¯ç”¨ï¼Œå³ä½¿å†å‘é€è¯·æ±‚ä¹Ÿæ— æµäºäº‹ï¼Œè€Œæ˜¯ç»è¿‡ä¸€æ®µæ—¶é—´åå†å°è¯•ï¼Œè‹¥è¯·æ±‚æˆåŠŸåˆ™è§£é™¤æ–­è·¯å™¨ã€‚</li></ul></li><li><p><strong>ä»æœåŠ¡å¤±æ•ˆæ•…éšœä¸­æ¢å¤</strong>ï¼š</p><p>æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©å¦‚ä½•ä»æ— å“åº”çš„è¿œç¨‹æœåŠ¡ä¸­æ¢å¤æœåŠ¡ï¼š</p><ul><li>è¿”å›é”™è¯¯ï¼šå¦‚å›¾ 3-3 åˆ›å»ºOrderå¤±è´¥æ—¶ï¼Œåªèƒ½å°†å¤±è´¥è¿”å›ç»™ç§»åŠ¨ç«¯ã€‚</li><li>è¿”å›å¤‡ç”¨å€¼ï¼šå¦‚å›¾ 3-3 ä½¿ç”¨APIç»„åˆæ¨¡å¼å®ç°ï¼Œè°ƒç”¨äº†å¤šä¸ªæœåŠ¡å¹¶å°†ç»“æœç»„åˆåœ¨ä¸€èµ·ã€‚ç»“æœçš„é‡è¦æ€§ä¸åŒï¼Œå¦‚OrderæœåŠ¡ä¸å¯ç”¨æ—¶è¦è¿”å›å…¶æ•°æ®çš„ç¼“å­˜ç‰ˆæœ¬æˆ–é”™è¯¯ä¿¡æ¯ï¼›å…¶ä»–åˆ™ä¸é‡è¦ï¼Œå¯ä»¥è¿”å›ç¼“å­˜ç‰ˆæœ¬æˆ–å¿½ç•¥ã€‚</li></ul></li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010133.jpg" alt></p><h3 id="2-4-æœåŠ¡å‘ç°"><a href="#2-4-æœåŠ¡å‘ç°" class="headerlink" title="2.4 æœåŠ¡å‘ç°"></a>2.4 æœåŠ¡å‘ç°</h3><h4 id="2-4-1-ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡å‘ç°ï¼Ÿ"><a href="#2-4-1-ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡å‘ç°ï¼Ÿ" class="headerlink" title="2.4.1 ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡å‘ç°ï¼Ÿ"></a>2.4.1 ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡å‘ç°ï¼Ÿ</h4><p>å‘é€è¯·æ±‚éœ€è¦çŸ¥é“æœåŠ¡å®ä¾‹çš„ç½‘ç»œä½ç½®ï¼Œç°ä»£åŸºäºäº‘çš„å¾®æœåŠ¡åº”ç”¨ç¨‹åºä¸­ï¼ŒæœåŠ¡å®ä¾‹å…·æœ‰åŠ¨æ€åˆ†é…çš„IPåœ°å€ï¼Œè¿˜ä¼šå› ä¸ºè‡ªåŠ¨æ‰©å±•ã€æ•…éšœå’Œå‡çº§ç­‰å¯¼è‡´æœåŠ¡å®ä¾‹é›†åŠ¨æ€ä¿®æ”¹ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010134.jpg" alt></p><h4 id="2-4-2-æœåŠ¡å‘ç°æœºåˆ¶ä¼šåšä»€ä¹ˆï¼Ÿ"><a href="#2-4-2-æœåŠ¡å‘ç°æœºåˆ¶ä¼šåšä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.4.2 æœåŠ¡å‘ç°æœºåˆ¶ä¼šåšä»€ä¹ˆï¼Ÿ"></a>2.4.2 æœåŠ¡å‘ç°æœºåˆ¶ä¼šåšä»€ä¹ˆï¼Ÿ</h4><p>æœåŠ¡å‘ç°çš„å…³é”®ç»„ä»¶æ˜¯æœåŠ¡æ³¨å†Œè¡¨ï¼Œæ˜¯åŒ…å«æœåŠ¡å®ä¾‹ç½‘ç»œä½ç½®ä¿¡æ¯çš„æ•°æ®åº“ã€‚æœåŠ¡å®ä¾‹å¯åŠ¨å’Œåœæ­¢æ—¶ï¼ŒæœåŠ¡å‘ç°æœºåˆ¶éƒ½ä¼šæ›´æ–°æœåŠ¡æ³¨å†Œè¡¨ï¼Œå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡æ—¶ï¼ŒæœåŠ¡å‘ç°æœºåˆ¶ä¼šæŸ¥è¯¢æœåŠ¡æ³¨å†Œè¡¨è·å–æœåŠ¡å®ä¾‹çš„åˆ—è¡¨ï¼Œå¹¶å°†è¯·æ±‚è·¯ç”±åˆ°å…¶ä¸­ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚</p><h4 id="2-4-3-å®ç°æ–¹å¼"><a href="#2-4-3-å®ç°æ–¹å¼" class="headerlink" title="2.4.3 å®ç°æ–¹å¼"></a>2.4.3 å®ç°æ–¹å¼</h4><ul><li>æœåŠ¡åŠå…¶å®¢æˆ·ç›´æ¥ä¸æœåŠ¡æ³¨å†Œè¡¨äº¤äº’ï¼›</li><li>é€šè¿‡éƒ¨ç½²åŸºç¡€è®¾æ–½æ¥å¤„ç†æœåŠ¡å‘ç°ã€‚</li></ul><h4 id="2-4-4-åº”ç”¨å±‚æœåŠ¡å‘ç°æ¨¡å¼"><a href="#2-4-4-åº”ç”¨å±‚æœåŠ¡å‘ç°æ¨¡å¼" class="headerlink" title="2.4.4 åº”ç”¨å±‚æœåŠ¡å‘ç°æ¨¡å¼"></a>2.4.4 åº”ç”¨å±‚æœåŠ¡å‘ç°æ¨¡å¼</h4><p>æœåŠ¡å®ä¾‹ä½¿ç”¨æœåŠ¡æ³¨å†Œè¡¨æ¥æ³¨å†Œç½‘ç»œä½ç½®ï¼Œå®¢æˆ·ç«¯å…ˆæŸ¥è¯¢è¡¨è·å–ä¿¡æ¯å†å‘å…¶ä¸­ä¸€ä¸ªå®ä¾‹å‘é€è¯·æ±‚ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010135.jpg" alt></p><ul><li><strong>è‡ªæ³¨å†Œæ¨¡å¼</strong>ï¼šæœåŠ¡å®ä¾‹å‘æœåŠ¡æ³¨å†Œè¡¨æ³¨å†Œè‡ªå·±ï¼ŒæœåŠ¡æ³¨å†Œè¡¨å®šæœŸè°ƒç”¨<strong>è¿è¡ŒçŠ¶å†µæ£€æŸ¥</strong>ç«¯ç‚¹æ¥éªŒè¯æœåŠ¡å®ä¾‹æ˜¯å¦æ­£å¸¸ä¸”èƒ½æ¥æ”¶è¯·æ±‚ï¼ŒæœåŠ¡å®ä¾‹è¦å®šæœŸè°ƒç”¨å¿ƒè·³APIä»¥é˜²æ­¢æ³¨å†Œè¿‡æœŸã€‚</li><li><strong>å®¢æˆ·ç«¯å‘ç°æ¨¡å¼</strong>ï¼šå®¢æˆ·ç«¯ä»æœåŠ¡æ³¨å†Œè¡¨æ£€ç´¢å¯ç”¨æœåŠ¡å®ä¾‹çš„åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸”ä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•æ¥é€‰æ‹©æœåŠ¡å®ä¾‹ã€‚</li></ul><p>åº”ç”¨å±‚æœåŠ¡å‘ç°å·¥å…·ï¼šSpring Cloudé»˜è®¤ä½¿ç”¨Eurekaè¿›è¡ŒæœåŠ¡å‘ç°ã€‚</p><ul><li>Eurekaï¼šé«˜å¯ç”¨çš„æ³¨å†Œä¸­å¿ƒ</li><li>Ribbonï¼šEurekaçš„ HTTP å®¢æˆ·ç«¯</li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li>æœåŠ¡å‘ç°ä¸éƒ¨ç½²å¹³å°æ— å…³ï¼Œå¯ä»¥è§£å†³å¤šå¹³å°éƒ¨ç½²é—®é¢˜ã€‚å¦‚åŒæ—¶ä½¿ç”¨Kuberneteså’Œé—ç•™ç¯å¢ƒï¼ŒåŸºäºEurekaèƒ½åŒæ—¶é€‚ç”¨äºŒè€…ï¼Œè€ŒåŸºäºå¹³å°çš„æœåŠ¡å‘ç°åªèƒ½ç”¨äºKuberneteså¹³å°ã€‚</li></ul><p>å¼Šç«¯ï¼š</p><ul><li>éœ€è¦ä¸ºæ¯ç§ç¼–ç¨‹è¯­è¨€æä¾›æœåŠ¡å‘ç°åº“ï¼ŒSpring Cloud åªèƒ½æœåŠ¡äº Spring å¼€å‘ï¼Œå¦‚ Node.js æˆ– Golang éœ€è¦ç›¸åº”çš„æœåŠ¡å‘ç°æ¡†æ¶ã€‚</li><li>å¼€å‘è€…è´Ÿè´£è®¾ç½®å’Œç®¡ç†æœåŠ¡æ³¨å†Œè¡¨ï¼Œæœ€å¥½ä½¿ç”¨éƒ¨ç½²åŸºç¡€è®¾æ–½æä¾›çš„æœåŠ¡å‘ç°æœºåˆ¶ã€‚</li></ul><h4 id="2-4-5-å¹³å°å±‚æœåŠ¡å‘ç°æ¨¡å¼"><a href="#2-4-5-å¹³å°å±‚æœåŠ¡å‘ç°æ¨¡å¼" class="headerlink" title="2.4.5 å¹³å°å±‚æœåŠ¡å‘ç°æ¨¡å¼"></a>2.4.5 å¹³å°å±‚æœåŠ¡å‘ç°æ¨¡å¼</h4><p>ç°ä»£éƒ¨ç½²å¹³å°ï¼Œå¦‚Dockerå’ŒKuberneteséƒ½æœ‰å†…ç½®çš„æœåŠ¡æ³¨å†Œè¡¨å’ŒæœåŠ¡å‘ç°æœºåˆ¶ã€‚å¹³å°ä¸ºæ¯ä¸ªæœåŠ¡æä¾›DNSåç§°ã€è™šæ‹ŸIPåœ°å€ï¼ˆVIPåœ°å€ï¼‰å’Œè§£æä¸ºVIPåœ°å€çš„DNSåç§°ã€‚å®¢æˆ·ç«¯å‘DNSåç§°å’ŒVIPå‘å‡ºè¯·æ±‚ï¼Œéƒ¨ç½²å¹³å°è‡ªåŠ¨å°†è¯·æ±‚è·¯ç”±åˆ°å…¶ä¸­ä¸€ä¸ªå¯ç”¨å®ä¾‹ï¼Œæ•´ä¸ªæµç¨‹å®Œå…¨ç”±å¹³å°å¤„ç†ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010136.jpg" alt></p><ul><li><strong>ç¬¬ä¸‰æ–¹æ³¨å†Œæ¨¡å¼</strong>ï¼šç”±æ³¨å†ŒæœåŠ¡å™¨ï¼ˆç¬¬ä¸‰æ–¹ï¼‰è´Ÿè´£å¤„ç†æ³¨å†Œï¼ŒæœåŠ¡ä¸ç”¨å†è‡ªå·±æ³¨å†Œã€‚</li><li><strong>æœåŠ¡ç«¯å‘ç°æ¨¡å¼</strong>ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦æŸ¥è¯¢æ³¨å†Œè¡¨ï¼Œè€Œæ˜¯å‘DNSåç§°å‘å‡ºè¯·æ±‚ï¼Œå¯¹æ­¤åç§°çš„è¯·æ±‚ä¼šè§£æåˆ°è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨æŸ¥è¯¢æœåŠ¡æ³¨å†Œè¡¨å¹¶å¯¹è¯·æ±‚è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚</li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li>æœåŠ¡å’Œå®¢æˆ·ç«¯ä¸éœ€åŒ…å«æœåŠ¡å‘ç°ä»£ç ï¼Œä¸è®ºä»»ä½•è¯­è¨€å’Œæ¡†æ¶éƒ½å¯ä»¥ä½¿ç”¨ã€‚</li></ul><p>å¼Šç«¯ï¼š</p><ul><li>ä»…é™äºä½¿ç”¨æ­¤å¹³å°éƒ¨ç½²çš„æœåŠ¡ï¼Œä½†å°½ç®¡å¦‚æ­¤è¿˜æ˜¯æ¨èå¹³å°æä¾›çš„æœåŠ¡å‘ç°ã€‚</li></ul><h2 id="ä¸‰-åŸºäºå¼‚æ­¥æ¶ˆæ¯æ¨¡å¼çš„é€šä¿¡"><a href="#ä¸‰-åŸºäºå¼‚æ­¥æ¶ˆæ¯æ¨¡å¼çš„é€šä¿¡" class="headerlink" title="ä¸‰. åŸºäºå¼‚æ­¥æ¶ˆæ¯æ¨¡å¼çš„é€šä¿¡"></a>ä¸‰. åŸºäºå¼‚æ­¥æ¶ˆæ¯æ¨¡å¼çš„é€šä¿¡</h2><p>ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶æ—¶ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡é‡‡ç”¨å¼‚æ­¥äº¤æ¢æ¶ˆæ¯çš„æ–¹å¼å®Œæˆã€‚</p><p>å®ç°æ–¹æ¡ˆï¼š</p><ul><li>é€šå¸¸ä¼šä½¿ç”¨<strong>æ¶ˆæ¯ä»£ç†</strong>ï¼Œå®ƒå……å½“æœåŠ¡ä¹‹é—´çš„ä¸­ä»‹ã€‚</li><li><strong>æ— ä»£ç†æ¶æ„</strong>ï¼Œç›´æ¥å‘æœåŠ¡å‘é€æ¶ˆæ¯ï¼Œå› ä¸ºé€šä¿¡æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯ä¸ä¼šå µå¡å’Œç­‰å¾…å›å¤ã€‚</li></ul><h3 id="3-1-æ¶ˆæ¯ä¼ é€’"><a href="#3-1-æ¶ˆæ¯ä¼ é€’" class="headerlink" title="3.1 æ¶ˆæ¯ä¼ é€’"></a>3.1 æ¶ˆæ¯ä¼ é€’</h3><p>æ¶ˆæ¯é€šè¿‡æ¶ˆæ¯é€šé“è¿›è¡Œäº¤æ¢ï¼Œå‘é€æ–¹å°†æ¶ˆæ¯å†™å…¥é€šé“ï¼Œæ¥å—æ–¹ä»é€šé“è¯»å–æ¶ˆæ¯ï¼š</p><ul><li><p><strong>æ¶ˆæ¯</strong>ï¼š</p><ul><li>ç»„æˆç»“æ„ï¼šæ¶ˆæ¯å¤´éƒ¨ + æ¶ˆæ¯ä¸»ä½“ã€‚</li><li>å†…å®¹ï¼š<ul><li>æ ‡é¢˜ï¼šåç§°ä¸å€¼å¯¹çš„é›†åˆï¼Œæè¿°æ­£åœ¨å‘é€çš„æ•°æ®çš„å…ƒæ•°æ®ã€‚</li><li>æ¶ˆæ¯IDï¼šå”¯ä¸€æ ‡è¯†ã€‚</li><li>è¿”å›åœ°å€ï¼šæŒ‡å®šå‘é€å›å¤çš„æ¶ˆæ¯é€šé“ã€‚</li><li>æ­£æ–‡ï¼šæ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ ¼å¼çš„æ•°æ®ã€‚</li></ul></li><li>æ¶ˆæ¯ç±»å‹ï¼š<ul><li>æ–‡æ¡£ï¼šä»…åŒ…å«æ•°æ®çš„é€šç”¨æ¶ˆæ¯ã€‚</li><li>å‘½ä»¤ï¼šä¸€æ¡ç­‰åŒäºRPCè¯·æ±‚çš„æ¶ˆæ¯ï¼ŒæŒ‡å®šè¦è°ƒç”¨çš„æ“ä½œåŠå‚æ•°ã€‚</li><li>äº‹ä»¶ï¼šæ ‡è¯†å‘é€æ–¹å‘ç”Ÿäº†é‡è¦äº‹ä»¶ï¼Œé€šå¸¸æ˜¯é¢†åŸŸäº‹ä»¶ï¼Œè¡¨ç¤ºé¢†åŸŸå¯¹è±¡çŠ¶æ€æ›´æ”¹ã€‚</li></ul></li></ul></li><li><p><strong>æ¶ˆæ¯é€šé“</strong>ï¼šæ¶ˆæ¯ä¼ é€’åŸºç¡€è®¾æ–½çš„æŠ½è±¡ã€‚</p><ul><li>æ¶ˆæ¯é€šé“ç±»å‹ï¼š<ul><li><strong>ç‚¹å¯¹ç‚¹é€šé“</strong>ï¼šå‘æ­£åœ¨ä»é€šé“è¯»å–çš„ä¸€ä¸ªæ¶ˆè´¹è€…ä¼ é€’æ¶ˆæ¯ï¼Œå®ç°ä¸€å¯¹ä¸€äº¤äº’æ–¹å¼ï¼Œå¸¸ç”¨äºå‘½ä»¤å¼æ¶ˆæ¯ã€‚</li><li><strong>å‘å¸ƒ-è®¢é˜…é€šé“</strong>ï¼šå°†ä¸€æ¡æ¶ˆæ¯å‘ç»™æ‰€æœ‰è®¢é˜…çš„æ¥æ”¶æ–¹ï¼Œå®ç°ä¸€å¯¹å¤šäº¤äº’æ–¹å¼ï¼Œå¸¸ç”¨äºäº‹ä»¶å¼æ¶ˆæ¯ã€‚</li></ul></li></ul></li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010137.jpg" alt></p><h3 id="3-2-ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶å®ç°äº¤äº’æ–¹å¼"><a href="#3-2-ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶å®ç°äº¤äº’æ–¹å¼" class="headerlink" title="3.2 ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶å®ç°äº¤äº’æ–¹å¼"></a>3.2 ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶å®ç°äº¤äº’æ–¹å¼</h3><p>æ¶ˆæ¯æœºåˆ¶æœ¬è´¨æ˜¯å¼‚æ­¥çš„ï¼Œåªæä¾›å¼‚æ­¥è¯·æ±‚/å“åº”ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šè¿‡äº¤æ¢ä¸€å¯¹æ¶ˆæ¯æ¥å®ç°å¼‚æ­¥è¯·æ±‚/å“åº”æ–¹å¼çš„äº¤äº’ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œå®¢æˆ·ç«¯å‘é€å‘½ä»¤å¼æ¶ˆæ¯ï¼Œå†…å®¹é€šè¿‡æœåŠ¡æ‹¥æœ‰çš„ç‚¹å¯¹ç‚¹æ¶ˆæ¯é€šé“ä¼ é€’ï¼ŒæœåŠ¡å¤„ç†è¯·æ±‚åå°†åŒ…å«ç»“æœçš„å›å¤æ¶ˆæ¯å‘é€åˆ°å®¢æˆ·ç«¯æ‹¥æœ‰çš„ç‚¹å¯¹ç‚¹é€šé“ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010138.jpg" alt></p><p>å®¢æˆ·ç«¯å¿…é¡»å‘Šè¯‰æœåŠ¡å‘é€å›å¤æ¶ˆæ¯çš„ä½ç½®ï¼Œå¹¶ä¸”è¦å¯¹å›å¤å’Œè¯·æ±‚è¿›è¡ŒåŒ¹é…ã€‚msgIdå«ç›¸å…³æ€§IDï¼Œç”¨æ¥åŒ¹é…äºŒè€…ã€‚</p><p>æ¶ˆæ¯æœºåˆ¶å¯ä»¥å®ç°çš„äº¤äº’æ–¹å¼ï¼š</p><ul><li><strong>å®ç°è¯·æ±‚/å“åº”å’Œå¼‚æ­¥è¯·æ±‚/å“åº”</strong>ï¼Œå‰è€…æœŸæœ›ç«‹å³å“åº”ã€‚</li><li><strong>å®ç°å•å‘é€šçŸ¥</strong>ï¼šå®¢æˆ·ç«¯å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡æ‰€æ‹¥æœ‰çš„ç‚¹å¯¹ç‚¹é€šé“ï¼ŒæœåŠ¡è®¢é˜…å¹¶å¤„ç†æ¶ˆæ¯ï¼Œä½†å¹¶ä¸å›å¤ã€‚</li><li><strong>å®ç°å‘å¸ƒ/è®¢é˜…</strong>ï¼šå®¢æˆ·ç«¯å°†æ¶ˆæ¯å‘å¸ƒåˆ°ç”±å¤šä¸ªæ¥æ”¶æ–¹è¯»å–çš„å‘å¸ƒ/è®¢é˜…é€šé“ï¼Œå¾®æœåŠ¡ä¸­å¯ä»¥ç”¨å‘å¸ƒ/è®¢é˜…æ¥å‘å¸ƒé¢†åŸŸäº‹ä»¶ï¼Œå¦‚OrderServiceå°†Orderäº‹ä»¶å‘å¸ƒåˆ°Orderé€šé“ï¼Œå¯¹ç‰¹å®šé¢†åŸŸäº‹ä»¶æ„Ÿå…´è¶£çš„æœåŠ¡åªè¦è®¢é˜…å³å¯ã€‚</li><li><strong>å®ç°å‘å¸ƒ/å¼‚æ­¥å“åº”</strong>ï¼šæ˜¯å‘å¸ƒ/è®¢é˜…å’Œè¯·æ±‚/å“åº”ä¸¤ç§æ–¹å¼çš„å…ƒç´ ç»„åˆåœ¨ä¸€èµ·ï¼Œå®¢æˆ·ç«¯å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œåœ¨æ¶ˆæ¯çš„å¤´éƒ¨ä¸­æŒ‡å®š<strong>å›å¤é€šé“</strong>ï¼ˆåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªå‘å¸ƒ-è®¢é˜…é€šé“ï¼‰ã€‚æ¶ˆè´¹è€…å°†åŒ…å«<strong>ç›¸å…³æ€§ID</strong>çš„å›å¤æ¶ˆæ¯å†™å…¥å›å¤é€šé“ï¼Œå®¢æˆ·ç«¯é€šè¿‡ç›¸å…³æ€§IDæ¥æ”¶é›†å“åº”ï¼Œä»¥æ­¤å°†å›å¤æ¶ˆæ¯ä¸è¯·æ±‚åŒ¹é…ã€‚</li></ul><h3 id="3-3-ä¸ºåŸºäºæ¶ˆæ¯æœºåˆ¶çš„æœåŠ¡APIåˆ›å»ºAPIè§„èŒƒ"><a href="#3-3-ä¸ºåŸºäºæ¶ˆæ¯æœºåˆ¶çš„æœåŠ¡APIåˆ›å»ºAPIè§„èŒƒ" class="headerlink" title="3.3 ä¸ºåŸºäºæ¶ˆæ¯æœºåˆ¶çš„æœåŠ¡APIåˆ›å»ºAPIè§„èŒƒ"></a>3.3 ä¸ºåŸºäºæ¶ˆæ¯æœºåˆ¶çš„æœåŠ¡APIåˆ›å»ºAPIè§„èŒƒ</h3><p>æœåŠ¡çš„å¼‚æ­¥APIåŒ…å«ä¾›å®¢æˆ·ç«¯è°ƒç”¨çš„æ“ä½œå’Œç”±æœåŠ¡å¯¹å¤–å‘å¸ƒçš„äº‹ä»¶ï¼š</p><ul><li>è®°å½•å¼‚æ­¥æ“ä½œï¼š<ul><li>è¯·æ±‚/å¼‚æ­¥å“åº”å¼APIï¼šåŒ…æ‹¬æœåŠ¡çš„å‘½ä»¤æ¶ˆæ¯é€šé“ã€æœåŠ¡æ¥å—çš„å‘½ä»¤å¼æ¶ˆæ¯çš„å…·ä½“ç±»å‹å’Œæ ¼å¼ï¼Œä»¥åŠæœåŠ¡å‘é€çš„å›å¤æ¶ˆæ¯çš„ç±»å‹å’Œæ ¼å¼ã€‚</li><li>å•å‘é€šçŸ¥å¼APIï¼šåŒ…æ‹¬æœåŠ¡çš„å‘½ä»¤æ¶ˆæ¯é€šé“ã€æœåŠ¡æ¥å—çš„å‘½ä»¤å¼æ¶ˆæ¯çš„å…·ä½“ç±»å‹å’Œæ ¼å¼ã€‚</li></ul></li><li>è®°å½•äº‹ä»¶å‘å¸ƒï¼šæœåŠ¡è¿˜å¯ä»¥ä½¿ç”¨å‘å¸ƒ/å®šä¹‰çš„æ–¹å¼å¯¹å¤–å‘å¸ƒäº‹ä»¶ï¼ŒAPIé£æ ¼çš„è§„èŒƒåŒ…æ‹¬äº‹ä»¶é€šé“ä»¥åŠæœåŠ¡å‘å¸ƒåˆ°é€šé“çš„äº‹ä»¶å¼æ¶ˆæ¯çš„ç±»å‹å’Œæ ¼å¼ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010139.jpg" alt></p><h3 id="3-4-ä½¿ç”¨æ¶ˆæ¯ä»£ç†"><a href="#3-4-ä½¿ç”¨æ¶ˆæ¯ä»£ç†" class="headerlink" title="3.4 ä½¿ç”¨æ¶ˆæ¯ä»£ç†"></a>3.4 ä½¿ç”¨æ¶ˆæ¯ä»£ç†</h3><p>æ¶ˆæ¯ä»£ç†ï¼Œå³æœåŠ¡é€šä¿¡çš„åŸºç¡€è®¾æ–½æœåŠ¡ã€‚é™¤äº†æ¶ˆæ¯ä»£ç†æ¶æ„ï¼Œè¿˜æœ‰åŸºäºæ— ä»£ç†çš„æ¶ˆæ¯ä¼ é€’æ¶æ„ï¼Œå…¶ä¸­æœåŠ¡ç›¸äº’é€šä¿¡ã€‚äºŒè€…å„æœ‰åˆ©å¼Šï¼Œé€šå¸¸ä¼šé€‰æ‹©æ¶ˆæ¯ä»£ç†æ¶æ„ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010140.jpg" alt></p><ul><li><p>æ— ä»£ç†æ¶ˆæ¯ï¼šæœåŠ¡ç›´æ¥äº¤æ¢æ¶ˆæ¯</p><ul><li>ZeroMQæ˜¯ä¸€ç§æµè¡Œçš„æ— ä»£ç†æ¶ˆæ¯æŠ€æœ¯ï¼Œæ”¯æŒå„ç§ä¼ è¾“åè®®ï¼ˆå¦‚TCPã€UNIXï¼‰é£æ ¼çš„å¥—æ¥å­—å’Œå¤šæ’­ã€‚</li><li>ä¼˜ç‚¹ï¼š<ul><li>å…è®¸æ›´è½»çš„ç½‘ç»œæµé‡å’Œæ›´ä½çš„å»¶è¿Ÿï¼Œå› ä¸ºæ¶ˆæ¯ç›´æ¥ä»å‘é€æ–¹åˆ°æ¥æ”¶æ–¹ï¼Œå°‘äº†ä¸€å±‚ä»£ç†ï¼›</li><li>æ¶ˆé™¤äº†æ¶ˆæ¯ä»£ç†å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆæˆ–å•ç‚¹æ•…éšœçš„å¯èƒ½æ€§ï¼›</li><li>å…·æœ‰è¾ƒä½çš„æ“ä½œå¤æ‚æ€§ï¼Œå› ä¸ºä¸éœ€è¦è®¾ç½®å’Œç»´æŠ¤æ¶ˆæ¯ä»£ç†ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>æœåŠ¡éœ€è¦çŸ¥é“å½¼æ­¤çš„ä½ç½®ï¼Œå¿…é¡»ä½¿ç”¨æœåŠ¡å‘ç°æœºåˆ¶ã€‚</li><li>ä¼šå¯¼è‡´å¯ç”¨æ€§é™ä½ï¼Œå› ä¸ºåœ¨äº¤æ¢æ¶ˆæ¯æ—¶ï¼Œæ¶ˆæ¯çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¿…é¡»åŒæ—¶åœ¨çº¿ã€‚</li><li>åœ¨å®ç°ä¾‹å¦‚ç¡®ä¿æ¶ˆæ¯èƒ½å¤ŸæˆåŠŸæŠ•é€’è¿™äº›å¤æ‚åŠŸèƒ½æ—¶çš„æŒ‘æˆ˜æ€§æ›´å¤§ã€‚</li></ul></li><li>è¿™äº›å¼Šç«¯å’ŒåŒæ­¥è¯·æ±‚å“åº”çš„äº¤äº’æ–¹å¼ç›¸åŒï¼Œæ‰€ä»¥å¤§å¤šæ•°ä¼ä¸šåº”ç”¨é€‰æ‹©åŸºäºæ¶ˆæ¯ä»£ç†çš„æ¶æ„ã€‚</li></ul></li><li><p>åŸºäºä»£ç†çš„æ¶ˆæ¯ï¼šæ¶ˆæ¯ä»£ç†ä½œä¸ºæ‰€æœ‰æ¶ˆæ¯çš„ä¸­ä»‹èŠ‚ç‚¹ã€‚</p><ul><li><p>å¼€æºæ¶ˆæ¯ä»£ç†æŠ€æœ¯ï¼š</p><ul><li>Apache ActiveMQ</li><li>RabbitMQ</li><li>Apache Kafka</li><li>AWS Kinesis å’Œ AWS SQS ï¼šåŸºäºäº‘çš„æ¶ˆæ¯æœåŠ¡ã€‚</li></ul></li><li><p>ä¼˜ç‚¹ï¼š</p><ul><li>å‘é€æ–¹ä¸éœ€çŸ¥é“æ¥æ”¶æ–¹çš„ç½‘ç»œä½ç½®ã€‚</li><li>æ¶ˆæ¯ä»£ç†å¯ä»¥ç¼“å†²æ¶ˆæ¯ï¼Œç›´åˆ°æ¥æ”¶æ–¹èƒ½å¤Ÿå¤„ç†å®ƒä»¬ã€‚</li></ul></li><li>éœ€è¦è€ƒè™‘ï¼š<ul><li>æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€</li><li>æ”¯æŒçš„æ¶ˆæ¯æ ‡å‡†ï¼šå¦‚AMQPä½•STOMP</li><li>æ¶ˆæ¯æ’åº</li><li>æŠ•é€’ä¿è¯</li><li>æŒä¹…æ€§ï¼šæ¶ˆæ¯èƒ½å¦æŒä¹…åŒ–åˆ°ç£ç›˜å¹¶åœ¨ä»£ç†å´©æºƒæ—¶æ¢å¤</li><li>è€ä¹…æ€§ï¼šæ¥æ”¶æ–¹é‡è¿åˆ°æ¶ˆæ¯ä»£ç†ï¼Œæ˜¯å¦ä¼šæ”¶åˆ°æ–­å¼€è¿æ¥æ—¶å‘é€çš„æ¶ˆæ¯</li><li>å¯æ‰©å±•æ€§</li><li>å»¶è¿Ÿ</li><li>ç«äº‰æ€§ï¼ˆå¹¶å‘ï¼‰æ¥æ”¶æ–¹</li></ul></li><li>æ¯ç§æ¶ˆæ¯ä»£ç†åªèƒ½å°½é‡ä¾§é‡ä»¥ä¸Šçš„å‡ ç‚¹ï¼Œéœ€è¦æ ¹æ®åœºæ™¯éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ¶ˆæ¯ä»£ç†ã€‚</li></ul></li></ul><p>ä½¿ç”¨æ¶ˆæ¯ä»£ç†å®ç°æ¶ˆæ¯é€šé“ï¼š</p><ul><li>ActiveMQç­‰JMSæ¶ˆæ¯ä»£ç†å…·æœ‰é˜Ÿåˆ—å’Œä¸»é¢˜ï¼›</li><li>RabbitMQç­‰åŸºäºAMQPçš„æ¶ˆæ¯ä»£ç†å…·æœ‰äº¤æ¢å’Œé˜Ÿåˆ—ï¼›</li><li>Kafkaæœ‰ä¸»é¢˜ï¼›</li><li>AWS Kinesisæœ‰æµ</li><li>AWS SQSæœ‰é˜Ÿåˆ—ã€‚</li></ul><table><thead><tr><th>æ¶ˆæ¯ä»£ç†</th><th>ç‚¹å¯¹ç‚¹é€šé“</th><th>å‘å¸ƒ-è®¢é˜…é€šé“</th></tr></thead><tbody><tr><td>JMS</td><td>é˜Ÿåˆ—</td><td>ä¸»é¢˜</td></tr><tr><td>Kafka</td><td>ä¸»é¢˜</td><td>ä¸»é¢˜</td></tr><tr><td>AMQP</td><td>é˜Ÿåˆ—</td><td>ç»„æ’­å¼äº¤æ¢å’Œæ¯å®¢æˆ·ç«¯é˜Ÿåˆ—</td></tr><tr><td>AWS Kinesis</td><td>æµ</td><td>æµ</td></tr><tr><td>AWS SQS</td><td>é˜Ÿåˆ—</td><td>/</td></tr></tbody></table><p>åªæœ‰AWS SQSåªæ”¯æŒç‚¹å¯¹ç‚¹é€šé“ï¼Œå…¶ä½™éƒ½æ”¯æŒå‘å¸ƒ-è®¢é˜…é€šé“ã€‚</p><p>æ¶ˆæ¯ä»£ç†çš„ä¼˜ç‚¹ï¼š</p><ul><li>æ¾è€¦åˆï¼š</li><li>æ¶ˆæ¯ç¼“å­˜</li><li>çµæ´»çš„é€šä¿¡</li><li>æ˜ç¡®çš„è¿›ç¨‹é—´é€šä¿¡</li></ul><p>æ¶ˆæ¯ä»£ç†çš„ç¼ºç‚¹ï¼š</p><ul><li>æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆ</li><li>æ½œåœ¨çš„å•ç‚¹æ•…éšœ</li><li>é¢å¤–çš„æ“ä½œå¤æ‚æ€§</li></ul><h3 id="3-5-å¤„ç†å¹¶å‘å’Œæ¶ˆæ¯é¡ºåº"><a href="#3-5-å¤„ç†å¹¶å‘å’Œæ¶ˆæ¯é¡ºåº" class="headerlink" title="3.5 å¤„ç†å¹¶å‘å’Œæ¶ˆæ¯é¡ºåº"></a>3.5 å¤„ç†å¹¶å‘å’Œæ¶ˆæ¯é¡ºåº</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010141.jpg" alt></p><h3 id="3-6-å¤„ç†é‡å¤æ¶ˆæ¯"><a href="#3-6-å¤„ç†é‡å¤æ¶ˆæ¯" class="headerlink" title="3.6 å¤„ç†é‡å¤æ¶ˆæ¯"></a>3.6 å¤„ç†é‡å¤æ¶ˆæ¯</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010142.jpg" alt></p><h3 id="3-7-äº‹åŠ¡æ€§æ¶ˆæ¯"><a href="#3-7-äº‹åŠ¡æ€§æ¶ˆæ¯" class="headerlink" title="3.7 äº‹åŠ¡æ€§æ¶ˆæ¯"></a>3.7 äº‹åŠ¡æ€§æ¶ˆæ¯</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010143.jpg" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010144.jpg" alt></p><h3 id="3-8-æ¶ˆæ¯ç›¸å…³ç±»åº“å’Œæ¡†æ¶"><a href="#3-8-æ¶ˆæ¯ç›¸å…³ç±»åº“å’Œæ¡†æ¶" class="headerlink" title="3.8 æ¶ˆæ¯ç›¸å…³ç±»åº“å’Œæ¡†æ¶"></a>3.8 æ¶ˆæ¯ç›¸å…³ç±»åº“å’Œæ¡†æ¶</h3><h2 id="å››-ä½¿ç”¨å¼‚æ­¥æ¶ˆæ¯æä¾›å¯ç”¨æ€§"><a href="#å››-ä½¿ç”¨å¼‚æ­¥æ¶ˆæ¯æä¾›å¯ç”¨æ€§" class="headerlink" title="å››. ä½¿ç”¨å¼‚æ­¥æ¶ˆæ¯æä¾›å¯ç”¨æ€§"></a>å››. ä½¿ç”¨å¼‚æ­¥æ¶ˆæ¯æä¾›å¯ç”¨æ€§</h2><h3 id="4-1-åŒæ­¥æ¶ˆæ¯ä¼šé™ä½å¯ç”¨æ€§"><a href="#4-1-åŒæ­¥æ¶ˆæ¯ä¼šé™ä½å¯ç”¨æ€§" class="headerlink" title="4.1 åŒæ­¥æ¶ˆæ¯ä¼šé™ä½å¯ç”¨æ€§"></a>4.1 åŒæ­¥æ¶ˆæ¯ä¼šé™ä½å¯ç”¨æ€§</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010145.jpg" alt></p><h3 id="4-2-æ¶ˆé™¤åŒæ­¥äº¤äº’"><a href="#4-2-æ¶ˆé™¤åŒæ­¥äº¤äº’" class="headerlink" title="4.2 æ¶ˆé™¤åŒæ­¥äº¤äº’"></a>4.2 æ¶ˆé™¤åŒæ­¥äº¤äº’</h3><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010146.jpg" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010147.jpg" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010148.jpg" alt></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹</p>]]></content>
    
    <summary type="html">
    
      ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°ï¼Œå†…å®¹ï¼šç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="design pattern" scheme="http://linyishui.top/tags/design-pattern/"/>
    
      <category term="microservice" scheme="http://linyishui.top/tags/microservice/"/>
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰æœåŠ¡çš„æ‹†åˆ†ç­–ç•¥</title>
    <link href="http://linyishui.top/2020111001.html"/>
    <id>http://linyishui.top/2020111001.html</id>
    <published>2020-11-10T12:07:16.000Z</published>
    <updated>2020-11-26T13:50:36.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="æœåŠ¡çš„æ‹†åˆ†ç­–ç•¥"><a href="#æœåŠ¡çš„æ‹†åˆ†ç­–ç•¥" class="headerlink" title="æœåŠ¡çš„æ‹†åˆ†ç­–ç•¥"></a>æœåŠ¡çš„æ‹†åˆ†ç­–ç•¥</h1><h2 id="ç¬¬ä¸€èŠ‚-å¾®æœåŠ¡æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ç¬¬ä¸€èŠ‚-å¾®æœåŠ¡æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç¬¬ä¸€èŠ‚ å¾®æœåŠ¡æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ç¬¬ä¸€èŠ‚ å¾®æœåŠ¡æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h2><h3 id="1-1-è½¯ä»¶æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-1-è½¯ä»¶æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.1 è½¯ä»¶æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.1 è½¯ä»¶æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><strong>è½¯ä»¶æ¶æ„</strong>æ˜¯ä¸€ç§æŠ½è±¡çš„ç»“æ„ï¼Œç”±è½¯ä»¶çš„å„ä¸ªç»„æˆéƒ¨åˆ†å’Œå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»æ„æˆã€‚<strong>è®¡ç®—æœºç³»ç»Ÿçš„è½¯ä»¶æ¶æ„æ˜¯æ„å»ºè¿™ä¸ªç³»ç»Ÿæ‰€éœ€è¦çš„ä¸€ç»„ç»“æ„ï¼ŒåŒ…å«è½¯ä»¶å…ƒç´ ã€å®ƒä»¬ä¹‹é—´çš„å…³ç³»ä»¥åŠä¸¤è€…çš„å±æ€§</strong>ã€‚</p><p>å°†è½¯ä»¶åˆ†è§£æˆå…ƒç´ å’Œå®šä¹‰è¿™äº›å…ƒç´ ä¹‹é—´çš„å…³ç³»ï¼Œå†³å®šäº†è½¯ä»¶çš„èƒ½åŠ›ã€‚</p><p>åº”ç”¨ç¨‹åºæœ‰ä¸¤ä¸ªå±‚æ¬¡çš„éœ€æ±‚ï¼š<strong>åŠŸèƒ½æ€§éœ€æ±‚</strong>å’Œ<strong>è´¨é‡æ€§éœ€æ±‚</strong>ï¼Œåè€…å†³å®šä¸€ä¸ªåº”ç”¨åœ¨è¿è¡Œå’Œå¼€å‘æ—¶çš„è´¨é‡ï¼Œç”±æ‰€é€‰æ‹©çš„è½¯ä»¶æ¶æ„å†³å®šã€‚</p><h3 id="1-2-è½¯ä»¶æ¶æ„çš„-4-1-è§†å›¾æ¨¡å‹"><a href="#1-2-è½¯ä»¶æ¶æ„çš„-4-1-è§†å›¾æ¨¡å‹" class="headerlink" title="1.2 è½¯ä»¶æ¶æ„çš„ 4 + 1 è§†å›¾æ¨¡å‹"></a>1.2 è½¯ä»¶æ¶æ„çš„ 4 + 1 è§†å›¾æ¨¡å‹</h3><p>è½¯ä»¶æ¶æ„å¯ä»¥åƒå»ºç­‘ä¸€æ ·æœ‰å¤šä¸ªæ¶æ„è§†è§’ï¼ˆ+1æŒ‡åœºæ™¯ï¼ŒæŠŠè§†å›¾ä¸²è”åœ¨ä¸€èµ·ï¼‰ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010108.jpg" alt></p><p>æ¯ä¸ªè§†å›¾çš„ç›®çš„ï¼š</p><ul><li>é€»è¾‘è§†å›¾ï¼šå¼€å‘äººå‘˜åˆ›å»ºçš„å…ƒç´ ï¼Œåœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¸­æ˜¯ç±»ï¼ˆClassï¼‰å’ŒåŒ…ï¼ˆPackageï¼‰ï¼Œå…³ç³»åŒ…æ‹¬ç»§æ‰¿ã€å…³è”å’Œä¾èµ–ã€‚</li><li>å®ç°è§†å›¾ï¼šæ„å»ºç¼–è¯‘ç³»ç»Ÿçš„è¾“å‡ºï¼Œç»„ä»¶æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—ç»„æˆçš„å¯æ‰§è¡Œæˆ–å¯éƒ¨ç½²å•å…ƒã€‚åœ¨Javaä¸­æ¨¡å—æ˜¯JARæ–‡ä»¶ï¼Œç»„ä»¶æ˜¯WARæ–‡ä»¶æˆ–å¯æ‰§è¡ŒJARæ–‡ä»¶ï¼›å…³ç³»åŒ…æ‹¬æ¨¡å—é—´çš„ä¾èµ–å…³ç³»å’Œç»„ä»¶æ¨¡å—é—´çš„ç»„åˆå…³ç³»ã€‚</li><li>è¿›ç¨‹è§†å›¾ï¼šè¿è¡Œæ—¶çš„ç»„ä»¶ï¼Œå…ƒç´ æ˜¯è¿›ç¨‹ï¼Œè¿›ç¨‹é—´å…³ç³»å³è¿›ç¨‹é—´é€šä¿¡ã€‚</li><li>éƒ¨ç½²è§†å›¾ï¼šè¿›ç¨‹å¦‚ä½•æ˜ å°„åˆ°æœºå™¨ï¼Œå…ƒç´ ç”±è®¡ç®—æœºå’Œè¿›ç¨‹ç»„æˆï¼Œæœºå™¨ä¹‹é—´çš„å…³ç³»å³ç½‘ç»œã€‚</li></ul><h3 id="1-3-æ¶æ„çš„é£æ ¼"><a href="#1-3-æ¶æ„çš„é£æ ¼" class="headerlink" title="1.3 æ¶æ„çš„é£æ ¼"></a>1.3 æ¶æ„çš„é£æ ¼</h3><p>åˆ†å±‚æ¶æ„å°†è½¯ä»¶å…ƒç´ æŒ‰å±‚çš„æ–¹å¼ç»„ç»‡ï¼Œæ¯å±‚éƒ½æœ‰è‡ªå·±çš„èŒè´£ï¼Œä¸Šä¸€å±‚åªèƒ½ä¾èµ–äºä¸‹æ–¹çš„å±‚ã€‚</p><p>åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®åˆ†å±‚ç»“æ„åˆ†ä¸ºï¼š</p><ul><li>è¡¨ç°å±‚</li><li>ä¸šåŠ¡é€»è¾‘å±‚</li><li>æ•°æ®æŒä¹…åŒ–å±‚</li></ul><p>ä½†è¡¨ç°å±‚æ— æ³•ä½“ç°åº”ç”¨å¯èƒ½ç”±å¤šä¸ªç³»ç»Ÿè°ƒç”¨çš„æƒ…å†µï¼ŒæŒä¹…åŒ–å±‚ä¹Ÿæ— æ³•ä½“ç°å¤šä¸ªæ•°æ®åº“äº¤äº’ï¼Œä¸šåŠ¡é€»è¾‘å±‚å®é™…ä¸Šä¹Ÿå¹¶ä¸ä¸€å®šä¾èµ–äºæ•°æ®æŒä¹…åŒ–å±‚ã€‚</p><p>å…­è¾¹å½¢ç»“æ„æ˜¯åˆ†å±‚ç»“æ„çš„æ›¿ä»£æ¶æ„ï¼šä¸šåŠ¡é€»è¾‘ä¸å†ä¾èµ–äºé€‚é…å™¨ï¼Œè€Œæ˜¯ç›¸åé€‚é…å™¨éƒ½ä¾èµ–äºä¸šåŠ¡é€»è¾‘ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010109.jpg" alt></p><ul><li>å…¥æ ˆç«¯å£æ˜¯ä¸šåŠ¡é€»è¾‘å…¬å¼€çš„APIï¼Œå¤–éƒ¨ç¨‹åºéƒ½å¯ä»¥è°ƒç”¨å®ƒã€‚</li><li><p>å‡ºæ ˆç«¯å£æ˜¯ä¸šåŠ¡é€»è¾‘è°ƒç”¨å¤–éƒ¨ç³»ç»Ÿçš„æ–¹å¼ï¼Œæ¯”å¦‚å­˜å‚¨æ¥å£å®šä¹‰äº†ä¸€ç³»åˆ—æ•°æ®è®¿é—®æ“ä½œã€‚</p></li><li><p>å…¥æ ˆé€‚é…å™¨è°ƒç”¨å…¥æ ˆç«¯å£å¤„ç†å¤–éƒ¨çš„è¯·æ±‚ï¼ŒSpring MVC Controller æˆ– è®¢é˜…æ¶ˆæ¯çš„æ¶ˆæ¯ä»£ç†å®¢æˆ·ç«¯ã€‚</p></li><li>å‡ºæ ˆé€‚é…å™¨è°ƒç”¨å¤–éƒ¨åº”ç”¨æˆ–æœåŠ¡å¤„ç†ä¸šåŠ¡é€»è¾‘çš„è¯·æ±‚ï¼Œå¦‚æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰ç±»æˆ–è°ƒç”¨è¿œç¨‹æœåŠ¡çš„ä»£ç†ç±»ã€‚</li></ul><h3 id="1-4-å¾®æœåŠ¡æ¶æ„é£æ ¼"><a href="#1-4-å¾®æœåŠ¡æ¶æ„é£æ ¼" class="headerlink" title="1.4 å¾®æœåŠ¡æ¶æ„é£æ ¼"></a>1.4 å¾®æœåŠ¡æ¶æ„é£æ ¼</h3><p>å•ä½“æ¶æ„æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå®ç°è§†å›¾æ˜¯å•ä¸ªç»„ä»¶ï¼Œå°†åº”ç”¨æ„å»ºä¸ºå•ä¸ªå¯æ‰§è¡Œæˆ–å¯éƒ¨ç½²ç»„ä»¶ã€‚</p><p>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå®ç°è§†å›¾ç”±å¤šä¸ªç»„ä»¶æ„æˆï¼Œå°†åº”ç”¨æ„å»ºä¸ºæ¾è€¦åˆã€å¯ç‹¬ç«‹éƒ¨ç½²çš„ä¸€ç»„æœåŠ¡ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010110.jpg" alt></p><h4 id="1-4-1-ä»€ä¹ˆæ˜¯æœåŠ¡ï¼Ÿ"><a href="#1-4-1-ä»€ä¹ˆæ˜¯æœåŠ¡ï¼Ÿ" class="headerlink" title="1.4.1 ä»€ä¹ˆæ˜¯æœåŠ¡ï¼Ÿ"></a>1.4.1 ä»€ä¹ˆæ˜¯æœåŠ¡ï¼Ÿ</h4><p>å•ä¸€çš„ã€å¯ç‹¬ç«‹éƒ¨ç½²çš„è½¯ä»¶ç»„ä»¶å°±æ˜¯æœåŠ¡ï¼Œå…¶APIå°è£…äº†å†…éƒ¨å®ç°ï¼Œå¼ºåˆ¶å®ç°äº†åº”ç”¨ç¨‹åºçš„æ¨¡å—åŒ–ã€‚æ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„æ¶æ„ç”šè‡³æŠ€æœ¯æ ˆï¼Œå¾€å¾€éƒ½æ˜¯å…­è¾¹å½¢æ¶æ„ï¼Œä¸šåŠ¡é€»è¾‘å’Œé€‚é…å™¨äº¤äº’ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010111.jpg" alt></p><h4 id="1-4-2-ä»€ä¹ˆæ˜¯æ¾è€¦åˆï¼Ÿ"><a href="#1-4-2-ä»€ä¹ˆæ˜¯æ¾è€¦åˆï¼Ÿ" class="headerlink" title="1.4.2 ä»€ä¹ˆæ˜¯æ¾è€¦åˆï¼Ÿ"></a>1.4.2 ä»€ä¹ˆæ˜¯æ¾è€¦åˆï¼Ÿ</h4><p>æœåŠ¡è‡ªèº«çš„æŒä¹…åŒ–æ•°æ®å°±åƒç±»çš„ç§æœ‰å±æ€§ä¸€æ ·è¢«å°è£…ï¼Œè¿™æ ·å¼€å‘è€…å°±å¯ä»¥ä»»æ„ä¿®æ”¹æœåŠ¡çš„æ•°æ®ç»“æ„è€Œä¸ç”¨æ‹…å¿ƒå½±å“åˆ°åˆ«çš„æœåŠ¡ã€‚</p><h4 id="1-4-3-å…±äº«ç±»åº“çš„è§’è‰²"><a href="#1-4-3-å…±äº«ç±»åº“çš„è§’è‰²" class="headerlink" title="1.4.3 å…±äº«ç±»åº“çš„è§’è‰²"></a>1.4.3 å…±äº«ç±»åº“çš„è§’è‰²</h4><p>å¼€å‘æ—¶ä¼šæŠŠå¸¸ç”¨çš„åŠŸèƒ½æ‰“åŒ…ä»¥ä¾¿å¤šä¸ªåº”ç”¨å¯ä»¥é‡ç”¨ï¼Œè€Œä¸å¿…å¤åˆ¶ä»£ç ï¼Œè¿™æ˜¯å‡å°‘é‡å¤ä»£ç çš„å¥½æ–¹æ³•ï¼Œä½†æœ‰å¯èƒ½ä¼šæ„å¤–çš„åœ¨æœåŠ¡ä¹‹é—´å¼•å…¥è€¦åˆã€‚</p><p>æŠŠå¯èƒ½ä¼šå˜æ›´çš„åŠŸèƒ½ä½œä¸ºæœåŠ¡æ¥å®ç°ï¼ˆå¦‚ä¸šåŠ¡åŠŸèƒ½ï¼‰ï¼Œè€Œä¸å˜çš„å¯ä»¥æ‰“åŒ…æˆåº“ã€‚</p><h4 id="1-4-4-æœåŠ¡å¤§å°å¹¶ä¸é‡è¦"><a href="#1-4-4-æœåŠ¡å¤§å°å¹¶ä¸é‡è¦" class="headerlink" title="1.4.4 æœåŠ¡å¤§å°å¹¶ä¸é‡è¦"></a>1.4.4 æœåŠ¡å¤§å°å¹¶ä¸é‡è¦</h4><p>â€œå¾®â€å¹¶ä¸ç‰¹æŒ‡æœåŠ¡å¾ˆå°ï¼Œæ›´å¤šçš„å«ä¹‰åº”è¯¥æ˜¯å•ä¸€ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè¯†åˆ«æœåŠ¡ï¼Œå¹¶ç¡®å®šå®ƒä»¬ä¹‹é—´å¦‚ä½•åä½œã€‚</p><h2 id="ç¬¬äºŒèŠ‚-ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰å¾®æœåŠ¡æ¶æ„"><a href="#ç¬¬äºŒèŠ‚-ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰å¾®æœåŠ¡æ¶æ„" class="headerlink" title="ç¬¬äºŒèŠ‚ ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰å¾®æœåŠ¡æ¶æ„"></a>ç¬¬äºŒèŠ‚ ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰å¾®æœåŠ¡æ¶æ„</h2><p>å®šä¹‰ç¨‹åºæ¶æ„å’Œè½¯ä»¶å¼€å‘ä¸€æ ·ï¼Œæ²¡æœ‰ä¸€ä¸ªæœºæ¢°åŒ–çš„æµç¨‹å¯ä»¥ä¿è¯è¾“å‡ºä¸€ä¸ªåˆç†çš„æ¶æ„ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸€äº›ä¸æ–­è¿­ä»£å’Œåˆ›æ–°çš„æ–¹æ³•ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010112.jpg" alt></p><p>å¤§è‡´æµç¨‹ï¼š</p><ul><li>ç¬¬ä¸€æ­¥å°†åº”ç”¨ç¨‹åºçš„éœ€æ±‚æç‚¼ä¸ºå„ç§<strong>ç³»ç»Ÿæ“ä½œ</strong>ï¼Œæ˜¯ç¨‹åºå¿…é¡»è¦å¤„ç†çš„è¯·æ±‚ã€‚</li><li>ç¬¬äºŒæ­¥ç¡®å®šå¦‚ä½•<strong>åˆ†è§£æœåŠ¡</strong>ã€‚</li><li>ç¬¬ä¸‰æ­¥<strong>ç¡®å®šæ¯ä¸ªæœåŠ¡çš„API</strong>ã€‚å°†æ¯ä¸ªç³»ç»Ÿæ“ä½œåˆ†é…ç»™æœåŠ¡ï¼ŒæœåŠ¡å¯ä»¥ç‹¬ç«‹æˆ–åä½œå®ç°æ“ä½œã€‚</li></ul><p>æœåŠ¡åˆ†è§£çš„å‡ ä¸ªéšœç¢ï¼š</p><ul><li><strong>ç½‘ç»œå»¶è¿Ÿ</strong>ï¼šæœåŠ¡é—´å¾€è¿”å¤ªå¤šä¼šå‡ºç°é—®é¢˜ã€‚</li><li><strong>åŒæ­¥é€šä¿¡</strong>ï¼šæœåŠ¡é—´çš„åŒæ­¥é€šä¿¡ä¼šé™ä½å¯ç”¨æ€§ï¼Œéœ€è¦ä½¿ç”¨<strong>è‡ªåŒ…å«æœåŠ¡</strong>ã€‚</li><li><strong>è·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§</strong>ï¼šä½¿ç”¨<strong>Saga</strong>ã€‚</li><li><strong>ä¸Šå¸ç±»</strong>ï¼ˆGod Classï¼‰ï¼šä½¿ç”¨<strong>é¢†åŸŸé©±åŠ¨è®¾è®¡</strong>ï¼ˆDDDï¼‰æ¶ˆé™¤ä¸Šå¸ç±»ã€‚</li></ul><h3 id="2-1-è¯†åˆ«ç³»ç»Ÿæ“ä½œ"><a href="#2-1-è¯†åˆ«ç³»ç»Ÿæ“ä½œ" class="headerlink" title="2.1 è¯†åˆ«ç³»ç»Ÿæ“ä½œ"></a>2.1 è¯†åˆ«ç³»ç»Ÿæ“ä½œ</h3><p>ç¬¬ä¸€æ­¥åˆ›å»ºç”±å…³é”®ç±»ç»„æˆçš„æŠ½è±¡é¢†åŸŸæ¨¡å‹ï¼Œå…³é”®ç±»æä¾›ç”¨äºæè¿°ç³»ç»Ÿæ“ä½œçš„è¯æ±‡è¡¨ã€‚ç¬¬äºŒæ­¥ç¡®å®šç³»ç»Ÿæ“ä½œï¼Œæ ¹æ®é¢†åŸŸæ¨¡å‹æè¿°æ¯ä¸ªç³»ç»Ÿæ“ä½œçš„è¡Œä¸ºã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010113.jpg" alt></p><p>é¢†åŸŸæ¨¡å‹æ¥æºäºç”¨æˆ·æ•…äº‹ä¸­çš„åè¯ï¼Œç³»ç»Ÿæ“ä½œæ¥æºäºåŠ¨è¯ã€‚</p><h4 id="ï¼ˆ1ï¼‰åˆ›å»ºæŠ½è±¡é¢†åŸŸæ¨¡å‹"><a href="#ï¼ˆ1ï¼‰åˆ›å»ºæŠ½è±¡é¢†åŸŸæ¨¡å‹" class="headerlink" title="ï¼ˆ1ï¼‰åˆ›å»ºæŠ½è±¡é¢†åŸŸæ¨¡å‹"></a>ï¼ˆ1ï¼‰åˆ›å»ºæŠ½è±¡é¢†åŸŸæ¨¡å‹</h4><p>é€šè¿‡éœ€æ±‚æ•´ç†ç”¨æˆ·æ•…äº‹ï¼Œä»ä¸­æç‚¼å¾—åˆ°ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010114.jpg" alt></p><p>æ¯ä¸ªç±»çš„ä½œç”¨ï¼š</p><ul><li>Consumerï¼šä¸‹è®¢å•çš„ç”¨æˆ·ã€‚</li><li>Orderï¼šç”¨æˆ·ä¸‹çš„è®¢å•ï¼Œæè¿°è®¢å•ä¿¡æ¯å¹¶è·Ÿè¸ªçŠ¶æ€ã€‚</li><li>OrderLineItemï¼šè®¢å•çš„ä¸€ä¸ªæ¡ç›®ã€‚</li><li>DeliveryInfoï¼šé€é¤çš„æ—¶é—´å’Œåœ°å€ã€‚</li><li>Restaurantï¼šé¤é¦†ï¼Œå‡†å¤‡ç”Ÿäº§è®¢å•ï¼ŒåŒæ—¶è¦å‘èµ·é€è´§ã€‚</li><li>MenuItemï¼šé¤é¦†èœå•çš„ä¸€ä¸ªæ¡ç›®ã€‚</li><li>Courierï¼šé€é¤å‘˜è´Ÿè´£æŠŠè®¢å•é€åˆ°ç”¨æˆ·æ‰‹é‡Œï¼Œå¯è·Ÿè¸ªé€é¤å‘˜å¯ç”¨æ€§å’Œä½ç½®ã€‚</li><li>Addressï¼šç”¨æˆ·å’Œé¤é¦†çš„åœ°å€ã€‚</li><li>Locationï¼šé€é¤å‘˜å½“å‰ç»çº¬åº¦ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰å®šä¹‰ç³»ç»Ÿæ“ä½œ"><a href="#ï¼ˆ2ï¼‰å®šä¹‰ç³»ç»Ÿæ“ä½œ" class="headerlink" title="ï¼ˆ2ï¼‰å®šä¹‰ç³»ç»Ÿæ“ä½œ"></a>ï¼ˆ2ï¼‰å®šä¹‰ç³»ç»Ÿæ“ä½œ</h4><p>ç³»ç»Ÿæ“ä½œåŒ…æ‹¬ï¼š</p><ul><li>å‘½ä»¤å‹ï¼šåˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®çš„ç³»ç»Ÿæ“ä½œã€‚</li><li>æŸ¥è¯¢å‹ï¼šæŸ¥è¯¢å’Œè¯»å–æ•°æ®çš„ç³»ç»Ÿæ“ä½œã€‚</li></ul><p>åˆ†æç”¨æˆ·æ•…äº‹ä¸­çš„åŠ¨è¯ï¼Œè¯†åˆ«ç³»ç»ŸæŒ‡ä»¤ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010121.jpg" alt></p><p>å‘½ä»¤è§„èŒƒå®šä¹‰äº†å‘½ä»¤å¯¹åº”çš„å‚æ•°ã€è¿”å›å€¼å’Œé¢†åŸŸæ¨¡å‹ç±»çš„è¡Œä¸ºï¼Œè¡Œä¸ºè§„èŒƒåŒ…æ‹¬å‰ç½®æ¡ä»¶å’Œåç½®æ¡ä»¶ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010122.jpg" alt></p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010123.jpg" alt></p><p>æŠ½è±¡çš„é¢†åŸŸæ¨¡å‹å’Œç³»ç»Ÿæ“ä½œå¯ä»¥å›ç­”è¿™ä¸ªåº”ç”¨æ˜¯åšä»€ä¹ˆçš„é—®é¢˜ï¼Œæ¯ä¸€ä¸ªç³»ç»Ÿæ“ä½œçš„è¡Œä¸ºéƒ½é€šè¿‡é¢†åŸŸæ¨¡å‹çš„æ–¹å¼æ¥æè¿°ã€‚</p><h3 id="2-2-æ ¹æ®ä¸šåŠ¡èƒ½åŠ›è¿›è¡ŒæœåŠ¡æ‹†åˆ†"><a href="#2-2-æ ¹æ®ä¸šåŠ¡èƒ½åŠ›è¿›è¡ŒæœåŠ¡æ‹†åˆ†" class="headerlink" title="2.2 æ ¹æ®ä¸šåŠ¡èƒ½åŠ›è¿›è¡ŒæœåŠ¡æ‹†åˆ†"></a>2.2 æ ¹æ®ä¸šåŠ¡èƒ½åŠ›è¿›è¡ŒæœåŠ¡æ‹†åˆ†</h3><h4 id="ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯ä¸šåŠ¡èƒ½åŠ›ï¼Ÿ"><a href="#ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯ä¸šåŠ¡èƒ½åŠ›ï¼Ÿ" class="headerlink" title="ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯ä¸šåŠ¡èƒ½åŠ›ï¼Ÿ"></a>ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯ä¸šåŠ¡èƒ½åŠ›ï¼Ÿ</h4><p>ä¸šåŠ¡èƒ½åŠ›ï¼šæŒ‡ä¸€äº›èƒ½å¤Ÿä¸ºå…¬å¸äº§ç”Ÿä»·å€¼çš„å•†ä¸šæ´»åŠ¨ã€‚</p><p>ç»„ç»‡çš„ä¸šåŠ¡èƒ½åŠ›æŒ‡ç»„ç»‡çš„ä¸šåŠ¡æ˜¯ä»€ä¹ˆï¼Œè¿™é€šå¸¸æ˜¯å›ºå®šçš„ï¼Œè€Œç»„ç»‡é‡‡ç”¨ä½•ç§æ–¹å¼æ¥å®ç°å…¶ä¸šåŠ¡èƒ½åŠ›å¾€å¾€æ˜¯ä¸æ–­å˜åŒ–çš„ã€‚æ¯ä¸ªç»„ç»‡æœ‰å“ªäº›ä¸šåŠ¡èƒ½åŠ›ï¼Œé€šè¿‡å¯¹ç»„ç»‡çš„ç›®æ ‡ã€ç»“æ„å’Œå•†ä¸šæµç¨‹çš„åˆ†æå¾—æ¥ã€‚æ¯ä¸ªä¸šåŠ¡éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œé™¤éåªé¢å‘ä¸šåŠ¡è€ŒéæŠ€æœ¯ã€‚</p><p>ä¸šåŠ¡èƒ½åŠ›é›†ä¸­åœ¨ä¸šåŠ¡å¯¹è±¡ä¸Šï¼Œå¦‚ç†èµ”ä¸šåŠ¡å¯¹è±¡æ˜¯ç†èµ”ç®¡ç†åŠŸèƒ½çš„é‡ç‚¹ï¼Œèƒ½åŠ›åˆå¯ä»¥åˆ’åˆ†ä¸ºå­èƒ½åŠ›ï¼Œç†èµ”ç®¡ç†åˆåŒ…æ‹¬ç†èµ”ä¿¡æ¯ç®¡ç†ã€ç†èµ”å®¡æ ¸å’Œç†èµ”ä»˜æ¬¾ç®¡ç†ã€‚</p><blockquote><p>FTGOçš„ä¸šåŠ¡èƒ½åŠ›ï¼š</p><ul><li>ä¾›åº”å•†ç®¡ç†<ul><li>Courier managementï¼šé€é¤å‘˜ç›¸å…³ä¿¡æ¯ç®¡ç†</li><li>Restaurant information managementï¼šé¤é¦†èœå•å’Œå…¶ä»–ä¿¡æ¯ç®¡ç†ï¼ˆå¦‚è¥ä¸šåœ°å€å’Œæ—¶é—´ï¼‰</li></ul></li><li>æ¶ˆè´¹è€…ç®¡ç†<ul><li>æ¶ˆè´¹è€…æœ‰å…³ä¿¡æ¯çš„ç®¡ç†</li></ul></li><li>è®¢å•è·å–å’Œå±¥è¡Œ<ul><li>Order managementï¼šè®©æ¶ˆè´¹è€…å¯ä»¥åˆ›å»ºå’Œç®¡ç†è®¢å•</li><li>Restaurant order managementï¼šè®©é¤é¦†å¯ä»¥ç®¡ç†è®¢å•çš„ç”Ÿäº§è¿‡ç¨‹</li><li>é€é¤ç®¡ç†</li><li>Courier availability managementï¼šé€é¤å‘˜å®æ—¶çŠ¶æ€</li><li>Delivery managementï¼šæŠŠè®¢å•é€åˆ°ç”¨æˆ·æ‰‹ä¸­</li></ul></li><li>ä¼šè®¡è®°è´¦<ul><li>Consumer accountingï¼šç®¡ç†è·Ÿæ¶ˆè´¹è€…ç›¸å…³çš„ä¼šè®¡è®°è´¦</li><li>Restaurant accountingï¼šç®¡ç†è·Ÿé¤é¦†ç›¸å…³çš„ä¼šè®¡è®°è´¦</li><li>Courier accountingï¼šç®¡ç†è·Ÿé€é¤å‘˜ç›¸å…³çš„ä¼šè®¡è®°è´¦</li></ul></li><li>å…¶ä»–</li></ul></blockquote><h4 id="ï¼ˆ2ï¼‰æ ¹æ®ä¸šåŠ¡èƒ½åŠ›æ˜ å°„åˆ°æœåŠ¡"><a href="#ï¼ˆ2ï¼‰æ ¹æ®ä¸šåŠ¡èƒ½åŠ›æ˜ å°„åˆ°æœåŠ¡" class="headerlink" title="ï¼ˆ2ï¼‰æ ¹æ®ä¸šåŠ¡èƒ½åŠ›æ˜ å°„åˆ°æœåŠ¡"></a>ï¼ˆ2ï¼‰æ ¹æ®ä¸šåŠ¡èƒ½åŠ›æ˜ å°„åˆ°æœåŠ¡</h4><p>ç¡®å®šäº†ä¸šåŠ¡èƒ½åŠ›åå¯ä»¥ä¸ºæ¯ä¸ªèƒ½åŠ›å®šä¹‰æœåŠ¡ï¼Œèƒ½åŠ›æœ‰çº§åˆ«åˆ’åˆ†ï¼Œå“ªå±‚çº§åˆ«æ˜ å°„åˆ°æœåŠ¡æ˜¯å¾ˆä¸»è§‚çš„åˆ¤æ–­ï¼Œæœ‰ä»¥ä¸‹ç†ç”±ï¼š</p><ul><li>ä¾›åº”å•†ç®¡ç†æ˜ å°„åˆ°ä¸¤ä¸ªæœåŠ¡ï¼Œå› ä¸ºé¤é¦†å’Œé€é¤å‘˜æ˜¯å®Œå…¨ä¸åŒçš„ä¾›åº”å•†ã€‚</li><li>è®¢å•è·å–å’Œå±¥è¡Œæ˜ å°„åˆ°ä¸‰ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è´Ÿè´£æµç¨‹çš„ä¸åŒé˜¶æ®µã€‚å…¶ä¸­é€é¤å‘˜å¯ç”¨æ€§ç®¡ç†å’Œäº¤ä»˜ç®¡ç†ç»“åˆåœ¨ä¸€èµ·ï¼Œæ˜ å°„åˆ°å•ä¸ªæœåŠ¡ï¼Œå› ä¸ºäºŒè€…äº¤ç»‡åœ¨ä¸€èµ·ã€‚</li><li>ä¼šè®¡è®°è´¦èƒ½åŠ›æ˜ å°„åˆ°ä¸€ä¸ªç‹¬ç«‹æœåŠ¡ï¼Œä¸åŒç±»å‹çš„ä¼šè®¡ä¹Ÿå¾ˆç›¸ä¼¼ã€‚</li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010124.jpg" alt></p><p>æ¶æ„å®šä¹‰æµç¨‹çš„ä¸€ä¸ªé‡è¦æ­¥éª¤æ˜¯è°ƒæŸ¥æœåŠ¡å¦‚ä½•åœ¨æ¯ä¸ªå…³é”®æ¶æ„æœåŠ¡ä¸­åä½œï¼Œæ¯”å¦‚ä½ å‘ç°ç”±äºè¿‡å¤šçš„è¿›ç¨‹é—´é€šä¿¡å¯¼è‡´ç‰¹å®šçš„åˆ†è§£æ•ˆç‡ä½ä¸‹ï¼Œå¯¼è‡´å¿…é¡»è¦æŠŠä¸€äº›æœåŠ¡ç»„åˆåœ¨ä¸€èµ·ã€‚è€Œåœ¨å¤æ‚æ€§æ–¹é¢åˆ™ä¼šå¢é•¿åˆ°å¾ˆå€¼å¾—æ‹†åˆ†çš„ç¨‹åº¦ã€‚</p><h3 id="2-3-æ ¹æ®DDDå­åŸŸè¿›è¡ŒæœåŠ¡æ‹†åˆ†"><a href="#2-3-æ ¹æ®DDDå­åŸŸè¿›è¡ŒæœåŠ¡æ‹†åˆ†" class="headerlink" title="2.3 æ ¹æ®DDDå­åŸŸè¿›è¡ŒæœåŠ¡æ‹†åˆ†"></a>2.3 æ ¹æ®DDDå­åŸŸè¿›è¡ŒæœåŠ¡æ‹†åˆ†</h3><p>DDDé€šè¿‡å®šä¹‰å¤šä¸ªé¢†åŸŸæ¨¡å‹è§£å†³ä¼ ç»Ÿæ¨¡å‹éš¾ä»¥è®©æ‰€æœ‰å›¢é˜Ÿä¿æŒä¸€è‡´çš„éš¾é¢˜ï¼ˆå¦‚æœ¯è¯­ï¼‰ï¼Œæ¯ä¸ªé¢†åŸŸæ¨¡å‹éƒ½æœ‰æ˜ç¡®çš„èŒƒå›´ã€‚</p><ul><li><strong>å­åŸŸ</strong>ï¼šé¢†åŸŸé©±åŠ¨ä¸ºæ¯ä¸ªå­åŸŸå®šä¹‰å•ç‹¬çš„é¢†åŸŸæ¨¡å‹ï¼Œé¢†åŸŸç”¨æ¥æè¿°åº”ç”¨ç¨‹åºé—®é¢˜åŸŸçš„ä¸€ä¸ªæœ¯è¯­ã€‚è¯†åˆ«å­åŸŸå’Œè¯†åˆ«ä¸šåŠ¡èƒ½åŠ›ä¸€æ ·ï¼Œåˆ†æä¸šåŠ¡å¹¶è¯†åˆ«ä¸šåŠ¡çš„ä¸åŒä¸“ä¸šé¢†åŸŸï¼Œå¦‚FTGOçš„å­åŸŸæœ‰ï¼ˆè®¢å•è·å–ã€è®¢å•ç®¡ç†ã€é¤é¦†ç®¡ç†ã€é€é¤ä¸ä¼šè®¡ï¼‰</li><li><strong>é™ç•Œä¸Šä¸‹æ–‡</strong>ï¼ˆbounded contextï¼‰ï¼šé¢†åŸŸæ¨¡å‹çš„è¾¹ç•Œè¢«ç§°ä¸ºé™ç•Œä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬å®ç°è¿™ä¸ªæ¨¡å‹çš„ä»£ç é›†åˆã€‚</li></ul><p>é€šè¿‡DDDçš„æ–¹å¼å®šä¹‰ä¸€ä¸ªä¸ªå­åŸŸï¼Œå¹¶æŠŠæ¯ä¸ªå­åŸŸå¯¹åº”ä¸ºå¯¹åº”çš„ä¸€ä¸ªæœåŠ¡ï¼Œä»è€Œå®Œæˆå¾®æœåŠ¡çš„è®¾è®¡å·¥ä½œï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010125.jpg" alt></p><h3 id="2-4-æ‹†åˆ†çš„åŸåˆ™"><a href="#2-4-æ‹†åˆ†çš„åŸåˆ™" class="headerlink" title="2.4 æ‹†åˆ†çš„åŸåˆ™"></a>2.4 æ‹†åˆ†çš„åŸåˆ™</h3><p>é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ä¹Ÿå¯ä»¥åº”ç”¨äºå¾®æœåŠ¡æ¶æ„ï¼š</p><ul><li><strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼ˆSRPï¼‰ï¼šæ¯ä¸ªç±»éƒ½åº”è¯¥åªæœ‰ä¸€ä¸ªèŒè´£ï¼Œè¿™æ ·å°±åªæœ‰ä¸€ä¸ªç†ç”±å¯¹å®ƒè¿›è¡Œä¿®æ”¹ã€‚å¤šä¸ªèŒè´£å°±ä¼šä½¿ç±»å˜å¾—ä¸ç¨³å®šï¼Œå¯¹äºå¾®æœåŠ¡è€Œè¨€å°±å¦‚FTGOä¸­ä¸ºå®¢æˆ·è·å–é¤é£Ÿä¸­æ¯ä¸ªæ–¹é¢ï¼ˆè®¢å•è·å–ã€è®¢å•å‡†å¤‡ã€é€é¤ï¼‰éƒ½ç”±å•ä¸€çš„æœåŠ¡æ‰¿è½½ã€‚</li><li><strong>é—­åŒ…åŸåˆ™</strong>ï¼ˆCCPï¼‰ï¼šåœ¨åŒ…ä¸­æ‰€åŒ…å«çš„ç±»éƒ½æ˜¯å¯¹åŒç±»å˜åŒ–çš„é›†åˆï¼Œå¦‚æœè¦å¯¹åŒ…è¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦è°ƒæ•´çš„ç±»éƒ½åº”è¯¥åœ¨åŒ…å†…ã€‚è‹¥ä¸¤ä¸ªç±»çš„ä¿®æ”¹å¿…é¡»è€¦åˆçš„å…ˆåå‘ç”Ÿï¼Œå®ƒä»¬åº”è¯¥åœ¨åŒä¸€ä¸ªåŒ…å†…ï¼Œè¿™æ ·å¼€å‘è€…åªé¡»å¯¹ä¸€ä¸ªäº¤ä»˜åŒ…è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸æ˜¯å¤§è§„æ¨¡çš„ä¿®æ”¹æ•´ä¸ªåº”ç”¨ã€‚å¯¹äºå¾®æœåŠ¡æ¶æ„ï¼ŒCCPæ˜¯è§£å†³åˆ†å¸ƒå¼å•ä½“çš„åˆ©å™¨ã€‚</li></ul><h3 id="2-5-æ‹†åˆ†å•ä½“åº”ç”¨ä¸ºæœåŠ¡çš„éš¾ç‚¹"><a href="#2-5-æ‹†åˆ†å•ä½“åº”ç”¨ä¸ºæœåŠ¡çš„éš¾ç‚¹" class="headerlink" title="2.5 æ‹†åˆ†å•ä½“åº”ç”¨ä¸ºæœåŠ¡çš„éš¾ç‚¹"></a>2.5 æ‹†åˆ†å•ä½“åº”ç”¨ä¸ºæœåŠ¡çš„éš¾ç‚¹</h3><ul><li><strong>ç½‘ç»œå»¶è¿Ÿ</strong>ï¼š<ul><li>é—®é¢˜ï¼šæœåŠ¡åˆ†è§£å¯¼è‡´ä¸¤ä¸ªæœåŠ¡é—´å¤§é‡çš„å¾€è¿”è°ƒç”¨ã€‚</li><li>è§£å†³ï¼šå¯ä»¥é€šè¿‡æ‰¹å¤„ç†ä¸€æ¬¡å¾€è¿”å¤šä¸ªå¯¹è±¡ï¼Œæˆ–è€…æŠŠå¤šä¸ªç›¸å…³æœåŠ¡ç»„åˆç”¨ç¼–ç¨‹è¯­è¨€çš„å‡½æ•°è°ƒç”¨ä»£æ›¿é«˜æ˜‚çš„è¿›ç¨‹é—´é€šä¿¡æ¥è§£å†³ã€‚</li></ul></li><li><strong>åŒæ­¥è¿›ç¨‹é—´é€šä¿¡å¯¼è‡´å¯ç”¨æ€§é™ä½</strong>ï¼š<ul><li>é—®é¢˜ï¼šå¦‚æ–°å¢è®¢å• <code>createOrder()</code> é€šå¸¸è®© OrderService ä½¿ç”¨RESTåŒæ­¥è°ƒç”¨å…¶ä»–æœåŠ¡ï¼ŒRESTè¿™æ ·çš„åè®®ä¼šé™ä½æœåŠ¡å¯ç”¨æ€§ï¼Œä»»ä¸€è¢«è°ƒç”¨æœåŠ¡ä¸åœ¨å¯ç”¨çŠ¶æ€å°±å¯¼è‡´è®¢å•æ— æ³•åˆ›å»ºã€‚</li><li>è§£å†³ï¼šå¼‚æ­¥æ¶ˆæ¯é™ä½åŒæ­¥è°ƒç”¨çš„ç´§è€¦åˆï¼ŒåŒæ—¶æé«˜å¯ç”¨æ€§ã€‚</li></ul></li><li><strong>åœ¨æœåŠ¡ä¹‹é—´ç»´æŒæ•°æ®ä¸€è‡´æ€§</strong>ï¼š<ul><li>é—®é¢˜ï¼šéœ€è¦æ›´æ–°å¤šä¸ªæœåŠ¡çš„æ•°æ®æ—¶ï¼Œä¿æŒæœåŠ¡é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚å¦‚é¤é¦†æ¥å—è®¢å•æ—¶ï¼Œè¦åœ¨KitchenServiceå’ŒDeliveryServiceä¸­åŒæ—¶æ›´æ–°ï¼Œå‰è€…ä¿®æ”¹TicketçŠ¶æ€ï¼Œåè€…å®‰æ’è®¢å•äº¤ä»˜ï¼Œéƒ½è¦ä»¥åŸå­åŒ–çš„æ–¹å¼å®Œæˆæ›´æ–°ã€‚</li><li>è§£å†³ï¼šä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆæ˜¯åŸºäºä¸¤é˜¶æ®µæäº¤çš„åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†ï¼Œä½†å¹¶éæœ€å¥½çš„é€‰æ‹©ï¼›Sagaæ˜¯ä¸€ç³»åˆ—ä½¿ç”¨æ¶ˆæ¯åä½œçš„æœ¬åœ°äº‹åŠ¡ï¼Œå”¯ä¸€çš„é™åˆ¶æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œéœ€è¦åŸå­æ›´æ–°æ•°æ®éƒ½åœ¨å•ä¸ªæœåŠ¡ä¸­ã€‚</li></ul></li><li><strong>è·å–ä¸€è‡´çš„æ•°æ®è§†å›¾</strong>ï¼š<ul><li>é—®é¢˜ï¼šæ— æ³•è·¨è¿‡å¤šä¸ªæ•°æ®åº“è·å¾—ä¸€è‡´çš„çœŸå®è§†å›¾ã€‚å•ä½“åº”ç”¨ä¸­ACIDä¿è¯è¿”å›ä¸€è‡´è§†å›¾ï¼Œå¾®æœåŠ¡å³ä½¿æ¯ä¸ªæœåŠ¡æ•°æ®åº“éƒ½ä¸€è‡´ä¹Ÿæ— æ³•å¾—åˆ°ã€‚</li><li>è§£å†³ï¼šè§†å›¾å¿…é¡»é©»ç•™åœ¨å•ä¸ªæœåŠ¡ä¸­ã€‚</li></ul></li><li><strong>ä¸Šå¸ç±»é˜»ç¢äº†æ‹†åˆ†</strong>ï¼š<ul><li>é—®é¢˜ï¼šæ•´ä¸ªåº”ç”¨ç¨‹åºéƒ½è¦ä½¿ç”¨çš„å…¨å±€ç±»ï¼Œä¸Šå¸ç±»ä»£è¡¨å¯¹åº”ç”¨è‡³å…³é‡è¦çš„æ¦‚å¿µå¦‚é“¶è¡Œè´¦æˆ·ã€ç”µå­å•†åŠ¡è®¢å•ã€ä¿é™©æ”¿ç­–ç­‰ç­‰ã€‚å¯¹äºFIGOå°±æ˜¯Orderç±»ï¼Œç³»ç»Ÿå¤§éƒ¨åˆ†æœåŠ¡éƒ½æ¶‰åŠè®¢å•ã€‚å¦‚ä¸‹å›¾2-10æ˜¯ä¼ ç»Ÿå»ºæ¨¡åˆ›å»ºçš„Orderç±»ç»“æ„ã€‚</li><li>è§£å†³ï¼š<ul><li>å°†Orderç±»æ‰“åŒ…åˆ°åº“ï¼Œåˆ›å»ºä¸€ä¸ªä¸­å¤®æ•°æ®åº“ï¼Œå¤„ç†è®¢å•çš„æ‰€æœ‰æœåŠ¡éƒ½è¦è®¿é—®è¯¥åº“ã€‚ä½†æ­¤æ–¹æ¡ˆç ´åäº†å¾®æœåŠ¡æ¶æ„çš„åŸåˆ™ï¼Œå¹¶å¯¼è‡´äº†ç´§è€¦åˆã€‚</li><li>å°†Orderæ•°æ®åº“å°è£…åˆ°OrderServiceä¾›å…¶ä»–æœåŠ¡è°ƒç”¨ï¼Œä½†OrderServiceå°†æˆä¸ºä¸€ä¸ªçº¯æ•°æ®æœåŠ¡ï¼Œæˆä¸ºç¼ºä¹ä¸šåŠ¡é€»è¾‘çš„<strong>è´«è¡€é¢†åŸŸæ¨¡å‹</strong>ã€‚</li><li>å¥½çš„æ–¹æ¡ˆæ˜¯éµå¾ªDDDå°†æ¯ä¸ªæœåŠ¡è§†ä¸ºé¢†åŸŸæ¨¡å‹çš„å•ç‹¬å­åŸŸï¼ŒFTGOçš„æ¯ä¸ªä¸è®¢å•ç›¸å…³çš„æœåŠ¡éƒ½æœ‰è‡ªå·±çš„é¢†åŸŸæ¨¡å‹åŠå¯¹åº”çš„Orderç±»çš„ç‰ˆæœ¬ã€‚å¦‚ä¸‹å›¾2-11ï¼Œå¯¹äºDeliveryServiceï¼ŒOrderå¯ä»¥å‘½åä¸ºæ›´åˆé€‚çš„Deliveryã€‚</li></ul></li></ul></li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010126.jpg" alt></p><p>DeliveryServiceå¯¹Orderçš„å…¶ä»–å±æ€§ä¸æ„Ÿå…´è¶£ï¼š</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010127.jpg" alt></p><p>KitchenServiceçš„Orderå°±æ˜¯ä¸€ä¸ªTicketï¼ˆåå¨å·¥å•ï¼‰ï¼ŒåªåŒ…å«çŠ¶æ€ã€è¯·æ±‚é€é¤æ—¶é—´ã€å‡†å¤‡æ—¶é—´ç­‰ï¼Œä»¥åŠå‘Šè¯‰é¤é¦†å‡†å¤‡çš„è®¢å•é¡¹åˆ—è¡¨ã€‚è€Œä¸å…³å¿ƒå¦‚æ¶ˆè´¹è€…ã€ä»˜æ¬¾ã€äº¤ä»˜è¿™äº›æ— å…³å±æ€§ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010128.jpg" alt></p><p>æ¯ä¸ªé¢†åŸŸæ¨¡å‹çš„Orderç±»éƒ½è¡¨ç¤ºåŒä¸€ä¸ªè®¢å•ä¸šåŠ¡å®ä½“çš„ä¸åŒæ–¹é¢ï¼Œåº”ç”¨å¿…é¡»ç»´æŒä¸åŒæœåŠ¡ä¸­è¿™äº›ä¸åŒå¯¹è±¡ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚æ¯”å¦‚ä¸€æ—¦OrderServiceæˆæƒæ¶ˆè´¹è€…çš„ä¿¡ç”¨å¡ï¼Œå¿…é¡»è§¦å‘KitchenServiceä¸­åˆ›å»ºTicketã€‚åŒæ ·ï¼Œå¦‚æœKitchenServiceæ‹’ç»è®¢å•ï¼Œå¿…é¡»åœ¨OrderServiceä¸­å–æ¶ˆè®¢å•ï¼Œå¹¶ä¸ºå®¢æˆ·é€€æ¬¾ã€‚</p><p><strong>å¯ä»¥é€šè¿‡äº‹ä»¶é©±åŠ¨æœºåˆ¶Sagaæ¥ç»´æŠ¤æœåŠ¡é—´çš„ä¸€è‡´æ€§</strong>ã€‚</p><h3 id="2-6-å®šä¹‰æœåŠ¡API"><a href="#2-6-å®šä¹‰æœåŠ¡API" class="headerlink" title="2.6 å®šä¹‰æœåŠ¡API"></a>2.6 å®šä¹‰æœåŠ¡API</h3><p>åˆ°è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç³»ç»Ÿæ“ä½œåˆ—è¡¨å’Œæ½œåœ¨æœåŠ¡åˆ—è¡¨ï¼Œä¸‹ä¸€æ­¥æ˜¯å®šä¹‰æ¯ä¸ªæœåŠ¡çš„APIï¼š<strong>æœåŠ¡çš„æ“ä½œå’Œäº‹ä»¶</strong>ã€‚</p><p>å®šä¹‰APIæ“ä½œçš„åŸå› ï¼š</p><ol><li>æŸäº›æ“ä½œå¯¹åº”ç³»ç»Ÿæ“ä½œï¼Œç”±å¤–éƒ¨å®¢æˆ·ç«¯è°ƒç”¨ï¼Œæˆ–è€…å…¶ä»–æœåŠ¡è°ƒç”¨ã€‚</li><li>æ”¯æŒæœåŠ¡ä¹‹é—´åä½œçš„æ“ä½œï¼Œä»…ä¾›å…¶ä»–æœåŠ¡è°ƒç”¨ã€‚</li></ol><p>æœåŠ¡é€šè¿‡å¯¹å¤–å‘å¸ƒäº‹ä»¶ï¼Œä½¿å…¶èƒ½ä¸å…¶ä»–æœåŠ¡åä½œã€‚</p><h4 id="ï¼ˆ1ï¼‰å°†ç³»ç»Ÿæ“ä½œåˆ†é…ç»™æœåŠ¡"><a href="#ï¼ˆ1ï¼‰å°†ç³»ç»Ÿæ“ä½œåˆ†é…ç»™æœåŠ¡" class="headerlink" title="ï¼ˆ1ï¼‰å°†ç³»ç»Ÿæ“ä½œåˆ†é…ç»™æœåŠ¡"></a>ï¼ˆ1ï¼‰å°†ç³»ç»Ÿæ“ä½œåˆ†é…ç»™æœåŠ¡</h4><p>ç¬¬ä¸€æ­¥ï¼Œç¡®å®šå“ªä¸ªæœåŠ¡æ˜¯è¯·æ±‚çš„åˆå§‹å…¥å£ç‚¹ã€‚å¦‚ <code>noteUpdateLocation()</code> æ›´æ–°é€é¤å‘˜ä½ç½®ï¼Œå› ä¸ºä¸é€é¤å‘˜ç›¸å…³ï¼Œæ‰€ä»¥åº”è¯¥åˆ†é…ç»™CourierServiceï¼Œä½†å®ƒä¹Ÿæ˜¯éœ€è¦é€é¤åœ°ç‚¹çš„DeliveryServiceã€‚è¿™ç§æƒ…å†µæœ€å¥½æŠŠæ“ä½œåˆ†é…ç»™éœ€è¦æ“ä½œæ‰€æä¾›ä¿¡æ¯çš„æœåŠ¡ï¼Œå…¶ä»–æƒ…å†µä¸‹åˆ†é…ç»™å…·æœ‰å¤„ç†å®ƒæ‰€éœ€ä¿¡æ¯çš„æœåŠ¡æ›´æœ‰æ„ä¹‰ã€‚</p><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010129.jpg" alt></p><h4 id="ï¼ˆ2ï¼‰ç¡®å®šæ”¯æŒæœåŠ¡åä½œæ‰€éœ€è¦çš„API"><a href="#ï¼ˆ2ï¼‰ç¡®å®šæ”¯æŒæœåŠ¡åä½œæ‰€éœ€è¦çš„API" class="headerlink" title="ï¼ˆ2ï¼‰ç¡®å®šæ”¯æŒæœåŠ¡åä½œæ‰€éœ€è¦çš„API"></a>ï¼ˆ2ï¼‰ç¡®å®šæ”¯æŒæœåŠ¡åä½œæ‰€éœ€è¦çš„API</h4><p>ç¬¬äºŒæ­¥ï¼Œæ˜¯ç¡®å®šåœ¨å¤„ç†æ¯ä¸ªç³»ç»Ÿæ“ä½œæ—¶ï¼ŒæœåŠ¡ä¹‹é—´å¦‚ä½•äº¤äº’ã€‚</p><p>å¦‚ <code>createOrder()</code> æ“ä½œéœ€è¦OrderServiceè°ƒç”¨ä¸€ä¸‹æœåŠ¡ä»¥éªŒè¯å…¶å‰ç½®æ¡ä»¶å¹¶ä½¿åç½®æ¡ä»¶æˆç«‹ï¼š</p><ul><li>ConsumerServiceï¼šéªŒè¯æ¶ˆè´¹è€…æ˜¯å¦å¯ä»¥ä¸‹è®¢å•å¹¶è·å–ä»˜æ¬¾ä¿¡æ¯ã€‚</li><li>RestaurantServiceï¼šéªŒè¯è®¢å•è¡Œé¡¹ç›®ï¼ŒéªŒè¯é€è´§åœ°å€å’Œæ—¶é—´æ˜¯å¦åœ¨é¤å…çš„æœåŠ¡åŒºåŸŸå†…ï¼ŒéªŒè¯è®¢å•æœ€ä½è¦æ±‚ï¼Œå¹¶è·å¾—è®¢å•è¡Œé¡¹ç›®çš„ä»·æ ¼ã€‚</li><li>KitchenServiceï¼šåˆ›å»ºTicketåå¨å·¥å•ã€‚</li><li>AccountingServiceï¼šæˆæƒæ¶ˆè´¹è€…çš„ä¿¡ç”¨å¡ã€‚</li></ul><p><img src="https://pic-1258215793.cos.ap-shanghai.myqcloud.com/content/20201101/202011010130.jpg" alt></p><hr><p>å‚è€ƒï¼š</p><p>ğŸ”— ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹</p>]]></content>
    
    <summary type="html">
    
      ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°ï¼Œå†…å®¹ï¼šå¾®æœåŠ¡æ¶æ„æ˜¯ä»€ä¹ˆï¼Œå¾®æœåŠ¡æ¶æ„é£æ ¼ï¼Œä¸ºåº”ç”¨å®šä¹‰å¾®æœåŠ¡æ¶æ„çš„æµç¨‹ï¼ˆè¯†åˆ«ç³»ç»Ÿæ“ä½œã€æ ¹æ®ä¸šåŠ¡èƒ½åŠ›æˆ–DDDå­åŸŸè¿›è¡ŒæœåŠ¡æ‹†åˆ†ã€æ‹†åˆ†çš„åŸåˆ™å’Œéš¾ç‚¹ã€å®šä¹‰æœåŠ¡çš„APIï¼‰ç­‰ã€‚
    
    </summary>
    
      <category term="æŠ€æœ¯æ–‡æ¡£" scheme="http://linyishui.top/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="design pattern" scheme="http://linyishui.top/tags/design-pattern/"/>
    
      <category term="microservice" scheme="http://linyishui.top/tags/microservice/"/>
    
  </entry>
  
</feed>
